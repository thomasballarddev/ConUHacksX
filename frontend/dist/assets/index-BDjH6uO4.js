function dN(o,t){for(var a=0;a<t.length;a++){const u=t[a];if(typeof u!="string"&&!Array.isArray(u)){for(const y in u)if(y!=="default"&&!(y in o)){const T=Object.getOwnPropertyDescriptor(u,y);T&&Object.defineProperty(o,y,T.get?T:{enumerable:!0,get:()=>u[y]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))u(y);new MutationObserver(y=>{for(const T of y)if(T.type==="childList")for(const C of T.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&u(C)}).observe(document,{childList:!0,subtree:!0});function a(y){const T={};return y.integrity&&(T.integrity=y.integrity),y.referrerPolicy&&(T.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?T.credentials="include":y.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function u(y){if(y.ep)return;y.ep=!0;const T=a(y);fetch(y.href,T)}})();function Fv(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var lT={exports:{}},rv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gC;function fN(){if(gC)return rv;gC=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(u,y,T){var C=null;if(T!==void 0&&(C=""+T),y.key!==void 0&&(C=""+y.key),"key"in y){T={};for(var s in y)s!=="key"&&(T[s]=y[s])}else T=y;return y=T.ref,{$$typeof:o,type:u,key:C,ref:y!==void 0?y:null,props:T}}return rv.Fragment=t,rv.jsx=a,rv.jsxs=a,rv}var _C;function pN(){return _C||(_C=1,lT.exports=fN()),lT.exports}var j=pN(),cT={exports:{}},Yi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yC;function mN(){if(yC)return Yi;yC=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),C=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Q=Symbol.for("react.activity"),oe=Symbol.iterator;function he(dt){return dt===null||typeof dt!="object"?null:(dt=oe&&dt[oe]||dt["@@iterator"],typeof dt=="function"?dt:null)}var Je={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ye=Object.assign,Xe={};function st(dt,Kt,Ne){this.props=dt,this.context=Kt,this.refs=Xe,this.updater=Ne||Je}st.prototype.isReactComponent={},st.prototype.setState=function(dt,Kt){if(typeof dt!="object"&&typeof dt!="function"&&dt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,dt,Kt,"setState")},st.prototype.forceUpdate=function(dt){this.updater.enqueueForceUpdate(this,dt,"forceUpdate")};function ft(){}ft.prototype=st.prototype;function ht(dt,Kt,Ne){this.props=dt,this.context=Kt,this.refs=Xe,this.updater=Ne||Je}var Ft=ht.prototype=new ft;Ft.constructor=ht,Ye(Ft,st.prototype),Ft.isPureReactComponent=!0;var fn=Array.isArray;function St(){}var je={H:null,A:null,T:null,S:null},ze=Object.prototype.hasOwnProperty;function Ve(dt,Kt,Ne){var wn=Ne.ref;return{$$typeof:o,type:dt,key:Kt,ref:wn!==void 0?wn:null,props:Ne}}function Ke(dt,Kt){return Ve(dt.type,Kt,dt.props)}function qe(dt){return typeof dt=="object"&&dt!==null&&dt.$$typeof===o}function et(dt){var Kt={"=":"=0",":":"=2"};return"$"+dt.replace(/[=:]/g,function(Ne){return Kt[Ne]})}var be=/\/+/g;function Zt(dt,Kt){return typeof dt=="object"&&dt!==null&&dt.key!=null?et(""+dt.key):Kt.toString(36)}function dn(dt){switch(dt.status){case"fulfilled":return dt.value;case"rejected":throw dt.reason;default:switch(typeof dt.status=="string"?dt.then(St,St):(dt.status="pending",dt.then(function(Kt){dt.status==="pending"&&(dt.status="fulfilled",dt.value=Kt)},function(Kt){dt.status==="pending"&&(dt.status="rejected",dt.reason=Kt)})),dt.status){case"fulfilled":return dt.value;case"rejected":throw dt.reason}}throw dt}function wt(dt,Kt,Ne,wn,Kn){var Zn=typeof dt;(Zn==="undefined"||Zn==="boolean")&&(dt=null);var Ci=!1;if(dt===null)Ci=!0;else switch(Zn){case"bigint":case"string":case"number":Ci=!0;break;case"object":switch(dt.$$typeof){case o:case t:Ci=!0;break;case W:return Ci=dt._init,wt(Ci(dt._payload),Kt,Ne,wn,Kn)}}if(Ci)return Kn=Kn(dt),Ci=wn===""?"."+Zt(dt,0):wn,fn(Kn)?(Ne="",Ci!=null&&(Ne=Ci.replace(be,"$&/")+"/"),wt(Kn,Kt,Ne,"",function(zi){return zi})):Kn!=null&&(qe(Kn)&&(Kn=Ke(Kn,Ne+(Kn.key==null||dt&&dt.key===Kn.key?"":(""+Kn.key).replace(be,"$&/")+"/")+Ci)),Kt.push(Kn)),1;Ci=0;var Xi=wn===""?".":wn+":";if(fn(dt))for(var Gn=0;Gn<dt.length;Gn++)wn=dt[Gn],Zn=Xi+Zt(wn,Gn),Ci+=wt(wn,Kt,Ne,Zn,Kn);else if(Gn=he(dt),typeof Gn=="function")for(dt=Gn.call(dt),Gn=0;!(wn=dt.next()).done;)wn=wn.value,Zn=Xi+Zt(wn,Gn++),Ci+=wt(wn,Kt,Ne,Zn,Kn);else if(Zn==="object"){if(typeof dt.then=="function")return wt(dn(dt),Kt,Ne,wn,Kn);throw Kt=String(dt),Error("Objects are not valid as a React child (found: "+(Kt==="[object Object]"?"object with keys {"+Object.keys(dt).join(", ")+"}":Kt)+"). If you meant to render a collection of children, use an array instead.")}return Ci}function Jt(dt,Kt,Ne){if(dt==null)return dt;var wn=[],Kn=0;return wt(dt,wn,"","",function(Zn){return Kt.call(Ne,Zn,Kn++)}),wn}function En(dt){if(dt._status===-1){var Kt=dt._result;Kt=Kt(),Kt.then(function(Ne){(dt._status===0||dt._status===-1)&&(dt._status=1,dt._result=Ne)},function(Ne){(dt._status===0||dt._status===-1)&&(dt._status=2,dt._result=Ne)}),dt._status===-1&&(dt._status=0,dt._result=Kt)}if(dt._status===1)return dt._result.default;throw dt._result}var ci=typeof reportError=="function"?reportError:function(dt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Kt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof dt=="object"&&dt!==null&&typeof dt.message=="string"?String(dt.message):String(dt),error:dt});if(!window.dispatchEvent(Kt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",dt);return}console.error(dt)},tt={map:Jt,forEach:function(dt,Kt,Ne){Jt(dt,function(){Kt.apply(this,arguments)},Ne)},count:function(dt){var Kt=0;return Jt(dt,function(){Kt++}),Kt},toArray:function(dt){return Jt(dt,function(Kt){return Kt})||[]},only:function(dt){if(!qe(dt))throw Error("React.Children.only expected to receive a single React element child.");return dt}};return Yi.Activity=Q,Yi.Children=tt,Yi.Component=st,Yi.Fragment=a,Yi.Profiler=y,Yi.PureComponent=ht,Yi.StrictMode=u,Yi.Suspense=B,Yi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=je,Yi.__COMPILER_RUNTIME={__proto__:null,c:function(dt){return je.H.useMemoCache(dt)}},Yi.cache=function(dt){return function(){return dt.apply(null,arguments)}},Yi.cacheSignal=function(){return null},Yi.cloneElement=function(dt,Kt,Ne){if(dt==null)throw Error("The argument must be a React element, but you passed "+dt+".");var wn=Ye({},dt.props),Kn=dt.key;if(Kt!=null)for(Zn in Kt.key!==void 0&&(Kn=""+Kt.key),Kt)!ze.call(Kt,Zn)||Zn==="key"||Zn==="__self"||Zn==="__source"||Zn==="ref"&&Kt.ref===void 0||(wn[Zn]=Kt[Zn]);var Zn=arguments.length-2;if(Zn===1)wn.children=Ne;else if(1<Zn){for(var Ci=Array(Zn),Xi=0;Xi<Zn;Xi++)Ci[Xi]=arguments[Xi+2];wn.children=Ci}return Ve(dt.type,Kn,wn)},Yi.createContext=function(dt){return dt={$$typeof:C,_currentValue:dt,_currentValue2:dt,_threadCount:0,Provider:null,Consumer:null},dt.Provider=dt,dt.Consumer={$$typeof:T,_context:dt},dt},Yi.createElement=function(dt,Kt,Ne){var wn,Kn={},Zn=null;if(Kt!=null)for(wn in Kt.key!==void 0&&(Zn=""+Kt.key),Kt)ze.call(Kt,wn)&&wn!=="key"&&wn!=="__self"&&wn!=="__source"&&(Kn[wn]=Kt[wn]);var Ci=arguments.length-2;if(Ci===1)Kn.children=Ne;else if(1<Ci){for(var Xi=Array(Ci),Gn=0;Gn<Ci;Gn++)Xi[Gn]=arguments[Gn+2];Kn.children=Xi}if(dt&&dt.defaultProps)for(wn in Ci=dt.defaultProps,Ci)Kn[wn]===void 0&&(Kn[wn]=Ci[wn]);return Ve(dt,Zn,Kn)},Yi.createRef=function(){return{current:null}},Yi.forwardRef=function(dt){return{$$typeof:s,render:dt}},Yi.isValidElement=qe,Yi.lazy=function(dt){return{$$typeof:W,_payload:{_status:-1,_result:dt},_init:En}},Yi.memo=function(dt,Kt){return{$$typeof:V,type:dt,compare:Kt===void 0?null:Kt}},Yi.startTransition=function(dt){var Kt=je.T,Ne={};je.T=Ne;try{var wn=dt(),Kn=je.S;Kn!==null&&Kn(Ne,wn),typeof wn=="object"&&wn!==null&&typeof wn.then=="function"&&wn.then(St,ci)}catch(Zn){ci(Zn)}finally{Kt!==null&&Ne.types!==null&&(Kt.types=Ne.types),je.T=Kt}},Yi.unstable_useCacheRefresh=function(){return je.H.useCacheRefresh()},Yi.use=function(dt){return je.H.use(dt)},Yi.useActionState=function(dt,Kt,Ne){return je.H.useActionState(dt,Kt,Ne)},Yi.useCallback=function(dt,Kt){return je.H.useCallback(dt,Kt)},Yi.useContext=function(dt){return je.H.useContext(dt)},Yi.useDebugValue=function(){},Yi.useDeferredValue=function(dt,Kt){return je.H.useDeferredValue(dt,Kt)},Yi.useEffect=function(dt,Kt){return je.H.useEffect(dt,Kt)},Yi.useEffectEvent=function(dt){return je.H.useEffectEvent(dt)},Yi.useId=function(){return je.H.useId()},Yi.useImperativeHandle=function(dt,Kt,Ne){return je.H.useImperativeHandle(dt,Kt,Ne)},Yi.useInsertionEffect=function(dt,Kt){return je.H.useInsertionEffect(dt,Kt)},Yi.useLayoutEffect=function(dt,Kt){return je.H.useLayoutEffect(dt,Kt)},Yi.useMemo=function(dt,Kt){return je.H.useMemo(dt,Kt)},Yi.useOptimistic=function(dt,Kt){return je.H.useOptimistic(dt,Kt)},Yi.useReducer=function(dt,Kt,Ne){return je.H.useReducer(dt,Kt,Ne)},Yi.useRef=function(dt){return je.H.useRef(dt)},Yi.useState=function(dt){return je.H.useState(dt)},Yi.useSyncExternalStore=function(dt,Kt,Ne){return je.H.useSyncExternalStore(dt,Kt,Ne)},Yi.useTransition=function(){return je.H.useTransition()},Yi.version="19.2.3",Yi}var xC;function VE(){return xC||(xC=1,cT.exports=mN()),cT.exports}var He=VE();const gN=Fv(He);var uT={exports:{}},sv={},hT={exports:{}},dT={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vC;function _N(){return vC||(vC=1,(function(o){function t(wt,Jt){var En=wt.length;wt.push(Jt);e:for(;0<En;){var ci=En-1>>>1,tt=wt[ci];if(0<y(tt,Jt))wt[ci]=Jt,wt[En]=tt,En=ci;else break e}}function a(wt){return wt.length===0?null:wt[0]}function u(wt){if(wt.length===0)return null;var Jt=wt[0],En=wt.pop();if(En!==Jt){wt[0]=En;e:for(var ci=0,tt=wt.length,dt=tt>>>1;ci<dt;){var Kt=2*(ci+1)-1,Ne=wt[Kt],wn=Kt+1,Kn=wt[wn];if(0>y(Ne,En))wn<tt&&0>y(Kn,Ne)?(wt[ci]=Kn,wt[wn]=En,ci=wn):(wt[ci]=Ne,wt[Kt]=En,ci=Kt);else if(wn<tt&&0>y(Kn,En))wt[ci]=Kn,wt[wn]=En,ci=wn;else break e}}return Jt}function y(wt,Jt){var En=wt.sortIndex-Jt.sortIndex;return En!==0?En:wt.id-Jt.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var T=performance;o.unstable_now=function(){return T.now()}}else{var C=Date,s=C.now();o.unstable_now=function(){return C.now()-s}}var B=[],V=[],W=1,Q=null,oe=3,he=!1,Je=!1,Ye=!1,Xe=!1,st=typeof setTimeout=="function"?setTimeout:null,ft=typeof clearTimeout=="function"?clearTimeout:null,ht=typeof setImmediate<"u"?setImmediate:null;function Ft(wt){for(var Jt=a(V);Jt!==null;){if(Jt.callback===null)u(V);else if(Jt.startTime<=wt)u(V),Jt.sortIndex=Jt.expirationTime,t(B,Jt);else break;Jt=a(V)}}function fn(wt){if(Ye=!1,Ft(wt),!Je)if(a(B)!==null)Je=!0,St||(St=!0,et());else{var Jt=a(V);Jt!==null&&dn(fn,Jt.startTime-wt)}}var St=!1,je=-1,ze=5,Ve=-1;function Ke(){return Xe?!0:!(o.unstable_now()-Ve<ze)}function qe(){if(Xe=!1,St){var wt=o.unstable_now();Ve=wt;var Jt=!0;try{e:{Je=!1,Ye&&(Ye=!1,ft(je),je=-1),he=!0;var En=oe;try{t:{for(Ft(wt),Q=a(B);Q!==null&&!(Q.expirationTime>wt&&Ke());){var ci=Q.callback;if(typeof ci=="function"){Q.callback=null,oe=Q.priorityLevel;var tt=ci(Q.expirationTime<=wt);if(wt=o.unstable_now(),typeof tt=="function"){Q.callback=tt,Ft(wt),Jt=!0;break t}Q===a(B)&&u(B),Ft(wt)}else u(B);Q=a(B)}if(Q!==null)Jt=!0;else{var dt=a(V);dt!==null&&dn(fn,dt.startTime-wt),Jt=!1}}break e}finally{Q=null,oe=En,he=!1}Jt=void 0}}finally{Jt?et():St=!1}}}var et;if(typeof ht=="function")et=function(){ht(qe)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Zt=be.port2;be.port1.onmessage=qe,et=function(){Zt.postMessage(null)}}else et=function(){st(qe,0)};function dn(wt,Jt){je=st(function(){wt(o.unstable_now())},Jt)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(wt){wt.callback=null},o.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ze=0<wt?Math.floor(1e3/wt):5},o.unstable_getCurrentPriorityLevel=function(){return oe},o.unstable_next=function(wt){switch(oe){case 1:case 2:case 3:var Jt=3;break;default:Jt=oe}var En=oe;oe=Jt;try{return wt()}finally{oe=En}},o.unstable_requestPaint=function(){Xe=!0},o.unstable_runWithPriority=function(wt,Jt){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var En=oe;oe=wt;try{return Jt()}finally{oe=En}},o.unstable_scheduleCallback=function(wt,Jt,En){var ci=o.unstable_now();switch(typeof En=="object"&&En!==null?(En=En.delay,En=typeof En=="number"&&0<En?ci+En:ci):En=ci,wt){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=En+tt,wt={id:W++,callback:Jt,priorityLevel:wt,startTime:En,expirationTime:tt,sortIndex:-1},En>ci?(wt.sortIndex=En,t(V,wt),a(B)===null&&wt===a(V)&&(Ye?(ft(je),je=-1):Ye=!0,dn(fn,En-ci))):(wt.sortIndex=tt,t(B,wt),Je||he||(Je=!0,St||(St=!0,et()))),wt},o.unstable_shouldYield=Ke,o.unstable_wrapCallback=function(wt){var Jt=oe;return function(){var En=oe;oe=Jt;try{return wt.apply(this,arguments)}finally{oe=En}}}})(dT)),dT}var bC;function yN(){return bC||(bC=1,hT.exports=_N()),hT.exports}var fT={exports:{}},Tl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wC;function xN(){if(wC)return Tl;wC=1;var o=VE();function t(B){var V="https://react.dev/errors/"+B;if(1<arguments.length){V+="?args[]="+encodeURIComponent(arguments[1]);for(var W=2;W<arguments.length;W++)V+="&args[]="+encodeURIComponent(arguments[W])}return"Minified React error #"+B+"; visit "+V+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var u={d:{f:a,r:function(){throw Error(t(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},y=Symbol.for("react.portal");function T(B,V,W){var Q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:y,key:Q==null?null:""+Q,children:B,containerInfo:V,implementation:W}}var C=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(B,V){if(B==="font")return"";if(typeof V=="string")return V==="use-credentials"?V:""}return Tl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,Tl.createPortal=function(B,V){var W=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V||V.nodeType!==1&&V.nodeType!==9&&V.nodeType!==11)throw Error(t(299));return T(B,V,null,W)},Tl.flushSync=function(B){var V=C.T,W=u.p;try{if(C.T=null,u.p=2,B)return B()}finally{C.T=V,u.p=W,u.d.f()}},Tl.preconnect=function(B,V){typeof B=="string"&&(V?(V=V.crossOrigin,V=typeof V=="string"?V==="use-credentials"?V:"":void 0):V=null,u.d.C(B,V))},Tl.prefetchDNS=function(B){typeof B=="string"&&u.d.D(B)},Tl.preinit=function(B,V){if(typeof B=="string"&&V&&typeof V.as=="string"){var W=V.as,Q=s(W,V.crossOrigin),oe=typeof V.integrity=="string"?V.integrity:void 0,he=typeof V.fetchPriority=="string"?V.fetchPriority:void 0;W==="style"?u.d.S(B,typeof V.precedence=="string"?V.precedence:void 0,{crossOrigin:Q,integrity:oe,fetchPriority:he}):W==="script"&&u.d.X(B,{crossOrigin:Q,integrity:oe,fetchPriority:he,nonce:typeof V.nonce=="string"?V.nonce:void 0})}},Tl.preinitModule=function(B,V){if(typeof B=="string")if(typeof V=="object"&&V!==null){if(V.as==null||V.as==="script"){var W=s(V.as,V.crossOrigin);u.d.M(B,{crossOrigin:W,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0})}}else V==null&&u.d.M(B)},Tl.preload=function(B,V){if(typeof B=="string"&&typeof V=="object"&&V!==null&&typeof V.as=="string"){var W=V.as,Q=s(W,V.crossOrigin);u.d.L(B,W,{crossOrigin:Q,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0,type:typeof V.type=="string"?V.type:void 0,fetchPriority:typeof V.fetchPriority=="string"?V.fetchPriority:void 0,referrerPolicy:typeof V.referrerPolicy=="string"?V.referrerPolicy:void 0,imageSrcSet:typeof V.imageSrcSet=="string"?V.imageSrcSet:void 0,imageSizes:typeof V.imageSizes=="string"?V.imageSizes:void 0,media:typeof V.media=="string"?V.media:void 0})}},Tl.preloadModule=function(B,V){if(typeof B=="string")if(V){var W=s(V.as,V.crossOrigin);u.d.m(B,{as:typeof V.as=="string"&&V.as!=="script"?V.as:void 0,crossOrigin:W,integrity:typeof V.integrity=="string"?V.integrity:void 0})}else u.d.m(B)},Tl.requestFormReset=function(B){u.d.r(B)},Tl.unstable_batchedUpdates=function(B,V){return B(V)},Tl.useFormState=function(B,V,W){return C.H.useFormState(B,V,W)},Tl.useFormStatus=function(){return C.H.useHostTransitionStatus()},Tl.version="19.2.3",Tl}var TC;function lD(){if(TC)return fT.exports;TC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),fT.exports=xN(),fT.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EC;function vN(){if(EC)return sv;EC=1;var o=yN(),t=VE(),a=lD();function u(h){var g="https://react.dev/errors/"+h;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function T(h){var g=h,w=h;if(h.alternate)for(;g.return;)g=g.return;else{h=g;do g=h,(g.flags&4098)!==0&&(w=g.return),h=g.return;while(h)}return g.tag===3?w:null}function C(h){if(h.tag===13){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function s(h){if(h.tag===31){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function B(h){if(T(h)!==h)throw Error(u(188))}function V(h){var g=h.alternate;if(!g){if(g=T(h),g===null)throw Error(u(188));return g!==h?null:h}for(var w=h,R=g;;){var F=w.return;if(F===null)break;var q=F.alternate;if(q===null){if(R=F.return,R!==null){w=R;continue}break}if(F.child===q.child){for(q=F.child;q;){if(q===w)return B(F),h;if(q===R)return B(F),g;q=q.sibling}throw Error(u(188))}if(w.return!==R.return)w=F,R=q;else{for(var ce=!1,Re=F.child;Re;){if(Re===w){ce=!0,w=F,R=q;break}if(Re===R){ce=!0,R=F,w=q;break}Re=Re.sibling}if(!ce){for(Re=q.child;Re;){if(Re===w){ce=!0,w=q,R=F;break}if(Re===R){ce=!0,R=q,w=F;break}Re=Re.sibling}if(!ce)throw Error(u(189))}}if(w.alternate!==R)throw Error(u(190))}if(w.tag!==3)throw Error(u(188));return w.stateNode.current===w?h:g}function W(h){var g=h.tag;if(g===5||g===26||g===27||g===6)return h;for(h=h.child;h!==null;){if(g=W(h),g!==null)return g;h=h.sibling}return null}var Q=Object.assign,oe=Symbol.for("react.element"),he=Symbol.for("react.transitional.element"),Je=Symbol.for("react.portal"),Ye=Symbol.for("react.fragment"),Xe=Symbol.for("react.strict_mode"),st=Symbol.for("react.profiler"),ft=Symbol.for("react.consumer"),ht=Symbol.for("react.context"),Ft=Symbol.for("react.forward_ref"),fn=Symbol.for("react.suspense"),St=Symbol.for("react.suspense_list"),je=Symbol.for("react.memo"),ze=Symbol.for("react.lazy"),Ve=Symbol.for("react.activity"),Ke=Symbol.for("react.memo_cache_sentinel"),qe=Symbol.iterator;function et(h){return h===null||typeof h!="object"?null:(h=qe&&h[qe]||h["@@iterator"],typeof h=="function"?h:null)}var be=Symbol.for("react.client.reference");function Zt(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===be?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case Ye:return"Fragment";case st:return"Profiler";case Xe:return"StrictMode";case fn:return"Suspense";case St:return"SuspenseList";case Ve:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case Je:return"Portal";case ht:return h.displayName||"Context";case ft:return(h._context.displayName||"Context")+".Consumer";case Ft:var g=h.render;return h=h.displayName,h||(h=g.displayName||g.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case je:return g=h.displayName||null,g!==null?g:Zt(h.type)||"Memo";case ze:g=h._payload,h=h._init;try{return Zt(h(g))}catch{}}return null}var dn=Array.isArray,wt=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Jt=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,En={pending:!1,data:null,method:null,action:null},ci=[],tt=-1;function dt(h){return{current:h}}function Kt(h){0>tt||(h.current=ci[tt],ci[tt]=null,tt--)}function Ne(h,g){tt++,ci[tt]=h.current,h.current=g}var wn=dt(null),Kn=dt(null),Zn=dt(null),Ci=dt(null);function Xi(h,g){switch(Ne(Zn,g),Ne(Kn,h),Ne(wn,null),g.nodeType){case 9:case 11:h=(h=g.documentElement)&&(h=h.namespaceURI)?cx(h):0;break;default:if(h=g.tagName,g=g.namespaceURI)g=cx(g),h=F_(g,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}Kt(wn),Ne(wn,h)}function Gn(){Kt(wn),Kt(Kn),Kt(Zn)}function zi(h){h.memoizedState!==null&&Ne(Ci,h);var g=wn.current,w=F_(g,h.type);g!==w&&(Ne(Kn,h),Ne(wn,w))}function jr(h){Kn.current===h&&(Kt(wn),Kt(Kn)),Ci.current===h&&(Kt(Ci),Rc._currentValue=En)}var Va,cr;function Bs(h){if(Va===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);Va=g&&g[1]||"",cr=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Va+h+cr}var Hn=!1;function Ti(h,g){if(!h||Hn)return"";Hn=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(g){var un=function(){throw Error()};if(Object.defineProperty(un.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(un,[])}catch(Yt){var Ut=Yt}Reflect.construct(h,[],un)}else{try{un.call()}catch(Yt){Ut=Yt}h.call(un.prototype)}}else{try{throw Error()}catch(Yt){Ut=Yt}(un=h())&&typeof un.catch=="function"&&un.catch(function(){})}}catch(Yt){if(Yt&&Ut&&typeof Yt.stack=="string")return[Yt.stack,Ut.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var F=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");F&&F.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=R.DetermineComponentFrameRoot(),ce=q[0],Re=q[1];if(ce&&Re){var ct=ce.split(`
`),Vt=Re.split(`
`);for(F=R=0;R<ct.length&&!ct[R].includes("DetermineComponentFrameRoot");)R++;for(;F<Vt.length&&!Vt[F].includes("DetermineComponentFrameRoot");)F++;if(R===ct.length||F===Vt.length)for(R=ct.length-1,F=Vt.length-1;1<=R&&0<=F&&ct[R]!==Vt[F];)F--;for(;1<=R&&0<=F;R--,F--)if(ct[R]!==Vt[F]){if(R!==1||F!==1)do if(R--,F--,0>F||ct[R]!==Vt[F]){var sn=`
`+ct[R].replace(" at new "," at ");return h.displayName&&sn.includes("<anonymous>")&&(sn=sn.replace("<anonymous>",h.displayName)),sn}while(1<=R&&0<=F);break}}}finally{Hn=!1,Error.prepareStackTrace=w}return(w=h?h.displayName||h.name:"")?Bs(w):""}function ur(h,g){switch(h.tag){case 26:case 27:case 5:return Bs(h.type);case 16:return Bs("Lazy");case 13:return h.child!==g&&g!==null?Bs("Suspense Fallback"):Bs("Suspense");case 19:return Bs("SuspenseList");case 0:case 15:return Ti(h.type,!1);case 11:return Ti(h.type.render,!1);case 1:return Ti(h.type,!0);case 31:return Bs("Activity");default:return""}}function ui(h){try{var g="",w=null;do g+=ur(h,w),w=h,h=h.return;while(h);return g}catch(R){return`
Error generating stack: `+R.message+`
`+R.stack}}var Qi=Object.prototype.hasOwnProperty,_r=o.unstable_scheduleCallback,Xs=o.unstable_cancelCallback,Rl=o.unstable_shouldYield,rc=o.unstable_requestPaint,Ur=o.unstable_now,vs=o.unstable_getCurrentPriorityLevel,en=o.unstable_ImmediatePriority,Tn=o.unstable_UserBlockingPriority,ri=o.unstable_NormalPriority,Oi=o.unstable_LowPriority,Ri=o.unstable_IdlePriority,Fs=o.log,gs=o.unstable_setDisableYieldValue,ps=null,kr=null;function yr(h){if(typeof Fs=="function"&&gs(h),kr&&typeof kr.setStrictMode=="function")try{kr.setStrictMode(ps,h)}catch{}}var Vi=Math.clz32?Math.clz32:cl,ra=Math.log,bs=Math.LN2;function cl(h){return h>>>=0,h===0?32:31-(ra(h)/bs|0)|0}var Ca=256,bo=262144,ms=4194304;function ji(h){var g=h&42;if(g!==0)return g;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return h&261888;case 262144:case 524288:case 1048576:case 2097152:return h&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function Yr(h,g,w){var R=h.pendingLanes;if(R===0)return 0;var F=0,q=h.suspendedLanes,ce=h.pingedLanes;h=h.warmLanes;var Re=R&134217727;return Re!==0?(R=Re&~q,R!==0?F=ji(R):(ce&=Re,ce!==0?F=ji(ce):w||(w=Re&~h,w!==0&&(F=ji(w))))):(Re=R&~q,Re!==0?F=ji(Re):ce!==0?F=ji(ce):w||(w=R&~h,w!==0&&(F=ji(w)))),F===0?0:g!==0&&g!==F&&(g&q)===0&&(q=F&-F,w=g&-g,q>=w||q===32&&(w&4194048)!==0)?g:F}function wo(h,g){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&g)===0}function _u(h,g){switch(h){case 1:case 2:case 4:case 8:case 64:return g+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ja(){var h=ms;return ms<<=1,(ms&62914560)===0&&(ms=4194304),h}function ul(h){for(var g=[],w=0;31>w;w++)g.push(h);return g}function hl(h,g){h.pendingLanes|=g,g!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function Mt(h,g,w,R,F,q){var ce=h.pendingLanes;h.pendingLanes=w,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=w,h.entangledLanes&=w,h.errorRecoveryDisabledLanes&=w,h.shellSuspendCounter=0;var Re=h.entanglements,ct=h.expirationTimes,Vt=h.hiddenUpdates;for(w=ce&~w;0<w;){var sn=31-Vi(w),un=1<<sn;Re[sn]=0,ct[sn]=-1;var Ut=Vt[sn];if(Ut!==null)for(Vt[sn]=null,sn=0;sn<Ut.length;sn++){var Yt=Ut[sn];Yt!==null&&(Yt.lane&=-536870913)}w&=~un}R!==0&&no(h,R,0),q!==0&&F===0&&h.tag!==0&&(h.suspendedLanes|=q&~(ce&~g))}function no(h,g,w){h.pendingLanes|=g,h.suspendedLanes&=~g;var R=31-Vi(g);h.entangledLanes|=g,h.entanglements[R]=h.entanglements[R]|1073741824|w&261930}function th(h,g){var w=h.entangledLanes|=g;for(h=h.entanglements;w;){var R=31-Vi(w),F=1<<R;F&g|h[R]&g&&(h[R]|=g),w&=~F}}function Lc(h,g){var w=g&-g;return w=(w&42)!==0?1:ai(w),(w&(h.suspendedLanes|g))!==0?0:w}function ai(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function Ue(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function ne(){var h=Jt.p;return h!==0?h:(h=window.event,h===void 0?32:S0(h.type))}function ae(h,g){var w=Jt.p;try{return Jt.p=h,g()}finally{Jt.p=w}}var ye=Math.random().toString(36).slice(2),De="__reactFiber$"+ye,xe="__reactProps$"+ye,Be="__reactContainer$"+ye,it="__reactEvents$"+ye,Ge="__reactListeners$"+ye,at="__reactHandles$"+ye,Dt="__reactResources$"+ye,It="__reactMarker$"+ye;function tn(h){delete h[De],delete h[xe],delete h[it],delete h[Ge],delete h[at]}function yn(h){var g=h[De];if(g)return g;for(var w=h.parentNode;w;){if(g=w[Be]||w[De]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(h=fx(h);h!==null;){if(w=h[De])return w;h=fx(h)}return g}h=w,w=h.parentNode}return null}function bn(h){if(h=h[De]||h[Be]){var g=h.tag;if(g===5||g===6||g===13||g===31||g===26||g===27||g===3)return h}return null}function kn(h){var g=h.tag;if(g===5||g===26||g===27||g===6)return h.stateNode;throw Error(u(33))}function Fn(h){var g=h[Dt];return g||(g=h[Dt]={hoistableStyles:new Map,hoistableScripts:new Map}),g}function vn(h){h[It]=!0}var Pn=new Set,$i={};function vr(h,g){nr(h,g),nr(h+"Capture",g)}function nr(h,g){for($i[h]=g,h=0;h<g.length;h++)Pn.add(g[h])}var br=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ir={},hi={};function hr(h){return Qi.call(hi,h)?!0:Qi.call(ir,h)?!1:br.test(h)?hi[h]=!0:(ir[h]=!0,!1)}function Ni(h,g,w){if(hr(g))if(w===null)h.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":h.removeAttribute(g);return;case"boolean":var R=g.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){h.removeAttribute(g);return}}h.setAttribute(g,""+w)}}function _i(h,g,w){if(w===null)h.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(g);return}h.setAttribute(g,""+w)}}function Ei(h,g,w,R){if(R===null)h.removeAttribute(w);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(w);return}h.setAttributeNS(g,w,""+R)}}function dr(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Jr(h){var g=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function es(h,g,w){var R=Object.getOwnPropertyDescriptor(h.constructor.prototype,g);if(!h.hasOwnProperty(g)&&typeof R<"u"&&typeof R.get=="function"&&typeof R.set=="function"){var F=R.get,q=R.set;return Object.defineProperty(h,g,{configurable:!0,get:function(){return F.call(this)},set:function(ce){w=""+ce,q.call(this,ce)}}),Object.defineProperty(h,g,{enumerable:R.enumerable}),{getValue:function(){return w},setValue:function(ce){w=""+ce},stopTracking:function(){h._valueTracker=null,delete h[g]}}}}function fr(h){if(!h._valueTracker){var g=Jr(h)?"checked":"value";h._valueTracker=es(h,g,""+h[g])}}function ws(h){if(!h)return!1;var g=h._valueTracker;if(!g)return!0;var w=g.getValue(),R="";return h&&(R=Jr(h)?h.checked?"true":"false":h.value),h=R,h!==w?(g.setValue(h),!0):!1}function Ts(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var ma=/[\n"\\]/g;function _s(h){return h.replace(ma,function(g){return"\\"+g.charCodeAt(0).toString(16)+" "})}function sa(h,g,w,R,F,q,ce,Re){h.name="",ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?h.type=ce:h.removeAttribute("type"),g!=null?ce==="number"?(g===0&&h.value===""||h.value!=g)&&(h.value=""+dr(g)):h.value!==""+dr(g)&&(h.value=""+dr(g)):ce!=="submit"&&ce!=="reset"||h.removeAttribute("value"),g!=null?$o(h,ce,dr(g)):w!=null?$o(h,ce,dr(w)):R!=null&&h.removeAttribute("value"),F==null&&q!=null&&(h.defaultChecked=!!q),F!=null&&(h.checked=F&&typeof F!="function"&&typeof F!="symbol"),Re!=null&&typeof Re!="function"&&typeof Re!="symbol"&&typeof Re!="boolean"?h.name=""+dr(Re):h.removeAttribute("name")}function aa(h,g,w,R,F,q,ce,Re){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(h.type=q),g!=null||w!=null){if(!(q!=="submit"&&q!=="reset"||g!=null)){fr(h);return}w=w!=null?""+dr(w):"",g=g!=null?""+dr(g):w,Re||g===h.value||(h.value=g),h.defaultValue=g}R=R??F,R=typeof R!="function"&&typeof R!="symbol"&&!!R,h.checked=Re?h.checked:!!R,h.defaultChecked=!!R,ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"&&(h.name=ce),fr(h)}function $o(h,g,w){g==="number"&&Ts(h.ownerDocument)===h||h.defaultValue===""+w||(h.defaultValue=""+w)}function To(h,g,w,R){if(h=h.options,g){g={};for(var F=0;F<w.length;F++)g["$"+w[F]]=!0;for(w=0;w<h.length;w++)F=g.hasOwnProperty("$"+h[w].value),h[w].selected!==F&&(h[w].selected=F),F&&R&&(h[w].defaultSelected=!0)}else{for(w=""+dr(w),g=null,F=0;F<h.length;F++){if(h[F].value===w){h[F].selected=!0,R&&(h[F].defaultSelected=!0);return}g!==null||h[F].disabled||(g=h[F])}g!==null&&(g.selected=!0)}}function Ua(h,g,w){if(g!=null&&(g=""+dr(g),g!==h.value&&(h.value=g),w==null)){h.defaultValue!==g&&(h.defaultValue=g);return}h.defaultValue=w!=null?""+dr(w):""}function dl(h,g,w,R){if(g==null){if(R!=null){if(w!=null)throw Error(u(92));if(dn(R)){if(1<R.length)throw Error(u(93));R=R[0]}w=R}w==null&&(w=""),g=w}w=dr(g),h.defaultValue=w,R=h.textContent,R===w&&R!==""&&R!==null&&(h.value=R),fr(h)}function ga(h,g){if(g){var w=h.firstChild;if(w&&w===h.lastChild&&w.nodeType===3){w.nodeValue=g;return}}h.textContent=g}var pf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function td(h,g,w){var R=g.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?R?h.setProperty(g,""):g==="float"?h.cssFloat="":h[g]="":R?h.setProperty(g,w):typeof w!="number"||w===0||pf.has(g)?g==="float"?h.cssFloat=w:h[g]=(""+w).trim():h[g]=w+"px"}function nh(h,g,w){if(g!=null&&typeof g!="object")throw Error(u(62));if(h=h.style,w!=null){for(var R in w)!w.hasOwnProperty(R)||g!=null&&g.hasOwnProperty(R)||(R.indexOf("--")===0?h.setProperty(R,""):R==="float"?h.cssFloat="":h[R]="");for(var F in g)R=g[F],g.hasOwnProperty(F)&&w[F]!==R&&td(h,F,R)}else for(var q in g)g.hasOwnProperty(q)&&td(h,q,g[q])}function yu(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Es=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ys=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Eo(h){return Ys.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}function Ss(){}var So=null;function Ra(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Zo=null,Ga=null;function Ao(h){var g=bn(h);if(g&&(h=g.stateNode)){var w=h[xe]||null;e:switch(h=g.stateNode,g.type){case"input":if(sa(h,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),g=w.name,w.type==="radio"&&g!=null){for(w=h;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+_s(""+g)+'"][type="radio"]'),g=0;g<w.length;g++){var R=w[g];if(R!==h&&R.form===h.form){var F=R[xe]||null;if(!F)throw Error(u(90));sa(R,F.value,F.defaultValue,F.defaultValue,F.checked,F.defaultChecked,F.type,F.name)}}for(g=0;g<w.length;g++)R=w[g],R.form===h.form&&ws(R)}break e;case"textarea":Ua(h,w.value,w.defaultValue);break e;case"select":g=w.value,g!=null&&To(h,!!w.multiple,g,!1)}}}var zc=!1;function Oc(h,g,w){if(zc)return h(g,w);zc=!0;try{var R=h(g);return R}finally{if(zc=!1,(Zo!==null||Ga!==null)&&(er(),Zo&&(g=Zo,h=Ga,Ga=Zo=null,Ao(g),h)))for(g=0;g<h.length;g++)Ao(h[g])}}function fl(h,g){var w=h.stateNode;if(w===null)return null;var R=w[xe]||null;if(R===null)return null;w=R[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(h=h.type,R=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!R;break e;default:h=!1}if(h)return null;if(w&&typeof w!="function")throw Error(u(231,g,typeof w));return w}var us=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ml=!1;if(us)try{var Sr={};Object.defineProperty(Sr,"passive",{get:function(){Ml=!0}}),window.addEventListener("test",Sr,Sr),window.removeEventListener("test",Sr,Sr)}catch{Ml=!1}var _a=null,Nc=null,ih=null;function rh(){if(ih)return ih;var h,g=Nc,w=g.length,R,F="value"in _a?_a.value:_a.textContent,q=F.length;for(h=0;h<w&&g[h]===F[h];h++);var ce=w-h;for(R=1;R<=ce&&g[w-R]===F[q-R];R++);return ih=F.slice(h,1<R?1-R:void 0)}function di(h){var g=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&g===13&&(h=13)):h=g,h===10&&(h=13),32<=h||h===13?h:0}function Io(){return!0}function Co(){return!1}function ya(h){function g(w,R,F,q,ce){this._reactName=w,this._targetInst=F,this.type=R,this.nativeEvent=q,this.target=ce,this.currentTarget=null;for(var Re in h)h.hasOwnProperty(Re)&&(w=h[Re],this[Re]=w?w(q):q[Re]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?Io:Co,this.isPropagationStopped=Co,this}return Q(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Io)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Io)},persist:function(){},isPersistent:Io}),g}var sc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ro=ya(sc),io=Q({},sc,{view:0,detail:0}),Bc=ya(io),Dl,nd,ro,Mo=Q({},io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:As,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==ro&&(ro&&h.type==="mousemove"?(Dl=h.screenX-ro.screenX,nd=h.screenY-ro.screenY):nd=Dl=0,ro=h),Dl)},movementY:function(h){return"movementY"in h?h.movementY:nd}}),Fc=ya(Mo),xu=Q({},Mo,{dataTransfer:0}),ac=ya(xu),pl=Q({},io,{relatedTarget:0}),Vs=ya(pl),qa=Q({},sc,{animationName:0,elapsedTime:0,pseudoElement:0}),sh=ya(qa),ah=Q({},sc,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Si=ya(ah),id=Q({},sc,{data:0}),Pl=ya(id),mf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oc(h){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(h):(h=rd[h])?!!g[h]:!1}function As(){return oc}var xa=Q({},io,{key:function(h){if(h.key){var g=mf[h.key]||h.key;if(g!=="Unidentified")return g}return h.type==="keypress"?(h=di(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Cn[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:As,charCode:function(h){return h.type==="keypress"?di(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?di(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),va=ya(xa),gn=Q({},Mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pi=ya(gn),L=Q({},io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:As}),ie=ya(L),de=Q({},sc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ce=ya(de),Lt=Q({},Mo,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Gt=ya(Lt),Sn=Q({},sc,{newState:0,oldState:0}),oi=ya(Sn),Mi=[9,13,27,32],Lr=us&&"CompositionEvent"in window,Kr=null;us&&"documentMode"in document&&(Kr=document.documentMode);var Do=us&&"TextEvent"in window&&!Kr,Po=us&&(!Lr||Kr&&8<Kr&&11>=Kr),ko=" ",Wo=!1;function lc(h,g){switch(h){case"keyup":return Mi.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rs(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Ks=!1;function so(h,g){switch(h){case"compositionend":return Rs(g);case"keypress":return g.which!==32?null:(Wo=!0,ko);case"textInput":return h=g.data,h===ko&&Wo?null:h;default:return null}}function $m(h,g){if(Ks)return h==="compositionend"||!Lr&&lc(h,g)?(h=rh(),ih=Nc=_a=null,Ks=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Po&&g.locale!=="ko"?null:g.data;default:return null}}var vu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Is(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g==="input"?!!vu[h.type]:g==="textarea"}function kl(h,g,w,R){Zo?Ga?Ga.push(R):Ga=[R]:Zo=R,g=Rg(g,"onChange"),0<g.length&&(w=new Ro("onChange","change",null,w,R),h.push({event:w,listeners:g}))}var Xo=null,ts=null;function bu(h){Ag(h,0)}function zn(h){var g=kn(h);if(ws(g))return h}function mn(h,g){if(h==="change")return g}var oh=!1;if(us){var Ln;if(us){var sd="oninput"in document;if(!sd){var ad=document.createElement("div");ad.setAttribute("oninput","return;"),sd=typeof ad.oninput=="function"}Ln=sd}else Ln=!1;oh=Ln&&(!document.documentMode||9<document.documentMode)}function Rn(){Xo&&(Xo.detachEvent("onpropertychange",Sp),ts=Xo=null)}function Sp(h){if(h.propertyName==="value"&&zn(ts)){var g=[];kl(g,ts,h,Ra(h)),Oc(bu,g)}}function Zm(h,g,w){h==="focusin"?(Rn(),Xo=g,ts=w,Xo.attachEvent("onpropertychange",Sp)):h==="focusout"&&Rn()}function cc(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return zn(ts)}function __(h,g){if(h==="click")return zn(g)}function od(h,g){if(h==="input"||h==="change")return zn(g)}function ao(h,g){return h===g&&(h!==0||1/h===1/g)||h!==h&&g!==g}var oo=typeof Object.is=="function"?Object.is:ao;function Lo(h,g){if(oo(h,g))return!0;if(typeof h!="object"||h===null||typeof g!="object"||g===null)return!1;var w=Object.keys(h),R=Object.keys(g);if(w.length!==R.length)return!1;for(R=0;R<w.length;R++){var F=w[R];if(!Qi.call(g,F)||!oo(h[F],g[F]))return!1}return!0}function gf(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Yo(h,g){var w=gf(h);h=0;for(var R;w;){if(w.nodeType===3){if(R=h+w.textContent.length,h<=g&&R>=g)return{node:w,offset:g-h};h=R}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=gf(w)}}function Vc(h,g){return h&&g?h===g?!0:h&&h.nodeType===3?!1:g&&g.nodeType===3?Vc(h,g.parentNode):"contains"in h?h.contains(g):h.compareDocumentPosition?!!(h.compareDocumentPosition(g)&16):!1:!1}function y_(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var g=Ts(h.document);g instanceof h.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)h=g.contentWindow;else break;g=Ts(h.document)}return g}function lh(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g&&(g==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||g==="textarea"||h.contentEditable==="true")}var _f=us&&"documentMode"in document&&11>=document.documentMode,jc=null,Ap=null,Ha=null,Ip=!1;function yf(h,g,w){var R=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Ip||jc==null||jc!==Ts(R)||(R=jc,"selectionStart"in R&&lh(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),Ha&&Lo(Ha,R)||(Ha=R,R=Rg(Ap,"onSelect"),0<R.length&&(g=new Ro("onSelect","select",null,g,w),h.push({event:g,listeners:R}),g.target=jc)))}function Ll(h,g){var w={};return w[h.toLowerCase()]=g.toLowerCase(),w["Webkit"+h]="webkit"+g,w["Moz"+h]="moz"+g,w}var Ko={animationend:Ll("Animation","AnimationEnd"),animationiteration:Ll("Animation","AnimationIteration"),animationstart:Ll("Animation","AnimationStart"),transitionrun:Ll("Transition","TransitionRun"),transitionstart:Ll("Transition","TransitionStart"),transitioncancel:Ll("Transition","TransitionCancel"),transitionend:Ll("Transition","TransitionEnd")},Wm={},Xm={};us&&(Xm=document.createElement("div").style,"AnimationEvent"in window||(delete Ko.animationend.animation,delete Ko.animationiteration.animation,delete Ko.animationstart.animation),"TransitionEvent"in window||delete Ko.transitionend.transition);function ch(h){if(Wm[h])return Wm[h];if(!Ko[h])return h;var g=Ko[h],w;for(w in g)if(g.hasOwnProperty(w)&&w in Xm)return Wm[h]=g[w];return h}var Cp=ch("animationend"),x_=ch("animationiteration"),uc=ch("animationstart"),v_=ch("transitionrun"),b_=ch("transitionstart"),Rp=ch("transitioncancel"),Mp=ch("transitionend"),Uc=new Map,$a="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$a.push("scrollEnd");function Qo(h,g){Uc.set(h,g),vr(g,[h])}var ld=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},Ma=[],zl=0,xf=0;function uh(){for(var h=zl,g=xf=zl=0;g<h;){var w=Ma[g];Ma[g++]=null;var R=Ma[g];Ma[g++]=null;var F=Ma[g];Ma[g++]=null;var q=Ma[g];if(Ma[g++]=null,R!==null&&F!==null){var ce=R.pending;ce===null?F.next=F:(F.next=ce.next,ce.next=F),R.pending=F}q!==0&&Dp(w,F,q)}}function Za(h,g,w,R){Ma[zl++]=h,Ma[zl++]=g,Ma[zl++]=w,Ma[zl++]=R,xf|=R,h.lanes|=R,h=h.alternate,h!==null&&(h.lanes|=R)}function hh(h,g,w,R){return Za(h,g,w,R),cd(h)}function jt(h,g){return Za(h,null,null,g),cd(h)}function Dp(h,g,w){h.lanes|=w;var R=h.alternate;R!==null&&(R.lanes|=w);for(var F=!1,q=h.return;q!==null;)q.childLanes|=w,R=q.alternate,R!==null&&(R.childLanes|=w),q.tag===22&&(h=q.stateNode,h===null||h._visibility&1||(F=!0)),h=q,q=q.return;return h.tag===3?(q=h.stateNode,F&&g!==null&&(F=31-Vi(w),h=q.hiddenUpdates,R=h[F],R===null?h[F]=[g]:R.push(g),g.lane=w|536870912),q):null}function cd(h){if(50<yi)throw yi=0,gr=null,Error(u(185));for(var g=h.return;g!==null;)h=g,g=h.return;return h.tag===3?h.stateNode:null}var hc={};function dc(h,g,w,R){this.tag=h,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(h,g,w,R){return new dc(h,g,w,R)}function Gc(h){return h=h.prototype,!(!h||!h.isReactComponent)}function co(h,g){var w=h.alternate;return w===null?(w=lo(h.tag,g,h.key,h.mode),w.elementType=h.elementType,w.type=h.type,w.stateNode=h.stateNode,w.alternate=h,h.alternate=w):(w.pendingProps=g,w.type=h.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=h.flags&65011712,w.childLanes=h.childLanes,w.lanes=h.lanes,w.child=h.child,w.memoizedProps=h.memoizedProps,w.memoizedState=h.memoizedState,w.updateQueue=h.updateQueue,g=h.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=h.sibling,w.index=h.index,w.ref=h.ref,w.refCleanup=h.refCleanup,w}function qc(h,g){h.flags&=65011714;var w=h.alternate;return w===null?(h.childLanes=0,h.lanes=g,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=w.childLanes,h.lanes=w.lanes,h.child=w.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=w.memoizedProps,h.memoizedState=w.memoizedState,h.updateQueue=w.updateQueue,h.type=w.type,g=w.dependencies,h.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),h}function dh(h,g,w,R,F,q){var ce=0;if(R=h,typeof h=="function")Gc(h)&&(ce=1);else if(typeof h=="string")ce=x0(h,w,wn.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case Ve:return h=lo(31,w,g,F),h.elementType=Ve,h.lanes=q,h;case Ye:return wu(w.children,F,q,g);case Xe:ce=8,F|=24;break;case st:return h=lo(12,w,g,F|2),h.elementType=st,h.lanes=q,h;case fn:return h=lo(13,w,g,F),h.elementType=fn,h.lanes=q,h;case St:return h=lo(19,w,g,F),h.elementType=St,h.lanes=q,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case ht:ce=10;break e;case ft:ce=9;break e;case Ft:ce=11;break e;case je:ce=14;break e;case ze:ce=16,R=null;break e}ce=29,w=Error(u(130,h===null?"null":typeof h,"")),R=null}return g=lo(ce,w,g,F),g.elementType=h,g.type=R,g.lanes=q,g}function wu(h,g,w,R){return h=lo(7,h,R,g),h.lanes=w,h}function ud(h,g,w){return h=lo(6,h,null,g),h.lanes=w,h}function w_(h){var g=lo(18,null,null,0);return g.stateNode=h,g}function Pp(h,g,w){return g=lo(4,h.children!==null?h.children:[],h.key,g),g.lanes=w,g.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},g}var kp=new WeakMap;function oa(h,g){if(typeof h=="object"&&h!==null){var w=kp.get(h);return w!==void 0?w:(g={value:h,source:g,stack:ui(g)},kp.set(h,g),g)}return{value:h,source:g,stack:ui(g)}}var si=[],hd=0,Lp=null,vf=0,zo=[],ml=0,Hi=null,fc=1,Ol="";function Nl(h,g){si[hd++]=vf,si[hd++]=Lp,Lp=h,vf=g}function bf(h,g,w){zo[ml++]=fc,zo[ml++]=Ol,zo[ml++]=Hi,Hi=h;var R=fc;h=Ol;var F=32-Vi(R)-1;R&=~(1<<F),w+=1;var q=32-Vi(g)+F;if(30<q){var ce=F-F%5;q=(R&(1<<ce)-1).toString(32),R>>=ce,F-=ce,fc=1<<32-Vi(g)+F|w<<F|R,Ol=q+h}else fc=1<<q|w<<F|R,Ol=h}function wf(h){h.return!==null&&(Nl(h,1),bf(h,1,0))}function Hc(h){for(;h===Lp;)Lp=si[--hd],si[hd]=null,vf=si[--hd],si[hd]=null;for(;h===Hi;)Hi=zo[--ml],zo[ml]=null,Ol=zo[--ml],zo[ml]=null,fc=zo[--ml],zo[ml]=null}function fh(h,g){zo[ml++]=fc,zo[ml++]=Ol,zo[ml++]=Hi,fc=g.id,Ol=g.overflow,Hi=h}var js=null,Gr=null,pr=!1,pc=null,Jo=!1,Tu=Error(u(519));function Bl(h){var g=Error(u(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw dd(oa(g,h)),Tu}function Tf(h){var g=h.stateNode,w=h.type,R=h.memoizedProps;switch(g[De]=h,g[xe]=R,w){case"dialog":or("cancel",g),or("close",g);break;case"iframe":case"object":case"embed":or("load",g);break;case"video":case"audio":for(w=0;w<Gd.length;w++)or(Gd[w],g);break;case"source":or("error",g);break;case"img":case"image":case"link":or("error",g),or("load",g);break;case"details":or("toggle",g);break;case"input":or("invalid",g),aa(g,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0);break;case"select":or("invalid",g);break;case"textarea":or("invalid",g),dl(g,R.value,R.defaultValue,R.children)}w=R.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||g.textContent===""+w||R.suppressHydrationWarning===!0||u0(g.textContent,w)?(R.popover!=null&&(or("beforetoggle",g),or("toggle",g)),R.onScroll!=null&&or("scroll",g),R.onScrollEnd!=null&&or("scrollend",g),R.onClick!=null&&(g.onclick=Ss),g=!0):g=!1,g||Bl(h,!0)}function zp(h){for(js=h.return;js;)switch(js.tag){case 5:case 31:case 13:Jo=!1;return;case 27:case 3:Jo=!0;return;default:js=js.return}}function $c(h){if(h!==js)return!1;if(!pr)return zp(h),pr=!0,!1;var g=h.tag,w;if((w=g!==3&&g!==27)&&((w=g===5)&&(w=h.type,w=!(w!=="form"&&w!=="button")||Gu(h.type,h.memoizedProps)),w=!w),w&&Gr&&Bl(h),zp(h),g===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(317));Gr=g0(h)}else if(g===31){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(317));Gr=g0(h)}else g===27?(g=Gr,Ql(h.type)?(h=Dg,Dg=null,Gr=h):Gr=g):Gr=js?Ic(h.stateNode.nextSibling):null;return!0}function Fl(){Gr=js=null,pr=!1}function Op(){var h=pc;return h!==null&&($t===null?$t=h:$t.push.apply($t,h),pc=null),h}function dd(h){pc===null?pc=[h]:pc.push(h)}var Np=dt(null),gl=null,mc=null;function Eu(h,g,w){Ne(Np,g._currentValue),g._currentValue=w}function Zc(h){h._currentValue=Np.current,Kt(Np)}function Ym(h,g,w){for(;h!==null;){var R=h.alternate;if((h.childLanes&g)!==g?(h.childLanes|=g,R!==null&&(R.childLanes|=g)):R!==null&&(R.childLanes&g)!==g&&(R.childLanes|=g),h===w)break;h=h.return}}function Ef(h,g,w,R){var F=h.child;for(F!==null&&(F.return=h);F!==null;){var q=F.dependencies;if(q!==null){var ce=F.child;q=q.firstContext;e:for(;q!==null;){var Re=q;q=F;for(var ct=0;ct<g.length;ct++)if(Re.context===g[ct]){q.lanes|=w,Re=q.alternate,Re!==null&&(Re.lanes|=w),Ym(q.return,w,h),R||(ce=null);break e}q=Re.next}}else if(F.tag===18){if(ce=F.return,ce===null)throw Error(u(341));ce.lanes|=w,q=ce.alternate,q!==null&&(q.lanes|=w),Ym(ce,w,h),ce=null}else ce=F.child;if(ce!==null)ce.return=F;else for(ce=F;ce!==null;){if(ce===h){ce=null;break}if(F=ce.sibling,F!==null){F.return=ce.return,ce=F;break}ce=ce.return}F=ce}}function Su(h,g,w,R){h=null;for(var F=g,q=!1;F!==null;){if(!q){if((F.flags&524288)!==0)q=!0;else if((F.flags&262144)!==0)break}if(F.tag===10){var ce=F.alternate;if(ce===null)throw Error(u(387));if(ce=ce.memoizedProps,ce!==null){var Re=F.type;oo(F.pendingProps.value,ce.value)||(h!==null?h.push(Re):h=[Re])}}else if(F===Ci.current){if(ce=F.alternate,ce===null)throw Error(u(387));ce.memoizedState.memoizedState!==F.memoizedState.memoizedState&&(h!==null?h.push(Rc):h=[Rc])}F=F.return}h!==null&&Ef(g,h,w,R),g.flags|=262144}function fd(h){for(h=h.firstContext;h!==null;){if(!oo(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function Wc(h){gl=h,mc=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function ba(h){return Sf(gl,h)}function ph(h,g){return gl===null&&Wc(h),Sf(h,g)}function Sf(h,g){var w=g._currentValue;if(g={context:g,memoizedValue:w,next:null},mc===null){if(h===null)throw Error(u(308));mc=g,h.dependencies={lanes:0,firstContext:g},h.flags|=524288}else mc=mc.next=g;return w}var pd=typeof AbortController<"u"?AbortController:function(){var h=[],g=this.signal={aborted:!1,addEventListener:function(w,R){h.push(R)}};this.abort=function(){g.aborted=!0,h.forEach(function(w){return w()})}},Af=o.unstable_scheduleCallback,T_=o.unstable_NormalPriority,Ar={$$typeof:ht,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new pd,data:new Map,refCount:0}}function Xc(h){h.refCount--,h.refCount===0&&Af(T_,function(){h.controller.abort()})}var el=null,gd=0,Yc=0,Au=null;function _d(h,g){if(el===null){var w=el=[];gd=0,Yc=Eg(),Au={status:"pending",value:void 0,then:function(R){w.push(R)}}}return gd++,g.then(yd,yd),g}function yd(){if(--gd===0&&el!==null){Au!==null&&(Au.status="fulfilled");var h=el;el=null,Yc=0,Au=null;for(var g=0;g<h.length;g++)(0,h[g])()}}function If(h,g){var w=[],R={status:"pending",value:null,reason:null,then:function(F){w.push(F)}};return h.then(function(){R.status="fulfilled",R.value=g;for(var F=0;F<w.length;F++)(0,w[F])(g)},function(F){for(R.status="rejected",R.reason=F,F=0;F<w.length;F++)(0,w[F])(void 0)}),R}var Cf=wt.S;wt.S=function(h,g){Mn=Ur(),typeof g=="object"&&g!==null&&typeof g.then=="function"&&_d(h,g),Cf!==null&&Cf(h,g)};var Kc=dt(null);function Rf(){var h=Kc.current;return h!==null?h:Fe.pooledCache}function xd(h,g){g===null?Ne(Kc,Kc.current):Ne(Kc,g.pool)}function mh(){var h=Rf();return h===null?null:{parent:Ar._currentValue,pool:h}}var vd=Error(u(460)),Km=Error(u(474)),Mf=Error(u(542)),Df={then:function(){}};function Pf(h){return h=h.status,h==="fulfilled"||h==="rejected"}function E_(h,g,w){switch(w=h[w],w===void 0?h.push(g):w!==g&&(g.then(Ss,Ss),g=w),g.status){case"fulfilled":return g.value;case"rejected":throw h=g.reason,Iu(h),h;default:if(typeof g.status=="string")g.then(Ss,Ss);else{if(h=Fe,h!==null&&100<h.shellSuspendCounter)throw Error(u(482));h=g,h.status="pending",h.then(function(R){if(g.status==="pending"){var F=g;F.status="fulfilled",F.value=R}},function(R){if(g.status==="pending"){var F=g;F.status="rejected",F.reason=R}})}switch(g.status){case"fulfilled":return g.value;case"rejected":throw h=g.reason,Iu(h),h}throw Qc=g,vd}}function gc(h){try{var g=h._init;return g(h._payload)}catch(w){throw w!==null&&typeof w=="object"&&typeof w.then=="function"?(Qc=w,vd):w}}var Qc=null;function Qm(){if(Qc===null)throw Error(u(459));var h=Qc;return Qc=null,h}function Iu(h){if(h===vd||h===Mf)throw Error(u(483))}var Cu=null,bd=0;function kf(h){var g=bd;return bd+=1,Cu===null&&(Cu=[]),E_(Cu,h,g)}function gh(h,g){g=g.props.ref,h.ref=g!==void 0?g:null}function Vl(h,g){throw g.$$typeof===oe?Error(u(525)):(h=Object.prototype.toString.call(g),Error(u(31,h==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":h)))}function Ru(h){function g(Rt,gt){if(h){var Nt=Rt.deletions;Nt===null?(Rt.deletions=[gt],Rt.flags|=16):Nt.push(gt)}}function w(Rt,gt){if(!h)return null;for(;gt!==null;)g(Rt,gt),gt=gt.sibling;return null}function R(Rt){for(var gt=new Map;Rt!==null;)Rt.key!==null?gt.set(Rt.key,Rt):gt.set(Rt.index,Rt),Rt=Rt.sibling;return gt}function F(Rt,gt){return Rt=co(Rt,gt),Rt.index=0,Rt.sibling=null,Rt}function q(Rt,gt,Nt){return Rt.index=Nt,h?(Nt=Rt.alternate,Nt!==null?(Nt=Nt.index,Nt<gt?(Rt.flags|=67108866,gt):Nt):(Rt.flags|=67108866,gt)):(Rt.flags|=1048576,gt)}function ce(Rt){return h&&Rt.alternate===null&&(Rt.flags|=67108866),Rt}function Re(Rt,gt,Nt,ln){return gt===null||gt.tag!==6?(gt=ud(Nt,Rt.mode,ln),gt.return=Rt,gt):(gt=F(gt,Nt),gt.return=Rt,gt)}function ct(Rt,gt,Nt,ln){var gi=Nt.type;return gi===Ye?sn(Rt,gt,Nt.props.children,ln,Nt.key):gt!==null&&(gt.elementType===gi||typeof gi=="object"&&gi!==null&&gi.$$typeof===ze&&gc(gi)===gt.type)?(gt=F(gt,Nt.props),gh(gt,Nt),gt.return=Rt,gt):(gt=dh(Nt.type,Nt.key,Nt.props,null,Rt.mode,ln),gh(gt,Nt),gt.return=Rt,gt)}function Vt(Rt,gt,Nt,ln){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==Nt.containerInfo||gt.stateNode.implementation!==Nt.implementation?(gt=Pp(Nt,Rt.mode,ln),gt.return=Rt,gt):(gt=F(gt,Nt.children||[]),gt.return=Rt,gt)}function sn(Rt,gt,Nt,ln,gi){return gt===null||gt.tag!==7?(gt=wu(Nt,Rt.mode,ln,gi),gt.return=Rt,gt):(gt=F(gt,Nt),gt.return=Rt,gt)}function un(Rt,gt,Nt){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return gt=ud(""+gt,Rt.mode,Nt),gt.return=Rt,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case he:return Nt=dh(gt.type,gt.key,gt.props,null,Rt.mode,Nt),gh(Nt,gt),Nt.return=Rt,Nt;case Je:return gt=Pp(gt,Rt.mode,Nt),gt.return=Rt,gt;case ze:return gt=gc(gt),un(Rt,gt,Nt)}if(dn(gt)||et(gt))return gt=wu(gt,Rt.mode,Nt,null),gt.return=Rt,gt;if(typeof gt.then=="function")return un(Rt,kf(gt),Nt);if(gt.$$typeof===ht)return un(Rt,ph(Rt,gt),Nt);Vl(Rt,gt)}return null}function Ut(Rt,gt,Nt,ln){var gi=gt!==null?gt.key:null;if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number"||typeof Nt=="bigint")return gi!==null?null:Re(Rt,gt,""+Nt,ln);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case he:return Nt.key===gi?ct(Rt,gt,Nt,ln):null;case Je:return Nt.key===gi?Vt(Rt,gt,Nt,ln):null;case ze:return Nt=gc(Nt),Ut(Rt,gt,Nt,ln)}if(dn(Nt)||et(Nt))return gi!==null?null:sn(Rt,gt,Nt,ln,null);if(typeof Nt.then=="function")return Ut(Rt,gt,kf(Nt),ln);if(Nt.$$typeof===ht)return Ut(Rt,gt,ph(Rt,Nt),ln);Vl(Rt,Nt)}return null}function Yt(Rt,gt,Nt,ln,gi){if(typeof ln=="string"&&ln!==""||typeof ln=="number"||typeof ln=="bigint")return Rt=Rt.get(Nt)||null,Re(gt,Rt,""+ln,gi);if(typeof ln=="object"&&ln!==null){switch(ln.$$typeof){case he:return Rt=Rt.get(ln.key===null?Nt:ln.key)||null,ct(gt,Rt,ln,gi);case Je:return Rt=Rt.get(ln.key===null?Nt:ln.key)||null,Vt(gt,Rt,ln,gi);case ze:return ln=gc(ln),Yt(Rt,gt,Nt,ln,gi)}if(dn(ln)||et(ln))return Rt=Rt.get(Nt)||null,sn(gt,Rt,ln,gi,null);if(typeof ln.then=="function")return Yt(Rt,gt,Nt,kf(ln),gi);if(ln.$$typeof===ht)return Yt(Rt,gt,Nt,ph(gt,ln),gi);Vl(gt,ln)}return null}function Wn(Rt,gt,Nt,ln){for(var gi=null,Or=null,ni=gt,tr=gt=0,xr=null;ni!==null&&tr<Nt.length;tr++){ni.index>tr?(xr=ni,ni=null):xr=ni.sibling;var Rr=Ut(Rt,ni,Nt[tr],ln);if(Rr===null){ni===null&&(ni=xr);break}h&&ni&&Rr.alternate===null&&g(Rt,ni),gt=q(Rr,gt,tr),Or===null?gi=Rr:Or.sibling=Rr,Or=Rr,ni=xr}if(tr===Nt.length)return w(Rt,ni),pr&&Nl(Rt,tr),gi;if(ni===null){for(;tr<Nt.length;tr++)ni=un(Rt,Nt[tr],ln),ni!==null&&(gt=q(ni,gt,tr),Or===null?gi=ni:Or.sibling=ni,Or=ni);return pr&&Nl(Rt,tr),gi}for(ni=R(ni);tr<Nt.length;tr++)xr=Yt(ni,Rt,tr,Nt[tr],ln),xr!==null&&(h&&xr.alternate!==null&&ni.delete(xr.key===null?tr:xr.key),gt=q(xr,gt,tr),Or===null?gi=xr:Or.sibling=xr,Or=xr);return h&&ni.forEach(function(cu){return g(Rt,cu)}),pr&&Nl(Rt,tr),gi}function fi(Rt,gt,Nt,ln){if(Nt==null)throw Error(u(151));for(var gi=null,Or=null,ni=gt,tr=gt=0,xr=null,Rr=Nt.next();ni!==null&&!Rr.done;tr++,Rr=Nt.next()){ni.index>tr?(xr=ni,ni=null):xr=ni.sibling;var cu=Ut(Rt,ni,Rr.value,ln);if(cu===null){ni===null&&(ni=xr);break}h&&ni&&cu.alternate===null&&g(Rt,ni),gt=q(cu,gt,tr),Or===null?gi=cu:Or.sibling=cu,Or=cu,ni=xr}if(Rr.done)return w(Rt,ni),pr&&Nl(Rt,tr),gi;if(ni===null){for(;!Rr.done;tr++,Rr=Nt.next())Rr=un(Rt,Rr.value,ln),Rr!==null&&(gt=q(Rr,gt,tr),Or===null?gi=Rr:Or.sibling=Rr,Or=Rr);return pr&&Nl(Rt,tr),gi}for(ni=R(ni);!Rr.done;tr++,Rr=Nt.next())Rr=Yt(ni,Rt,tr,Rr.value,ln),Rr!==null&&(h&&Rr.alternate!==null&&ni.delete(Rr.key===null?tr:Rr.key),gt=q(Rr,gt,tr),Or===null?gi=Rr:Or.sibling=Rr,Or=Rr);return h&&ni.forEach(function(P0){return g(Rt,P0)}),pr&&Nl(Rt,tr),gi}function Zr(Rt,gt,Nt,ln){if(typeof Nt=="object"&&Nt!==null&&Nt.type===Ye&&Nt.key===null&&(Nt=Nt.props.children),typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case he:e:{for(var gi=Nt.key;gt!==null;){if(gt.key===gi){if(gi=Nt.type,gi===Ye){if(gt.tag===7){w(Rt,gt.sibling),ln=F(gt,Nt.props.children),ln.return=Rt,Rt=ln;break e}}else if(gt.elementType===gi||typeof gi=="object"&&gi!==null&&gi.$$typeof===ze&&gc(gi)===gt.type){w(Rt,gt.sibling),ln=F(gt,Nt.props),gh(ln,Nt),ln.return=Rt,Rt=ln;break e}w(Rt,gt);break}else g(Rt,gt);gt=gt.sibling}Nt.type===Ye?(ln=wu(Nt.props.children,Rt.mode,ln,Nt.key),ln.return=Rt,Rt=ln):(ln=dh(Nt.type,Nt.key,Nt.props,null,Rt.mode,ln),gh(ln,Nt),ln.return=Rt,Rt=ln)}return ce(Rt);case Je:e:{for(gi=Nt.key;gt!==null;){if(gt.key===gi)if(gt.tag===4&&gt.stateNode.containerInfo===Nt.containerInfo&&gt.stateNode.implementation===Nt.implementation){w(Rt,gt.sibling),ln=F(gt,Nt.children||[]),ln.return=Rt,Rt=ln;break e}else{w(Rt,gt);break}else g(Rt,gt);gt=gt.sibling}ln=Pp(Nt,Rt.mode,ln),ln.return=Rt,Rt=ln}return ce(Rt);case ze:return Nt=gc(Nt),Zr(Rt,gt,Nt,ln)}if(dn(Nt))return Wn(Rt,gt,Nt,ln);if(et(Nt)){if(gi=et(Nt),typeof gi!="function")throw Error(u(150));return Nt=gi.call(Nt),fi(Rt,gt,Nt,ln)}if(typeof Nt.then=="function")return Zr(Rt,gt,kf(Nt),ln);if(Nt.$$typeof===ht)return Zr(Rt,gt,ph(Rt,Nt),ln);Vl(Rt,Nt)}return typeof Nt=="string"&&Nt!==""||typeof Nt=="number"||typeof Nt=="bigint"?(Nt=""+Nt,gt!==null&&gt.tag===6?(w(Rt,gt.sibling),ln=F(gt,Nt),ln.return=Rt,Rt=ln):(w(Rt,gt),ln=ud(Nt,Rt.mode,ln),ln.return=Rt,Rt=ln),ce(Rt)):w(Rt,gt)}return function(Rt,gt,Nt,ln){try{bd=0;var gi=Zr(Rt,gt,Nt,ln);return Cu=null,gi}catch(ni){if(ni===vd||ni===Mf)throw ni;var Or=lo(29,ni,null,Rt.mode);return Or.lanes=ln,Or.return=Rt,Or}finally{}}}var _c=Ru(!0),Jm=Ru(!1),uo=!1;function Lf(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wd(h,g){h=h.updateQueue,g.updateQueue===h&&(g.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function yc(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function Jc(h,g,w){var R=h.updateQueue;if(R===null)return null;if(R=R.shared,(Le&2)!==0){var F=R.pending;return F===null?g.next=g:(g.next=F.next,F.next=g),R.pending=g,g=cd(h),Dp(h,null,w),g}return Za(h,R,g,w),cd(h)}function _h(h,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194048)!==0)){var R=g.lanes;R&=h.pendingLanes,w|=R,g.lanes=w,th(h,w)}}function Td(h,g){var w=h.updateQueue,R=h.alternate;if(R!==null&&(R=R.updateQueue,w===R)){var F=null,q=null;if(w=w.firstBaseUpdate,w!==null){do{var ce={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};q===null?F=q=ce:q=q.next=ce,w=w.next}while(w!==null);q===null?F=q=g:q=q.next=g}else F=q=g;w={baseState:R.baseState,firstBaseUpdate:F,lastBaseUpdate:q,shared:R.shared,callbacks:R.callbacks},h.updateQueue=w;return}h=w.lastBaseUpdate,h===null?w.firstBaseUpdate=g:h.next=g,w.lastBaseUpdate=g}var Bp=!1;function yh(){if(Bp){var h=Au;if(h!==null)throw h}}function eu(h,g,w,R){Bp=!1;var F=h.updateQueue;uo=!1;var q=F.firstBaseUpdate,ce=F.lastBaseUpdate,Re=F.shared.pending;if(Re!==null){F.shared.pending=null;var ct=Re,Vt=ct.next;ct.next=null,ce===null?q=Vt:ce.next=Vt,ce=ct;var sn=h.alternate;sn!==null&&(sn=sn.updateQueue,Re=sn.lastBaseUpdate,Re!==ce&&(Re===null?sn.firstBaseUpdate=Vt:Re.next=Vt,sn.lastBaseUpdate=ct))}if(q!==null){var un=F.baseState;ce=0,sn=Vt=ct=null,Re=q;do{var Ut=Re.lane&-536870913,Yt=Ut!==Re.lane;if(Yt?($e&Ut)===Ut:(R&Ut)===Ut){Ut!==0&&Ut===Yc&&(Bp=!0),sn!==null&&(sn=sn.next={lane:0,tag:Re.tag,payload:Re.payload,callback:null,next:null});e:{var Wn=h,fi=Re;Ut=g;var Zr=w;switch(fi.tag){case 1:if(Wn=fi.payload,typeof Wn=="function"){un=Wn.call(Zr,un,Ut);break e}un=Wn;break e;case 3:Wn.flags=Wn.flags&-65537|128;case 0:if(Wn=fi.payload,Ut=typeof Wn=="function"?Wn.call(Zr,un,Ut):Wn,Ut==null)break e;un=Q({},un,Ut);break e;case 2:uo=!0}}Ut=Re.callback,Ut!==null&&(h.flags|=64,Yt&&(h.flags|=8192),Yt=F.callbacks,Yt===null?F.callbacks=[Ut]:Yt.push(Ut))}else Yt={lane:Ut,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null},sn===null?(Vt=sn=Yt,ct=un):sn=sn.next=Yt,ce|=Ut;if(Re=Re.next,Re===null){if(Re=F.shared.pending,Re===null)break;Yt=Re,Re=Yt.next,Yt.next=null,F.lastBaseUpdate=Yt,F.shared.pending=null}}while(!0);sn===null&&(ct=un),F.baseState=ct,F.firstBaseUpdate=Vt,F.lastBaseUpdate=sn,q===null&&(F.shared.lanes=0),Pt|=ce,h.lanes=ce,h.memoizedState=un}}function xh(h,g){if(typeof h!="function")throw Error(u(191,h));h.call(g)}function S_(h,g){var w=h.callbacks;if(w!==null)for(h.callbacks=null,h=0;h<w.length;h++)xh(w[h],g)}var vh=dt(null),Fp=dt(0);function zf(h,g){h=nt,Ne(Fp,h),Ne(vh,g),nt=h|g.baseLanes}function bh(){Ne(Fp,nt),Ne(vh,vh.current)}function xc(){nt=Fp.current,Kt(vh),Kt(Fp)}var Da=dt(null),wa=null;function jl(h){var g=h.alternate;Ne(Us,Us.current&1),Ne(Da,h),wa===null&&(g===null||vh.current!==null||g.memoizedState!==null)&&(wa=h)}function wh(h){Ne(Us,Us.current),Ne(Da,h),wa===null&&(wa=h)}function Of(h){h.tag===22?(Ne(Us,Us.current),Ne(Da,h),wa===null&&(wa=h)):Pa()}function Pa(){Ne(Us,Us.current),Ne(Da,Da.current)}function Oo(h){Kt(Da),wa===h&&(wa=null),Kt(Us)}var Us=dt(0);function vc(h){for(var g=h;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||hx(w)||dx(w)))return g}else if(g.tag===19&&(g.memoizedProps.revealOrder==="forwards"||g.memoizedProps.revealOrder==="backwards"||g.memoizedProps.revealOrder==="unstable_legacy-backwards"||g.memoizedProps.revealOrder==="together")){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var _l=0,Bt=null,qr=null,Hr=null,yl=!1,Th=!1,Mu=!1,Eh=0,Du=0,Pu=null,eg=0;function ns(){throw Error(u(321))}function ku(h,g){if(g===null)return!1;for(var w=0;w<g.length&&w<h.length;w++)if(!oo(h[w],g[w]))return!1;return!0}function Sh(h,g,w,R,F,q){return _l=q,Bt=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,wt.H=h===null||h.memoizedState===null?Qp:Zf,Mu=!1,q=w(R,F),Mu=!1,Th&&(q=tg(g,w,R,F)),Ul(h),q}function Ul(h){wt.H=ql;var g=qr!==null&&qr.next!==null;if(_l=0,Hr=qr=Bt=null,yl=!1,Du=0,Pu=null,g)throw Error(u(300));h===null||Ms||(h=h.dependencies,h!==null&&fd(h)&&(Ms=!0))}function tg(h,g,w,R){Bt=h;var F=0;do{if(Th&&(Pu=null),Du=0,Th=!1,25<=F)throw Error(u(301));if(F+=1,Hr=qr=null,h.updateQueue!=null){var q=h.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}wt.H=fg,q=g(w,R)}while(Th);return q}function A_(){var h=wt.H,g=h.useState()[0];return g=typeof g.then=="function"?Lu(g):g,h=h.useState()[0],(qr!==null?qr.memoizedState:null)!==h&&(Bt.flags|=1024),g}function Vp(){var h=Eh!==0;return Eh=0,h}function jp(h,g,w){g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~w}function Nf(h){if(yl){for(h=h.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}yl=!1}_l=0,Hr=qr=Bt=null,Th=!1,Du=Eh=0,Pu=null}function Qs(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hr===null?Bt.memoizedState=Hr=h:Hr=Hr.next=h,Hr}function ys(){if(qr===null){var h=Bt.alternate;h=h!==null?h.memoizedState:null}else h=qr.next;var g=Hr===null?Bt.memoizedState:Hr.next;if(g!==null)Hr=g,qr=h;else{if(h===null)throw Bt.alternate===null?Error(u(467)):Error(u(310));qr=h,h={memoizedState:qr.memoizedState,baseState:qr.baseState,baseQueue:qr.baseQueue,queue:qr.queue,next:null},Hr===null?Bt.memoizedState=Hr=h:Hr=Hr.next=h}return Hr}function Ed(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Lu(h){var g=Du;return Du+=1,Pu===null&&(Pu=[]),h=E_(Pu,h,g),g=Bt,(Hr===null?g.memoizedState:Hr.next)===null&&(g=g.alternate,wt.H=g===null||g.memoizedState===null?Qp:Zf),h}function Bf(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return Lu(h);if(h.$$typeof===ht)return ba(h)}throw Error(u(438,String(h)))}function Up(h){var g=null,w=Bt.updateQueue;if(w!==null&&(g=w.memoCache),g==null){var R=Bt.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(g={data:R.data.map(function(F){return F.slice()}),index:0})))}if(g==null&&(g={data:[],index:0}),w===null&&(w=Ed(),Bt.updateQueue=w),w.memoCache=g,w=g.data[g.index],w===void 0)for(w=g.data[g.index]=Array(h),R=0;R<h;R++)w[R]=Ke;return g.index++,w}function Gl(h,g){return typeof g=="function"?g(h):g}function Ff(h){var g=ys();return Vf(g,qr,h)}function Vf(h,g,w){var R=h.queue;if(R===null)throw Error(u(311));R.lastRenderedReducer=w;var F=h.baseQueue,q=R.pending;if(q!==null){if(F!==null){var ce=F.next;F.next=q.next,q.next=ce}g.baseQueue=F=q,R.pending=null}if(q=h.baseState,F===null)h.memoizedState=q;else{g=F.next;var Re=ce=null,ct=null,Vt=g,sn=!1;do{var un=Vt.lane&-536870913;if(un!==Vt.lane?($e&un)===un:(_l&un)===un){var Ut=Vt.revertLane;if(Ut===0)ct!==null&&(ct=ct.next={lane:0,revertLane:0,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),un===Yc&&(sn=!0);else if((_l&Ut)===Ut){Vt=Vt.next,Ut===Yc&&(sn=!0);continue}else un={lane:0,revertLane:Vt.revertLane,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},ct===null?(Re=ct=un,ce=q):ct=ct.next=un,Bt.lanes|=Ut,Pt|=Ut;un=Vt.action,Mu&&w(q,un),q=Vt.hasEagerState?Vt.eagerState:w(q,un)}else Ut={lane:un,revertLane:Vt.revertLane,gesture:Vt.gesture,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},ct===null?(Re=ct=Ut,ce=q):ct=ct.next=Ut,Bt.lanes|=un,Pt|=un;Vt=Vt.next}while(Vt!==null&&Vt!==g);if(ct===null?ce=q:ct.next=Re,!oo(q,h.memoizedState)&&(Ms=!0,sn&&(w=Au,w!==null)))throw w;h.memoizedState=q,h.baseState=ce,h.baseQueue=ct,R.lastRenderedState=q}return F===null&&(R.lanes=0),[h.memoizedState,R.dispatch]}function Gp(h){var g=ys(),w=g.queue;if(w===null)throw Error(u(311));w.lastRenderedReducer=h;var R=w.dispatch,F=w.pending,q=g.memoizedState;if(F!==null){w.pending=null;var ce=F=F.next;do q=h(q,ce.action),ce=ce.next;while(ce!==F);oo(q,g.memoizedState)||(Ms=!0),g.memoizedState=q,g.baseQueue===null&&(g.baseState=q),w.lastRenderedState=q}return[q,R]}function qp(h,g,w){var R=Bt,F=ys(),q=pr;if(q){if(w===void 0)throw Error(u(407));w=w()}else w=g();var ce=!oo((qr||F).memoizedState,w);if(ce&&(F.memoizedState=w,Ms=!0),F=F.queue,Ah(I_.bind(null,R,F,h),[h]),F.getSnapshot!==g||ce||Hr!==null&&Hr.memoizedState.tag&1){if(R.flags|=2048,zu(9,{destroy:void 0},$p.bind(null,R,F,w,g),null),Fe===null)throw Error(u(349));q||(_l&127)!==0||Hp(R,g,w)}return w}function Hp(h,g,w){h.flags|=16384,h={getSnapshot:g,value:w},g=Bt.updateQueue,g===null?(g=Ed(),Bt.updateQueue=g,g.stores=[h]):(w=g.stores,w===null?g.stores=[h]:w.push(h))}function $p(h,g,w,R){g.value=w,g.getSnapshot=R,C_(g)&&ng(h)}function I_(h,g,w){return w(function(){C_(g)&&ng(h)})}function C_(h){var g=h.getSnapshot;h=h.value;try{var w=g();return!oo(h,w)}catch{return!0}}function ng(h){var g=jt(h,2);g!==null&&Bn(g,h,2)}function bc(h){var g=Qs();if(typeof h=="function"){var w=h;if(h=w(),Mu){yr(!0);try{w()}finally{yr(!1)}}}return g.memoizedState=g.baseState=h,g.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:h},g}function ig(h,g,w,R){return h.baseState=w,Vf(h,qr,typeof R=="function"?R:Gl)}function rg(h,g,w,R,F){if(Hf(h))throw Error(u(485));if(h=g.action,h!==null){var q={payload:F,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ce){q.listeners.push(ce)}};wt.T!==null?w(!0):q.isTransition=!1,R(q),w=g.pending,w===null?(q.next=g.pending=q,jf(g,q)):(q.next=w.next,g.pending=w.next=q)}}function jf(h,g){var w=g.action,R=g.payload,F=h.state;if(g.isTransition){var q=wt.T,ce={};wt.T=ce;try{var Re=w(F,R),ct=wt.S;ct!==null&&ct(ce,Re),sg(h,g,Re)}catch(Vt){wc(h,g,Vt)}finally{q!==null&&ce.types!==null&&(q.types=ce.types),wt.T=q}}else try{q=w(F,R),sg(h,g,q)}catch(Vt){wc(h,g,Vt)}}function sg(h,g,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(R){R_(h,g,R)},function(R){return wc(h,g,R)}):R_(h,g,w)}function R_(h,g,w){g.status="fulfilled",g.value=w,Wa(g),h.state=w,g=h.pending,g!==null&&(w=g.next,w===g?h.pending=null:(w=w.next,g.next=w,jf(h,w)))}function wc(h,g,w){var R=h.pending;if(h.pending=null,R!==null){R=R.next;do g.status="rejected",g.reason=w,Wa(g),g=g.next;while(g!==R)}h.action=null}function Wa(h){h=h.listeners;for(var g=0;g<h.length;g++)(0,h[g])()}function tu(h,g){return g}function ka(h,g){if(pr){var w=Fe.formState;if(w!==null){e:{var R=Bt;if(pr){if(Gr){t:{for(var F=Gr,q=Jo;F.nodeType!==8;){if(!q){F=null;break t}if(F=Ic(F.nextSibling),F===null){F=null;break t}}q=F.data,F=q==="F!"||q==="F"?F:null}if(F){Gr=Ic(F.nextSibling),R=F.data==="F!";break e}}Bl(R)}R=!1}R&&(g=w[0])}}return w=Qs(),w.memoizedState=w.baseState=g,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tu,lastRenderedState:g},w.queue=R,w=Id.bind(null,Bt,R),R.dispatch=w,R=bc(!1),q=qf.bind(null,Bt,!1,R.queue),R=Qs(),F={state:g,dispatch:null,action:h,pending:null},R.queue=F,w=rg.bind(null,Bt,F,q,w),F.dispatch=w,R.memoizedState=h,[g,w,!1]}function nu(h){var g=ys();return ag(g,qr,h)}function ag(h,g,w){if(g=Vf(h,g,tu)[0],h=Ff(Gl)[0],typeof g=="object"&&g!==null&&typeof g.then=="function")try{var R=Lu(g)}catch(ce){throw ce===vd?Mf:ce}else R=g;g=ys();var F=g.queue,q=F.dispatch;return w!==g.memoizedState&&(Bt.flags|=2048,zu(9,{destroy:void 0},og.bind(null,F,w),null)),[R,q,h]}function og(h,g){h.action=g}function Zp(h){var g=ys(),w=qr;if(w!==null)return ag(g,w,h);ys(),g=g.memoizedState,w=ys();var R=w.queue.dispatch;return w.memoizedState=h,[g,R,!1]}function zu(h,g,w,R){return h={tag:h,create:w,deps:R,inst:g,next:null},g=Bt.updateQueue,g===null&&(g=Ed(),Bt.updateQueue=g),w=g.lastEffect,w===null?g.lastEffect=h.next=h:(R=w.next,w.next=h,h.next=R,g.lastEffect=h),h}function Wp(){return ys().memoizedState}function No(h,g,w,R){var F=Qs();Bt.flags|=h,F.memoizedState=zu(1|g,{destroy:void 0},w,R===void 0?null:R)}function Pi(h,g,w,R){var F=ys();R=R===void 0?null:R;var q=F.memoizedState.inst;qr!==null&&R!==null&&ku(R,qr.memoizedState.deps)?F.memoizedState=zu(g,q,w,R):(Bt.flags|=h,F.memoizedState=zu(1|g,q,w,R))}function Sd(h,g){No(8390656,8,h,g)}function Ah(h,g){Pi(2048,8,h,g)}function Ad(h){Bt.flags|=4;var g=Bt.updateQueue;if(g===null)g=Ed(),Bt.updateQueue=g,g.events=[h];else{var w=g.events;w===null?g.events=[h]:w.push(h)}}function lg(h){var g=ys().memoizedState;return Ad({ref:g,nextImpl:h}),function(){if((Le&2)!==0)throw Error(u(440));return g.impl.apply(void 0,arguments)}}function cg(h,g){return Pi(4,2,h,g)}function Xp(h,g){return Pi(4,4,h,g)}function Ou(h,g){if(typeof g=="function"){h=h();var w=g(h);return function(){typeof w=="function"?w():g(null)}}if(g!=null)return h=h(),g.current=h,function(){g.current=null}}function La(h,g,w){w=w!=null?w.concat([h]):null,Pi(4,4,Ou.bind(null,g,h),w)}function Ot(){}function Xt(h,g){var w=ys();g=g===void 0?null:g;var R=w.memoizedState;return g!==null&&ku(g,R[1])?R[0]:(w.memoizedState=[h,g],h)}function Ih(h,g){var w=ys();g=g===void 0?null:g;var R=w.memoizedState;if(g!==null&&ku(g,R[1]))return R[0];if(R=h(),Mu){yr(!0);try{h()}finally{yr(!1)}}return w.memoizedState=[R,g],R}function wr(h,g,w){return w===void 0||(_l&1073741824)!==0&&($e&261930)===0?h.memoizedState=g:(h.memoizedState=w,h=Ai(),Bt.lanes|=h,Pt|=h,w)}function Ze(h,g,w,R){return oo(w,g)?w:vh.current!==null?(h=wr(h,w,R),oo(h,g)||(Ms=!0),h):(_l&42)===0||(_l&1073741824)!==0&&($e&261930)===0?(Ms=!0,h.memoizedState=w):(h=Ai(),Bt.lanes|=h,Pt|=h,g)}function ug(h,g,w,R,F){var q=Jt.p;Jt.p=q!==0&&8>q?q:8;var ce=wt.T,Re={};wt.T=Re,qf(h,!1,g,w);try{var ct=F(),Vt=wt.S;if(Vt!==null&&Vt(Re,ct),ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var sn=If(ct,R);Bo(h,g,sn,Li(h))}else Bo(h,g,R,Li(h))}catch(un){Bo(h,g,{then:function(){},status:"rejected",reason:un},Li())}finally{Jt.p=q,ce!==null&&Re.types!==null&&(ce.types=Re.types),wt.T=ce}}function Yp(){}function Uf(h,g,w,R){if(h.tag!==5)throw Error(u(476));var F=Kp(h).queue;ug(h,F,g,En,w===null?Yp:function(){return hg(h),w(R)})}function Kp(h){var g=h.memoizedState;if(g!==null)return g;g={memoizedState:En,baseState:En,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:En},next:null};var w={};return g.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:w},next:null},h.memoizedState=g,h=h.alternate,h!==null&&(h.memoizedState=g),g}function hg(h){var g=Kp(h);g.next===null&&(g=h.alternate.memoizedState),Bo(h,g.next.queue,{},Li())}function Gf(){return ba(Rc)}function Ch(){return ys().memoizedState}function M_(){return ys().memoizedState}function ex(h){for(var g=h.return;g!==null;){switch(g.tag){case 24:case 3:var w=Li();h=yc(w);var R=Jc(g,h,w);R!==null&&(Bn(R,g,w),_h(R,g,w)),g={cache:md()},h.payload=g;return}g=g.return}}function dg(h,g,w){var R=Li();w={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Hf(h)?$f(g,w):(w=hh(h,g,w,R),w!==null&&(Bn(w,h,R),Cd(w,g,R)))}function Id(h,g,w){var R=Li();Bo(h,g,w,R)}function Bo(h,g,w,R){var F={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null};if(Hf(h))$f(g,F);else{var q=h.alternate;if(h.lanes===0&&(q===null||q.lanes===0)&&(q=g.lastRenderedReducer,q!==null))try{var ce=g.lastRenderedState,Re=q(ce,w);if(F.hasEagerState=!0,F.eagerState=Re,oo(Re,ce))return Za(h,g,F,0),Fe===null&&uh(),!1}catch{}finally{}if(w=hh(h,g,F,R),w!==null)return Bn(w,h,R),Cd(w,g,R),!0}return!1}function qf(h,g,w,R){if(R={lane:2,revertLane:Eg(),gesture:null,action:R,hasEagerState:!1,eagerState:null,next:null},Hf(h)){if(g)throw Error(u(479))}else g=hh(h,w,R,2),g!==null&&Bn(g,h,2)}function Hf(h){var g=h.alternate;return h===Bt||g!==null&&g===Bt}function $f(h,g){Th=yl=!0;var w=h.pending;w===null?g.next=g:(g.next=w.next,w.next=g),h.pending=g}function Cd(h,g,w){if((w&4194048)!==0){var R=g.lanes;R&=h.pendingLanes,w|=R,g.lanes=w,th(h,w)}}var ql={readContext:ba,use:Bf,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useInsertionEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useSyncExternalStore:ns,useId:ns,useHostTransitionStatus:ns,useFormState:ns,useActionState:ns,useOptimistic:ns,useMemoCache:ns,useCacheRefresh:ns};ql.useEffectEvent=ns;var Qp={readContext:ba,use:Bf,useCallback:function(h,g){return Qs().memoizedState=[h,g===void 0?null:g],h},useContext:ba,useEffect:Sd,useImperativeHandle:function(h,g,w){w=w!=null?w.concat([h]):null,No(4194308,4,Ou.bind(null,g,h),w)},useLayoutEffect:function(h,g){return No(4194308,4,h,g)},useInsertionEffect:function(h,g){No(4,2,h,g)},useMemo:function(h,g){var w=Qs();g=g===void 0?null:g;var R=h();if(Mu){yr(!0);try{h()}finally{yr(!1)}}return w.memoizedState=[R,g],R},useReducer:function(h,g,w){var R=Qs();if(w!==void 0){var F=w(g);if(Mu){yr(!0);try{w(g)}finally{yr(!1)}}}else F=g;return R.memoizedState=R.baseState=F,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:F},R.queue=h,h=h.dispatch=dg.bind(null,Bt,h),[R.memoizedState,h]},useRef:function(h){var g=Qs();return h={current:h},g.memoizedState=h},useState:function(h){h=bc(h);var g=h.queue,w=Id.bind(null,Bt,g);return g.dispatch=w,[h.memoizedState,w]},useDebugValue:Ot,useDeferredValue:function(h,g){var w=Qs();return wr(w,h,g)},useTransition:function(){var h=bc(!1);return h=ug.bind(null,Bt,h.queue,!0,!1),Qs().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,g,w){var R=Bt,F=Qs();if(pr){if(w===void 0)throw Error(u(407));w=w()}else{if(w=g(),Fe===null)throw Error(u(349));($e&127)!==0||Hp(R,g,w)}F.memoizedState=w;var q={value:w,getSnapshot:g};return F.queue=q,Sd(I_.bind(null,R,q,h),[h]),R.flags|=2048,zu(9,{destroy:void 0},$p.bind(null,R,q,w,g),null),w},useId:function(){var h=Qs(),g=Fe.identifierPrefix;if(pr){var w=Ol,R=fc;w=(R&~(1<<32-Vi(R)-1)).toString(32)+w,g="_"+g+"R_"+w,w=Eh++,0<w&&(g+="H"+w.toString(32)),g+="_"}else w=eg++,g="_"+g+"r_"+w.toString(32)+"_";return h.memoizedState=g},useHostTransitionStatus:Gf,useFormState:ka,useActionState:ka,useOptimistic:function(h){var g=Qs();g.memoizedState=g.baseState=h;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return g.queue=w,g=qf.bind(null,Bt,!0,w),w.dispatch=g,[h,g]},useMemoCache:Up,useCacheRefresh:function(){return Qs().memoizedState=ex.bind(null,Bt)},useEffectEvent:function(h){var g=Qs(),w={impl:h};return g.memoizedState=w,function(){if((Le&2)!==0)throw Error(u(440));return w.impl.apply(void 0,arguments)}}},Zf={readContext:ba,use:Bf,useCallback:Xt,useContext:ba,useEffect:Ah,useImperativeHandle:La,useInsertionEffect:cg,useLayoutEffect:Xp,useMemo:Ih,useReducer:Ff,useRef:Wp,useState:function(){return Ff(Gl)},useDebugValue:Ot,useDeferredValue:function(h,g){var w=ys();return Ze(w,qr.memoizedState,h,g)},useTransition:function(){var h=Ff(Gl)[0],g=ys().memoizedState;return[typeof h=="boolean"?h:Lu(h),g]},useSyncExternalStore:qp,useId:Ch,useHostTransitionStatus:Gf,useFormState:nu,useActionState:nu,useOptimistic:function(h,g){var w=ys();return ig(w,qr,h,g)},useMemoCache:Up,useCacheRefresh:M_};Zf.useEffectEvent=lg;var fg={readContext:ba,use:Bf,useCallback:Xt,useContext:ba,useEffect:Ah,useImperativeHandle:La,useInsertionEffect:cg,useLayoutEffect:Xp,useMemo:Ih,useReducer:Gp,useRef:Wp,useState:function(){return Gp(Gl)},useDebugValue:Ot,useDeferredValue:function(h,g){var w=ys();return qr===null?wr(w,h,g):Ze(w,qr.memoizedState,h,g)},useTransition:function(){var h=Gp(Gl)[0],g=ys().memoizedState;return[typeof h=="boolean"?h:Lu(h),g]},useSyncExternalStore:qp,useId:Ch,useHostTransitionStatus:Gf,useFormState:Zp,useActionState:Zp,useOptimistic:function(h,g){var w=ys();return qr!==null?ig(w,qr,h,g):(w.baseState=h,[h,w.queue.dispatch])},useMemoCache:Up,useCacheRefresh:M_};fg.useEffectEvent=lg;function Jp(h,g,w,R){g=h.memoizedState,w=w(R,g),w=w==null?g:Q({},g,w),h.memoizedState=w,h.lanes===0&&(h.updateQueue.baseState=w)}var em={enqueueSetState:function(h,g,w){h=h._reactInternals;var R=Li(),F=yc(R);F.payload=g,w!=null&&(F.callback=w),g=Jc(h,F,R),g!==null&&(Bn(g,h,R),_h(g,h,R))},enqueueReplaceState:function(h,g,w){h=h._reactInternals;var R=Li(),F=yc(R);F.tag=1,F.payload=g,w!=null&&(F.callback=w),g=Jc(h,F,R),g!==null&&(Bn(g,h,R),_h(g,h,R))},enqueueForceUpdate:function(h,g){h=h._reactInternals;var w=Li(),R=yc(w);R.tag=2,g!=null&&(R.callback=g),g=Jc(h,R,w),g!==null&&(Bn(g,h,w),_h(g,h,w))}};function za(h,g,w,R,F,q,ce){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(R,q,ce):g.prototype&&g.prototype.isPureReactComponent?!Lo(w,R)||!Lo(F,q):!0}function pg(h,g,w,R){h=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,R),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,R),g.state!==h&&em.enqueueReplaceState(g,g.state,null)}function Fo(h,g){var w=g;if("ref"in g){w={};for(var R in g)R!=="ref"&&(w[R]=g[R])}if(h=h.defaultProps){w===g&&(w=Q({},w));for(var F in h)w[F]===void 0&&(w[F]=h[F])}return w}function D_(h){ld(h)}function sr(h){console.error(h)}function ei(h){ld(h)}function Wf(h,g){try{var w=h.onUncaughtError;w(g.value,{componentStack:g.stack})}catch(R){setTimeout(function(){throw R})}}function iu(h,g,w){try{var R=h.onCaughtError;R(w.value,{componentStack:w.stack,errorBoundary:g.tag===1?g.stateNode:null})}catch(F){setTimeout(function(){throw F})}}function Hl(h,g,w){return w=yc(w),w.tag=3,w.payload={element:null},w.callback=function(){Wf(h,g)},w}function Tc(h){return h=yc(h),h.tag=3,h}function Gs(h,g,w,R){var F=w.type.getDerivedStateFromError;if(typeof F=="function"){var q=R.value;h.payload=function(){return F(q)},h.callback=function(){iu(g,w,R)}}var ce=w.stateNode;ce!==null&&typeof ce.componentDidCatch=="function"&&(h.callback=function(){iu(g,w,R),typeof F!="function"&&(Dn===null?Dn=new Set([this]):Dn.add(this));var Re=R.stack;this.componentDidCatch(R.value,{componentStack:Re!==null?Re:""})})}function Rd(h,g,w,R,F){if(w.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(g=w.alternate,g!==null&&Su(g,w,F,!0),w=Da.current,w!==null){switch(w.tag){case 31:case 13:return wa===null?ca():w.alternate===null&&yt===0&&(yt=3),w.flags&=-257,w.flags|=65536,w.lanes=F,R===Df?w.flags|=16384:(g=w.updateQueue,g===null?w.updateQueue=new Set([R]):g.add(R),ou(h,R,F)),!1;case 22:return w.flags|=65536,R===Df?w.flags|=16384:(g=w.updateQueue,g===null?(g={transitions:null,markerInstances:null,retryQueue:new Set([R])},w.updateQueue=g):(w=g.retryQueue,w===null?g.retryQueue=new Set([R]):w.add(R)),ou(h,R,F)),!1}throw Error(u(435,w.tag))}return ou(h,R,F),ca(),!1}if(pr)return g=Da.current,g!==null?((g.flags&65536)===0&&(g.flags|=256),g.flags|=65536,g.lanes=F,R!==Tu&&(h=Error(u(422),{cause:R}),dd(oa(h,w)))):(R!==Tu&&(g=Error(u(423),{cause:R}),dd(oa(g,w))),h=h.current.alternate,h.flags|=65536,F&=-F,h.lanes|=F,R=oa(R,w),F=Hl(h.stateNode,R,F),Td(h,F),yt!==4&&(yt=2)),!1;var q=Error(u(520),{cause:R});if(q=oa(q,w),an===null?an=[q]:an.push(q),yt!==4&&(yt=2),g===null)return!0;R=oa(R,w),w=g;do{switch(w.tag){case 3:return w.flags|=65536,h=F&-F,w.lanes|=h,h=Hl(w.stateNode,R,h),Td(w,h),!1;case 1:if(g=w.type,q=w.stateNode,(w.flags&128)===0&&(typeof g.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Dn===null||!Dn.has(q))))return w.flags|=65536,F&=-F,w.lanes|=F,F=Tc(F),Gs(F,h,w,R),Td(w,F),!1}w=w.return}while(w!==null);return!1}var Xf=Error(u(461)),Ms=!1;function la(h,g,w,R){g.child=h===null?Jm(g,null,w,R):_c(g,h.child,w,R)}function tl(h,g,w,R,F){w=w.render;var q=g.ref;if("ref"in R){var ce={};for(var Re in R)Re!=="ref"&&(ce[Re]=R[Re])}else ce=R;return Wc(g),R=Sh(h,g,w,ce,q,F),Re=Vp(),h!==null&&!Ms?(jp(h,g,F),Wl(h,g,F)):(pr&&Re&&wf(g),g.flags|=1,la(h,g,R,F),g.child)}function $l(h,g,w,R,F){if(h===null){var q=w.type;return typeof q=="function"&&!Gc(q)&&q.defaultProps===void 0&&w.compare===null?(g.tag=15,g.type=q,Rh(h,g,q,R,F)):(h=dh(w.type,null,R,g,g.mode,F),h.ref=g.ref,h.return=g,g.child=h)}if(q=h.child,!Lh(h,F)){var ce=q.memoizedProps;if(w=w.compare,w=w!==null?w:Lo,w(ce,R)&&h.ref===g.ref)return Wl(h,g,F)}return g.flags|=1,h=co(q,R),h.ref=g.ref,h.return=g,g.child=h}function Rh(h,g,w,R,F){if(h!==null){var q=h.memoizedProps;if(Lo(q,R)&&h.ref===g.ref)if(Ms=!1,g.pendingProps=R=q,Lh(h,F))(h.flags&131072)!==0&&(Ms=!0);else return g.lanes=h.lanes,Wl(h,g,F)}return Md(h,g,w,R,F)}function Mh(h,g,w,R){var F=R.children,q=h!==null?h.memoizedState:null;if(h===null&&g.stateNode===null&&(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),R.mode==="hidden"){if((g.flags&128)!==0){if(q=q!==null?q.baseLanes|w:w,h!==null){for(R=g.child=h.child,F=0;R!==null;)F=F|R.lanes|R.childLanes,R=R.sibling;R=F&~q}else R=0,g.child=null;return tm(h,g,q,w,R)}if((w&536870912)!==0)g.memoizedState={baseLanes:0,cachePool:null},h!==null&&xd(g,q!==null?q.cachePool:null),q!==null?zf(g,q):bh(),Of(g);else return R=g.lanes=536870912,tm(h,g,q!==null?q.baseLanes|w:w,w,R)}else q!==null?(xd(g,q.cachePool),zf(g,q),Pa(),g.memoizedState=null):(h!==null&&xd(g,null),bh(),Pa());return la(h,g,F,w),g.child}function Dh(h,g){return h!==null&&h.tag===22||g.stateNode!==null||(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.sibling}function tm(h,g,w,R,F){var q=Rf();return q=q===null?null:{parent:Ar._currentValue,pool:q},g.memoizedState={baseLanes:w,cachePool:q},h!==null&&xd(g,null),bh(),Of(g),h!==null&&Su(h,g,R,!0),g.childLanes=F,null}function Zl(h,g){return g=kd({mode:g.mode,children:g.children},h.mode),g.ref=h.ref,h.child=g,g.return=h,g}function nm(h,g,w){return _c(g,h.child,null,w),h=Zl(g,g.pendingProps),h.flags|=2,Oo(g),g.memoizedState=null,h}function nl(h,g,w){var R=g.pendingProps,F=(g.flags&128)!==0;if(g.flags&=-129,h===null){if(pr){if(R.mode==="hidden")return h=Zl(g,R),g.lanes=536870912,Dh(null,h);if(wh(g),(h=Gr)?(h=m0(h,Jo),h=h!==null&&h.data==="&"?h:null,h!==null&&(g.memoizedState={dehydrated:h,treeContext:Hi!==null?{id:fc,overflow:Ol}:null,retryLane:536870912,hydrationErrors:null},w=w_(h),w.return=g,g.child=w,js=g,Gr=null)):h=null,h===null)throw Bl(g);return g.lanes=536870912,null}return Zl(g,R)}var q=h.memoizedState;if(q!==null){var ce=q.dehydrated;if(wh(g),F)if(g.flags&256)g.flags&=-257,g=nm(h,g,w);else if(g.memoizedState!==null)g.child=h.child,g.flags|=128,g=null;else throw Error(u(558));else if(Ms||Su(h,g,w,!1),F=(w&h.childLanes)!==0,Ms||F){if(R=Fe,R!==null&&(ce=Lc(R,w),ce!==0&&ce!==q.retryLane))throw q.retryLane=ce,jt(h,ce),Bn(R,h,ce),Xf;ca(),g=nm(h,g,w)}else h=q.treeContext,Gr=Ic(ce.nextSibling),js=g,pr=!0,pc=null,Jo=!1,h!==null&&fh(g,h),g=Zl(g,R),g.flags|=4096;return g}return h=co(h.child,{mode:R.mode,children:R.children}),h.ref=g.ref,g.child=h,h.return=g,h}function Nu(h,g){var w=g.ref;if(w===null)h!==null&&h.ref!==null&&(g.flags|=4194816);else{if(typeof w!="function"&&typeof w!="object")throw Error(u(284));(h===null||h.ref!==w)&&(g.flags|=4194816)}}function Md(h,g,w,R,F){return Wc(g),w=Sh(h,g,w,R,void 0,F),R=Vp(),h!==null&&!Ms?(jp(h,g,F),Wl(h,g,F)):(pr&&R&&wf(g),g.flags|=1,la(h,g,w,F),g.child)}function Yf(h,g,w,R,F,q){return Wc(g),g.updateQueue=null,w=tg(g,R,w,F),Ul(h),R=Vp(),h!==null&&!Ms?(jp(h,g,q),Wl(h,g,q)):(pr&&R&&wf(g),g.flags|=1,la(h,g,w,q),g.child)}function Kf(h,g,w,R,F){if(Wc(g),g.stateNode===null){var q=hc,ce=w.contextType;typeof ce=="object"&&ce!==null&&(q=ba(ce)),q=new w(R,q),g.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=em,g.stateNode=q,q._reactInternals=g,q=g.stateNode,q.props=R,q.state=g.memoizedState,q.refs={},Lf(g),ce=w.contextType,q.context=typeof ce=="object"&&ce!==null?ba(ce):hc,q.state=g.memoizedState,ce=w.getDerivedStateFromProps,typeof ce=="function"&&(Jp(g,w,ce,R),q.state=g.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(ce=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),ce!==q.state&&em.enqueueReplaceState(q,q.state,null),eu(g,R,q,F),yh(),q.state=g.memoizedState),typeof q.componentDidMount=="function"&&(g.flags|=4194308),R=!0}else if(h===null){q=g.stateNode;var Re=g.memoizedProps,ct=Fo(w,Re);q.props=ct;var Vt=q.context,sn=w.contextType;ce=hc,typeof sn=="object"&&sn!==null&&(ce=ba(sn));var un=w.getDerivedStateFromProps;sn=typeof un=="function"||typeof q.getSnapshotBeforeUpdate=="function",Re=g.pendingProps!==Re,sn||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Re||Vt!==ce)&&pg(g,q,R,ce),uo=!1;var Ut=g.memoizedState;q.state=Ut,eu(g,R,q,F),yh(),Vt=g.memoizedState,Re||Ut!==Vt||uo?(typeof un=="function"&&(Jp(g,w,un,R),Vt=g.memoizedState),(ct=uo||za(g,w,ct,R,Ut,Vt,ce))?(sn||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(g.flags|=4194308)):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=R,g.memoizedState=Vt),q.props=R,q.state=Vt,q.context=ce,R=ct):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),R=!1)}else{q=g.stateNode,wd(h,g),ce=g.memoizedProps,sn=Fo(w,ce),q.props=sn,un=g.pendingProps,Ut=q.context,Vt=w.contextType,ct=hc,typeof Vt=="object"&&Vt!==null&&(ct=ba(Vt)),Re=w.getDerivedStateFromProps,(Vt=typeof Re=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ce!==un||Ut!==ct)&&pg(g,q,R,ct),uo=!1,Ut=g.memoizedState,q.state=Ut,eu(g,R,q,F),yh();var Yt=g.memoizedState;ce!==un||Ut!==Yt||uo||h!==null&&h.dependencies!==null&&fd(h.dependencies)?(typeof Re=="function"&&(Jp(g,w,Re,R),Yt=g.memoizedState),(sn=uo||za(g,w,sn,R,Ut,Yt,ct)||h!==null&&h.dependencies!==null&&fd(h.dependencies))?(Vt||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(R,Yt,ct),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(R,Yt,ct)),typeof q.componentDidUpdate=="function"&&(g.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof q.componentDidUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=1024),g.memoizedProps=R,g.memoizedState=Yt),q.props=R,q.state=Yt,q.context=ct,R=sn):(typeof q.componentDidUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=1024),R=!1)}return q=R,Nu(h,g),R=(g.flags&128)!==0,q||R?(q=g.stateNode,w=R&&typeof w.getDerivedStateFromError!="function"?null:q.render(),g.flags|=1,h!==null&&R?(g.child=_c(g,h.child,null,F),g.child=_c(g,null,w,F)):la(h,g,w,F),g.memoizedState=q.state,h=g.child):h=Wl(h,g,F),h}function xs(h,g,w,R){return Fl(),g.flags|=256,la(h,g,w,R),g.child}var Ph={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bu(h){return{baseLanes:h,cachePool:mh()}}function Dd(h,g,w){return h=h!==null?h.childLanes&~w:0,g&&(h|=kt),h}function Fu(h,g,w){var R=g.pendingProps,F=!1,q=(g.flags&128)!==0,ce;if((ce=q)||(ce=h!==null&&h.memoizedState===null?!1:(Us.current&2)!==0),ce&&(F=!0,g.flags&=-129),ce=(g.flags&32)!==0,g.flags&=-33,h===null){if(pr){if(F?jl(g):Pa(),(h=Gr)?(h=m0(h,Jo),h=h!==null&&h.data!=="&"?h:null,h!==null&&(g.memoizedState={dehydrated:h,treeContext:Hi!==null?{id:fc,overflow:Ol}:null,retryLane:536870912,hydrationErrors:null},w=w_(h),w.return=g,g.child=w,js=g,Gr=null)):h=null,h===null)throw Bl(g);return dx(h)?g.lanes=32:g.lanes=536870912,null}var Re=R.children;return R=R.fallback,F?(Pa(),F=g.mode,Re=kd({mode:"hidden",children:Re},F),R=wu(R,F,w,null),Re.return=g,R.return=g,Re.sibling=R,g.child=Re,R=g.child,R.memoizedState=Bu(w),R.childLanes=Dd(h,ce,w),g.memoizedState=Ph,Dh(null,R)):(jl(g),Pd(g,Re))}var ct=h.memoizedState;if(ct!==null&&(Re=ct.dehydrated,Re!==null)){if(q)g.flags&256?(jl(g),g.flags&=-257,g=kh(h,g,w)):g.memoizedState!==null?(Pa(),g.child=h.child,g.flags|=128,g=null):(Pa(),Re=R.fallback,F=g.mode,R=kd({mode:"visible",children:R.children},F),Re=wu(Re,F,w,null),Re.flags|=2,R.return=g,Re.return=g,R.sibling=Re,g.child=R,_c(g,h.child,null,w),R=g.child,R.memoizedState=Bu(w),R.childLanes=Dd(h,ce,w),g.memoizedState=Ph,g=Dh(null,R));else if(jl(g),dx(Re)){if(ce=Re.nextSibling&&Re.nextSibling.dataset,ce)var Vt=ce.dgst;ce=Vt,R=Error(u(419)),R.stack="",R.digest=ce,dd({value:R,source:null,stack:null}),g=kh(h,g,w)}else if(Ms||Su(h,g,w,!1),ce=(w&h.childLanes)!==0,Ms||ce){if(ce=Fe,ce!==null&&(R=Lc(ce,w),R!==0&&R!==ct.retryLane))throw ct.retryLane=R,jt(h,R),Bn(ce,h,R),Xf;hx(Re)||ca(),g=kh(h,g,w)}else hx(Re)?(g.flags|=192,g.child=h.child,g=null):(h=ct.treeContext,Gr=Ic(Re.nextSibling),js=g,pr=!0,pc=null,Jo=!1,h!==null&&fh(g,h),g=Pd(g,R.children),g.flags|=4096);return g}return F?(Pa(),Re=R.fallback,F=g.mode,ct=h.child,Vt=ct.sibling,R=co(ct,{mode:"hidden",children:R.children}),R.subtreeFlags=ct.subtreeFlags&65011712,Vt!==null?Re=co(Vt,Re):(Re=wu(Re,F,w,null),Re.flags|=2),Re.return=g,R.return=g,R.sibling=Re,g.child=R,Dh(null,R),R=g.child,Re=h.child.memoizedState,Re===null?Re=Bu(w):(F=Re.cachePool,F!==null?(ct=Ar._currentValue,F=F.parent!==ct?{parent:ct,pool:ct}:F):F=mh(),Re={baseLanes:Re.baseLanes|w,cachePool:F}),R.memoizedState=Re,R.childLanes=Dd(h,ce,w),g.memoizedState=Ph,Dh(h.child,R)):(jl(g),w=h.child,h=w.sibling,w=co(w,{mode:"visible",children:R.children}),w.return=g,w.sibling=null,h!==null&&(ce=g.deletions,ce===null?(g.deletions=[h],g.flags|=16):ce.push(h)),g.child=w,g.memoizedState=null,w)}function Pd(h,g){return g=kd({mode:"visible",children:g},h.mode),g.return=h,h.child=g}function kd(h,g){return h=lo(22,h,null,g),h.lanes=0,h}function kh(h,g,w){return _c(g,h.child,null,w),h=Pd(g,g.pendingProps.children),h.flags|=2,g.memoizedState=null,h}function Vu(h,g,w){h.lanes|=g;var R=h.alternate;R!==null&&(R.lanes|=g),Ym(h.return,g,w)}function Qf(h,g,w,R,F,q){var ce=h.memoizedState;ce===null?h.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:R,tail:w,tailMode:F,treeForkCount:q}:(ce.isBackwards=g,ce.rendering=null,ce.renderingStartTime=0,ce.last=R,ce.tail=w,ce.tailMode=F,ce.treeForkCount=q)}function Ld(h,g,w){var R=g.pendingProps,F=R.revealOrder,q=R.tail;R=R.children;var ce=Us.current,Re=(ce&2)!==0;if(Re?(ce=ce&1|2,g.flags|=128):ce&=1,Ne(Us,ce),la(h,g,R,w),R=pr?vf:0,!Re&&h!==null&&(h.flags&128)!==0)e:for(h=g.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&Vu(h,w,g);else if(h.tag===19)Vu(h,w,g);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===g)break e;for(;h.sibling===null;){if(h.return===null||h.return===g)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(F){case"forwards":for(w=g.child,F=null;w!==null;)h=w.alternate,h!==null&&vc(h)===null&&(F=w),w=w.sibling;w=F,w===null?(F=g.child,g.child=null):(F=w.sibling,w.sibling=null),Qf(g,!1,F,w,q,R);break;case"backwards":case"unstable_legacy-backwards":for(w=null,F=g.child,g.child=null;F!==null;){if(h=F.alternate,h!==null&&vc(h)===null){g.child=F;break}h=F.sibling,F.sibling=w,w=F,F=h}Qf(g,!0,w,null,q,R);break;case"together":Qf(g,!1,null,null,void 0,R);break;default:g.memoizedState=null}return g.child}function Wl(h,g,w){if(h!==null&&(g.dependencies=h.dependencies),Pt|=g.lanes,(w&g.childLanes)===0)if(h!==null){if(Su(h,g,w,!1),(w&g.childLanes)===0)return null}else return null;if(h!==null&&g.child!==h.child)throw Error(u(153));if(g.child!==null){for(h=g.child,w=co(h,h.pendingProps),g.child=w,w.return=g;h.sibling!==null;)h=h.sibling,w=w.sibling=co(h,h.pendingProps),w.return=g;w.sibling=null}return g.child}function Lh(h,g){return(h.lanes&g)!==0?!0:(h=h.dependencies,!!(h!==null&&fd(h)))}function mg(h,g,w){switch(g.tag){case 3:Xi(g,g.stateNode.containerInfo),Eu(g,Ar,h.memoizedState.cache),Fl();break;case 27:case 5:zi(g);break;case 4:Xi(g,g.stateNode.containerInfo);break;case 10:Eu(g,g.type,g.memoizedProps.value);break;case 31:if(g.memoizedState!==null)return g.flags|=128,wh(g),null;break;case 13:var R=g.memoizedState;if(R!==null)return R.dehydrated!==null?(jl(g),g.flags|=128,null):(w&g.child.childLanes)!==0?Fu(h,g,w):(jl(g),h=Wl(h,g,w),h!==null?h.sibling:null);jl(g);break;case 19:var F=(h.flags&128)!==0;if(R=(w&g.childLanes)!==0,R||(Su(h,g,w,!1),R=(w&g.childLanes)!==0),F){if(R)return Ld(h,g,w);g.flags|=128}if(F=g.memoizedState,F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),Ne(Us,Us.current),R)break;return null;case 22:return g.lanes=0,Mh(h,g,w,g.pendingProps);case 24:Eu(g,Ar,h.memoizedState.cache)}return Wl(h,g,w)}function Jf(h,g,w){if(h!==null)if(h.memoizedProps!==g.pendingProps)Ms=!0;else{if(!Lh(h,w)&&(g.flags&128)===0)return Ms=!1,mg(h,g,w);Ms=(h.flags&131072)!==0}else Ms=!1,pr&&(g.flags&1048576)!==0&&bf(g,vf,g.index);switch(g.lanes=0,g.tag){case 16:e:{var R=g.pendingProps;if(h=gc(g.elementType),g.type=h,typeof h=="function")Gc(h)?(R=Fo(h,R),g.tag=1,g=Kf(null,g,h,R,w)):(g.tag=0,g=Md(null,g,h,R,w));else{if(h!=null){var F=h.$$typeof;if(F===Ft){g.tag=11,g=tl(null,g,h,R,w);break e}else if(F===je){g.tag=14,g=$l(null,g,h,R,w);break e}}throw g=Zt(h)||h,Error(u(306,g,""))}}return g;case 0:return Md(h,g,g.type,g.pendingProps,w);case 1:return R=g.type,F=Fo(R,g.pendingProps),Kf(h,g,R,F,w);case 3:e:{if(Xi(g,g.stateNode.containerInfo),h===null)throw Error(u(387));R=g.pendingProps;var q=g.memoizedState;F=q.element,wd(h,g),eu(g,R,null,w);var ce=g.memoizedState;if(R=ce.cache,Eu(g,Ar,R),R!==q.cache&&Ef(g,[Ar],w,!0),yh(),R=ce.element,q.isDehydrated)if(q={element:R,isDehydrated:!1,cache:ce.cache},g.updateQueue.baseState=q,g.memoizedState=q,g.flags&256){g=xs(h,g,R,w);break e}else if(R!==F){F=oa(Error(u(424)),g),dd(F),g=xs(h,g,R,w);break e}else{switch(h=g.stateNode.containerInfo,h.nodeType){case 9:h=h.body;break;default:h=h.nodeName==="HTML"?h.ownerDocument.body:h}for(Gr=Ic(h.firstChild),js=g,pr=!0,pc=null,Jo=!0,w=Jm(g,null,R,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling}else{if(Fl(),R===F){g=Wl(h,g,w);break e}la(h,g,R,w)}g=g.child}return g;case 26:return Nu(h,g),h===null?(w=qu(g.type,null,g.pendingProps,null))?g.memoizedState=w:pr||(w=g.type,h=g.pendingProps,R=Mg(Zn.current).createElement(w),R[De]=g,R[xe]=h,go(R,w,h),vn(R),g.stateNode=R):g.memoizedState=qu(g.type,h.memoizedProps,g.pendingProps,h.memoizedState),null;case 27:return zi(g),h===null&&pr&&(R=g.stateNode=um(g.type,g.pendingProps,Zn.current),js=g,Jo=!0,F=Gr,Ql(g.type)?(Dg=F,Gr=Ic(R.firstChild)):Gr=F),la(h,g,g.pendingProps.children,w),Nu(h,g),h===null&&(g.flags|=4194304),g.child;case 5:return h===null&&pr&&((F=R=Gr)&&(R=K1(R,g.type,g.pendingProps,Jo),R!==null?(g.stateNode=R,js=g,Gr=Ic(R.firstChild),Jo=!1,F=!0):F=!1),F||Bl(g)),zi(g),F=g.type,q=g.pendingProps,ce=h!==null?h.memoizedProps:null,R=q.children,Gu(F,q)?R=null:ce!==null&&Gu(F,ce)&&(g.flags|=32),g.memoizedState!==null&&(F=Sh(h,g,A_,null,null,w),Rc._currentValue=F),Nu(h,g),la(h,g,R,w),g.child;case 6:return h===null&&pr&&((h=w=Gr)&&(w=Q1(w,g.pendingProps,Jo),w!==null?(g.stateNode=w,js=g,Gr=null,h=!0):h=!1),h||Bl(g)),null;case 13:return Fu(h,g,w);case 4:return Xi(g,g.stateNode.containerInfo),R=g.pendingProps,h===null?g.child=_c(g,null,R,w):la(h,g,R,w),g.child;case 11:return tl(h,g,g.type,g.pendingProps,w);case 7:return la(h,g,g.pendingProps,w),g.child;case 8:return la(h,g,g.pendingProps.children,w),g.child;case 12:return la(h,g,g.pendingProps.children,w),g.child;case 10:return R=g.pendingProps,Eu(g,g.type,R.value),la(h,g,R.children,w),g.child;case 9:return F=g.type._context,R=g.pendingProps.children,Wc(g),F=ba(F),R=R(F),g.flags|=1,la(h,g,R,w),g.child;case 14:return $l(h,g,g.type,g.pendingProps,w);case 15:return Rh(h,g,g.type,g.pendingProps,w);case 19:return Ld(h,g,w);case 31:return nl(h,g,w);case 22:return Mh(h,g,w,g.pendingProps);case 24:return Wc(g),R=ba(Ar),h===null?(F=Rf(),F===null&&(F=Fe,q=md(),F.pooledCache=q,q.refCount++,q!==null&&(F.pooledCacheLanes|=w),F=q),g.memoizedState={parent:R,cache:F},Lf(g),Eu(g,Ar,F)):((h.lanes&w)!==0&&(wd(h,g),eu(g,null,null,w),yh()),F=h.memoizedState,q=g.memoizedState,F.parent!==R?(F={parent:R,cache:R},g.memoizedState=F,g.lanes===0&&(g.memoizedState=g.updateQueue.baseState=F),Eu(g,Ar,R)):(R=q.cache,Eu(g,Ar,R),R!==F.cache&&Ef(g,[Ar],w,!0))),la(h,g,g.pendingProps.children,w),g.child;case 29:throw g.pendingProps}throw Error(u(156,g.tag))}function Ec(h){h.flags|=4}function im(h,g,w,R,F){if((g=(h.mode&32)!==0)&&(g=!1),g){if(h.flags|=16777216,(F&335544128)===F)if(h.stateNode.complete)h.flags|=8192;else if(Ii())h.flags|=8192;else throw Qc=Df,Km}else h.flags&=-16777217}function gg(h,g){if(g.type!=="stylesheet"||(g.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!wx(g))if(Ii())h.flags|=8192;else throw Qc=Df,Km}function ep(h,g){g!==null&&(h.flags|=4),h.flags&16384&&(g=h.tag!==22?ja():536870912,h.lanes|=g,cn|=g)}function zd(h,g){if(!pr)switch(h.tailMode){case"hidden":g=h.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?h.tail=null:w.sibling=null;break;case"collapsed":w=h.tail;for(var R=null;w!==null;)w.alternate!==null&&(R=w),w=w.sibling;R===null?g||h.tail===null?h.tail=null:h.tail.sibling=null:R.sibling=null}}function hs(h){var g=h.alternate!==null&&h.alternate.child===h.child,w=0,R=0;if(g)for(var F=h.child;F!==null;)w|=F.lanes|F.childLanes,R|=F.subtreeFlags&65011712,R|=F.flags&65011712,F.return=h,F=F.sibling;else for(F=h.child;F!==null;)w|=F.lanes|F.childLanes,R|=F.subtreeFlags,R|=F.flags,F.return=h,F=F.sibling;return h.subtreeFlags|=R,h.childLanes=w,g}function tp(h,g,w){var R=g.pendingProps;switch(Hc(g),g.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hs(g),null;case 1:return hs(g),null;case 3:return w=g.stateNode,R=null,h!==null&&(R=h.memoizedState.cache),g.memoizedState.cache!==R&&(g.flags|=2048),Zc(Ar),Gn(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(h===null||h.child===null)&&($c(g)?Ec(g):h===null||h.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Op())),hs(g),null;case 26:var F=g.type,q=g.memoizedState;return h===null?(Ec(g),q!==null?(hs(g),gg(g,q)):(hs(g),im(g,F,null,R,w))):q?q!==h.memoizedState?(Ec(g),hs(g),gg(g,q)):(hs(g),g.flags&=-16777217):(h=h.memoizedProps,h!==R&&Ec(g),hs(g),im(g,F,h,R,w)),null;case 27:if(jr(g),w=Zn.current,F=g.type,h!==null&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(!R){if(g.stateNode===null)throw Error(u(166));return hs(g),null}h=wn.current,$c(g)?Tf(g):(h=um(F,R,w),g.stateNode=h,Ec(g))}return hs(g),null;case 5:if(jr(g),F=g.type,h!==null&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(!R){if(g.stateNode===null)throw Error(u(166));return hs(g),null}if(q=wn.current,$c(g))Tf(g);else{var ce=Mg(Zn.current);switch(q){case 1:q=ce.createElementNS("http://www.w3.org/2000/svg",F);break;case 2:q=ce.createElementNS("http://www.w3.org/1998/Math/MathML",F);break;default:switch(F){case"svg":q=ce.createElementNS("http://www.w3.org/2000/svg",F);break;case"math":q=ce.createElementNS("http://www.w3.org/1998/Math/MathML",F);break;case"script":q=ce.createElement("div"),q.innerHTML="<script><\/script>",q=q.removeChild(q.firstChild);break;case"select":q=typeof R.is=="string"?ce.createElement("select",{is:R.is}):ce.createElement("select"),R.multiple?q.multiple=!0:R.size&&(q.size=R.size);break;default:q=typeof R.is=="string"?ce.createElement(F,{is:R.is}):ce.createElement(F)}}q[De]=g,q[xe]=R;e:for(ce=g.child;ce!==null;){if(ce.tag===5||ce.tag===6)q.appendChild(ce.stateNode);else if(ce.tag!==4&&ce.tag!==27&&ce.child!==null){ce.child.return=ce,ce=ce.child;continue}if(ce===g)break e;for(;ce.sibling===null;){if(ce.return===null||ce.return===g)break e;ce=ce.return}ce.sibling.return=ce.return,ce=ce.sibling}g.stateNode=q;e:switch(go(q,F,R),F){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}R&&Ec(g)}}return hs(g),im(g,g.type,h===null?null:h.memoizedProps,g.pendingProps,w),null;case 6:if(h&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(typeof R!="string"&&g.stateNode===null)throw Error(u(166));if(h=Zn.current,$c(g)){if(h=g.stateNode,w=g.memoizedProps,R=null,F=js,F!==null)switch(F.tag){case 27:case 5:R=F.memoizedProps}h[De]=g,h=!!(h.nodeValue===w||R!==null&&R.suppressHydrationWarning===!0||u0(h.nodeValue,w)),h||Bl(g,!0)}else h=Mg(h).createTextNode(R),h[De]=g,g.stateNode=h}return hs(g),null;case 31:if(w=g.memoizedState,h===null||h.memoizedState!==null){if(R=$c(g),w!==null){if(h===null){if(!R)throw Error(u(318));if(h=g.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(557));h[De]=g}else Fl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;hs(g),h=!1}else w=Op(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=w),h=!0;if(!h)return g.flags&256?(Oo(g),g):(Oo(g),null);if((g.flags&128)!==0)throw Error(u(558))}return hs(g),null;case 13:if(R=g.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(F=$c(g),R!==null&&R.dehydrated!==null){if(h===null){if(!F)throw Error(u(318));if(F=g.memoizedState,F=F!==null?F.dehydrated:null,!F)throw Error(u(317));F[De]=g}else Fl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;hs(g),F=!1}else F=Op(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=F),F=!0;if(!F)return g.flags&256?(Oo(g),g):(Oo(g),null)}return Oo(g),(g.flags&128)!==0?(g.lanes=w,g):(w=R!==null,h=h!==null&&h.memoizedState!==null,w&&(R=g.child,F=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(F=R.alternate.memoizedState.cachePool.pool),q=null,R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(q=R.memoizedState.cachePool.pool),q!==F&&(R.flags|=2048)),w!==h&&w&&(g.child.flags|=8192),ep(g,g.updateQueue),hs(g),null);case 4:return Gn(),h===null&&z_(g.stateNode.containerInfo),hs(g),null;case 10:return Zc(g.type),hs(g),null;case 19:if(Kt(Us),R=g.memoizedState,R===null)return hs(g),null;if(F=(g.flags&128)!==0,q=R.rendering,q===null)if(F)zd(R,!1);else{if(yt!==0||h!==null&&(h.flags&128)!==0)for(h=g.child;h!==null;){if(q=vc(h),q!==null){for(g.flags|=128,zd(R,!1),h=q.updateQueue,g.updateQueue=h,ep(g,h),g.subtreeFlags=0,h=w,w=g.child;w!==null;)qc(w,h),w=w.sibling;return Ne(Us,Us.current&1|2),pr&&Nl(g,R.treeForkCount),g.child}h=h.sibling}R.tail!==null&&Ur()>Vn&&(g.flags|=128,F=!0,zd(R,!1),g.lanes=4194304)}else{if(!F)if(h=vc(q),h!==null){if(g.flags|=128,F=!0,h=h.updateQueue,g.updateQueue=h,ep(g,h),zd(R,!0),R.tail===null&&R.tailMode==="hidden"&&!q.alternate&&!pr)return hs(g),null}else 2*Ur()-R.renderingStartTime>Vn&&w!==536870912&&(g.flags|=128,F=!0,zd(R,!1),g.lanes=4194304);R.isBackwards?(q.sibling=g.child,g.child=q):(h=R.last,h!==null?h.sibling=q:g.child=q,R.last=q)}return R.tail!==null?(h=R.tail,R.rendering=h,R.tail=h.sibling,R.renderingStartTime=Ur(),h.sibling=null,w=Us.current,Ne(Us,F?w&1|2:w&1),pr&&Nl(g,R.treeForkCount),h):(hs(g),null);case 22:case 23:return Oo(g),xc(),R=g.memoizedState!==null,h!==null?h.memoizedState!==null!==R&&(g.flags|=8192):R&&(g.flags|=8192),R?(w&536870912)!==0&&(g.flags&128)===0&&(hs(g),g.subtreeFlags&6&&(g.flags|=8192)):hs(g),w=g.updateQueue,w!==null&&ep(g,w.retryQueue),w=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),R=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(R=g.memoizedState.cachePool.pool),R!==w&&(g.flags|=2048),h!==null&&Kt(Kc),null;case 24:return w=null,h!==null&&(w=h.memoizedState.cache),g.memoizedState.cache!==w&&(g.flags|=2048),Zc(Ar),hs(g),null;case 25:return null;case 30:return null}throw Error(u(156,g.tag))}function P_(h,g){switch(Hc(g),g.tag){case 1:return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 3:return Zc(Ar),Gn(),h=g.flags,(h&65536)!==0&&(h&128)===0?(g.flags=h&-65537|128,g):null;case 26:case 27:case 5:return jr(g),null;case 31:if(g.memoizedState!==null){if(Oo(g),g.alternate===null)throw Error(u(340));Fl()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 13:if(Oo(g),h=g.memoizedState,h!==null&&h.dehydrated!==null){if(g.alternate===null)throw Error(u(340));Fl()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 19:return Kt(Us),null;case 4:return Gn(),null;case 10:return Zc(g.type),null;case 22:case 23:return Oo(g),xc(),h!==null&&Kt(Kc),h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 24:return Zc(Ar),null;case 25:return null;default:return null}}function _g(h,g){switch(Hc(g),g.tag){case 3:Zc(Ar),Gn();break;case 26:case 27:case 5:jr(g);break;case 4:Gn();break;case 31:g.memoizedState!==null&&Oo(g);break;case 13:Oo(g);break;case 19:Kt(Us);break;case 10:Zc(g.type);break;case 22:case 23:Oo(g),xc(),h!==null&&Kt(Kc);break;case 24:Zc(Ar)}}function ru(h,g){try{var w=g.updateQueue,R=w!==null?w.lastEffect:null;if(R!==null){var F=R.next;w=F;do{if((w.tag&h)===h){R=void 0;var q=w.create,ce=w.inst;R=q(),ce.destroy=R}w=w.next}while(w!==F)}}catch(Re){ar(g,g.return,Re)}}function su(h,g,w){try{var R=g.updateQueue,F=R!==null?R.lastEffect:null;if(F!==null){var q=F.next;R=q;do{if((R.tag&h)===h){var ce=R.inst,Re=ce.destroy;if(Re!==void 0){ce.destroy=void 0,F=g;var ct=w,Vt=Re;try{Vt()}catch(sn){ar(F,ct,sn)}}}R=R.next}while(R!==q)}}catch(sn){ar(g,g.return,sn)}}function rm(h){var g=h.updateQueue;if(g!==null){var w=h.stateNode;try{S_(g,w)}catch(R){ar(h,h.return,R)}}}function yg(h,g,w){w.props=Fo(h.type,h.memoizedProps),w.state=h.memoizedState;try{w.componentWillUnmount()}catch(R){ar(h,g,R)}}function Od(h,g){try{var w=h.ref;if(w!==null){switch(h.tag){case 26:case 27:case 5:var R=h.stateNode;break;case 30:R=h.stateNode;break;default:R=h.stateNode}typeof w=="function"?h.refCleanup=w(R):w.current=R}}catch(F){ar(h,g,F)}}function Xl(h,g){var w=h.ref,R=h.refCleanup;if(w!==null)if(typeof R=="function")try{R()}catch(F){ar(h,g,F)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(F){ar(h,g,F)}else w.current=null}function xg(h){var g=h.type,w=h.memoizedProps,R=h.stateNode;try{e:switch(g){case"button":case"input":case"select":case"textarea":w.autoFocus&&R.focus();break e;case"img":w.src?R.src=w.src:w.srcSet&&(R.srcset=w.srcSet)}}catch(F){ar(h,h.return,F)}}function mr(h,g,w){try{var R=h.stateNode;h0(R,h.type,w,g),R[xe]=g}catch(F){ar(h,h.return,F)}}function vg(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&Ql(h.type)||h.tag===4}function sm(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||vg(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&Ql(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function bg(h,g,w){var R=h.tag;if(R===5||R===6)h=h.stateNode,g?(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).insertBefore(h,g):(g=w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w,g.appendChild(h),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=Ss));else if(R!==4&&(R===27&&Ql(h.type)&&(w=h.stateNode,g=null),h=h.child,h!==null))for(bg(h,g,w),h=h.sibling;h!==null;)bg(h,g,w),h=h.sibling}function am(h,g,w){var R=h.tag;if(R===5||R===6)h=h.stateNode,g?w.insertBefore(h,g):w.appendChild(h);else if(R!==4&&(R===27&&Ql(h.type)&&(w=h.stateNode),h=h.child,h!==null))for(am(h,g,w),h=h.sibling;h!==null;)am(h,g,w),h=h.sibling}function Nd(h){var g=h.stateNode,w=h.memoizedProps;try{for(var R=h.type,F=g.attributes;F.length;)g.removeAttributeNode(F[0]);go(g,R,w),g[De]=h,g[xe]=w}catch(q){ar(h,h.return,q)}}var Sc=!1,Ds=!1,zh=!1,xl=typeof WeakSet=="function"?WeakSet:Set,$r=null;function ds(h,g){if(h=h.containerInfo,N_=Bg,h=y_(h),lh(h)){if("selectionStart"in h)var w={start:h.selectionStart,end:h.selectionEnd};else e:{w=(w=h.ownerDocument)&&w.defaultView||window;var R=w.getSelection&&w.getSelection();if(R&&R.rangeCount!==0){w=R.anchorNode;var F=R.anchorOffset,q=R.focusNode;R=R.focusOffset;try{w.nodeType,q.nodeType}catch{w=null;break e}var ce=0,Re=-1,ct=-1,Vt=0,sn=0,un=h,Ut=null;t:for(;;){for(var Yt;un!==w||F!==0&&un.nodeType!==3||(Re=ce+F),un!==q||R!==0&&un.nodeType!==3||(ct=ce+R),un.nodeType===3&&(ce+=un.nodeValue.length),(Yt=un.firstChild)!==null;)Ut=un,un=Yt;for(;;){if(un===h)break t;if(Ut===w&&++Vt===F&&(Re=ce),Ut===q&&++sn===R&&(ct=ce),(Yt=un.nextSibling)!==null)break;un=Ut,Ut=un.parentNode}un=Yt}w=Re===-1||ct===-1?null:{start:Re,end:ct}}else w=null}w=w||{start:0,end:0}}else w=null;for(B_={focusedElem:h,selectionRange:w},Bg=!1,$r=g;$r!==null;)if(g=$r,h=g.child,(g.subtreeFlags&1028)!==0&&h!==null)h.return=g,$r=h;else for(;$r!==null;){switch(g=$r,q=g.alternate,h=g.flags,g.tag){case 0:if((h&4)!==0&&(h=g.updateQueue,h=h!==null?h.events:null,h!==null))for(w=0;w<h.length;w++)F=h[w],F.ref.impl=F.nextImpl;break;case 11:case 15:break;case 1:if((h&1024)!==0&&q!==null){h=void 0,w=g,F=q.memoizedProps,q=q.memoizedState,R=w.stateNode;try{var Wn=Fo(w.type,F);h=R.getSnapshotBeforeUpdate(Wn,q),R.__reactInternalSnapshotBeforeUpdate=h}catch(fi){ar(w,w.return,fi)}}break;case 3:if((h&1024)!==0){if(h=g.stateNode.containerInfo,w=h.nodeType,w===9)ip(h);else if(w===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":ip(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(u(163))}if(h=g.sibling,h!==null){h.return=g.return,$r=h;break}$r=g.return}}function Vo(h,g,w){var R=w.flags;switch(w.tag){case 0:case 11:case 15:M(h,w),R&4&&ru(5,w);break;case 1:if(M(h,w),R&4)if(h=w.stateNode,g===null)try{h.componentDidMount()}catch(ce){ar(w,w.return,ce)}else{var F=Fo(w.type,g.memoizedProps);g=g.memoizedState;try{h.componentDidUpdate(F,g,h.__reactInternalSnapshotBeforeUpdate)}catch(ce){ar(w,w.return,ce)}}R&64&&rm(w),R&512&&Od(w,w.return);break;case 3:if(M(h,w),R&64&&(h=w.updateQueue,h!==null)){if(g=null,w.child!==null)switch(w.child.tag){case 27:case 5:g=w.child.stateNode;break;case 1:g=w.child.stateNode}try{S_(h,g)}catch(ce){ar(w,w.return,ce)}}break;case 27:g===null&&R&4&&Nd(w);case 26:case 5:M(h,w),g===null&&R&4&&xg(w),R&512&&Od(w,w.return);break;case 12:M(h,w);break;case 31:M(h,w),R&4&&tx(h,w);break;case 13:M(h,w),R&4&&f(h,w),R&64&&(h=w.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(w=n0.bind(null,w),J1(h,w))));break;case 22:if(R=w.memoizedState!==null||Sc,!R){g=g!==null&&g.memoizedState!==null||Ds,F=Sc;var q=Ds;Sc=R,(Ds=g)&&!q?O(h,w,(w.subtreeFlags&8772)!==0):M(h,w),Sc=F,Ds=q}break;case 30:break;default:M(h,w)}}function Bd(h){var g=h.alternate;g!==null&&(h.alternate=null,Bd(g)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(g=h.stateNode,g!==null&&tn(g)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var is=null,ho=!1;function au(h,g,w){for(w=w.child;w!==null;)Oh(h,g,w),w=w.sibling}function Oh(h,g,w){if(kr&&typeof kr.onCommitFiberUnmount=="function")try{kr.onCommitFiberUnmount(ps,w)}catch{}switch(w.tag){case 26:Ds||Xl(w,g),au(h,g,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:Ds||Xl(w,g);var R=is,F=ho;Ql(w.type)&&(is=w.stateNode,ho=!1),au(h,g,w),Pg(w.stateNode),is=R,ho=F;break;case 5:Ds||Xl(w,g);case 6:if(R=is,F=ho,is=null,au(h,g,w),is=R,ho=F,is!==null)if(ho)try{(is.nodeType===9?is.body:is.nodeName==="HTML"?is.ownerDocument.body:is).removeChild(w.stateNode)}catch(q){ar(w,g,q)}else try{is.removeChild(w.stateNode)}catch(q){ar(w,g,q)}break;case 18:is!==null&&(ho?(h=is,ux(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,w.stateNode),gm(h)):ux(is,w.stateNode));break;case 4:R=is,F=ho,is=w.stateNode.containerInfo,ho=!0,au(h,g,w),is=R,ho=F;break;case 0:case 11:case 14:case 15:su(2,w,g),Ds||su(4,w,g),au(h,g,w);break;case 1:Ds||(Xl(w,g),R=w.stateNode,typeof R.componentWillUnmount=="function"&&yg(w,g,R)),au(h,g,w);break;case 21:au(h,g,w);break;case 22:Ds=(R=Ds)||w.memoizedState!==null,au(h,g,w),Ds=R;break;default:au(h,g,w)}}function tx(h,g){if(g.memoizedState===null&&(h=g.alternate,h!==null&&(h=h.memoizedState,h!==null))){h=h.dehydrated;try{gm(h)}catch(w){ar(g,g.return,w)}}}function f(h,g){if(g.memoizedState===null&&(h=g.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{gm(h)}catch(w){ar(g,g.return,w)}}function n(h){switch(h.tag){case 31:case 13:case 19:var g=h.stateNode;return g===null&&(g=h.stateNode=new xl),g;case 22:return h=h.stateNode,g=h._retryCache,g===null&&(g=h._retryCache=new xl),g;default:throw Error(u(435,h.tag))}}function c(h,g){var w=n(h);g.forEach(function(R){if(!w.has(R)){w.add(R);var F=i0.bind(null,h,R);R.then(F,F)}})}function p(h,g){var w=g.deletions;if(w!==null)for(var R=0;R<w.length;R++){var F=w[R],q=h,ce=g,Re=ce;e:for(;Re!==null;){switch(Re.tag){case 27:if(Ql(Re.type)){is=Re.stateNode,ho=!1;break e}break;case 5:is=Re.stateNode,ho=!1;break e;case 3:case 4:is=Re.stateNode.containerInfo,ho=!0;break e}Re=Re.return}if(is===null)throw Error(u(160));Oh(q,ce,F),is=null,ho=!1,q=F.alternate,q!==null&&(q.return=null),F.return=null}if(g.subtreeFlags&13886)for(g=g.child;g!==null;)b(g,h),g=g.sibling}var x=null;function b(h,g){var w=h.alternate,R=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:p(g,h),E(h),R&4&&(su(3,h,h.return),ru(3,h),su(5,h,h.return));break;case 1:p(g,h),E(h),R&512&&(Ds||w===null||Xl(w,w.return)),R&64&&Sc&&(h=h.updateQueue,h!==null&&(R=h.callbacks,R!==null&&(w=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=w===null?R:w.concat(R))));break;case 26:var F=x;if(p(g,h),E(h),R&512&&(Ds||w===null||Xl(w,w.return)),R&4){var q=w!==null?w.memoizedState:null;if(R=h.memoizedState,w===null)if(R===null)if(h.stateNode===null){e:{R=h.type,w=h.memoizedProps,F=F.ownerDocument||F;t:switch(R){case"title":q=F.getElementsByTagName("title")[0],(!q||q[It]||q[De]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=F.createElement(R),F.head.insertBefore(q,F.querySelector("head > title"))),go(q,R,w),q[De]=h,vn(q),R=q;break e;case"link":var ce=op("link","href",F).get(R+(w.href||""));if(ce){for(var Re=0;Re<ce.length;Re++)if(q=ce[Re],q.getAttribute("href")===(w.href==null||w.href===""?null:w.href)&&q.getAttribute("rel")===(w.rel==null?null:w.rel)&&q.getAttribute("title")===(w.title==null?null:w.title)&&q.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){ce.splice(Re,1);break t}}q=F.createElement(R),go(q,R,w),F.head.appendChild(q);break;case"meta":if(ce=op("meta","content",F).get(R+(w.content||""))){for(Re=0;Re<ce.length;Re++)if(q=ce[Re],q.getAttribute("content")===(w.content==null?null:""+w.content)&&q.getAttribute("name")===(w.name==null?null:w.name)&&q.getAttribute("property")===(w.property==null?null:w.property)&&q.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&q.getAttribute("charset")===(w.charSet==null?null:w.charSet)){ce.splice(Re,1);break t}}q=F.createElement(R),go(q,R,w),F.head.appendChild(q);break;default:throw Error(u(468,R))}q[De]=h,vn(q),R=q}h.stateNode=R}else bx(F,h.type,h.stateNode);else h.stateNode=xx(F,R,h.memoizedProps);else q!==R?(q===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):q.count--,R===null?bx(F,h.type,h.stateNode):xx(F,R,h.memoizedProps)):R===null&&h.stateNode!==null&&mr(h,h.memoizedProps,w.memoizedProps)}break;case 27:p(g,h),E(h),R&512&&(Ds||w===null||Xl(w,w.return)),w!==null&&R&4&&mr(h,h.memoizedProps,w.memoizedProps);break;case 5:if(p(g,h),E(h),R&512&&(Ds||w===null||Xl(w,w.return)),h.flags&32){F=h.stateNode;try{ga(F,"")}catch(Wn){ar(h,h.return,Wn)}}R&4&&h.stateNode!=null&&(F=h.memoizedProps,mr(h,F,w!==null?w.memoizedProps:F)),R&1024&&(zh=!0);break;case 6:if(p(g,h),E(h),R&4){if(h.stateNode===null)throw Error(u(162));R=h.memoizedProps,w=h.stateNode;try{w.nodeValue=R}catch(Wn){ar(h,h.return,Wn)}}break;case 3:if($d=null,F=x,x=kg(g.containerInfo),p(g,h),x=F,E(h),R&4&&w!==null&&w.memoizedState.isDehydrated)try{gm(g.containerInfo)}catch(Wn){ar(h,h.return,Wn)}zh&&(zh=!1,I(h));break;case 4:R=x,x=kg(h.stateNode.containerInfo),p(g,h),E(h),x=R;break;case 12:p(g,h),E(h);break;case 31:p(g,h),E(h),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 13:p(g,h),E(h),h.child.flags&8192&&h.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(xn=Ur()),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 22:F=h.memoizedState!==null;var ct=w!==null&&w.memoizedState!==null,Vt=Sc,sn=Ds;if(Sc=Vt||F,Ds=sn||ct,p(g,h),Ds=sn,Sc=Vt,E(h),R&8192)e:for(g=h.stateNode,g._visibility=F?g._visibility&-2:g._visibility|1,F&&(w===null||ct||Sc||Ds||z(h)),w=null,g=h;;){if(g.tag===5||g.tag===26){if(w===null){ct=w=g;try{if(q=ct.stateNode,F)ce=q.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none";else{Re=ct.stateNode;var un=ct.memoizedProps.style,Ut=un!=null&&un.hasOwnProperty("display")?un.display:null;Re.style.display=Ut==null||typeof Ut=="boolean"?"":(""+Ut).trim()}}catch(Wn){ar(ct,ct.return,Wn)}}}else if(g.tag===6){if(w===null){ct=g;try{ct.stateNode.nodeValue=F?"":ct.memoizedProps}catch(Wn){ar(ct,ct.return,Wn)}}}else if(g.tag===18){if(w===null){ct=g;try{var Yt=ct.stateNode;F?qd(Yt,!0):qd(ct.stateNode,!1)}catch(Wn){ar(ct,ct.return,Wn)}}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===h)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break e;for(;g.sibling===null;){if(g.return===null||g.return===h)break e;w===g&&(w=null),g=g.return}w===g&&(w=null),g.sibling.return=g.return,g=g.sibling}R&4&&(R=h.updateQueue,R!==null&&(w=R.retryQueue,w!==null&&(R.retryQueue=null,c(h,w))));break;case 19:p(g,h),E(h),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 30:break;case 21:break;default:p(g,h),E(h)}}function E(h){var g=h.flags;if(g&2){try{for(var w,R=h.return;R!==null;){if(vg(R)){w=R;break}R=R.return}if(w==null)throw Error(u(160));switch(w.tag){case 27:var F=w.stateNode,q=sm(h);am(h,q,F);break;case 5:var ce=w.stateNode;w.flags&32&&(ga(ce,""),w.flags&=-33);var Re=sm(h);am(h,Re,ce);break;case 3:case 4:var ct=w.stateNode.containerInfo,Vt=sm(h);bg(h,Vt,ct);break;default:throw Error(u(161))}}catch(sn){ar(h,h.return,sn)}h.flags&=-3}g&4096&&(h.flags&=-4097)}function I(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var g=h;I(g),g.tag===5&&g.flags&1024&&g.stateNode.reset(),h=h.sibling}}function M(h,g){if(g.subtreeFlags&8772)for(g=g.child;g!==null;)Vo(h,g.alternate,g),g=g.sibling}function z(h){for(h=h.child;h!==null;){var g=h;switch(g.tag){case 0:case 11:case 14:case 15:su(4,g,g.return),z(g);break;case 1:Xl(g,g.return);var w=g.stateNode;typeof w.componentWillUnmount=="function"&&yg(g,g.return,w),z(g);break;case 27:Pg(g.stateNode);case 26:case 5:Xl(g,g.return),z(g);break;case 22:g.memoizedState===null&&z(g);break;case 30:z(g);break;default:z(g)}h=h.sibling}}function O(h,g,w){for(w=w&&(g.subtreeFlags&8772)!==0,g=g.child;g!==null;){var R=g.alternate,F=h,q=g,ce=q.flags;switch(q.tag){case 0:case 11:case 15:O(F,q,w),ru(4,q);break;case 1:if(O(F,q,w),R=q,F=R.stateNode,typeof F.componentDidMount=="function")try{F.componentDidMount()}catch(Vt){ar(R,R.return,Vt)}if(R=q,F=R.updateQueue,F!==null){var Re=R.stateNode;try{var ct=F.shared.hiddenCallbacks;if(ct!==null)for(F.shared.hiddenCallbacks=null,F=0;F<ct.length;F++)xh(ct[F],Re)}catch(Vt){ar(R,R.return,Vt)}}w&&ce&64&&rm(q),Od(q,q.return);break;case 27:Nd(q);case 26:case 5:O(F,q,w),w&&R===null&&ce&4&&xg(q),Od(q,q.return);break;case 12:O(F,q,w);break;case 31:O(F,q,w),w&&ce&4&&tx(F,q);break;case 13:O(F,q,w),w&&ce&4&&f(F,q);break;case 22:q.memoizedState===null&&O(F,q,w),Od(q,q.return);break;case 30:break;default:O(F,q,w)}g=g.sibling}}function H(h,g){var w=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),h=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(h=g.memoizedState.cachePool.pool),h!==w&&(h!=null&&h.refCount++,w!=null&&Xc(w))}function G(h,g){h=null,g.alternate!==null&&(h=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==h&&(g.refCount++,h!=null&&Xc(h))}function $(h,g,w,R){if(g.subtreeFlags&10256)for(g=g.child;g!==null;)J(h,g,w,R),g=g.sibling}function J(h,g,w,R){var F=g.flags;switch(g.tag){case 0:case 11:case 15:$(h,g,w,R),F&2048&&ru(9,g);break;case 1:$(h,g,w,R);break;case 3:$(h,g,w,R),F&2048&&(h=null,g.alternate!==null&&(h=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==h&&(g.refCount++,h!=null&&Xc(h)));break;case 12:if(F&2048){$(h,g,w,R),h=g.stateNode;try{var q=g.memoizedProps,ce=q.id,Re=q.onPostCommit;typeof Re=="function"&&Re(ce,g.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(ct){ar(g,g.return,ct)}}else $(h,g,w,R);break;case 31:$(h,g,w,R);break;case 13:$(h,g,w,R);break;case 23:break;case 22:q=g.stateNode,ce=g.alternate,g.memoizedState!==null?q._visibility&2?$(h,g,w,R):ee(h,g):q._visibility&2?$(h,g,w,R):(q._visibility|=2,Y(h,g,w,R,(g.subtreeFlags&10256)!==0||!1)),F&2048&&H(ce,g);break;case 24:$(h,g,w,R),F&2048&&G(g.alternate,g);break;default:$(h,g,w,R)}}function Y(h,g,w,R,F){for(F=F&&((g.subtreeFlags&10256)!==0||!1),g=g.child;g!==null;){var q=h,ce=g,Re=w,ct=R,Vt=ce.flags;switch(ce.tag){case 0:case 11:case 15:Y(q,ce,Re,ct,F),ru(8,ce);break;case 23:break;case 22:var sn=ce.stateNode;ce.memoizedState!==null?sn._visibility&2?Y(q,ce,Re,ct,F):ee(q,ce):(sn._visibility|=2,Y(q,ce,Re,ct,F)),F&&Vt&2048&&H(ce.alternate,ce);break;case 24:Y(q,ce,Re,ct,F),F&&Vt&2048&&G(ce.alternate,ce);break;default:Y(q,ce,Re,ct,F)}g=g.sibling}}function ee(h,g){if(g.subtreeFlags&10256)for(g=g.child;g!==null;){var w=h,R=g,F=R.flags;switch(R.tag){case 22:ee(w,R),F&2048&&H(R.alternate,R);break;case 24:ee(w,R),F&2048&&G(R.alternate,R);break;default:ee(w,R)}g=g.sibling}}var re=8192;function pe(h,g,w){if(h.subtreeFlags&re)for(h=h.child;h!==null;)fe(h,g,w),h=h.sibling}function fe(h,g,w){switch(h.tag){case 26:pe(h,g,w),h.flags&re&&h.memoizedState!==null&&rl(w,x,h.memoizedState,h.memoizedProps);break;case 5:pe(h,g,w);break;case 3:case 4:var R=x;x=kg(h.stateNode.containerInfo),pe(h,g,w),x=R;break;case 22:h.memoizedState===null&&(R=h.alternate,R!==null&&R.memoizedState!==null?(R=re,re=16777216,pe(h,g,w),re=R):pe(h,g,w));break;default:pe(h,g,w)}}function ue(h){var g=h.alternate;if(g!==null&&(h=g.child,h!==null)){g.child=null;do g=h.sibling,h.sibling=null,h=g;while(h!==null)}}function Ie(h){var g=h.deletions;if((h.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var R=g[w];$r=R,ve(R,h)}ue(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Te(h),h=h.sibling}function Te(h){switch(h.tag){case 0:case 11:case 15:Ie(h),h.flags&2048&&su(9,h,h.return);break;case 3:Ie(h);break;case 12:Ie(h);break;case 22:var g=h.stateNode;h.memoizedState!==null&&g._visibility&2&&(h.return===null||h.return.tag!==13)?(g._visibility&=-3,Ae(h)):Ie(h);break;default:Ie(h)}}function Ae(h){var g=h.deletions;if((h.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var R=g[w];$r=R,ve(R,h)}ue(h)}for(h=h.child;h!==null;){switch(g=h,g.tag){case 0:case 11:case 15:su(8,g,g.return),Ae(g);break;case 22:w=g.stateNode,w._visibility&2&&(w._visibility&=-3,Ae(g));break;default:Ae(g)}h=h.sibling}}function ve(h,g){for(;$r!==null;){var w=$r;switch(w.tag){case 0:case 11:case 15:su(8,w,g);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var R=w.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:Xc(w.memoizedState.cache)}if(R=w.child,R!==null)R.return=w,$r=R;else e:for(w=h;$r!==null;){R=$r;var F=R.sibling,q=R.return;if(Bd(R),R===w){$r=null;break e}if(F!==null){F.return=q,$r=F;break e}$r=q}}}var ge={getCacheForType:function(h){var g=ba(Ar),w=g.data.get(h);return w===void 0&&(w=h(),g.data.set(h,w)),w},cacheSignal:function(){return ba(Ar).controller.signal}},Pe=typeof WeakMap=="function"?WeakMap:Map,Le=0,Fe=null,We=null,$e=0,lt=0,xt=null,Qe=!1,ke=!1,mt=!1,nt=0,yt=0,Pt=0,qt=0,zt=0,kt=0,cn=0,an=null,$t=null,on=!1,xn=0,Mn=0,Vn=1/0,ti=null,Dn=null,jn=0,On=null,bi=null,mi=0,ki=0,li=null,Un=null,yi=0,gr=null;function Li(){return(Le&2)!==0&&$e!==0?$e&-$e:wt.T!==null?Eg():ne()}function Ai(){if(kt===0)if(($e&536870912)===0||pr){var h=bo;bo<<=1,(bo&3932160)===0&&(bo=262144),kt=h}else kt=536870912;return h=Da.current,h!==null&&(h.flags|=32),kt}function Bn(h,g,w){(h===Fe&&(lt===2||lt===9)||h.cancelPendingCommit!==null)&&(Js(h,0),Fi(h,$e,kt,!1)),hl(h,w),((Le&2)===0||h!==Fe)&&(h===Fe&&((Le&2)===0&&(qt|=w),yt===4&&Fi(h,$e,kt,!1)),ju(h))}function qn(h,g,w){if((Le&6)!==0)throw Error(u(327));var R=!w&&(g&127)===0&&(g&h.expiredLanes)===0||wo(h,g),F=R?Tr(h,g):jo(h,g,!0),q=R;do{if(F===0){ke&&!R&&Fi(h,g,0,!1);break}else{if(w=h.current.alternate,q&&!zr(w)){F=jo(h,g,!1),q=!1;continue}if(F===2){if(q=g,h.errorRecoveryDisabledLanes&q)var ce=0;else ce=h.pendingLanes&-536870913,ce=ce!==0?ce:ce&536870912?536870912:0;if(ce!==0){g=ce;e:{var Re=h;F=an;var ct=Re.current.memoizedState.isDehydrated;if(ct&&(Js(Re,ce).flags|=256),ce=jo(Re,ce,!1),ce!==2){if(mt&&!ct){Re.errorRecoveryDisabledLanes|=q,qt|=q,F=4;break e}q=$t,$t=F,q!==null&&($t===null?$t=q:$t.push.apply($t,q))}F=ce}if(q=!1,F!==2)continue}}if(F===1){Js(h,0),Fi(h,g,0,!0);break}e:{switch(R=h,q=F,q){case 0:case 1:throw Error(u(345));case 4:if((g&4194048)!==g)break;case 6:Fi(R,g,kt,!Qe);break e;case 2:$t=null;break;case 3:case 5:break;default:throw Error(u(329))}if((g&62914560)===g&&(F=xn+300-Ur(),10<F)){if(Fi(R,g,kt,!Qe),Yr(R,0,!0)!==0)break e;mi=g,R.timeoutHandle=cm(Ji.bind(null,R,w,$t,ti,on,g,kt,qt,cn,Qe,q,"Throttled",-0,0),F);break e}Ji(R,w,$t,ti,on,g,kt,qt,cn,Qe,q,null,-0,0)}}break}while(!0);ju(h)}function Ji(h,g,w,R,F,q,ce,Re,ct,Vt,sn,un,Ut,Yt){if(h.timeoutHandle=-1,un=g.subtreeFlags,un&8192||(un&16785408)===16785408){un={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ss},fe(g,q,un);var Wn=(q&62914560)===q?xn-Ur():(q&4194048)===q?Mn-Ur():0;if(Wn=v0(un,Wn),Wn!==null){mi=q,h.cancelPendingCommit=Wn(Fd.bind(null,h,g,q,w,R,F,ce,Re,ct,sn,un,null,Ut,Yt)),Fi(h,q,ce,!Vt);return}}Fd(h,g,q,w,R,F,ce,Re,ct)}function zr(h){for(var g=h;;){var w=g.tag;if((w===0||w===11||w===15)&&g.flags&16384&&(w=g.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var R=0;R<w.length;R++){var F=w[R],q=F.getSnapshot;F=F.value;try{if(!oo(q(),F))return!1}catch{return!1}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Fi(h,g,w,R){g&=~zt,g&=~qt,h.suspendedLanes|=g,h.pingedLanes&=~g,R&&(h.warmLanes|=g),R=h.expirationTimes;for(var F=g;0<F;){var q=31-Vi(F),ce=1<<q;R[q]=-1,F&=~ce}w!==0&&no(h,w,g)}function er(){return(Le&6)===0?(Ud(0),!1):!0}function Ta(){if(We!==null){if(lt===0)var h=We.return;else h=We,mc=gl=null,Nf(h),Cu=null,bd=0,h=We;for(;h!==null;)_g(h.alternate,h),h=h.return;We=null}}function Js(h,g){var w=h.timeoutHandle;w!==-1&&(h.timeoutHandle=-1,W1(w)),w=h.cancelPendingCommit,w!==null&&(h.cancelPendingCommit=null,w()),mi=0,Ta(),Fe=h,We=w=co(h.current,null),$e=g,lt=0,xt=null,Qe=!1,ke=wo(h,g),mt=!1,cn=kt=zt=qt=Pt=yt=0,$t=an=null,on=!1,(g&8)!==0&&(g|=g&32);var R=h.entangledLanes;if(R!==0)for(h=h.entanglements,R&=g;0<R;){var F=31-Vi(R),q=1<<F;g|=h[F],R&=~q}return nt=g,uh(),w}function Ps(h,g){Bt=null,wt.H=ql,g===vd||g===Mf?(g=Qm(),lt=3):g===Km?(g=Qm(),lt=4):lt=g===Xf?8:g!==null&&typeof g=="object"&&typeof g.then=="function"?6:1,xt=g,We===null&&(yt=1,Wf(h,oa(g,h.current)))}function Ii(){var h=Da.current;return h===null?!0:($e&4194048)===$e?wa===null:($e&62914560)===$e||($e&536870912)!==0?h===wa:!1}function fo(){var h=wt.H;return wt.H=ql,h===null?ql:h}function ea(){var h=wt.A;return wt.A=ge,h}function ca(){yt=4,Qe||($e&4194048)!==$e&&Da.current!==null||(ke=!0),(Pt&134217727)===0&&(qt&134217727)===0||Fe===null||Fi(Fe,$e,kt,!1)}function jo(h,g,w){var R=Le;Le|=2;var F=fo(),q=ea();(Fe!==h||$e!==g)&&(ti=null,Js(h,g)),g=!1;var ce=yt;e:do try{if(lt!==0&&We!==null){var Re=We,ct=xt;switch(lt){case 8:Ta(),ce=6;break e;case 3:case 2:case 9:case 6:Da.current===null&&(g=!0);var Vt=lt;if(lt=0,xt=null,Cs(h,Re,ct,Vt),w&&ke){ce=0;break e}break;default:Vt=lt,lt=0,xt=null,Cs(h,Re,ct,Vt)}}Xa(),ce=yt;break}catch(sn){Ps(h,sn)}while(!0);return g&&h.shellSuspendCounter++,mc=gl=null,Le=R,wt.H=F,wt.A=q,We===null&&(Fe=null,$e=0,uh()),ce}function Xa(){for(;We!==null;)rr(We)}function Tr(h,g){var w=Le;Le|=2;var R=fo(),F=ea();Fe!==h||$e!==g?(ti=null,Vn=Ur()+500,Js(h,g)):ke=wo(h,g);e:do try{if(lt!==0&&We!==null){g=We;var q=xt;t:switch(lt){case 1:lt=0,xt=null,Cs(h,g,q,1);break;case 2:case 9:if(Pf(q)){lt=0,xt=null,rs(g);break}g=function(){lt!==2&&lt!==9||Fe!==h||(lt=7),ju(h)},q.then(g,g);break e;case 3:lt=7;break e;case 4:lt=5;break e;case 7:Pf(q)?(lt=0,xt=null,rs(g)):(lt=0,xt=null,Cs(h,g,q,7));break;case 5:var ce=null;switch(We.tag){case 26:ce=We.memoizedState;case 5:case 27:var Re=We;if(ce?wx(ce):Re.stateNode.complete){lt=0,xt=null;var ct=Re.sibling;if(ct!==null)We=ct;else{var Vt=Re.return;Vt!==null?(We=Vt,Ir(Vt)):We=null}break t}}lt=0,xt=null,Cs(h,g,q,5);break;case 6:lt=0,xt=null,Cs(h,g,q,6);break;case 8:Ta(),yt=6;break e;default:throw Error(u(462))}}Qr();break}catch(sn){Ps(h,sn)}while(!0);return mc=gl=null,wt.H=R,wt.A=F,Le=w,We!==null?0:(Fe=null,$e=0,uh(),yt)}function Qr(){for(;We!==null&&!Rl();)rr(We)}function rr(h){var g=Jf(h.alternate,h,nt);h.memoizedProps=h.pendingProps,g===null?Ir(h):We=g}function rs(h){var g=h,w=g.alternate;switch(g.tag){case 15:case 0:g=Yf(w,g,g.pendingProps,g.type,void 0,$e);break;case 11:g=Yf(w,g,g.pendingProps,g.type.render,g.ref,$e);break;case 5:Nf(g);default:_g(w,g),g=We=qc(g,nt),g=Jf(w,g,nt)}h.memoizedProps=h.pendingProps,g===null?Ir(h):We=g}function Cs(h,g,w,R){mc=gl=null,Nf(g),Cu=null,bd=0;var F=g.return;try{if(Rd(h,F,g,w,$e)){yt=1,Wf(h,oa(w,h.current)),We=null;return}}catch(q){if(F!==null)throw We=F,q;yt=1,Wf(h,oa(w,h.current)),We=null;return}g.flags&32768?(pr||R===1?h=!0:ke||($e&536870912)!==0?h=!1:(Qe=h=!0,(R===2||R===9||R===3||R===6)&&(R=Da.current,R!==null&&R.tag===13&&(R.flags|=16384))),po(g,h)):Ir(g)}function Ir(h){var g=h;do{if((g.flags&32768)!==0){po(g,Qe);return}h=g.return;var w=tp(g.alternate,g,nt);if(w!==null){We=w;return}if(g=g.sibling,g!==null){We=g;return}We=g=h}while(g!==null);yt===0&&(yt=5)}function po(h,g){do{var w=P_(h.alternate,h);if(w!==null){w.flags&=32767,We=w;return}if(w=h.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!g&&(h=h.sibling,h!==null)){We=h;return}We=h=w}while(h!==null);yt=6,We=null}function Fd(h,g,w,R,F,q,ce,Re,ct){h.cancelPendingCommit=null;do il();while(jn!==0);if((Le&6)!==0)throw Error(u(327));if(g!==null){if(g===h.current)throw Error(u(177));if(q=g.lanes|g.childLanes,q|=xf,Mt(h,w,q,ce,Re,ct),h===Fe&&(We=Fe=null,$e=0),bi=g,On=h,mi=w,ki=q,li=F,Un=R,(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,r0(ri,function(){return Kl(),null})):(h.callbackNode=null,h.callbackPriority=0),R=(g.flags&13878)!==0,(g.subtreeFlags&13878)!==0||R){R=wt.T,wt.T=null,F=Jt.p,Jt.p=2,ce=Le,Le|=4;try{ds(h,g,w)}finally{Le=ce,Jt.p=F,wt.T=R}}jn=1,Yl(),Nh(),Bh()}}function Yl(){if(jn===1){jn=0;var h=On,g=bi,w=(g.flags&13878)!==0;if((g.subtreeFlags&13878)!==0||w){w=wt.T,wt.T=null;var R=Jt.p;Jt.p=2;var F=Le;Le|=4;try{b(g,h);var q=B_,ce=y_(h.containerInfo),Re=q.focusedElem,ct=q.selectionRange;if(ce!==Re&&Re&&Re.ownerDocument&&Vc(Re.ownerDocument.documentElement,Re)){if(ct!==null&&lh(Re)){var Vt=ct.start,sn=ct.end;if(sn===void 0&&(sn=Vt),"selectionStart"in Re)Re.selectionStart=Vt,Re.selectionEnd=Math.min(sn,Re.value.length);else{var un=Re.ownerDocument||document,Ut=un&&un.defaultView||window;if(Ut.getSelection){var Yt=Ut.getSelection(),Wn=Re.textContent.length,fi=Math.min(ct.start,Wn),Zr=ct.end===void 0?fi:Math.min(ct.end,Wn);!Yt.extend&&fi>Zr&&(ce=Zr,Zr=fi,fi=ce);var Rt=Yo(Re,fi),gt=Yo(Re,Zr);if(Rt&&gt&&(Yt.rangeCount!==1||Yt.anchorNode!==Rt.node||Yt.anchorOffset!==Rt.offset||Yt.focusNode!==gt.node||Yt.focusOffset!==gt.offset)){var Nt=un.createRange();Nt.setStart(Rt.node,Rt.offset),Yt.removeAllRanges(),fi>Zr?(Yt.addRange(Nt),Yt.extend(gt.node,gt.offset)):(Nt.setEnd(gt.node,gt.offset),Yt.addRange(Nt))}}}}for(un=[],Yt=Re;Yt=Yt.parentNode;)Yt.nodeType===1&&un.push({element:Yt,left:Yt.scrollLeft,top:Yt.scrollTop});for(typeof Re.focus=="function"&&Re.focus(),Re=0;Re<un.length;Re++){var ln=un[Re];ln.element.scrollLeft=ln.left,ln.element.scrollTop=ln.top}}Bg=!!N_,B_=N_=null}finally{Le=F,Jt.p=R,wt.T=w}}h.current=g,jn=2}}function Nh(){if(jn===2){jn=0;var h=On,g=bi,w=(g.flags&8772)!==0;if((g.subtreeFlags&8772)!==0||w){w=wt.T,wt.T=null;var R=Jt.p;Jt.p=2;var F=Le;Le|=4;try{Vo(h,g.alternate,g)}finally{Le=F,Jt.p=R,wt.T=w}}jn=3}}function Bh(){if(jn===4||jn===3){jn=0,rc();var h=On,g=bi,w=mi,R=Un;(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?jn=5:(jn=0,bi=On=null,mo(h,h.pendingLanes));var F=h.pendingLanes;if(F===0&&(Dn=null),Ue(w),g=g.stateNode,kr&&typeof kr.onCommitFiberRoot=="function")try{kr.onCommitFiberRoot(ps,g,void 0,(g.current.flags&128)===128)}catch{}if(R!==null){g=wt.T,F=Jt.p,Jt.p=2,wt.T=null;try{for(var q=h.onRecoverableError,ce=0;ce<R.length;ce++){var Re=R[ce];q(Re.value,{componentStack:Re.stack})}}finally{wt.T=g,Jt.p=F}}(mi&3)!==0&&il(),ju(h),F=h.pendingLanes,(w&261930)!==0&&(F&42)!==0?h===gr?yi++:(yi=0,gr=h):yi=0,Ud(0)}}function mo(h,g){(h.pooledCacheLanes&=g)===0&&(g=h.pooledCache,g!=null&&(h.pooledCache=null,Xc(g)))}function il(){return Yl(),Nh(),Bh(),Kl()}function Kl(){if(jn!==5)return!1;var h=On,g=ki;ki=0;var w=Ue(mi),R=wt.T,F=Jt.p;try{Jt.p=32>w?32:w,wt.T=null,w=li,li=null;var q=On,ce=mi;if(jn=0,bi=On=null,mi=0,(Le&6)!==0)throw Error(u(331));var Re=Le;if(Le|=4,Te(q.current),J(q,q.current,ce,w),Le=Re,Ud(0,!1),kr&&typeof kr.onPostCommitFiberRoot=="function")try{kr.onPostCommitFiberRoot(ps,q)}catch{}return!0}finally{Jt.p=F,wt.T=R,mo(h,g)}}function Uo(h,g,w){g=oa(w,g),g=Hl(h.stateNode,g,2),h=Jc(h,g,2),h!==null&&(hl(h,2),ju(h))}function ar(h,g,w){if(h.tag===3)Uo(h,h,w);else for(;g!==null;){if(g.tag===3){Uo(g,h,w);break}else if(g.tag===1){var R=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Dn===null||!Dn.has(R))){h=oa(w,h),w=Tc(2),R=Jc(g,w,2),R!==null&&(Gs(w,R,g,h),hl(R,2),ju(R));break}}g=g.return}}function ou(h,g,w){var R=h.pingCache;if(R===null){R=h.pingCache=new Pe;var F=new Set;R.set(g,F)}else F=R.get(g),F===void 0&&(F=new Set,R.set(g,F));F.has(w)||(mt=!0,F.add(w),h=om.bind(null,h,g,w),g.then(h,h))}function om(h,g,w){var R=h.pingCache;R!==null&&R.delete(g),h.pingedLanes|=h.suspendedLanes&w,h.warmLanes&=~w,Fe===h&&($e&w)===w&&(yt===4||yt===3&&($e&62914560)===$e&&300>Ur()-xn?(Le&2)===0&&Js(h,0):zt|=w,cn===$e&&(cn=0)),ju(h)}function nx(h,g){g===0&&(g=ja()),h=jt(h,g),h!==null&&(hl(h,g),ju(h))}function n0(h){var g=h.memoizedState,w=0;g!==null&&(w=g.retryLane),nx(h,w)}function i0(h,g){var w=0;switch(h.tag){case 31:case 13:var R=h.stateNode,F=h.memoizedState;F!==null&&(w=F.retryLane);break;case 19:R=h.stateNode;break;case 22:R=h.stateNode._retryCache;break;default:throw Error(u(314))}R!==null&&R.delete(g),nx(h,w)}function r0(h,g){return _r(h,g)}var wg=null,Ac=null,k_=!1,ua=!1,Vd=!1,jd=0;function ju(h){h!==Ac&&h.next===null&&(Ac===null?wg=Ac=h:Ac=Ac.next=h),ua=!0,k_||(k_=!0,H1())}function Ud(h,g){if(!Vd&&ua){Vd=!0;do for(var w=!1,R=wg;R!==null;){if(h!==0){var F=R.pendingLanes;if(F===0)var q=0;else{var ce=R.suspendedLanes,Re=R.pingedLanes;q=(1<<31-Vi(42|h)+1)-1,q&=F&~(ce&~Re),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(w=!0,rx(R,q))}else q=$e,q=Yr(R,R===Fe?q:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(q&3)===0||wo(R,q)||(w=!0,rx(R,q));R=R.next}while(w);Vd=!1}}function q1(){ix()}function ix(){ua=k_=!1;var h=0;jd!==0&&f0()&&(h=jd);for(var g=Ur(),w=null,R=wg;R!==null;){var F=R.next,q=Tg(R,g);q===0?(R.next=null,w===null?wg=F:w.next=F,F===null&&(Ac=w)):(w=R,(h!==0||(q&3)!==0)&&(ua=!0)),R=F}jn!==0&&jn!==5||Ud(h),jd!==0&&(jd=0)}function Tg(h,g){for(var w=h.suspendedLanes,R=h.pingedLanes,F=h.expirationTimes,q=h.pendingLanes&-62914561;0<q;){var ce=31-Vi(q),Re=1<<ce,ct=F[ce];ct===-1?((Re&w)===0||(Re&R)!==0)&&(F[ce]=_u(Re,g)):ct<=g&&(h.expiredLanes|=Re),q&=~Re}if(g=Fe,w=$e,w=Yr(h,h===g?w:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),R=h.callbackNode,w===0||h===g&&(lt===2||lt===9)||h.cancelPendingCommit!==null)return R!==null&&R!==null&&Xs(R),h.callbackNode=null,h.callbackPriority=0;if((w&3)===0||wo(h,w)){if(g=w&-w,g===h.callbackPriority)return g;switch(R!==null&&Xs(R),Ue(w)){case 2:case 8:w=Tn;break;case 32:w=ri;break;case 268435456:w=Ri;break;default:w=ri}return R=s0.bind(null,h),w=_r(w,R),h.callbackPriority=g,h.callbackNode=w,g}return R!==null&&R!==null&&Xs(R),h.callbackPriority=2,h.callbackNode=null,2}function s0(h,g){if(jn!==0&&jn!==5)return h.callbackNode=null,h.callbackPriority=0,null;var w=h.callbackNode;if(il()&&h.callbackNode!==w)return null;var R=$e;return R=Yr(h,h===Fe?R:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),R===0?null:(qn(h,R,g),Tg(h,Ur()),h.callbackNode!=null&&h.callbackNode===w?s0.bind(null,h):null)}function rx(h,g){if(il())return null;qn(h,g,!0)}function H1(){X1(function(){(Le&6)!==0?_r(en,q1):ix()})}function Eg(){if(jd===0){var h=Yc;h===0&&(h=Ca,Ca<<=1,(Ca&261888)===0&&(Ca=256)),jd=h}return jd}function lu(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:Eo(""+h)}function Uu(h,g){var w=g.ownerDocument.createElement("input");return w.name=g.name,w.value=g.value,h.id&&w.setAttribute("form",h.id),g.parentNode.insertBefore(w,g),h=new FormData(h),w.parentNode.removeChild(w),h}function a0(h,g,w,R,F){if(g==="submit"&&w&&w.stateNode===F){var q=lu((F[xe]||null).action),ce=R.submitter;ce&&(g=(g=ce[xe]||null)?lu(g.formAction):ce.getAttribute("formAction"),g!==null&&(q=g,ce=null));var Re=new Ro("action","action",null,R,F);h.push({event:Re,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(jd!==0){var ct=ce?Uu(F,ce):new FormData(F);Uf(w,{pending:!0,data:ct,method:F.method,action:q},null,ct)}}else typeof q=="function"&&(Re.preventDefault(),ct=ce?Uu(F,ce):new FormData(F),Uf(w,{pending:!0,data:ct,method:F.method,action:q},q,ct))},currentTarget:F}]})}}for(var L_=0;L_<$a.length;L_++){var lm=$a[L_],sx=lm.toLowerCase(),Sg=lm[0].toUpperCase()+lm.slice(1);Qo(sx,"on"+Sg)}Qo(Cp,"onAnimationEnd"),Qo(x_,"onAnimationIteration"),Qo(uc,"onAnimationStart"),Qo("dblclick","onDoubleClick"),Qo("focusin","onFocus"),Qo("focusout","onBlur"),Qo(v_,"onTransitionRun"),Qo(b_,"onTransitionStart"),Qo(Rp,"onTransitionCancel"),Qo(Mp,"onTransitionEnd"),nr("onMouseEnter",["mouseout","mouseover"]),nr("onMouseLeave",["mouseout","mouseover"]),nr("onPointerEnter",["pointerout","pointerover"]),nr("onPointerLeave",["pointerout","pointerover"]),vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vr("onBeforeInput",["compositionend","keypress","textInput","paste"]),vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gd));function Ag(h,g){g=(g&4)!==0;for(var w=0;w<h.length;w++){var R=h[w],F=R.event;R=R.listeners;e:{var q=void 0;if(g)for(var ce=R.length-1;0<=ce;ce--){var Re=R[ce],ct=Re.instance,Vt=Re.currentTarget;if(Re=Re.listener,ct!==q&&F.isPropagationStopped())break e;q=Re,F.currentTarget=Vt;try{q(F)}catch(sn){ld(sn)}F.currentTarget=null,q=ct}else for(ce=0;ce<R.length;ce++){if(Re=R[ce],ct=Re.instance,Vt=Re.currentTarget,Re=Re.listener,ct!==q&&F.isPropagationStopped())break e;q=Re,F.currentTarget=Vt;try{q(F)}catch(sn){ld(sn)}F.currentTarget=null,q=ct}}}}function or(h,g){var w=g[it];w===void 0&&(w=g[it]=new Set);var R=h+"__bubble";w.has(R)||(Fh(g,h,2,!1),w.add(R))}function Ig(h,g,w){var R=0;g&&(R|=4),Fh(w,h,R,g)}var Cg="_reactListening"+Math.random().toString(36).slice(2);function z_(h){if(!h[Cg]){h[Cg]=!0,Pn.forEach(function(w){w!=="selectionchange"&&(o0.has(w)||Ig(w,!1,h),Ig(w,!0,h))});var g=h.nodeType===9?h:h.ownerDocument;g===null||g[Cg]||(g[Cg]=!0,Ig("selectionchange",!1,g))}}function Fh(h,g,w,R){switch(S0(g)){case 2:var F=q_;break;case 8:F=E0;break;default:F=fm}w=F.bind(null,g,w,h),F=void 0,!Ml||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(F=!0),R?F!==void 0?h.addEventListener(g,w,{capture:!0,passive:F}):h.addEventListener(g,w,!0):F!==void 0?h.addEventListener(g,w,{passive:F}):h.addEventListener(g,w,!1)}function O_(h,g,w,R,F){var q=R;if((g&1)===0&&(g&2)===0&&R!==null)e:for(;;){if(R===null)return;var ce=R.tag;if(ce===3||ce===4){var Re=R.stateNode.containerInfo;if(Re===F)break;if(ce===4)for(ce=R.return;ce!==null;){var ct=ce.tag;if((ct===3||ct===4)&&ce.stateNode.containerInfo===F)return;ce=ce.return}for(;Re!==null;){if(ce=yn(Re),ce===null)return;if(ct=ce.tag,ct===5||ct===6||ct===26||ct===27){R=q=ce;continue e}Re=Re.parentNode}}R=R.return}Oc(function(){var Vt=q,sn=Ra(w),un=[];e:{var Ut=Uc.get(h);if(Ut!==void 0){var Yt=Ro,Wn=h;switch(h){case"keypress":if(di(w)===0)break e;case"keydown":case"keyup":Yt=va;break;case"focusin":Wn="focus",Yt=Vs;break;case"focusout":Wn="blur",Yt=Vs;break;case"beforeblur":case"afterblur":Yt=Vs;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=Fc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=ac;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=ie;break;case Cp:case x_:case uc:Yt=sh;break;case Mp:Yt=Ce;break;case"scroll":case"scrollend":Yt=Bc;break;case"wheel":Yt=Gt;break;case"copy":case"cut":case"paste":Yt=Si;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=pi;break;case"toggle":case"beforetoggle":Yt=oi}var fi=(g&4)!==0,Zr=!fi&&(h==="scroll"||h==="scrollend"),Rt=fi?Ut!==null?Ut+"Capture":null:Ut;fi=[];for(var gt=Vt,Nt;gt!==null;){var ln=gt;if(Nt=ln.stateNode,ln=ln.tag,ln!==5&&ln!==26&&ln!==27||Nt===null||Rt===null||(ln=fl(gt,Rt),ln!=null&&fi.push(np(gt,ln,Nt))),Zr)break;gt=gt.return}0<fi.length&&(Ut=new Yt(Ut,Wn,null,w,sn),un.push({event:Ut,listeners:fi}))}}if((g&7)===0){e:{if(Ut=h==="mouseover"||h==="pointerover",Yt=h==="mouseout"||h==="pointerout",Ut&&w!==So&&(Wn=w.relatedTarget||w.fromElement)&&(yn(Wn)||Wn[Be]))break e;if((Yt||Ut)&&(Ut=sn.window===sn?sn:(Ut=sn.ownerDocument)?Ut.defaultView||Ut.parentWindow:window,Yt?(Wn=w.relatedTarget||w.toElement,Yt=Vt,Wn=Wn?yn(Wn):null,Wn!==null&&(Zr=T(Wn),fi=Wn.tag,Wn!==Zr||fi!==5&&fi!==27&&fi!==6)&&(Wn=null)):(Yt=null,Wn=Vt),Yt!==Wn)){if(fi=Fc,ln="onMouseLeave",Rt="onMouseEnter",gt="mouse",(h==="pointerout"||h==="pointerover")&&(fi=pi,ln="onPointerLeave",Rt="onPointerEnter",gt="pointer"),Zr=Yt==null?Ut:kn(Yt),Nt=Wn==null?Ut:kn(Wn),Ut=new fi(ln,gt+"leave",Yt,w,sn),Ut.target=Zr,Ut.relatedTarget=Nt,ln=null,yn(sn)===Vt&&(fi=new fi(Rt,gt+"enter",Wn,w,sn),fi.target=Nt,fi.relatedTarget=Zr,ln=fi),Zr=ln,Yt&&Wn)t:{for(fi=$1,Rt=Yt,gt=Wn,Nt=0,ln=Rt;ln;ln=fi(ln))Nt++;ln=0;for(var gi=gt;gi;gi=fi(gi))ln++;for(;0<Nt-ln;)Rt=fi(Rt),Nt--;for(;0<ln-Nt;)gt=fi(gt),ln--;for(;Nt--;){if(Rt===gt||gt!==null&&Rt===gt.alternate){fi=Rt;break t}Rt=fi(Rt),gt=fi(gt)}fi=null}else fi=null;Yt!==null&&l0(un,Ut,Yt,fi,!1),Wn!==null&&Zr!==null&&l0(un,Zr,Wn,fi,!0)}}e:{if(Ut=Vt?kn(Vt):window,Yt=Ut.nodeName&&Ut.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&Ut.type==="file")var Or=mn;else if(Is(Ut))if(oh)Or=od;else{Or=cc;var ni=Zm}else Yt=Ut.nodeName,!Yt||Yt.toLowerCase()!=="input"||Ut.type!=="checkbox"&&Ut.type!=="radio"?Vt&&yu(Vt.elementType)&&(Or=mn):Or=__;if(Or&&(Or=Or(h,Vt))){kl(un,Or,w,sn);break e}ni&&ni(h,Ut,Vt),h==="focusout"&&Vt&&Ut.type==="number"&&Vt.memoizedProps.value!=null&&$o(Ut,"number",Ut.value)}switch(ni=Vt?kn(Vt):window,h){case"focusin":(Is(ni)||ni.contentEditable==="true")&&(jc=ni,Ap=Vt,Ha=null);break;case"focusout":Ha=Ap=jc=null;break;case"mousedown":Ip=!0;break;case"contextmenu":case"mouseup":case"dragend":Ip=!1,yf(un,w,sn);break;case"selectionchange":if(_f)break;case"keydown":case"keyup":yf(un,w,sn)}var tr;if(Lr)e:{switch(h){case"compositionstart":var xr="onCompositionStart";break e;case"compositionend":xr="onCompositionEnd";break e;case"compositionupdate":xr="onCompositionUpdate";break e}xr=void 0}else Ks?lc(h,w)&&(xr="onCompositionEnd"):h==="keydown"&&w.keyCode===229&&(xr="onCompositionStart");xr&&(Po&&w.locale!=="ko"&&(Ks||xr!=="onCompositionStart"?xr==="onCompositionEnd"&&Ks&&(tr=rh()):(_a=sn,Nc="value"in _a?_a.value:_a.textContent,Ks=!0)),ni=Rg(Vt,xr),0<ni.length&&(xr=new Pl(xr,h,null,w,sn),un.push({event:xr,listeners:ni}),tr?xr.data=tr:(tr=Rs(w),tr!==null&&(xr.data=tr)))),(tr=Do?so(h,w):$m(h,w))&&(xr=Rg(Vt,"onBeforeInput"),0<xr.length&&(ni=new Pl("onBeforeInput","beforeinput",null,w,sn),un.push({event:ni,listeners:xr}),ni.data=tr)),a0(un,h,Vt,w,sn)}Ag(un,g)})}function np(h,g,w){return{instance:h,listener:g,currentTarget:w}}function Rg(h,g){for(var w=g+"Capture",R=[];h!==null;){var F=h,q=F.stateNode;if(F=F.tag,F!==5&&F!==26&&F!==27||q===null||(F=fl(h,w),F!=null&&R.unshift(np(h,F,q)),F=fl(h,g),F!=null&&R.push(np(h,F,q))),h.tag===3)return R;h=h.return}return[]}function $1(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function l0(h,g,w,R,F){for(var q=g._reactName,ce=[];w!==null&&w!==R;){var Re=w,ct=Re.alternate,Vt=Re.stateNode;if(Re=Re.tag,ct!==null&&ct===R)break;Re!==5&&Re!==26&&Re!==27||Vt===null||(ct=Vt,F?(Vt=fl(w,q),Vt!=null&&ce.unshift(np(w,Vt,ct))):F||(Vt=fl(w,q),Vt!=null&&ce.push(np(w,Vt,ct)))),w=w.return}ce.length!==0&&h.push({event:g,listeners:ce})}var Z1=/\r\n?/g,c0=/\u0000|\uFFFD/g;function ax(h){return(typeof h=="string"?h:""+h).replace(Z1,`
`).replace(c0,"")}function u0(h,g){return g=ax(g),ax(h)===g}function ss(h,g,w,R,F,q){switch(w){case"children":typeof R=="string"?g==="body"||g==="textarea"&&R===""||ga(h,R):(typeof R=="number"||typeof R=="bigint")&&g!=="body"&&ga(h,""+R);break;case"className":_i(h,"class",R);break;case"tabIndex":_i(h,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":_i(h,w,R);break;case"style":nh(h,R,q);break;case"data":if(g!=="object"){_i(h,"data",R);break}case"src":case"href":if(R===""&&(g!=="a"||w!=="href")){h.removeAttribute(w);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){h.removeAttribute(w);break}R=Eo(""+R),h.setAttribute(w,R);break;case"action":case"formAction":if(typeof R=="function"){h.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(w==="formAction"?(g!=="input"&&ss(h,g,"name",F.name,F,null),ss(h,g,"formEncType",F.formEncType,F,null),ss(h,g,"formMethod",F.formMethod,F,null),ss(h,g,"formTarget",F.formTarget,F,null)):(ss(h,g,"encType",F.encType,F,null),ss(h,g,"method",F.method,F,null),ss(h,g,"target",F.target,F,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){h.removeAttribute(w);break}R=Eo(""+R),h.setAttribute(w,R);break;case"onClick":R!=null&&(h.onclick=Ss);break;case"onScroll":R!=null&&or("scroll",h);break;case"onScrollEnd":R!=null&&or("scrollend",h);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(u(61));if(w=R.__html,w!=null){if(F.children!=null)throw Error(u(60));h.innerHTML=w}}break;case"multiple":h.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":h.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){h.removeAttribute("xlink:href");break}w=Eo(""+R),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,""+R):h.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,""):h.removeAttribute(w);break;case"capture":case"download":R===!0?h.setAttribute(w,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,R):h.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?h.setAttribute(w,R):h.removeAttribute(w);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?h.removeAttribute(w):h.setAttribute(w,R);break;case"popover":or("beforetoggle",h),or("toggle",h),Ni(h,"popover",R);break;case"xlinkActuate":Ei(h,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":Ei(h,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":Ei(h,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":Ei(h,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":Ei(h,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":Ei(h,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":Ei(h,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":Ei(h,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":Ei(h,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":Ni(h,"is",R);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=Es.get(w)||w,Ni(h,w,R))}}function ox(h,g,w,R,F,q){switch(w){case"style":nh(h,R,q);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(u(61));if(w=R.__html,w!=null){if(F.children!=null)throw Error(u(60));h.innerHTML=w}}break;case"children":typeof R=="string"?ga(h,R):(typeof R=="number"||typeof R=="bigint")&&ga(h,""+R);break;case"onScroll":R!=null&&or("scroll",h);break;case"onScrollEnd":R!=null&&or("scrollend",h);break;case"onClick":R!=null&&(h.onclick=Ss);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$i.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(F=w.endsWith("Capture"),g=w.slice(2,F?w.length-7:void 0),q=h[xe]||null,q=q!=null?q[w]:null,typeof q=="function"&&h.removeEventListener(g,q,F),typeof R=="function")){typeof q!="function"&&q!==null&&(w in h?h[w]=null:h.hasAttribute(w)&&h.removeAttribute(w)),h.addEventListener(g,R,F);break e}w in h?h[w]=R:R===!0?h.setAttribute(w,""):Ni(h,w,R)}}}function go(h,g,w){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":or("error",h),or("load",h);var R=!1,F=!1,q;for(q in w)if(w.hasOwnProperty(q)){var ce=w[q];if(ce!=null)switch(q){case"src":R=!0;break;case"srcSet":F=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,g));default:ss(h,g,q,ce,w,null)}}F&&ss(h,g,"srcSet",w.srcSet,w,null),R&&ss(h,g,"src",w.src,w,null);return;case"input":or("invalid",h);var Re=q=ce=F=null,ct=null,Vt=null;for(R in w)if(w.hasOwnProperty(R)){var sn=w[R];if(sn!=null)switch(R){case"name":F=sn;break;case"type":ce=sn;break;case"checked":ct=sn;break;case"defaultChecked":Vt=sn;break;case"value":q=sn;break;case"defaultValue":Re=sn;break;case"children":case"dangerouslySetInnerHTML":if(sn!=null)throw Error(u(137,g));break;default:ss(h,g,R,sn,w,null)}}aa(h,q,Re,ct,Vt,ce,F,!1);return;case"select":or("invalid",h),R=ce=q=null;for(F in w)if(w.hasOwnProperty(F)&&(Re=w[F],Re!=null))switch(F){case"value":q=Re;break;case"defaultValue":ce=Re;break;case"multiple":R=Re;default:ss(h,g,F,Re,w,null)}g=q,w=ce,h.multiple=!!R,g!=null?To(h,!!R,g,!1):w!=null&&To(h,!!R,w,!0);return;case"textarea":or("invalid",h),q=F=R=null;for(ce in w)if(w.hasOwnProperty(ce)&&(Re=w[ce],Re!=null))switch(ce){case"value":R=Re;break;case"defaultValue":F=Re;break;case"children":q=Re;break;case"dangerouslySetInnerHTML":if(Re!=null)throw Error(u(91));break;default:ss(h,g,ce,Re,w,null)}dl(h,R,F,q);return;case"option":for(ct in w)if(w.hasOwnProperty(ct)&&(R=w[ct],R!=null))switch(ct){case"selected":h.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:ss(h,g,ct,R,w,null)}return;case"dialog":or("beforetoggle",h),or("toggle",h),or("cancel",h),or("close",h);break;case"iframe":case"object":or("load",h);break;case"video":case"audio":for(R=0;R<Gd.length;R++)or(Gd[R],h);break;case"image":or("error",h),or("load",h);break;case"details":or("toggle",h);break;case"embed":case"source":case"link":or("error",h),or("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Vt in w)if(w.hasOwnProperty(Vt)&&(R=w[Vt],R!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,g));default:ss(h,g,Vt,R,w,null)}return;default:if(yu(g)){for(sn in w)w.hasOwnProperty(sn)&&(R=w[sn],R!==void 0&&ox(h,g,sn,R,w,void 0));return}}for(Re in w)w.hasOwnProperty(Re)&&(R=w[Re],R!=null&&ss(h,g,Re,R,w,null))}function h0(h,g,w,R){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var F=null,q=null,ce=null,Re=null,ct=null,Vt=null,sn=null;for(Yt in w){var un=w[Yt];if(w.hasOwnProperty(Yt)&&un!=null)switch(Yt){case"checked":break;case"value":break;case"defaultValue":ct=un;default:R.hasOwnProperty(Yt)||ss(h,g,Yt,null,R,un)}}for(var Ut in R){var Yt=R[Ut];if(un=w[Ut],R.hasOwnProperty(Ut)&&(Yt!=null||un!=null))switch(Ut){case"type":q=Yt;break;case"name":F=Yt;break;case"checked":Vt=Yt;break;case"defaultChecked":sn=Yt;break;case"value":ce=Yt;break;case"defaultValue":Re=Yt;break;case"children":case"dangerouslySetInnerHTML":if(Yt!=null)throw Error(u(137,g));break;default:Yt!==un&&ss(h,g,Ut,Yt,R,un)}}sa(h,ce,Re,ct,Vt,sn,q,F);return;case"select":Yt=ce=Re=Ut=null;for(q in w)if(ct=w[q],w.hasOwnProperty(q)&&ct!=null)switch(q){case"value":break;case"multiple":Yt=ct;default:R.hasOwnProperty(q)||ss(h,g,q,null,R,ct)}for(F in R)if(q=R[F],ct=w[F],R.hasOwnProperty(F)&&(q!=null||ct!=null))switch(F){case"value":Ut=q;break;case"defaultValue":Re=q;break;case"multiple":ce=q;default:q!==ct&&ss(h,g,F,q,R,ct)}g=Re,w=ce,R=Yt,Ut!=null?To(h,!!w,Ut,!1):!!R!=!!w&&(g!=null?To(h,!!w,g,!0):To(h,!!w,w?[]:"",!1));return;case"textarea":Yt=Ut=null;for(Re in w)if(F=w[Re],w.hasOwnProperty(Re)&&F!=null&&!R.hasOwnProperty(Re))switch(Re){case"value":break;case"children":break;default:ss(h,g,Re,null,R,F)}for(ce in R)if(F=R[ce],q=w[ce],R.hasOwnProperty(ce)&&(F!=null||q!=null))switch(ce){case"value":Ut=F;break;case"defaultValue":Yt=F;break;case"children":break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(u(91));break;default:F!==q&&ss(h,g,ce,F,R,q)}Ua(h,Ut,Yt);return;case"option":for(var Wn in w)if(Ut=w[Wn],w.hasOwnProperty(Wn)&&Ut!=null&&!R.hasOwnProperty(Wn))switch(Wn){case"selected":h.selected=!1;break;default:ss(h,g,Wn,null,R,Ut)}for(ct in R)if(Ut=R[ct],Yt=w[ct],R.hasOwnProperty(ct)&&Ut!==Yt&&(Ut!=null||Yt!=null))switch(ct){case"selected":h.selected=Ut&&typeof Ut!="function"&&typeof Ut!="symbol";break;default:ss(h,g,ct,Ut,R,Yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fi in w)Ut=w[fi],w.hasOwnProperty(fi)&&Ut!=null&&!R.hasOwnProperty(fi)&&ss(h,g,fi,null,R,Ut);for(Vt in R)if(Ut=R[Vt],Yt=w[Vt],R.hasOwnProperty(Vt)&&Ut!==Yt&&(Ut!=null||Yt!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":if(Ut!=null)throw Error(u(137,g));break;default:ss(h,g,Vt,Ut,R,Yt)}return;default:if(yu(g)){for(var Zr in w)Ut=w[Zr],w.hasOwnProperty(Zr)&&Ut!==void 0&&!R.hasOwnProperty(Zr)&&ox(h,g,Zr,void 0,R,Ut);for(sn in R)Ut=R[sn],Yt=w[sn],!R.hasOwnProperty(sn)||Ut===Yt||Ut===void 0&&Yt===void 0||ox(h,g,sn,Ut,R,Yt);return}}for(var Rt in w)Ut=w[Rt],w.hasOwnProperty(Rt)&&Ut!=null&&!R.hasOwnProperty(Rt)&&ss(h,g,Rt,null,R,Ut);for(un in R)Ut=R[un],Yt=w[un],!R.hasOwnProperty(un)||Ut===Yt||Ut==null&&Yt==null||ss(h,g,un,Ut,R,Yt)}function lx(h){switch(h){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function d0(){if(typeof performance.getEntriesByType=="function"){for(var h=0,g=0,w=performance.getEntriesByType("resource"),R=0;R<w.length;R++){var F=w[R],q=F.transferSize,ce=F.initiatorType,Re=F.duration;if(q&&Re&&lx(ce)){for(ce=0,Re=F.responseEnd,R+=1;R<w.length;R++){var ct=w[R],Vt=ct.startTime;if(Vt>Re)break;var sn=ct.transferSize,un=ct.initiatorType;sn&&lx(un)&&(ct=ct.responseEnd,ce+=sn*(ct<Re?1:(Re-Vt)/(ct-Vt)))}if(--R,g+=8*(q+ce)/(F.duration/1e3),h++,10<h)break}}if(0<h)return g/h/1e6}return navigator.connection&&(h=navigator.connection.downlink,typeof h=="number")?h:5}var N_=null,B_=null;function Mg(h){return h.nodeType===9?h:h.ownerDocument}function cx(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function F_(h,g){if(h===0)switch(g){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&g==="foreignObject"?0:h}function Gu(h,g){return h==="textarea"||h==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.children=="bigint"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var ta=null;function f0(){var h=window.event;return h&&h.type==="popstate"?h===ta?!1:(ta=h,!0):(ta=null,!1)}var cm=typeof setTimeout=="function"?setTimeout:void 0,W1=typeof clearTimeout=="function"?clearTimeout:void 0,p0=typeof Promise=="function"?Promise:void 0,X1=typeof queueMicrotask=="function"?queueMicrotask:typeof p0<"u"?function(h){return p0.resolve(null).then(h).catch(Y1)}:cm;function Y1(h){setTimeout(function(){throw h})}function Ql(h){return h==="head"}function ux(h,g){var w=g,R=0;do{var F=w.nextSibling;if(h.removeChild(w),F&&F.nodeType===8)if(w=F.data,w==="/$"||w==="/&"){if(R===0){h.removeChild(F),gm(g);return}R--}else if(w==="$"||w==="$?"||w==="$~"||w==="$!"||w==="&")R++;else if(w==="html")Pg(h.ownerDocument.documentElement);else if(w==="head"){w=h.ownerDocument.head,Pg(w);for(var q=w.firstChild;q;){var ce=q.nextSibling,Re=q.nodeName;q[It]||Re==="SCRIPT"||Re==="STYLE"||Re==="LINK"&&q.rel.toLowerCase()==="stylesheet"||w.removeChild(q),q=ce}}else w==="body"&&Pg(h.ownerDocument.body);w=F}while(w);gm(g)}function qd(h,g){var w=h;h=0;do{var R=w.nextSibling;if(w.nodeType===1?g?(w._stashedDisplay=w.style.display,w.style.display="none"):(w.style.display=w._stashedDisplay||"",w.getAttribute("style")===""&&w.removeAttribute("style")):w.nodeType===3&&(g?(w._stashedText=w.nodeValue,w.nodeValue=""):w.nodeValue=w._stashedText||""),R&&R.nodeType===8)if(w=R.data,w==="/$"){if(h===0)break;h--}else w!=="$"&&w!=="$?"&&w!=="$~"&&w!=="$!"||h++;w=R}while(w)}function ip(h){var g=h.firstChild;for(g&&g.nodeType===10&&(g=g.nextSibling);g;){var w=g;switch(g=g.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":ip(w),tn(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}h.removeChild(w)}}function K1(h,g,w,R){for(;h.nodeType===1;){var F=w;if(h.nodeName.toLowerCase()!==g.toLowerCase()){if(!R&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(R){if(!h[It])switch(g){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(q=h.getAttribute("rel"),q==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(q!==F.rel||h.getAttribute("href")!==(F.href==null||F.href===""?null:F.href)||h.getAttribute("crossorigin")!==(F.crossOrigin==null?null:F.crossOrigin)||h.getAttribute("title")!==(F.title==null?null:F.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(q=h.getAttribute("src"),(q!==(F.src==null?null:F.src)||h.getAttribute("type")!==(F.type==null?null:F.type)||h.getAttribute("crossorigin")!==(F.crossOrigin==null?null:F.crossOrigin))&&q&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(g==="input"&&h.type==="hidden"){var q=F.name==null?null:""+F.name;if(F.type==="hidden"&&h.getAttribute("name")===q)return h}else return h;if(h=Ic(h.nextSibling),h===null)break}return null}function Q1(h,g,w){if(g==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!w||(h=Ic(h.nextSibling),h===null))return null;return h}function m0(h,g){for(;h.nodeType!==8;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!g||(h=Ic(h.nextSibling),h===null))return null;return h}function hx(h){return h.data==="$?"||h.data==="$~"}function dx(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState!=="loading"}function J1(h,g){var w=h.ownerDocument;if(h.data==="$~")h._reactRetry=g;else if(h.data!=="$?"||w.readyState!=="loading")g();else{var R=function(){g(),w.removeEventListener("DOMContentLoaded",R)};w.addEventListener("DOMContentLoaded",R),h._reactRetry=R}}function Ic(h){for(;h!=null;h=h.nextSibling){var g=h.nodeType;if(g===1||g===3)break;if(g===8){if(g=h.data,g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"||g==="F!"||g==="F")break;if(g==="/$"||g==="/&")return null}}return h}var Dg=null;function g0(h){h=h.nextSibling;for(var g=0;h;){if(h.nodeType===8){var w=h.data;if(w==="/$"||w==="/&"){if(g===0)return Ic(h.nextSibling);g--}else w!=="$"&&w!=="$!"&&w!=="$?"&&w!=="$~"&&w!=="&"||g++}h=h.nextSibling}return null}function fx(h){h=h.previousSibling;for(var g=0;h;){if(h.nodeType===8){var w=h.data;if(w==="$"||w==="$!"||w==="$?"||w==="$~"||w==="&"){if(g===0)return h;g--}else w!=="/$"&&w!=="/&"||g++}h=h.previousSibling}return null}function um(h,g,w){switch(g=Mg(w),h){case"html":if(h=g.documentElement,!h)throw Error(u(452));return h;case"head":if(h=g.head,!h)throw Error(u(453));return h;case"body":if(h=g.body,!h)throw Error(u(454));return h;default:throw Error(u(451))}}function Pg(h){for(var g=h.attributes;g.length;)h.removeAttributeNode(g[0]);tn(h)}var Cr=new Map,rp=new Set;function kg(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var Cc=Jt.d;Jt.d={f:V_,r:Lg,D:zg,C:mx,L:Og,m:ew,X:gx,S:_0,M:_x};function V_(){var h=Cc.f(),g=er();return h||g}function Lg(h){var g=bn(h);g!==null&&g.tag===5&&g.type==="form"?hg(g):Cc.r(h)}var sp=typeof document>"u"?null:document;function px(h,g,w){var R=sp;if(R&&typeof g=="string"&&g){var F=_s(g);F='link[rel="'+h+'"][href="'+F+'"]',typeof w=="string"&&(F+='[crossorigin="'+w+'"]'),rp.has(F)||(rp.add(F),h={rel:h,crossOrigin:w,href:g},R.querySelector(F)===null&&(g=R.createElement("link"),go(g,"link",h),vn(g),R.head.appendChild(g)))}}function zg(h){Cc.D(h),px("dns-prefetch",h,null)}function mx(h,g){Cc.C(h,g),px("preconnect",h,g)}function Og(h,g,w){Cc.L(h,g,w);var R=sp;if(R&&h&&g){var F='link[rel="preload"][as="'+_s(g)+'"]';g==="image"&&w&&w.imageSrcSet?(F+='[imagesrcset="'+_s(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(F+='[imagesizes="'+_s(w.imageSizes)+'"]')):F+='[href="'+_s(h)+'"]';var q=F;switch(g){case"style":q=hm(h);break;case"script":q=Hd(h)}Cr.has(q)||(h=Q({rel:"preload",href:g==="image"&&w&&w.imageSrcSet?void 0:h,as:g},w),Cr.set(q,h),R.querySelector(F)!==null||g==="style"&&R.querySelector(Oa(q))||g==="script"&&R.querySelector(ap(q))||(g=R.createElement("link"),go(g,"link",h),vn(g),R.head.appendChild(g)))}}function ew(h,g){Cc.m(h,g);var w=sp;if(w&&h){var R=g&&typeof g.as=="string"?g.as:"script",F='link[rel="modulepreload"][as="'+_s(R)+'"][href="'+_s(h)+'"]',q=F;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=Hd(h)}if(!Cr.has(q)&&(h=Q({rel:"modulepreload",href:h},g),Cr.set(q,h),w.querySelector(F)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(ap(q)))return}R=w.createElement("link"),go(R,"link",h),vn(R),w.head.appendChild(R)}}}function _0(h,g,w){Cc.S(h,g,w);var R=sp;if(R&&h){var F=Fn(R).hoistableStyles,q=hm(h);g=g||"default";var ce=F.get(q);if(!ce){var Re={loading:0,preload:null};if(ce=R.querySelector(Oa(q)))Re.loading=5;else{h=Q({rel:"stylesheet",href:h,"data-precedence":g},w),(w=Cr.get(q))&&vx(h,w);var ct=ce=R.createElement("link");vn(ct),go(ct,"link",h),ct._p=new Promise(function(Vt,sn){ct.onload=Vt,ct.onerror=sn}),ct.addEventListener("load",function(){Re.loading|=1}),ct.addEventListener("error",function(){Re.loading|=2}),Re.loading|=4,Na(ce,g,R)}ce={type:"stylesheet",instance:ce,count:1,state:Re},F.set(q,ce)}}}function gx(h,g){Cc.X(h,g);var w=sp;if(w&&h){var R=Fn(w).hoistableScripts,F=Hd(h),q=R.get(F);q||(q=w.querySelector(ap(F)),q||(h=Q({src:h,async:!0},g),(g=Cr.get(F))&&Ng(h,g),q=w.createElement("script"),vn(q),go(q,"link",h),w.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(F,q))}}function _x(h,g){Cc.M(h,g);var w=sp;if(w&&h){var R=Fn(w).hoistableScripts,F=Hd(h),q=R.get(F);q||(q=w.querySelector(ap(F)),q||(h=Q({src:h,async:!0,type:"module"},g),(g=Cr.get(F))&&Ng(h,g),q=w.createElement("script"),vn(q),go(q,"link",h),w.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(F,q))}}function qu(h,g,w,R){var F=(F=Zn.current)?kg(F):null;if(!F)throw Error(u(446));switch(h){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(g=hm(w.href),w=Fn(F).hoistableStyles,R=w.get(g),R||(R={type:"style",instance:null,count:0,state:null},w.set(g,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){h=hm(w.href);var q=Fn(F).hoistableStyles,ce=q.get(h);if(ce||(F=F.ownerDocument||F,ce={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(h,ce),(q=F.querySelector(Oa(h)))&&!q._p&&(ce.instance=q,ce.state.loading=5),Cr.has(h)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},Cr.set(h,w),q||yx(F,h,w,ce.state))),g&&R===null)throw Error(u(528,""));return ce}if(g&&R!==null)throw Error(u(529,""));return null;case"script":return g=w.async,w=w.src,typeof w=="string"&&g&&typeof g!="function"&&typeof g!="symbol"?(g=Hd(w),w=Fn(F).hoistableScripts,R=w.get(g),R||(R={type:"script",instance:null,count:0,state:null},w.set(g,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,h))}}function hm(h){return'href="'+_s(h)+'"'}function Oa(h){return'link[rel="stylesheet"]['+h+"]"}function y0(h){return Q({},h,{"data-precedence":h.precedence,precedence:null})}function yx(h,g,w,R){h.querySelector('link[rel="preload"][as="style"]['+g+"]")?R.loading=1:(g=h.createElement("link"),R.preload=g,g.addEventListener("load",function(){return R.loading|=1}),g.addEventListener("error",function(){return R.loading|=2}),go(g,"link",w),vn(g),h.head.appendChild(g))}function Hd(h){return'[src="'+_s(h)+'"]'}function ap(h){return"script[async]"+h}function xx(h,g,w){if(g.count++,g.instance===null)switch(g.type){case"style":var R=h.querySelector('style[data-href~="'+_s(w.href)+'"]');if(R)return g.instance=R,vn(R),R;var F=Q({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return R=(h.ownerDocument||h).createElement("style"),vn(R),go(R,"style",F),Na(R,w.precedence,h),g.instance=R;case"stylesheet":F=hm(w.href);var q=h.querySelector(Oa(F));if(q)return g.state.loading|=4,g.instance=q,vn(q),q;R=y0(w),(F=Cr.get(F))&&vx(R,F),q=(h.ownerDocument||h).createElement("link"),vn(q);var ce=q;return ce._p=new Promise(function(Re,ct){ce.onload=Re,ce.onerror=ct}),go(q,"link",R),g.state.loading|=4,Na(q,w.precedence,h),g.instance=q;case"script":return q=Hd(w.src),(F=h.querySelector(ap(q)))?(g.instance=F,vn(F),F):(R=w,(F=Cr.get(q))&&(R=Q({},w),Ng(R,F)),h=h.ownerDocument||h,F=h.createElement("script"),vn(F),go(F,"link",R),h.head.appendChild(F),g.instance=F);case"void":return null;default:throw Error(u(443,g.type))}else g.type==="stylesheet"&&(g.state.loading&4)===0&&(R=g.instance,g.state.loading|=4,Na(R,w.precedence,h));return g.instance}function Na(h,g,w){for(var R=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),F=R.length?R[R.length-1]:null,q=F,ce=0;ce<R.length;ce++){var Re=R[ce];if(Re.dataset.precedence===g)q=Re;else if(q!==F)break}q?q.parentNode.insertBefore(h,q.nextSibling):(g=w.nodeType===9?w.head:w,g.insertBefore(h,g.firstChild))}function vx(h,g){h.crossOrigin==null&&(h.crossOrigin=g.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=g.referrerPolicy),h.title==null&&(h.title=g.title)}function Ng(h,g){h.crossOrigin==null&&(h.crossOrigin=g.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=g.referrerPolicy),h.integrity==null&&(h.integrity=g.integrity)}var $d=null;function op(h,g,w){if($d===null){var R=new Map,F=$d=new Map;F.set(w,R)}else F=$d,R=F.get(w),R||(R=new Map,F.set(w,R));if(R.has(h))return R;for(R.set(h,null),w=w.getElementsByTagName(h),F=0;F<w.length;F++){var q=w[F];if(!(q[It]||q[De]||h==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var ce=q.getAttribute(g)||"";ce=h+ce;var Re=R.get(ce);Re?Re.push(q):R.set(ce,[q])}}return R}function bx(h,g,w){h=h.ownerDocument||h,h.head.insertBefore(w,g==="title"?h.querySelector("head > title"):null)}function x0(h,g,w){if(w===1||g.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof g.precedence!="string"||typeof g.href!="string"||g.href==="")break;return!0;case"link":if(typeof g.rel!="string"||typeof g.href!="string"||g.href===""||g.onLoad||g.onError)break;switch(g.rel){case"stylesheet":return h=g.disabled,typeof g.precedence=="string"&&h==null;default:return!0}case"script":if(g.async&&typeof g.async!="function"&&typeof g.async!="symbol"&&!g.onLoad&&!g.onError&&g.src&&typeof g.src=="string")return!0}return!1}function wx(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}function rl(h,g,w,R){if(w.type==="stylesheet"&&(typeof R.media!="string"||matchMedia(R.media).matches!==!1)&&(w.state.loading&4)===0){if(w.instance===null){var F=hm(R.href),q=g.querySelector(Oa(F));if(q){g=q._p,g!==null&&typeof g=="object"&&typeof g.then=="function"&&(h.count++,h=Vh.bind(h),g.then(h,h)),w.state.loading|=4,w.instance=q,vn(q);return}q=g.ownerDocument||g,R=y0(R),(F=Cr.get(F))&&vx(R,F),q=q.createElement("link"),vn(q);var ce=q;ce._p=new Promise(function(Re,ct){ce.onload=Re,ce.onerror=ct}),go(q,"link",R),w.instance=q}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(w,g),(g=w.state.preload)&&(w.state.loading&3)===0&&(h.count++,w=Vh.bind(h),g.addEventListener("load",w),g.addEventListener("error",w))}}var lp=0;function v0(h,g){return h.stylesheets&&h.count===0&&dm(h,h.stylesheets),0<h.count||0<h.imgCount?function(w){var R=setTimeout(function(){if(h.stylesheets&&dm(h,h.stylesheets),h.unsuspend){var q=h.unsuspend;h.unsuspend=null,q()}},6e4+g);0<h.imgBytes&&lp===0&&(lp=62500*d0());var F=setTimeout(function(){if(h.waitingForImages=!1,h.count===0&&(h.stylesheets&&dm(h,h.stylesheets),h.unsuspend)){var q=h.unsuspend;h.unsuspend=null,q()}},(h.imgBytes>lp?50:800)+g);return h.unsuspend=w,function(){h.unsuspend=null,clearTimeout(R),clearTimeout(F)}}:null}function Vh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)dm(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var Jl=null;function dm(h,g){h.stylesheets=null,h.unsuspend!==null&&(h.count++,Jl=new Map,g.forEach(Zd,h),Jl=null,Vh.call(h))}function Zd(h,g){if(!(g.state.loading&4)){var w=Jl.get(h);if(w)var R=w.get(null);else{w=new Map,Jl.set(h,w);for(var F=h.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<F.length;q++){var ce=F[q];(ce.nodeName==="LINK"||ce.getAttribute("media")!=="not all")&&(w.set(ce.dataset.precedence,ce),R=ce)}R&&w.set(null,R)}F=g.instance,ce=F.getAttribute("data-precedence"),q=w.get(ce)||R,q===R&&w.set(null,F),w.set(ce,F),this.count++,R=Vh.bind(this),F.addEventListener("load",R),F.addEventListener("error",R),q?q.parentNode.insertBefore(F,q.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(F,h.firstChild)),g.state.loading|=4}}var Rc={$$typeof:ht,Provider:null,Consumer:null,_currentValue:En,_currentValue2:En,_threadCount:0};function j_(h,g,w,R,F,q,ce,Re,ct){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ul(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ul(0),this.hiddenUpdates=ul(null),this.identifierPrefix=R,this.onUncaughtError=F,this.onCaughtError=q,this.onRecoverableError=ce,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ct,this.incompleteTransitions=new Map}function U_(h,g,w,R,F,q,ce,Re,ct,Vt,sn,un){return h=new j_(h,g,w,ce,ct,Vt,sn,un,Re),g=1,q===!0&&(g|=24),q=lo(3,null,null,g),h.current=q,q.stateNode=h,g=md(),g.refCount++,h.pooledCache=g,g.refCount++,q.memoizedState={element:R,isDehydrated:w,cache:g},Lf(q),h}function G_(h){return h?(h=hc,h):hc}function b0(h,g,w,R,F,q){F=G_(F),R.context===null?R.context=F:R.pendingContext=F,R=yc(g),R.payload={element:w},q=q===void 0?null:q,q!==null&&(R.callback=q),w=Jc(h,R,g),w!==null&&(Bn(w,h,g),_h(w,h,g))}function w0(h,g){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var w=h.retryLane;h.retryLane=w!==0&&w<g?w:g}}function Tx(h,g){w0(h,g),(h=h.alternate)&&w0(h,g)}function T0(h){if(h.tag===13||h.tag===31){var g=jt(h,67108864);g!==null&&Bn(g,h,67108864),Tx(h,67108864)}}function Ex(h){if(h.tag===13||h.tag===31){var g=Li();g=ai(g);var w=jt(h,g);w!==null&&Bn(w,h,g),Tx(h,g)}}var Bg=!0;function q_(h,g,w,R){var F=wt.T;wt.T=null;var q=Jt.p;try{Jt.p=2,fm(h,g,w,R)}finally{Jt.p=q,wt.T=F}}function E0(h,g,w,R){var F=wt.T;wt.T=null;var q=Jt.p;try{Jt.p=8,fm(h,g,w,R)}finally{Jt.p=q,wt.T=F}}function fm(h,g,w,R){if(Bg){var F=H_(R);if(F===null)O_(h,g,R,cp,w),Vg(h,R);else if(I0(F,h,g,w,R))R.stopPropagation();else if(Vg(h,R),g&4&&-1<A0.indexOf(h)){for(;F!==null;){var q=bn(F);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var ce=ji(q.pendingLanes);if(ce!==0){var Re=q;for(Re.pendingLanes|=2,Re.entangledLanes|=2;ce;){var ct=1<<31-Vi(ce);Re.entanglements[1]|=ct,ce&=~ct}ju(q),(Le&6)===0&&(Vn=Ur()+500,Ud(0))}}break;case 31:case 13:Re=jt(q,2),Re!==null&&Bn(Re,q,2),er(),Tx(q,2)}if(q=H_(R),q===null&&O_(h,g,R,cp,w),q===F)break;F=q}F!==null&&R.stopPropagation()}else O_(h,g,R,null,w)}}function H_(h){return h=Ra(h),Sx(h)}var cp=null;function Sx(h){if(cp=null,h=yn(h),h!==null){var g=T(h);if(g===null)h=null;else{var w=g.tag;if(w===13){if(h=C(g),h!==null)return h;h=null}else if(w===31){if(h=s(g),h!==null)return h;h=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;h=null}else g!==h&&(h=null)}}return cp=h,null}function S0(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vs()){case en:return 2;case Tn:return 8;case ri:case Oi:return 32;case Ri:return 268435456;default:return 32}default:return 32}}var Fg=!1,jh=null,Hu=null,$u=null,pm=new Map,mm=new Map,Uh=[],A0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Vg(h,g){switch(h){case"focusin":case"focusout":jh=null;break;case"dragenter":case"dragleave":Hu=null;break;case"mouseover":case"mouseout":$u=null;break;case"pointerover":case"pointerout":pm.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":mm.delete(g.pointerId)}}function vl(h,g,w,R,F,q){return h===null||h.nativeEvent!==q?(h={blockedOn:g,domEventName:w,eventSystemFlags:R,nativeEvent:q,targetContainers:[F]},g!==null&&(g=bn(g),g!==null&&T0(g)),h):(h.eventSystemFlags|=R,g=h.targetContainers,F!==null&&g.indexOf(F)===-1&&g.push(F),h)}function I0(h,g,w,R,F){switch(g){case"focusin":return jh=vl(jh,h,g,w,R,F),!0;case"dragenter":return Hu=vl(Hu,h,g,w,R,F),!0;case"mouseover":return $u=vl($u,h,g,w,R,F),!0;case"pointerover":var q=F.pointerId;return pm.set(q,vl(pm.get(q)||null,h,g,w,R,F)),!0;case"gotpointercapture":return q=F.pointerId,mm.set(q,vl(mm.get(q)||null,h,g,w,R,F)),!0}return!1}function C0(h){var g=yn(h.target);if(g!==null){var w=T(g);if(w!==null){if(g=w.tag,g===13){if(g=C(w),g!==null){h.blockedOn=g,ae(h.priority,function(){Ex(w)});return}}else if(g===31){if(g=s(w),g!==null){h.blockedOn=g,ae(h.priority,function(){Ex(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){h.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}h.blockedOn=null}function $_(h){if(h.blockedOn!==null)return!1;for(var g=h.targetContainers;0<g.length;){var w=H_(h.nativeEvent);if(w===null){w=h.nativeEvent;var R=new w.constructor(w.type,w);So=R,w.target.dispatchEvent(R),So=null}else return g=bn(w),g!==null&&T0(g),h.blockedOn=w,!1;g.shift()}return!0}function R0(h,g,w){$_(h)&&w.delete(g)}function tw(){Fg=!1,jh!==null&&$_(jh)&&(jh=null),Hu!==null&&$_(Hu)&&(Hu=null),$u!==null&&$_($u)&&($u=null),pm.forEach(R0),mm.forEach(R0)}function Z_(h,g){h.blockedOn===g&&(h.blockedOn=null,Fg||(Fg=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,tw)))}var W_=null;function M0(h){W_!==h&&(W_=h,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){W_===h&&(W_=null);for(var g=0;g<h.length;g+=3){var w=h[g],R=h[g+1],F=h[g+2];if(typeof R!="function"){if(Sx(R||w)===null)continue;break}var q=bn(w);q!==null&&(h.splice(g,3),g-=3,Uf(q,{pending:!0,data:F,method:w.method,action:R},R,F))}}))}function gm(h){function g(ct){return Z_(ct,h)}jh!==null&&Z_(jh,h),Hu!==null&&Z_(Hu,h),$u!==null&&Z_($u,h),pm.forEach(g),mm.forEach(g);for(var w=0;w<Uh.length;w++){var R=Uh[w];R.blockedOn===h&&(R.blockedOn=null)}for(;0<Uh.length&&(w=Uh[0],w.blockedOn===null);)C0(w),w.blockedOn===null&&Uh.shift();if(w=(h.ownerDocument||h).$$reactFormReplay,w!=null)for(R=0;R<w.length;R+=3){var F=w[R],q=w[R+1],ce=F[xe]||null;if(typeof q=="function")ce||M0(w);else if(ce){var Re=null;if(q&&q.hasAttribute("formAction")){if(F=q,ce=q[xe]||null)Re=ce.formAction;else if(Sx(F)!==null)continue}else Re=ce.action;typeof Re=="function"?w[R+1]=Re:(w.splice(R,3),R-=3),M0(w)}}}function _m(){function h(q){q.canIntercept&&q.info==="react-transition"&&q.intercept({handler:function(){return new Promise(function(ce){return F=ce})},focusReset:"manual",scroll:"manual"})}function g(){F!==null&&(F(),F=null),R||setTimeout(w,20)}function w(){if(!R&&!navigation.transition){var q=navigation.currentEntry;q&&q.url!=null&&navigation.navigate(q.url,{state:q.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var R=!1,F=null;return navigation.addEventListener("navigate",h),navigation.addEventListener("navigatesuccess",g),navigation.addEventListener("navigateerror",g),setTimeout(w,100),function(){R=!0,navigation.removeEventListener("navigate",h),navigation.removeEventListener("navigatesuccess",g),navigation.removeEventListener("navigateerror",g),F!==null&&(F(),F=null)}}}function Ax(h){this._internalRoot=h}jg.prototype.render=Ax.prototype.render=function(h){var g=this._internalRoot;if(g===null)throw Error(u(409));var w=g.current,R=Li();b0(w,R,h,g,null,null)},jg.prototype.unmount=Ax.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var g=h.containerInfo;b0(h.current,2,null,h,null,null),er(),g[Be]=null}};function jg(h){this._internalRoot=h}jg.prototype.unstable_scheduleHydration=function(h){if(h){var g=ne();h={blockedOn:null,target:h,priority:g};for(var w=0;w<Uh.length&&g!==0&&g<Uh[w].priority;w++);Uh.splice(w,0,h),w===0&&C0(h)}};var Ug=t.version;if(Ug!=="19.2.3")throw Error(u(527,Ug,"19.2.3"));Jt.findDOMNode=function(h){var g=h._reactInternals;if(g===void 0)throw typeof h.render=="function"?Error(u(188)):(h=Object.keys(h).join(","),Error(u(268,h)));return h=V(g),h=h!==null?W(h):null,h=h===null?null:h.stateNode,h};var D0={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:wt,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ym=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ym.isDisabled&&ym.supportsFiber)try{ps=ym.inject(D0),kr=ym}catch{}}return sv.createRoot=function(h,g){if(!y(h))throw Error(u(299));var w=!1,R="",F=D_,q=sr,ce=ei;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(R=g.identifierPrefix),g.onUncaughtError!==void 0&&(F=g.onUncaughtError),g.onCaughtError!==void 0&&(q=g.onCaughtError),g.onRecoverableError!==void 0&&(ce=g.onRecoverableError)),g=U_(h,1,!1,null,null,w,R,null,F,q,ce,_m),h[Be]=g.current,z_(h),new Ax(g)},sv.hydrateRoot=function(h,g,w){if(!y(h))throw Error(u(299));var R=!1,F="",q=D_,ce=sr,Re=ei,ct=null;return w!=null&&(w.unstable_strictMode===!0&&(R=!0),w.identifierPrefix!==void 0&&(F=w.identifierPrefix),w.onUncaughtError!==void 0&&(q=w.onUncaughtError),w.onCaughtError!==void 0&&(ce=w.onCaughtError),w.onRecoverableError!==void 0&&(Re=w.onRecoverableError),w.formState!==void 0&&(ct=w.formState)),g=U_(h,1,!0,g,w??null,R,F,ct,q,ce,Re,_m),g.context=G_(null),w=g.current,R=Li(),R=ai(R),F=yc(R),F.callback=null,Jc(w,F,R),w=R,g.current.lanes=w,hl(g,w),ju(g),h[Be]=g.current,z_(h),new jg(g)},sv.version="19.2.3",sv}var SC;function bN(){if(SC)return uT.exports;SC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),uT.exports=vN(),uT.exports}var wN=bN();const TN=Fv(wN);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var AC="popstate";function EN(o={}){function t(y,T){let{pathname:C="/",search:s="",hash:B=""}=l_(y.location.hash.substring(1));return!C.startsWith("/")&&!C.startsWith(".")&&(C="/"+C),XT("",{pathname:C,search:s,hash:B},T.state&&T.state.usr||null,T.state&&T.state.key||"default")}function a(y,T){let C=y.document.querySelector("base"),s="";if(C&&C.getAttribute("href")){let B=y.location.href,V=B.indexOf("#");s=V===-1?B:B.slice(0,V)}return s+"#"+(typeof T=="string"?T:Iv(T))}function u(y,T){mu(y.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(T)})`)}return AN(t,a,u,o)}function ia(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function mu(o,t){if(!o){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function SN(){return Math.random().toString(36).substring(2,10)}function IC(o,t){return{usr:o.state,key:o.key,idx:t}}function XT(o,t,a=null,u){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof t=="string"?l_(t):t,state:a,key:t&&t.key||u||SN()}}function Iv({pathname:o="/",search:t="",hash:a=""}){return t&&t!=="?"&&(o+=t.charAt(0)==="?"?t:"?"+t),a&&a!=="#"&&(o+=a.charAt(0)==="#"?a:"#"+a),o}function l_(o){let t={};if(o){let a=o.indexOf("#");a>=0&&(t.hash=o.substring(a),o=o.substring(0,a));let u=o.indexOf("?");u>=0&&(t.search=o.substring(u),o=o.substring(0,u)),o&&(t.pathname=o)}return t}function AN(o,t,a,u={}){let{window:y=document.defaultView,v5Compat:T=!1}=u,C=y.history,s="POP",B=null,V=W();V==null&&(V=0,C.replaceState({...C.state,idx:V},""));function W(){return(C.state||{idx:null}).idx}function Q(){s="POP";let Xe=W(),st=Xe==null?null:Xe-V;V=Xe,B&&B({action:s,location:Ye.location,delta:st})}function oe(Xe,st){s="PUSH";let ft=XT(Ye.location,Xe,st);a&&a(ft,Xe),V=W()+1;let ht=IC(ft,V),Ft=Ye.createHref(ft);try{C.pushState(ht,"",Ft)}catch(fn){if(fn instanceof DOMException&&fn.name==="DataCloneError")throw fn;y.location.assign(Ft)}T&&B&&B({action:s,location:Ye.location,delta:1})}function he(Xe,st){s="REPLACE";let ft=XT(Ye.location,Xe,st);a&&a(ft,Xe),V=W();let ht=IC(ft,V),Ft=Ye.createHref(ft);C.replaceState(ht,"",Ft),T&&B&&B({action:s,location:Ye.location,delta:0})}function Je(Xe){return IN(Xe)}let Ye={get action(){return s},get location(){return o(y,C)},listen(Xe){if(B)throw new Error("A history only accepts one active listener");return y.addEventListener(AC,Q),B=Xe,()=>{y.removeEventListener(AC,Q),B=null}},createHref(Xe){return t(y,Xe)},createURL:Je,encodeLocation(Xe){let st=Je(Xe);return{pathname:st.pathname,search:st.search,hash:st.hash}},push:oe,replace:he,go(Xe){return C.go(Xe)}};return Ye}function IN(o,t=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),ia(a,"No window.location.(origin|href) available to create URL");let u=typeof o=="string"?o:Iv(o);return u=u.replace(/ $/,"%20"),!t&&u.startsWith("//")&&(u=a+u),new URL(u,a)}function cD(o,t,a="/"){return CN(o,t,a,!1)}function CN(o,t,a,u){let y=typeof t=="string"?l_(t):t,T=yp(y.pathname||"/",a);if(T==null)return null;let C=uD(o);RN(C);let s=null;for(let B=0;s==null&&B<C.length;++B){let V=VN(T);s=BN(C[B],V,u)}return s}function uD(o,t=[],a=[],u="",y=!1){let T=(C,s,B=y,V)=>{let W={relativePath:V===void 0?C.path||"":V,caseSensitive:C.caseSensitive===!0,childrenIndex:s,route:C};if(W.relativePath.startsWith("/")){if(!W.relativePath.startsWith(u)&&B)return;ia(W.relativePath.startsWith(u),`Absolute route path "${W.relativePath}" nested under path "${u}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),W.relativePath=W.relativePath.slice(u.length)}let Q=gp([u,W.relativePath]),oe=a.concat(W);C.children&&C.children.length>0&&(ia(C.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Q}".`),uD(C.children,t,oe,Q,B)),!(C.path==null&&!C.index)&&t.push({path:Q,score:ON(Q,C.index),routesMeta:oe})};return o.forEach((C,s)=>{var B;if(C.path===""||!((B=C.path)!=null&&B.includes("?")))T(C,s);else for(let V of hD(C.path))T(C,s,!0,V)}),t}function hD(o){let t=o.split("/");if(t.length===0)return[];let[a,...u]=t,y=a.endsWith("?"),T=a.replace(/\?$/,"");if(u.length===0)return y?[T,""]:[T];let C=hD(u.join("/")),s=[];return s.push(...C.map(B=>B===""?T:[T,B].join("/"))),y&&s.push(...C),s.map(B=>o.startsWith("/")&&B===""?"/":B)}function RN(o){o.sort((t,a)=>t.score!==a.score?a.score-t.score:NN(t.routesMeta.map(u=>u.childrenIndex),a.routesMeta.map(u=>u.childrenIndex)))}var MN=/^:[\w-]+$/,DN=3,PN=2,kN=1,LN=10,zN=-2,CC=o=>o==="*";function ON(o,t){let a=o.split("/"),u=a.length;return a.some(CC)&&(u+=zN),t&&(u+=PN),a.filter(y=>!CC(y)).reduce((y,T)=>y+(MN.test(T)?DN:T===""?kN:LN),u)}function NN(o,t){return o.length===t.length&&o.slice(0,-1).every((u,y)=>u===t[y])?o[o.length-1]-t[t.length-1]:0}function BN(o,t,a=!1){let{routesMeta:u}=o,y={},T="/",C=[];for(let s=0;s<u.length;++s){let B=u[s],V=s===u.length-1,W=T==="/"?t:t.slice(T.length)||"/",Q=Zb({path:B.relativePath,caseSensitive:B.caseSensitive,end:V},W),oe=B.route;if(!Q&&V&&a&&!u[u.length-1].route.index&&(Q=Zb({path:B.relativePath,caseSensitive:B.caseSensitive,end:!1},W)),!Q)return null;Object.assign(y,Q.params),C.push({params:y,pathname:gp([T,Q.pathname]),pathnameBase:qN(gp([T,Q.pathnameBase])),route:oe}),Q.pathnameBase!=="/"&&(T=gp([T,Q.pathnameBase]))}return C}function Zb(o,t){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[a,u]=FN(o.path,o.caseSensitive,o.end),y=t.match(a);if(!y)return null;let T=y[0],C=T.replace(/(.)\/+$/,"$1"),s=y.slice(1);return{params:u.reduce((V,{paramName:W,isOptional:Q},oe)=>{if(W==="*"){let Je=s[oe]||"";C=T.slice(0,T.length-Je.length).replace(/(.)\/+$/,"$1")}const he=s[oe];return Q&&!he?V[W]=void 0:V[W]=(he||"").replace(/%2F/g,"/"),V},{}),pathname:T,pathnameBase:C,pattern:o}}function FN(o,t=!1,a=!0){mu(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let u=[],y="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,s,B)=>(u.push({paramName:s,isOptional:B!=null}),B?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(u.push({paramName:"*"}),y+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?y+="\\/*$":o!==""&&o!=="/"&&(y+="(?:(?=\\/|$))"),[new RegExp(y,t?void 0:"i"),u]}function VN(o){try{return o.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return mu(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),o}}function yp(o,t){if(t==="/")return o;if(!o.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,u=o.charAt(a);return u&&u!=="/"?null:o.slice(a)||"/"}var jN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function UN(o,t="/"){let{pathname:a,search:u="",hash:y=""}=typeof o=="string"?l_(o):o,T;return a?(a=a.replace(/\/\/+/g,"/"),a.startsWith("/")?T=RC(a.substring(1),"/"):T=RC(a,t)):T=t,{pathname:T,search:HN(u),hash:$N(y)}}function RC(o,t){let a=t.replace(/\/+$/,"").split("/");return o.split("/").forEach(y=>{y===".."?a.length>1&&a.pop():y!=="."&&a.push(y)}),a.length>1?a.join("/"):"/"}function pT(o,t,a,u){return`Cannot include a '${o}' character in a manually specified \`to.${t}\` field [${JSON.stringify(u)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function GN(o){return o.filter((t,a)=>a===0||t.route.path&&t.route.path.length>0)}function jE(o){let t=GN(o);return t.map((a,u)=>u===t.length-1?a.pathname:a.pathnameBase)}function UE(o,t,a,u=!1){let y;typeof o=="string"?y=l_(o):(y={...o},ia(!y.pathname||!y.pathname.includes("?"),pT("?","pathname","search",y)),ia(!y.pathname||!y.pathname.includes("#"),pT("#","pathname","hash",y)),ia(!y.search||!y.search.includes("#"),pT("#","search","hash",y)));let T=o===""||y.pathname==="",C=T?"/":y.pathname,s;if(C==null)s=a;else{let Q=t.length-1;if(!u&&C.startsWith("..")){let oe=C.split("/");for(;oe[0]==="..";)oe.shift(),Q-=1;y.pathname=oe.join("/")}s=Q>=0?t[Q]:"/"}let B=UN(y,s),V=C&&C!=="/"&&C.endsWith("/"),W=(T||C===".")&&a.endsWith("/");return!B.pathname.endsWith("/")&&(V||W)&&(B.pathname+="/"),B}var gp=o=>o.join("/").replace(/\/\/+/g,"/"),qN=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),HN=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,$N=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,ZN=class{constructor(o,t,a,u=!1){this.status=o,this.statusText=t||"",this.internal=u,a instanceof Error?(this.data=a.toString(),this.error=a):this.data=a}};function WN(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function XN(o){return o.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var dD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function fD(o,t){let a=o;if(typeof a!="string"||!jN.test(a))return{absoluteURL:void 0,isExternal:!1,to:a};let u=a,y=!1;if(dD)try{let T=new URL(window.location.href),C=a.startsWith("//")?new URL(T.protocol+a):new URL(a),s=yp(C.pathname,t);C.origin===T.origin&&s!=null?a=s+C.search+C.hash:y=!0}catch{mu(!1,`<Link to="${a}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:u,isExternal:y,to:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pD=["POST","PUT","PATCH","DELETE"];new Set(pD);var YN=["GET",...pD];new Set(YN);var Vy=He.createContext(null);Vy.displayName="DataRouter";var g1=He.createContext(null);g1.displayName="DataRouterState";var KN=He.createContext(!1),mD=He.createContext({isTransitioning:!1});mD.displayName="ViewTransition";var QN=He.createContext(new Map);QN.displayName="Fetchers";var JN=He.createContext(null);JN.displayName="Await";var gu=He.createContext(null);gu.displayName="Navigation";var Vv=He.createContext(null);Vv.displayName="Location";var df=He.createContext({outlet:null,matches:[],isDataRoute:!1});df.displayName="Route";var GE=He.createContext(null);GE.displayName="RouteError";var gD="REACT_ROUTER_ERROR",eB="REDIRECT",tB="ROUTE_ERROR_RESPONSE";function nB(o){if(o.startsWith(`${gD}:${eB}:{`))try{let t=JSON.parse(o.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function iB(o){if(o.startsWith(`${gD}:${tB}:{`))try{let t=JSON.parse(o.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new ZN(t.status,t.statusText,t.data)}catch{}}function rB(o,{relative:t}={}){ia(jy(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:u}=He.useContext(gu),{hash:y,pathname:T,search:C}=jv(o,{relative:t}),s=T;return a!=="/"&&(s=T==="/"?a:gp([a,T])),u.createHref({pathname:s,search:C,hash:y})}function jy(){return He.useContext(Vv)!=null}function Tp(){return ia(jy(),"useLocation() may be used only in the context of a <Router> component."),He.useContext(Vv).location}var _D="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function yD(o){He.useContext(gu).static||He.useLayoutEffect(o)}function ff(){let{isDataRoute:o}=He.useContext(df);return o?_B():sB()}function sB(){ia(jy(),"useNavigate() may be used only in the context of a <Router> component.");let o=He.useContext(Vy),{basename:t,navigator:a}=He.useContext(gu),{matches:u}=He.useContext(df),{pathname:y}=Tp(),T=JSON.stringify(jE(u)),C=He.useRef(!1);return yD(()=>{C.current=!0}),He.useCallback((B,V={})=>{if(mu(C.current,_D),!C.current)return;if(typeof B=="number"){a.go(B);return}let W=UE(B,JSON.parse(T),y,V.relative==="path");o==null&&t!=="/"&&(W.pathname=W.pathname==="/"?t:gp([t,W.pathname])),(V.replace?a.replace:a.push)(W,V.state,V)},[t,a,T,y,o])}He.createContext(null);function jv(o,{relative:t}={}){let{matches:a}=He.useContext(df),{pathname:u}=Tp(),y=JSON.stringify(jE(a));return He.useMemo(()=>UE(o,JSON.parse(y),u,t==="path"),[o,y,u,t])}function aB(o,t){return xD(o,t)}function xD(o,t,a,u,y){var ft;ia(jy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:T}=He.useContext(gu),{matches:C}=He.useContext(df),s=C[C.length-1],B=s?s.params:{},V=s?s.pathname:"/",W=s?s.pathnameBase:"/",Q=s&&s.route;{let ht=Q&&Q.path||"";bD(V,!Q||ht.endsWith("*")||ht.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${V}" (under <Route path="${ht}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ht}"> to <Route path="${ht==="/"?"*":`${ht}/*`}">.`)}let oe=Tp(),he;if(t){let ht=typeof t=="string"?l_(t):t;ia(W==="/"||((ft=ht.pathname)==null?void 0:ft.startsWith(W)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${W}" but pathname "${ht.pathname}" was given in the \`location\` prop.`),he=ht}else he=oe;let Je=he.pathname||"/",Ye=Je;if(W!=="/"){let ht=W.replace(/^\//,"").split("/");Ye="/"+Je.replace(/^\//,"").split("/").slice(ht.length).join("/")}let Xe=cD(o,{pathname:Ye});mu(Q||Xe!=null,`No routes matched location "${he.pathname}${he.search}${he.hash}" `),mu(Xe==null||Xe[Xe.length-1].route.element!==void 0||Xe[Xe.length-1].route.Component!==void 0||Xe[Xe.length-1].route.lazy!==void 0,`Matched leaf route at location "${he.pathname}${he.search}${he.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let st=hB(Xe&&Xe.map(ht=>Object.assign({},ht,{params:Object.assign({},B,ht.params),pathname:gp([W,T.encodeLocation?T.encodeLocation(ht.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ht.pathname]),pathnameBase:ht.pathnameBase==="/"?W:gp([W,T.encodeLocation?T.encodeLocation(ht.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ht.pathnameBase])})),C,a,u,y);return t&&st?He.createElement(Vv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...he},navigationType:"POP"}},st):st}function oB(){let o=gB(),t=WN(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),a=o instanceof Error?o.stack:null,u="rgba(200,200,200, 0.5)",y={padding:"0.5rem",backgroundColor:u},T={padding:"2px 4px",backgroundColor:u},C=null;return console.error("Error handled by React Router default ErrorBoundary:",o),C=He.createElement(He.Fragment,null,He.createElement("p",null," Hey developer "),He.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",He.createElement("code",{style:T},"ErrorBoundary")," or"," ",He.createElement("code",{style:T},"errorElement")," prop on your route.")),He.createElement(He.Fragment,null,He.createElement("h2",null,"Unexpected Application Error!"),He.createElement("h3",{style:{fontStyle:"italic"}},t),a?He.createElement("pre",{style:y},a):null,C)}var lB=He.createElement(oB,null),vD=class extends He.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,t){return t.location!==o.location||t.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:t.error,location:t.location,revalidation:o.revalidation||t.revalidation}}componentDidCatch(o,t){this.props.onError?this.props.onError(o,t):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const a=iB(o.digest);a&&(o=a)}let t=o!==void 0?He.createElement(df.Provider,{value:this.props.routeContext},He.createElement(GE.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?He.createElement(cB,{error:o},t):t}};vD.contextType=KN;var mT=new WeakMap;function cB({children:o,error:t}){let{basename:a}=He.useContext(gu);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let u=nB(t.digest);if(u){let y=mT.get(t);if(y)throw y;let T=fD(u.location,a);if(dD&&!mT.get(t))if(T.isExternal||u.reloadDocument)window.location.href=T.absoluteURL||T.to;else{const C=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(T.to,{replace:u.replace}));throw mT.set(t,C),C}return He.createElement("meta",{httpEquiv:"refresh",content:`0;url=${T.absoluteURL||T.to}`})}}return o}function uB({routeContext:o,match:t,children:a}){let u=He.useContext(Vy);return u&&u.static&&u.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=t.route.id),He.createElement(df.Provider,{value:o},a)}function hB(o,t=[],a=null,u=null,y=null){if(o==null){if(!a)return null;if(a.errors)o=a.matches;else if(t.length===0&&!a.initialized&&a.matches.length>0)o=a.matches;else return null}let T=o,C=a==null?void 0:a.errors;if(C!=null){let W=T.findIndex(Q=>Q.route.id&&(C==null?void 0:C[Q.route.id])!==void 0);ia(W>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(C).join(",")}`),T=T.slice(0,Math.min(T.length,W+1))}let s=!1,B=-1;if(a)for(let W=0;W<T.length;W++){let Q=T[W];if((Q.route.HydrateFallback||Q.route.hydrateFallbackElement)&&(B=W),Q.route.id){let{loaderData:oe,errors:he}=a,Je=Q.route.loader&&!oe.hasOwnProperty(Q.route.id)&&(!he||he[Q.route.id]===void 0);if(Q.route.lazy||Je){s=!0,B>=0?T=T.slice(0,B+1):T=[T[0]];break}}}let V=a&&u?(W,Q)=>{var oe,he;u(W,{location:a.location,params:((he=(oe=a.matches)==null?void 0:oe[0])==null?void 0:he.params)??{},unstable_pattern:XN(a.matches),errorInfo:Q})}:void 0;return T.reduceRight((W,Q,oe)=>{let he,Je=!1,Ye=null,Xe=null;a&&(he=C&&Q.route.id?C[Q.route.id]:void 0,Ye=Q.route.errorElement||lB,s&&(B<0&&oe===0?(bD("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Je=!0,Xe=null):B===oe&&(Je=!0,Xe=Q.route.hydrateFallbackElement||null)));let st=t.concat(T.slice(0,oe+1)),ft=()=>{let ht;return he?ht=Ye:Je?ht=Xe:Q.route.Component?ht=He.createElement(Q.route.Component,null):Q.route.element?ht=Q.route.element:ht=W,He.createElement(uB,{match:Q,routeContext:{outlet:W,matches:st,isDataRoute:a!=null},children:ht})};return a&&(Q.route.ErrorBoundary||Q.route.errorElement||oe===0)?He.createElement(vD,{location:a.location,revalidation:a.revalidation,component:Ye,error:he,children:ft(),routeContext:{outlet:null,matches:st,isDataRoute:!0},onError:V}):ft()},null)}function qE(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function dB(o){let t=He.useContext(Vy);return ia(t,qE(o)),t}function fB(o){let t=He.useContext(g1);return ia(t,qE(o)),t}function pB(o){let t=He.useContext(df);return ia(t,qE(o)),t}function HE(o){let t=pB(o),a=t.matches[t.matches.length-1];return ia(a.route.id,`${o} can only be used on routes that contain a unique "id"`),a.route.id}function mB(){return HE("useRouteId")}function gB(){var u;let o=He.useContext(GE),t=fB("useRouteError"),a=HE("useRouteError");return o!==void 0?o:(u=t.errors)==null?void 0:u[a]}function _B(){let{router:o}=dB("useNavigate"),t=HE("useNavigate"),a=He.useRef(!1);return yD(()=>{a.current=!0}),He.useCallback(async(y,T={})=>{mu(a.current,_D),a.current&&(typeof y=="number"?await o.navigate(y):await o.navigate(y,{fromRouteId:t,...T}))},[o,t])}var MC={};function bD(o,t,a){!t&&!MC[o]&&(MC[o]=!0,mu(!1,a))}He.memo(yB);function yB({routes:o,future:t,state:a,onError:u}){return xD(o,void 0,a,u,t)}function gT({to:o,replace:t,state:a,relative:u}){ia(jy(),"<Navigate> may be used only in the context of a <Router> component.");let{static:y}=He.useContext(gu);mu(!y,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:T}=He.useContext(df),{pathname:C}=Tp(),s=ff(),B=UE(o,jE(T),C,u==="path"),V=JSON.stringify(B);return He.useEffect(()=>{s(JSON.parse(V),{replace:t,state:a,relative:u})},[s,V,u,t,a]),null}function Zh(o){ia(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function xB({basename:o="/",children:t=null,location:a,navigationType:u="POP",navigator:y,static:T=!1,unstable_useTransitions:C}){ia(!jy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=o.replace(/^\/*/,"/"),B=He.useMemo(()=>({basename:s,navigator:y,static:T,unstable_useTransitions:C,future:{}}),[s,y,T,C]);typeof a=="string"&&(a=l_(a));let{pathname:V="/",search:W="",hash:Q="",state:oe=null,key:he="default"}=a,Je=He.useMemo(()=>{let Ye=yp(V,s);return Ye==null?null:{location:{pathname:Ye,search:W,hash:Q,state:oe,key:he},navigationType:u}},[s,V,W,Q,oe,he,u]);return mu(Je!=null,`<Router basename="${s}"> is not able to match the URL "${V}${W}${Q}" because it does not start with the basename, so the <Router> won't render anything.`),Je==null?null:He.createElement(gu.Provider,{value:B},He.createElement(Vv.Provider,{children:t,value:Je}))}function vB({children:o,location:t}){return aB(YT(o),t)}function YT(o,t=[]){let a=[];return He.Children.forEach(o,(u,y)=>{if(!He.isValidElement(u))return;let T=[...t,y];if(u.type===He.Fragment){a.push.apply(a,YT(u.props.children,T));return}ia(u.type===Zh,`[${typeof u.type=="string"?u.type:u.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ia(!u.props.index||!u.props.children,"An index route cannot have child routes.");let C={id:u.props.id||T.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,middleware:u.props.middleware,loader:u.props.loader,action:u.props.action,hydrateFallbackElement:u.props.hydrateFallbackElement,HydrateFallback:u.props.HydrateFallback,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.hasErrorBoundary===!0||u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(C.children=YT(u.props.children,T)),a.push(C)}),a}var Cb="get",Rb="application/x-www-form-urlencoded";function _1(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function bB(o){return _1(o)&&o.tagName.toLowerCase()==="button"}function wB(o){return _1(o)&&o.tagName.toLowerCase()==="form"}function TB(o){return _1(o)&&o.tagName.toLowerCase()==="input"}function EB(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function SB(o,t){return o.button===0&&(!t||t==="_self")&&!EB(o)}function KT(o=""){return new URLSearchParams(typeof o=="string"||Array.isArray(o)||o instanceof URLSearchParams?o:Object.keys(o).reduce((t,a)=>{let u=o[a];return t.concat(Array.isArray(u)?u.map(y=>[a,y]):[[a,u]])},[]))}function AB(o,t){let a=KT(o);return t&&t.forEach((u,y)=>{a.has(y)||t.getAll(y).forEach(T=>{a.append(y,T)})}),a}var gb=null;function IB(){if(gb===null)try{new FormData(document.createElement("form"),0),gb=!1}catch{gb=!0}return gb}var CB=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _T(o){return o!=null&&!CB.has(o)?(mu(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Rb}"`),null):o}function RB(o,t){let a,u,y,T,C;if(wB(o)){let s=o.getAttribute("action");u=s?yp(s,t):null,a=o.getAttribute("method")||Cb,y=_T(o.getAttribute("enctype"))||Rb,T=new FormData(o)}else if(bB(o)||TB(o)&&(o.type==="submit"||o.type==="image")){let s=o.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let B=o.getAttribute("formaction")||s.getAttribute("action");if(u=B?yp(B,t):null,a=o.getAttribute("formmethod")||s.getAttribute("method")||Cb,y=_T(o.getAttribute("formenctype"))||_T(s.getAttribute("enctype"))||Rb,T=new FormData(s,o),!IB()){let{name:V,type:W,value:Q}=o;if(W==="image"){let oe=V?`${V}.`:"";T.append(`${oe}x`,"0"),T.append(`${oe}y`,"0")}else V&&T.append(V,Q)}}else{if(_1(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=Cb,u=null,y=Rb,C=o}return T&&y==="text/plain"&&(C=T,T=void 0),{action:u,method:a.toLowerCase(),encType:y,formData:T,body:C}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $E(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function MB(o,t,a,u){let y=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return a?y.pathname.endsWith("/")?y.pathname=`${y.pathname}_.${u}`:y.pathname=`${y.pathname}.${u}`:y.pathname==="/"?y.pathname=`_root.${u}`:t&&yp(y.pathname,t)==="/"?y.pathname=`${t.replace(/\/$/,"")}/_root.${u}`:y.pathname=`${y.pathname.replace(/\/$/,"")}.${u}`,y}async function DB(o,t){if(o.id in t)return t[o.id];try{let a=await import(o.module);return t[o.id]=a,a}catch(a){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function PB(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function kB(o,t,a){let u=await Promise.all(o.map(async y=>{let T=t.routes[y.route.id];if(T){let C=await DB(T,a);return C.links?C.links():[]}return[]}));return NB(u.flat(1).filter(PB).filter(y=>y.rel==="stylesheet"||y.rel==="preload").map(y=>y.rel==="stylesheet"?{...y,rel:"prefetch",as:"style"}:{...y,rel:"prefetch"}))}function DC(o,t,a,u,y,T){let C=(B,V)=>a[V]?B.route.id!==a[V].route.id:!0,s=(B,V)=>{var W;return a[V].pathname!==B.pathname||((W=a[V].route.path)==null?void 0:W.endsWith("*"))&&a[V].params["*"]!==B.params["*"]};return T==="assets"?t.filter((B,V)=>C(B,V)||s(B,V)):T==="data"?t.filter((B,V)=>{var Q;let W=u.routes[B.route.id];if(!W||!W.hasLoader)return!1;if(C(B,V)||s(B,V))return!0;if(B.route.shouldRevalidate){let oe=B.route.shouldRevalidate({currentUrl:new URL(y.pathname+y.search+y.hash,window.origin),currentParams:((Q=a[0])==null?void 0:Q.params)||{},nextUrl:new URL(o,window.origin),nextParams:B.params,defaultShouldRevalidate:!0});if(typeof oe=="boolean")return oe}return!0}):[]}function LB(o,t,{includeHydrateFallback:a}={}){return zB(o.map(u=>{let y=t.routes[u.route.id];if(!y)return[];let T=[y.module];return y.clientActionModule&&(T=T.concat(y.clientActionModule)),y.clientLoaderModule&&(T=T.concat(y.clientLoaderModule)),a&&y.hydrateFallbackModule&&(T=T.concat(y.hydrateFallbackModule)),y.imports&&(T=T.concat(y.imports)),T}).flat(1))}function zB(o){return[...new Set(o)]}function OB(o){let t={},a=Object.keys(o).sort();for(let u of a)t[u]=o[u];return t}function NB(o,t){let a=new Set;return new Set(t),o.reduce((u,y)=>{let T=JSON.stringify(OB(y));return a.has(T)||(a.add(T),u.push({key:T,link:y})),u},[])}function wD(){let o=He.useContext(Vy);return $E(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function BB(){let o=He.useContext(g1);return $E(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var ZE=He.createContext(void 0);ZE.displayName="FrameworkContext";function TD(){let o=He.useContext(ZE);return $E(o,"You must render this element inside a <HydratedRouter> element"),o}function FB(o,t){let a=He.useContext(ZE),[u,y]=He.useState(!1),[T,C]=He.useState(!1),{onFocus:s,onBlur:B,onMouseEnter:V,onMouseLeave:W,onTouchStart:Q}=t,oe=He.useRef(null);He.useEffect(()=>{if(o==="render"&&C(!0),o==="viewport"){let Ye=st=>{st.forEach(ft=>{C(ft.isIntersecting)})},Xe=new IntersectionObserver(Ye,{threshold:.5});return oe.current&&Xe.observe(oe.current),()=>{Xe.disconnect()}}},[o]),He.useEffect(()=>{if(u){let Ye=setTimeout(()=>{C(!0)},100);return()=>{clearTimeout(Ye)}}},[u]);let he=()=>{y(!0)},Je=()=>{y(!1),C(!1)};return a?o!=="intent"?[T,oe,{}]:[T,oe,{onFocus:av(s,he),onBlur:av(B,Je),onMouseEnter:av(V,he),onMouseLeave:av(W,Je),onTouchStart:av(Q,he)}]:[!1,oe,{}]}function av(o,t){return a=>{o&&o(a),a.defaultPrevented||t(a)}}function VB({page:o,...t}){let{router:a}=wD(),u=He.useMemo(()=>cD(a.routes,o,a.basename),[a.routes,o,a.basename]);return u?He.createElement(UB,{page:o,matches:u,...t}):null}function jB(o){let{manifest:t,routeModules:a}=TD(),[u,y]=He.useState([]);return He.useEffect(()=>{let T=!1;return kB(o,t,a).then(C=>{T||y(C)}),()=>{T=!0}},[o,t,a]),u}function UB({page:o,matches:t,...a}){let u=Tp(),{future:y,manifest:T,routeModules:C}=TD(),{basename:s}=wD(),{loaderData:B,matches:V}=BB(),W=He.useMemo(()=>DC(o,t,V,T,u,"data"),[o,t,V,T,u]),Q=He.useMemo(()=>DC(o,t,V,T,u,"assets"),[o,t,V,T,u]),oe=He.useMemo(()=>{if(o===u.pathname+u.search+u.hash)return[];let Ye=new Set,Xe=!1;if(t.forEach(ft=>{var Ft;let ht=T.routes[ft.route.id];!ht||!ht.hasLoader||(!W.some(fn=>fn.route.id===ft.route.id)&&ft.route.id in B&&((Ft=C[ft.route.id])!=null&&Ft.shouldRevalidate)||ht.hasClientLoader?Xe=!0:Ye.add(ft.route.id))}),Ye.size===0)return[];let st=MB(o,s,y.unstable_trailingSlashAwareDataRequests,"data");return Xe&&Ye.size>0&&st.searchParams.set("_routes",t.filter(ft=>Ye.has(ft.route.id)).map(ft=>ft.route.id).join(",")),[st.pathname+st.search]},[s,y.unstable_trailingSlashAwareDataRequests,B,u,T,W,t,o,C]),he=He.useMemo(()=>LB(Q,T),[Q,T]),Je=jB(Q);return He.createElement(He.Fragment,null,oe.map(Ye=>He.createElement("link",{key:Ye,rel:"prefetch",as:"fetch",href:Ye,...a})),he.map(Ye=>He.createElement("link",{key:Ye,rel:"modulepreload",href:Ye,...a})),Je.map(({key:Ye,link:Xe})=>He.createElement("link",{key:Ye,nonce:a.nonce,...Xe,crossOrigin:Xe.crossOrigin??a.crossOrigin})))}function GB(...o){return t=>{o.forEach(a=>{typeof a=="function"?a(t):a!=null&&(a.current=t)})}}var qB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{qB&&(window.__reactRouterVersion="7.13.0")}catch{}function HB({basename:o,children:t,unstable_useTransitions:a,window:u}){let y=He.useRef();y.current==null&&(y.current=EN({window:u,v5Compat:!0}));let T=y.current,[C,s]=He.useState({action:T.action,location:T.location}),B=He.useCallback(V=>{a===!1?s(V):He.startTransition(()=>s(V))},[a]);return He.useLayoutEffect(()=>T.listen(B),[T,B]),He.createElement(xB,{basename:o,children:t,location:C.location,navigationType:C.action,navigator:T,unstable_useTransitions:a})}var ED=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,SD=He.forwardRef(function({onClick:t,discover:a="render",prefetch:u="none",relative:y,reloadDocument:T,replace:C,state:s,target:B,to:V,preventScrollReset:W,viewTransition:Q,unstable_defaultShouldRevalidate:oe,...he},Je){let{basename:Ye,unstable_useTransitions:Xe}=He.useContext(gu),st=typeof V=="string"&&ED.test(V),ft=fD(V,Ye);V=ft.to;let ht=rB(V,{relative:y}),[Ft,fn,St]=FB(u,he),je=WB(V,{replace:C,state:s,target:B,preventScrollReset:W,relative:y,viewTransition:Q,unstable_defaultShouldRevalidate:oe,unstable_useTransitions:Xe});function ze(Ke){t&&t(Ke),Ke.defaultPrevented||je(Ke)}let Ve=He.createElement("a",{...he,...St,href:ft.absoluteURL||ht,onClick:ft.isExternal||T?t:ze,ref:GB(Je,fn),target:B,"data-discover":!st&&a==="render"?"true":void 0});return Ft&&!st?He.createElement(He.Fragment,null,Ve,He.createElement(VB,{page:ht})):Ve});SD.displayName="Link";var Im=He.forwardRef(function({"aria-current":t="page",caseSensitive:a=!1,className:u="",end:y=!1,style:T,to:C,viewTransition:s,children:B,...V},W){let Q=jv(C,{relative:V.relative}),oe=Tp(),he=He.useContext(g1),{navigator:Je,basename:Ye}=He.useContext(gu),Xe=he!=null&&eF(Q)&&s===!0,st=Je.encodeLocation?Je.encodeLocation(Q).pathname:Q.pathname,ft=oe.pathname,ht=he&&he.navigation&&he.navigation.location?he.navigation.location.pathname:null;a||(ft=ft.toLowerCase(),ht=ht?ht.toLowerCase():null,st=st.toLowerCase()),ht&&Ye&&(ht=yp(ht,Ye)||ht);const Ft=st!=="/"&&st.endsWith("/")?st.length-1:st.length;let fn=ft===st||!y&&ft.startsWith(st)&&ft.charAt(Ft)==="/",St=ht!=null&&(ht===st||!y&&ht.startsWith(st)&&ht.charAt(st.length)==="/"),je={isActive:fn,isPending:St,isTransitioning:Xe},ze=fn?t:void 0,Ve;typeof u=="function"?Ve=u(je):Ve=[u,fn?"active":null,St?"pending":null,Xe?"transitioning":null].filter(Boolean).join(" ");let Ke=typeof T=="function"?T(je):T;return He.createElement(SD,{...V,"aria-current":ze,className:Ve,ref:W,style:Ke,to:C,viewTransition:s},typeof B=="function"?B(je):B)});Im.displayName="NavLink";var $B=He.forwardRef(({discover:o="render",fetcherKey:t,navigate:a,reloadDocument:u,replace:y,state:T,method:C=Cb,action:s,onSubmit:B,relative:V,preventScrollReset:W,viewTransition:Q,unstable_defaultShouldRevalidate:oe,...he},Je)=>{let{unstable_useTransitions:Ye}=He.useContext(gu),Xe=QB(),st=JB(s,{relative:V}),ft=C.toLowerCase()==="get"?"get":"post",ht=typeof s=="string"&&ED.test(s),Ft=fn=>{if(B&&B(fn),fn.defaultPrevented)return;fn.preventDefault();let St=fn.nativeEvent.submitter,je=(St==null?void 0:St.getAttribute("formmethod"))||C,ze=()=>Xe(St||fn.currentTarget,{fetcherKey:t,method:je,navigate:a,replace:y,state:T,relative:V,preventScrollReset:W,viewTransition:Q,unstable_defaultShouldRevalidate:oe});Ye&&a!==!1?He.startTransition(()=>ze()):ze()};return He.createElement("form",{ref:Je,method:ft,action:st,onSubmit:u?B:Ft,...he,"data-discover":!ht&&o==="render"?"true":void 0})});$B.displayName="Form";function ZB(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AD(o){let t=He.useContext(Vy);return ia(t,ZB(o)),t}function WB(o,{target:t,replace:a,state:u,preventScrollReset:y,relative:T,viewTransition:C,unstable_defaultShouldRevalidate:s,unstable_useTransitions:B}={}){let V=ff(),W=Tp(),Q=jv(o,{relative:T});return He.useCallback(oe=>{if(SB(oe,t)){oe.preventDefault();let he=a!==void 0?a:Iv(W)===Iv(Q),Je=()=>V(o,{replace:he,state:u,preventScrollReset:y,relative:T,viewTransition:C,unstable_defaultShouldRevalidate:s});B?He.startTransition(()=>Je()):Je()}},[W,V,Q,a,u,t,o,y,T,C,s,B])}function XB(o){mu(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=He.useRef(KT(o)),a=He.useRef(!1),u=Tp(),y=He.useMemo(()=>AB(u.search,a.current?null:t.current),[u.search]),T=ff(),C=He.useCallback((s,B)=>{const V=KT(typeof s=="function"?s(new URLSearchParams(y)):s);a.current=!0,T("?"+V,B)},[T,y]);return[y,C]}var YB=0,KB=()=>`__${String(++YB)}__`;function QB(){let{router:o}=AD("useSubmit"),{basename:t}=He.useContext(gu),a=mB(),u=o.fetch,y=o.navigate;return He.useCallback(async(T,C={})=>{let{action:s,method:B,encType:V,formData:W,body:Q}=RB(T,t);if(C.navigate===!1){let oe=C.fetcherKey||KB();await u(oe,a,C.action||s,{unstable_defaultShouldRevalidate:C.unstable_defaultShouldRevalidate,preventScrollReset:C.preventScrollReset,formData:W,body:Q,formMethod:C.method||B,formEncType:C.encType||V,flushSync:C.flushSync})}else await y(C.action||s,{unstable_defaultShouldRevalidate:C.unstable_defaultShouldRevalidate,preventScrollReset:C.preventScrollReset,formData:W,body:Q,formMethod:C.method||B,formEncType:C.encType||V,replace:C.replace,state:C.state,fromRouteId:a,flushSync:C.flushSync,viewTransition:C.viewTransition})},[u,y,t,a])}function JB(o,{relative:t}={}){let{basename:a}=He.useContext(gu),u=He.useContext(df);ia(u,"useFormAction must be used inside a RouteContext");let[y]=u.matches.slice(-1),T={...jv(o||".",{relative:t})},C=Tp();if(o==null){T.search=C.search;let s=new URLSearchParams(T.search),B=s.getAll("index");if(B.some(W=>W==="")){s.delete("index"),B.filter(Q=>Q).forEach(Q=>s.append("index",Q));let W=s.toString();T.search=W?`?${W}`:""}}return(!o||o===".")&&y.route.index&&(T.search=T.search?T.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(T.pathname=T.pathname==="/"?a:gp([a,T.pathname])),Iv(T)}function eF(o,{relative:t}={}){let a=He.useContext(mD);ia(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:u}=AD("useViewTransitionState"),y=jv(o,{relative:t});if(!a.isTransitioning)return!1;let T=yp(a.currentLocation.pathname,u)||a.currentLocation.pathname,C=yp(a.nextLocation.pathname,u)||a.nextLocation.pathname;return Zb(y.pathname,C)!=null||Zb(y.pathname,T)!=null}var ID=lD();const CD=He.createContext(void 0),tF=({children:o})=>{const[t,a]=He.useState(null),[u,y]=He.useState(!1),[T,C]=He.useState(null),s=async()=>(y(!0),C(null),new Promise(B=>{if(!navigator.geolocation){C("Geolocation is not supported by your browser"),y(!1),B(null);return}navigator.geolocation.getCurrentPosition(V=>{const W={latitude:V.coords.latitude,longitude:V.coords.longitude};a(W),y(!1),B(W)},V=>{C(V.message),y(!1),B(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}));return j.jsx(CD.Provider,{value:{userLocation:t,setUserLocation:a,requestLocation:s,isLoading:u,error:T},children:o})},RD=()=>{const o=He.useContext(CD);if(o===void 0)throw new Error("useLocation must be used within a LocationProvider");return o},nF=()=>{};var PC={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD=function(o){const t=[];let a=0;for(let u=0;u<o.length;u++){let y=o.charCodeAt(u);y<128?t[a++]=y:y<2048?(t[a++]=y>>6|192,t[a++]=y&63|128):(y&64512)===55296&&u+1<o.length&&(o.charCodeAt(u+1)&64512)===56320?(y=65536+((y&1023)<<10)+(o.charCodeAt(++u)&1023),t[a++]=y>>18|240,t[a++]=y>>12&63|128,t[a++]=y>>6&63|128,t[a++]=y&63|128):(t[a++]=y>>12|224,t[a++]=y>>6&63|128,t[a++]=y&63|128)}return t},iF=function(o){const t=[];let a=0,u=0;for(;a<o.length;){const y=o[a++];if(y<128)t[u++]=String.fromCharCode(y);else if(y>191&&y<224){const T=o[a++];t[u++]=String.fromCharCode((y&31)<<6|T&63)}else if(y>239&&y<365){const T=o[a++],C=o[a++],s=o[a++],B=((y&7)<<18|(T&63)<<12|(C&63)<<6|s&63)-65536;t[u++]=String.fromCharCode(55296+(B>>10)),t[u++]=String.fromCharCode(56320+(B&1023))}else{const T=o[a++],C=o[a++];t[u++]=String.fromCharCode((y&15)<<12|(T&63)<<6|C&63)}}return t.join("")},DD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(o,t){if(!Array.isArray(o))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,u=[];for(let y=0;y<o.length;y+=3){const T=o[y],C=y+1<o.length,s=C?o[y+1]:0,B=y+2<o.length,V=B?o[y+2]:0,W=T>>2,Q=(T&3)<<4|s>>4;let oe=(s&15)<<2|V>>6,he=V&63;B||(he=64,C||(oe=64)),u.push(a[W],a[Q],a[oe],a[he])}return u.join("")},encodeString(o,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(o):this.encodeByteArray(MD(o),t)},decodeString(o,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(o):iF(this.decodeStringToByteArray(o,t))},decodeStringToByteArray(o,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,u=[];for(let y=0;y<o.length;){const T=a[o.charAt(y++)],s=y<o.length?a[o.charAt(y)]:0;++y;const V=y<o.length?a[o.charAt(y)]:64;++y;const Q=y<o.length?a[o.charAt(y)]:64;if(++y,T==null||s==null||V==null||Q==null)throw new rF;const oe=T<<2|s>>4;if(u.push(oe),V!==64){const he=s<<4&240|V>>2;if(u.push(he),Q!==64){const Je=V<<6&192|Q;u.push(Je)}}}return u},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let o=0;o<this.ENCODED_VALS.length;o++)this.byteToCharMap_[o]=this.ENCODED_VALS.charAt(o),this.charToByteMap_[this.byteToCharMap_[o]]=o,this.byteToCharMapWebSafe_[o]=this.ENCODED_VALS_WEBSAFE.charAt(o),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[o]]=o,o>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(o)]=o,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(o)]=o)}}};class rF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sF=function(o){const t=MD(o);return DD.encodeByteArray(t,!0)},Wb=function(o){return sF(o).replace(/\./g,"")},PD=function(o){try{return DD.decodeString(o,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oF=()=>aF().__FIREBASE_DEFAULTS__,lF=()=>{if(typeof process>"u"||typeof PC>"u")return;const o=PC.__FIREBASE_DEFAULTS__;if(o)return JSON.parse(o)},cF=()=>{if(typeof document>"u")return;let o;try{o=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=o&&PD(o[1]);return t&&JSON.parse(t)},y1=()=>{try{return nF()||oF()||lF()||cF()}catch(o){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${o}`);return}},kD=o=>{var t,a;return(a=(t=y1())==null?void 0:t.emulatorHosts)==null?void 0:a[o]},uF=o=>{const t=kD(o);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const u=parseInt(t.substring(a+1),10);return t[0]==="["?[t.substring(1,a-1),u]:[t.substring(0,a),u]},LD=()=>{var o;return(o=y1())==null?void 0:o.config},zD=o=>{var t;return(t=y1())==null?void 0:t[`_${o}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,a)=>{this.resolve=t,this.reject=a})}wrapCallback(t){return(a,u)=>{a?this.reject(a):this.resolve(u),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(a):t(a,u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(o){try{return(o.startsWith("http://")||o.startsWith("https://")?new URL(o).hostname:o).endsWith(".cloudworkstations.dev")}catch{return!1}}async function OD(o){return(await fetch(o,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dF(o,t){if(o.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a={alg:"none",type:"JWT"},u=t||"demo-project",y=o.iat||0,T=o.sub||o.user_id;if(!T)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const C={iss:`https://securetoken.google.com/${u}`,aud:u,iat:y,exp:y+3600,auth_time:y,sub:T,user_id:T,firebase:{sign_in_provider:"custom",identities:{}},...o};return[Wb(JSON.stringify(a)),Wb(JSON.stringify(C)),""].join(".")}const yv={};function fF(){const o={prod:[],emulator:[]};for(const t of Object.keys(yv))yv[t]?o.emulator.push(t):o.prod.push(t);return o}function pF(o){let t=document.getElementById(o),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",o),a=!0),{created:a,element:t}}let kC=!1;function ND(o,t){if(typeof window>"u"||typeof document>"u"||!Uy(window.location.host)||yv[o]===t||yv[o]||kC)return;yv[o]=t;function a(oe){return`__firebase__banner__${oe}`}const u="__firebase__banner",T=fF().prod.length>0;function C(){const oe=document.getElementById(u);oe&&oe.remove()}function s(oe){oe.style.display="flex",oe.style.background="#7faaf0",oe.style.position="fixed",oe.style.bottom="5px",oe.style.left="5px",oe.style.padding=".5em",oe.style.borderRadius="5px",oe.style.alignItems="center"}function B(oe,he){oe.setAttribute("width","24"),oe.setAttribute("id",he),oe.setAttribute("height","24"),oe.setAttribute("viewBox","0 0 24 24"),oe.setAttribute("fill","none"),oe.style.marginLeft="-6px"}function V(){const oe=document.createElement("span");return oe.style.cursor="pointer",oe.style.marginLeft="16px",oe.style.fontSize="24px",oe.innerHTML=" &times;",oe.onclick=()=>{kC=!0,C()},oe}function W(oe,he){oe.setAttribute("id",he),oe.innerText="Learn more",oe.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",oe.setAttribute("target","__blank"),oe.style.paddingLeft="5px",oe.style.textDecoration="underline"}function Q(){const oe=pF(u),he=a("text"),Je=document.getElementById(he)||document.createElement("span"),Ye=a("learnmore"),Xe=document.getElementById(Ye)||document.createElement("a"),st=a("preprendIcon"),ft=document.getElementById(st)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(oe.created){const ht=oe.element;s(ht),W(Xe,Ye);const Ft=V();B(ft,st),ht.append(ft,Je,Xe,Ft),document.body.appendChild(ht)}T?(Je.innerText="Preview backend disconnected.",ft.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ft.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Je.innerText="Preview backend running in this workspace."),Je.setAttribute("id",he)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Q):Q()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mF(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Il())}function gF(){var t;const o=(t=y1())==null?void 0:t.forceEnvironment;if(o==="node")return!0;if(o==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _F(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function yF(){const o=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof o=="object"&&o.id!==void 0}function xF(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function vF(){const o=Il();return o.indexOf("MSIE ")>=0||o.indexOf("Trident/")>=0}function bF(){return!gF()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function wF(){try{return typeof indexedDB=="object"}catch{return!1}}function TF(){return new Promise((o,t)=>{try{let a=!0;const u="validate-browser-context-for-indexeddb-analytics-module",y=self.indexedDB.open(u);y.onsuccess=()=>{y.result.close(),a||self.indexedDB.deleteDatabase(u),o(!0)},y.onupgradeneeded=()=>{a=!1},y.onerror=()=>{var T;t(((T=y.error)==null?void 0:T.message)||"")}}catch(a){t(a)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EF="FirebaseError";class Ep extends Error{constructor(t,a,u){super(a),this.code=t,this.customData=u,this.name=EF,Object.setPrototypeOf(this,Ep.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Uv.prototype.create)}}class Uv{constructor(t,a,u){this.service=t,this.serviceName=a,this.errors=u}create(t,...a){const u=a[0]||{},y=`${this.service}/${t}`,T=this.errors[t],C=T?SF(T,u):"Error",s=`${this.serviceName}: ${C} (${y}).`;return new Ep(y,s,u)}}function SF(o,t){return o.replace(AF,(a,u)=>{const y=t[u];return y!=null?String(y):`<${u}?>`})}const AF=/\{\$([^}]+)}/g;function IF(o){for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t))return!1;return!0}function i_(o,t){if(o===t)return!0;const a=Object.keys(o),u=Object.keys(t);for(const y of a){if(!u.includes(y))return!1;const T=o[y],C=t[y];if(LC(T)&&LC(C)){if(!i_(T,C))return!1}else if(T!==C)return!1}for(const y of u)if(!a.includes(y))return!1;return!0}function LC(o){return o!==null&&typeof o=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(o){const t=[];for(const[a,u]of Object.entries(o))Array.isArray(u)?u.forEach(y=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(y))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(u));return t.length?"&"+t.join("&"):""}function CF(o,t){const a=new RF(o,t);return a.subscribe.bind(a)}class RF{constructor(t,a){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=a,this.task.then(()=>{t(this)}).catch(u=>{this.error(u)})}next(t){this.forEachObserver(a=>{a.next(t)})}error(t){this.forEachObserver(a=>{a.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,a,u){let y;if(t===void 0&&a===void 0&&u===void 0)throw new Error("Missing Observer.");MF(t,["next","error","complete"])?y=t:y={next:t,error:a,complete:u},y.next===void 0&&(y.next=yT),y.error===void 0&&(y.error=yT),y.complete===void 0&&(y.complete=yT);const T=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?y.error(this.finalError):y.complete()}catch{}}),this.observers.push(y),T}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let a=0;a<this.observers.length;a++)this.sendOne(a,t)}sendOne(t,a){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{a(this.observers[t])}catch(u){typeof console<"u"&&console.error&&console.error(u)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function MF(o,t){if(typeof o!="object"||o===null)return!1;for(const a of t)if(a in o&&typeof o[a]=="function")return!0;return!1}function yT(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ic(o){return o&&o._delegate?o._delegate:o}class r_{constructor(t,a,u){this.name=t,this.instanceFactory=a,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(t,a){this.name=t,this.container=a,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const a=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(a)){const u=new hF;if(this.instancesDeferred.set(a,u),this.isInitialized(a)||this.shouldAutoInitialize())try{const y=this.getOrInitializeService({instanceIdentifier:a});y&&u.resolve(y)}catch{}}return this.instancesDeferred.get(a).promise}getImmediate(t){const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),u=(t==null?void 0:t.optional)??!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(y){if(u)return null;throw y}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(kF(t))try{this.getOrInitializeService({instanceIdentifier:Qg})}catch{}for(const[a,u]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(a);try{const T=this.getOrInitializeService({instanceIdentifier:y});u.resolve(T)}catch{}}}}clearInstance(t=Qg){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...t.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Qg){return this.instances.has(t)}getOptions(t=Qg){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:a={}}=t,u=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(u))throw Error(`${this.name}(${u}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const y=this.getOrInitializeService({instanceIdentifier:u,options:a});for(const[T,C]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(T);u===s&&C.resolve(y)}return y}onInit(t,a){const u=this.normalizeInstanceIdentifier(a),y=this.onInitCallbacks.get(u)??new Set;y.add(t),this.onInitCallbacks.set(u,y);const T=this.instances.get(u);return T&&t(T,u),()=>{y.delete(t)}}invokeOnInitCallbacks(t,a){const u=this.onInitCallbacks.get(a);if(u)for(const y of u)try{y(t,a)}catch{}}getOrInitializeService({instanceIdentifier:t,options:a={}}){let u=this.instances.get(t);if(!u&&this.component&&(u=this.component.instanceFactory(this.container,{instanceIdentifier:PF(t),options:a}),this.instances.set(t,u),this.instancesOptions.set(t,a),this.invokeOnInitCallbacks(u,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,u)}catch{}return u||null}normalizeInstanceIdentifier(t=Qg){return this.component?this.component.multipleInstances?t:Qg:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function PF(o){return o===Qg?void 0:o}function kF(o){return o.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const a=this.getProvider(t.name);if(a.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);a.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const a=new DF(t,this);return this.providers.set(t,a),a}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mr;(function(o){o[o.DEBUG=0]="DEBUG",o[o.VERBOSE=1]="VERBOSE",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.SILENT=5]="SILENT"})(Mr||(Mr={}));const zF={debug:Mr.DEBUG,verbose:Mr.VERBOSE,info:Mr.INFO,warn:Mr.WARN,error:Mr.ERROR,silent:Mr.SILENT},OF=Mr.INFO,NF={[Mr.DEBUG]:"log",[Mr.VERBOSE]:"log",[Mr.INFO]:"info",[Mr.WARN]:"warn",[Mr.ERROR]:"error"},BF=(o,t,...a)=>{if(t<o.logLevel)return;const u=new Date().toISOString(),y=NF[t];if(y)console[y](`[${u}]  ${o.name}:`,...a);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class WE{constructor(t){this.name=t,this._logLevel=OF,this._logHandler=BF,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Mr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?zF[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Mr.DEBUG,...t),this._logHandler(this,Mr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Mr.VERBOSE,...t),this._logHandler(this,Mr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Mr.INFO,...t),this._logHandler(this,Mr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Mr.WARN,...t),this._logHandler(this,Mr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Mr.ERROR,...t),this._logHandler(this,Mr.ERROR,...t)}}const FF=(o,t)=>t.some(a=>o instanceof a);let zC,OC;function VF(){return zC||(zC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jF(){return OC||(OC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const BD=new WeakMap,QT=new WeakMap,FD=new WeakMap,xT=new WeakMap,XE=new WeakMap;function UF(o){const t=new Promise((a,u)=>{const y=()=>{o.removeEventListener("success",T),o.removeEventListener("error",C)},T=()=>{a(Pm(o.result)),y()},C=()=>{u(o.error),y()};o.addEventListener("success",T),o.addEventListener("error",C)});return t.then(a=>{a instanceof IDBCursor&&BD.set(a,o)}).catch(()=>{}),XE.set(t,o),t}function GF(o){if(QT.has(o))return;const t=new Promise((a,u)=>{const y=()=>{o.removeEventListener("complete",T),o.removeEventListener("error",C),o.removeEventListener("abort",C)},T=()=>{a(),y()},C=()=>{u(o.error||new DOMException("AbortError","AbortError")),y()};o.addEventListener("complete",T),o.addEventListener("error",C),o.addEventListener("abort",C)});QT.set(o,t)}let JT={get(o,t,a){if(o instanceof IDBTransaction){if(t==="done")return QT.get(o);if(t==="objectStoreNames")return o.objectStoreNames||FD.get(o);if(t==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return Pm(o[t])},set(o,t,a){return o[t]=a,!0},has(o,t){return o instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in o}};function qF(o){JT=o(JT)}function HF(o){return o===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...a){const u=o.call(vT(this),t,...a);return FD.set(u,t.sort?t.sort():[t]),Pm(u)}:jF().includes(o)?function(...t){return o.apply(vT(this),t),Pm(BD.get(this))}:function(...t){return Pm(o.apply(vT(this),t))}}function $F(o){return typeof o=="function"?HF(o):(o instanceof IDBTransaction&&GF(o),FF(o,VF())?new Proxy(o,JT):o)}function Pm(o){if(o instanceof IDBRequest)return UF(o);if(xT.has(o))return xT.get(o);const t=$F(o);return t!==o&&(xT.set(o,t),XE.set(t,o)),t}const vT=o=>XE.get(o);function ZF(o,t,{blocked:a,upgrade:u,blocking:y,terminated:T}={}){const C=indexedDB.open(o,t),s=Pm(C);return u&&C.addEventListener("upgradeneeded",B=>{u(Pm(C.result),B.oldVersion,B.newVersion,Pm(C.transaction),B)}),a&&C.addEventListener("blocked",B=>a(B.oldVersion,B.newVersion,B)),s.then(B=>{T&&B.addEventListener("close",()=>T()),y&&B.addEventListener("versionchange",V=>y(V.oldVersion,V.newVersion,V))}).catch(()=>{}),s}const WF=["get","getKey","getAll","getAllKeys","count"],XF=["put","add","delete","clear"],bT=new Map;function NC(o,t){if(!(o instanceof IDBDatabase&&!(t in o)&&typeof t=="string"))return;if(bT.get(t))return bT.get(t);const a=t.replace(/FromIndex$/,""),u=t!==a,y=XF.includes(a);if(!(a in(u?IDBIndex:IDBObjectStore).prototype)||!(y||WF.includes(a)))return;const T=async function(C,...s){const B=this.transaction(C,y?"readwrite":"readonly");let V=B.store;return u&&(V=V.index(s.shift())),(await Promise.all([V[a](...s),y&&B.done]))[0]};return bT.set(t,T),T}qF(o=>({...o,get:(t,a,u)=>NC(t,a)||o.get(t,a,u),has:(t,a)=>!!NC(t,a)||o.has(t,a)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(KF(a)){const u=a.getImmediate();return`${u.library}/${u.version}`}else return null}).filter(a=>a).join(" ")}}function KF(o){const t=o.getComponent();return(t==null?void 0:t.type)==="VERSION"}const eE="@firebase/app",BC="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp=new WE("@firebase/app"),QF="@firebase/app-compat",JF="@firebase/analytics-compat",e5="@firebase/analytics",t5="@firebase/app-check-compat",n5="@firebase/app-check",i5="@firebase/auth",r5="@firebase/auth-compat",s5="@firebase/database",a5="@firebase/data-connect",o5="@firebase/database-compat",l5="@firebase/functions",c5="@firebase/functions-compat",u5="@firebase/installations",h5="@firebase/installations-compat",d5="@firebase/messaging",f5="@firebase/messaging-compat",p5="@firebase/performance",m5="@firebase/performance-compat",g5="@firebase/remote-config",_5="@firebase/remote-config-compat",y5="@firebase/storage",x5="@firebase/storage-compat",v5="@firebase/firestore",b5="@firebase/ai",w5="@firebase/firestore-compat",T5="firebase",E5="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE="[DEFAULT]",S5={[eE]:"fire-core",[QF]:"fire-core-compat",[e5]:"fire-analytics",[JF]:"fire-analytics-compat",[n5]:"fire-app-check",[t5]:"fire-app-check-compat",[i5]:"fire-auth",[r5]:"fire-auth-compat",[s5]:"fire-rtdb",[a5]:"fire-data-connect",[o5]:"fire-rtdb-compat",[l5]:"fire-fn",[c5]:"fire-fn-compat",[u5]:"fire-iid",[h5]:"fire-iid-compat",[d5]:"fire-fcm",[f5]:"fire-fcm-compat",[p5]:"fire-perf",[m5]:"fire-perf-compat",[g5]:"fire-rc",[_5]:"fire-rc-compat",[y5]:"fire-gcs",[x5]:"fire-gcs-compat",[v5]:"fire-fst",[w5]:"fire-fst-compat",[b5]:"fire-vertex","fire-js":"fire-js",[T5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb=new Map,A5=new Map,nE=new Map;function FC(o,t){try{o.container.addComponent(t)}catch(a){xp.debug(`Component ${t.name} failed to register with FirebaseApp ${o.name}`,a)}}function My(o){const t=o.name;if(nE.has(t))return xp.debug(`There were multiple attempts to register component ${t}.`),!1;nE.set(t,o);for(const a of Xb.values())FC(a,o);for(const a of A5.values())FC(a,o);return!0}function YE(o,t){const a=o.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),o.container.getProvider(t)}function Xh(o){return o==null?!1:o.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},km=new Uv("app","Firebase",I5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(t,a,u){this._isDeleted=!1,this._options={...t},this._config={...a},this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=u,this.container.addComponent(new r_("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw km.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy=E5;function VD(o,t={}){let a=o;typeof t!="object"&&(t={name:t});const u={name:tE,automaticDataCollectionEnabled:!0,...t},y=u.name;if(typeof y!="string"||!y)throw km.create("bad-app-name",{appName:String(y)});if(a||(a=LD()),!a)throw km.create("no-options");const T=Xb.get(y);if(T){if(i_(a,T.options)&&i_(u,T.config))return T;throw km.create("duplicate-app",{appName:y})}const C=new LF(y);for(const B of nE.values())C.addComponent(B);const s=new C5(a,u,C);return Xb.set(y,s),s}function jD(o=tE){const t=Xb.get(o);if(!t&&o===tE&&LD())return VD();if(!t)throw km.create("no-app",{appName:o});return t}function Lm(o,t,a){let u=S5[o]??o;a&&(u+=`-${a}`);const y=u.match(/\s|\//),T=t.match(/\s|\//);if(y||T){const C=[`Unable to register library "${u}" with version "${t}":`];y&&C.push(`library name "${u}" contains illegal characters (whitespace or "/")`),y&&T&&C.push("and"),T&&C.push(`version name "${t}" contains illegal characters (whitespace or "/")`),xp.warn(C.join(" "));return}My(new r_(`${u}-version`,()=>({library:u,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R5="firebase-heartbeat-database",M5=1,Cv="firebase-heartbeat-store";let wT=null;function UD(){return wT||(wT=ZF(R5,M5,{upgrade:(o,t)=>{switch(t){case 0:try{o.createObjectStore(Cv)}catch(a){console.warn(a)}}}}).catch(o=>{throw km.create("idb-open",{originalErrorMessage:o.message})})),wT}async function D5(o){try{const a=(await UD()).transaction(Cv),u=await a.objectStore(Cv).get(GD(o));return await a.done,u}catch(t){if(t instanceof Ep)xp.warn(t.message);else{const a=km.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});xp.warn(a.message)}}}async function VC(o,t){try{const u=(await UD()).transaction(Cv,"readwrite");await u.objectStore(Cv).put(t,GD(o)),await u.done}catch(a){if(a instanceof Ep)xp.warn(a.message);else{const u=km.create("idb-set",{originalErrorMessage:a==null?void 0:a.message});xp.warn(u.message)}}}function GD(o){return`${o.name}!${o.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5=1024,k5=30;class L5{constructor(t){this.container=t,this._heartbeatsCache=null;const a=this.container.getProvider("app").getImmediate();this._storage=new O5(a),this._heartbeatsCachePromise=this._storage.read().then(u=>(this._heartbeatsCache=u,u))}async triggerHeartbeat(){var t,a;try{const y=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),T=jC();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((a=this._heartbeatsCache)==null?void 0:a.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===T||this._heartbeatsCache.heartbeats.some(C=>C.date===T))return;if(this._heartbeatsCache.heartbeats.push({date:T,agent:y}),this._heartbeatsCache.heartbeats.length>k5){const C=N5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(C,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(u){xp.warn(u)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const a=jC(),{heartbeatsToSend:u,unsentEntries:y}=z5(this._heartbeatsCache.heartbeats),T=Wb(JSON.stringify({version:2,heartbeats:u}));return this._heartbeatsCache.lastSentHeartbeatDate=a,y.length>0?(this._heartbeatsCache.heartbeats=y,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),T}catch(a){return xp.warn(a),""}}}function jC(){return new Date().toISOString().substring(0,10)}function z5(o,t=P5){const a=[];let u=o.slice();for(const y of o){const T=a.find(C=>C.agent===y.agent);if(T){if(T.dates.push(y.date),UC(a)>t){T.dates.pop();break}}else if(a.push({agent:y.agent,dates:[y.date]}),UC(a)>t){a.pop();break}u=u.slice(1)}return{heartbeatsToSend:a,unsentEntries:u}}class O5{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wF()?TF().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const a=await D5(this.app);return a!=null&&a.heartbeats?a:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const u=await this.read();return VC(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??u.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const u=await this.read();return VC(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...t.heartbeats]})}else return}}function UC(o){return Wb(JSON.stringify({version:2,heartbeats:o})).length}function N5(o){if(o.length===0)return-1;let t=0,a=o[0].date;for(let u=1;u<o.length;u++)o[u].date<a&&(a=o[u].date,t=u);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B5(o){My(new r_("platform-logger",t=>new YF(t),"PRIVATE")),My(new r_("heartbeat",t=>new L5(t),"PRIVATE")),Lm(eE,BC,o),Lm(eE,BC,"esm2020"),Lm("fire-js","")}B5("");function qD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const F5=qD,HD=new Uv("auth","Firebase",qD());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb=new WE("@firebase/auth");function V5(o,...t){Yb.logLevel<=Mr.WARN&&Yb.warn(`Auth (${Gy}): ${o}`,...t)}function Mb(o,...t){Yb.logLevel<=Mr.ERROR&&Yb.error(`Auth (${Gy}): ${o}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(o,...t){throw QE(o,...t)}function Qh(o,...t){return QE(o,...t)}function KE(o,t,a){const u={...F5(),[t]:a};return new Uv("auth","Firebase",u).create(t,{appName:o.name})}function t_(o){return KE(o,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function j5(o,t,a){const u=a;if(!(t instanceof u))throw u.name!==t.constructor.name&&of(o,"argument-error"),KE(o,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function QE(o,...t){if(typeof o!="string"){const a=t[0],u=[...t.slice(1)];return u[0]&&(u[0].appName=o.name),o._errorFactory.create(a,...u)}return HD.create(o,...t)}function qi(o,t,...a){if(!o)throw QE(t,...a)}function pp(o){const t="INTERNAL ASSERTION FAILED: "+o;throw Mb(t),new Error(t)}function vp(o,t){o||pp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(){var o;return typeof self<"u"&&((o=self.location)==null?void 0:o.href)||""}function U5(){return GC()==="http:"||GC()==="https:"}function GC(){var o;return typeof self<"u"&&((o=self.location)==null?void 0:o.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(U5()||yF()||"connection"in navigator)?navigator.onLine:!0}function q5(){if(typeof navigator>"u")return null;const o=navigator;return o.languages&&o.languages[0]||o.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(t,a){this.shortDelay=t,this.longDelay=a,vp(a>t,"Short delay should be less than long delay!"),this.isMobile=mF()||xF()}get(){return G5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(o,t){vp(o.emulator,"Emulator should always be set here");const{url:a}=o.emulator;return t?`${a}${t.startsWith("/")?t.slice(1):t}`:a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{static initialize(t,a,u){this.fetchImpl=t,a&&(this.headersImpl=a),u&&(this.responseImpl=u)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $5=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Z5=new qv(3e4,6e4);function eS(o,t){return o.tenantId&&!t.tenantId?{...t,tenantId:o.tenantId}:t}async function qy(o,t,a,u,y={}){return ZD(o,y,async()=>{let T={},C={};u&&(t==="GET"?C=u:T={body:JSON.stringify(u)});const s=Gv({key:o.config.apiKey,...C}).slice(1),B=await o._getAdditionalHeaders();B["Content-Type"]="application/json",o.languageCode&&(B["X-Firebase-Locale"]=o.languageCode);const V={method:t,headers:B,...T};return _F()||(V.referrerPolicy="no-referrer"),o.emulatorConfig&&Uy(o.emulatorConfig.host)&&(V.credentials="include"),$D.fetch()(await WD(o,o.config.apiHost,a,s),V)})}async function ZD(o,t,a){o._canInitEmulator=!1;const u={...H5,...t};try{const y=new X5(o),T=await Promise.race([a(),y.promise]);y.clearNetworkTimeout();const C=await T.json();if("needConfirmation"in C)throw _b(o,"account-exists-with-different-credential",C);if(T.ok&&!("errorMessage"in C))return C;{const s=T.ok?C.errorMessage:C.error.message,[B,V]=s.split(" : ");if(B==="FEDERATED_USER_ID_ALREADY_LINKED")throw _b(o,"credential-already-in-use",C);if(B==="EMAIL_EXISTS")throw _b(o,"email-already-in-use",C);if(B==="USER_DISABLED")throw _b(o,"user-disabled",C);const W=u[B]||B.toLowerCase().replace(/[_\s]+/g,"-");if(V)throw KE(o,W,V);of(o,W)}}catch(y){if(y instanceof Ep)throw y;of(o,"network-request-failed",{message:String(y)})}}async function W5(o,t,a,u,y={}){const T=await qy(o,t,a,u,y);return"mfaPendingCredential"in T&&of(o,"multi-factor-auth-required",{_serverResponse:T}),T}async function WD(o,t,a,u){const y=`${t}${a}?${u}`,T=o,C=T.config.emulator?JE(o.config,y):`${o.config.apiScheme}://${y}`;return $5.includes(a)&&(await T._persistenceManagerAvailable,T._getPersistenceType()==="COOKIE")?T._getPersistence()._getFinalTarget(C).toString():C}class X5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((a,u)=>{this.timer=setTimeout(()=>u(Qh(this.auth,"network-request-failed")),Z5.get())})}}function _b(o,t,a){const u={appName:o.name};a.email&&(u.email=a.email),a.phoneNumber&&(u.phoneNumber=a.phoneNumber);const y=Qh(o,t,u);return y.customData._tokenResponse=a,y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y5(o,t){return qy(o,"POST","/v1/accounts:delete",t)}async function Kb(o,t){return qy(o,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(o){if(o)try{const t=new Date(Number(o));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function K5(o,t=!1){const a=ic(o),u=await a.getIdToken(t),y=tS(u);qi(y&&y.exp&&y.auth_time&&y.iat,a.auth,"internal-error");const T=typeof y.firebase=="object"?y.firebase:void 0,C=T==null?void 0:T.sign_in_provider;return{claims:y,token:u,authTime:xv(TT(y.auth_time)),issuedAtTime:xv(TT(y.iat)),expirationTime:xv(TT(y.exp)),signInProvider:C||null,signInSecondFactor:(T==null?void 0:T.sign_in_second_factor)||null}}function TT(o){return Number(o)*1e3}function tS(o){const[t,a,u]=o.split(".");if(t===void 0||a===void 0||u===void 0)return Mb("JWT malformed, contained fewer than 3 sections"),null;try{const y=PD(a);return y?JSON.parse(y):(Mb("Failed to decode base64 JWT payload"),null)}catch(y){return Mb("Caught error parsing JWT payload as JSON",y==null?void 0:y.toString()),null}}function qC(o){const t=tS(o);return qi(t,"internal-error"),qi(typeof t.exp<"u","internal-error"),qi(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rv(o,t,a=!1){if(a)return t;try{return await t}catch(u){throw u instanceof Ep&&Q5(u)&&o.auth.currentUser===o&&await o.auth.signOut(),u}}function Q5({code:o}){return o==="auth/user-disabled"||o==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J5{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const u=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,u)}}schedule(t=!1){if(!this.isRunning)return;const a=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},a)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(t,a){this.createdAt=t,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=xv(this.lastLoginAt),this.creationTime=xv(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qb(o){var Q;const t=o.auth,a=await o.getIdToken(),u=await Rv(o,Kb(t,{idToken:a}));qi(u==null?void 0:u.users.length,t,"internal-error");const y=u.users[0];o._notifyReloadListener(y);const T=(Q=y.providerUserInfo)!=null&&Q.length?XD(y.providerUserInfo):[],C=t4(o.providerData,T),s=o.isAnonymous,B=!(o.email&&y.passwordHash)&&!(C!=null&&C.length),V=s?B:!1,W={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:C,metadata:new rE(y.createdAt,y.lastLoginAt),isAnonymous:V};Object.assign(o,W)}async function e4(o){const t=ic(o);await Qb(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function t4(o,t){return[...o.filter(u=>!t.some(y=>y.providerId===u.providerId)),...t]}function XD(o){return o.map(({providerId:t,...a})=>({providerId:t,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n4(o,t){const a=await ZD(o,{},async()=>{const u=Gv({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:y,apiKey:T}=o.config,C=await WD(o,y,"/v1/token",`key=${T}`),s=await o._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";const B={method:"POST",headers:s,body:u};return o.emulatorConfig&&Uy(o.emulatorConfig.host)&&(B.credentials="include"),$D.fetch()(C,B)});return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}}async function i4(o,t){return qy(o,"POST","/v2/accounts:revokeToken",eS(o,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){qi(t.idToken,"internal-error"),qi(typeof t.idToken<"u","internal-error"),qi(typeof t.refreshToken<"u","internal-error");const a="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):qC(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,a)}updateFromIdToken(t){qi(t.length!==0,"internal-error");const a=qC(t);this.updateTokensAndExpiration(t,null,a)}async getToken(t,a=!1){return!a&&this.accessToken&&!this.isExpired?this.accessToken:(qi(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,a){const{accessToken:u,refreshToken:y,expiresIn:T}=await n4(t,a);this.updateTokensAndExpiration(u,y,Number(T))}updateTokensAndExpiration(t,a,u){this.refreshToken=a||null,this.accessToken=t||null,this.expirationTime=Date.now()+u*1e3}static fromJSON(t,a){const{refreshToken:u,accessToken:y,expirationTime:T}=a,C=new by;return u&&(qi(typeof u=="string","internal-error",{appName:t}),C.refreshToken=u),y&&(qi(typeof y=="string","internal-error",{appName:t}),C.accessToken=y),T&&(qi(typeof T=="number","internal-error",{appName:t}),C.expirationTime=T),C}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new by,this.toJSON())}_performRefresh(){return pp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sm(o,t){qi(typeof o=="string"||typeof o>"u","internal-error",{appName:t})}class Yh{constructor({uid:t,auth:a,stsTokenManager:u,...y}){this.providerId="firebase",this.proactiveRefresh=new J5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=a,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new rE(y.createdAt||void 0,y.lastLoginAt||void 0)}async getIdToken(t){const a=await Rv(this,this.stsTokenManager.getToken(this.auth,t));return qi(a,this.auth,"internal-error"),this.accessToken!==a&&(this.accessToken=a,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),a}getIdTokenResult(t){return K5(this,t)}reload(){return e4(this)}_assign(t){this!==t&&(qi(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(a=>({...a})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const a=new Yh({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return a.metadata._copy(this.metadata),a}_onReload(t){qi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,a=!1){let u=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),u=!0),a&&await Qb(this),await this.auth._persistUserIfCurrent(this),u&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xh(this.auth.app))return Promise.reject(t_(this.auth));const t=await this.getIdToken();return await Rv(this,Y5(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,a){const u=a.displayName??void 0,y=a.email??void 0,T=a.phoneNumber??void 0,C=a.photoURL??void 0,s=a.tenantId??void 0,B=a._redirectEventId??void 0,V=a.createdAt??void 0,W=a.lastLoginAt??void 0,{uid:Q,emailVerified:oe,isAnonymous:he,providerData:Je,stsTokenManager:Ye}=a;qi(Q&&Ye,t,"internal-error");const Xe=by.fromJSON(this.name,Ye);qi(typeof Q=="string",t,"internal-error"),Sm(u,t.name),Sm(y,t.name),qi(typeof oe=="boolean",t,"internal-error"),qi(typeof he=="boolean",t,"internal-error"),Sm(T,t.name),Sm(C,t.name),Sm(s,t.name),Sm(B,t.name),Sm(V,t.name),Sm(W,t.name);const st=new Yh({uid:Q,auth:t,email:y,emailVerified:oe,displayName:u,isAnonymous:he,photoURL:C,phoneNumber:T,tenantId:s,stsTokenManager:Xe,createdAt:V,lastLoginAt:W});return Je&&Array.isArray(Je)&&(st.providerData=Je.map(ft=>({...ft}))),B&&(st._redirectEventId=B),st}static async _fromIdTokenResponse(t,a,u=!1){const y=new by;y.updateFromServerResponse(a);const T=new Yh({uid:a.localId,auth:t,stsTokenManager:y,isAnonymous:u});return await Qb(T),T}static async _fromGetAccountInfoResponse(t,a,u){const y=a.users[0];qi(y.localId!==void 0,"internal-error");const T=y.providerUserInfo!==void 0?XD(y.providerUserInfo):[],C=!(y.email&&y.passwordHash)&&!(T!=null&&T.length),s=new by;s.updateFromIdToken(u);const B=new Yh({uid:y.localId,auth:t,stsTokenManager:s,isAnonymous:C}),V={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:T,metadata:new rE(y.createdAt,y.lastLoginAt),isAnonymous:!(y.email&&y.passwordHash)&&!(T!=null&&T.length)};return Object.assign(B,V),B}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC=new Map;function mp(o){vp(o instanceof Function,"Expected a class definition");let t=HC.get(o);return t?(vp(t instanceof o,"Instance stored in cache mismatched with class"),t):(t=new o,HC.set(o,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,a){this.storage[t]=a}async _get(t){const a=this.storage[t];return a===void 0?null:a}async _remove(t){delete this.storage[t]}_addListener(t,a){}_removeListener(t,a){}}YD.type="NONE";const $C=YD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(o,t,a){return`firebase:${o}:${t}:${a}`}class wy{constructor(t,a,u){this.persistence=t,this.auth=a,this.userKey=u;const{config:y,name:T}=this.auth;this.fullUserKey=Db(this.userKey,y.apiKey,T),this.fullPersistenceKey=Db("persistence",y.apiKey,T),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const a=await Kb(this.auth,{idToken:t}).catch(()=>{});return a?Yh._fromGetAccountInfoResponse(this.auth,a,t):null}return Yh._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const a=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,a)return this.setCurrentUser(a)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,a,u="authUser"){if(!a.length)return new wy(mp($C),t,u);const y=(await Promise.all(a.map(async V=>{if(await V._isAvailable())return V}))).filter(V=>V);let T=y[0]||mp($C);const C=Db(u,t.config.apiKey,t.name);let s=null;for(const V of a)try{const W=await V._get(C);if(W){let Q;if(typeof W=="string"){const oe=await Kb(t,{idToken:W}).catch(()=>{});if(!oe)break;Q=await Yh._fromGetAccountInfoResponse(t,oe,W)}else Q=Yh._fromJSON(t,W);V!==T&&(s=Q),T=V;break}}catch{}const B=y.filter(V=>V._shouldAllowMigration);return!T._shouldAllowMigration||!B.length?new wy(T,t,u):(T=B[0],s&&await T._set(C,s.toJSON()),await Promise.all(a.map(async V=>{if(V!==T)try{await V._remove(C)}catch{}})),new wy(T,t,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZC(o){const t=o.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(eP(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(KD(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nP(t))return"Blackberry";if(iP(t))return"Webos";if(QD(t))return"Safari";if((t.includes("chrome/")||JD(t))&&!t.includes("edge/"))return"Chrome";if(tP(t))return"Android";{const a=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,u=o.match(a);if((u==null?void 0:u.length)===2)return u[1]}return"Other"}function KD(o=Il()){return/firefox\//i.test(o)}function QD(o=Il()){const t=o.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function JD(o=Il()){return/crios\//i.test(o)}function eP(o=Il()){return/iemobile/i.test(o)}function tP(o=Il()){return/android/i.test(o)}function nP(o=Il()){return/blackberry/i.test(o)}function iP(o=Il()){return/webos/i.test(o)}function nS(o=Il()){return/iphone|ipad|ipod/i.test(o)||/macintosh/i.test(o)&&/mobile/i.test(o)}function r4(o=Il()){var t;return nS(o)&&!!((t=window.navigator)!=null&&t.standalone)}function s4(){return vF()&&document.documentMode===10}function rP(o=Il()){return nS(o)||tP(o)||iP(o)||nP(o)||/windows phone/i.test(o)||eP(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(o,t=[]){let a;switch(o){case"Browser":a=ZC(Il());break;case"Worker":a=`${ZC(Il())}-${o}`;break;default:a=o}const u=t.length?t.join(","):"FirebaseCore-web";return`${a}/JsCore/${Gy}/${u}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,a){const u=T=>new Promise((C,s)=>{try{const B=t(T);C(B)}catch(B){s(B)}});u.onAbort=a,this.queue.push(u);const y=this.queue.length-1;return()=>{this.queue[y]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const a=[];try{for(const u of this.queue)await u(t),u.onAbort&&a.push(u.onAbort)}catch(u){a.reverse();for(const y of a)try{y()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:u==null?void 0:u.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o4(o,t={}){return qy(o,"GET","/v2/passwordPolicy",eS(o,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4=6;class c4{constructor(t){var u;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=a.minPasswordLength??l4,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((u=t.allowedNonAlphanumericCharacters)==null?void 0:u.join(""))??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=a.meetsMinPasswordLength??!0),a.isValid&&(a.isValid=a.meetsMaxPasswordLength??!0),a.isValid&&(a.isValid=a.containsLowercaseLetter??!0),a.isValid&&(a.isValid=a.containsUppercaseLetter??!0),a.isValid&&(a.isValid=a.containsNumericCharacter??!0),a.isValid&&(a.isValid=a.containsNonAlphanumericCharacter??!0),a}validatePasswordLengthOptions(t,a){const u=this.customStrengthOptions.minPasswordLength,y=this.customStrengthOptions.maxPasswordLength;u&&(a.meetsMinPasswordLength=t.length>=u),y&&(a.meetsMaxPasswordLength=t.length<=y)}validatePasswordCharacterOptions(t,a){this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);let u;for(let y=0;y<t.length;y++)u=t.charAt(y),this.updatePasswordCharacterOptionsStatuses(a,u>="a"&&u<="z",u>="A"&&u<="Z",u>="0"&&u<="9",this.allowedNonAlphanumericCharacters.includes(u))}updatePasswordCharacterOptionsStatuses(t,a,u,y,T){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=u)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=y)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=T))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{constructor(t,a,u,y){this.app=t,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=u,this.config=y,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new WC(this),this.idTokenSubscription=new WC(this),this.beforeStateQueue=new a4(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=HD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=y.sdkClientVersion,this._persistenceManagerAvailable=new Promise(T=>this._resolvePersistenceManagerAvailable=T)}_initializeWithPersistence(t,a){return a&&(this._popupRedirectResolver=mp(a)),this._initializationPromise=this.queue(async()=>{var u,y,T;if(!this._deleted&&(this.persistenceManager=await wy.create(this,t),(u=this._resolvePersistenceManagerAvailable)==null||u.call(this),!this._deleted)){if((y=this._popupRedirectResolver)!=null&&y._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(a),this.lastNotifiedUid=((T=this.currentUser)==null?void 0:T.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const a=await Kb(this,{idToken:t}),u=await Yh._fromGetAccountInfoResponse(this,a,t);await this.directlySetCurrentUser(u)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var T;if(Xh(this.app)){const C=this.app.settings.authIdToken;return C?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(C).then(s,s))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let u=a,y=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const C=(T=this.redirectUser)==null?void 0:T._redirectEventId,s=u==null?void 0:u._redirectEventId,B=await this.tryRedirectSignIn(t);(!C||C===s)&&(B!=null&&B.user)&&(u=B.user,y=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(y)try{await this.beforeStateQueue.runMiddleware(u)}catch(C){u=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(C))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return qi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(t){let a=null;try{a=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return a}async reloadAndSetCurrentUserOrClear(t){try{await Qb(t)}catch(a){if((a==null?void 0:a.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=q5()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Xh(this.app))return Promise.reject(t_(this));const a=t?ic(t):null;return a&&qi(a.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(a&&a._clone(this))}async _updateCurrentUser(t,a=!1){if(!this._deleted)return t&&qi(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),a||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Xh(this.app)?Promise.reject(t_(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Xh(this.app)?Promise.reject(t_(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mp(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const a=this._getPasswordPolicyInternal();return a.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):a.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await o4(this),a=new c4(t);this.tenantId===null?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Uv("auth","Firebase",t())}onAuthStateChanged(t,a,u){return this.registerStateListener(this.authStateSubscription,t,a,u)}beforeAuthStateChanged(t,a){return this.beforeStateQueue.pushCallback(t,a)}onIdTokenChanged(t,a,u){return this.registerStateListener(this.idTokenSubscription,t,a,u)}authStateReady(){return new Promise((t,a)=>{if(this.currentUser)t();else{const u=this.onAuthStateChanged(()=>{u(),t()},a)}})}async revokeAccessToken(t){if(this.currentUser){const a=await this.currentUser.getIdToken(),u={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:a};this.tenantId!=null&&(u.tenantId=this.tenantId),await i4(this,u)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)==null?void 0:t.toJSON()}}async _setRedirectUser(t,a){const u=await this.getOrInitRedirectPersistenceManager(a);return t===null?u.removeCurrentUser():u.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const a=t&&mp(t)||this._popupRedirectResolver;qi(a,this,"argument-error"),this.redirectPersistenceManager=await wy.create(this,[mp(a._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var a,u;return this._isInitialized&&await this.queue(async()=>{}),((a=this._currentUser)==null?void 0:a._redirectEventId)===t?this._currentUser:((u=this.redirectUser)==null?void 0:u._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=((a=this.currentUser)==null?void 0:a.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,a,u,y){if(this._deleted)return()=>{};const T=typeof a=="function"?a:a.next.bind(a);let C=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(qi(s,this,"internal-error"),s.then(()=>{C||T(this.currentUser)}),typeof a=="function"){const B=t.addObserver(a,u,y);return()=>{C=!0,B()}}else{const B=t.addObserver(a);return()=>{C=!0,B()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return qi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=sP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var y;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const a=await((y=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:y.getHeartbeatsHeader());a&&(t["X-Firebase-Client"]=a);const u=await this._getAppCheckToken();return u&&(t["X-Firebase-AppCheck"]=u),t}async _getAppCheckToken(){var a;if(Xh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((a=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:a.getToken());return t!=null&&t.error&&V5(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function x1(o){return ic(o)}class WC{constructor(t){this.auth=t,this.observer=null,this.addObserver=CF(a=>this.observer=a)}get next(){return qi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iS={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function h4(o){iS=o}function d4(o){return iS.loadJS(o)}function f4(){return iS.gapiScript}function p4(o){return`__${o}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m4(o,t){const a=YE(o,"auth");if(a.isInitialized()){const y=a.getImmediate(),T=a.getOptions();if(i_(T,t??{}))return y;of(y,"already-initialized")}return a.initialize({options:t})}function g4(o,t){const a=(t==null?void 0:t.persistence)||[],u=(Array.isArray(a)?a:[a]).map(mp);t!=null&&t.errorMap&&o._updateErrorMap(t.errorMap),o._initializeWithPersistence(u,t==null?void 0:t.popupRedirectResolver)}function _4(o,t,a){const u=x1(o);qi(/^https?:\/\//.test(t),u,"invalid-emulator-scheme");const y=!1,T=aP(t),{host:C,port:s}=y4(t),B=s===null?"":`:${s}`,V={url:`${T}//${C}${B}/`},W=Object.freeze({host:C,port:s,protocol:T.replace(":",""),options:Object.freeze({disableWarnings:y})});if(!u._canInitEmulator){qi(u.config.emulator&&u.emulatorConfig,u,"emulator-config-failed"),qi(i_(V,u.config.emulator)&&i_(W,u.emulatorConfig),u,"emulator-config-failed");return}u.config.emulator=V,u.emulatorConfig=W,u.settings.appVerificationDisabledForTesting=!0,Uy(C)?(OD(`${T}//${C}${B}`),ND("Auth",!0)):x4()}function aP(o){const t=o.indexOf(":");return t<0?"":o.substr(0,t+1)}function y4(o){const t=aP(o),a=/(\/\/)?([^?#/]+)/.exec(o.substr(t.length));if(!a)return{host:"",port:null};const u=a[2].split("@").pop()||"",y=/^(\[[^\]]+\])(:|$)/.exec(u);if(y){const T=y[1];return{host:T,port:XC(u.substr(T.length+1))}}else{const[T,C]=u.split(":");return{host:T,port:XC(C)}}}function XC(o){if(!o)return null;const t=Number(o);return isNaN(t)?null:t}function x4(){function o(){const t=document.createElement("p"),a=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",o):o())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(t,a){this.providerId=t,this.signInMethod=a}toJSON(){return pp("not implemented")}_getIdTokenResponse(t){return pp("not implemented")}_linkToIdToken(t,a){return pp("not implemented")}_getReauthenticationResolver(t){return pp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ty(o,t){return W5(o,"POST","/v1/accounts:signInWithIdp",eS(o,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4="http://localhost";class s_ extends oP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const a=new s_(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(a.idToken=t.idToken),t.accessToken&&(a.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(a.nonce=t.nonce),t.pendingToken&&(a.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(a.accessToken=t.oauthToken,a.secret=t.oauthTokenSecret):of("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const a=typeof t=="string"?JSON.parse(t):t,{providerId:u,signInMethod:y,...T}=a;if(!u||!y)return null;const C=new s_(u,y);return C.idToken=T.idToken||void 0,C.accessToken=T.accessToken||void 0,C.secret=T.secret,C.nonce=T.nonce,C.pendingToken=T.pendingToken||null,C}_getIdTokenResponse(t){const a=this.buildRequest();return Ty(t,a)}_linkToIdToken(t,a){const u=this.buildRequest();return u.idToken=a,Ty(t,u)}_getReauthenticationResolver(t){const a=this.buildRequest();return a.autoCreate=!1,Ty(t,a)}buildRequest(){const t={requestUri:v4,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),t.postBody=Gv(a)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv extends rS{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm extends Hv{constructor(){super("facebook.com")}static credential(t){return s_._fromParams({providerId:Cm.PROVIDER_ID,signInMethod:Cm.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Cm.credentialFromTaggedObject(t)}static credentialFromError(t){return Cm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Cm.credential(t.oauthAccessToken)}catch{return null}}}Cm.FACEBOOK_SIGN_IN_METHOD="facebook.com";Cm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp extends Hv{constructor(){super("google.com"),this.addScope("profile")}static credential(t,a){return s_._fromParams({providerId:fp.PROVIDER_ID,signInMethod:fp.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:a})}static credentialFromResult(t){return fp.credentialFromTaggedObject(t)}static credentialFromError(t){return fp.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:a,oauthAccessToken:u}=t;if(!a&&!u)return null;try{return fp.credential(a,u)}catch{return null}}}fp.GOOGLE_SIGN_IN_METHOD="google.com";fp.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm extends Hv{constructor(){super("github.com")}static credential(t){return s_._fromParams({providerId:Rm.PROVIDER_ID,signInMethod:Rm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Rm.credentialFromTaggedObject(t)}static credentialFromError(t){return Rm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Rm.credential(t.oauthAccessToken)}catch{return null}}}Rm.GITHUB_SIGN_IN_METHOD="github.com";Rm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm extends Hv{constructor(){super("twitter.com")}static credential(t,a){return s_._fromParams({providerId:Mm.PROVIDER_ID,signInMethod:Mm.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:a})}static credentialFromResult(t){return Mm.credentialFromTaggedObject(t)}static credentialFromError(t){return Mm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:a,oauthTokenSecret:u}=t;if(!a||!u)return null;try{return Mm.credential(a,u)}catch{return null}}}Mm.TWITTER_SIGN_IN_METHOD="twitter.com";Mm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,a,u,y=!1){const T=await Yh._fromIdTokenResponse(t,u,y),C=YC(u);return new Dy({user:T,providerId:C,_tokenResponse:u,operationType:a})}static async _forOperation(t,a,u){await t._updateTokensIfNecessary(u,!0);const y=YC(u);return new Dy({user:t,providerId:y,_tokenResponse:u,operationType:a})}}function YC(o){return o.providerId?o.providerId:"phoneNumber"in o?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb extends Ep{constructor(t,a,u,y){super(a.code,a.message),this.operationType=u,this.user=y,Object.setPrototypeOf(this,Jb.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:a.customData._serverResponse,operationType:u}}static _fromErrorAndOperation(t,a,u,y){return new Jb(t,a,u,y)}}function lP(o,t,a,u){return(t==="reauthenticate"?a._getReauthenticationResolver(o):a._getIdTokenResponse(o)).catch(T=>{throw T.code==="auth/multi-factor-auth-required"?Jb._fromErrorAndOperation(o,T,t,u):T})}async function b4(o,t,a=!1){const u=await Rv(o,t._linkToIdToken(o.auth,await o.getIdToken()),a);return Dy._forOperation(o,"link",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w4(o,t,a=!1){const{auth:u}=o;if(Xh(u.app))return Promise.reject(t_(u));const y="reauthenticate";try{const T=await Rv(o,lP(u,y,t,o),a);qi(T.idToken,u,"internal-error");const C=tS(T.idToken);qi(C,u,"internal-error");const{sub:s}=C;return qi(o.uid===s,u,"user-mismatch"),Dy._forOperation(o,y,T)}catch(T){throw(T==null?void 0:T.code)==="auth/user-not-found"&&of(u,"user-mismatch"),T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T4(o,t,a=!1){if(Xh(o.app))return Promise.reject(t_(o));const u="signIn",y=await lP(o,u,t),T=await Dy._fromIdTokenResponse(o,u,y);return a||await o._updateCurrentUser(T.user),T}function E4(o,t,a,u){return ic(o).onIdTokenChanged(t,a,u)}function S4(o,t,a){return ic(o).beforeAuthStateChanged(t,a)}function A4(o,t,a,u){return ic(o).onAuthStateChanged(t,a,u)}function I4(o){return ic(o).signOut()}const e1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(t,a){this.storageRetriever=t,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(e1,"1"),this.storage.removeItem(e1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,a){return this.storage.setItem(t,JSON.stringify(a)),Promise.resolve()}_get(t){const a=this.storage.getItem(t);return Promise.resolve(a?JSON.parse(a):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C4=1e3,R4=10;class uP extends cP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,a)=>this.onStorageEvent(t,a),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rP(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const a of Object.keys(this.listeners)){const u=this.storage.getItem(a),y=this.localCache[a];u!==y&&t(a,y,u)}}onStorageEvent(t,a=!1){if(!t.key){this.forAllChangedKeys((C,s,B)=>{this.notifyListeners(C,B)});return}const u=t.key;a?this.detachListener():this.stopPolling();const y=()=>{const C=this.storage.getItem(u);!a&&this.localCache[u]===C||this.notifyListeners(u,C)},T=this.storage.getItem(u);s4()&&T!==t.newValue&&t.newValue!==t.oldValue?setTimeout(y,R4):y()}notifyListeners(t,a){this.localCache[t]=a;const u=this.listeners[t];if(u)for(const y of Array.from(u))y(a&&JSON.parse(a))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,a,u)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:a,newValue:u}),!0)})},C4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,a){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(a)}_removeListener(t,a){this.listeners[t]&&(this.listeners[t].delete(a),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,a){await super._set(t,a),this.localCache[t]=JSON.stringify(a)}async _get(t){const a=await super._get(t);return this.localCache[t]=JSON.stringify(a),a}async _remove(t){await super._remove(t),delete this.localCache[t]}}uP.type="LOCAL";const M4=uP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP extends cP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,a){}_removeListener(t,a){}}hP.type="SESSION";const dP=hP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D4(o){return Promise.all(o.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(a){return{fulfilled:!1,reason:a}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const a=this.receivers.find(y=>y.isListeningto(t));if(a)return a;const u=new v1(t);return this.receivers.push(u),u}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const a=t,{eventId:u,eventType:y,data:T}=a.data,C=this.handlersMap[y];if(!(C!=null&&C.size))return;a.ports[0].postMessage({status:"ack",eventId:u,eventType:y});const s=Array.from(C).map(async V=>V(a.origin,T)),B=await D4(s);a.ports[0].postMessage({status:"done",eventId:u,eventType:y,response:B})}_subscribe(t,a){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(a)}_unsubscribe(t,a){this.handlersMap[t]&&a&&this.handlersMap[t].delete(a),(!a||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}v1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(o="",t=10){let a="";for(let u=0;u<t;u++)a+=Math.floor(Math.random()*10);return o+a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,a,u=50){const y=typeof MessageChannel<"u"?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let T,C;return new Promise((s,B)=>{const V=sS("",20);y.port1.start();const W=setTimeout(()=>{B(new Error("unsupported_event"))},u);C={messageChannel:y,onMessage(Q){const oe=Q;if(oe.data.eventId===V)switch(oe.data.status){case"ack":clearTimeout(W),T=setTimeout(()=>{B(new Error("timeout"))},3e3);break;case"done":clearTimeout(T),s(oe.data.response);break;default:clearTimeout(W),clearTimeout(T),B(new Error("invalid_response"));break}}},this.handlers.add(C),y.port1.addEventListener("message",C.onMessage),this.target.postMessage({eventType:t,eventId:V,data:a},[y.port2])}).finally(()=>{C&&this.removeMessageHandler(C)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tf(){return window}function k4(o){tf().location.href=o}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(){return typeof tf().WorkerGlobalScope<"u"&&typeof tf().importScripts=="function"}async function L4(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function z4(){var o;return((o=navigator==null?void 0:navigator.serviceWorker)==null?void 0:o.controller)||null}function O4(){return fP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP="firebaseLocalStorageDb",N4=1,t1="firebaseLocalStorage",mP="fbase_key";class $v{constructor(t){this.request=t}toPromise(){return new Promise((t,a)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function b1(o,t){return o.transaction([t1],t?"readwrite":"readonly").objectStore(t1)}function B4(){const o=indexedDB.deleteDatabase(pP);return new $v(o).toPromise()}function sE(){const o=indexedDB.open(pP,N4);return new Promise((t,a)=>{o.addEventListener("error",()=>{a(o.error)}),o.addEventListener("upgradeneeded",()=>{const u=o.result;try{u.createObjectStore(t1,{keyPath:mP})}catch(y){a(y)}}),o.addEventListener("success",async()=>{const u=o.result;u.objectStoreNames.contains(t1)?t(u):(u.close(),await B4(),t(await sE()))})})}async function KC(o,t,a){const u=b1(o,!0).put({[mP]:t,value:a});return new $v(u).toPromise()}async function F4(o,t){const a=b1(o,!1).get(t),u=await new $v(a).toPromise();return u===void 0?null:u.value}function QC(o,t){const a=b1(o,!0).delete(t);return new $v(a).toPromise()}const V4=800,j4=3;class gP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sE(),this.db)}async _withRetries(t){let a=0;for(;;)try{const u=await this._openDb();return await t(u)}catch(u){if(a++>j4)throw u;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=v1._getInstance(O4()),this.receiver._subscribe("keyChanged",async(t,a)=>({keyProcessed:(await this._poll()).includes(a.key)})),this.receiver._subscribe("ping",async(t,a)=>["keyChanged"])}async initializeSender(){var a,u;if(this.activeServiceWorker=await L4(),!this.activeServiceWorker)return;this.sender=new P4(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&(a=t[0])!=null&&a.fulfilled&&(u=t[0])!=null&&u.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||z4()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await sE();return await KC(t,e1,"1"),await QC(t,e1),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,a){return this._withPendingWrite(async()=>(await this._withRetries(u=>KC(u,t,a)),this.localCache[t]=a,this.notifyServiceWorker(t)))}async _get(t){const a=await this._withRetries(u=>F4(u,t));return this.localCache[t]=a,a}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(a=>QC(a,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(y=>{const T=b1(y,!1).getAll();return new $v(T).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const a=[],u=new Set;if(t.length!==0)for(const{fbase_key:y,value:T}of t)u.add(y),JSON.stringify(this.localCache[y])!==JSON.stringify(T)&&(this.notifyListeners(y,T),a.push(y));for(const y of Object.keys(this.localCache))this.localCache[y]&&!u.has(y)&&(this.notifyListeners(y,null),a.push(y));return a}notifyListeners(t,a){this.localCache[t]=a;const u=this.listeners[t];if(u)for(const y of Array.from(u))y(a)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),V4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,a){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(a)}_removeListener(t,a){this.listeners[t]&&(this.listeners[t].delete(a),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}gP.type="LOCAL";const U4=gP;new qv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _P(o,t){return t?mp(t):(qi(o._popupRedirectResolver,o,"argument-error"),o._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS extends oP{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Ty(t,this._buildIdpRequest())}_linkToIdToken(t,a){return Ty(t,this._buildIdpRequest(a))}_getReauthenticationResolver(t){return Ty(t,this._buildIdpRequest())}_buildIdpRequest(t){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(a.idToken=t),a}}function G4(o){return T4(o.auth,new aS(o),o.bypassAuthState)}function q4(o){const{auth:t,user:a}=o;return qi(a,t,"internal-error"),w4(a,new aS(o),o.bypassAuthState)}async function H4(o){const{auth:t,user:a}=o;return qi(a,t,"internal-error"),b4(a,new aS(o),o.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(t,a,u,y,T=!1){this.auth=t,this.resolver=u,this.user=y,this.bypassAuthState=T,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){return new Promise(async(t,a)=>{this.pendingPromise={resolve:t,reject:a};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(u){this.reject(u)}})}async onAuthEvent(t){const{urlResponse:a,sessionId:u,postBody:y,tenantId:T,error:C,type:s}=t;if(C){this.reject(C);return}const B={auth:this.auth,requestUri:a,sessionId:u,tenantId:T||void 0,postBody:y||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(B))}catch(V){this.reject(V)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return G4;case"linkViaPopup":case"linkViaRedirect":return H4;case"reauthViaPopup":case"reauthViaRedirect":return q4;default:of(this.auth,"internal-error")}}resolve(t){vp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){vp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $4=new qv(2e3,1e4);async function Z4(o,t,a){if(Xh(o.app))return Promise.reject(Qh(o,"operation-not-supported-in-this-environment"));const u=x1(o);j5(o,t,rS);const y=_P(u,a);return new Jg(u,"signInViaPopup",t,y).executeNotNull()}class Jg extends yP{constructor(t,a,u,y,T){super(t,a,y,T),this.provider=u,this.authWindow=null,this.pollId=null,Jg.currentPopupAction&&Jg.currentPopupAction.cancel(),Jg.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return qi(t,this.auth,"internal-error"),t}async onExecution(){vp(this.filter.length===1,"Popup operations only handle one event");const t=sS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(a=>{this.reject(a)}),this.resolver._isIframeWebStorageSupported(this.auth,a=>{a||this.reject(Qh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)==null?void 0:t.associatedEvent)||null}cancel(){this.reject(Qh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Jg.currentPopupAction=null}pollUserCancellation(){const t=()=>{var a,u;if((u=(a=this.authWindow)==null?void 0:a.window)!=null&&u.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,$4.get())};t()}}Jg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4="pendingRedirect",Pb=new Map;class X4 extends yP{constructor(t,a,u=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,u),this.eventId=null}async execute(){let t=Pb.get(this.auth._key());if(!t){try{const u=await Y4(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(u)}catch(a){t=()=>Promise.reject(a)}Pb.set(this.auth._key(),t)}return this.bypassAuthState||Pb.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const a=await this.auth._redirectUserForId(t.eventId);if(a)return this.user=a,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Y4(o,t){const a=J4(t),u=Q4(o);if(!await u._isAvailable())return!1;const y=await u._get(a)==="true";return await u._remove(a),y}function K4(o,t){Pb.set(o._key(),t)}function Q4(o){return mp(o._redirectPersistence)}function J4(o){return Db(W4,o.config.apiKey,o.name)}async function eV(o,t,a=!1){if(Xh(o.app))return Promise.reject(t_(o));const u=x1(o),y=_P(u,t),C=await new X4(u,y,a).execute();return C&&!a&&(delete C.user._redirectEventId,await u._persistUserIfCurrent(C.user),await u._setRedirectUser(null,t)),C}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV=600*1e3;class nV{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let a=!1;return this.consumers.forEach(u=>{this.isEventForConsumer(t,u)&&(a=!0,this.sendToConsumer(t,u),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!iV(t)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=t,a=!0)),a}sendToConsumer(t,a){var u;if(t.error&&!xP(t)){const y=((u=t.error.code)==null?void 0:u.split("auth/")[1])||"internal-error";a.onError(Qh(this.auth,y))}else a.onAuthEvent(t)}isEventForConsumer(t,a){const u=a.eventId===null||!!t.eventId&&t.eventId===a.eventId;return a.filter.includes(t.type)&&u}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=tV&&this.cachedEventUids.clear(),this.cachedEventUids.has(JC(t))}saveEventToCache(t){this.cachedEventUids.add(JC(t)),this.lastProcessedEventTime=Date.now()}}function JC(o){return[o.type,o.eventId,o.sessionId,o.tenantId].filter(t=>t).join("-")}function xP({type:o,error:t}){return o==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function iV(o){switch(o.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return xP(o);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rV(o,t={}){return qy(o,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,aV=/^https?/;async function oV(o){if(o.config.emulator)return;const{authorizedDomains:t}=await rV(o);for(const a of t)try{if(lV(a))return}catch{}of(o,"unauthorized-domain")}function lV(o){const t=iE(),{protocol:a,hostname:u}=new URL(t);if(o.startsWith("chrome-extension://")){const C=new URL(o);return C.hostname===""&&u===""?a==="chrome-extension:"&&o.replace("chrome-extension://","")===t.replace("chrome-extension://",""):a==="chrome-extension:"&&C.hostname===u}if(!aV.test(a))return!1;if(sV.test(o))return u===o;const y=o.replace(/\./g,"\\.");return new RegExp("^(.+\\."+y+"|"+y+")$","i").test(u)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV=new qv(3e4,6e4);function eR(){const o=tf().___jsl;if(o!=null&&o.H){for(const t of Object.keys(o.H))if(o.H[t].r=o.H[t].r||[],o.H[t].L=o.H[t].L||[],o.H[t].r=[...o.H[t].L],o.CP)for(let a=0;a<o.CP.length;a++)o.CP[a]=null}}function uV(o){return new Promise((t,a)=>{var y,T,C;function u(){eR(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{eR(),a(Qh(o,"network-request-failed"))},timeout:cV.get()})}if((T=(y=tf().gapi)==null?void 0:y.iframes)!=null&&T.Iframe)t(gapi.iframes.getContext());else if((C=tf().gapi)!=null&&C.load)u();else{const s=p4("iframefcb");return tf()[s]=()=>{gapi.load?u():a(Qh(o,"network-request-failed"))},d4(`${f4()}?onload=${s}`).catch(B=>a(B))}}).catch(t=>{throw kb=null,t})}let kb=null;function hV(o){return kb=kb||uV(o),kb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV=new qv(5e3,15e3),fV="__/auth/iframe",pV="emulator/auth/iframe",mV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _V(o){const t=o.config;qi(t.authDomain,o,"auth-domain-config-required");const a=t.emulator?JE(t,pV):`https://${o.config.authDomain}/${fV}`,u={apiKey:t.apiKey,appName:o.name,v:Gy},y=gV.get(o.config.apiHost);y&&(u.eid=y);const T=o._getFrameworks();return T.length&&(u.fw=T.join(",")),`${a}?${Gv(u).slice(1)}`}async function yV(o){const t=await hV(o),a=tf().gapi;return qi(a,o,"internal-error"),t.open({where:document.body,url:_V(o),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mV,dontclear:!0},u=>new Promise(async(y,T)=>{await u.restyle({setHideOnLeave:!1});const C=Qh(o,"network-request-failed"),s=tf().setTimeout(()=>{T(C)},dV.get());function B(){tf().clearTimeout(s),y(u)}u.ping(B).then(B,()=>{T(C)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},vV=500,bV=600,wV="_blank",TV="http://localhost";class tR{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EV(o,t,a,u=vV,y=bV){const T=Math.max((window.screen.availHeight-y)/2,0).toString(),C=Math.max((window.screen.availWidth-u)/2,0).toString();let s="";const B={...xV,width:u.toString(),height:y.toString(),top:T,left:C},V=Il().toLowerCase();a&&(s=JD(V)?wV:a),KD(V)&&(t=t||TV,B.scrollbars="yes");const W=Object.entries(B).reduce((oe,[he,Je])=>`${oe}${he}=${Je},`,"");if(r4(V)&&s!=="_self")return SV(t||"",s),new tR(null);const Q=window.open(t||"",s,W);qi(Q,o,"popup-blocked");try{Q.focus()}catch{}return new tR(Q)}function SV(o,t){const a=document.createElement("a");a.href=o,a.target=t;const u=document.createEvent("MouseEvent");u.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AV="__/auth/handler",IV="emulator/auth/handler",CV=encodeURIComponent("fac");async function nR(o,t,a,u,y,T){qi(o.config.authDomain,o,"auth-domain-config-required"),qi(o.config.apiKey,o,"invalid-api-key");const C={apiKey:o.config.apiKey,appName:o.name,authType:a,redirectUrl:u,v:Gy,eventId:y};if(t instanceof rS){t.setDefaultLanguage(o.languageCode),C.providerId=t.providerId||"",IF(t.getCustomParameters())||(C.customParameters=JSON.stringify(t.getCustomParameters()));for(const[W,Q]of Object.entries({}))C[W]=Q}if(t instanceof Hv){const W=t.getScopes().filter(Q=>Q!=="");W.length>0&&(C.scopes=W.join(","))}o.tenantId&&(C.tid=o.tenantId);const s=C;for(const W of Object.keys(s))s[W]===void 0&&delete s[W];const B=await o._getAppCheckToken(),V=B?`#${CV}=${encodeURIComponent(B)}`:"";return`${RV(o)}?${Gv(s).slice(1)}${V}`}function RV({config:o}){return o.emulator?JE(o,IV):`https://${o.authDomain}/${AV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET="webStorageSupport";class MV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dP,this._completeRedirectFn=eV,this._overrideRedirectResult=K4}async _openPopup(t,a,u,y){var C;vp((C=this.eventManagers[t._key()])==null?void 0:C.manager,"_initialize() not called before _openPopup()");const T=await nR(t,a,u,iE(),y);return EV(t,T,sS())}async _openRedirect(t,a,u,y){await this._originValidation(t);const T=await nR(t,a,u,iE(),y);return k4(T),new Promise(()=>{})}_initialize(t){const a=t._key();if(this.eventManagers[a]){const{manager:y,promise:T}=this.eventManagers[a];return y?Promise.resolve(y):(vp(T,"If manager is not set, promise should be"),T)}const u=this.initAndGetManager(t);return this.eventManagers[a]={promise:u},u.catch(()=>{delete this.eventManagers[a]}),u}async initAndGetManager(t){const a=await yV(t),u=new nV(t);return a.register("authEvent",y=>(qi(y==null?void 0:y.authEvent,t,"invalid-auth-event"),{status:u.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:u},this.iframes[t._key()]=a,u}_isIframeWebStorageSupported(t,a){this.iframes[t._key()].send(ET,{type:ET},y=>{var C;const T=(C=y==null?void 0:y[0])==null?void 0:C[ET];T!==void 0&&a(!!T),of(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const a=t._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=oV(t)),this.originValidationPromises[a]}get _shouldInitProactively(){return rP()||QD()||nS()}}const DV=MV;var iR="@firebase/auth",rR="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)==null?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const a=this.auth.onIdTokenChanged(u=>{t((u==null?void 0:u.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,a),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const a=this.internalListeners.get(t);a&&(this.internalListeners.delete(t),a(),this.updateProactiveRefresh())}assertAuthConfigured(){qi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kV(o){switch(o){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function LV(o){My(new r_("auth",(t,{options:a})=>{const u=t.getProvider("app").getImmediate(),y=t.getProvider("heartbeat"),T=t.getProvider("app-check-internal"),{apiKey:C,authDomain:s}=u.options;qi(C&&!C.includes(":"),"invalid-api-key",{appName:u.name});const B={apiKey:C,authDomain:s,clientPlatform:o,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sP(o)},V=new u4(u,y,T,B);return g4(V,a),V},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,a,u)=>{t.getProvider("auth-internal").initialize()})),My(new r_("auth-internal",t=>{const a=x1(t.getProvider("auth").getImmediate());return(u=>new PV(u))(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),Lm(iR,rR,kV(o)),Lm(iR,rR,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zV=300,OV=zD("authIdTokenMaxAge")||zV;let sR=null;const NV=o=>async t=>{const a=t&&await t.getIdTokenResult(),u=a&&(new Date().getTime()-Date.parse(a.issuedAtTime))/1e3;if(u&&u>OV)return;const y=a==null?void 0:a.token;sR!==y&&(sR=y,await fetch(o,{method:y?"POST":"DELETE",headers:y?{Authorization:`Bearer ${y}`}:{}}))};function BV(o=jD()){const t=YE(o,"auth");if(t.isInitialized())return t.getImmediate();const a=m4(o,{popupRedirectResolver:DV,persistence:[U4,M4,dP]}),u=zD("authTokenSyncURL");if(u&&typeof isSecureContext=="boolean"&&isSecureContext){const T=new URL(u,location.origin);if(location.origin===T.origin){const C=NV(T.toString());S4(a,C,()=>C(a.currentUser)),E4(a,s=>C(s))}}const y=kD("auth");return y&&_4(a,`http://${y}`),a}function FV(){var o;return((o=document.getElementsByTagName("head"))==null?void 0:o[0])??document}h4({loadJS(o){return new Promise((t,a)=>{const u=document.createElement("script");u.setAttribute("src",o),u.onload=t,u.onerror=y=>{const T=Qh("internal-error");T.customData=y,a(T)},u.type="text/javascript",u.charset="UTF-8",FV().appendChild(u)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});LV("Browser");var VV="firebase",jV="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lm(VV,jV,"app");var aR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zm,vP;(function(){var o;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(je,ze){function Ve(){}Ve.prototype=ze.prototype,je.F=ze.prototype,je.prototype=new Ve,je.prototype.constructor=je,je.D=function(Ke,qe,et){for(var be=Array(arguments.length-2),Zt=2;Zt<arguments.length;Zt++)be[Zt-2]=arguments[Zt];return ze.prototype[qe].apply(Ke,be)}}function a(){this.blockSize=-1}function u(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(u,a),u.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function y(je,ze,Ve){Ve||(Ve=0);const Ke=Array(16);if(typeof ze=="string")for(var qe=0;qe<16;++qe)Ke[qe]=ze.charCodeAt(Ve++)|ze.charCodeAt(Ve++)<<8|ze.charCodeAt(Ve++)<<16|ze.charCodeAt(Ve++)<<24;else for(qe=0;qe<16;++qe)Ke[qe]=ze[Ve++]|ze[Ve++]<<8|ze[Ve++]<<16|ze[Ve++]<<24;ze=je.g[0],Ve=je.g[1],qe=je.g[2];let et=je.g[3],be;be=ze+(et^Ve&(qe^et))+Ke[0]+3614090360&4294967295,ze=Ve+(be<<7&4294967295|be>>>25),be=et+(qe^ze&(Ve^qe))+Ke[1]+3905402710&4294967295,et=ze+(be<<12&4294967295|be>>>20),be=qe+(Ve^et&(ze^Ve))+Ke[2]+606105819&4294967295,qe=et+(be<<17&4294967295|be>>>15),be=Ve+(ze^qe&(et^ze))+Ke[3]+3250441966&4294967295,Ve=qe+(be<<22&4294967295|be>>>10),be=ze+(et^Ve&(qe^et))+Ke[4]+4118548399&4294967295,ze=Ve+(be<<7&4294967295|be>>>25),be=et+(qe^ze&(Ve^qe))+Ke[5]+1200080426&4294967295,et=ze+(be<<12&4294967295|be>>>20),be=qe+(Ve^et&(ze^Ve))+Ke[6]+2821735955&4294967295,qe=et+(be<<17&4294967295|be>>>15),be=Ve+(ze^qe&(et^ze))+Ke[7]+4249261313&4294967295,Ve=qe+(be<<22&4294967295|be>>>10),be=ze+(et^Ve&(qe^et))+Ke[8]+1770035416&4294967295,ze=Ve+(be<<7&4294967295|be>>>25),be=et+(qe^ze&(Ve^qe))+Ke[9]+2336552879&4294967295,et=ze+(be<<12&4294967295|be>>>20),be=qe+(Ve^et&(ze^Ve))+Ke[10]+4294925233&4294967295,qe=et+(be<<17&4294967295|be>>>15),be=Ve+(ze^qe&(et^ze))+Ke[11]+2304563134&4294967295,Ve=qe+(be<<22&4294967295|be>>>10),be=ze+(et^Ve&(qe^et))+Ke[12]+1804603682&4294967295,ze=Ve+(be<<7&4294967295|be>>>25),be=et+(qe^ze&(Ve^qe))+Ke[13]+4254626195&4294967295,et=ze+(be<<12&4294967295|be>>>20),be=qe+(Ve^et&(ze^Ve))+Ke[14]+2792965006&4294967295,qe=et+(be<<17&4294967295|be>>>15),be=Ve+(ze^qe&(et^ze))+Ke[15]+1236535329&4294967295,Ve=qe+(be<<22&4294967295|be>>>10),be=ze+(qe^et&(Ve^qe))+Ke[1]+4129170786&4294967295,ze=Ve+(be<<5&4294967295|be>>>27),be=et+(Ve^qe&(ze^Ve))+Ke[6]+3225465664&4294967295,et=ze+(be<<9&4294967295|be>>>23),be=qe+(ze^Ve&(et^ze))+Ke[11]+643717713&4294967295,qe=et+(be<<14&4294967295|be>>>18),be=Ve+(et^ze&(qe^et))+Ke[0]+3921069994&4294967295,Ve=qe+(be<<20&4294967295|be>>>12),be=ze+(qe^et&(Ve^qe))+Ke[5]+3593408605&4294967295,ze=Ve+(be<<5&4294967295|be>>>27),be=et+(Ve^qe&(ze^Ve))+Ke[10]+38016083&4294967295,et=ze+(be<<9&4294967295|be>>>23),be=qe+(ze^Ve&(et^ze))+Ke[15]+3634488961&4294967295,qe=et+(be<<14&4294967295|be>>>18),be=Ve+(et^ze&(qe^et))+Ke[4]+3889429448&4294967295,Ve=qe+(be<<20&4294967295|be>>>12),be=ze+(qe^et&(Ve^qe))+Ke[9]+568446438&4294967295,ze=Ve+(be<<5&4294967295|be>>>27),be=et+(Ve^qe&(ze^Ve))+Ke[14]+3275163606&4294967295,et=ze+(be<<9&4294967295|be>>>23),be=qe+(ze^Ve&(et^ze))+Ke[3]+4107603335&4294967295,qe=et+(be<<14&4294967295|be>>>18),be=Ve+(et^ze&(qe^et))+Ke[8]+1163531501&4294967295,Ve=qe+(be<<20&4294967295|be>>>12),be=ze+(qe^et&(Ve^qe))+Ke[13]+2850285829&4294967295,ze=Ve+(be<<5&4294967295|be>>>27),be=et+(Ve^qe&(ze^Ve))+Ke[2]+4243563512&4294967295,et=ze+(be<<9&4294967295|be>>>23),be=qe+(ze^Ve&(et^ze))+Ke[7]+1735328473&4294967295,qe=et+(be<<14&4294967295|be>>>18),be=Ve+(et^ze&(qe^et))+Ke[12]+2368359562&4294967295,Ve=qe+(be<<20&4294967295|be>>>12),be=ze+(Ve^qe^et)+Ke[5]+4294588738&4294967295,ze=Ve+(be<<4&4294967295|be>>>28),be=et+(ze^Ve^qe)+Ke[8]+2272392833&4294967295,et=ze+(be<<11&4294967295|be>>>21),be=qe+(et^ze^Ve)+Ke[11]+1839030562&4294967295,qe=et+(be<<16&4294967295|be>>>16),be=Ve+(qe^et^ze)+Ke[14]+4259657740&4294967295,Ve=qe+(be<<23&4294967295|be>>>9),be=ze+(Ve^qe^et)+Ke[1]+2763975236&4294967295,ze=Ve+(be<<4&4294967295|be>>>28),be=et+(ze^Ve^qe)+Ke[4]+1272893353&4294967295,et=ze+(be<<11&4294967295|be>>>21),be=qe+(et^ze^Ve)+Ke[7]+4139469664&4294967295,qe=et+(be<<16&4294967295|be>>>16),be=Ve+(qe^et^ze)+Ke[10]+3200236656&4294967295,Ve=qe+(be<<23&4294967295|be>>>9),be=ze+(Ve^qe^et)+Ke[13]+681279174&4294967295,ze=Ve+(be<<4&4294967295|be>>>28),be=et+(ze^Ve^qe)+Ke[0]+3936430074&4294967295,et=ze+(be<<11&4294967295|be>>>21),be=qe+(et^ze^Ve)+Ke[3]+3572445317&4294967295,qe=et+(be<<16&4294967295|be>>>16),be=Ve+(qe^et^ze)+Ke[6]+76029189&4294967295,Ve=qe+(be<<23&4294967295|be>>>9),be=ze+(Ve^qe^et)+Ke[9]+3654602809&4294967295,ze=Ve+(be<<4&4294967295|be>>>28),be=et+(ze^Ve^qe)+Ke[12]+3873151461&4294967295,et=ze+(be<<11&4294967295|be>>>21),be=qe+(et^ze^Ve)+Ke[15]+530742520&4294967295,qe=et+(be<<16&4294967295|be>>>16),be=Ve+(qe^et^ze)+Ke[2]+3299628645&4294967295,Ve=qe+(be<<23&4294967295|be>>>9),be=ze+(qe^(Ve|~et))+Ke[0]+4096336452&4294967295,ze=Ve+(be<<6&4294967295|be>>>26),be=et+(Ve^(ze|~qe))+Ke[7]+1126891415&4294967295,et=ze+(be<<10&4294967295|be>>>22),be=qe+(ze^(et|~Ve))+Ke[14]+2878612391&4294967295,qe=et+(be<<15&4294967295|be>>>17),be=Ve+(et^(qe|~ze))+Ke[5]+4237533241&4294967295,Ve=qe+(be<<21&4294967295|be>>>11),be=ze+(qe^(Ve|~et))+Ke[12]+1700485571&4294967295,ze=Ve+(be<<6&4294967295|be>>>26),be=et+(Ve^(ze|~qe))+Ke[3]+2399980690&4294967295,et=ze+(be<<10&4294967295|be>>>22),be=qe+(ze^(et|~Ve))+Ke[10]+4293915773&4294967295,qe=et+(be<<15&4294967295|be>>>17),be=Ve+(et^(qe|~ze))+Ke[1]+2240044497&4294967295,Ve=qe+(be<<21&4294967295|be>>>11),be=ze+(qe^(Ve|~et))+Ke[8]+1873313359&4294967295,ze=Ve+(be<<6&4294967295|be>>>26),be=et+(Ve^(ze|~qe))+Ke[15]+4264355552&4294967295,et=ze+(be<<10&4294967295|be>>>22),be=qe+(ze^(et|~Ve))+Ke[6]+2734768916&4294967295,qe=et+(be<<15&4294967295|be>>>17),be=Ve+(et^(qe|~ze))+Ke[13]+1309151649&4294967295,Ve=qe+(be<<21&4294967295|be>>>11),be=ze+(qe^(Ve|~et))+Ke[4]+4149444226&4294967295,ze=Ve+(be<<6&4294967295|be>>>26),be=et+(Ve^(ze|~qe))+Ke[11]+3174756917&4294967295,et=ze+(be<<10&4294967295|be>>>22),be=qe+(ze^(et|~Ve))+Ke[2]+718787259&4294967295,qe=et+(be<<15&4294967295|be>>>17),be=Ve+(et^(qe|~ze))+Ke[9]+3951481745&4294967295,je.g[0]=je.g[0]+ze&4294967295,je.g[1]=je.g[1]+(qe+(be<<21&4294967295|be>>>11))&4294967295,je.g[2]=je.g[2]+qe&4294967295,je.g[3]=je.g[3]+et&4294967295}u.prototype.v=function(je,ze){ze===void 0&&(ze=je.length);const Ve=ze-this.blockSize,Ke=this.C;let qe=this.h,et=0;for(;et<ze;){if(qe==0)for(;et<=Ve;)y(this,je,et),et+=this.blockSize;if(typeof je=="string"){for(;et<ze;)if(Ke[qe++]=je.charCodeAt(et++),qe==this.blockSize){y(this,Ke),qe=0;break}}else for(;et<ze;)if(Ke[qe++]=je[et++],qe==this.blockSize){y(this,Ke),qe=0;break}}this.h=qe,this.o+=ze},u.prototype.A=function(){var je=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);je[0]=128;for(var ze=1;ze<je.length-8;++ze)je[ze]=0;ze=this.o*8;for(var Ve=je.length-8;Ve<je.length;++Ve)je[Ve]=ze&255,ze/=256;for(this.v(je),je=Array(16),ze=0,Ve=0;Ve<4;++Ve)for(let Ke=0;Ke<32;Ke+=8)je[ze++]=this.g[Ve]>>>Ke&255;return je};function T(je,ze){var Ve=s;return Object.prototype.hasOwnProperty.call(Ve,je)?Ve[je]:Ve[je]=ze(je)}function C(je,ze){this.h=ze;const Ve=[];let Ke=!0;for(let qe=je.length-1;qe>=0;qe--){const et=je[qe]|0;Ke&&et==ze||(Ve[qe]=et,Ke=!1)}this.g=Ve}var s={};function B(je){return-128<=je&&je<128?T(je,function(ze){return new C([ze|0],ze<0?-1:0)}):new C([je|0],je<0?-1:0)}function V(je){if(isNaN(je)||!isFinite(je))return Q;if(je<0)return Xe(V(-je));const ze=[];let Ve=1;for(let Ke=0;je>=Ve;Ke++)ze[Ke]=je/Ve|0,Ve*=4294967296;return new C(ze,0)}function W(je,ze){if(je.length==0)throw Error("number format error: empty string");if(ze=ze||10,ze<2||36<ze)throw Error("radix out of range: "+ze);if(je.charAt(0)=="-")return Xe(W(je.substring(1),ze));if(je.indexOf("-")>=0)throw Error('number format error: interior "-" character');const Ve=V(Math.pow(ze,8));let Ke=Q;for(let et=0;et<je.length;et+=8){var qe=Math.min(8,je.length-et);const be=parseInt(je.substring(et,et+qe),ze);qe<8?(qe=V(Math.pow(ze,qe)),Ke=Ke.j(qe).add(V(be))):(Ke=Ke.j(Ve),Ke=Ke.add(V(be)))}return Ke}var Q=B(0),oe=B(1),he=B(16777216);o=C.prototype,o.m=function(){if(Ye(this))return-Xe(this).m();let je=0,ze=1;for(let Ve=0;Ve<this.g.length;Ve++){const Ke=this.i(Ve);je+=(Ke>=0?Ke:4294967296+Ke)*ze,ze*=4294967296}return je},o.toString=function(je){if(je=je||10,je<2||36<je)throw Error("radix out of range: "+je);if(Je(this))return"0";if(Ye(this))return"-"+Xe(this).toString(je);const ze=V(Math.pow(je,6));var Ve=this;let Ke="";for(;;){const qe=Ft(Ve,ze).g;Ve=st(Ve,qe.j(ze));let et=((Ve.g.length>0?Ve.g[0]:Ve.h)>>>0).toString(je);if(Ve=qe,Je(Ve))return et+Ke;for(;et.length<6;)et="0"+et;Ke=et+Ke}},o.i=function(je){return je<0?0:je<this.g.length?this.g[je]:this.h};function Je(je){if(je.h!=0)return!1;for(let ze=0;ze<je.g.length;ze++)if(je.g[ze]!=0)return!1;return!0}function Ye(je){return je.h==-1}o.l=function(je){return je=st(this,je),Ye(je)?-1:Je(je)?0:1};function Xe(je){const ze=je.g.length,Ve=[];for(let Ke=0;Ke<ze;Ke++)Ve[Ke]=~je.g[Ke];return new C(Ve,~je.h).add(oe)}o.abs=function(){return Ye(this)?Xe(this):this},o.add=function(je){const ze=Math.max(this.g.length,je.g.length),Ve=[];let Ke=0;for(let qe=0;qe<=ze;qe++){let et=Ke+(this.i(qe)&65535)+(je.i(qe)&65535),be=(et>>>16)+(this.i(qe)>>>16)+(je.i(qe)>>>16);Ke=be>>>16,et&=65535,be&=65535,Ve[qe]=be<<16|et}return new C(Ve,Ve[Ve.length-1]&-2147483648?-1:0)};function st(je,ze){return je.add(Xe(ze))}o.j=function(je){if(Je(this)||Je(je))return Q;if(Ye(this))return Ye(je)?Xe(this).j(Xe(je)):Xe(Xe(this).j(je));if(Ye(je))return Xe(this.j(Xe(je)));if(this.l(he)<0&&je.l(he)<0)return V(this.m()*je.m());const ze=this.g.length+je.g.length,Ve=[];for(var Ke=0;Ke<2*ze;Ke++)Ve[Ke]=0;for(Ke=0;Ke<this.g.length;Ke++)for(let qe=0;qe<je.g.length;qe++){const et=this.i(Ke)>>>16,be=this.i(Ke)&65535,Zt=je.i(qe)>>>16,dn=je.i(qe)&65535;Ve[2*Ke+2*qe]+=be*dn,ft(Ve,2*Ke+2*qe),Ve[2*Ke+2*qe+1]+=et*dn,ft(Ve,2*Ke+2*qe+1),Ve[2*Ke+2*qe+1]+=be*Zt,ft(Ve,2*Ke+2*qe+1),Ve[2*Ke+2*qe+2]+=et*Zt,ft(Ve,2*Ke+2*qe+2)}for(je=0;je<ze;je++)Ve[je]=Ve[2*je+1]<<16|Ve[2*je];for(je=ze;je<2*ze;je++)Ve[je]=0;return new C(Ve,0)};function ft(je,ze){for(;(je[ze]&65535)!=je[ze];)je[ze+1]+=je[ze]>>>16,je[ze]&=65535,ze++}function ht(je,ze){this.g=je,this.h=ze}function Ft(je,ze){if(Je(ze))throw Error("division by zero");if(Je(je))return new ht(Q,Q);if(Ye(je))return ze=Ft(Xe(je),ze),new ht(Xe(ze.g),Xe(ze.h));if(Ye(ze))return ze=Ft(je,Xe(ze)),new ht(Xe(ze.g),ze.h);if(je.g.length>30){if(Ye(je)||Ye(ze))throw Error("slowDivide_ only works with positive integers.");for(var Ve=oe,Ke=ze;Ke.l(je)<=0;)Ve=fn(Ve),Ke=fn(Ke);var qe=St(Ve,1),et=St(Ke,1);for(Ke=St(Ke,2),Ve=St(Ve,2);!Je(Ke);){var be=et.add(Ke);be.l(je)<=0&&(qe=qe.add(Ve),et=be),Ke=St(Ke,1),Ve=St(Ve,1)}return ze=st(je,qe.j(ze)),new ht(qe,ze)}for(qe=Q;je.l(ze)>=0;){for(Ve=Math.max(1,Math.floor(je.m()/ze.m())),Ke=Math.ceil(Math.log(Ve)/Math.LN2),Ke=Ke<=48?1:Math.pow(2,Ke-48),et=V(Ve),be=et.j(ze);Ye(be)||be.l(je)>0;)Ve-=Ke,et=V(Ve),be=et.j(ze);Je(et)&&(et=oe),qe=qe.add(et),je=st(je,be)}return new ht(qe,je)}o.B=function(je){return Ft(this,je).h},o.and=function(je){const ze=Math.max(this.g.length,je.g.length),Ve=[];for(let Ke=0;Ke<ze;Ke++)Ve[Ke]=this.i(Ke)&je.i(Ke);return new C(Ve,this.h&je.h)},o.or=function(je){const ze=Math.max(this.g.length,je.g.length),Ve=[];for(let Ke=0;Ke<ze;Ke++)Ve[Ke]=this.i(Ke)|je.i(Ke);return new C(Ve,this.h|je.h)},o.xor=function(je){const ze=Math.max(this.g.length,je.g.length),Ve=[];for(let Ke=0;Ke<ze;Ke++)Ve[Ke]=this.i(Ke)^je.i(Ke);return new C(Ve,this.h^je.h)};function fn(je){const ze=je.g.length+1,Ve=[];for(let Ke=0;Ke<ze;Ke++)Ve[Ke]=je.i(Ke)<<1|je.i(Ke-1)>>>31;return new C(Ve,je.h)}function St(je,ze){const Ve=ze>>5;ze%=32;const Ke=je.g.length-Ve,qe=[];for(let et=0;et<Ke;et++)qe[et]=ze>0?je.i(et+Ve)>>>ze|je.i(et+Ve+1)<<32-ze:je.i(et+Ve);return new C(qe,je.h)}u.prototype.digest=u.prototype.A,u.prototype.reset=u.prototype.u,u.prototype.update=u.prototype.v,vP=u,C.prototype.add=C.prototype.add,C.prototype.multiply=C.prototype.j,C.prototype.modulo=C.prototype.B,C.prototype.compare=C.prototype.l,C.prototype.toNumber=C.prototype.m,C.prototype.toString=C.prototype.toString,C.prototype.getBits=C.prototype.i,C.fromNumber=V,C.fromString=W,zm=C}).apply(typeof aR<"u"?aR:typeof self<"u"?self:typeof window<"u"?window:{});var yb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bP,fv,wP,Lb,aE,TP,EP,SP;(function(){var o,t=Object.defineProperty;function a(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof yb=="object"&&yb];for(var ie=0;ie<L.length;++ie){var de=L[ie];if(de&&de.Math==Math)return de}throw Error("Cannot find global object")}var u=a(this);function y(L,ie){if(ie)e:{var de=u;L=L.split(".");for(var Ce=0;Ce<L.length-1;Ce++){var Lt=L[Ce];if(!(Lt in de))break e;de=de[Lt]}L=L[L.length-1],Ce=de[L],ie=ie(Ce),ie!=Ce&&ie!=null&&t(de,L,{configurable:!0,writable:!0,value:ie})}}y("Symbol.dispose",function(L){return L||Symbol("Symbol.dispose")}),y("Array.prototype.values",function(L){return L||function(){return this[Symbol.iterator]()}}),y("Object.entries",function(L){return L||function(ie){var de=[],Ce;for(Ce in ie)Object.prototype.hasOwnProperty.call(ie,Ce)&&de.push([Ce,ie[Ce]]);return de}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var T=T||{},C=this||self;function s(L){var ie=typeof L;return ie=="object"&&L!=null||ie=="function"}function B(L,ie,de){return L.call.apply(L.bind,arguments)}function V(L,ie,de){return V=B,V.apply(null,arguments)}function W(L,ie){var de=Array.prototype.slice.call(arguments,1);return function(){var Ce=de.slice();return Ce.push.apply(Ce,arguments),L.apply(this,Ce)}}function Q(L,ie){function de(){}de.prototype=ie.prototype,L.Z=ie.prototype,L.prototype=new de,L.prototype.constructor=L,L.Ob=function(Ce,Lt,Gt){for(var Sn=Array(arguments.length-2),oi=2;oi<arguments.length;oi++)Sn[oi-2]=arguments[oi];return ie.prototype[Lt].apply(Ce,Sn)}}var oe=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?L=>L&&AsyncContext.Snapshot.wrap(L):L=>L;function he(L){const ie=L.length;if(ie>0){const de=Array(ie);for(let Ce=0;Ce<ie;Ce++)de[Ce]=L[Ce];return de}return[]}function Je(L,ie){for(let Ce=1;Ce<arguments.length;Ce++){const Lt=arguments[Ce];var de=typeof Lt;if(de=de!="object"?de:Lt?Array.isArray(Lt)?"array":de:"null",de=="array"||de=="object"&&typeof Lt.length=="number"){de=L.length||0;const Gt=Lt.length||0;L.length=de+Gt;for(let Sn=0;Sn<Gt;Sn++)L[de+Sn]=Lt[Sn]}else L.push(Lt)}}class Ye{constructor(ie,de){this.i=ie,this.j=de,this.h=0,this.g=null}get(){let ie;return this.h>0?(this.h--,ie=this.g,this.g=ie.next,ie.next=null):ie=this.i(),ie}}function Xe(L){C.setTimeout(()=>{throw L},0)}function st(){var L=je;let ie=null;return L.g&&(ie=L.g,L.g=L.g.next,L.g||(L.h=null),ie.next=null),ie}class ft{constructor(){this.h=this.g=null}add(ie,de){const Ce=ht.get();Ce.set(ie,de),this.h?this.h.next=Ce:this.g=Ce,this.h=Ce}}var ht=new Ye(()=>new Ft,L=>L.reset());class Ft{constructor(){this.next=this.g=this.h=null}set(ie,de){this.h=ie,this.g=de,this.next=null}reset(){this.next=this.g=this.h=null}}let fn,St=!1,je=new ft,ze=()=>{const L=Promise.resolve(void 0);fn=()=>{L.then(Ve)}};function Ve(){for(var L;L=st();){try{L.h.call(L.g)}catch(de){Xe(de)}var ie=ht;ie.j(L),ie.h<100&&(ie.h++,L.next=ie.g,ie.g=L)}St=!1}function Ke(){this.u=this.u,this.C=this.C}Ke.prototype.u=!1,Ke.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ke.prototype[Symbol.dispose]=function(){this.dispose()},Ke.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function qe(L,ie){this.type=L,this.g=this.target=ie,this.defaultPrevented=!1}qe.prototype.h=function(){this.defaultPrevented=!0};var et=(function(){if(!C.addEventListener||!Object.defineProperty)return!1;var L=!1,ie=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const de=()=>{};C.addEventListener("test",de,ie),C.removeEventListener("test",de,ie)}catch{}return L})();function be(L){return/^[\s\xa0]*$/.test(L)}function Zt(L,ie){qe.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L&&this.init(L,ie)}Q(Zt,qe),Zt.prototype.init=function(L,ie){const de=this.type=L.type,Ce=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;this.target=L.target||L.srcElement,this.g=ie,ie=L.relatedTarget,ie||(de=="mouseover"?ie=L.fromElement:de=="mouseout"&&(ie=L.toElement)),this.relatedTarget=ie,Ce?(this.clientX=Ce.clientX!==void 0?Ce.clientX:Ce.pageX,this.clientY=Ce.clientY!==void 0?Ce.clientY:Ce.pageY,this.screenX=Ce.screenX||0,this.screenY=Ce.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=L.pointerType,this.state=L.state,this.i=L,L.defaultPrevented&&Zt.Z.h.call(this)},Zt.prototype.h=function(){Zt.Z.h.call(this);const L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var dn="closure_listenable_"+(Math.random()*1e6|0),wt=0;function Jt(L,ie,de,Ce,Lt){this.listener=L,this.proxy=null,this.src=ie,this.type=de,this.capture=!!Ce,this.ha=Lt,this.key=++wt,this.da=this.fa=!1}function En(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function ci(L,ie,de){for(const Ce in L)ie.call(de,L[Ce],Ce,L)}function tt(L,ie){for(const de in L)ie.call(void 0,L[de],de,L)}function dt(L){const ie={};for(const de in L)ie[de]=L[de];return ie}const Kt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ne(L,ie){let de,Ce;for(let Lt=1;Lt<arguments.length;Lt++){Ce=arguments[Lt];for(de in Ce)L[de]=Ce[de];for(let Gt=0;Gt<Kt.length;Gt++)de=Kt[Gt],Object.prototype.hasOwnProperty.call(Ce,de)&&(L[de]=Ce[de])}}function wn(L){this.src=L,this.g={},this.h=0}wn.prototype.add=function(L,ie,de,Ce,Lt){const Gt=L.toString();L=this.g[Gt],L||(L=this.g[Gt]=[],this.h++);const Sn=Zn(L,ie,Ce,Lt);return Sn>-1?(ie=L[Sn],de||(ie.fa=!1)):(ie=new Jt(ie,this.src,Gt,!!Ce,Lt),ie.fa=de,L.push(ie)),ie};function Kn(L,ie){const de=ie.type;if(de in L.g){var Ce=L.g[de],Lt=Array.prototype.indexOf.call(Ce,ie,void 0),Gt;(Gt=Lt>=0)&&Array.prototype.splice.call(Ce,Lt,1),Gt&&(En(ie),L.g[de].length==0&&(delete L.g[de],L.h--))}}function Zn(L,ie,de,Ce){for(let Lt=0;Lt<L.length;++Lt){const Gt=L[Lt];if(!Gt.da&&Gt.listener==ie&&Gt.capture==!!de&&Gt.ha==Ce)return Lt}return-1}var Ci="closure_lm_"+(Math.random()*1e6|0),Xi={};function Gn(L,ie,de,Ce,Lt){if(Array.isArray(ie)){for(let Gt=0;Gt<ie.length;Gt++)Gn(L,ie[Gt],de,Ce,Lt);return null}return de=ui(de),L&&L[dn]?L.J(ie,de,s(Ce)?!!Ce.capture:!1,Lt):zi(L,ie,de,!1,Ce,Lt)}function zi(L,ie,de,Ce,Lt,Gt){if(!ie)throw Error("Invalid event type");const Sn=s(Lt)?!!Lt.capture:!!Lt;let oi=Ti(L);if(oi||(L[Ci]=oi=new wn(L)),de=oi.add(ie,de,Ce,Sn,Gt),de.proxy)return de;if(Ce=jr(),de.proxy=Ce,Ce.src=L,Ce.listener=de,L.addEventListener)et||(Lt=Sn),Lt===void 0&&(Lt=!1),L.addEventListener(ie.toString(),Ce,Lt);else if(L.attachEvent)L.attachEvent(Bs(ie.toString()),Ce);else if(L.addListener&&L.removeListener)L.addListener(Ce);else throw Error("addEventListener and attachEvent are unavailable.");return de}function jr(){function L(de){return ie.call(L.src,L.listener,de)}const ie=Hn;return L}function Va(L,ie,de,Ce,Lt){if(Array.isArray(ie))for(var Gt=0;Gt<ie.length;Gt++)Va(L,ie[Gt],de,Ce,Lt);else Ce=s(Ce)?!!Ce.capture:!!Ce,de=ui(de),L&&L[dn]?(L=L.i,Gt=String(ie).toString(),Gt in L.g&&(ie=L.g[Gt],de=Zn(ie,de,Ce,Lt),de>-1&&(En(ie[de]),Array.prototype.splice.call(ie,de,1),ie.length==0&&(delete L.g[Gt],L.h--)))):L&&(L=Ti(L))&&(ie=L.g[ie.toString()],L=-1,ie&&(L=Zn(ie,de,Ce,Lt)),(de=L>-1?ie[L]:null)&&cr(de))}function cr(L){if(typeof L!="number"&&L&&!L.da){var ie=L.src;if(ie&&ie[dn])Kn(ie.i,L);else{var de=L.type,Ce=L.proxy;ie.removeEventListener?ie.removeEventListener(de,Ce,L.capture):ie.detachEvent?ie.detachEvent(Bs(de),Ce):ie.addListener&&ie.removeListener&&ie.removeListener(Ce),(de=Ti(ie))?(Kn(de,L),de.h==0&&(de.src=null,ie[Ci]=null)):En(L)}}}function Bs(L){return L in Xi?Xi[L]:Xi[L]="on"+L}function Hn(L,ie){if(L.da)L=!0;else{ie=new Zt(ie,this);const de=L.listener,Ce=L.ha||L.src;L.fa&&cr(L),L=de.call(Ce,ie)}return L}function Ti(L){return L=L[Ci],L instanceof wn?L:null}var ur="__closure_events_fn_"+(Math.random()*1e9>>>0);function ui(L){return typeof L=="function"?L:(L[ur]||(L[ur]=function(ie){return L.handleEvent(ie)}),L[ur])}function Qi(){Ke.call(this),this.i=new wn(this),this.M=this,this.G=null}Q(Qi,Ke),Qi.prototype[dn]=!0,Qi.prototype.removeEventListener=function(L,ie,de,Ce){Va(this,L,ie,de,Ce)};function _r(L,ie){var de,Ce=L.G;if(Ce)for(de=[];Ce;Ce=Ce.G)de.push(Ce);if(L=L.M,Ce=ie.type||ie,typeof ie=="string")ie=new qe(ie,L);else if(ie instanceof qe)ie.target=ie.target||L;else{var Lt=ie;ie=new qe(Ce,L),Ne(ie,Lt)}Lt=!0;let Gt,Sn;if(de)for(Sn=de.length-1;Sn>=0;Sn--)Gt=ie.g=de[Sn],Lt=Xs(Gt,Ce,!0,ie)&&Lt;if(Gt=ie.g=L,Lt=Xs(Gt,Ce,!0,ie)&&Lt,Lt=Xs(Gt,Ce,!1,ie)&&Lt,de)for(Sn=0;Sn<de.length;Sn++)Gt=ie.g=de[Sn],Lt=Xs(Gt,Ce,!1,ie)&&Lt}Qi.prototype.N=function(){if(Qi.Z.N.call(this),this.i){var L=this.i;for(const ie in L.g){const de=L.g[ie];for(let Ce=0;Ce<de.length;Ce++)En(de[Ce]);delete L.g[ie],L.h--}}this.G=null},Qi.prototype.J=function(L,ie,de,Ce){return this.i.add(String(L),ie,!1,de,Ce)},Qi.prototype.K=function(L,ie,de,Ce){return this.i.add(String(L),ie,!0,de,Ce)};function Xs(L,ie,de,Ce){if(ie=L.i.g[String(ie)],!ie)return!0;ie=ie.concat();let Lt=!0;for(let Gt=0;Gt<ie.length;++Gt){const Sn=ie[Gt];if(Sn&&!Sn.da&&Sn.capture==de){const oi=Sn.listener,Mi=Sn.ha||Sn.src;Sn.fa&&Kn(L.i,Sn),Lt=oi.call(Mi,Ce)!==!1&&Lt}}return Lt&&!Ce.defaultPrevented}function Rl(L,ie){if(typeof L!="function")if(L&&typeof L.handleEvent=="function")L=V(L.handleEvent,L);else throw Error("Invalid listener argument");return Number(ie)>2147483647?-1:C.setTimeout(L,ie||0)}function rc(L){L.g=Rl(()=>{L.g=null,L.i&&(L.i=!1,rc(L))},L.l);const ie=L.h;L.h=null,L.m.apply(null,ie)}class Ur extends Ke{constructor(ie,de){super(),this.m=ie,this.l=de,this.h=null,this.i=!1,this.g=null}j(ie){this.h=arguments,this.g?this.i=!0:rc(this)}N(){super.N(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vs(L){Ke.call(this),this.h=L,this.g={}}Q(vs,Ke);var en=[];function Tn(L){ci(L.g,function(ie,de){this.g.hasOwnProperty(de)&&cr(ie)},L),L.g={}}vs.prototype.N=function(){vs.Z.N.call(this),Tn(this)},vs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ri=C.JSON.stringify,Oi=C.JSON.parse,Ri=class{stringify(L){return C.JSON.stringify(L,void 0)}parse(L){return C.JSON.parse(L,void 0)}};function Fs(){}function gs(){}var ps={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function kr(){qe.call(this,"d")}Q(kr,qe);function yr(){qe.call(this,"c")}Q(yr,qe);var Vi={},ra=null;function bs(){return ra=ra||new Qi}Vi.Ia="serverreachability";function cl(L){qe.call(this,Vi.Ia,L)}Q(cl,qe);function Ca(L){const ie=bs();_r(ie,new cl(ie))}Vi.STAT_EVENT="statevent";function bo(L,ie){qe.call(this,Vi.STAT_EVENT,L),this.stat=ie}Q(bo,qe);function ms(L){const ie=bs();_r(ie,new bo(ie,L))}Vi.Ja="timingevent";function ji(L,ie){qe.call(this,Vi.Ja,L),this.size=ie}Q(ji,qe);function Yr(L,ie){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){L()},ie)}function wo(){this.g=!0}wo.prototype.ua=function(){this.g=!1};function _u(L,ie,de,Ce,Lt,Gt){L.info(function(){if(L.g)if(Gt){var Sn="",oi=Gt.split("&");for(let Lr=0;Lr<oi.length;Lr++){var Mi=oi[Lr].split("=");if(Mi.length>1){const Kr=Mi[0];Mi=Mi[1];const Do=Kr.split("_");Sn=Do.length>=2&&Do[1]=="type"?Sn+(Kr+"="+Mi+"&"):Sn+(Kr+"=redacted&")}}}else Sn=null;else Sn=Gt;return"XMLHTTP REQ ("+Ce+") [attempt "+Lt+"]: "+ie+`
`+de+`
`+Sn})}function ja(L,ie,de,Ce,Lt,Gt,Sn){L.info(function(){return"XMLHTTP RESP ("+Ce+") [ attempt "+Lt+"]: "+ie+`
`+de+`
`+Gt+" "+Sn})}function ul(L,ie,de,Ce){L.info(function(){return"XMLHTTP TEXT ("+ie+"): "+Mt(L,de)+(Ce?" "+Ce:"")})}function hl(L,ie){L.info(function(){return"TIMEOUT: "+ie})}wo.prototype.info=function(){};function Mt(L,ie){if(!L.g)return ie;if(!ie)return null;try{const Gt=JSON.parse(ie);if(Gt){for(L=0;L<Gt.length;L++)if(Array.isArray(Gt[L])){var de=Gt[L];if(!(de.length<2)){var Ce=de[1];if(Array.isArray(Ce)&&!(Ce.length<1)){var Lt=Ce[0];if(Lt!="noop"&&Lt!="stop"&&Lt!="close")for(let Sn=1;Sn<Ce.length;Sn++)Ce[Sn]=""}}}}return ri(Gt)}catch{return ie}}var no={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},th={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Lc;function ai(){}Q(ai,Fs),ai.prototype.g=function(){return new XMLHttpRequest},Lc=new ai;function Ue(L){return encodeURIComponent(String(L))}function ne(L){var ie=1;L=L.split(":");const de=[];for(;ie>0&&L.length;)de.push(L.shift()),ie--;return L.length&&de.push(L.join(":")),de}function ae(L,ie,de,Ce){this.j=L,this.i=ie,this.l=de,this.S=Ce||1,this.V=new vs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ye}function ye(){this.i=null,this.g="",this.h=!1}var De={},xe={};function Be(L,ie,de){L.M=1,L.A=ws(Ei(ie)),L.u=de,L.R=!0,it(L,null)}function it(L,ie){L.F=Date.now(),It(L),L.B=Ei(L.A);var de=L.B,Ce=L.S;Array.isArray(Ce)||(Ce=[String(Ce)]),yu(de.i,"t",Ce),L.C=0,de=L.j.L,L.h=new ye,L.g=rd(L.j,de?ie:null,!L.u),L.P>0&&(L.O=new Ur(V(L.Y,L,L.g),L.P)),ie=L.V,de=L.g,Ce=L.ba;var Lt="readystatechange";Array.isArray(Lt)||(Lt&&(en[0]=Lt.toString()),Lt=en);for(let Gt=0;Gt<Lt.length;Gt++){const Sn=Gn(de,Lt[Gt],Ce||ie.handleEvent,!1,ie.h||ie);if(!Sn)break;ie.g[Sn.key]=Sn}ie=L.J?dt(L.J):{},L.u?(L.v||(L.v="POST"),ie["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.B,L.v,L.u,ie)):(L.v="GET",L.g.ea(L.B,L.v,null,ie)),Ca(),_u(L.i,L.v,L.B,L.l,L.S,L.u)}ae.prototype.ba=function(L){L=L.target;const ie=this.O;ie&&Co(L)==3?ie.j():this.Y(L)},ae.prototype.Y=function(L){try{if(L==this.g)e:{const oi=Co(this.g),Mi=this.g.ya(),Lr=this.g.ca();if(!(oi<3)&&(oi!=3||this.g&&(this.h.h||this.g.la()||ya(this.g)))){this.K||oi!=4||Mi==7||(Mi==8||Lr<=0?Ca(3):Ca(2)),yn(this);var ie=this.g.ca();this.X=ie;var de=Ge(this);if(this.o=ie==200,ja(this.i,this.v,this.B,this.l,this.S,oi,ie),this.o){if(this.U&&!this.L){t:{if(this.g){var Ce,Lt=this.g;if((Ce=Lt.g?Lt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!be(Ce)){var Gt=Ce;break t}}Gt=null}if(L=Gt)ul(this.i,this.l,L,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Fn(this,L);else{this.o=!1,this.m=3,ms(12),kn(this),bn(this);break e}}if(this.R){L=!0;let Kr;for(;!this.K&&this.C<de.length;)if(Kr=Dt(this,de),Kr==xe){oi==4&&(this.m=4,ms(14),L=!1),ul(this.i,this.l,null,"[Incomplete Response]");break}else if(Kr==De){this.m=4,ms(15),ul(this.i,this.l,de,"[Invalid Chunk]"),L=!1;break}else ul(this.i,this.l,Kr,null),Fn(this,Kr);if(at(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),oi!=4||de.length!=0||this.h.h||(this.m=1,ms(16),L=!1),this.o=this.o&&L,!L)ul(this.i,this.l,de,"[Invalid Chunked Response]"),kn(this),bn(this);else if(de.length>0&&!this.W){this.W=!0;var Sn=this.j;Sn.g==this&&Sn.aa&&!Sn.P&&(Sn.j.info("Great, no buffering proxy detected. Bytes received: "+de.length),qa(Sn),Sn.P=!0,ms(11))}}else ul(this.i,this.l,de,null),Fn(this,de);oi==4&&kn(this),this.o&&!this.K&&(oi==4?Si(this.j,this):(this.o=!1,It(this)))}else sc(this.g),ie==400&&de.indexOf("Unknown SID")>0?(this.m=3,ms(12)):(this.m=0,ms(13)),kn(this),bn(this)}}}catch{}finally{}};function Ge(L){if(!at(L))return L.g.la();const ie=ya(L.g);if(ie==="")return"";let de="";const Ce=ie.length,Lt=Co(L.g)==4;if(!L.h.i){if(typeof TextDecoder>"u")return kn(L),bn(L),"";L.h.i=new C.TextDecoder}for(let Gt=0;Gt<Ce;Gt++)L.h.h=!0,de+=L.h.i.decode(ie[Gt],{stream:!(Lt&&Gt==Ce-1)});return ie.length=0,L.h.g+=de,L.C=0,L.h.g}function at(L){return L.g?L.v=="GET"&&L.M!=2&&L.j.Aa:!1}function Dt(L,ie){var de=L.C,Ce=ie.indexOf(`
`,de);return Ce==-1?xe:(de=Number(ie.substring(de,Ce)),isNaN(de)?De:(Ce+=1,Ce+de>ie.length?xe:(ie=ie.slice(Ce,Ce+de),L.C=Ce+de,ie)))}ae.prototype.cancel=function(){this.K=!0,kn(this)};function It(L){L.T=Date.now()+L.H,tn(L,L.H)}function tn(L,ie){if(L.D!=null)throw Error("WatchDog timer not null");L.D=Yr(V(L.aa,L),ie)}function yn(L){L.D&&(C.clearTimeout(L.D),L.D=null)}ae.prototype.aa=function(){this.D=null;const L=Date.now();L-this.T>=0?(hl(this.i,this.B),this.M!=2&&(Ca(),ms(17)),kn(this),this.m=2,bn(this)):tn(this,this.T-L)};function bn(L){L.j.I==0||L.K||Si(L.j,L)}function kn(L){yn(L);var ie=L.O;ie&&typeof ie.dispose=="function"&&ie.dispose(),L.O=null,Tn(L.V),L.g&&(ie=L.g,L.g=null,ie.abort(),ie.dispose())}function Fn(L,ie){try{var de=L.j;if(de.I!=0&&(de.g==L||nr(de.h,L))){if(!L.L&&nr(de.h,L)&&de.I==3){try{var Ce=de.Ba.g.parse(ie)}catch{Ce=null}if(Array.isArray(Ce)&&Ce.length==3){var Lt=Ce;if(Lt[0]==0){e:if(!de.v){if(de.g)if(de.g.F+3e3<L.F)ah(de),Dl(de);else break e;Vs(de),ms(18)}}else de.xa=Lt[1],0<de.xa-de.K&&Lt[2]<37500&&de.F&&de.A==0&&!de.C&&(de.C=Yr(V(de.Va,de),6e3));vr(de.h)<=1&&de.ta&&(de.ta=void 0)}else Pl(de,11)}else if((L.L||de.g==L)&&ah(de),!be(ie))for(Lt=de.Ba.g.parse(ie),ie=0;ie<Lt.length;ie++){let Lr=Lt[ie];const Kr=Lr[0];if(!(Kr<=de.K))if(de.K=Kr,Lr=Lr[1],de.I==2)if(Lr[0]=="c"){de.M=Lr[1],de.ba=Lr[2];const Do=Lr[3];Do!=null&&(de.ka=Do,de.j.info("VER="+de.ka));const Po=Lr[4];Po!=null&&(de.za=Po,de.j.info("SVER="+de.za));const ko=Lr[5];ko!=null&&typeof ko=="number"&&ko>0&&(Ce=1.5*ko,de.O=Ce,de.j.info("backChannelRequestTimeoutMs_="+Ce)),Ce=de;const Wo=L.g;if(Wo){const lc=Wo.g?Wo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lc){var Gt=Ce.h;Gt.g||lc.indexOf("spdy")==-1&&lc.indexOf("quic")==-1&&lc.indexOf("h2")==-1||(Gt.j=Gt.l,Gt.g=new Set,Gt.h&&(br(Gt,Gt.h),Gt.h=null))}if(Ce.G){const Rs=Wo.g?Wo.g.getResponseHeader("X-HTTP-Session-Id"):null;Rs&&(Ce.wa=Rs,fr(Ce.J,Ce.G,Rs))}}de.I=3,de.l&&de.l.ra(),de.aa&&(de.T=Date.now()-L.F,de.j.info("Handshake RTT: "+de.T+"ms")),Ce=de;var Sn=L;if(Ce.na=Cn(Ce,Ce.L?Ce.ba:null,Ce.W),Sn.L){ir(Ce.h,Sn);var oi=Sn,Mi=Ce.O;Mi&&(oi.H=Mi),oi.D&&(yn(oi),It(oi)),Ce.g=Sn}else pl(Ce);de.i.length>0&&ro(de)}else Lr[0]!="stop"&&Lr[0]!="close"||Pl(de,7);else de.I==3&&(Lr[0]=="stop"||Lr[0]=="close"?Lr[0]=="stop"?Pl(de,7):Bc(de):Lr[0]!="noop"&&de.l&&de.l.qa(Lr),de.A=0)}}Ca(4)}catch{}}var vn=class{constructor(L,ie){this.g=L,this.map=ie}};function Pn(L){this.l=L||10,C.PerformanceNavigationTiming?(L=C.performance.getEntriesByType("navigation"),L=L.length>0&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(C.chrome&&C.chrome.loadTimes&&C.chrome.loadTimes()&&C.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $i(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function vr(L){return L.h?1:L.g?L.g.size:0}function nr(L,ie){return L.h?L.h==ie:L.g?L.g.has(ie):!1}function br(L,ie){L.g?L.g.add(ie):L.h=ie}function ir(L,ie){L.h&&L.h==ie?L.h=null:L.g&&L.g.has(ie)&&L.g.delete(ie)}Pn.prototype.cancel=function(){if(this.i=hi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function hi(L){if(L.h!=null)return L.i.concat(L.h.G);if(L.g!=null&&L.g.size!==0){let ie=L.i;for(const de of L.g.values())ie=ie.concat(de.G);return ie}return he(L.i)}var hr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ni(L,ie){if(L){L=L.split("&");for(let de=0;de<L.length;de++){const Ce=L[de].indexOf("=");let Lt,Gt=null;Ce>=0?(Lt=L[de].substring(0,Ce),Gt=L[de].substring(Ce+1)):Lt=L[de],ie(Lt,Gt?decodeURIComponent(Gt.replace(/\+/g," ")):"")}}}function _i(L){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let ie;L instanceof _i?(this.l=L.l,dr(this,L.j),this.o=L.o,this.g=L.g,Jr(this,L.u),this.h=L.h,es(this,Es(L.i)),this.m=L.m):L&&(ie=String(L).match(hr))?(this.l=!1,dr(this,ie[1]||"",!0),this.o=Ts(ie[2]||""),this.g=Ts(ie[3]||"",!0),Jr(this,ie[4]),this.h=Ts(ie[5]||"",!0),es(this,ie[6]||"",!0),this.m=Ts(ie[7]||"")):(this.l=!1,this.i=new dl(null,this.l))}_i.prototype.toString=function(){const L=[];var ie=this.j;ie&&L.push(ma(ie,sa,!0),":");var de=this.g;return(de||ie=="file")&&(L.push("//"),(ie=this.o)&&L.push(ma(ie,sa,!0),"@"),L.push(Ue(de).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),de=this.u,de!=null&&L.push(":",String(de))),(de=this.h)&&(this.g&&de.charAt(0)!="/"&&L.push("/"),L.push(ma(de,de.charAt(0)=="/"?$o:aa,!0))),(de=this.i.toString())&&L.push("?",de),(de=this.m)&&L.push("#",ma(de,Ua)),L.join("")},_i.prototype.resolve=function(L){const ie=Ei(this);let de=!!L.j;de?dr(ie,L.j):de=!!L.o,de?ie.o=L.o:de=!!L.g,de?ie.g=L.g:de=L.u!=null;var Ce=L.h;if(de)Jr(ie,L.u);else if(de=!!L.h){if(Ce.charAt(0)!="/")if(this.g&&!this.h)Ce="/"+Ce;else{var Lt=ie.h.lastIndexOf("/");Lt!=-1&&(Ce=ie.h.slice(0,Lt+1)+Ce)}if(Lt=Ce,Lt==".."||Lt==".")Ce="";else if(Lt.indexOf("./")!=-1||Lt.indexOf("/.")!=-1){Ce=Lt.lastIndexOf("/",0)==0,Lt=Lt.split("/");const Gt=[];for(let Sn=0;Sn<Lt.length;){const oi=Lt[Sn++];oi=="."?Ce&&Sn==Lt.length&&Gt.push(""):oi==".."?((Gt.length>1||Gt.length==1&&Gt[0]!="")&&Gt.pop(),Ce&&Sn==Lt.length&&Gt.push("")):(Gt.push(oi),Ce=!0)}Ce=Gt.join("/")}else Ce=Lt}return de?ie.h=Ce:de=L.i.toString()!=="",de?es(ie,Es(L.i)):de=!!L.m,de&&(ie.m=L.m),ie};function Ei(L){return new _i(L)}function dr(L,ie,de){L.j=de?Ts(ie,!0):ie,L.j&&(L.j=L.j.replace(/:$/,""))}function Jr(L,ie){if(ie){if(ie=Number(ie),isNaN(ie)||ie<0)throw Error("Bad port number "+ie);L.u=ie}else L.u=null}function es(L,ie,de){ie instanceof dl?(L.i=ie,Eo(L.i,L.l)):(de||(ie=ma(ie,To)),L.i=new dl(ie,L.l))}function fr(L,ie,de){L.i.set(ie,de)}function ws(L){return fr(L,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),L}function Ts(L,ie){return L?ie?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function ma(L,ie,de){return typeof L=="string"?(L=encodeURI(L).replace(ie,_s),de&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function _s(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var sa=/[#\/\?@]/g,aa=/[#\?:]/g,$o=/[#\?]/g,To=/[#\?@]/g,Ua=/#/g;function dl(L,ie){this.h=this.g=null,this.i=L||null,this.j=!!ie}function ga(L){L.g||(L.g=new Map,L.h=0,L.i&&Ni(L.i,function(ie,de){L.add(decodeURIComponent(ie.replace(/\+/g," ")),de)}))}o=dl.prototype,o.add=function(L,ie){ga(this),this.i=null,L=Ys(this,L);let de=this.g.get(L);return de||this.g.set(L,de=[]),de.push(ie),this.h+=1,this};function pf(L,ie){ga(L),ie=Ys(L,ie),L.g.has(ie)&&(L.i=null,L.h-=L.g.get(ie).length,L.g.delete(ie))}function td(L,ie){return ga(L),ie=Ys(L,ie),L.g.has(ie)}o.forEach=function(L,ie){ga(this),this.g.forEach(function(de,Ce){de.forEach(function(Lt){L.call(ie,Lt,Ce,this)},this)},this)};function nh(L,ie){ga(L);let de=[];if(typeof ie=="string")td(L,ie)&&(de=de.concat(L.g.get(Ys(L,ie))));else for(L=Array.from(L.g.values()),ie=0;ie<L.length;ie++)de=de.concat(L[ie]);return de}o.set=function(L,ie){return ga(this),this.i=null,L=Ys(this,L),td(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[ie]),this.h+=1,this},o.get=function(L,ie){return L?(L=nh(this,L),L.length>0?String(L[0]):ie):ie};function yu(L,ie,de){pf(L,ie),de.length>0&&(L.i=null,L.g.set(Ys(L,ie),he(de)),L.h+=de.length)}o.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],ie=Array.from(this.g.keys());for(let Ce=0;Ce<ie.length;Ce++){var de=ie[Ce];const Lt=Ue(de);de=nh(this,de);for(let Gt=0;Gt<de.length;Gt++){let Sn=Lt;de[Gt]!==""&&(Sn+="="+Ue(de[Gt])),L.push(Sn)}}return this.i=L.join("&")};function Es(L){const ie=new dl;return ie.i=L.i,L.g&&(ie.g=new Map(L.g),ie.h=L.h),ie}function Ys(L,ie){return ie=String(ie),L.j&&(ie=ie.toLowerCase()),ie}function Eo(L,ie){ie&&!L.j&&(ga(L),L.i=null,L.g.forEach(function(de,Ce){const Lt=Ce.toLowerCase();Ce!=Lt&&(pf(this,Ce),yu(this,Lt,de))},L)),L.j=ie}function Ss(L,ie){const de=new wo;if(C.Image){const Ce=new Image;Ce.onload=W(Ra,de,"TestLoadImage: loaded",!0,ie,Ce),Ce.onerror=W(Ra,de,"TestLoadImage: error",!1,ie,Ce),Ce.onabort=W(Ra,de,"TestLoadImage: abort",!1,ie,Ce),Ce.ontimeout=W(Ra,de,"TestLoadImage: timeout",!1,ie,Ce),C.setTimeout(function(){Ce.ontimeout&&Ce.ontimeout()},1e4),Ce.src=L}else ie(!1)}function So(L,ie){const de=new wo,Ce=new AbortController,Lt=setTimeout(()=>{Ce.abort(),Ra(de,"TestPingServer: timeout",!1,ie)},1e4);fetch(L,{signal:Ce.signal}).then(Gt=>{clearTimeout(Lt),Gt.ok?Ra(de,"TestPingServer: ok",!0,ie):Ra(de,"TestPingServer: server error",!1,ie)}).catch(()=>{clearTimeout(Lt),Ra(de,"TestPingServer: error",!1,ie)})}function Ra(L,ie,de,Ce,Lt){try{Lt&&(Lt.onload=null,Lt.onerror=null,Lt.onabort=null,Lt.ontimeout=null),Ce(de)}catch{}}function Zo(){this.g=new Ri}function Ga(L){this.i=L.Sb||null,this.h=L.ab||!1}Q(Ga,Fs),Ga.prototype.g=function(){return new Ao(this.i,this.h)};function Ao(L,ie){Qi.call(this),this.H=L,this.o=ie,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}Q(Ao,Qi),o=Ao.prototype,o.open=function(L,ie){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=L,this.D=ie,this.readyState=1,fl(this)},o.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const ie={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};L&&(ie.body=L),(this.H||C).fetch(new Request(this.D,ie)).then(this.Pa.bind(this),this.ga.bind(this))},o.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Oc(this)),this.readyState=0},o.Pa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,fl(this)),this.g&&(this.readyState=3,fl(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof C.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;zc(this)}else L.text().then(this.Oa.bind(this),this.ga.bind(this))};function zc(L){L.j.read().then(L.Ma.bind(L)).catch(L.ga.bind(L))}o.Ma=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var ie=L.value?L.value:new Uint8Array(0);(ie=this.B.decode(ie,{stream:!L.done}))&&(this.response=this.responseText+=ie)}L.done?Oc(this):fl(this),this.readyState==3&&zc(this)}},o.Oa=function(L){this.g&&(this.response=this.responseText=L,Oc(this))},o.Na=function(L){this.g&&(this.response=L,Oc(this))},o.ga=function(){this.g&&Oc(this)};function Oc(L){L.readyState=4,L.l=null,L.j=null,L.B=null,fl(L)}o.setRequestHeader=function(L,ie){this.A.append(L,ie)},o.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},o.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],ie=this.h.entries();for(var de=ie.next();!de.done;)de=de.value,L.push(de[0]+": "+de[1]),de=ie.next();return L.join(`\r
`)};function fl(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(Ao.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function us(L){let ie="";return ci(L,function(de,Ce){ie+=Ce,ie+=":",ie+=de,ie+=`\r
`}),ie}function Ml(L,ie,de){e:{for(Ce in de){var Ce=!1;break e}Ce=!0}Ce||(de=us(de),typeof L=="string"?de!=null&&Ue(de):fr(L,ie,de))}function Sr(L){Qi.call(this),this.headers=new Map,this.L=L||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}Q(Sr,Qi);var _a=/^https?$/i,Nc=["POST","PUT"];o=Sr.prototype,o.Fa=function(L){this.H=L},o.ea=function(L,ie,de,Ce){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);ie=ie?ie.toUpperCase():"GET",this.D=L,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Lc.g(),this.g.onreadystatechange=oe(V(this.Ca,this));try{this.B=!0,this.g.open(ie,String(L),!0),this.B=!1}catch(Gt){ih(this,Gt);return}if(L=de||"",de=new Map(this.headers),Ce)if(Object.getPrototypeOf(Ce)===Object.prototype)for(var Lt in Ce)de.set(Lt,Ce[Lt]);else if(typeof Ce.keys=="function"&&typeof Ce.get=="function")for(const Gt of Ce.keys())de.set(Gt,Ce.get(Gt));else throw Error("Unknown input type for opt_headers: "+String(Ce));Ce=Array.from(de.keys()).find(Gt=>Gt.toLowerCase()=="content-type"),Lt=C.FormData&&L instanceof C.FormData,!(Array.prototype.indexOf.call(Nc,ie,void 0)>=0)||Ce||Lt||de.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Gt,Sn]of de)this.g.setRequestHeader(Gt,Sn);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(L),this.v=!1}catch(Gt){ih(this,Gt)}};function ih(L,ie){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=ie,L.o=5,rh(L),Io(L)}function rh(L){L.A||(L.A=!0,_r(L,"complete"),_r(L,"error"))}o.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=L||7,_r(this,"complete"),_r(this,"abort"),Io(this))},o.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Io(this,!0)),Sr.Z.N.call(this)},o.Ca=function(){this.u||(this.B||this.v||this.j?di(this):this.Xa())},o.Xa=function(){di(this)};function di(L){if(L.h&&typeof T<"u"){if(L.v&&Co(L)==4)setTimeout(L.Ca.bind(L),0);else if(_r(L,"readystatechange"),Co(L)==4){L.h=!1;try{const Gt=L.ca();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ie=!0;break e;default:ie=!1}var de;if(!(de=ie)){var Ce;if(Ce=Gt===0){let Sn=String(L.D).match(hr)[1]||null;!Sn&&C.self&&C.self.location&&(Sn=C.self.location.protocol.slice(0,-1)),Ce=!_a.test(Sn?Sn.toLowerCase():"")}de=Ce}if(de)_r(L,"complete"),_r(L,"success");else{L.o=6;try{var Lt=Co(L)>2?L.g.statusText:""}catch{Lt=""}L.l=Lt+" ["+L.ca()+"]",rh(L)}}finally{Io(L)}}}}function Io(L,ie){if(L.g){L.m&&(clearTimeout(L.m),L.m=null);const de=L.g;L.g=null,ie||_r(L,"ready");try{de.onreadystatechange=null}catch{}}}o.isActive=function(){return!!this.g};function Co(L){return L.g?L.g.readyState:0}o.ca=function(){try{return Co(this)>2?this.g.status:-1}catch{return-1}},o.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},o.La=function(L){if(this.g){var ie=this.g.responseText;return L&&ie.indexOf(L)==0&&(ie=ie.substring(L.length)),Oi(ie)}};function ya(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.F){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function sc(L){const ie={};L=(L.g&&Co(L)>=2&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ce=0;Ce<L.length;Ce++){if(be(L[Ce]))continue;var de=ne(L[Ce]);const Lt=de[0];if(de=de[1],typeof de!="string")continue;de=de.trim();const Gt=ie[Lt]||[];ie[Lt]=Gt,Gt.push(de)}tt(ie,function(Ce){return Ce.join(", ")})}o.ya=function(){return this.o},o.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ro(L,ie,de){return de&&de.internalChannelParams&&de.internalChannelParams[L]||ie}function io(L){this.za=0,this.i=[],this.j=new wo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ro("failFast",!1,L),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ro("baseRetryDelayMs",5e3,L),this.Za=Ro("retryDelaySeedMs",1e4,L),this.Ta=Ro("forwardChannelMaxRetries",2,L),this.va=Ro("forwardChannelRequestTimeoutMs",2e4,L),this.ma=L&&L.xmlHttpFactory||void 0,this.Ua=L&&L.Rb||void 0,this.Aa=L&&L.useFetchStreams||!1,this.O=void 0,this.L=L&&L.supportsCrossDomainXhr||!1,this.M="",this.h=new Pn(L&&L.concurrentRequestLimit),this.Ba=new Zo,this.S=L&&L.fastHandshake||!1,this.R=L&&L.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=L&&L.Pb||!1,L&&L.ua&&this.j.ua(),L&&L.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&L&&L.detectBufferingProxy||!1,this.ia=void 0,L&&L.longPollingTimeout&&L.longPollingTimeout>0&&(this.ia=L.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}o=io.prototype,o.ka=8,o.I=1,o.connect=function(L,ie,de,Ce){ms(0),this.W=L,this.H=ie||{},de&&Ce!==void 0&&(this.H.OSID=de,this.H.OAID=Ce),this.F=this.X,this.J=Cn(this,null,this.W),ro(this)};function Bc(L){if(nd(L),L.I==3){var ie=L.V++,de=Ei(L.J);if(fr(de,"SID",L.M),fr(de,"RID",ie),fr(de,"TYPE","terminate"),xu(L,de),ie=new ae(L,L.j,ie),ie.M=2,ie.A=ws(Ei(de)),de=!1,C.navigator&&C.navigator.sendBeacon)try{de=C.navigator.sendBeacon(ie.A.toString(),"")}catch{}!de&&C.Image&&(new Image().src=ie.A,de=!0),de||(ie.g=rd(ie.j,null),ie.g.ea(ie.A)),ie.F=Date.now(),It(ie)}mf(L)}function Dl(L){L.g&&(qa(L),L.g.cancel(),L.g=null)}function nd(L){Dl(L),L.v&&(C.clearTimeout(L.v),L.v=null),ah(L),L.h.cancel(),L.m&&(typeof L.m=="number"&&C.clearTimeout(L.m),L.m=null)}function ro(L){if(!$i(L.h)&&!L.m){L.m=!0;var ie=L.Ea;fn||ze(),St||(fn(),St=!0),je.add(ie,L),L.D=0}}function Mo(L,ie){return vr(L.h)>=L.h.j-(L.m?1:0)?!1:L.m?(L.i=ie.G.concat(L.i),!0):L.I==1||L.I==2||L.D>=(L.Sa?0:L.Ta)?!1:(L.m=Yr(V(L.Ea,L,ie),id(L,L.D)),L.D++,!0)}o.Ea=function(L){if(this.m)if(this.m=null,this.I==1){if(!L){this.V=Math.floor(Math.random()*1e5),L=this.V++;const Lt=new ae(this,this.j,L);let Gt=this.o;if(this.U&&(Gt?(Gt=dt(Gt),Ne(Gt,this.U)):Gt=this.U),this.u!==null||this.R||(Lt.J=Gt,Gt=null),this.S)e:{for(var ie=0,de=0;de<this.i.length;de++){t:{var Ce=this.i[de];if("__data__"in Ce.map&&(Ce=Ce.map.__data__,typeof Ce=="string")){Ce=Ce.length;break t}Ce=void 0}if(Ce===void 0)break;if(ie+=Ce,ie>4096){ie=de;break e}if(ie===4096||de===this.i.length-1){ie=de+1;break e}}ie=1e3}else ie=1e3;ie=ac(this,Lt,ie),de=Ei(this.J),fr(de,"RID",L),fr(de,"CVER",22),this.G&&fr(de,"X-HTTP-Session-Id",this.G),xu(this,de),Gt&&(this.R?ie="headers="+Ue(us(Gt))+"&"+ie:this.u&&Ml(de,this.u,Gt)),br(this.h,Lt),this.Ra&&fr(de,"TYPE","init"),this.S?(fr(de,"$req",ie),fr(de,"SID","null"),Lt.U=!0,Be(Lt,de,null)):Be(Lt,de,ie),this.I=2}}else this.I==3&&(L?Fc(this,L):this.i.length==0||$i(this.h)||Fc(this))};function Fc(L,ie){var de;ie?de=ie.l:de=L.V++;const Ce=Ei(L.J);fr(Ce,"SID",L.M),fr(Ce,"RID",de),fr(Ce,"AID",L.K),xu(L,Ce),L.u&&L.o&&Ml(Ce,L.u,L.o),de=new ae(L,L.j,de,L.D+1),L.u===null&&(de.J=L.o),ie&&(L.i=ie.G.concat(L.i)),ie=ac(L,de,1e3),de.H=Math.round(L.va*.5)+Math.round(L.va*.5*Math.random()),br(L.h,de),Be(de,Ce,ie)}function xu(L,ie){L.H&&ci(L.H,function(de,Ce){fr(ie,Ce,de)}),L.l&&ci({},function(de,Ce){fr(ie,Ce,de)})}function ac(L,ie,de){de=Math.min(L.i.length,de);const Ce=L.l?V(L.l.Ka,L.l,L):null;e:{var Lt=L.i;let oi=-1;for(;;){const Mi=["count="+de];oi==-1?de>0?(oi=Lt[0].g,Mi.push("ofs="+oi)):oi=0:Mi.push("ofs="+oi);let Lr=!0;for(let Kr=0;Kr<de;Kr++){var Gt=Lt[Kr].g;const Do=Lt[Kr].map;if(Gt-=oi,Gt<0)oi=Math.max(0,Lt[Kr].g-100),Lr=!1;else try{Gt="req"+Gt+"_"||"";try{var Sn=Do instanceof Map?Do:Object.entries(Do);for(const[Po,ko]of Sn){let Wo=ko;s(ko)&&(Wo=ri(ko)),Mi.push(Gt+Po+"="+encodeURIComponent(Wo))}}catch(Po){throw Mi.push(Gt+"type="+encodeURIComponent("_badmap")),Po}}catch{Ce&&Ce(Do)}}if(Lr){Sn=Mi.join("&");break e}}Sn=void 0}return L=L.i.splice(0,de),ie.G=L,Sn}function pl(L){if(!L.g&&!L.v){L.Y=1;var ie=L.Da;fn||ze(),St||(fn(),St=!0),je.add(ie,L),L.A=0}}function Vs(L){return L.g||L.v||L.A>=3?!1:(L.Y++,L.v=Yr(V(L.Da,L),id(L,L.A)),L.A++,!0)}o.Da=function(){if(this.v=null,sh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var L=4*this.T;this.j.info("BP detection timer enabled: "+L),this.B=Yr(V(this.Wa,this),L)}},o.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ms(10),Dl(this),sh(this))};function qa(L){L.B!=null&&(C.clearTimeout(L.B),L.B=null)}function sh(L){L.g=new ae(L,L.j,"rpc",L.Y),L.u===null&&(L.g.J=L.o),L.g.P=0;var ie=Ei(L.na);fr(ie,"RID","rpc"),fr(ie,"SID",L.M),fr(ie,"AID",L.K),fr(ie,"CI",L.F?"0":"1"),!L.F&&L.ia&&fr(ie,"TO",L.ia),fr(ie,"TYPE","xmlhttp"),xu(L,ie),L.u&&L.o&&Ml(ie,L.u,L.o),L.O&&(L.g.H=L.O);var de=L.g;L=L.ba,de.M=1,de.A=ws(Ei(ie)),de.u=null,de.R=!0,it(de,L)}o.Va=function(){this.C!=null&&(this.C=null,Dl(this),Vs(this),ms(19))};function ah(L){L.C!=null&&(C.clearTimeout(L.C),L.C=null)}function Si(L,ie){var de=null;if(L.g==ie){ah(L),qa(L),L.g=null;var Ce=2}else if(nr(L.h,ie))de=ie.G,ir(L.h,ie),Ce=1;else return;if(L.I!=0){if(ie.o)if(Ce==1){de=ie.u?ie.u.length:0,ie=Date.now()-ie.F;var Lt=L.D;Ce=bs(),_r(Ce,new ji(Ce,de)),ro(L)}else pl(L);else if(Lt=ie.m,Lt==3||Lt==0&&ie.X>0||!(Ce==1&&Mo(L,ie)||Ce==2&&Vs(L)))switch(de&&de.length>0&&(ie=L.h,ie.i=ie.i.concat(de)),Lt){case 1:Pl(L,5);break;case 4:Pl(L,10);break;case 3:Pl(L,6);break;default:Pl(L,2)}}}function id(L,ie){let de=L.Qa+Math.floor(Math.random()*L.Za);return L.isActive()||(de*=2),de*ie}function Pl(L,ie){if(L.j.info("Error code "+ie),ie==2){var de=V(L.bb,L),Ce=L.Ua;const Lt=!Ce;Ce=new _i(Ce||"//www.google.com/images/cleardot.gif"),C.location&&C.location.protocol=="http"||dr(Ce,"https"),ws(Ce),Lt?Ss(Ce.toString(),de):So(Ce.toString(),de)}else ms(2);L.I=0,L.l&&L.l.pa(ie),mf(L),nd(L)}o.bb=function(L){L?(this.j.info("Successfully pinged google.com"),ms(2)):(this.j.info("Failed to ping google.com"),ms(1))};function mf(L){if(L.I=0,L.ja=[],L.l){const ie=hi(L.h);(ie.length!=0||L.i.length!=0)&&(Je(L.ja,ie),Je(L.ja,L.i),L.h.i.length=0,he(L.i),L.i.length=0),L.l.oa()}}function Cn(L,ie,de){var Ce=de instanceof _i?Ei(de):new _i(de);if(Ce.g!="")ie&&(Ce.g=ie+"."+Ce.g),Jr(Ce,Ce.u);else{var Lt=C.location;Ce=Lt.protocol,ie=ie?ie+"."+Lt.hostname:Lt.hostname,Lt=+Lt.port;const Gt=new _i(null);Ce&&dr(Gt,Ce),ie&&(Gt.g=ie),Lt&&Jr(Gt,Lt),de&&(Gt.h=de),Ce=Gt}return de=L.G,ie=L.wa,de&&ie&&fr(Ce,de,ie),fr(Ce,"VER",L.ka),xu(L,Ce),Ce}function rd(L,ie,de){if(ie&&!L.L)throw Error("Can't create secondary domain capable XhrIo object.");return ie=L.Aa&&!L.ma?new Sr(new Ga({ab:de})):new Sr(L.ma),ie.Fa(L.L),ie}o.isActive=function(){return!!this.l&&this.l.isActive(this)};function oc(){}o=oc.prototype,o.ra=function(){},o.qa=function(){},o.pa=function(){},o.oa=function(){},o.isActive=function(){return!0},o.Ka=function(){};function As(){}As.prototype.g=function(L,ie){return new xa(L,ie)};function xa(L,ie){Qi.call(this),this.g=new io(ie),this.l=L,this.h=ie&&ie.messageUrlParams||null,L=ie&&ie.messageHeaders||null,ie&&ie.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=ie&&ie.initMessageHeaders||null,ie&&ie.messageContentType&&(L?L["X-WebChannel-Content-Type"]=ie.messageContentType:L={"X-WebChannel-Content-Type":ie.messageContentType}),ie&&ie.sa&&(L?L["X-WebChannel-Client-Profile"]=ie.sa:L={"X-WebChannel-Client-Profile":ie.sa}),this.g.U=L,(L=ie&&ie.Qb)&&!be(L)&&(this.g.u=L),this.A=ie&&ie.supportsCrossDomainXhr||!1,this.v=ie&&ie.sendRawJson||!1,(ie=ie&&ie.httpSessionIdParam)&&!be(ie)&&(this.g.G=ie,L=this.h,L!==null&&ie in L&&(L=this.h,ie in L&&delete L[ie])),this.j=new pi(this)}Q(xa,Qi),xa.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xa.prototype.close=function(){Bc(this.g)},xa.prototype.o=function(L){var ie=this.g;if(typeof L=="string"){var de={};de.__data__=L,L=de}else this.v&&(de={},de.__data__=ri(L),L=de);ie.i.push(new vn(ie.Ya++,L)),ie.I==3&&ro(ie)},xa.prototype.N=function(){this.g.l=null,delete this.j,Bc(this.g),delete this.g,xa.Z.N.call(this)};function va(L){kr.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var ie=L.__sm__;if(ie){e:{for(const de in ie){L=de;break e}L=void 0}(this.i=L)&&(L=this.i,ie=ie!==null&&L in ie?ie[L]:void 0),this.data=ie}else this.data=L}Q(va,kr);function gn(){yr.call(this),this.status=1}Q(gn,yr);function pi(L){this.g=L}Q(pi,oc),pi.prototype.ra=function(){_r(this.g,"a")},pi.prototype.qa=function(L){_r(this.g,new va(L))},pi.prototype.pa=function(L){_r(this.g,new gn)},pi.prototype.oa=function(){_r(this.g,"b")},As.prototype.createWebChannel=As.prototype.g,xa.prototype.send=xa.prototype.o,xa.prototype.open=xa.prototype.m,xa.prototype.close=xa.prototype.close,SP=function(){return new As},EP=function(){return bs()},TP=Vi,aE={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},no.NO_ERROR=0,no.TIMEOUT=8,no.HTTP_ERROR=6,Lb=no,th.COMPLETE="complete",wP=th,gs.EventType=ps,ps.OPEN="a",ps.CLOSE="b",ps.ERROR="c",ps.MESSAGE="d",Qi.prototype.listen=Qi.prototype.J,fv=gs,Sr.prototype.listenOnce=Sr.prototype.K,Sr.prototype.getLastError=Sr.prototype.Ha,Sr.prototype.getLastErrorCode=Sr.prototype.ya,Sr.prototype.getStatus=Sr.prototype.ca,Sr.prototype.getResponseJson=Sr.prototype.La,Sr.prototype.getResponseText=Sr.prototype.la,Sr.prototype.send=Sr.prototype.ea,Sr.prototype.setWithCredentials=Sr.prototype.Fa,bP=Sr}).apply(typeof yb<"u"?yb:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Sl.UNAUTHENTICATED=new Sl(null),Sl.GOOGLE_CREDENTIALS=new Sl("google-credentials-uid"),Sl.FIRST_PARTY=new Sl("first-party-uid"),Sl.MOCK_USER=new Sl("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hy="12.8.0";function UV(o){Hy=o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_=new WE("@firebase/firestore");function _y(){return a_.logLevel}function Xn(o,...t){if(a_.logLevel<=Mr.DEBUG){const a=t.map(oS);a_.debug(`Firestore (${Hy}): ${o}`,...a)}}function bp(o,...t){if(a_.logLevel<=Mr.ERROR){const a=t.map(oS);a_.error(`Firestore (${Hy}): ${o}`,...a)}}function Py(o,...t){if(a_.logLevel<=Mr.WARN){const a=t.map(oS);a_.warn(`Firestore (${Hy}): ${o}`,...a)}}function oS(o){if(typeof o=="string")return o;try{return(function(a){return JSON.stringify(a)})(o)}catch{return o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bi(o,t,a){let u="Unexpected state";typeof t=="string"?u=t:a=t,AP(o,u,a)}function AP(o,t,a){let u=`FIRESTORE (${Hy}) INTERNAL ASSERTION FAILED: ${t} (ID: ${o.toString(16)})`;if(a!==void 0)try{u+=" CONTEXT: "+JSON.stringify(a)}catch{u+=" CONTEXT: "+a}throw bp(u),new Error(u)}function fs(o,t,a,u){let y="Unexpected state";typeof a=="string"?y=a:u=a,o||AP(t,y,u)}function Ki(o,t){return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $n extends Ep{constructor(t,a){super(t,a),this.code=t,this.message=a,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(){this.promise=new Promise(((t,a)=>{this.resolve=t,this.reject=a}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(t,a){this.user=a,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class GV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,a){t.enqueueRetryable((()=>a(Sl.UNAUTHENTICATED)))}shutdown(){}}class qV{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,a){this.changeListener=a,t.enqueueRetryable((()=>a(this.token.user)))}shutdown(){this.changeListener=null}}class HV{constructor(t){this.t=t,this.currentUser=Sl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,a){fs(this.o===void 0,42304);let u=this.i;const y=B=>this.i!==u?(u=this.i,a(B)):Promise.resolve();let T=new Om;this.o=()=>{this.i++,this.currentUser=this.u(),T.resolve(),T=new Om,t.enqueueRetryable((()=>y(this.currentUser)))};const C=()=>{const B=T;t.enqueueRetryable((async()=>{await B.promise,await y(this.currentUser)}))},s=B=>{Xn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=B,this.o&&(this.auth.addAuthTokenListener(this.o),C())};this.t.onInit((B=>s(B))),setTimeout((()=>{if(!this.auth){const B=this.t.getImmediate({optional:!0});B?s(B):(Xn("FirebaseAuthCredentialsProvider","Auth not yet detected"),T.resolve(),T=new Om)}}),0),C()}getToken(){const t=this.i,a=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(a).then((u=>this.i!==t?(Xn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):u?(fs(typeof u.accessToken=="string",31837,{l:u}),new IP(u.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return fs(t===null||typeof t=="string",2055,{h:t}),new Sl(t)}}class $V{constructor(t,a,u){this.P=t,this.T=a,this.I=u,this.type="FirstParty",this.user=Sl.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class ZV{constructor(t,a,u){this.P=t,this.T=a,this.I=u}getToken(){return Promise.resolve(new $V(this.P,this.T,this.I))}start(t,a){t.enqueueRetryable((()=>a(Sl.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class oR{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class WV{constructor(t,a){this.V=a,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Xh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,a){fs(this.o===void 0,3512);const u=T=>{T.error!=null&&Xn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${T.error.message}`);const C=T.token!==this.m;return this.m=T.token,Xn("FirebaseAppCheckTokenProvider",`Received ${C?"new":"existing"} token.`),C?a(T.token):Promise.resolve()};this.o=T=>{t.enqueueRetryable((()=>u(T)))};const y=T=>{Xn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=T,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((T=>y(T))),setTimeout((()=>{if(!this.appCheck){const T=this.V.getImmediate({optional:!0});T?y(T):Xn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new oR(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((a=>a?(fs(typeof a.token=="string",44558,{tokenResult:a}),this.m=a.token,new oR(a.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XV(o){const t=typeof self<"u"&&(self.crypto||self.msCrypto),a=new Uint8Array(o);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(a);else for(let u=0;u<o;u++)a[u]=Math.floor(256*Math.random());return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=62*Math.floor(4.129032258064516);let u="";for(;u.length<20;){const y=XV(40);for(let T=0;T<y.length;++T)u.length<20&&y[T]<a&&(u+=t.charAt(y[T]%62))}return u}}function Dr(o,t){return o<t?-1:o>t?1:0}function oE(o,t){const a=Math.min(o.length,t.length);for(let u=0;u<a;u++){const y=o.charAt(u),T=t.charAt(u);if(y!==T)return ST(y)===ST(T)?Dr(y,T):ST(y)?1:-1}return Dr(o.length,t.length)}const YV=55296,KV=57343;function ST(o){const t=o.charCodeAt(0);return t>=YV&&t<=KV}function ky(o,t,a){return o.length===t.length&&o.every(((u,y)=>a(u,t[y])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR="__name__";class Jd{constructor(t,a,u){a===void 0?a=0:a>t.length&&Bi(637,{offset:a,range:t.length}),u===void 0?u=t.length-a:u>t.length-a&&Bi(1746,{length:u,range:t.length-a}),this.segments=t,this.offset=a,this.len=u}get length(){return this.len}isEqual(t){return Jd.comparator(this,t)===0}child(t){const a=this.segments.slice(this.offset,this.limit());return t instanceof Jd?t.forEach((u=>{a.push(u)})):a.push(t),this.construct(a)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==t.get(a))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==t.get(a))return!1;return!0}forEach(t){for(let a=this.offset,u=this.limit();a<u;a++)t(this.segments[a])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,a){const u=Math.min(t.length,a.length);for(let y=0;y<u;y++){const T=Jd.compareSegments(t.get(y),a.get(y));if(T!==0)return T}return Dr(t.length,a.length)}static compareSegments(t,a){const u=Jd.isNumericId(t),y=Jd.isNumericId(a);return u&&!y?-1:!u&&y?1:u&&y?Jd.extractNumericId(t).compare(Jd.extractNumericId(a)):oE(t,a)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return zm.fromString(t.substring(4,t.length-2))}}class Os extends Jd{construct(t,a,u){return new Os(t,a,u)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const a=[];for(const u of t){if(u.indexOf("//")>=0)throw new $n(hn.INVALID_ARGUMENT,`Invalid segment (${u}). Paths must not contain // in them.`);a.push(...u.split("/").filter((y=>y.length>0)))}return new Os(a)}static emptyPath(){return new Os([])}}const QV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ol extends Jd{construct(t,a,u){return new ol(t,a,u)}static isValidIdentifier(t){return QV.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ol.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===lR}static keyField(){return new ol([lR])}static fromServerFormat(t){const a=[];let u="",y=0;const T=()=>{if(u.length===0)throw new $n(hn.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);a.push(u),u=""};let C=!1;for(;y<t.length;){const s=t[y];if(s==="\\"){if(y+1===t.length)throw new $n(hn.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const B=t[y+1];if(B!=="\\"&&B!=="."&&B!=="`")throw new $n(hn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);u+=B,y+=2}else s==="`"?(C=!C,y++):s!=="."||C?(u+=s,y++):(T(),y++)}if(T(),C)throw new $n(hn.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ol(a)}static emptyPath(){return new ol([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(t){this.path=t}static fromPath(t){return new vi(Os.fromString(t))}static fromName(t){return new vi(Os.fromString(t).popFirst(5))}static empty(){return new vi(Os.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Os.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,a){return Os.comparator(t.path,a.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new vi(new Os(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(o,t,a){if(!a)throw new $n(hn.INVALID_ARGUMENT,`Function ${o}() cannot be called with an empty ${t}.`)}function JV(o,t,a,u){if(t===!0&&u===!0)throw new $n(hn.INVALID_ARGUMENT,`${o} and ${a} cannot be used together.`)}function cR(o){if(!vi.isDocumentKey(o))throw new $n(hn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${o} has ${o.length}.`)}function uR(o){if(vi.isDocumentKey(o))throw new $n(hn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${o} has ${o.length}.`)}function RP(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}function w1(o){if(o===void 0)return"undefined";if(o===null)return"null";if(typeof o=="string")return o.length>20&&(o=`${o.substring(0,20)}...`),JSON.stringify(o);if(typeof o=="number"||typeof o=="boolean")return""+o;if(typeof o=="object"){if(o instanceof Array)return"an array";{const t=(function(u){return u.constructor?u.constructor.name:null})(o);return t?`a custom ${t} object`:"an object"}}return typeof o=="function"?"a function":Bi(12329,{type:typeof o})}function _p(o,t){if("_delegate"in o&&(o=o._delegate),!(o instanceof t)){if(t.name===o.constructor.name)throw new $n(hn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const a=w1(o);throw new $n(hn.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${a}`)}}return o}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(o,t){const a={typeString:o};return t&&(a.value=t),a}function Zv(o,t){if(!RP(o))throw new $n(hn.INVALID_ARGUMENT,"JSON must be an object");let a;for(const u in t)if(t[u]){const y=t[u].typeString,T="value"in t[u]?{value:t[u].value}:void 0;if(!(u in o)){a=`JSON missing required field: '${u}'`;break}const C=o[u];if(y&&typeof C!==y){a=`JSON field '${u}' must be a ${y}.`;break}if(T!==void 0&&C!==T.value){a=`Expected '${u}' field to equal '${T.value}'`;break}}if(a)throw new $n(hn.INVALID_ARGUMENT,a);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR=-62135596800,dR=1e6;class Ws{static now(){return Ws.fromMillis(Date.now())}static fromDate(t){return Ws.fromMillis(t.getTime())}static fromMillis(t){const a=Math.floor(t/1e3),u=Math.floor((t-1e3*a)*dR);return new Ws(a,u)}constructor(t,a){if(this.seconds=t,this.nanoseconds=a,a<0)throw new $n(hn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(a>=1e9)throw new $n(hn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(t<hR)throw new $n(hn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new $n(hn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/dR}_compareTo(t){return this.seconds===t.seconds?Dr(this.nanoseconds,t.nanoseconds):Dr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ws._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Zv(t,Ws._jsonSchema))return new Ws(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-hR;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ws._jsonSchemaVersion="firestore/timestamp/1.0",Ws._jsonSchema={type:eo("string",Ws._jsonSchemaVersion),seconds:eo("number"),nanoseconds:eo("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{static fromTimestamp(t){return new Wi(t)}static min(){return new Wi(new Ws(0,0))}static max(){return new Wi(new Ws(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mv=-1;function ej(o,t){const a=o.toTimestamp().seconds,u=o.toTimestamp().nanoseconds+1,y=Wi.fromTimestamp(u===1e9?new Ws(a+1,0):new Ws(a,u));return new Fm(y,vi.empty(),t)}function tj(o){return new Fm(o.readTime,o.key,Mv)}class Fm{constructor(t,a,u){this.readTime=t,this.documentKey=a,this.largestBatchId=u}static min(){return new Fm(Wi.min(),vi.empty(),Mv)}static max(){return new Fm(Wi.max(),vi.empty(),Mv)}}function nj(o,t){let a=o.readTime.compareTo(t.readTime);return a!==0?a:(a=vi.comparator(o.documentKey,t.documentKey),a!==0?a:Dr(o.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ij="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rj{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $y(o){if(o.code!==hn.FAILED_PRECONDITION||o.message!==ij)throw o;Xn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)}),(a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)}))}catch(t){return this.next(void 0,t)}next(t,a){return this.callbackAttached&&Bi(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(a,this.error):this.wrapSuccess(t,this.result):new pn(((u,y)=>{this.nextCallback=T=>{this.wrapSuccess(t,T).next(u,y)},this.catchCallback=T=>{this.wrapFailure(a,T).next(u,y)}}))}toPromise(){return new Promise(((t,a)=>{this.next(t,a)}))}wrapUserFunction(t){try{const a=t();return a instanceof pn?a:pn.resolve(a)}catch(a){return pn.reject(a)}}wrapSuccess(t,a){return t?this.wrapUserFunction((()=>t(a))):pn.resolve(a)}wrapFailure(t,a){return t?this.wrapUserFunction((()=>t(a))):pn.reject(a)}static resolve(t){return new pn(((a,u)=>{a(t)}))}static reject(t){return new pn(((a,u)=>{u(t)}))}static waitFor(t){return new pn(((a,u)=>{let y=0,T=0,C=!1;t.forEach((s=>{++y,s.next((()=>{++T,C&&T===y&&a()}),(B=>u(B)))})),C=!0,T===y&&a()}))}static or(t){let a=pn.resolve(!1);for(const u of t)a=a.next((y=>y?pn.resolve(y):u()));return a}static forEach(t,a){const u=[];return t.forEach(((y,T)=>{u.push(a.call(this,y,T))})),this.waitFor(u)}static mapArray(t,a){return new pn(((u,y)=>{const T=t.length,C=new Array(T);let s=0;for(let B=0;B<T;B++){const V=B;a(t[V]).next((W=>{C[V]=W,++s,s===T&&u(C)}),(W=>y(W)))}}))}static doWhile(t,a){return new pn(((u,y)=>{const T=()=>{t()===!0?a().next((()=>{T()}),y):u()};T()}))}}function sj(o){const t=o.match(/Android ([\d.]+)/i),a=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(a)}function Zy(o){return o.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(t,a){this.previousValue=t,a&&(a.sequenceNumberHandler=u=>this.ae(u),this.ue=u=>a.writeSequenceNumber(u))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}T1.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS=-1;function E1(o){return o==null}function n1(o){return o===0&&1/o==-1/0}function aj(o){return typeof o=="number"&&Number.isInteger(o)&&!n1(o)&&o<=Number.MAX_SAFE_INTEGER&&o>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP="";function oj(o){let t="";for(let a=0;a<o.length;a++)t.length>0&&(t=fR(t)),t=lj(o.get(a),t);return fR(t)}function lj(o,t){let a=t;const u=o.length;for(let y=0;y<u;y++){const T=o.charAt(y);switch(T){case"\0":a+="";break;case MP:a+="";break;default:a+=T}}return a}function fR(o){return o+MP+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pR(o){let t=0;for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&t++;return t}function c_(o,t){for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&t(a,o[a])}function DP(o){for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(t,a){this.comparator=t,this.root=a||al.EMPTY}insert(t,a){return new pa(this.comparator,this.root.insert(t,a,this.comparator).copy(null,null,al.BLACK,null,null))}remove(t){return new pa(this.comparator,this.root.remove(t,this.comparator).copy(null,null,al.BLACK,null,null))}get(t){let a=this.root;for(;!a.isEmpty();){const u=this.comparator(t,a.key);if(u===0)return a.value;u<0?a=a.left:u>0&&(a=a.right)}return null}indexOf(t){let a=0,u=this.root;for(;!u.isEmpty();){const y=this.comparator(t,u.key);if(y===0)return a+u.left.size;y<0?u=u.left:(a+=u.left.size+1,u=u.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((a,u)=>(t(a,u),!1)))}toString(){const t=[];return this.inorderTraversal(((a,u)=>(t.push(`${a}:${u}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new xb(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new xb(this.root,t,this.comparator,!1)}getReverseIterator(){return new xb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new xb(this.root,t,this.comparator,!0)}}class xb{constructor(t,a,u,y){this.isReverse=y,this.nodeStack=[];let T=1;for(;!t.isEmpty();)if(T=a?u(t.key,a):1,a&&y&&(T*=-1),T<0)t=this.isReverse?t.left:t.right;else{if(T===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const a={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return a}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class al{constructor(t,a,u,y,T){this.key=t,this.value=a,this.color=u??al.RED,this.left=y??al.EMPTY,this.right=T??al.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,a,u,y,T){return new al(t??this.key,a??this.value,u??this.color,y??this.left,T??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,a,u){let y=this;const T=u(t,y.key);return y=T<0?y.copy(null,null,null,y.left.insert(t,a,u),null):T===0?y.copy(null,a,null,null,null):y.copy(null,null,null,null,y.right.insert(t,a,u)),y.fixUp()}removeMin(){if(this.left.isEmpty())return al.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,a){let u,y=this;if(a(t,y.key)<0)y.left.isEmpty()||y.left.isRed()||y.left.left.isRed()||(y=y.moveRedLeft()),y=y.copy(null,null,null,y.left.remove(t,a),null);else{if(y.left.isRed()&&(y=y.rotateRight()),y.right.isEmpty()||y.right.isRed()||y.right.left.isRed()||(y=y.moveRedRight()),a(t,y.key)===0){if(y.right.isEmpty())return al.EMPTY;u=y.right.min(),y=y.copy(u.key,u.value,null,null,y.right.removeMin())}y=y.copy(null,null,null,null,y.right.remove(t,a))}return y.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,al.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,al.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),a=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,a)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Bi(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Bi(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Bi(27949);return t+(this.isRed()?0:1)}}al.EMPTY=null,al.RED=!0,al.BLACK=!1;al.EMPTY=new class{constructor(){this.size=0}get key(){throw Bi(57766)}get value(){throw Bi(16141)}get color(){throw Bi(16727)}get left(){throw Bi(29726)}get right(){throw Bi(36894)}copy(t,a,u,y,T){return this}insert(t,a,u){return new al(t,a)}remove(t,a){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(t){this.comparator=t,this.data=new pa(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((a,u)=>(t(a),!1)))}forEachInRange(t,a){const u=this.data.getIteratorFrom(t[0]);for(;u.hasNext();){const y=u.getNext();if(this.comparator(y.key,t[1])>=0)return;a(y.key)}}forEachWhile(t,a){let u;for(u=a!==void 0?this.data.getIteratorFrom(a):this.data.getIterator();u.hasNext();)if(!t(u.getNext().key))return}firstAfterOrEqual(t){const a=this.data.getIteratorFrom(t);return a.hasNext()?a.getNext().key:null}getIterator(){return new mR(this.data.getIterator())}getIteratorFrom(t){return new mR(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let a=this;return a.size<t.size&&(a=t,t=this),t.forEach((u=>{a=a.add(u)})),a}isEqual(t){if(!(t instanceof vo)||this.size!==t.size)return!1;const a=this.data.getIterator(),u=t.data.getIterator();for(;a.hasNext();){const y=a.getNext().key,T=u.getNext().key;if(this.comparator(y,T)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((a=>{t.push(a)})),t}toString(){const t=[];return this.forEach((a=>t.push(a))),"SortedSet("+t.toString()+")"}copy(t){const a=new vo(this.comparator);return a.data=t,a}}class mR{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(t){this.fields=t,t.sort(ol.comparator)}static empty(){return new Kh([])}unionWith(t){let a=new vo(ol.comparator);for(const u of this.fields)a=a.add(u);for(const u of t)a=a.add(u);return new Kh(a.toArray())}covers(t){for(const a of this.fields)if(a.isPrefixOf(t))return!0;return!1}isEqual(t){return ky(this.fields,t.fields,((a,u)=>a.isEqual(u)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(t){this.binaryString=t}static fromBase64String(t){const a=(function(y){try{return atob(y)}catch(T){throw typeof DOMException<"u"&&T instanceof DOMException?new PP("Invalid base64 string: "+T):T}})(t);return new ll(a)}static fromUint8Array(t){const a=(function(y){let T="";for(let C=0;C<y.length;++C)T+=String.fromCharCode(y[C]);return T})(t);return new ll(a)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(a){return btoa(a)})(this.binaryString)}toUint8Array(){return(function(a){const u=new Uint8Array(a.length);for(let y=0;y<a.length;y++)u[y]=a.charCodeAt(y);return u})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Dr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ll.EMPTY_BYTE_STRING=new ll("");const cj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vm(o){if(fs(!!o,39018),typeof o=="string"){let t=0;const a=cj.exec(o);if(fs(!!a,46558,{timestamp:o}),a[1]){let y=a[1];y=(y+"000000000").substr(0,9),t=Number(y)}const u=new Date(o);return{seconds:Math.floor(u.getTime()/1e3),nanos:t}}return{seconds:Ba(o.seconds),nanos:Ba(o.nanos)}}function Ba(o){return typeof o=="number"?o:typeof o=="string"?Number(o):0}function jm(o){return typeof o=="string"?ll.fromBase64String(o):ll.fromUint8Array(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP="server_timestamp",LP="__type__",zP="__previous_value__",OP="__local_write_time__";function uS(o){var a,u;return((u=(((a=o==null?void 0:o.mapValue)==null?void 0:a.fields)||{})[LP])==null?void 0:u.stringValue)===kP}function S1(o){const t=o.mapValue.fields[zP];return uS(t)?S1(t):t}function Dv(o){const t=Vm(o.mapValue.fields[OP].timestampValue);return new Ws(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(t,a,u,y,T,C,s,B,V,W,Q){this.databaseId=t,this.appId=a,this.persistenceKey=u,this.host=y,this.ssl=T,this.forceLongPolling=C,this.autoDetectLongPolling=s,this.longPollingOptions=B,this.useFetchStreams=V,this.isUsingEmulator=W,this.apiKey=Q}}const i1="(default)";class Pv{constructor(t,a){this.projectId=t,this.database=a||i1}static empty(){return new Pv("","")}get isDefaultDatabase(){return this.database===i1}isEqual(t){return t instanceof Pv&&t.projectId===this.projectId&&t.database===this.database}}function hj(o,t){if(!Object.prototype.hasOwnProperty.apply(o.options,["projectId"]))throw new $n(hn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pv(o.options.projectId,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP="__type__",dj="__max__",vb={mapValue:{}},BP="__vector__",r1="value";function Um(o){return"nullValue"in o?0:"booleanValue"in o?1:"integerValue"in o||"doubleValue"in o?2:"timestampValue"in o?3:"stringValue"in o?5:"bytesValue"in o?6:"referenceValue"in o?7:"geoPointValue"in o?8:"arrayValue"in o?9:"mapValue"in o?uS(o)?4:pj(o)?9007199254740991:fj(o)?10:11:Bi(28295,{value:o})}function lf(o,t){if(o===t)return!0;const a=Um(o);if(a!==Um(t))return!1;switch(a){case 0:case 9007199254740991:return!0;case 1:return o.booleanValue===t.booleanValue;case 4:return Dv(o).isEqual(Dv(t));case 3:return(function(y,T){if(typeof y.timestampValue=="string"&&typeof T.timestampValue=="string"&&y.timestampValue.length===T.timestampValue.length)return y.timestampValue===T.timestampValue;const C=Vm(y.timestampValue),s=Vm(T.timestampValue);return C.seconds===s.seconds&&C.nanos===s.nanos})(o,t);case 5:return o.stringValue===t.stringValue;case 6:return(function(y,T){return jm(y.bytesValue).isEqual(jm(T.bytesValue))})(o,t);case 7:return o.referenceValue===t.referenceValue;case 8:return(function(y,T){return Ba(y.geoPointValue.latitude)===Ba(T.geoPointValue.latitude)&&Ba(y.geoPointValue.longitude)===Ba(T.geoPointValue.longitude)})(o,t);case 2:return(function(y,T){if("integerValue"in y&&"integerValue"in T)return Ba(y.integerValue)===Ba(T.integerValue);if("doubleValue"in y&&"doubleValue"in T){const C=Ba(y.doubleValue),s=Ba(T.doubleValue);return C===s?n1(C)===n1(s):isNaN(C)&&isNaN(s)}return!1})(o,t);case 9:return ky(o.arrayValue.values||[],t.arrayValue.values||[],lf);case 10:case 11:return(function(y,T){const C=y.mapValue.fields||{},s=T.mapValue.fields||{};if(pR(C)!==pR(s))return!1;for(const B in C)if(C.hasOwnProperty(B)&&(s[B]===void 0||!lf(C[B],s[B])))return!1;return!0})(o,t);default:return Bi(52216,{left:o})}}function kv(o,t){return(o.values||[]).find((a=>lf(a,t)))!==void 0}function Ly(o,t){if(o===t)return 0;const a=Um(o),u=Um(t);if(a!==u)return Dr(a,u);switch(a){case 0:case 9007199254740991:return 0;case 1:return Dr(o.booleanValue,t.booleanValue);case 2:return(function(T,C){const s=Ba(T.integerValue||T.doubleValue),B=Ba(C.integerValue||C.doubleValue);return s<B?-1:s>B?1:s===B?0:isNaN(s)?isNaN(B)?0:-1:1})(o,t);case 3:return gR(o.timestampValue,t.timestampValue);case 4:return gR(Dv(o),Dv(t));case 5:return oE(o.stringValue,t.stringValue);case 6:return(function(T,C){const s=jm(T),B=jm(C);return s.compareTo(B)})(o.bytesValue,t.bytesValue);case 7:return(function(T,C){const s=T.split("/"),B=C.split("/");for(let V=0;V<s.length&&V<B.length;V++){const W=Dr(s[V],B[V]);if(W!==0)return W}return Dr(s.length,B.length)})(o.referenceValue,t.referenceValue);case 8:return(function(T,C){const s=Dr(Ba(T.latitude),Ba(C.latitude));return s!==0?s:Dr(Ba(T.longitude),Ba(C.longitude))})(o.geoPointValue,t.geoPointValue);case 9:return _R(o.arrayValue,t.arrayValue);case 10:return(function(T,C){var oe,he,Je,Ye;const s=T.fields||{},B=C.fields||{},V=(oe=s[r1])==null?void 0:oe.arrayValue,W=(he=B[r1])==null?void 0:he.arrayValue,Q=Dr(((Je=V==null?void 0:V.values)==null?void 0:Je.length)||0,((Ye=W==null?void 0:W.values)==null?void 0:Ye.length)||0);return Q!==0?Q:_R(V,W)})(o.mapValue,t.mapValue);case 11:return(function(T,C){if(T===vb.mapValue&&C===vb.mapValue)return 0;if(T===vb.mapValue)return 1;if(C===vb.mapValue)return-1;const s=T.fields||{},B=Object.keys(s),V=C.fields||{},W=Object.keys(V);B.sort(),W.sort();for(let Q=0;Q<B.length&&Q<W.length;++Q){const oe=oE(B[Q],W[Q]);if(oe!==0)return oe;const he=Ly(s[B[Q]],V[W[Q]]);if(he!==0)return he}return Dr(B.length,W.length)})(o.mapValue,t.mapValue);default:throw Bi(23264,{he:a})}}function gR(o,t){if(typeof o=="string"&&typeof t=="string"&&o.length===t.length)return Dr(o,t);const a=Vm(o),u=Vm(t),y=Dr(a.seconds,u.seconds);return y!==0?y:Dr(a.nanos,u.nanos)}function _R(o,t){const a=o.values||[],u=t.values||[];for(let y=0;y<a.length&&y<u.length;++y){const T=Ly(a[y],u[y]);if(T)return T}return Dr(a.length,u.length)}function zy(o){return lE(o)}function lE(o){return"nullValue"in o?"null":"booleanValue"in o?""+o.booleanValue:"integerValue"in o?""+o.integerValue:"doubleValue"in o?""+o.doubleValue:"timestampValue"in o?(function(a){const u=Vm(a);return`time(${u.seconds},${u.nanos})`})(o.timestampValue):"stringValue"in o?o.stringValue:"bytesValue"in o?(function(a){return jm(a).toBase64()})(o.bytesValue):"referenceValue"in o?(function(a){return vi.fromName(a).toString()})(o.referenceValue):"geoPointValue"in o?(function(a){return`geo(${a.latitude},${a.longitude})`})(o.geoPointValue):"arrayValue"in o?(function(a){let u="[",y=!0;for(const T of a.values||[])y?y=!1:u+=",",u+=lE(T);return u+"]"})(o.arrayValue):"mapValue"in o?(function(a){const u=Object.keys(a.fields||{}).sort();let y="{",T=!0;for(const C of u)T?T=!1:y+=",",y+=`${C}:${lE(a.fields[C])}`;return y+"}"})(o.mapValue):Bi(61005,{value:o})}function zb(o){switch(Um(o)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=S1(o);return t?16+zb(t):16;case 5:return 2*o.stringValue.length;case 6:return jm(o.bytesValue).approximateByteSize();case 7:return o.referenceValue.length;case 9:return(function(u){return(u.values||[]).reduce(((y,T)=>y+zb(T)),0)})(o.arrayValue);case 10:case 11:return(function(u){let y=0;return c_(u.fields,((T,C)=>{y+=T.length+zb(C)})),y})(o.mapValue);default:throw Bi(13486,{value:o})}}function yR(o,t){return{referenceValue:`projects/${o.projectId}/databases/${o.database}/documents/${t.path.canonicalString()}`}}function cE(o){return!!o&&"integerValue"in o}function hS(o){return!!o&&"arrayValue"in o}function xR(o){return!!o&&"nullValue"in o}function vR(o){return!!o&&"doubleValue"in o&&isNaN(Number(o.doubleValue))}function Ob(o){return!!o&&"mapValue"in o}function fj(o){var a,u;return((u=(((a=o==null?void 0:o.mapValue)==null?void 0:a.fields)||{})[NP])==null?void 0:u.stringValue)===BP}function vv(o){if(o.geoPointValue)return{geoPointValue:{...o.geoPointValue}};if(o.timestampValue&&typeof o.timestampValue=="object")return{timestampValue:{...o.timestampValue}};if(o.mapValue){const t={mapValue:{fields:{}}};return c_(o.mapValue.fields,((a,u)=>t.mapValue.fields[a]=vv(u))),t}if(o.arrayValue){const t={arrayValue:{values:[]}};for(let a=0;a<(o.arrayValue.values||[]).length;++a)t.arrayValue.values[a]=vv(o.arrayValue.values[a]);return t}return{...o}}function pj(o){return(((o.mapValue||{}).fields||{}).__type__||{}).stringValue===dj}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(t){this.value=t}static empty(){return new Qu({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let a=this.value;for(let u=0;u<t.length-1;++u)if(a=(a.mapValue.fields||{})[t.get(u)],!Ob(a))return null;return a=(a.mapValue.fields||{})[t.lastSegment()],a||null}}set(t,a){this.getFieldsMap(t.popLast())[t.lastSegment()]=vv(a)}setAll(t){let a=ol.emptyPath(),u={},y=[];t.forEach(((C,s)=>{if(!a.isImmediateParentOf(s)){const B=this.getFieldsMap(a);this.applyChanges(B,u,y),u={},y=[],a=s.popLast()}C?u[s.lastSegment()]=vv(C):y.push(s.lastSegment())}));const T=this.getFieldsMap(a);this.applyChanges(T,u,y)}delete(t){const a=this.field(t.popLast());Ob(a)&&a.mapValue.fields&&delete a.mapValue.fields[t.lastSegment()]}isEqual(t){return lf(this.value,t.value)}getFieldsMap(t){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let u=0;u<t.length;++u){let y=a.mapValue.fields[t.get(u)];Ob(y)&&y.mapValue.fields||(y={mapValue:{fields:{}}},a.mapValue.fields[t.get(u)]=y),a=y}return a.mapValue.fields}applyChanges(t,a,u){c_(a,((y,T)=>t[y]=T));for(const y of u)delete t[y]}clone(){return new Qu(vv(this.value))}}function FP(o){const t=[];return c_(o.fields,((a,u)=>{const y=new ol([a]);if(Ob(u)){const T=FP(u.mapValue).fields;if(T.length===0)t.push(y);else for(const C of T)t.push(y.child(C))}else t.push(y)})),new Kh(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(t,a,u,y,T,C,s){this.key=t,this.documentType=a,this.version=u,this.readTime=y,this.createTime=T,this.data=C,this.documentState=s}static newInvalidDocument(t){return new Al(t,0,Wi.min(),Wi.min(),Wi.min(),Qu.empty(),0)}static newFoundDocument(t,a,u,y){return new Al(t,1,a,Wi.min(),u,y,0)}static newNoDocument(t,a){return new Al(t,2,a,Wi.min(),Wi.min(),Qu.empty(),0)}static newUnknownDocument(t,a){return new Al(t,3,a,Wi.min(),Wi.min(),Qu.empty(),2)}convertToFoundDocument(t,a){return!this.createTime.isEqual(Wi.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=a,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Qu.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Qu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Wi.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Al&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Al(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(t,a){this.position=t,this.inclusive=a}}function bR(o,t,a){let u=0;for(let y=0;y<o.position.length;y++){const T=t[y],C=o.position[y];if(T.field.isKeyField()?u=vi.comparator(vi.fromName(C.referenceValue),a.key):u=Ly(C,a.data.field(T.field)),T.dir==="desc"&&(u*=-1),u!==0)break}return u}function wR(o,t){if(o===null)return t===null;if(t===null||o.inclusive!==t.inclusive||o.position.length!==t.position.length)return!1;for(let a=0;a<o.position.length;a++)if(!lf(o.position[a],t.position[a]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(t,a="asc"){this.field=t,this.dir=a}}function mj(o,t){return o.dir===t.dir&&o.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{}class Ja extends VP{constructor(t,a,u){super(),this.field=t,this.op=a,this.value=u}static create(t,a,u){return t.isKeyField()?a==="in"||a==="not-in"?this.createKeyFieldInFilter(t,a,u):new _j(t,a,u):a==="array-contains"?new vj(t,u):a==="in"?new bj(t,u):a==="not-in"?new wj(t,u):a==="array-contains-any"?new Tj(t,u):new Ja(t,a,u)}static createKeyFieldInFilter(t,a,u){return a==="in"?new yj(t,u):new xj(t,u)}matches(t){const a=t.data.field(this.field);return this.op==="!="?a!==null&&a.nullValue===void 0&&this.matchesComparison(Ly(a,this.value)):a!==null&&Um(this.value)===Um(a)&&this.matchesComparison(Ly(a,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Bi(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ed extends VP{constructor(t,a){super(),this.filters=t,this.op=a,this.Pe=null}static create(t,a){return new ed(t,a)}matches(t){return jP(this)?this.filters.find((a=>!a.matches(t)))===void 0:this.filters.find((a=>a.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,a)=>t.concat(a.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function jP(o){return o.op==="and"}function UP(o){return gj(o)&&jP(o)}function gj(o){for(const t of o.filters)if(t instanceof ed)return!1;return!0}function uE(o){if(o instanceof Ja)return o.field.canonicalString()+o.op.toString()+zy(o.value);if(UP(o))return o.filters.map((t=>uE(t))).join(",");{const t=o.filters.map((a=>uE(a))).join(",");return`${o.op}(${t})`}}function GP(o,t){return o instanceof Ja?(function(u,y){return y instanceof Ja&&u.op===y.op&&u.field.isEqual(y.field)&&lf(u.value,y.value)})(o,t):o instanceof ed?(function(u,y){return y instanceof ed&&u.op===y.op&&u.filters.length===y.filters.length?u.filters.reduce(((T,C,s)=>T&&GP(C,y.filters[s])),!0):!1})(o,t):void Bi(19439)}function qP(o){return o instanceof Ja?(function(a){return`${a.field.canonicalString()} ${a.op} ${zy(a.value)}`})(o):o instanceof ed?(function(a){return a.op.toString()+" {"+a.getFilters().map(qP).join(" ,")+"}"})(o):"Filter"}class _j extends Ja{constructor(t,a,u){super(t,a,u),this.key=vi.fromName(u.referenceValue)}matches(t){const a=vi.comparator(t.key,this.key);return this.matchesComparison(a)}}class yj extends Ja{constructor(t,a){super(t,"in",a),this.keys=HP("in",a)}matches(t){return this.keys.some((a=>a.isEqual(t.key)))}}class xj extends Ja{constructor(t,a){super(t,"not-in",a),this.keys=HP("not-in",a)}matches(t){return!this.keys.some((a=>a.isEqual(t.key)))}}function HP(o,t){var a;return(((a=t.arrayValue)==null?void 0:a.values)||[]).map((u=>vi.fromName(u.referenceValue)))}class vj extends Ja{constructor(t,a){super(t,"array-contains",a)}matches(t){const a=t.data.field(this.field);return hS(a)&&kv(a.arrayValue,this.value)}}class bj extends Ja{constructor(t,a){super(t,"in",a)}matches(t){const a=t.data.field(this.field);return a!==null&&kv(this.value.arrayValue,a)}}class wj extends Ja{constructor(t,a){super(t,"not-in",a)}matches(t){if(kv(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=t.data.field(this.field);return a!==null&&a.nullValue===void 0&&!kv(this.value.arrayValue,a)}}class Tj extends Ja{constructor(t,a){super(t,"array-contains-any",a)}matches(t){const a=t.data.field(this.field);return!(!hS(a)||!a.arrayValue.values)&&a.arrayValue.values.some((u=>kv(this.value.arrayValue,u)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(t,a=null,u=[],y=[],T=null,C=null,s=null){this.path=t,this.collectionGroup=a,this.orderBy=u,this.filters=y,this.limit=T,this.startAt=C,this.endAt=s,this.Te=null}}function TR(o,t=null,a=[],u=[],y=null,T=null,C=null){return new Ej(o,t,a,u,y,T,C)}function dS(o){const t=Ki(o);if(t.Te===null){let a=t.path.canonicalString();t.collectionGroup!==null&&(a+="|cg:"+t.collectionGroup),a+="|f:",a+=t.filters.map((u=>uE(u))).join(","),a+="|ob:",a+=t.orderBy.map((u=>(function(T){return T.field.canonicalString()+T.dir})(u))).join(","),E1(t.limit)||(a+="|l:",a+=t.limit),t.startAt&&(a+="|lb:",a+=t.startAt.inclusive?"b:":"a:",a+=t.startAt.position.map((u=>zy(u))).join(",")),t.endAt&&(a+="|ub:",a+=t.endAt.inclusive?"a:":"b:",a+=t.endAt.position.map((u=>zy(u))).join(",")),t.Te=a}return t.Te}function fS(o,t){if(o.limit!==t.limit||o.orderBy.length!==t.orderBy.length)return!1;for(let a=0;a<o.orderBy.length;a++)if(!mj(o.orderBy[a],t.orderBy[a]))return!1;if(o.filters.length!==t.filters.length)return!1;for(let a=0;a<o.filters.length;a++)if(!GP(o.filters[a],t.filters[a]))return!1;return o.collectionGroup===t.collectionGroup&&!!o.path.isEqual(t.path)&&!!wR(o.startAt,t.startAt)&&wR(o.endAt,t.endAt)}function hE(o){return vi.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(t,a=null,u=[],y=[],T=null,C="F",s=null,B=null){this.path=t,this.collectionGroup=a,this.explicitOrderBy=u,this.filters=y,this.limit=T,this.limitType=C,this.startAt=s,this.endAt=B,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Sj(o,t,a,u,y,T,C,s){return new Wy(o,t,a,u,y,T,C,s)}function A1(o){return new Wy(o)}function ER(o){return o.filters.length===0&&o.limit===null&&o.startAt==null&&o.endAt==null&&(o.explicitOrderBy.length===0||o.explicitOrderBy.length===1&&o.explicitOrderBy[0].field.isKeyField())}function Aj(o){return vi.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}function $P(o){return o.collectionGroup!==null}function bv(o){const t=Ki(o);if(t.Ie===null){t.Ie=[];const a=new Set;for(const T of t.explicitOrderBy)t.Ie.push(T),a.add(T.field.canonicalString());const u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(C){let s=new vo(ol.comparator);return C.filters.forEach((B=>{B.getFlattenedFilters().forEach((V=>{V.isInequality()&&(s=s.add(V.field))}))})),s})(t).forEach((T=>{a.has(T.canonicalString())||T.isKeyField()||t.Ie.push(new Lv(T,u))})),a.has(ol.keyField().canonicalString())||t.Ie.push(new Lv(ol.keyField(),u))}return t.Ie}function nf(o){const t=Ki(o);return t.Ee||(t.Ee=Ij(t,bv(o))),t.Ee}function Ij(o,t){if(o.limitType==="F")return TR(o.path,o.collectionGroup,t,o.filters,o.limit,o.startAt,o.endAt);{t=t.map((y=>{const T=y.dir==="desc"?"asc":"desc";return new Lv(y.field,T)}));const a=o.endAt?new s1(o.endAt.position,o.endAt.inclusive):null,u=o.startAt?new s1(o.startAt.position,o.startAt.inclusive):null;return TR(o.path,o.collectionGroup,t,o.filters,o.limit,a,u)}}function dE(o,t){const a=o.filters.concat([t]);return new Wy(o.path,o.collectionGroup,o.explicitOrderBy.slice(),a,o.limit,o.limitType,o.startAt,o.endAt)}function Cj(o,t){const a=o.explicitOrderBy.concat([t]);return new Wy(o.path,o.collectionGroup,a,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)}function fE(o,t,a){return new Wy(o.path,o.collectionGroup,o.explicitOrderBy.slice(),o.filters.slice(),t,a,o.startAt,o.endAt)}function I1(o,t){return fS(nf(o),nf(t))&&o.limitType===t.limitType}function ZP(o){return`${dS(nf(o))}|lt:${o.limitType}`}function yy(o){return`Query(target=${(function(a){let u=a.path.canonicalString();return a.collectionGroup!==null&&(u+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(u+=`, filters: [${a.filters.map((y=>qP(y))).join(", ")}]`),E1(a.limit)||(u+=", limit: "+a.limit),a.orderBy.length>0&&(u+=`, orderBy: [${a.orderBy.map((y=>(function(C){return`${C.field.canonicalString()} (${C.dir})`})(y))).join(", ")}]`),a.startAt&&(u+=", startAt: ",u+=a.startAt.inclusive?"b:":"a:",u+=a.startAt.position.map((y=>zy(y))).join(",")),a.endAt&&(u+=", endAt: ",u+=a.endAt.inclusive?"a:":"b:",u+=a.endAt.position.map((y=>zy(y))).join(",")),`Target(${u})`})(nf(o))}; limitType=${o.limitType})`}function C1(o,t){return t.isFoundDocument()&&(function(u,y){const T=y.key.path;return u.collectionGroup!==null?y.key.hasCollectionId(u.collectionGroup)&&u.path.isPrefixOf(T):vi.isDocumentKey(u.path)?u.path.isEqual(T):u.path.isImmediateParentOf(T)})(o,t)&&(function(u,y){for(const T of bv(u))if(!T.field.isKeyField()&&y.data.field(T.field)===null)return!1;return!0})(o,t)&&(function(u,y){for(const T of u.filters)if(!T.matches(y))return!1;return!0})(o,t)&&(function(u,y){return!(u.startAt&&!(function(C,s,B){const V=bR(C,s,B);return C.inclusive?V<=0:V<0})(u.startAt,bv(u),y)||u.endAt&&!(function(C,s,B){const V=bR(C,s,B);return C.inclusive?V>=0:V>0})(u.endAt,bv(u),y))})(o,t)}function Rj(o){return o.collectionGroup||(o.path.length%2==1?o.path.lastSegment():o.path.get(o.path.length-2))}function WP(o){return(t,a)=>{let u=!1;for(const y of bv(o)){const T=Mj(y,t,a);if(T!==0)return T;u=u||y.field.isKeyField()}return 0}}function Mj(o,t,a){const u=o.field.isKeyField()?vi.comparator(t.key,a.key):(function(T,C,s){const B=C.data.field(T),V=s.data.field(T);return B!==null&&V!==null?Ly(B,V):Bi(42886)})(o.field,t,a);switch(o.dir){case"asc":return u;case"desc":return-1*u;default:return Bi(19790,{direction:o.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(t,a){this.mapKeyFn=t,this.equalsFn=a,this.inner={},this.innerSize=0}get(t){const a=this.mapKeyFn(t),u=this.inner[a];if(u!==void 0){for(const[y,T]of u)if(this.equalsFn(y,t))return T}}has(t){return this.get(t)!==void 0}set(t,a){const u=this.mapKeyFn(t),y=this.inner[u];if(y===void 0)return this.inner[u]=[[t,a]],void this.innerSize++;for(let T=0;T<y.length;T++)if(this.equalsFn(y[T][0],t))return void(y[T]=[t,a]);y.push([t,a]),this.innerSize++}delete(t){const a=this.mapKeyFn(t),u=this.inner[a];if(u===void 0)return!1;for(let y=0;y<u.length;y++)if(this.equalsFn(u[y][0],t))return u.length===1?delete this.inner[a]:u.splice(y,1),this.innerSize--,!0;return!1}forEach(t){c_(this.inner,((a,u)=>{for(const[y,T]of u)t(y,T)}))}isEmpty(){return DP(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dj=new pa(vi.comparator);function wp(){return Dj}const XP=new pa(vi.comparator);function pv(...o){let t=XP;for(const a of o)t=t.insert(a.key,a);return t}function YP(o){let t=XP;return o.forEach(((a,u)=>t=t.insert(a,u.overlayedDocument))),t}function e_(){return wv()}function KP(){return wv()}function wv(){return new u_((o=>o.toString()),((o,t)=>o.isEqual(t)))}const Pj=new pa(vi.comparator),kj=new vo(vi.comparator);function Pr(...o){let t=kj;for(const a of o)t=t.add(a);return t}const Lj=new vo(Dr);function zj(){return Lj}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pS(o,t){if(o.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:n1(t)?"-0":t}}function QP(o){return{integerValue:""+o}}function Oj(o,t){return aj(t)?QP(t):pS(o,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(){this._=void 0}}function Nj(o,t,a){return o instanceof zv?(function(y,T){const C={fields:{[LP]:{stringValue:kP},[OP]:{timestampValue:{seconds:y.seconds,nanos:y.nanoseconds}}}};return T&&uS(T)&&(T=S1(T)),T&&(C.fields[zP]=T),{mapValue:C}})(a,t):o instanceof Ov?ek(o,t):o instanceof Nv?tk(o,t):(function(y,T){const C=JP(y,T),s=SR(C)+SR(y.Ae);return cE(C)&&cE(y.Ae)?QP(s):pS(y.serializer,s)})(o,t)}function Bj(o,t,a){return o instanceof Ov?ek(o,t):o instanceof Nv?tk(o,t):a}function JP(o,t){return o instanceof a1?(function(u){return cE(u)||(function(T){return!!T&&"doubleValue"in T})(u)})(t)?t:{integerValue:0}:null}class zv extends R1{}class Ov extends R1{constructor(t){super(),this.elements=t}}function ek(o,t){const a=nk(t);for(const u of o.elements)a.some((y=>lf(y,u)))||a.push(u);return{arrayValue:{values:a}}}class Nv extends R1{constructor(t){super(),this.elements=t}}function tk(o,t){let a=nk(t);for(const u of o.elements)a=a.filter((y=>!lf(y,u)));return{arrayValue:{values:a}}}class a1 extends R1{constructor(t,a){super(),this.serializer=t,this.Ae=a}}function SR(o){return Ba(o.integerValue||o.doubleValue)}function nk(o){return hS(o)&&o.arrayValue.values?o.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(t,a){this.field=t,this.transform=a}}function Vj(o,t){return o.field.isEqual(t.field)&&(function(u,y){return u instanceof Ov&&y instanceof Ov||u instanceof Nv&&y instanceof Nv?ky(u.elements,y.elements,lf):u instanceof a1&&y instanceof a1?lf(u.Ae,y.Ae):u instanceof zv&&y instanceof zv})(o.transform,t.transform)}class jj{constructor(t,a){this.version=t,this.transformResults=a}}class rf{constructor(t,a){this.updateTime=t,this.exists=a}static none(){return new rf}static exists(t){return new rf(void 0,t)}static updateTime(t){return new rf(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Nb(o,t){return o.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(o.updateTime):o.exists===void 0||o.exists===t.isFoundDocument()}class M1{}function ik(o,t){if(!o.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return o.isNoDocument()?new sk(o.key,rf.none()):new Wv(o.key,o.data,rf.none());{const a=o.data,u=Qu.empty();let y=new vo(ol.comparator);for(let T of t.fields)if(!y.has(T)){let C=a.field(T);C===null&&T.length>1&&(T=T.popLast(),C=a.field(T)),C===null?u.delete(T):u.set(T,C),y=y.add(T)}return new h_(o.key,u,new Kh(y.toArray()),rf.none())}}function Uj(o,t,a){o instanceof Wv?(function(y,T,C){const s=y.value.clone(),B=IR(y.fieldTransforms,T,C.transformResults);s.setAll(B),T.convertToFoundDocument(C.version,s).setHasCommittedMutations()})(o,t,a):o instanceof h_?(function(y,T,C){if(!Nb(y.precondition,T))return void T.convertToUnknownDocument(C.version);const s=IR(y.fieldTransforms,T,C.transformResults),B=T.data;B.setAll(rk(y)),B.setAll(s),T.convertToFoundDocument(C.version,B).setHasCommittedMutations()})(o,t,a):(function(y,T,C){T.convertToNoDocument(C.version).setHasCommittedMutations()})(0,t,a)}function Tv(o,t,a,u){return o instanceof Wv?(function(T,C,s,B){if(!Nb(T.precondition,C))return s;const V=T.value.clone(),W=CR(T.fieldTransforms,B,C);return V.setAll(W),C.convertToFoundDocument(C.version,V).setHasLocalMutations(),null})(o,t,a,u):o instanceof h_?(function(T,C,s,B){if(!Nb(T.precondition,C))return s;const V=CR(T.fieldTransforms,B,C),W=C.data;return W.setAll(rk(T)),W.setAll(V),C.convertToFoundDocument(C.version,W).setHasLocalMutations(),s===null?null:s.unionWith(T.fieldMask.fields).unionWith(T.fieldTransforms.map((Q=>Q.field)))})(o,t,a,u):(function(T,C,s){return Nb(T.precondition,C)?(C.convertToNoDocument(C.version).setHasLocalMutations(),null):s})(o,t,a)}function Gj(o,t){let a=null;for(const u of o.fieldTransforms){const y=t.data.field(u.field),T=JP(u.transform,y||null);T!=null&&(a===null&&(a=Qu.empty()),a.set(u.field,T))}return a||null}function AR(o,t){return o.type===t.type&&!!o.key.isEqual(t.key)&&!!o.precondition.isEqual(t.precondition)&&!!(function(u,y){return u===void 0&&y===void 0||!(!u||!y)&&ky(u,y,((T,C)=>Vj(T,C)))})(o.fieldTransforms,t.fieldTransforms)&&(o.type===0?o.value.isEqual(t.value):o.type!==1||o.data.isEqual(t.data)&&o.fieldMask.isEqual(t.fieldMask))}class Wv extends M1{constructor(t,a,u,y=[]){super(),this.key=t,this.value=a,this.precondition=u,this.fieldTransforms=y,this.type=0}getFieldMask(){return null}}class h_ extends M1{constructor(t,a,u,y,T=[]){super(),this.key=t,this.data=a,this.fieldMask=u,this.precondition=y,this.fieldTransforms=T,this.type=1}getFieldMask(){return this.fieldMask}}function rk(o){const t=new Map;return o.fieldMask.fields.forEach((a=>{if(!a.isEmpty()){const u=o.data.field(a);t.set(a,u)}})),t}function IR(o,t,a){const u=new Map;fs(o.length===a.length,32656,{Ve:a.length,de:o.length});for(let y=0;y<a.length;y++){const T=o[y],C=T.transform,s=t.data.field(T.field);u.set(T.field,Bj(C,s,a[y]))}return u}function CR(o,t,a){const u=new Map;for(const y of o){const T=y.transform,C=a.data.field(y.field);u.set(y.field,Nj(T,C,t))}return u}class sk extends M1{constructor(t,a){super(),this.key=t,this.precondition=a,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qj extends M1{constructor(t,a){super(),this.key=t,this.precondition=a,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hj{constructor(t,a,u,y){this.batchId=t,this.localWriteTime=a,this.baseMutations=u,this.mutations=y}applyToRemoteDocument(t,a){const u=a.mutationResults;for(let y=0;y<this.mutations.length;y++){const T=this.mutations[y];T.key.isEqual(t.key)&&Uj(T,t,u[y])}}applyToLocalView(t,a){for(const u of this.baseMutations)u.key.isEqual(t.key)&&(a=Tv(u,t,a,this.localWriteTime));for(const u of this.mutations)u.key.isEqual(t.key)&&(a=Tv(u,t,a,this.localWriteTime));return a}applyToLocalDocumentSet(t,a){const u=KP();return this.mutations.forEach((y=>{const T=t.get(y.key),C=T.overlayedDocument;let s=this.applyToLocalView(C,T.mutatedFields);s=a.has(y.key)?null:s;const B=ik(C,s);B!==null&&u.set(y.key,B),C.isValidDocument()||C.convertToNoDocument(Wi.min())})),u}keys(){return this.mutations.reduce(((t,a)=>t.add(a.key)),Pr())}isEqual(t){return this.batchId===t.batchId&&ky(this.mutations,t.mutations,((a,u)=>AR(a,u)))&&ky(this.baseMutations,t.baseMutations,((a,u)=>AR(a,u)))}}class mS{constructor(t,a,u,y){this.batch=t,this.commitVersion=a,this.mutationResults=u,this.docVersions=y}static from(t,a,u){fs(t.mutations.length===u.length,58842,{me:t.mutations.length,fe:u.length});let y=(function(){return Pj})();const T=t.mutations;for(let C=0;C<T.length;C++)y=y.insert(T[C].key,u[C].version);return new mS(t,a,u,y)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $j{constructor(t,a){this.largestBatchId=t,this.mutation=a}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(t,a){this.count=t,this.unchangedNames=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ka,Wr;function Wj(o){switch(o){case hn.OK:return Bi(64938);case hn.CANCELLED:case hn.UNKNOWN:case hn.DEADLINE_EXCEEDED:case hn.RESOURCE_EXHAUSTED:case hn.INTERNAL:case hn.UNAVAILABLE:case hn.UNAUTHENTICATED:return!1;case hn.INVALID_ARGUMENT:case hn.NOT_FOUND:case hn.ALREADY_EXISTS:case hn.PERMISSION_DENIED:case hn.FAILED_PRECONDITION:case hn.ABORTED:case hn.OUT_OF_RANGE:case hn.UNIMPLEMENTED:case hn.DATA_LOSS:return!0;default:return Bi(15467,{code:o})}}function ak(o){if(o===void 0)return bp("GRPC error has no .code"),hn.UNKNOWN;switch(o){case Ka.OK:return hn.OK;case Ka.CANCELLED:return hn.CANCELLED;case Ka.UNKNOWN:return hn.UNKNOWN;case Ka.DEADLINE_EXCEEDED:return hn.DEADLINE_EXCEEDED;case Ka.RESOURCE_EXHAUSTED:return hn.RESOURCE_EXHAUSTED;case Ka.INTERNAL:return hn.INTERNAL;case Ka.UNAVAILABLE:return hn.UNAVAILABLE;case Ka.UNAUTHENTICATED:return hn.UNAUTHENTICATED;case Ka.INVALID_ARGUMENT:return hn.INVALID_ARGUMENT;case Ka.NOT_FOUND:return hn.NOT_FOUND;case Ka.ALREADY_EXISTS:return hn.ALREADY_EXISTS;case Ka.PERMISSION_DENIED:return hn.PERMISSION_DENIED;case Ka.FAILED_PRECONDITION:return hn.FAILED_PRECONDITION;case Ka.ABORTED:return hn.ABORTED;case Ka.OUT_OF_RANGE:return hn.OUT_OF_RANGE;case Ka.UNIMPLEMENTED:return hn.UNIMPLEMENTED;case Ka.DATA_LOSS:return hn.DATA_LOSS;default:return Bi(39323,{code:o})}}(Wr=Ka||(Ka={}))[Wr.OK=0]="OK",Wr[Wr.CANCELLED=1]="CANCELLED",Wr[Wr.UNKNOWN=2]="UNKNOWN",Wr[Wr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wr[Wr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wr[Wr.NOT_FOUND=5]="NOT_FOUND",Wr[Wr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wr[Wr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wr[Wr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wr[Wr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wr[Wr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wr[Wr.ABORTED=10]="ABORTED",Wr[Wr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wr[Wr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wr[Wr.INTERNAL=13]="INTERNAL",Wr[Wr.UNAVAILABLE=14]="UNAVAILABLE",Wr[Wr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xj(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yj=new zm([4294967295,4294967295],0);function RR(o){const t=Xj().encode(o),a=new vP;return a.update(t),new Uint8Array(a.digest())}function MR(o){const t=new DataView(o.buffer),a=t.getUint32(0,!0),u=t.getUint32(4,!0),y=t.getUint32(8,!0),T=t.getUint32(12,!0);return[new zm([a,u],0),new zm([y,T],0)]}class gS{constructor(t,a,u){if(this.bitmap=t,this.padding=a,this.hashCount=u,a<0||a>=8)throw new mv(`Invalid padding: ${a}`);if(u<0)throw new mv(`Invalid hash count: ${u}`);if(t.length>0&&this.hashCount===0)throw new mv(`Invalid hash count: ${u}`);if(t.length===0&&a!==0)throw new mv(`Invalid padding when bitmap length is 0: ${a}`);this.ge=8*t.length-a,this.pe=zm.fromNumber(this.ge)}ye(t,a,u){let y=t.add(a.multiply(zm.fromNumber(u)));return y.compare(Yj)===1&&(y=new zm([y.getBits(0),y.getBits(1)],0)),y.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const a=RR(t),[u,y]=MR(a);for(let T=0;T<this.hashCount;T++){const C=this.ye(u,y,T);if(!this.we(C))return!1}return!0}static create(t,a,u){const y=t%8==0?0:8-t%8,T=new Uint8Array(Math.ceil(t/8)),C=new gS(T,y,a);return u.forEach((s=>C.insert(s))),C}insert(t){if(this.ge===0)return;const a=RR(t),[u,y]=MR(a);for(let T=0;T<this.hashCount;T++){const C=this.ye(u,y,T);this.be(C)}}be(t){const a=Math.floor(t/8),u=t%8;this.bitmap[a]|=1<<u}}class mv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(t,a,u,y,T){this.snapshotVersion=t,this.targetChanges=a,this.targetMismatches=u,this.documentUpdates=y,this.resolvedLimboDocuments=T}static createSynthesizedRemoteEventForCurrentChange(t,a,u){const y=new Map;return y.set(t,Xv.createSynthesizedTargetChangeForCurrentChange(t,a,u)),new D1(Wi.min(),y,new pa(Dr),wp(),Pr())}}class Xv{constructor(t,a,u,y,T){this.resumeToken=t,this.current=a,this.addedDocuments=u,this.modifiedDocuments=y,this.removedDocuments=T}static createSynthesizedTargetChangeForCurrentChange(t,a,u){return new Xv(u,a,Pr(),Pr(),Pr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(t,a,u,y){this.Se=t,this.removedTargetIds=a,this.key=u,this.De=y}}class ok{constructor(t,a){this.targetId=t,this.Ce=a}}class lk{constructor(t,a,u=ll.EMPTY_BYTE_STRING,y=null){this.state=t,this.targetIds=a,this.resumeToken=u,this.cause=y}}class DR{constructor(){this.ve=0,this.Fe=PR(),this.Me=ll.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=Pr(),a=Pr(),u=Pr();return this.Fe.forEach(((y,T)=>{switch(T){case 0:t=t.add(y);break;case 2:a=a.add(y);break;case 1:u=u.add(y);break;default:Bi(38017,{changeType:T})}})),new Xv(this.Me,this.xe,t,a,u)}Ke(){this.Oe=!1,this.Fe=PR()}qe(t,a){this.Oe=!0,this.Fe=this.Fe.insert(t,a)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,fs(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Kj{constructor(t){this.Ge=t,this.ze=new Map,this.je=wp(),this.He=bb(),this.Je=bb(),this.Ze=new pa(Dr)}Xe(t){for(const a of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(a,t.De):this.et(a,t.key,t.De);for(const a of t.removedTargetIds)this.et(a,t.key,t.De)}tt(t){this.forEachTarget(t,(a=>{const u=this.nt(a);switch(t.state){case 0:this.rt(a)&&u.Le(t.resumeToken);break;case 1:u.We(),u.Ne||u.Ke(),u.Le(t.resumeToken);break;case 2:u.We(),u.Ne||this.removeTarget(a);break;case 3:this.rt(a)&&(u.Qe(),u.Le(t.resumeToken));break;case 4:this.rt(a)&&(this.it(a),u.Le(t.resumeToken));break;default:Bi(56790,{state:t.state})}}))}forEachTarget(t,a){t.targetIds.length>0?t.targetIds.forEach(a):this.ze.forEach(((u,y)=>{this.rt(y)&&a(y)}))}st(t){const a=t.targetId,u=t.Ce.count,y=this.ot(a);if(y){const T=y.target;if(hE(T))if(u===0){const C=new vi(T.path);this.et(a,C,Al.newNoDocument(C,Wi.min()))}else fs(u===1,20013,{expectedCount:u});else{const C=this._t(a);if(C!==u){const s=this.ut(t),B=s?this.ct(s,t,C):1;if(B!==0){this.it(a);const V=B===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(a,V)}}}}}ut(t){const a=t.Ce.unchangedNames;if(!a||!a.bits)return null;const{bits:{bitmap:u="",padding:y=0},hashCount:T=0}=a;let C,s;try{C=jm(u).toUint8Array()}catch(B){if(B instanceof PP)return Py("Decoding the base64 bloom filter in existence filter failed ("+B.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw B}try{s=new gS(C,y,T)}catch(B){return Py(B instanceof mv?"BloomFilter error: ":"Applying bloom filter failed: ",B),null}return s.ge===0?null:s}ct(t,a,u){return a.Ce.count===u-this.Pt(t,a.targetId)?0:2}Pt(t,a){const u=this.Ge.getRemoteKeysForTarget(a);let y=0;return u.forEach((T=>{const C=this.Ge.ht(),s=`projects/${C.projectId}/databases/${C.database}/documents/${T.path.canonicalString()}`;t.mightContain(s)||(this.et(a,T,null),y++)})),y}Tt(t){const a=new Map;this.ze.forEach(((T,C)=>{const s=this.ot(C);if(s){if(T.current&&hE(s.target)){const B=new vi(s.target.path);this.It(B).has(C)||this.Et(C,B)||this.et(C,B,Al.newNoDocument(B,t))}T.Be&&(a.set(C,T.ke()),T.Ke())}}));let u=Pr();this.Je.forEach(((T,C)=>{let s=!0;C.forEachWhile((B=>{const V=this.ot(B);return!V||V.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)})),s&&(u=u.add(T))})),this.je.forEach(((T,C)=>C.setReadTime(t)));const y=new D1(t,a,this.Ze,this.je,u);return this.je=wp(),this.He=bb(),this.Je=bb(),this.Ze=new pa(Dr),y}Ye(t,a){if(!this.rt(t))return;const u=this.Et(t,a.key)?2:0;this.nt(t).qe(a.key,u),this.je=this.je.insert(a.key,a),this.He=this.He.insert(a.key,this.It(a.key).add(t)),this.Je=this.Je.insert(a.key,this.Rt(a.key).add(t))}et(t,a,u){if(!this.rt(t))return;const y=this.nt(t);this.Et(t,a)?y.qe(a,1):y.Ue(a),this.Je=this.Je.insert(a,this.Rt(a).delete(t)),this.Je=this.Je.insert(a,this.Rt(a).add(t)),u&&(this.je=this.je.insert(a,u))}removeTarget(t){this.ze.delete(t)}_t(t){const a=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+a.addedDocuments.size-a.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let a=this.ze.get(t);return a||(a=new DR,this.ze.set(t,a)),a}Rt(t){let a=this.Je.get(t);return a||(a=new vo(Dr),this.Je=this.Je.insert(t,a)),a}It(t){let a=this.He.get(t);return a||(a=new vo(Dr),this.He=this.He.insert(t,a)),a}rt(t){const a=this.ot(t)!==null;return a||Xn("WatchChangeAggregator","Detected inactive target",t),a}ot(t){const a=this.ze.get(t);return a&&a.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new DR),this.Ge.getRemoteKeysForTarget(t).forEach((a=>{this.et(t,a,null)}))}Et(t,a){return this.Ge.getRemoteKeysForTarget(t).has(a)}}function bb(){return new pa(vi.comparator)}function PR(){return new pa(vi.comparator)}const Qj={asc:"ASCENDING",desc:"DESCENDING"},Jj={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eU={and:"AND",or:"OR"};class tU{constructor(t,a){this.databaseId=t,this.useProto3Json=a}}function pE(o,t){return o.useProto3Json||E1(t)?t:{value:t}}function o1(o,t){return o.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ck(o,t){return o.useProto3Json?t.toBase64():t.toUint8Array()}function nU(o,t){return o1(o,t.toTimestamp())}function sf(o){return fs(!!o,49232),Wi.fromTimestamp((function(a){const u=Vm(a);return new Ws(u.seconds,u.nanos)})(o))}function _S(o,t){return mE(o,t).canonicalString()}function mE(o,t){const a=(function(y){return new Os(["projects",y.projectId,"databases",y.database])})(o).child("documents");return t===void 0?a:a.child(t)}function uk(o){const t=Os.fromString(o);return fs(mk(t),10190,{key:t.toString()}),t}function gE(o,t){return _S(o.databaseId,t.path)}function AT(o,t){const a=uk(t);if(a.get(1)!==o.databaseId.projectId)throw new $n(hn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+a.get(1)+" vs "+o.databaseId.projectId);if(a.get(3)!==o.databaseId.database)throw new $n(hn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+a.get(3)+" vs "+o.databaseId.database);return new vi(dk(a))}function hk(o,t){return _S(o.databaseId,t)}function iU(o){const t=uk(o);return t.length===4?Os.emptyPath():dk(t)}function _E(o){return new Os(["projects",o.databaseId.projectId,"databases",o.databaseId.database]).canonicalString()}function dk(o){return fs(o.length>4&&o.get(4)==="documents",29091,{key:o.toString()}),o.popFirst(5)}function kR(o,t,a){return{name:gE(o,t),fields:a.value.mapValue.fields}}function rU(o,t){let a;if("targetChange"in t){t.targetChange;const u=(function(V){return V==="NO_CHANGE"?0:V==="ADD"?1:V==="REMOVE"?2:V==="CURRENT"?3:V==="RESET"?4:Bi(39313,{state:V})})(t.targetChange.targetChangeType||"NO_CHANGE"),y=t.targetChange.targetIds||[],T=(function(V,W){return V.useProto3Json?(fs(W===void 0||typeof W=="string",58123),ll.fromBase64String(W||"")):(fs(W===void 0||W instanceof Buffer||W instanceof Uint8Array,16193),ll.fromUint8Array(W||new Uint8Array))})(o,t.targetChange.resumeToken),C=t.targetChange.cause,s=C&&(function(V){const W=V.code===void 0?hn.UNKNOWN:ak(V.code);return new $n(W,V.message||"")})(C);a=new lk(u,y,T,s||null)}else if("documentChange"in t){t.documentChange;const u=t.documentChange;u.document,u.document.name,u.document.updateTime;const y=AT(o,u.document.name),T=sf(u.document.updateTime),C=u.document.createTime?sf(u.document.createTime):Wi.min(),s=new Qu({mapValue:{fields:u.document.fields}}),B=Al.newFoundDocument(y,T,C,s),V=u.targetIds||[],W=u.removedTargetIds||[];a=new Bb(V,W,B.key,B)}else if("documentDelete"in t){t.documentDelete;const u=t.documentDelete;u.document;const y=AT(o,u.document),T=u.readTime?sf(u.readTime):Wi.min(),C=Al.newNoDocument(y,T),s=u.removedTargetIds||[];a=new Bb([],s,C.key,C)}else if("documentRemove"in t){t.documentRemove;const u=t.documentRemove;u.document;const y=AT(o,u.document),T=u.removedTargetIds||[];a=new Bb([],T,y,null)}else{if(!("filter"in t))return Bi(11601,{Vt:t});{t.filter;const u=t.filter;u.targetId;const{count:y=0,unchangedNames:T}=u,C=new Zj(y,T),s=u.targetId;a=new ok(s,C)}}return a}function sU(o,t){let a;if(t instanceof Wv)a={update:kR(o,t.key,t.value)};else if(t instanceof sk)a={delete:gE(o,t.key)};else if(t instanceof h_)a={update:kR(o,t.key,t.data),updateMask:pU(t.fieldMask)};else{if(!(t instanceof qj))return Bi(16599,{dt:t.type});a={verify:gE(o,t.key)}}return t.fieldTransforms.length>0&&(a.updateTransforms=t.fieldTransforms.map((u=>(function(T,C){const s=C.transform;if(s instanceof zv)return{fieldPath:C.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Ov)return{fieldPath:C.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Nv)return{fieldPath:C.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof a1)return{fieldPath:C.field.canonicalString(),increment:s.Ae};throw Bi(20930,{transform:C.transform})})(0,u)))),t.precondition.isNone||(a.currentDocument=(function(y,T){return T.updateTime!==void 0?{updateTime:nU(y,T.updateTime)}:T.exists!==void 0?{exists:T.exists}:Bi(27497)})(o,t.precondition)),a}function aU(o,t){return o&&o.length>0?(fs(t!==void 0,14353),o.map((a=>(function(y,T){let C=y.updateTime?sf(y.updateTime):sf(T);return C.isEqual(Wi.min())&&(C=sf(T)),new jj(C,y.transformResults||[])})(a,t)))):[]}function oU(o,t){return{documents:[hk(o,t.path)]}}function lU(o,t){const a={structuredQuery:{}},u=t.path;let y;t.collectionGroup!==null?(y=u,a.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(y=u.popLast(),a.structuredQuery.from=[{collectionId:u.lastSegment()}]),a.parent=hk(o,y);const T=(function(V){if(V.length!==0)return pk(ed.create(V,"and"))})(t.filters);T&&(a.structuredQuery.where=T);const C=(function(V){if(V.length!==0)return V.map((W=>(function(oe){return{field:xy(oe.field),direction:hU(oe.dir)}})(W)))})(t.orderBy);C&&(a.structuredQuery.orderBy=C);const s=pE(o,t.limit);return s!==null&&(a.structuredQuery.limit=s),t.startAt&&(a.structuredQuery.startAt=(function(V){return{before:V.inclusive,values:V.position}})(t.startAt)),t.endAt&&(a.structuredQuery.endAt=(function(V){return{before:!V.inclusive,values:V.position}})(t.endAt)),{ft:a,parent:y}}function cU(o){let t=iU(o.parent);const a=o.structuredQuery,u=a.from?a.from.length:0;let y=null;if(u>0){fs(u===1,65062);const W=a.from[0];W.allDescendants?y=W.collectionId:t=t.child(W.collectionId)}let T=[];a.where&&(T=(function(Q){const oe=fk(Q);return oe instanceof ed&&UP(oe)?oe.getFilters():[oe]})(a.where));let C=[];a.orderBy&&(C=(function(Q){return Q.map((oe=>(function(Je){return new Lv(vy(Je.field),(function(Xe){switch(Xe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(Je.direction))})(oe)))})(a.orderBy));let s=null;a.limit&&(s=(function(Q){let oe;return oe=typeof Q=="object"?Q.value:Q,E1(oe)?null:oe})(a.limit));let B=null;a.startAt&&(B=(function(Q){const oe=!!Q.before,he=Q.values||[];return new s1(he,oe)})(a.startAt));let V=null;return a.endAt&&(V=(function(Q){const oe=!Q.before,he=Q.values||[];return new s1(he,oe)})(a.endAt)),Sj(t,y,C,T,s,"F",B,V)}function uU(o,t){const a=(function(y){switch(y){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Bi(28987,{purpose:y})}})(t.purpose);return a==null?null:{"goog-listen-tags":a}}function fk(o){return o.unaryFilter!==void 0?(function(a){switch(a.unaryFilter.op){case"IS_NAN":const u=vy(a.unaryFilter.field);return Ja.create(u,"==",{doubleValue:NaN});case"IS_NULL":const y=vy(a.unaryFilter.field);return Ja.create(y,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const T=vy(a.unaryFilter.field);return Ja.create(T,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const C=vy(a.unaryFilter.field);return Ja.create(C,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Bi(61313);default:return Bi(60726)}})(o):o.fieldFilter!==void 0?(function(a){return Ja.create(vy(a.fieldFilter.field),(function(y){switch(y){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Bi(58110);default:return Bi(50506)}})(a.fieldFilter.op),a.fieldFilter.value)})(o):o.compositeFilter!==void 0?(function(a){return ed.create(a.compositeFilter.filters.map((u=>fk(u))),(function(y){switch(y){case"AND":return"and";case"OR":return"or";default:return Bi(1026)}})(a.compositeFilter.op))})(o):Bi(30097,{filter:o})}function hU(o){return Qj[o]}function dU(o){return Jj[o]}function fU(o){return eU[o]}function xy(o){return{fieldPath:o.canonicalString()}}function vy(o){return ol.fromServerFormat(o.fieldPath)}function pk(o){return o instanceof Ja?(function(a){if(a.op==="=="){if(vR(a.value))return{unaryFilter:{field:xy(a.field),op:"IS_NAN"}};if(xR(a.value))return{unaryFilter:{field:xy(a.field),op:"IS_NULL"}}}else if(a.op==="!="){if(vR(a.value))return{unaryFilter:{field:xy(a.field),op:"IS_NOT_NAN"}};if(xR(a.value))return{unaryFilter:{field:xy(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xy(a.field),op:dU(a.op),value:a.value}}})(o):o instanceof ed?(function(a){const u=a.getFilters().map((y=>pk(y)));return u.length===1?u[0]:{compositeFilter:{op:fU(a.op),filters:u}}})(o):Bi(54877,{filter:o})}function pU(o){const t=[];return o.fields.forEach((a=>t.push(a.canonicalString()))),{fieldPaths:t}}function mk(o){return o.length>=4&&o.get(0)==="projects"&&o.get(2)==="databases"}function gk(o){return!!o&&typeof o._toProto=="function"&&o._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(t,a,u,y,T=Wi.min(),C=Wi.min(),s=ll.EMPTY_BYTE_STRING,B=null){this.target=t,this.targetId=a,this.purpose=u,this.sequenceNumber=y,this.snapshotVersion=T,this.lastLimboFreeSnapshotVersion=C,this.resumeToken=s,this.expectedCount=B}withSequenceNumber(t){return new Dm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,a){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,a,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(t){this.yt=t}}function gU(o){const t=cU({parent:o.parent,structuredQuery:o.structuredQuery});return o.limitType==="LAST"?fE(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{constructor(){this.Sn=new yU}addToCollectionParentIndex(t,a){return this.Sn.add(a),pn.resolve()}getCollectionParents(t,a){return pn.resolve(this.Sn.getEntries(a))}addFieldIndex(t,a){return pn.resolve()}deleteFieldIndex(t,a){return pn.resolve()}deleteAllFieldIndexes(t){return pn.resolve()}createTargetIndexes(t,a){return pn.resolve()}getDocumentsMatchingTarget(t,a){return pn.resolve(null)}getIndexType(t,a){return pn.resolve(0)}getFieldIndexes(t,a){return pn.resolve([])}getNextCollectionGroupToUpdate(t){return pn.resolve(null)}getMinOffset(t,a){return pn.resolve(Fm.min())}getMinOffsetFromCollectionGroup(t,a){return pn.resolve(Fm.min())}updateCollectionGroup(t,a,u){return pn.resolve()}updateIndexEntries(t,a){return pn.resolve()}}class yU{constructor(){this.index={}}add(t){const a=t.lastSegment(),u=t.popLast(),y=this.index[a]||new vo(Os.comparator),T=!y.has(u);return this.index[a]=y.add(u),T}has(t){const a=t.lastSegment(),u=t.popLast(),y=this.index[a];return y&&y.has(u)}getEntries(t){return(this.index[t]||new vo(Os.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},_k=41943040;class Dc{static withCacheSize(t){return new Dc(t,Dc.DEFAULT_COLLECTION_PERCENTILE,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,a,u){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=a,this.maximumSequenceNumbersToCollect=u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Dc.DEFAULT_COLLECTION_PERCENTILE=10,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Dc.DEFAULT=new Dc(_k,Dc.DEFAULT_COLLECTION_PERCENTILE,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Dc.DISABLED=new Dc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new Oy(0)}static ar(){return new Oy(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR="LruGarbageCollector",xU=1048576;function OR([o,t],[a,u]){const y=Dr(o,a);return y===0?Dr(t,u):y}class vU{constructor(t){this.Pr=t,this.buffer=new vo(OR),this.Tr=0}Ir(){return++this.Tr}Er(t){const a=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(a);else{const u=this.buffer.last();OR(a,u)<0&&(this.buffer=this.buffer.delete(u).add(a))}}get maxValue(){return this.buffer.last()[0]}}class bU{constructor(t,a,u){this.garbageCollector=t,this.asyncQueue=a,this.localStore=u,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){Xn(zR,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){Zy(a)?Xn(zR,"Ignoring IndexedDB error during garbage collection: ",a):await $y(a)}await this.Ar(3e5)}))}}class wU{constructor(t,a){this.Vr=t,this.params=a}calculateTargetCount(t,a){return this.Vr.dr(t).next((u=>Math.floor(a/100*u)))}nthSequenceNumber(t,a){if(a===0)return pn.resolve(T1.ce);const u=new vU(a);return this.Vr.forEachTarget(t,(y=>u.Er(y.sequenceNumber))).next((()=>this.Vr.mr(t,(y=>u.Er(y))))).next((()=>u.maxValue))}removeTargets(t,a,u){return this.Vr.removeTargets(t,a,u)}removeOrphanedDocuments(t,a){return this.Vr.removeOrphanedDocuments(t,a)}collect(t,a){return this.params.cacheSizeCollectionThreshold===-1?(Xn("LruGarbageCollector","Garbage collection skipped; disabled"),pn.resolve(LR)):this.getCacheSize(t).next((u=>u<this.params.cacheSizeCollectionThreshold?(Xn("LruGarbageCollector",`Garbage collection skipped; Cache size ${u} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),LR):this.gr(t,a)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,a){let u,y,T,C,s,B,V;const W=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((Q=>(Q>this.params.maximumSequenceNumbersToCollect?(Xn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${Q}`),y=this.params.maximumSequenceNumbersToCollect):y=Q,C=Date.now(),this.nthSequenceNumber(t,y)))).next((Q=>(u=Q,s=Date.now(),this.removeTargets(t,u,a)))).next((Q=>(T=Q,B=Date.now(),this.removeOrphanedDocuments(t,u)))).next((Q=>(V=Date.now(),_y()<=Mr.DEBUG&&Xn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${C-W}ms
	Determined least recently used ${y} in `+(s-C)+`ms
	Removed ${T} targets in `+(B-s)+`ms
	Removed ${Q} documents in `+(V-B)+`ms
Total Duration: ${V-W}ms`),pn.resolve({didRun:!0,sequenceNumbersCollected:y,targetsRemoved:T,documentsRemoved:Q}))))}}function TU(o,t){return new wU(o,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(){this.changes=new u_((t=>t.toString()),((t,a)=>t.isEqual(a))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,a){this.assertNotApplied(),this.changes.set(t,Al.newInvalidDocument(t).setReadTime(a))}getEntry(t,a){this.assertNotApplied();const u=this.changes.get(a);return u!==void 0?pn.resolve(u):this.getFromCache(t,a)}getEntries(t,a){return this.getAllFromCache(t,a)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(t,a){this.overlayedDocument=t,this.mutatedFields=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(t,a,u,y){this.remoteDocumentCache=t,this.mutationQueue=a,this.documentOverlayCache=u,this.indexManager=y}getDocument(t,a){let u=null;return this.documentOverlayCache.getOverlay(t,a).next((y=>(u=y,this.remoteDocumentCache.getEntry(t,a)))).next((y=>(u!==null&&Tv(u.mutation,y,Kh.empty(),Ws.now()),y)))}getDocuments(t,a){return this.remoteDocumentCache.getEntries(t,a).next((u=>this.getLocalViewOfDocuments(t,u,Pr()).next((()=>u))))}getLocalViewOfDocuments(t,a,u=Pr()){const y=e_();return this.populateOverlays(t,y,a).next((()=>this.computeViews(t,a,y,u).next((T=>{let C=pv();return T.forEach(((s,B)=>{C=C.insert(s,B.overlayedDocument)})),C}))))}getOverlayedDocuments(t,a){const u=e_();return this.populateOverlays(t,u,a).next((()=>this.computeViews(t,a,u,Pr())))}populateOverlays(t,a,u){const y=[];return u.forEach((T=>{a.has(T)||y.push(T)})),this.documentOverlayCache.getOverlays(t,y).next((T=>{T.forEach(((C,s)=>{a.set(C,s)}))}))}computeViews(t,a,u,y){let T=wp();const C=wv(),s=(function(){return wv()})();return a.forEach(((B,V)=>{const W=u.get(V.key);y.has(V.key)&&(W===void 0||W.mutation instanceof h_)?T=T.insert(V.key,V):W!==void 0?(C.set(V.key,W.mutation.getFieldMask()),Tv(W.mutation,V,W.mutation.getFieldMask(),Ws.now())):C.set(V.key,Kh.empty())})),this.recalculateAndSaveOverlays(t,T).next((B=>(B.forEach(((V,W)=>C.set(V,W))),a.forEach(((V,W)=>s.set(V,new SU(W,C.get(V)??null)))),s)))}recalculateAndSaveOverlays(t,a){const u=wv();let y=new pa(((C,s)=>C-s)),T=Pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,a).next((C=>{for(const s of C)s.keys().forEach((B=>{const V=a.get(B);if(V===null)return;let W=u.get(B)||Kh.empty();W=s.applyToLocalView(V,W),u.set(B,W);const Q=(y.get(s.batchId)||Pr()).add(B);y=y.insert(s.batchId,Q)}))})).next((()=>{const C=[],s=y.getReverseIterator();for(;s.hasNext();){const B=s.getNext(),V=B.key,W=B.value,Q=KP();W.forEach((oe=>{if(!T.has(oe)){const he=ik(a.get(oe),u.get(oe));he!==null&&Q.set(oe,he),T=T.add(oe)}})),C.push(this.documentOverlayCache.saveOverlays(t,V,Q))}return pn.waitFor(C)})).next((()=>u))}recalculateAndSaveOverlaysForDocumentKeys(t,a){return this.remoteDocumentCache.getEntries(t,a).next((u=>this.recalculateAndSaveOverlays(t,u)))}getDocumentsMatchingQuery(t,a,u,y){return Aj(a)?this.getDocumentsMatchingDocumentQuery(t,a.path):$P(a)?this.getDocumentsMatchingCollectionGroupQuery(t,a,u,y):this.getDocumentsMatchingCollectionQuery(t,a,u,y)}getNextDocuments(t,a,u,y){return this.remoteDocumentCache.getAllFromCollectionGroup(t,a,u,y).next((T=>{const C=y-T.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,a,u.largestBatchId,y-T.size):pn.resolve(e_());let s=Mv,B=T;return C.next((V=>pn.forEach(V,((W,Q)=>(s<Q.largestBatchId&&(s=Q.largestBatchId),T.get(W)?pn.resolve():this.remoteDocumentCache.getEntry(t,W).next((oe=>{B=B.insert(W,oe)}))))).next((()=>this.populateOverlays(t,V,T))).next((()=>this.computeViews(t,B,V,Pr()))).next((W=>({batchId:s,changes:YP(W)})))))}))}getDocumentsMatchingDocumentQuery(t,a){return this.getDocument(t,new vi(a)).next((u=>{let y=pv();return u.isFoundDocument()&&(y=y.insert(u.key,u)),y}))}getDocumentsMatchingCollectionGroupQuery(t,a,u,y){const T=a.collectionGroup;let C=pv();return this.indexManager.getCollectionParents(t,T).next((s=>pn.forEach(s,(B=>{const V=(function(Q,oe){return new Wy(oe,null,Q.explicitOrderBy.slice(),Q.filters.slice(),Q.limit,Q.limitType,Q.startAt,Q.endAt)})(a,B.child(T));return this.getDocumentsMatchingCollectionQuery(t,V,u,y).next((W=>{W.forEach(((Q,oe)=>{C=C.insert(Q,oe)}))}))})).next((()=>C))))}getDocumentsMatchingCollectionQuery(t,a,u,y){let T;return this.documentOverlayCache.getOverlaysForCollection(t,a.path,u.largestBatchId).next((C=>(T=C,this.remoteDocumentCache.getDocumentsMatchingQuery(t,a,u,T,y)))).next((C=>{T.forEach(((B,V)=>{const W=V.getKey();C.get(W)===null&&(C=C.insert(W,Al.newInvalidDocument(W)))}));let s=pv();return C.forEach(((B,V)=>{const W=T.get(B);W!==void 0&&Tv(W.mutation,V,Kh.empty(),Ws.now()),C1(a,V)&&(s=s.insert(B,V))})),s}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,a){return pn.resolve(this.Nr.get(a))}saveBundleMetadata(t,a){return this.Nr.set(a.id,(function(y){return{id:y.id,version:y.version,createTime:sf(y.createTime)}})(a)),pn.resolve()}getNamedQuery(t,a){return pn.resolve(this.Br.get(a))}saveNamedQuery(t,a){return this.Br.set(a.name,(function(y){return{name:y.name,query:gU(y.bundledQuery),readTime:sf(y.readTime)}})(a)),pn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(){this.overlays=new pa(vi.comparator),this.Lr=new Map}getOverlay(t,a){return pn.resolve(this.overlays.get(a))}getOverlays(t,a){const u=e_();return pn.forEach(a,(y=>this.getOverlay(t,y).next((T=>{T!==null&&u.set(y,T)})))).next((()=>u))}saveOverlays(t,a,u){return u.forEach(((y,T)=>{this.bt(t,a,T)})),pn.resolve()}removeOverlaysForBatchId(t,a,u){const y=this.Lr.get(u);return y!==void 0&&(y.forEach((T=>this.overlays=this.overlays.remove(T))),this.Lr.delete(u)),pn.resolve()}getOverlaysForCollection(t,a,u){const y=e_(),T=a.length+1,C=new vi(a.child("")),s=this.overlays.getIteratorFrom(C);for(;s.hasNext();){const B=s.getNext().value,V=B.getKey();if(!a.isPrefixOf(V.path))break;V.path.length===T&&B.largestBatchId>u&&y.set(B.getKey(),B)}return pn.resolve(y)}getOverlaysForCollectionGroup(t,a,u,y){let T=new pa(((V,W)=>V-W));const C=this.overlays.getIterator();for(;C.hasNext();){const V=C.getNext().value;if(V.getKey().getCollectionGroup()===a&&V.largestBatchId>u){let W=T.get(V.largestBatchId);W===null&&(W=e_(),T=T.insert(V.largestBatchId,W)),W.set(V.getKey(),V)}}const s=e_(),B=T.getIterator();for(;B.hasNext()&&(B.getNext().value.forEach(((V,W)=>s.set(V,W))),!(s.size()>=y)););return pn.resolve(s)}bt(t,a,u){const y=this.overlays.get(u.key);if(y!==null){const C=this.Lr.get(y.largestBatchId).delete(u.key);this.Lr.set(y.largestBatchId,C)}this.overlays=this.overlays.insert(u.key,new $j(a,u));let T=this.Lr.get(a);T===void 0&&(T=Pr(),this.Lr.set(a,T)),this.Lr.set(a,T.add(u.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(){this.sessionToken=ll.EMPTY_BYTE_STRING}getSessionToken(t){return pn.resolve(this.sessionToken)}setSessionToken(t,a){return this.sessionToken=a,pn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(){this.kr=new vo(Ho.Kr),this.qr=new vo(Ho.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,a){const u=new Ho(t,a);this.kr=this.kr.add(u),this.qr=this.qr.add(u)}$r(t,a){t.forEach((u=>this.addReference(u,a)))}removeReference(t,a){this.Wr(new Ho(t,a))}Qr(t,a){t.forEach((u=>this.removeReference(u,a)))}Gr(t){const a=new vi(new Os([])),u=new Ho(a,t),y=new Ho(a,t+1),T=[];return this.qr.forEachInRange([u,y],(C=>{this.Wr(C),T.push(C.key)})),T}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const a=new vi(new Os([])),u=new Ho(a,t),y=new Ho(a,t+1);let T=Pr();return this.qr.forEachInRange([u,y],(C=>{T=T.add(C.key)})),T}containsKey(t){const a=new Ho(t,0),u=this.kr.firstAfterOrEqual(a);return u!==null&&t.isEqual(u.key)}}class Ho{constructor(t,a){this.key=t,this.Hr=a}static Kr(t,a){return vi.comparator(t.key,a.key)||Dr(t.Hr,a.Hr)}static Ur(t,a){return Dr(t.Hr,a.Hr)||vi.comparator(t.key,a.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(t,a){this.indexManager=t,this.referenceDelegate=a,this.mutationQueue=[],this.Yn=1,this.Jr=new vo(Ho.Kr)}checkEmpty(t){return pn.resolve(this.mutationQueue.length===0)}addMutationBatch(t,a,u,y){const T=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const C=new Hj(T,a,u,y);this.mutationQueue.push(C);for(const s of y)this.Jr=this.Jr.add(new Ho(s.key,T)),this.indexManager.addToCollectionParentIndex(t,s.key.path.popLast());return pn.resolve(C)}lookupMutationBatch(t,a){return pn.resolve(this.Zr(a))}getNextMutationBatchAfterBatchId(t,a){const u=a+1,y=this.Xr(u),T=y<0?0:y;return pn.resolve(this.mutationQueue.length>T?this.mutationQueue[T]:null)}getHighestUnacknowledgedBatchId(){return pn.resolve(this.mutationQueue.length===0?cS:this.Yn-1)}getAllMutationBatches(t){return pn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,a){const u=new Ho(a,0),y=new Ho(a,Number.POSITIVE_INFINITY),T=[];return this.Jr.forEachInRange([u,y],(C=>{const s=this.Zr(C.Hr);T.push(s)})),pn.resolve(T)}getAllMutationBatchesAffectingDocumentKeys(t,a){let u=new vo(Dr);return a.forEach((y=>{const T=new Ho(y,0),C=new Ho(y,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([T,C],(s=>{u=u.add(s.Hr)}))})),pn.resolve(this.Yr(u))}getAllMutationBatchesAffectingQuery(t,a){const u=a.path,y=u.length+1;let T=u;vi.isDocumentKey(T)||(T=T.child(""));const C=new Ho(new vi(T),0);let s=new vo(Dr);return this.Jr.forEachWhile((B=>{const V=B.key.path;return!!u.isPrefixOf(V)&&(V.length===y&&(s=s.add(B.Hr)),!0)}),C),pn.resolve(this.Yr(s))}Yr(t){const a=[];return t.forEach((u=>{const y=this.Zr(u);y!==null&&a.push(y)})),a}removeMutationBatch(t,a){fs(this.ei(a.batchId,"removed")===0,55003),this.mutationQueue.shift();let u=this.Jr;return pn.forEach(a.mutations,(y=>{const T=new Ho(y.key,a.batchId);return u=u.delete(T),this.referenceDelegate.markPotentiallyOrphaned(t,y.key)})).next((()=>{this.Jr=u}))}nr(t){}containsKey(t,a){const u=new Ho(a,0),y=this.Jr.firstAfterOrEqual(u);return pn.resolve(a.isEqual(y&&y.key))}performConsistencyCheck(t){return this.mutationQueue.length,pn.resolve()}ei(t,a){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const a=this.Xr(t);return a<0||a>=this.mutationQueue.length?null:this.mutationQueue[a]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(t){this.ti=t,this.docs=(function(){return new pa(vi.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,a){const u=a.key,y=this.docs.get(u),T=y?y.size:0,C=this.ti(a);return this.docs=this.docs.insert(u,{document:a.mutableCopy(),size:C}),this.size+=C-T,this.indexManager.addToCollectionParentIndex(t,u.path.popLast())}removeEntry(t){const a=this.docs.get(t);a&&(this.docs=this.docs.remove(t),this.size-=a.size)}getEntry(t,a){const u=this.docs.get(a);return pn.resolve(u?u.document.mutableCopy():Al.newInvalidDocument(a))}getEntries(t,a){let u=wp();return a.forEach((y=>{const T=this.docs.get(y);u=u.insert(y,T?T.document.mutableCopy():Al.newInvalidDocument(y))})),pn.resolve(u)}getDocumentsMatchingQuery(t,a,u,y){let T=wp();const C=a.path,s=new vi(C.child("__id-9223372036854775808__")),B=this.docs.getIteratorFrom(s);for(;B.hasNext();){const{key:V,value:{document:W}}=B.getNext();if(!C.isPrefixOf(V.path))break;V.path.length>C.length+1||nj(tj(W),u)<=0||(y.has(W.key)||C1(a,W))&&(T=T.insert(W.key,W.mutableCopy()))}return pn.resolve(T)}getAllFromCollectionGroup(t,a,u,y){Bi(9500)}ni(t,a){return pn.forEach(this.docs,(u=>a(u)))}newChangeBuffer(t){return new PU(this)}getSize(t){return pn.resolve(this.size)}}class PU extends EU{constructor(t){super(),this.Mr=t}applyChanges(t){const a=[];return this.changes.forEach(((u,y)=>{y.isValidDocument()?a.push(this.Mr.addEntry(t,y)):this.Mr.removeEntry(u)})),pn.waitFor(a)}getFromCache(t,a){return this.Mr.getEntry(t,a)}getAllFromCache(t,a){return this.Mr.getEntries(t,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(t){this.persistence=t,this.ri=new u_((a=>dS(a)),fS),this.lastRemoteSnapshotVersion=Wi.min(),this.highestTargetId=0,this.ii=0,this.si=new yS,this.targetCount=0,this.oi=Oy._r()}forEachTarget(t,a){return this.ri.forEach(((u,y)=>a(y))),pn.resolve()}getLastRemoteSnapshotVersion(t){return pn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return pn.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),pn.resolve(this.highestTargetId)}setTargetsMetadata(t,a,u){return u&&(this.lastRemoteSnapshotVersion=u),a>this.ii&&(this.ii=a),pn.resolve()}lr(t){this.ri.set(t.target,t);const a=t.targetId;a>this.highestTargetId&&(this.oi=new Oy(a),this.highestTargetId=a),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,a){return this.lr(a),this.targetCount+=1,pn.resolve()}updateTargetData(t,a){return this.lr(a),pn.resolve()}removeTargetData(t,a){return this.ri.delete(a.target),this.si.Gr(a.targetId),this.targetCount-=1,pn.resolve()}removeTargets(t,a,u){let y=0;const T=[];return this.ri.forEach(((C,s)=>{s.sequenceNumber<=a&&u.get(s.targetId)===null&&(this.ri.delete(C),T.push(this.removeMatchingKeysForTargetId(t,s.targetId)),y++)})),pn.waitFor(T).next((()=>y))}getTargetCount(t){return pn.resolve(this.targetCount)}getTargetData(t,a){const u=this.ri.get(a)||null;return pn.resolve(u)}addMatchingKeys(t,a,u){return this.si.$r(a,u),pn.resolve()}removeMatchingKeys(t,a,u){this.si.Qr(a,u);const y=this.persistence.referenceDelegate,T=[];return y&&a.forEach((C=>{T.push(y.markPotentiallyOrphaned(t,C))})),pn.waitFor(T)}removeMatchingKeysForTargetId(t,a){return this.si.Gr(a),pn.resolve()}getMatchingKeysForTargetId(t,a){const u=this.si.jr(a);return pn.resolve(u)}containsKey(t,a){return pn.resolve(this.si.containsKey(a))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(t,a){this._i={},this.overlays={},this.ai=new T1(0),this.ui=!1,this.ui=!0,this.ci=new RU,this.referenceDelegate=t(this),this.li=new kU(this),this.indexManager=new _U,this.remoteDocumentCache=(function(y){return new DU(y)})((u=>this.referenceDelegate.hi(u))),this.serializer=new mU(a),this.Pi=new IU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let a=this.overlays[t.toKey()];return a||(a=new CU,this.overlays[t.toKey()]=a),a}getMutationQueue(t,a){let u=this._i[t.toKey()];return u||(u=new MU(a,this.referenceDelegate),this._i[t.toKey()]=u),u}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,a,u){Xn("MemoryPersistence","Starting transaction:",t);const y=new LU(this.ai.next());return this.referenceDelegate.Ti(),u(y).next((T=>this.referenceDelegate.Ii(y).next((()=>T)))).toPromise().then((T=>(y.raiseOnCommittedEvent(),T)))}Ei(t,a){return pn.or(Object.values(this._i).map((u=>()=>u.containsKey(t,a))))}}class LU extends rj{constructor(t){super(),this.currentSequenceNumber=t}}class xS{constructor(t){this.persistence=t,this.Ri=new yS,this.Ai=null}static Vi(t){return new xS(t)}get di(){if(this.Ai)return this.Ai;throw Bi(60996)}addReference(t,a,u){return this.Ri.addReference(u,a),this.di.delete(u.toString()),pn.resolve()}removeReference(t,a,u){return this.Ri.removeReference(u,a),this.di.add(u.toString()),pn.resolve()}markPotentiallyOrphaned(t,a){return this.di.add(a.toString()),pn.resolve()}removeTarget(t,a){this.Ri.Gr(a.targetId).forEach((y=>this.di.add(y.toString())));const u=this.persistence.getTargetCache();return u.getMatchingKeysForTargetId(t,a.targetId).next((y=>{y.forEach((T=>this.di.add(T.toString())))})).next((()=>u.removeTargetData(t,a)))}Ti(){this.Ai=new Set}Ii(t){const a=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pn.forEach(this.di,(u=>{const y=vi.fromPath(u);return this.mi(t,y).next((T=>{T||a.removeEntry(y,Wi.min())}))})).next((()=>(this.Ai=null,a.apply(t))))}updateLimboDocument(t,a){return this.mi(t,a).next((u=>{u?this.di.delete(a.toString()):this.di.add(a.toString())}))}hi(t){return 0}mi(t,a){return pn.or([()=>pn.resolve(this.Ri.containsKey(a)),()=>this.persistence.getTargetCache().containsKey(t,a),()=>this.persistence.Ei(t,a)])}}class l1{constructor(t,a){this.persistence=t,this.fi=new u_((u=>oj(u.path)),((u,y)=>u.isEqual(y))),this.garbageCollector=TU(this,a)}static Vi(t,a){return new l1(t,a)}Ti(){}Ii(t){return pn.resolve()}forEachTarget(t,a){return this.persistence.getTargetCache().forEachTarget(t,a)}dr(t){const a=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((u=>a.next((y=>u+y))))}pr(t){let a=0;return this.mr(t,(u=>{a++})).next((()=>a))}mr(t,a){return pn.forEach(this.fi,((u,y)=>this.wr(t,u,y).next((T=>T?pn.resolve():a(y)))))}removeTargets(t,a,u){return this.persistence.getTargetCache().removeTargets(t,a,u)}removeOrphanedDocuments(t,a){let u=0;const y=this.persistence.getRemoteDocumentCache(),T=y.newChangeBuffer();return y.ni(t,(C=>this.wr(t,C,a).next((s=>{s||(u++,T.removeEntry(C,Wi.min()))})))).next((()=>T.apply(t))).next((()=>u))}markPotentiallyOrphaned(t,a){return this.fi.set(a,t.currentSequenceNumber),pn.resolve()}removeTarget(t,a){const u=a.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,u)}addReference(t,a,u){return this.fi.set(u,t.currentSequenceNumber),pn.resolve()}removeReference(t,a,u){return this.fi.set(u,t.currentSequenceNumber),pn.resolve()}updateLimboDocument(t,a){return this.fi.set(a,t.currentSequenceNumber),pn.resolve()}hi(t){let a=t.key.toString().length;return t.isFoundDocument()&&(a+=zb(t.data.value)),a}wr(t,a,u){return pn.or([()=>this.persistence.Ei(t,a),()=>this.persistence.getTargetCache().containsKey(t,a),()=>{const y=this.fi.get(a);return pn.resolve(y!==void 0&&y>u)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(t,a,u,y){this.targetId=t,this.fromCache=a,this.Ts=u,this.Is=y}static Es(t,a){let u=Pr(),y=Pr();for(const T of a.docChanges)switch(T.type){case 0:u=u.add(T.doc.key);break;case 1:y=y.add(T.doc.key)}return new vS(t,a.fromCache,u,y)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OU{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return bF()?8:sj(Il())>0?6:4})()}initialize(t,a){this.fs=t,this.indexManager=a,this.Rs=!0}getDocumentsMatchingQuery(t,a,u,y){const T={result:null};return this.gs(t,a).next((C=>{T.result=C})).next((()=>{if(!T.result)return this.ps(t,a,y,u).next((C=>{T.result=C}))})).next((()=>{if(T.result)return;const C=new zU;return this.ys(t,a,C).next((s=>{if(T.result=s,this.As)return this.ws(t,a,C,s.size)}))})).next((()=>T.result))}ws(t,a,u,y){return u.documentReadCount<this.Vs?(_y()<=Mr.DEBUG&&Xn("QueryEngine","SDK will not create cache indexes for query:",yy(a),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),pn.resolve()):(_y()<=Mr.DEBUG&&Xn("QueryEngine","Query:",yy(a),"scans",u.documentReadCount,"local documents and returns",y,"documents as results."),u.documentReadCount>this.ds*y?(_y()<=Mr.DEBUG&&Xn("QueryEngine","The SDK decides to create cache indexes for query:",yy(a),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,nf(a))):pn.resolve())}gs(t,a){if(ER(a))return pn.resolve(null);let u=nf(a);return this.indexManager.getIndexType(t,u).next((y=>y===0?null:(a.limit!==null&&y===1&&(a=fE(a,null,"F"),u=nf(a)),this.indexManager.getDocumentsMatchingTarget(t,u).next((T=>{const C=Pr(...T);return this.fs.getDocuments(t,C).next((s=>this.indexManager.getMinOffset(t,u).next((B=>{const V=this.bs(a,s);return this.Ss(a,V,C,B.readTime)?this.gs(t,fE(a,null,"F")):this.Ds(t,V,a,B)}))))})))))}ps(t,a,u,y){return ER(a)||y.isEqual(Wi.min())?pn.resolve(null):this.fs.getDocuments(t,u).next((T=>{const C=this.bs(a,T);return this.Ss(a,C,u,y)?pn.resolve(null):(_y()<=Mr.DEBUG&&Xn("QueryEngine","Re-using previous result from %s to execute query: %s",y.toString(),yy(a)),this.Ds(t,C,a,ej(y,Mv)).next((s=>s)))}))}bs(t,a){let u=new vo(WP(t));return a.forEach(((y,T)=>{C1(t,T)&&(u=u.add(T))})),u}Ss(t,a,u,y){if(t.limit===null)return!1;if(u.size!==a.size)return!0;const T=t.limitType==="F"?a.last():a.first();return!!T&&(T.hasPendingWrites||T.version.compareTo(y)>0)}ys(t,a,u){return _y()<=Mr.DEBUG&&Xn("QueryEngine","Using full collection scan to execute query:",yy(a)),this.fs.getDocumentsMatchingQuery(t,a,Fm.min(),u)}Ds(t,a,u,y){return this.fs.getDocumentsMatchingQuery(t,u,y).next((T=>(a.forEach((C=>{T=T.insert(C.key,C)})),T)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bS="LocalStore",NU=3e8;class BU{constructor(t,a,u,y){this.persistence=t,this.Cs=a,this.serializer=y,this.vs=new pa(Dr),this.Fs=new u_((T=>dS(T)),fS),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(u)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new AU(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(a=>t.collect(a,this.vs)))}}function FU(o,t,a,u){return new BU(o,t,a,u)}async function xk(o,t){const a=Ki(o);return await a.persistence.runTransaction("Handle user change","readonly",(u=>{let y;return a.mutationQueue.getAllMutationBatches(u).next((T=>(y=T,a.Os(t),a.mutationQueue.getAllMutationBatches(u)))).next((T=>{const C=[],s=[];let B=Pr();for(const V of y){C.push(V.batchId);for(const W of V.mutations)B=B.add(W.key)}for(const V of T){s.push(V.batchId);for(const W of V.mutations)B=B.add(W.key)}return a.localDocuments.getDocuments(u,B).next((V=>({Ns:V,removedBatchIds:C,addedBatchIds:s})))}))}))}function VU(o,t){const a=Ki(o);return a.persistence.runTransaction("Acknowledge batch","readwrite-primary",(u=>{const y=t.batch.keys(),T=a.xs.newChangeBuffer({trackRemovals:!0});return(function(s,B,V,W){const Q=V.batch,oe=Q.keys();let he=pn.resolve();return oe.forEach((Je=>{he=he.next((()=>W.getEntry(B,Je))).next((Ye=>{const Xe=V.docVersions.get(Je);fs(Xe!==null,48541),Ye.version.compareTo(Xe)<0&&(Q.applyToRemoteDocument(Ye,V),Ye.isValidDocument()&&(Ye.setReadTime(V.commitVersion),W.addEntry(Ye)))}))})),he.next((()=>s.mutationQueue.removeMutationBatch(B,Q)))})(a,u,t,T).next((()=>T.apply(u))).next((()=>a.mutationQueue.performConsistencyCheck(u))).next((()=>a.documentOverlayCache.removeOverlaysForBatchId(u,y,t.batch.batchId))).next((()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,(function(s){let B=Pr();for(let V=0;V<s.mutationResults.length;++V)s.mutationResults[V].transformResults.length>0&&(B=B.add(s.batch.mutations[V].key));return B})(t)))).next((()=>a.localDocuments.getDocuments(u,y)))}))}function vk(o){const t=Ki(o);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(a=>t.li.getLastRemoteSnapshotVersion(a)))}function jU(o,t){const a=Ki(o),u=t.snapshotVersion;let y=a.vs;return a.persistence.runTransaction("Apply remote event","readwrite-primary",(T=>{const C=a.xs.newChangeBuffer({trackRemovals:!0});y=a.vs;const s=[];t.targetChanges.forEach(((W,Q)=>{const oe=y.get(Q);if(!oe)return;s.push(a.li.removeMatchingKeys(T,W.removedDocuments,Q).next((()=>a.li.addMatchingKeys(T,W.addedDocuments,Q))));let he=oe.withSequenceNumber(T.currentSequenceNumber);t.targetMismatches.get(Q)!==null?he=he.withResumeToken(ll.EMPTY_BYTE_STRING,Wi.min()).withLastLimboFreeSnapshotVersion(Wi.min()):W.resumeToken.approximateByteSize()>0&&(he=he.withResumeToken(W.resumeToken,u)),y=y.insert(Q,he),(function(Ye,Xe,st){return Ye.resumeToken.approximateByteSize()===0||Xe.snapshotVersion.toMicroseconds()-Ye.snapshotVersion.toMicroseconds()>=NU?!0:st.addedDocuments.size+st.modifiedDocuments.size+st.removedDocuments.size>0})(oe,he,W)&&s.push(a.li.updateTargetData(T,he))}));let B=wp(),V=Pr();if(t.documentUpdates.forEach((W=>{t.resolvedLimboDocuments.has(W)&&s.push(a.persistence.referenceDelegate.updateLimboDocument(T,W))})),s.push(UU(T,C,t.documentUpdates).next((W=>{B=W.Bs,V=W.Ls}))),!u.isEqual(Wi.min())){const W=a.li.getLastRemoteSnapshotVersion(T).next((Q=>a.li.setTargetsMetadata(T,T.currentSequenceNumber,u)));s.push(W)}return pn.waitFor(s).next((()=>C.apply(T))).next((()=>a.localDocuments.getLocalViewOfDocuments(T,B,V))).next((()=>B))})).then((T=>(a.vs=y,T)))}function UU(o,t,a){let u=Pr(),y=Pr();return a.forEach((T=>u=u.add(T))),t.getEntries(o,u).next((T=>{let C=wp();return a.forEach(((s,B)=>{const V=T.get(s);B.isFoundDocument()!==V.isFoundDocument()&&(y=y.add(s)),B.isNoDocument()&&B.version.isEqual(Wi.min())?(t.removeEntry(s,B.readTime),C=C.insert(s,B)):!V.isValidDocument()||B.version.compareTo(V.version)>0||B.version.compareTo(V.version)===0&&V.hasPendingWrites?(t.addEntry(B),C=C.insert(s,B)):Xn(bS,"Ignoring outdated watch update for ",s,". Current version:",V.version," Watch version:",B.version)})),{Bs:C,Ls:y}}))}function GU(o,t){const a=Ki(o);return a.persistence.runTransaction("Get next mutation batch","readonly",(u=>(t===void 0&&(t=cS),a.mutationQueue.getNextMutationBatchAfterBatchId(u,t))))}function qU(o,t){const a=Ki(o);return a.persistence.runTransaction("Allocate target","readwrite",(u=>{let y;return a.li.getTargetData(u,t).next((T=>T?(y=T,pn.resolve(y)):a.li.allocateTargetId(u).next((C=>(y=new Dm(t,C,"TargetPurposeListen",u.currentSequenceNumber),a.li.addTargetData(u,y).next((()=>y)))))))})).then((u=>{const y=a.vs.get(u.targetId);return(y===null||u.snapshotVersion.compareTo(y.snapshotVersion)>0)&&(a.vs=a.vs.insert(u.targetId,u),a.Fs.set(t,u.targetId)),u}))}async function yE(o,t,a){const u=Ki(o),y=u.vs.get(t),T=a?"readwrite":"readwrite-primary";try{a||await u.persistence.runTransaction("Release target",T,(C=>u.persistence.referenceDelegate.removeTarget(C,y)))}catch(C){if(!Zy(C))throw C;Xn(bS,`Failed to update sequence numbers for target ${t}: ${C}`)}u.vs=u.vs.remove(t),u.Fs.delete(y.target)}function NR(o,t,a){const u=Ki(o);let y=Wi.min(),T=Pr();return u.persistence.runTransaction("Execute query","readwrite",(C=>(function(B,V,W){const Q=Ki(B),oe=Q.Fs.get(W);return oe!==void 0?pn.resolve(Q.vs.get(oe)):Q.li.getTargetData(V,W)})(u,C,nf(t)).next((s=>{if(s)return y=s.lastLimboFreeSnapshotVersion,u.li.getMatchingKeysForTargetId(C,s.targetId).next((B=>{T=B}))})).next((()=>u.Cs.getDocumentsMatchingQuery(C,t,a?y:Wi.min(),a?T:Pr()))).next((s=>(HU(u,Rj(t),s),{documents:s,ks:T})))))}function HU(o,t,a){let u=o.Ms.get(t)||Wi.min();a.forEach(((y,T)=>{T.readTime.compareTo(u)>0&&(u=T.readTime)})),o.Ms.set(t,u)}class BR{constructor(){this.activeTargetIds=zj()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class $U{constructor(){this.vo=new BR,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,a,u){}addLocalQueryTarget(t,a=!0){return a&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,a,u){this.Fo[t]=a}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new BR,Promise.resolve()}handleUserChange(t,a,u){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{Mo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FR="ConnectivityMonitor";class VR{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Xn(FR,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){Xn(FR,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wb=null;function xE(){return wb===null?wb=(function(){return 268435456+Math.round(2147483648*Math.random())})():wb++,"0x"+wb.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IT="RestConnection",WU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class XU{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const a=t.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),y=encodeURIComponent(this.databaseId.database);this.qo=a+"://"+t.host,this.Uo=`projects/${u}/databases/${y}`,this.$o=this.databaseId.database===i1?`project_id=${u}`:`project_id=${u}&database_id=${y}`}Wo(t,a,u,y,T){const C=xE(),s=this.Qo(t,a.toUriEncodedString());Xn(IT,`Sending RPC '${t}' ${C}:`,s,u);const B={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(B,y,T);const{host:V}=new URL(s),W=Uy(V);return this.zo(t,s,B,u,W).then((Q=>(Xn(IT,`Received RPC '${t}' ${C}: `,Q),Q)),(Q=>{throw Py(IT,`RPC '${t}' ${C} failed with error: `,Q,"url: ",s,"request:",u),Q}))}jo(t,a,u,y,T,C){return this.Wo(t,a,u,y,T)}Go(t,a,u){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Hy})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach(((y,T)=>t[T]=y)),u&&u.headers.forEach(((y,T)=>t[T]=y))}Qo(t,a){const u=WU[t];let y=`${this.qo}/v1/${a}:${u}`;return this.databaseInfo.apiKey&&(y=`${y}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),y}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El="WebChannelConnection",ov=(o,t,a)=>{o.listen(t,(u=>{try{a(u)}catch(y){setTimeout((()=>{throw y}),0)}}))};class Ey extends XU{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!Ey.c_){const t=EP();ov(t,TP.STAT_EVENT,(a=>{a.stat===aE.PROXY?Xn(El,"STAT_EVENT: detected buffering proxy"):a.stat===aE.NOPROXY&&Xn(El,"STAT_EVENT: detected no buffering proxy")})),Ey.c_=!0}}zo(t,a,u,y,T){const C=xE();return new Promise(((s,B)=>{const V=new bP;V.setWithCredentials(!0),V.listenOnce(wP.COMPLETE,(()=>{try{switch(V.getLastErrorCode()){case Lb.NO_ERROR:const Q=V.getResponseJson();Xn(El,`XHR for RPC '${t}' ${C} received:`,JSON.stringify(Q)),s(Q);break;case Lb.TIMEOUT:Xn(El,`RPC '${t}' ${C} timed out`),B(new $n(hn.DEADLINE_EXCEEDED,"Request time out"));break;case Lb.HTTP_ERROR:const oe=V.getStatus();if(Xn(El,`RPC '${t}' ${C} failed with status:`,oe,"response text:",V.getResponseText()),oe>0){let he=V.getResponseJson();Array.isArray(he)&&(he=he[0]);const Je=he==null?void 0:he.error;if(Je&&Je.status&&Je.message){const Ye=(function(st){const ft=st.toLowerCase().replace(/_/g,"-");return Object.values(hn).indexOf(ft)>=0?ft:hn.UNKNOWN})(Je.status);B(new $n(Ye,Je.message))}else B(new $n(hn.UNKNOWN,"Server responded with status "+V.getStatus()))}else B(new $n(hn.UNAVAILABLE,"Connection failed."));break;default:Bi(9055,{l_:t,streamId:C,h_:V.getLastErrorCode(),P_:V.getLastError()})}}finally{Xn(El,`RPC '${t}' ${C} completed.`)}}));const W=JSON.stringify(y);Xn(El,`RPC '${t}' ${C} sending request:`,y),V.send(a,"POST",W,u,15)}))}T_(t,a,u){const y=xE(),T=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],C=this.createWebChannelTransport(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},B=this.longPollingOptions.timeoutSeconds;B!==void 0&&(s.longPollingTimeout=Math.round(1e3*B)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Go(s.initMessageHeaders,a,u),s.encodeInitMessageHeaders=!0;const V=T.join("");Xn(El,`Creating RPC '${t}' stream ${y}: ${V}`,s);const W=C.createWebChannel(V,s);this.I_(W);let Q=!1,oe=!1;const he=new YU({Ho:Je=>{oe?Xn(El,`Not sending because RPC '${t}' stream ${y} is closed:`,Je):(Q||(Xn(El,`Opening RPC '${t}' stream ${y} transport.`),W.open(),Q=!0),Xn(El,`RPC '${t}' stream ${y} sending:`,Je),W.send(Je))},Jo:()=>W.close()});return ov(W,fv.EventType.OPEN,(()=>{oe||(Xn(El,`RPC '${t}' stream ${y} transport opened.`),he.i_())})),ov(W,fv.EventType.CLOSE,(()=>{oe||(oe=!0,Xn(El,`RPC '${t}' stream ${y} transport closed`),he.o_(),this.E_(W))})),ov(W,fv.EventType.ERROR,(Je=>{oe||(oe=!0,Py(El,`RPC '${t}' stream ${y} transport errored. Name:`,Je.name,"Message:",Je.message),he.o_(new $n(hn.UNAVAILABLE,"The operation could not be completed")))})),ov(W,fv.EventType.MESSAGE,(Je=>{var Ye;if(!oe){const Xe=Je.data[0];fs(!!Xe,16349);const st=Xe,ft=(st==null?void 0:st.error)||((Ye=st[0])==null?void 0:Ye.error);if(ft){Xn(El,`RPC '${t}' stream ${y} received error:`,ft);const ht=ft.status;let Ft=(function(je){const ze=Ka[je];if(ze!==void 0)return ak(ze)})(ht),fn=ft.message;Ft===void 0&&(Ft=hn.INTERNAL,fn="Unknown error status: "+ht+" with message "+ft.message),oe=!0,he.o_(new $n(Ft,fn)),W.close()}else Xn(El,`RPC '${t}' stream ${y} received:`,Xe),he.__(Xe)}})),Ey.u_(),setTimeout((()=>{he.s_()}),0),he}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((a=>a===t))}Go(t,a,u){super.Go(t,a,u),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return SP()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KU(o){return new Ey(o)}function CT(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(o){return new tU(o,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ey.c_=!1;class bk{constructor(t,a,u=1e3,y=1.5,T=6e4){this.Ci=t,this.timerId=a,this.R_=u,this.A_=y,this.V_=T,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const a=Math.floor(this.d_+this.y_()),u=Math.max(0,Date.now()-this.f_),y=Math.max(0,a-u);y>0&&Xn("ExponentialBackoff",`Backing off for ${y} ms (base delay: ${this.d_} ms, delay with jitter: ${a} ms, last attempt: ${u} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,y,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR="PersistentStream";class wk{constructor(t,a,u,y,T,C,s,B){this.Ci=t,this.b_=u,this.S_=y,this.connection=T,this.authCredentialsProvider=C,this.appCheckCredentialsProvider=s,this.listener=B,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new bk(t,a)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,a){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():a&&a.code===hn.RESOURCE_EXHAUSTED?(bp(a.toString()),bp("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):a&&a.code===hn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(a)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),a=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([u,y])=>{this.D_===a&&this.G_(u,y)}),(u=>{t((()=>{const y=new $n(hn.UNKNOWN,"Fetching auth token failed: "+u.message);return this.z_(y)}))}))}G_(t,a){const u=this.Q_(this.D_);this.stream=this.j_(t,a),this.stream.Zo((()=>{u((()=>this.listener.Zo()))})),this.stream.Yo((()=>{u((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((y=>{u((()=>this.z_(y)))})),this.stream.onMessage((y=>{u((()=>++this.F_==1?this.H_(y):this.onNext(y)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return Xn(jR,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return a=>{this.Ci.enqueueAndForget((()=>this.D_===t?a():(Xn(jR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class QU extends wk{constructor(t,a,u,y,T,C){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",a,u,y,C),this.serializer=T}j_(t,a){return this.connection.T_("Listen",t,a)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const a=rU(this.serializer,t),u=(function(T){if(!("targetChange"in T))return Wi.min();const C=T.targetChange;return C.targetIds&&C.targetIds.length?Wi.min():C.readTime?sf(C.readTime):Wi.min()})(t);return this.listener.J_(a,u)}Z_(t){const a={};a.database=_E(this.serializer),a.addTarget=(function(T,C){let s;const B=C.target;if(s=hE(B)?{documents:oU(T,B)}:{query:lU(T,B).ft},s.targetId=C.targetId,C.resumeToken.approximateByteSize()>0){s.resumeToken=ck(T,C.resumeToken);const V=pE(T,C.expectedCount);V!==null&&(s.expectedCount=V)}else if(C.snapshotVersion.compareTo(Wi.min())>0){s.readTime=o1(T,C.snapshotVersion.toTimestamp());const V=pE(T,C.expectedCount);V!==null&&(s.expectedCount=V)}return s})(this.serializer,t);const u=uU(this.serializer,t);u&&(a.labels=u),this.K_(a)}X_(t){const a={};a.database=_E(this.serializer),a.removeTarget=t,this.K_(a)}}class JU extends wk{constructor(t,a,u,y,T,C){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",a,u,y,C),this.serializer=T}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,a){return this.connection.T_("Write",t,a)}H_(t){return fs(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,fs(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){fs(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const a=aU(t.writeResults,t.commitTime),u=sf(t.commitTime);return this.listener.na(u,a)}ra(){const t={};t.database=_E(this.serializer),this.K_(t)}ea(t){const a={streamToken:this.lastStreamToken,writes:t.map((u=>sU(this.serializer,u)))};this.K_(a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{}class t6 extends e6{constructor(t,a,u,y){super(),this.authCredentials=t,this.appCheckCredentials=a,this.connection=u,this.serializer=y,this.ia=!1}sa(){if(this.ia)throw new $n(hn.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,a,u,y){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([T,C])=>this.connection.Wo(t,mE(a,u),y,T,C))).catch((T=>{throw T.name==="FirebaseError"?(T.code===hn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),T):new $n(hn.UNKNOWN,T.toString())}))}jo(t,a,u,y,T){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([C,s])=>this.connection.jo(t,mE(a,u),y,C,s,T))).catch((C=>{throw C.name==="FirebaseError"?(C.code===hn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),C):new $n(hn.UNKNOWN,C.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function n6(o,t,a,u){return new t6(o,t,a,u)}class i6{constructor(t,a){this.asyncQueue=t,this.onlineStateHandler=a,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const a=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(bp(a),this.aa=!1):Xn("OnlineStateTracker",a)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_="RemoteStore";class r6{constructor(t,a,u,y,T){this.localStore=t,this.datastore=a,this.asyncQueue=u,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=T,this.Aa.Mo((C=>{u.enqueueAndForget((async()=>{d_(this)&&(Xn(o_,"Restarting streams for network reachability change."),await(async function(B){const V=Ki(B);V.Ea.add(4),await Yv(V),V.Va.set("Unknown"),V.Ea.delete(4),await k1(V)})(this))}))})),this.Va=new i6(u,y)}}async function k1(o){if(d_(o))for(const t of o.Ra)await t(!0)}async function Yv(o){for(const t of o.Ra)await t(!1)}function Tk(o,t){const a=Ki(o);a.Ia.has(t.targetId)||(a.Ia.set(t.targetId,t),SS(a)?ES(a):Xy(a).O_()&&TS(a,t))}function wS(o,t){const a=Ki(o),u=Xy(a);a.Ia.delete(t),u.O_()&&Ek(a,t),a.Ia.size===0&&(u.O_()?u.L_():d_(a)&&a.Va.set("Unknown"))}function TS(o,t){if(o.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Wi.min())>0){const a=o.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(a)}Xy(o).Z_(t)}function Ek(o,t){o.da.$e(t),Xy(o).X_(t)}function ES(o){o.da=new Kj({getRemoteKeysForTarget:t=>o.remoteSyncer.getRemoteKeysForTarget(t),At:t=>o.Ia.get(t)||null,ht:()=>o.datastore.serializer.databaseId}),Xy(o).start(),o.Va.ua()}function SS(o){return d_(o)&&!Xy(o).x_()&&o.Ia.size>0}function d_(o){return Ki(o).Ea.size===0}function Sk(o){o.da=void 0}async function s6(o){o.Va.set("Online")}async function a6(o){o.Ia.forEach(((t,a)=>{TS(o,t)}))}async function o6(o,t){Sk(o),SS(o)?(o.Va.ha(t),ES(o)):o.Va.set("Unknown")}async function l6(o,t,a){if(o.Va.set("Online"),t instanceof lk&&t.state===2&&t.cause)try{await(async function(y,T){const C=T.cause;for(const s of T.targetIds)y.Ia.has(s)&&(await y.remoteSyncer.rejectListen(s,C),y.Ia.delete(s),y.da.removeTarget(s))})(o,t)}catch(u){Xn(o_,"Failed to remove targets %s: %s ",t.targetIds.join(","),u),await c1(o,u)}else if(t instanceof Bb?o.da.Xe(t):t instanceof ok?o.da.st(t):o.da.tt(t),!a.isEqual(Wi.min()))try{const u=await vk(o.localStore);a.compareTo(u)>=0&&await(function(T,C){const s=T.da.Tt(C);return s.targetChanges.forEach(((B,V)=>{if(B.resumeToken.approximateByteSize()>0){const W=T.Ia.get(V);W&&T.Ia.set(V,W.withResumeToken(B.resumeToken,C))}})),s.targetMismatches.forEach(((B,V)=>{const W=T.Ia.get(B);if(!W)return;T.Ia.set(B,W.withResumeToken(ll.EMPTY_BYTE_STRING,W.snapshotVersion)),Ek(T,B);const Q=new Dm(W.target,B,V,W.sequenceNumber);TS(T,Q)})),T.remoteSyncer.applyRemoteEvent(s)})(o,a)}catch(u){Xn(o_,"Failed to raise snapshot:",u),await c1(o,u)}}async function c1(o,t,a){if(!Zy(t))throw t;o.Ea.add(1),await Yv(o),o.Va.set("Offline"),a||(a=()=>vk(o.localStore)),o.asyncQueue.enqueueRetryable((async()=>{Xn(o_,"Retrying IndexedDB access"),await a(),o.Ea.delete(1),await k1(o)}))}function Ak(o,t){return t().catch((a=>c1(o,a,t)))}async function L1(o){const t=Ki(o),a=Gm(t);let u=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:cS;for(;c6(t);)try{const y=await GU(t.localStore,u);if(y===null){t.Ta.length===0&&a.L_();break}u=y.batchId,u6(t,y)}catch(y){await c1(t,y)}Ik(t)&&Ck(t)}function c6(o){return d_(o)&&o.Ta.length<10}function u6(o,t){o.Ta.push(t);const a=Gm(o);a.O_()&&a.Y_&&a.ea(t.mutations)}function Ik(o){return d_(o)&&!Gm(o).x_()&&o.Ta.length>0}function Ck(o){Gm(o).start()}async function h6(o){Gm(o).ra()}async function d6(o){const t=Gm(o);for(const a of o.Ta)t.ea(a.mutations)}async function f6(o,t,a){const u=o.Ta.shift(),y=mS.from(u,t,a);await Ak(o,(()=>o.remoteSyncer.applySuccessfulWrite(y))),await L1(o)}async function p6(o,t){t&&Gm(o).Y_&&await(async function(u,y){if((function(C){return Wj(C)&&C!==hn.ABORTED})(y.code)){const T=u.Ta.shift();Gm(u).B_(),await Ak(u,(()=>u.remoteSyncer.rejectFailedWrite(T.batchId,y))),await L1(u)}})(o,t),Ik(o)&&Ck(o)}async function UR(o,t){const a=Ki(o);a.asyncQueue.verifyOperationInProgress(),Xn(o_,"RemoteStore received new credentials");const u=d_(a);a.Ea.add(3),await Yv(a),u&&a.Va.set("Unknown"),await a.remoteSyncer.handleCredentialChange(t),a.Ea.delete(3),await k1(a)}async function m6(o,t){const a=Ki(o);t?(a.Ea.delete(2),await k1(a)):t||(a.Ea.add(2),await Yv(a),a.Va.set("Unknown"))}function Xy(o){return o.ma||(o.ma=(function(a,u,y){const T=Ki(a);return T.sa(),new QU(u,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,y)})(o.datastore,o.asyncQueue,{Zo:s6.bind(null,o),Yo:a6.bind(null,o),t_:o6.bind(null,o),J_:l6.bind(null,o)}),o.Ra.push((async t=>{t?(o.ma.B_(),SS(o)?ES(o):o.Va.set("Unknown")):(await o.ma.stop(),Sk(o))}))),o.ma}function Gm(o){return o.fa||(o.fa=(function(a,u,y){const T=Ki(a);return T.sa(),new JU(u,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,y)})(o.datastore,o.asyncQueue,{Zo:()=>Promise.resolve(),Yo:h6.bind(null,o),t_:p6.bind(null,o),ta:d6.bind(null,o),na:f6.bind(null,o)}),o.Ra.push((async t=>{t?(o.fa.B_(),await L1(o)):(await o.fa.stop(),o.Ta.length>0&&(Xn(o_,`Stopping write stream with ${o.Ta.length} pending writes`),o.Ta=[]))}))),o.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{constructor(t,a,u,y,T){this.asyncQueue=t,this.timerId=a,this.targetTimeMs=u,this.op=y,this.removalCallback=T,this.deferred=new Om,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((C=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,a,u,y,T){const C=Date.now()+u,s=new AS(t,a,C,y,T);return s.start(u),s}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $n(hn.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function IS(o,t){if(bp("AsyncQueue",`${t}: ${o}`),Zy(o))return new $n(hn.UNAVAILABLE,`${t}: ${o}`);throw o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{static emptySet(t){return new Sy(t.comparator)}constructor(t){this.comparator=t?(a,u)=>t(a,u)||vi.comparator(a.key,u.key):(a,u)=>vi.comparator(a.key,u.key),this.keyedMap=pv(),this.sortedSet=new pa(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const a=this.keyedMap.get(t);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((a,u)=>(t(a),!1)))}add(t){const a=this.delete(t.key);return a.copy(a.keyedMap.insert(t.key,t),a.sortedSet.insert(t,null))}delete(t){const a=this.get(t);return a?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(a)):this}isEqual(t){if(!(t instanceof Sy)||this.size!==t.size)return!1;const a=this.sortedSet.getIterator(),u=t.sortedSet.getIterator();for(;a.hasNext();){const y=a.getNext().key,T=u.getNext().key;if(!y.isEqual(T))return!1}return!0}toString(){const t=[];return this.forEach((a=>{t.push(a.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,a){const u=new Sy;return u.comparator=this.comparator,u.keyedMap=t,u.sortedSet=a,u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(){this.ga=new pa(vi.comparator)}track(t){const a=t.doc.key,u=this.ga.get(a);u?t.type!==0&&u.type===3?this.ga=this.ga.insert(a,t):t.type===3&&u.type!==1?this.ga=this.ga.insert(a,{type:u.type,doc:t.doc}):t.type===2&&u.type===2?this.ga=this.ga.insert(a,{type:2,doc:t.doc}):t.type===2&&u.type===0?this.ga=this.ga.insert(a,{type:0,doc:t.doc}):t.type===1&&u.type===0?this.ga=this.ga.remove(a):t.type===1&&u.type===2?this.ga=this.ga.insert(a,{type:1,doc:u.doc}):t.type===0&&u.type===1?this.ga=this.ga.insert(a,{type:2,doc:t.doc}):Bi(63341,{Vt:t,pa:u}):this.ga=this.ga.insert(a,t)}ya(){const t=[];return this.ga.inorderTraversal(((a,u)=>{t.push(u)})),t}}class Ny{constructor(t,a,u,y,T,C,s,B,V){this.query=t,this.docs=a,this.oldDocs=u,this.docChanges=y,this.mutatedKeys=T,this.fromCache=C,this.syncStateChanged=s,this.excludesMetadataChanges=B,this.hasCachedResults=V}static fromInitialDocuments(t,a,u,y,T){const C=[];return a.forEach((s=>{C.push({type:0,doc:s})})),new Ny(t,a,Sy.emptySet(a),C,u,y,!0,!1,T)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&I1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const a=this.docChanges,u=t.docChanges;if(a.length!==u.length)return!1;for(let y=0;y<a.length;y++)if(a[y].type!==u[y].type||!a[y].doc.isEqual(u[y].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((t=>t.Da()))}}class _6{constructor(){this.queries=qR(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(a,u){const y=Ki(a),T=y.queries;y.queries=qR(),T.forEach(((C,s)=>{for(const B of s.ba)B.onError(u)}))})(this,new $n(hn.ABORTED,"Firestore shutting down"))}}function qR(){return new u_((o=>ZP(o)),I1)}async function Rk(o,t){const a=Ki(o);let u=3;const y=t.query;let T=a.queries.get(y);T?!T.Sa()&&t.Da()&&(u=2):(T=new g6,u=t.Da()?0:1);try{switch(u){case 0:T.wa=await a.onListen(y,!0);break;case 1:T.wa=await a.onListen(y,!1);break;case 2:await a.onFirstRemoteStoreListen(y)}}catch(C){const s=IS(C,`Initialization of query '${yy(t.query)}' failed`);return void t.onError(s)}a.queries.set(y,T),T.ba.push(t),t.va(a.onlineState),T.wa&&t.Fa(T.wa)&&CS(a)}async function Mk(o,t){const a=Ki(o),u=t.query;let y=3;const T=a.queries.get(u);if(T){const C=T.ba.indexOf(t);C>=0&&(T.ba.splice(C,1),T.ba.length===0?y=t.Da()?0:1:!T.Sa()&&t.Da()&&(y=2))}switch(y){case 0:return a.queries.delete(u),a.onUnlisten(u,!0);case 1:return a.queries.delete(u),a.onUnlisten(u,!1);case 2:return a.onLastRemoteStoreUnlisten(u);default:return}}function y6(o,t){const a=Ki(o);let u=!1;for(const y of t){const T=y.query,C=a.queries.get(T);if(C){for(const s of C.ba)s.Fa(y)&&(u=!0);C.wa=y}}u&&CS(a)}function x6(o,t,a){const u=Ki(o),y=u.queries.get(t);if(y)for(const T of y.ba)T.onError(a);u.queries.delete(t)}function CS(o){o.Ca.forEach((t=>{t.next()}))}var vE,HR;(HR=vE||(vE={})).Ma="default",HR.Cache="cache";class Dk{constructor(t,a,u){this.query=t,this.xa=a,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=u||{}}Fa(t){if(!this.options.includeMetadataChanges){const u=[];for(const y of t.docChanges)y.type!==3&&u.push(y);t=new Ny(t.query,t.docs,t.oldDocs,u,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let a=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),a=!0):this.La(t,this.onlineState)&&(this.ka(t),a=!0),this.Na=t,a}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let a=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),a=!0),a}La(t,a){if(!t.fromCache||!this.Da())return!0;const u=a!=="Offline";return(!this.options.Ka||!u)&&(!t.docs.isEmpty()||t.hasCachedResults||a==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const a=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!a)&&this.options.includeMetadataChanges===!0}ka(t){t=Ny.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==vE.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(t){this.key=t}}class kk{constructor(t){this.key=t}}class v6{constructor(t,a){this.query=t,this.Za=a,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Pr(),this.mutatedKeys=Pr(),this.eu=WP(t),this.tu=new Sy(this.eu)}get nu(){return this.Za}ru(t,a){const u=a?a.iu:new GR,y=a?a.tu:this.tu;let T=a?a.mutatedKeys:this.mutatedKeys,C=y,s=!1;const B=this.query.limitType==="F"&&y.size===this.query.limit?y.last():null,V=this.query.limitType==="L"&&y.size===this.query.limit?y.first():null;if(t.inorderTraversal(((W,Q)=>{const oe=y.get(W),he=C1(this.query,Q)?Q:null,Je=!!oe&&this.mutatedKeys.has(oe.key),Ye=!!he&&(he.hasLocalMutations||this.mutatedKeys.has(he.key)&&he.hasCommittedMutations);let Xe=!1;oe&&he?oe.data.isEqual(he.data)?Je!==Ye&&(u.track({type:3,doc:he}),Xe=!0):this.su(oe,he)||(u.track({type:2,doc:he}),Xe=!0,(B&&this.eu(he,B)>0||V&&this.eu(he,V)<0)&&(s=!0)):!oe&&he?(u.track({type:0,doc:he}),Xe=!0):oe&&!he&&(u.track({type:1,doc:oe}),Xe=!0,(B||V)&&(s=!0)),Xe&&(he?(C=C.add(he),T=Ye?T.add(W):T.delete(W)):(C=C.delete(W),T=T.delete(W)))})),this.query.limit!==null)for(;C.size>this.query.limit;){const W=this.query.limitType==="F"?C.last():C.first();C=C.delete(W.key),T=T.delete(W.key),u.track({type:1,doc:W})}return{tu:C,iu:u,Ss:s,mutatedKeys:T}}su(t,a){return t.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(t,a,u,y){const T=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const C=t.iu.ya();C.sort(((W,Q)=>(function(he,Je){const Ye=Xe=>{switch(Xe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Bi(20277,{Vt:Xe})}};return Ye(he)-Ye(Je)})(W.type,Q.type)||this.eu(W.doc,Q.doc))),this.ou(u),y=y??!1;const s=a&&!y?this._u():[],B=this.Ya.size===0&&this.current&&!y?1:0,V=B!==this.Xa;return this.Xa=B,C.length!==0||V?{snapshot:new Ny(this.query,t.tu,T,C,t.mutatedKeys,B===0,V,!1,!!u&&u.resumeToken.approximateByteSize()>0),au:s}:{au:s}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new GR,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((a=>this.Za=this.Za.add(a))),t.modifiedDocuments.forEach((a=>{})),t.removedDocuments.forEach((a=>this.Za=this.Za.delete(a))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=Pr(),this.tu.forEach((u=>{this.uu(u.key)&&(this.Ya=this.Ya.add(u.key))}));const a=[];return t.forEach((u=>{this.Ya.has(u)||a.push(new kk(u))})),this.Ya.forEach((u=>{t.has(u)||a.push(new Pk(u))})),a}cu(t){this.Za=t.ks,this.Ya=Pr();const a=this.ru(t.documents);return this.applyChanges(a,!0)}lu(){return Ny.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const RS="SyncEngine";class b6{constructor(t,a,u){this.query=t,this.targetId=a,this.view=u}}class w6{constructor(t){this.key=t,this.hu=!1}}class T6{constructor(t,a,u,y,T,C){this.localStore=t,this.remoteStore=a,this.eventManager=u,this.sharedClientState=y,this.currentUser=T,this.maxConcurrentLimboResolutions=C,this.Pu={},this.Tu=new u_((s=>ZP(s)),I1),this.Iu=new Map,this.Eu=new Set,this.Ru=new pa(vi.comparator),this.Au=new Map,this.Vu=new yS,this.du={},this.mu=new Map,this.fu=Oy.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function E6(o,t,a=!0){const u=Fk(o);let y;const T=u.Tu.get(t);return T?(u.sharedClientState.addLocalQueryTarget(T.targetId),y=T.view.lu()):y=await Lk(u,t,a,!0),y}async function S6(o,t){const a=Fk(o);await Lk(a,t,!0,!1)}async function Lk(o,t,a,u){const y=await qU(o.localStore,nf(t)),T=y.targetId,C=o.sharedClientState.addLocalQueryTarget(T,a);let s;return u&&(s=await A6(o,t,T,C==="current",y.resumeToken)),o.isPrimaryClient&&a&&Tk(o.remoteStore,y),s}async function A6(o,t,a,u,y){o.pu=(Q,oe,he)=>(async function(Ye,Xe,st,ft){let ht=Xe.view.ru(st);ht.Ss&&(ht=await NR(Ye.localStore,Xe.query,!1).then((({documents:je})=>Xe.view.ru(je,ht))));const Ft=ft&&ft.targetChanges.get(Xe.targetId),fn=ft&&ft.targetMismatches.get(Xe.targetId)!=null,St=Xe.view.applyChanges(ht,Ye.isPrimaryClient,Ft,fn);return ZR(Ye,Xe.targetId,St.au),St.snapshot})(o,Q,oe,he);const T=await NR(o.localStore,t,!0),C=new v6(t,T.ks),s=C.ru(T.documents),B=Xv.createSynthesizedTargetChangeForCurrentChange(a,u&&o.onlineState!=="Offline",y),V=C.applyChanges(s,o.isPrimaryClient,B);ZR(o,a,V.au);const W=new b6(t,a,C);return o.Tu.set(t,W),o.Iu.has(a)?o.Iu.get(a).push(t):o.Iu.set(a,[t]),V.snapshot}async function I6(o,t,a){const u=Ki(o),y=u.Tu.get(t),T=u.Iu.get(y.targetId);if(T.length>1)return u.Iu.set(y.targetId,T.filter((C=>!I1(C,t)))),void u.Tu.delete(t);u.isPrimaryClient?(u.sharedClientState.removeLocalQueryTarget(y.targetId),u.sharedClientState.isActiveQueryTarget(y.targetId)||await yE(u.localStore,y.targetId,!1).then((()=>{u.sharedClientState.clearQueryState(y.targetId),a&&wS(u.remoteStore,y.targetId),bE(u,y.targetId)})).catch($y)):(bE(u,y.targetId),await yE(u.localStore,y.targetId,!0))}async function C6(o,t){const a=Ki(o),u=a.Tu.get(t),y=a.Iu.get(u.targetId);a.isPrimaryClient&&y.length===1&&(a.sharedClientState.removeLocalQueryTarget(u.targetId),wS(a.remoteStore,u.targetId))}async function R6(o,t,a){const u=O6(o);try{const y=await(function(C,s){const B=Ki(C),V=Ws.now(),W=s.reduce(((he,Je)=>he.add(Je.key)),Pr());let Q,oe;return B.persistence.runTransaction("Locally write mutations","readwrite",(he=>{let Je=wp(),Ye=Pr();return B.xs.getEntries(he,W).next((Xe=>{Je=Xe,Je.forEach(((st,ft)=>{ft.isValidDocument()||(Ye=Ye.add(st))}))})).next((()=>B.localDocuments.getOverlayedDocuments(he,Je))).next((Xe=>{Q=Xe;const st=[];for(const ft of s){const ht=Gj(ft,Q.get(ft.key).overlayedDocument);ht!=null&&st.push(new h_(ft.key,ht,FP(ht.value.mapValue),rf.exists(!0)))}return B.mutationQueue.addMutationBatch(he,V,st,s)})).next((Xe=>{oe=Xe;const st=Xe.applyToLocalDocumentSet(Q,Ye);return B.documentOverlayCache.saveOverlays(he,Xe.batchId,st)}))})).then((()=>({batchId:oe.batchId,changes:YP(Q)})))})(u.localStore,t);u.sharedClientState.addPendingMutation(y.batchId),(function(C,s,B){let V=C.du[C.currentUser.toKey()];V||(V=new pa(Dr)),V=V.insert(s,B),C.du[C.currentUser.toKey()]=V})(u,y.batchId,a),await Kv(u,y.changes),await L1(u.remoteStore)}catch(y){const T=IS(y,"Failed to persist write");a.reject(T)}}async function zk(o,t){const a=Ki(o);try{const u=await jU(a.localStore,t);t.targetChanges.forEach(((y,T)=>{const C=a.Au.get(T);C&&(fs(y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size<=1,22616),y.addedDocuments.size>0?C.hu=!0:y.modifiedDocuments.size>0?fs(C.hu,14607):y.removedDocuments.size>0&&(fs(C.hu,42227),C.hu=!1))})),await Kv(a,u,t)}catch(u){await $y(u)}}function $R(o,t,a){const u=Ki(o);if(u.isPrimaryClient&&a===0||!u.isPrimaryClient&&a===1){const y=[];u.Tu.forEach(((T,C)=>{const s=C.view.va(t);s.snapshot&&y.push(s.snapshot)})),(function(C,s){const B=Ki(C);B.onlineState=s;let V=!1;B.queries.forEach(((W,Q)=>{for(const oe of Q.ba)oe.va(s)&&(V=!0)})),V&&CS(B)})(u.eventManager,t),y.length&&u.Pu.J_(y),u.onlineState=t,u.isPrimaryClient&&u.sharedClientState.setOnlineState(t)}}async function M6(o,t,a){const u=Ki(o);u.sharedClientState.updateQueryState(t,"rejected",a);const y=u.Au.get(t),T=y&&y.key;if(T){let C=new pa(vi.comparator);C=C.insert(T,Al.newNoDocument(T,Wi.min()));const s=Pr().add(T),B=new D1(Wi.min(),new Map,new pa(Dr),C,s);await zk(u,B),u.Ru=u.Ru.remove(T),u.Au.delete(t),MS(u)}else await yE(u.localStore,t,!1).then((()=>bE(u,t,a))).catch($y)}async function D6(o,t){const a=Ki(o),u=t.batch.batchId;try{const y=await VU(a.localStore,t);Nk(a,u,null),Ok(a,u),a.sharedClientState.updateMutationState(u,"acknowledged"),await Kv(a,y)}catch(y){await $y(y)}}async function P6(o,t,a){const u=Ki(o);try{const y=await(function(C,s){const B=Ki(C);return B.persistence.runTransaction("Reject batch","readwrite-primary",(V=>{let W;return B.mutationQueue.lookupMutationBatch(V,s).next((Q=>(fs(Q!==null,37113),W=Q.keys(),B.mutationQueue.removeMutationBatch(V,Q)))).next((()=>B.mutationQueue.performConsistencyCheck(V))).next((()=>B.documentOverlayCache.removeOverlaysForBatchId(V,W,s))).next((()=>B.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(V,W))).next((()=>B.localDocuments.getDocuments(V,W)))}))})(u.localStore,t);Nk(u,t,a),Ok(u,t),u.sharedClientState.updateMutationState(t,"rejected",a),await Kv(u,y)}catch(y){await $y(y)}}function Ok(o,t){(o.mu.get(t)||[]).forEach((a=>{a.resolve()})),o.mu.delete(t)}function Nk(o,t,a){const u=Ki(o);let y=u.du[u.currentUser.toKey()];if(y){const T=y.get(t);T&&(a?T.reject(a):T.resolve(),y=y.remove(t)),u.du[u.currentUser.toKey()]=y}}function bE(o,t,a=null){o.sharedClientState.removeLocalQueryTarget(t);for(const u of o.Iu.get(t))o.Tu.delete(u),a&&o.Pu.yu(u,a);o.Iu.delete(t),o.isPrimaryClient&&o.Vu.Gr(t).forEach((u=>{o.Vu.containsKey(u)||Bk(o,u)}))}function Bk(o,t){o.Eu.delete(t.path.canonicalString());const a=o.Ru.get(t);a!==null&&(wS(o.remoteStore,a),o.Ru=o.Ru.remove(t),o.Au.delete(a),MS(o))}function ZR(o,t,a){for(const u of a)u instanceof Pk?(o.Vu.addReference(u.key,t),k6(o,u)):u instanceof kk?(Xn(RS,"Document no longer in limbo: "+u.key),o.Vu.removeReference(u.key,t),o.Vu.containsKey(u.key)||Bk(o,u.key)):Bi(19791,{wu:u})}function k6(o,t){const a=t.key,u=a.path.canonicalString();o.Ru.get(a)||o.Eu.has(u)||(Xn(RS,"New document in limbo: "+a),o.Eu.add(u),MS(o))}function MS(o){for(;o.Eu.size>0&&o.Ru.size<o.maxConcurrentLimboResolutions;){const t=o.Eu.values().next().value;o.Eu.delete(t);const a=new vi(Os.fromString(t)),u=o.fu.next();o.Au.set(u,new w6(a)),o.Ru=o.Ru.insert(a,u),Tk(o.remoteStore,new Dm(nf(A1(a.path)),u,"TargetPurposeLimboResolution",T1.ce))}}async function Kv(o,t,a){const u=Ki(o),y=[],T=[],C=[];u.Tu.isEmpty()||(u.Tu.forEach(((s,B)=>{C.push(u.pu(B,t,a).then((V=>{var W;if((V||a)&&u.isPrimaryClient){const Q=V?!V.fromCache:(W=a==null?void 0:a.targetChanges.get(B.targetId))==null?void 0:W.current;u.sharedClientState.updateQueryState(B.targetId,Q?"current":"not-current")}if(V){y.push(V);const Q=vS.Es(B.targetId,V);T.push(Q)}})))})),await Promise.all(C),u.Pu.J_(y),await(async function(B,V){const W=Ki(B);try{await W.persistence.runTransaction("notifyLocalViewChanges","readwrite",(Q=>pn.forEach(V,(oe=>pn.forEach(oe.Ts,(he=>W.persistence.referenceDelegate.addReference(Q,oe.targetId,he))).next((()=>pn.forEach(oe.Is,(he=>W.persistence.referenceDelegate.removeReference(Q,oe.targetId,he)))))))))}catch(Q){if(!Zy(Q))throw Q;Xn(bS,"Failed to update sequence numbers: "+Q)}for(const Q of V){const oe=Q.targetId;if(!Q.fromCache){const he=W.vs.get(oe),Je=he.snapshotVersion,Ye=he.withLastLimboFreeSnapshotVersion(Je);W.vs=W.vs.insert(oe,Ye)}}})(u.localStore,T))}async function L6(o,t){const a=Ki(o);if(!a.currentUser.isEqual(t)){Xn(RS,"User change. New user:",t.toKey());const u=await xk(a.localStore,t);a.currentUser=t,(function(T,C){T.mu.forEach((s=>{s.forEach((B=>{B.reject(new $n(hn.CANCELLED,C))}))})),T.mu.clear()})(a,"'waitForPendingWrites' promise is rejected due to a user change."),a.sharedClientState.handleUserChange(t,u.removedBatchIds,u.addedBatchIds),await Kv(a,u.Ns)}}function z6(o,t){const a=Ki(o),u=a.Au.get(t);if(u&&u.hu)return Pr().add(u.key);{let y=Pr();const T=a.Iu.get(t);if(!T)return y;for(const C of T){const s=a.Tu.get(C);y=y.unionWith(s.view.nu)}return y}}function Fk(o){const t=Ki(o);return t.remoteStore.remoteSyncer.applyRemoteEvent=zk.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=z6.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=M6.bind(null,t),t.Pu.J_=y6.bind(null,t.eventManager),t.Pu.yu=x6.bind(null,t.eventManager),t}function O6(o){const t=Ki(o);return t.remoteStore.remoteSyncer.applySuccessfulWrite=D6.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=P6.bind(null,t),t}class u1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=P1(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,a){return null}Mu(t,a){return null}vu(t){return FU(this.persistence,new OU,t.initialUser,this.serializer)}Cu(t){return new yk(xS.Vi,this.serializer)}Du(t){return new $U}async terminate(){var t,a;(t=this.gcScheduler)==null||t.stop(),(a=this.indexBackfillerScheduler)==null||a.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}u1.provider={build:()=>new u1};class N6 extends u1{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,a){fs(this.persistence.referenceDelegate instanceof l1,46915);const u=this.persistence.referenceDelegate.garbageCollector;return new bU(u,t.asyncQueue,a)}Cu(t){const a=this.cacheSizeBytes!==void 0?Dc.withCacheSize(this.cacheSizeBytes):Dc.DEFAULT;return new yk((u=>l1.Vi(u,a)),this.serializer)}}class wE{async initialize(t,a){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=u=>$R(this.syncEngine,u,1),this.remoteStore.remoteSyncer.handleCredentialChange=L6.bind(null,this.syncEngine),await m6(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new _6})()}createDatastore(t){const a=P1(t.databaseInfo.databaseId),u=KU(t.databaseInfo);return n6(t.authCredentials,t.appCheckCredentials,u,a)}createRemoteStore(t){return(function(u,y,T,C,s){return new r6(u,y,T,C,s)})(this.localStore,this.datastore,t.asyncQueue,(a=>$R(this.syncEngine,a,0)),(function(){return VR.v()?new VR:new ZU})())}createSyncEngine(t,a){return(function(y,T,C,s,B,V,W){const Q=new T6(y,T,C,s,B,V);return W&&(Q.gu=!0),Q})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,a)}async terminate(){var t,a;await(async function(y){const T=Ki(y);Xn(o_,"RemoteStore shutting down."),T.Ea.add(5),await Yv(T),T.Aa.shutdown(),T.Va.set("Unknown")})(this.remoteStore),(t=this.datastore)==null||t.terminate(),(a=this.eventManager)==null||a.terminate()}}wE.provider={build:()=>new wE};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):bp("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,a){setTimeout((()=>{this.muted||t(a)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm="FirestoreClient";class B6{constructor(t,a,u,y,T){this.authCredentials=t,this.appCheckCredentials=a,this.asyncQueue=u,this._databaseInfo=y,this.user=Sl.UNAUTHENTICATED,this.clientId=lS.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=T,this.authCredentials.start(u,(async C=>{Xn(qm,"Received user=",C.uid),await this.authCredentialListener(C),this.user=C})),this.appCheckCredentials.start(u,(C=>(Xn(qm,"Received new app check token=",C),this.appCheckCredentialListener(C,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Om;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(a){const u=IS(a,"Failed to shutdown persistence");t.reject(u)}})),t.promise}}async function RT(o,t){o.asyncQueue.verifyOperationInProgress(),Xn(qm,"Initializing OfflineComponentProvider");const a=o.configuration;await t.initialize(a);let u=a.initialUser;o.setCredentialChangeListener((async y=>{u.isEqual(y)||(await xk(t.localStore,y),u=y)})),t.persistence.setDatabaseDeletedListener((()=>o.terminate())),o._offlineComponents=t}async function WR(o,t){o.asyncQueue.verifyOperationInProgress();const a=await F6(o);Xn(qm,"Initializing OnlineComponentProvider"),await t.initialize(a,o.configuration),o.setCredentialChangeListener((u=>UR(t.remoteStore,u))),o.setAppCheckTokenChangeListener(((u,y)=>UR(t.remoteStore,y))),o._onlineComponents=t}async function F6(o){if(!o._offlineComponents)if(o._uninitializedComponentsProvider){Xn(qm,"Using user provided OfflineComponentProvider");try{await RT(o,o._uninitializedComponentsProvider._offline)}catch(t){const a=t;if(!(function(y){return y.name==="FirebaseError"?y.code===hn.FAILED_PRECONDITION||y.code===hn.UNIMPLEMENTED:!(typeof DOMException<"u"&&y instanceof DOMException)||y.code===22||y.code===20||y.code===11})(a))throw a;Py("Error using user provided cache. Falling back to memory cache: "+a),await RT(o,new u1)}}else Xn(qm,"Using default OfflineComponentProvider"),await RT(o,new N6(void 0));return o._offlineComponents}async function jk(o){return o._onlineComponents||(o._uninitializedComponentsProvider?(Xn(qm,"Using user provided OnlineComponentProvider"),await WR(o,o._uninitializedComponentsProvider._online)):(Xn(qm,"Using default OnlineComponentProvider"),await WR(o,new wE))),o._onlineComponents}function V6(o){return jk(o).then((t=>t.syncEngine))}async function TE(o){const t=await jk(o),a=t.eventManager;return a.onListen=E6.bind(null,t.syncEngine),a.onUnlisten=I6.bind(null,t.syncEngine),a.onFirstRemoteStoreListen=S6.bind(null,t.syncEngine),a.onLastRemoteStoreUnlisten=C6.bind(null,t.syncEngine),a}function j6(o,t,a,u){const y=new Vk(u),T=new Dk(t,y,a);return o.asyncQueue.enqueueAndForget((async()=>Rk(await TE(o),T))),()=>{y.Nu(),o.asyncQueue.enqueueAndForget((async()=>Mk(await TE(o),T)))}}function U6(o,t,a={}){const u=new Om;return o.asyncQueue.enqueueAndForget((async()=>(function(T,C,s,B,V){const W=new Vk({next:oe=>{W.Nu(),C.enqueueAndForget((()=>Mk(T,Q)));const he=oe.docs.has(s);!he&&oe.fromCache?V.reject(new $n(hn.UNAVAILABLE,"Failed to get document because the client is offline.")):he&&oe.fromCache&&B&&B.source==="server"?V.reject(new $n(hn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):V.resolve(oe)},error:oe=>V.reject(oe)}),Q=new Dk(A1(s.path),W,{includeMetadataChanges:!0,Ka:!0});return Rk(T,Q)})(await TE(o),o.asyncQueue,t,a,u))),u.promise}function G6(o,t){const a=new Om;return o.asyncQueue.enqueueAndForget((async()=>R6(await V6(o),t,a))),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uk(o){const t={};return o.timeoutSeconds!==void 0&&(t.timeoutSeconds=o.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q6="ComponentProvider",XR=new Map;function H6(o,t,a,u,y){return new uj(o,t,a,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,Uk(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator,u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk="firestore.googleapis.com",YR=!0;class KR{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new $n(hn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Gk,this.ssl=YR}else this.host=t.host,this.ssl=t.ssl??YR;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=_k;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<xU)throw new $n(hn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}JV("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Uk(t.experimentalLongPollingOptions??{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new $n(hn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new $n(hn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new $n(hn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(u,y){return u.timeoutSeconds===y.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class z1{constructor(t,a,u,y){this._authCredentials=t,this._appCheckCredentials=a,this._databaseId=u,this._app=y,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new KR({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $n(hn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new $n(hn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new KR(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(u){if(!u)return new GV;switch(u.type){case"firstParty":return new ZV(u.sessionIndex||"0",u.iamToken||null,u.authTokenFactory||null);case"provider":return u.client;default:throw new $n(hn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(a){const u=XR.get(a);u&&(Xn(q6,"Removing Datastore"),XR.delete(a),u.terminate())})(this),Promise.resolve()}}function $6(o,t,a,u={}){var V;o=_p(o,z1);const y=Uy(t),T=o._getSettings(),C={...T,emulatorOptions:o._getEmulatorOptions()},s=`${t}:${a}`;y&&(OD(`https://${s}`),ND("Firestore",!0)),T.host!==Gk&&T.host!==s&&Py("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const B={...T,host:s,ssl:y,emulatorOptions:u};if(!i_(B,C)&&(o._setSettings(B),u.mockUserToken)){let W,Q;if(typeof u.mockUserToken=="string")W=u.mockUserToken,Q=Sl.MOCK_USER;else{W=dF(u.mockUserToken,(V=o._app)==null?void 0:V.options.projectId);const oe=u.mockUserToken.sub||u.mockUserToken.user_id;if(!oe)throw new $n(hn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");Q=new Sl(oe)}o._authCredentials=new qV(new IP(W,Q))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(t,a,u){this.converter=a,this._query=u,this.type="query",this.firestore=t}withConverter(t){return new f_(this.firestore,t,this._query)}}class Fa{constructor(t,a,u){this.converter=a,this._key=u,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nm(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Fa(this.firestore,t,this._key)}toJSON(){return{type:Fa._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,a,u){if(Zv(a,Fa._jsonSchema))return new Fa(t,u||null,new vi(Os.fromString(a.referencePath)))}}Fa._jsonSchemaVersion="firestore/documentReference/1.0",Fa._jsonSchema={type:eo("string",Fa._jsonSchemaVersion),referencePath:eo("string")};class Nm extends f_{constructor(t,a,u){super(t,a,A1(u)),this._path=u,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Fa(this.firestore,null,new vi(t))}withConverter(t){return new Nm(this.firestore,t,this._path)}}function O1(o,t,...a){if(o=ic(o),CP("collection","path",t),o instanceof z1){const u=Os.fromString(t,...a);return uR(u),new Nm(o,null,u)}{if(!(o instanceof Fa||o instanceof Nm))throw new $n(hn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=o._path.child(Os.fromString(t,...a));return uR(u),new Nm(o.firestore,null,u)}}function p_(o,t,...a){if(o=ic(o),arguments.length===1&&(t=lS.newId()),CP("doc","path",t),o instanceof z1){const u=Os.fromString(t,...a);return cR(u),new Fa(o,null,new vi(u))}{if(!(o instanceof Fa||o instanceof Nm))throw new $n(hn.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=o._path.child(Os.fromString(t,...a));return cR(u),new Fa(o.firestore,o instanceof Nm?o.converter:null,new vi(u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR="AsyncQueue";class JR{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new bk(this,"async_queue_retry"),this._c=()=>{const u=CT();u&&Xn(QR,"Visibility state changed to "+u.visibilityState),this.M_.w_()},this.ac=t;const a=CT();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const a=CT();a&&typeof a.removeEventListener=="function"&&a.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const a=new Om;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(a.resolve,a.reject),a.promise))).then((()=>a.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!Zy(t))throw t;Xn(QR,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const a=this.ac.then((()=>(this.rc=!0,t().catch((u=>{throw this.nc=u,this.rc=!1,bp("INTERNAL UNHANDLED ERROR: ",eM(u)),u})).then((u=>(this.rc=!1,u))))));return this.ac=a,a}enqueueAfterDelay(t,a,u){this.uc(),this.oc.indexOf(t)>-1&&(a=0);const y=AS.createAndSchedule(this,t,a,u,(T=>this.hc(T)));return this.tc.push(y),y}uc(){this.nc&&Bi(47125,{Pc:eM(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const a of this.tc)if(a.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((a,u)=>a.targetTimeMs-u.targetTimeMs));for(const a of this.tc)if(a.skipDelay(),t!=="all"&&a.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const a=this.tc.indexOf(t);this.tc.splice(a,1)}}function eM(o){let t=o.message||"";return o.stack&&(t=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),t}class By extends z1{constructor(t,a,u,y){super(t,a,u,y),this.type="firestore",this._queue=new JR,this._persistenceKey=(y==null?void 0:y.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new JR(t),this._firestoreClient=void 0,await t}}}function Z6(o,t){const a=typeof o=="object"?o:jD(),u=typeof o=="string"?o:i1,y=YE(a,"firestore").getImmediate({identifier:u});if(!y._initialized){const T=uF("firestore");T&&$6(y,...T)}return y}function DS(o){if(o._terminated)throw new $n(hn.FAILED_PRECONDITION,"The client has already been terminated.");return o._firestoreClient||W6(o),o._firestoreClient}function W6(o){var u,y,T,C;const t=o._freezeSettings(),a=H6(o._databaseId,((u=o._app)==null?void 0:u.options.appId)||"",o._persistenceKey,(y=o._app)==null?void 0:y.options.apiKey,t);o._componentsProvider||(T=t.localCache)!=null&&T._offlineComponentProvider&&((C=t.localCache)!=null&&C._onlineComponentProvider)&&(o._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),o._firestoreClient=new B6(o._authCredentials,o._appCheckCredentials,o._queue,a,o._componentsProvider&&(function(B){const V=B==null?void 0:B._online.build();return{_offline:B==null?void 0:B._offline.build(V),_online:V}})(o._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ju(ll.fromBase64String(t))}catch(a){throw new $n(hn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(t){return new Ju(ll.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ju._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Zv(t,Ju._jsonSchema))return Ju.fromBase64String(t.bytes)}}Ju._jsonSchemaVersion="firestore/bytes/1.0",Ju._jsonSchema={type:eo("string",Ju._jsonSchemaVersion),bytes:eo("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(...t){for(let a=0;a<t.length;++a)if(t[a].length===0)throw new $n(hn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ol(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(t,a){if(!isFinite(t)||t<-90||t>90)throw new $n(hn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(a)||a<-180||a>180)throw new $n(hn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+a);this._lat=t,this._long=a}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Dr(this._lat,t._lat)||Dr(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:af._jsonSchemaVersion}}static fromJSON(t){if(Zv(t,af._jsonSchema))return new af(t.latitude,t.longitude)}}af._jsonSchemaVersion="firestore/geoPoint/1.0",af._jsonSchema={type:eo("string",af._jsonSchemaVersion),latitude:eo("number"),longitude:eo("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(t){this._values=(t||[]).map((a=>a))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(u,y){if(u.length!==y.length)return!1;for(let T=0;T<u.length;++T)if(u[T]!==y[T])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Jh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Zv(t,Jh._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((a=>typeof a=="number")))return new Jh(t.vectorValues);throw new $n(hn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Jh._jsonSchemaVersion="firestore/vectorValue/1.0",Jh._jsonSchema={type:eo("string",Jh._jsonSchemaVersion),vectorValues:eo("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X6=/^__.*__$/;class Y6{constructor(t,a,u){this.data=t,this.fieldMask=a,this.fieldTransforms=u}toMutation(t,a){return this.fieldMask!==null?new h_(t,this.data,this.fieldMask,a,this.fieldTransforms):new Wv(t,this.data,a,this.fieldTransforms)}}function Hk(o){switch(o){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Bi(40011,{dataSource:o})}}class kS{constructor(t,a,u,y,T,C){this.settings=t,this.databaseId=a,this.serializer=u,this.ignoreUndefinedProperties=y,T===void 0&&this.validatePath(),this.fieldTransforms=T||[],this.fieldMask=C||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new kS({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){var y;const a=(y=this.path)==null?void 0:y.child(t),u=this.contextWith({path:a,arrayElement:!1});return u.validatePathSegment(t),u}childContextForFieldPath(t){var y;const a=(y=this.path)==null?void 0:y.child(t),u=this.contextWith({path:a,arrayElement:!1});return u.validatePath(),u}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return h1(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((a=>t.isPrefixOf(a)))!==void 0||this.fieldTransforms.find((a=>t.isPrefixOf(a.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(Hk(this.dataSource)&&X6.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class K6{constructor(t,a,u){this.databaseId=t,this.ignoreUndefinedProperties=a,this.serializer=u||P1(t)}createContext(t,a,u,y=!1){return new kS({dataSource:t,methodName:a,targetDoc:u,path:ol.emptyPath(),arrayElement:!1,hasConverter:y},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function LS(o){const t=o._freezeSettings(),a=P1(o._databaseId);return new K6(o._databaseId,!!t.ignoreUndefinedProperties,a)}function $k(o,t,a,u,y,T={}){const C=o.createContext(T.merge||T.mergeFields?2:0,t,a,y);Xk("Data must be an object, but it was:",C,u);const s=Zk(u,C);let B,V;if(T.merge)B=new Kh(C.fieldMask),V=C.fieldTransforms;else if(T.mergeFields){const W=[];for(const Q of T.mergeFields){const oe=N1(t,Q,a);if(!C.contains(oe))throw new $n(hn.INVALID_ARGUMENT,`Field '${oe}' is specified in your field mask but missing from your input data.`);t8(W,oe)||W.push(oe)}B=new Kh(W),V=C.fieldTransforms.filter((Q=>B.covers(Q.field)))}else B=null,V=C.fieldTransforms;return new Y6(new Qu(s),B,V)}class zS extends PS{_toFieldTransform(t){return new Fj(t.path,new zv)}isEqual(t){return t instanceof zS}}function Q6(o,t,a,u=!1){return OS(a,o.createContext(u?4:3,t))}function OS(o,t){if(Wk(o=ic(o)))return Xk("Unsupported field value:",t,o),Zk(o,t);if(o instanceof PS)return(function(u,y){if(!Hk(y.dataSource))throw y.createError(`${u._methodName}() can only be used with update() and set()`);if(!y.path)throw y.createError(`${u._methodName}() is not currently supported inside arrays`);const T=u._toFieldTransform(y);T&&y.fieldTransforms.push(T)})(o,t),null;if(o===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),o instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(u,y){const T=[];let C=0;for(const s of u){let B=OS(s,y.childContextForArray(C));B==null&&(B={nullValue:"NULL_VALUE"}),T.push(B),C++}return{arrayValue:{values:T}}})(o,t)}return(function(u,y){if((u=ic(u))===null)return{nullValue:"NULL_VALUE"};if(typeof u=="number")return Oj(y.serializer,u);if(typeof u=="boolean")return{booleanValue:u};if(typeof u=="string")return{stringValue:u};if(u instanceof Date){const T=Ws.fromDate(u);return{timestampValue:o1(y.serializer,T)}}if(u instanceof Ws){const T=new Ws(u.seconds,1e3*Math.floor(u.nanoseconds/1e3));return{timestampValue:o1(y.serializer,T)}}if(u instanceof af)return{geoPointValue:{latitude:u.latitude,longitude:u.longitude}};if(u instanceof Ju)return{bytesValue:ck(y.serializer,u._byteString)};if(u instanceof Fa){const T=y.databaseId,C=u.firestore._databaseId;if(!C.isEqual(T))throw y.createError(`Document reference is for database ${C.projectId}/${C.database} but should be for database ${T.projectId}/${T.database}`);return{referenceValue:_S(u.firestore._databaseId||y.databaseId,u._key.path)}}if(u instanceof Jh)return(function(C,s){const B=C instanceof Jh?C.toArray():C;return{mapValue:{fields:{[NP]:{stringValue:BP},[r1]:{arrayValue:{values:B.map((W=>{if(typeof W!="number")throw s.createError("VectorValues must only contain numeric values.");return pS(s.serializer,W)}))}}}}}})(u,y);if(gk(u))return u._toProto(y.serializer);throw y.createError(`Unsupported field value: ${w1(u)}`)})(o,t)}function Zk(o,t){const a={};return DP(o)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):c_(o,((u,y)=>{const T=OS(y,t.childContextForField(u));T!=null&&(a[u]=T)})),{mapValue:{fields:a}}}function Wk(o){return!(typeof o!="object"||o===null||o instanceof Array||o instanceof Date||o instanceof Ws||o instanceof af||o instanceof Ju||o instanceof Fa||o instanceof PS||o instanceof Jh||gk(o))}function Xk(o,t,a){if(!Wk(a)||!RP(a)){const u=w1(a);throw u==="an object"?t.createError(o+" a custom object"):t.createError(o+" "+u)}}function N1(o,t,a){if((t=ic(t))instanceof qk)return t._internalPath;if(typeof t=="string")return e8(o,t);throw h1("Field path arguments must be of type string or ",o,!1,void 0,a)}const J6=new RegExp("[~\\*/\\[\\]]");function e8(o,t,a){if(t.search(J6)>=0)throw h1(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,o,!1,void 0,a);try{return new qk(...t.split("."))._internalPath}catch{throw h1(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,o,!1,void 0,a)}}function h1(o,t,a,u,y){const T=u&&!u.isEmpty(),C=y!==void 0;let s=`Function ${t}() called with invalid data`;a&&(s+=" (via `toFirestore()`)"),s+=". ";let B="";return(T||C)&&(B+=" (found",T&&(B+=` in field ${u}`),C&&(B+=` in document ${y}`),B+=")"),new $n(hn.INVALID_ARGUMENT,s+o+B)}function t8(o,t){return o.some((a=>a.isEqual(t)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n8{convertValue(t,a="none"){switch(Um(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ba(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,a);case 5:return t.stringValue;case 6:return this.convertBytes(jm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,a);case 11:return this.convertObject(t.mapValue,a);case 10:return this.convertVectorValue(t.mapValue);default:throw Bi(62114,{value:t})}}convertObject(t,a){return this.convertObjectMap(t.fields,a)}convertObjectMap(t,a="none"){const u={};return c_(t,((y,T)=>{u[y]=this.convertValue(T,a)})),u}convertVectorValue(t){var u,y,T;const a=(T=(y=(u=t.fields)==null?void 0:u[r1].arrayValue)==null?void 0:y.values)==null?void 0:T.map((C=>Ba(C.doubleValue)));return new Jh(a)}convertGeoPoint(t){return new af(Ba(t.latitude),Ba(t.longitude))}convertArray(t,a){return(t.values||[]).map((u=>this.convertValue(u,a)))}convertServerTimestamp(t,a){switch(a){case"previous":const u=S1(t);return u==null?null:this.convertValue(u,a);case"estimate":return this.convertTimestamp(Dv(t));default:return null}}convertTimestamp(t){const a=Vm(t);return new Ws(a.seconds,a.nanos)}convertDocumentKey(t,a){const u=Os.fromString(t);fs(mk(u),9688,{name:t});const y=new Pv(u.get(1),u.get(3)),T=new vi(u.popFirst(5));return y.isEqual(a)||bp(`Document ${T} contains a document reference within a different database (${y.projectId}/${y.database}) which is not supported. It will be treated as a reference in the current database (${a.projectId}/${a.database}) instead.`),T}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk extends n8{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ju(t)}convertReference(t){const a=this.convertDocumentKey(t,this.firestore._databaseId);return new Fa(this.firestore,null,a)}}function d1(){return new zS("serverTimestamp")}const tM="@firebase/firestore",nM="4.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iM(o){return(function(a,u){if(typeof a!="object"||a===null)return!1;const y=a;for(const T of u)if(T in y&&typeof y[T]=="function")return!0;return!1})(o,["next","error","complete"])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(t,a,u,y,T){this._firestore=t,this._userDataWriter=a,this._key=u,this._document=y,this._converter=T}get id(){return this._key.path.lastSegment()}get ref(){return new Fa(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new i8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var t;return((t=this._document)==null?void 0:t.data.clone().value.mapValue.fields)??void 0}get(t){if(this._document){const a=this._document.data.field(N1("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a)}}}class i8 extends Kk{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r8(o){if(o.limitType==="L"&&o.explicitOrderBy.length===0)throw new $n(hn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class NS{}class Qk extends NS{}function Jk(o,t,...a){let u=[];t instanceof NS&&u.push(t),u=u.concat(a),(function(T){const C=T.filter((B=>B instanceof FS)).length,s=T.filter((B=>B instanceof BS)).length;if(C>1||C>0&&s>0)throw new $n(hn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(u);for(const y of u)o=y._apply(o);return o}class BS extends Qk{constructor(t,a,u){super(),this._field=t,this._op=a,this._value=u,this.type="where"}static _create(t,a,u){return new BS(t,a,u)}_apply(t){const a=this._parse(t);return tL(t._query,a),new f_(t.firestore,t.converter,dE(t._query,a))}_parse(t){const a=LS(t.firestore);return(function(T,C,s,B,V,W,Q){let oe;if(V.isKeyField()){if(W==="array-contains"||W==="array-contains-any")throw new $n(hn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${W}' queries on documentId().`);if(W==="in"||W==="not-in"){sM(Q,W);const Je=[];for(const Ye of Q)Je.push(rM(B,T,Ye));oe={arrayValue:{values:Je}}}else oe=rM(B,T,Q)}else W!=="in"&&W!=="not-in"&&W!=="array-contains-any"||sM(Q,W),oe=Q6(s,C,Q,W==="in"||W==="not-in");return Ja.create(V,W,oe)})(t._query,"where",a,t.firestore._databaseId,this._field,this._op,this._value)}}class FS extends NS{constructor(t,a){super(),this.type=t,this._queryConstraints=a}static _create(t,a){return new FS(t,a)}_parse(t){const a=this._queryConstraints.map((u=>u._parse(t))).filter((u=>u.getFilters().length>0));return a.length===1?a[0]:ed.create(a,this._getOperator())}_apply(t){const a=this._parse(t);return a.getFilters().length===0?t:((function(y,T){let C=y;const s=T.getFlattenedFilters();for(const B of s)tL(C,B),C=dE(C,B)})(t._query,a),new f_(t.firestore,t.converter,dE(t._query,a)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class VS extends Qk{constructor(t,a){super(),this._field=t,this._direction=a,this.type="orderBy"}static _create(t,a){return new VS(t,a)}_apply(t){const a=(function(y,T,C){if(y.startAt!==null)throw new $n(hn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(y.endAt!==null)throw new $n(hn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lv(T,C)})(t._query,this._field,this._direction);return new f_(t.firestore,t.converter,Cj(t._query,a))}}function eL(o,t="asc"){const a=t,u=N1("orderBy",o);return VS._create(u,a)}function rM(o,t,a){if(typeof(a=ic(a))=="string"){if(a==="")throw new $n(hn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$P(t)&&a.indexOf("/")!==-1)throw new $n(hn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${a}' contains a '/' character.`);const u=t.path.child(Os.fromString(a));if(!vi.isDocumentKey(u))throw new $n(hn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${u}' is not because it has an odd number of segments (${u.length}).`);return yR(o,new vi(u))}if(a instanceof Fa)return yR(o,a._key);throw new $n(hn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${w1(a)}.`)}function sM(o,t){if(!Array.isArray(o)||o.length===0)throw new $n(hn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tL(o,t){const a=(function(y,T){for(const C of y)for(const s of C.getFlattenedFilters())if(T.indexOf(s.op)>=0)return s.op;return null})(o.filters,(function(y){switch(y){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(a!==null)throw a===t.op?new $n(hn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new $n(hn.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${a.toString()}' filters.`)}function nL(o,t,a){let u;return u=o?a&&(a.merge||a.mergeFields)?o.toFirestore(t,a):o.toFirestore(t):t,u}class gv{constructor(t,a){this.hasPendingWrites=t,this.fromCache=a}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class n_ extends Kk{constructor(t,a,u,y,T,C){super(t,a,u,y,C),this._firestore=t,this._firestoreImpl=t,this.metadata=T}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const a=new Fb(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(a,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,a={}){if(this._document){const u=this._document.data.field(N1("DocumentSnapshot.get",t));if(u!==null)return this._userDataWriter.convertValue(u,a.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new $n(hn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,a={};return a.type=n_._jsonSchemaVersion,a.bundle="",a.bundleSource="DocumentSnapshot",a.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?a:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),a.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),a)}}n_._jsonSchemaVersion="firestore/documentSnapshot/1.0",n_._jsonSchema={type:eo("string",n_._jsonSchemaVersion),bundleSource:eo("string","DocumentSnapshot"),bundleName:eo("string"),bundle:eo("string")};class Fb extends n_{data(t={}){return super.data(t)}}class Ay{constructor(t,a,u,y){this._firestore=t,this._userDataWriter=a,this._snapshot=y,this.metadata=new gv(y.hasPendingWrites,y.fromCache),this.query=u}get docs(){const t=[];return this.forEach((a=>t.push(a))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,a){this._snapshot.docs.forEach((u=>{t.call(a,new Fb(this._firestore,this._userDataWriter,u.key,u,new gv(this._snapshot.mutatedKeys.has(u.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const a=!!t.includeMetadataChanges;if(a&&this._snapshot.excludesMetadataChanges)throw new $n(hn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===a||(this._cachedChanges=(function(y,T){if(y._snapshot.oldDocs.isEmpty()){let C=0;return y._snapshot.docChanges.map((s=>{const B=new Fb(y._firestore,y._userDataWriter,s.doc.key,s.doc,new gv(y._snapshot.mutatedKeys.has(s.doc.key),y._snapshot.fromCache),y.query.converter);return s.doc,{type:"added",doc:B,oldIndex:-1,newIndex:C++}}))}{let C=y._snapshot.oldDocs;return y._snapshot.docChanges.filter((s=>T||s.type!==3)).map((s=>{const B=new Fb(y._firestore,y._userDataWriter,s.doc.key,s.doc,new gv(y._snapshot.mutatedKeys.has(s.doc.key),y._snapshot.fromCache),y.query.converter);let V=-1,W=-1;return s.type!==0&&(V=C.indexOf(s.doc.key),C=C.delete(s.doc.key)),s.type!==1&&(C=C.add(s.doc),W=C.indexOf(s.doc.key)),{type:s8(s.type),doc:B,oldIndex:V,newIndex:W}}))}})(this,a),this._cachedChangesIncludeMetadataChanges=a),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new $n(hn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Ay._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=lS.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const a=[],u=[],y=[];return this.docs.forEach((T=>{T._document!==null&&(a.push(T._document),u.push(this._userDataWriter.convertObjectMap(T._document.data.value.mapValue.fields,"previous")),y.push(T.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function s8(o){switch(o){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Bi(61501,{type:o})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ay._jsonSchemaVersion="firestore/querySnapshot/1.0",Ay._jsonSchema={type:eo("string",Ay._jsonSchemaVersion),bundleSource:eo("string","QuerySnapshot"),bundleName:eo("string"),bundle:eo("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(o){o=_p(o,Fa);const t=_p(o.firestore,By),a=DS(t);return U6(a,o._key).then((u=>aL(t,o,u)))}function Qv(o,t,a){o=_p(o,Fa);const u=_p(o.firestore,By),y=nL(o.converter,t,a),T=LS(u);return sL(u,[$k(T,"setDoc",o._key,y,o.converter!==null,a).toMutation(o._key,rf.none())])}function iL(o,t){const a=_p(o.firestore,By),u=p_(o),y=nL(o.converter,t),T=LS(o.firestore);return sL(a,[$k(T,"addDoc",u._key,y,o.converter!==null,{}).toMutation(u._key,rf.exists(!1))]).then((()=>u))}function rL(o,...t){var V,W,Q;o=ic(o);let a={includeMetadataChanges:!1,source:"default"},u=0;typeof t[u]!="object"||iM(t[u])||(a=t[u++]);const y={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(iM(t[u])){const oe=t[u];t[u]=(V=oe.next)==null?void 0:V.bind(oe),t[u+1]=(W=oe.error)==null?void 0:W.bind(oe),t[u+2]=(Q=oe.complete)==null?void 0:Q.bind(oe)}let T,C,s;if(o instanceof Fa)C=_p(o.firestore,By),s=A1(o._key.path),T={next:oe=>{t[u]&&t[u](aL(C,o,oe))},error:t[u+1],complete:t[u+2]};else{const oe=_p(o,f_);C=_p(oe.firestore,By),s=oe._query;const he=new Yk(C);T={next:Je=>{t[u]&&t[u](new Ay(C,he,oe,Je))},error:t[u+1],complete:t[u+2]},r8(o._query)}const B=DS(C);return j6(B,s,y,T)}function sL(o,t){const a=DS(o);return G6(a,t)}function aL(o,t,a){const u=a.docs.get(t._key),y=new Yk(o);return new n_(o,y,t._key,u,new gv(a.hasPendingWrites,a.fromCache),t.converter)}(function(t,a=!0){UV(Gy),My(new r_("firestore",((u,{instanceIdentifier:y,options:T})=>{const C=u.getProvider("app").getImmediate(),s=new By(new HV(u.getProvider("auth-internal")),new WV(C,u.getProvider("app-check-internal")),hj(C,y),C);return T={useFetchStreams:a,...T},s._setSettings(T),s}),"PUBLIC").setMultipleInstances(!0)),Lm(tM,nM,t),Lm(tM,nM,"esm2020")})();const a8={apiKey:"AIzaSyDOeNml2sN_l5BNsDdSKtNx-yws0dWud0I",authDomain:"healthme-cd5cf.firebaseapp.com",projectId:"healthme-cd5cf",storageBucket:"healthme-cd5cf.firebasestorage.app",messagingSenderId:"583698626394",appId:"1:583698626394:web:7d2d10d1e62c25fc1ee563"},oL=VD(a8),MT=BV(oL),o8=new fp,cf=Z6(oL),lL=He.createContext(void 0),B1=()=>{const o=He.useContext(lL);if(o===void 0)throw new Error("useAuth must be used within an AuthProvider");return o},l8=({children:o})=>{const[t,a]=He.useState(null),[u,y]=He.useState(!0);He.useEffect(()=>{const B=A4(MT,V=>{a(V),y(!1)});return()=>B()},[]);const s={user:t,loading:u,signInWithGoogle:async()=>{try{await Z4(MT,o8)}catch(B){throw console.error("Error signing in with Google:",B),B}},signOut:async()=>{try{await I4(MT)}catch(B){throw console.error("Error signing out:",B),B}}};return j.jsx(lL.Provider,{value:s,children:o})},aM=async(o,t,a)=>{try{const u=O1(cf,"users",o,"chats",t,"messages");await iL(u,{...a,timestamp:d1()});const y=p_(cf,"users",o,"chats",t);await Qv(y,{updatedAt:d1(),title:a.role==="user"?a.text.slice(0,50):void 0},{merge:!0})}catch(u){console.error("Error saving message to Firestore:",u)}},cL=async o=>{const t=O1(cf,"users",o,"chats");return(await iL(t,{title:"New Conversation",createdAt:d1(),updatedAt:d1()})).id},c8=(o,t,a)=>{const u=O1(cf,"users",o,"chats",t,"messages"),y=Jk(u,eL("timestamp","asc"));return rL(y,T=>{const C=[];T.forEach(s=>{C.push(s.data())}),a(C)})},u8=async o=>{const t=p_(cf,"users",o,"activeChat","current"),a=await jS(t);if(a.exists()&&a.data().chatId)return a.data().chatId;const u=await cL(o);return await Qv(t,{chatId:u}),u},h8=(o,t)=>{const a=O1(cf,"users",o,"chats"),u=Jk(a,eL("updatedAt","desc"));return rL(u,y=>{const T=[];y.forEach(C=>{const s=C.data();T.push({id:C.id,title:s.title||"New Conversation",createdAt:s.createdAt,updatedAt:s.updatedAt})}),t(T)})},d8=async o=>{const t=p_(cf,"users",o,"activeChat","current"),a=await jS(t);return a.exists()&&a.data().chatId?a.data().chatId:null},f8=async(o,t)=>{const a=p_(cf,"users",o,"activeChat","current");await Qv(a,{chatId:t})},p8=async(o,t)=>{try{const a=p_(cf,"users",o,"profile","data"),u={...t,onboardingCompleted:!0,updatedAt:new Date().toISOString()};console.log("[Firestore] About to write to:",a.path),console.log("[Firestore] Data to save:",JSON.stringify(u,null,2)),await Qv(a,u,{merge:!0}),console.log("[Firestore] setDoc completed. Verifying write...");const y=await jS(a);if(y.exists())console.log("[Firestore]  Verification successful! Data exists in Firestore"),console.log("[Firestore] Saved data:",y.data());else throw console.error("[Firestore]  Verification FAILED! Document does not exist after write"),new Error("Profile write failed - document not found after save")}catch(a){throw console.error("[Firestore] Error saving user profile:",a),console.error("[Firestore] Error details:",JSON.stringify(a,null,2)),a}},m8=({onLogout:o})=>{var s;const{user:t}=B1(),[a,u]=He.useState([]),[y,T]=He.useState(null);He.useEffect(()=>{if(!t)return;const B=h8(t.uid,V=>{u(V)});return d8(t.uid).then(T),()=>B()},[t]);const C=B=>{if(!B)return"";const V=B.toDate?B.toDate():new Date(B),Q=Math.floor((new Date().getTime()-V.getTime())/(1e3*60*60*24));return Q===0?"Today":Q===1?"Yesterday":Q<7?`${Q} days ago`:V.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return j.jsxs("aside",{className:"w-64 flex-shrink-0 border-r border-black/5 flex flex-col bg-bg-cream",children:[j.jsxs("div",{className:"p-6",children:[j.jsx("div",{className:"flex items-center space-x-2 mb-8",children:j.jsx("span",{className:"serif-font text-2xl font-semibold text-primary",children:"Health.me"})}),j.jsxs(Im,{to:"/settings",className:"flex items-center space-x-3 p-2 mb-8 rounded-xl hover:bg-black/5 transition-all cursor-pointer",children:[j.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-800 font-bold overflow-hidden border border-black/5 shadow-sm",children:t!=null&&t.photoURL?j.jsx("img",{alt:t.displayName||"User",className:"w-full h-full object-cover",src:t.photoURL}):j.jsx("span",{children:((s=t==null?void 0:t.displayName)==null?void 0:s.charAt(0))||"U"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-semibold text-primary",children:(t==null?void 0:t.displayName)||"User"}),j.jsx("p",{className:"text-[11px] text-gray-500 uppercase tracking-wider font-bold",children:"Pro Member"})]})]}),j.jsxs("nav",{className:"space-y-1",children:[j.jsxs(Im,{to:"/chat",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"chat_bubble"}),j.jsx("span",{className:"text-sm",children:"AI Chat"})]}),j.jsxs(Im,{to:"/",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"home"}),j.jsx("span",{className:"text-sm",children:"Home"})]}),j.jsxs(Im,{to:"/calendar",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"calendar_month"}),j.jsx("span",{className:"text-sm",children:"Schedule"})]}),j.jsxs(Im,{to:"/profile",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"person"}),j.jsx("span",{className:"text-sm",children:"Health Profile"})]})]})]}),j.jsxs("div",{className:"mt-4 px-6 flex-1 overflow-y-auto custom-scrollbar",children:[j.jsx("p",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-[0.15em] mb-4 px-2",children:"Recent Sessions"}),j.jsx("div",{className:"space-y-1",children:a.length===0?j.jsx("p",{className:"text-xs text-gray-400 px-2",children:"No conversations yet"}):a.map(B=>j.jsxs(Im,{to:`/chat?session=${B.id}`,className:"block cursor-pointer group p-2 rounded-xl hover:bg-white hover:shadow-sm transition-all duration-200 hover:scale-[1.02] active:scale-95",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsx("p",{className:"text-sm text-gray-600 group-hover:text-primary transition-colors truncate font-medium",children:B.title}),j.jsx("span",{className:`size-2 rounded-full flex-shrink-0 ${B.id===y?"bg-blue-500":"bg-green-500"}`})]}),j.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5",children:C(B.updatedAt)})]},B.id))})]}),j.jsxs("div",{className:"p-6 border-t border-black/5 space-y-4",children:[j.jsxs(Im,{to:"/settings",className:({isActive:B})=>`w-full flex items-center space-x-3 px-2 py-2 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"text-primary font-medium":"text-gray-500 hover:text-primary"}`,children:[j.jsx("span",{className:"material-symbols-outlined",children:"settings"}),j.jsx("span",{className:"text-sm font-medium",children:"Settings"})]}),j.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center space-x-3 bg-white border border-black/5 text-gray-600 hover:bg-red-50 hover:text-red-600 hover:border-red-100 py-3 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm font-bold text-sm",children:[j.jsx("span",{className:"material-symbols-outlined text-lg",children:"logout"}),j.jsx("span",{children:"Sign Out"})]})]})]})},g8=()=>{ff();const[o,t]=He.useState(!1),a=[{id:1,icon:"event",title:"Appointment Reminder",message:"Your appointment with Dr. Aris is tomorrow at 10:00 AM",time:"2h ago",unread:!0},{id:2,icon:"medication",title:"Medication Due",message:"Time to take your daily vitamin D supplement",time:"4h ago",unread:!0},{id:3,icon:"favorite",title:"Health Insight",message:"Your resting heart rate has improved by 5% this week",time:"1d ago",unread:!1},{id:4,icon:"check_circle",title:"Lab Results Ready",message:"Your blood test results are now available",time:"2d ago",unread:!1}];return j.jsxs("header",{className:"p-8 pb-0 flex justify-between items-center bg-transparent relative",children:[j.jsx("div",{className:"flex items-center space-x-4"}),j.jsx("div",{className:"flex items-center space-x-3",children:j.jsxs("div",{className:"relative",children:[j.jsxs("button",{onClick:()=>t(!o),className:"size-10 flex items-center justify-center rounded-full hover:bg-black/5 transition-colors text-gray-400 hover:text-primary relative",children:[j.jsx("span",{className:"material-symbols-outlined",children:"notifications"}),j.jsx("span",{className:"absolute top-1 right-1 size-2.5 bg-red-500 rounded-full border-2 border-soft-cream"})]}),o&&j.jsxs(j.Fragment,{children:[j.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)}),j.jsxs("div",{className:"absolute right-0 top-12 w-80 bg-soft-cream rounded-3xl shadow-2xl border border-black/5 z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[j.jsxs("div",{className:"p-5 border-b border-black/5 flex justify-between items-center bg-white/50",children:[j.jsx("h3",{className:"serif-font text-xl text-primary",children:"Notifications"}),j.jsx("span",{className:"text-[9px] font-black text-primary bg-primary/10 px-2 py-1 rounded-full uppercase tracking-wider",children:"2 New"})]}),j.jsx("div",{className:"max-h-80 overflow-y-auto custom-scrollbar p-3 space-y-2",children:a.map(u=>j.jsx("div",{className:`p-4 rounded-2xl cursor-pointer transition-all border ${u.unread?"bg-white border-primary/20 shadow-sm":"bg-white/50 border-black/5 hover:bg-white"}`,children:j.jsxs("div",{className:"flex gap-3",children:[j.jsx("div",{className:`size-10 rounded-xl flex items-center justify-center flex-shrink-0 ${u.unread?"bg-primary text-white":"bg-gray-100 text-gray-400"}`,children:j.jsx("span",{className:"material-symbols-outlined text-lg",children:u.icon})}),j.jsxs("div",{className:"flex-1 min-w-0",children:[j.jsxs("div",{className:"flex justify-between items-start gap-2",children:[j.jsx("p",{className:"font-bold text-sm text-primary truncate",children:u.title}),j.jsx("span",{className:"text-[9px] text-gray-400 whitespace-nowrap font-medium",children:u.time})]}),j.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2 leading-relaxed",children:u.message})]})]})},u.id))})]})]})]})})]})},_8="/assets/cycling-BA_CT514.jpg",y8=()=>{const o=ff(),[t,a]=He.useState(!1),u=[{id:1,title:"General checkup followup",date:"Today",status:"active",preview:"I've been feeling much better, but I still have some mild fatigue in the afternoons..."},{id:2,title:"Lower back pain query",date:"Yesterday",status:"completed",preview:"I've been experiencing lower back pain for the past few days, especially when sitting..."},{id:3,title:"Prescription refill request",date:"Jan 21",status:"completed",preview:"I need to refill my blood pressure medication. I'm running low..."},{id:4,title:"Headache symptoms",date:"Jan 19",status:"completed",preview:"I've been having recurring headaches for the past week. They usually start in the afternoon..."},{id:5,title:"Annual physical booking",date:"Jan 15",status:"completed",preview:"I'd like to schedule my annual physical exam. What availability do you have..."}];return j.jsxs(j.Fragment,{children:[t&&j.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>a(!1),children:j.jsxs("div",{className:"bg-white rounded-3xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:y=>y.stopPropagation(),children:[j.jsxs("div",{className:"p-6 border-b border-black/5 flex items-center justify-between",children:[j.jsx("h2",{className:"serif-font text-2xl text-primary",children:"All Chat Sessions"}),j.jsx("button",{onClick:()=>a(!1),className:"size-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-all",children:j.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),j.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh] space-y-3",children:u.map(y=>j.jsxs("div",{onClick:()=>{a(!1),o(`/chat?session=${y.id}`)},className:"bg-gray-50 p-4 rounded-2xl border border-black/5 hover:bg-white hover:shadow-lg hover:border-primary/20 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[j.jsxs("div",{className:"flex items-center justify-between mb-2",children:[j.jsx("h4",{className:"font-bold text-primary",children:y.title}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("span",{className:"text-xs text-gray-400",children:y.date}),j.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider text-white px-2 py-1 rounded-lg ${y.status==="active"?"bg-blue-500":"bg-green-600"}`,children:y.status==="active"?"Active":"Completed"})]})]}),j.jsxs("p",{className:"text-sm text-gray-500 line-clamp-1",children:['"',y.preview,'"']})]},y.id))})]})}),j.jsx("div",{className:"px-8 pb-32",children:j.jsxs("div",{className:"max-w-6xl mx-auto",children:[j.jsxs("div",{className:"mb-8",children:[j.jsx("h1",{className:"serif-font text-5xl text-primary mb-4 leading-tight",children:"Welcome, Alex!"}),j.jsx("p",{className:"text-xl text-gray-500 max-w-2xl leading-relaxed",children:"Your personal AI health assistant is ready to help. How are you feeling today?"})]}),j.jsxs("div",{className:"relative w-full min-h-[500px] rounded-[40px] overflow-hidden mb-12 shadow-lg group flex flex-col justify-end",children:[j.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-all duration-500 z-10"}),j.jsx("img",{src:_8,alt:"Active Lifestyle",className:"absolute inset-0 w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"}),j.jsx("div",{className:"relative z-30 p-6 md:p-8 pb-4 md:pb-6",children:j.jsxs("div",{className:"bg-card-beige/90 backdrop-blur-md p-8 rounded-3xl border border-black/5 shadow-xl",children:[j.jsxs("h3",{className:"font-bold text-lg mb-6 flex items-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-primary",children:"monitoring"}),"Daily Health Summary"]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-blue-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"water_drop"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Hydration"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"1.2L / 2.5L"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-green-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-green-50 rounded-xl flex items-center justify-center text-green-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"directions_walk"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Activity"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"4,582 steps"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-red-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"favorite"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Heart Rate"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"72 bpm"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-purple-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-purple-50 rounded-xl flex items-center justify-center text-purple-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"bedtime"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Sleep"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"7h 23m"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-orange-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-orange-50 rounded-xl flex items-center justify-center text-orange-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"local_fire_department"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Calories"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"1,847 kcal"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-teal-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-teal-50 rounded-xl flex items-center justify-center text-teal-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"speed"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Blood Pressure"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"120/80"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-yellow-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-yellow-50 rounded-xl flex items-center justify-center text-yellow-600",children:j.jsx("span",{className:"material-symbols-outlined",children:"glucose"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Blood Sugar"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"95 mg/dL"})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-indigo-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"size-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-500",children:j.jsx("span",{className:"material-symbols-outlined",children:"thermostat"})}),j.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Temperature"})]}),j.jsx("span",{className:"text-sm font-black text-slate-800",children:"98.6F"})]})]})]})})]}),j.jsxs("div",{className:"mb-12",children:[j.jsxs("div",{className:"flex items-center justify-between mb-6",children:[j.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-primary",children:"forum"}),"Recent Sessions"]}),j.jsx("button",{onClick:()=>a(!0),className:"text-xs font-bold text-primary hover:text-black transition-colors",children:"View All"})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[j.jsxs("div",{onClick:()=>o("/chat?session=1"),className:"bg-white p-5 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:border-primary/20 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[j.jsxs("div",{className:"flex items-center justify-between mb-3",children:[j.jsx("span",{className:"text-xs font-bold text-gray-400",children:"Today"}),j.jsx("span",{className:"size-2 bg-blue-500 rounded-full"})]}),j.jsx("h4",{className:"font-bold text-primary mb-2",children:"General checkup followup"}),j.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:`"I've been feeling much better, but I still have some mild fatigue in the afternoons..."`}),j.jsx("div",{className:"mt-3 flex items-center gap-2",children:j.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-white bg-blue-500 px-2 py-1 rounded-lg",children:"Active"})})]}),j.jsxs("div",{onClick:()=>o("/chat?session=2"),className:"bg-white p-5 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:border-primary/20 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[j.jsxs("div",{className:"flex items-center justify-between mb-3",children:[j.jsx("span",{className:"text-xs font-bold text-gray-400",children:"Yesterday"}),j.jsx("span",{className:"size-2 bg-green-500 rounded-full"})]}),j.jsx("h4",{className:"font-bold text-primary mb-2",children:"Lower back pain query"}),j.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:`"I've been experiencing lower back pain for the past few days, especially when sitting..."`}),j.jsx("div",{className:"mt-3 flex items-center gap-2",children:j.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-white bg-green-600 px-2 py-1 rounded-lg",children:"Completed"})})]}),j.jsxs("div",{onClick:()=>o("/chat?session=3"),className:"bg-white p-5 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:border-primary/20 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[j.jsxs("div",{className:"flex items-center justify-between mb-3",children:[j.jsx("span",{className:"text-xs font-bold text-gray-400",children:"Jan 21"}),j.jsx("span",{className:"size-2 bg-green-500 rounded-full"})]}),j.jsx("h4",{className:"font-bold text-primary mb-2",children:"Prescription refill request"}),j.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:`"I need to refill my blood pressure medication. I'm running low..."`}),j.jsx("div",{className:"mt-3 flex items-center gap-2",children:j.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-white bg-green-600 px-2 py-1 rounded-lg",children:"Completed"})})]})]})]}),j.jsxs("div",{className:"bg-primary text-white p-10 rounded-[40px] shadow-2xl relative overflow-hidden",children:[j.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl"}),j.jsxs("div",{className:"relative z-10",children:[j.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[j.jsx("span",{className:"material-symbols-outlined text-white/70",children:"analytics"}),j.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/60",children:"Weekly Health Summary"})]}),j.jsx("h2",{className:"serif-font text-3xl mb-6 leading-relaxed",children:"This week you've been 12% more active than last week, averaging 4,582 steps per day. Your resting heart rate is steady at 68 bpm, which is within a healthy range."}),j.jsx("p",{className:"text-white/70 text-lg leading-relaxed mb-6",children:"You're getting an average of 7.2 hours of sleep per night, and your blood pressure readings have remained stable at 120/80 mmHg. Your hydration could improve  you're only hitting about 48% of your daily water intake goal."}),j.jsx("p",{className:"text-white/50 text-sm italic",children:"Tip: Try setting hourly reminders to drink water throughout the day to reach your 2.5L goal."})]})]})]})})]})},x8=()=>{const[o,t]=He.useState(10),[a,u]=He.useState(!0),y=ff();return He.useEffect(()=>{const T=setInterval(()=>{t(C=>C>0?C-1:0)},1e3);return()=>clearInterval(T)},[]),j.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[100] flex items-center justify-center p-6",children:j.jsxs("div",{className:"w-full max-w-md bg-soft-cream rounded-3xl shadow-2xl overflow-hidden border border-black/5",children:[j.jsxs("div",{className:"bg-white p-6 flex flex-col items-center border-b border-black/5",children:[j.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[j.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[j.jsx("span",{className:"pulse-red absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),j.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"})]}),j.jsx("span",{className:"text-red-500 font-black text-[10px] uppercase tracking-widest",children:"Emergency Call Active"})]}),j.jsxs("div",{className:"text-4xl font-black tabular-nums text-primary",children:[o,"s"]}),j.jsx("p",{className:"text-[10px] font-medium text-gray-400 mt-1 uppercase tracking-wider",children:"Montreal Emergency Dispatch"})]}),j.jsxs("div",{className:"p-6 space-y-5",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-center text-[9px] font-black text-gray-400 uppercase tracking-widest mb-3",children:"Communication Mode"}),j.jsxs("div",{className:"bg-white p-1 rounded-xl flex gap-1 border border-black/5",children:[j.jsxs("button",{onClick:()=>u(!1),className:`flex-1 flex items-center justify-center gap-2 py-2.5 px-3 rounded-lg text-xs font-bold transition-all ${a?"text-gray-400 hover:text-primary":"bg-primary text-white shadow-sm"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"record_voice_over"}),"Talk Myself"]}),j.jsxs("button",{onClick:()=>u(!0),className:`flex-1 flex items-center justify-center gap-2 py-2.5 px-3 rounded-lg text-xs font-bold transition-all ${a?"bg-primary text-white shadow-sm":"text-gray-400 hover:text-primary"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-sm fill-1",children:"smart_toy"}),"AI Relay"]})]})]}),j.jsxs("div",{className:"bg-white rounded-2xl border border-black/5 overflow-hidden",children:[j.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-b border-black/5 flex justify-between items-center",children:[j.jsx("span",{className:"text-[9px] font-black text-gray-400 uppercase tracking-wider",children:"AI Transcript"}),j.jsxs("span",{className:"flex items-center gap-1",children:[j.jsx("span",{className:"size-1.5 rounded-full bg-green-500 pulse-green"}),j.jsx("span",{className:"text-[9px] font-black text-green-600 uppercase",children:"Active"})]})]}),j.jsxs("div",{className:"p-4 space-y-3 max-h-[140px] overflow-y-auto custom-scrollbar",children:[j.jsxs("div",{className:"flex gap-2",children:[j.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:j.jsx("span",{className:"material-symbols-outlined text-xs",children:"emergency"})}),j.jsx("p",{className:"text-xs text-gray-600 italic leading-relaxed",children:'"This is an automated emergency relay from Health.me. Assisting Sam Smith with respiratory distress."'})]}),j.jsxs("div",{className:"flex gap-2",children:[j.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:j.jsx("span",{className:"material-symbols-outlined text-xs",children:"info"})}),j.jsx("p",{className:"text-xs text-gray-600 italic leading-relaxed",children:'"Type 1 Diabetic, allergic to penicillin. Location: 1450 Guy St, Montreal."'})]}),j.jsxs("div",{className:"flex gap-2 items-center",children:[j.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:j.jsx("span",{className:"material-symbols-outlined text-xs",children:"sensors"})}),j.jsx("p",{className:"text-xs font-bold text-red-500",children:"Relaying vitals..."})]})]})]}),j.jsxs("button",{onClick:()=>y("/"),className:"w-full py-4 bg-red-500 hover:bg-red-600 text-white rounded-2xl font-black text-sm transition-all flex items-center justify-center gap-2 shadow-lg",children:[j.jsx("span",{className:"material-symbols-outlined rotate-[135deg]",children:"call"}),"End Emergency"]}),j.jsxs("div",{className:"flex justify-center gap-6",children:[j.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[j.jsx("span",{className:"material-symbols-outlined text-xs",children:"mic"}),j.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Mic Active"})]}),j.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[j.jsx("span",{className:"material-symbols-outlined text-xs",children:"location_on"}),j.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"GPS On"})]})]})]}),j.jsx("div",{className:"bg-white py-3 px-6 flex items-center justify-center border-t border-black/5",children:j.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[j.jsx("span",{className:"material-symbols-outlined text-xs",children:"verified_user"}),j.jsx("span",{className:"text-[9px] font-bold uppercase tracking-widest",children:"438 520 2457  Health.me"})]})})]})})},US="/assets/health-C5bU5zeQ.jpg",v8=({onLogin:o})=>{const t=ff(),{requestLocation:a,isLoading:u}=RD(),{signInWithGoogle:y,user:T}=B1(),[C,s]=He.useState(!1),[B,V]=He.useState(!1),[W,Q]=He.useState(!1),oe=async Je=>{Je.preventDefault(),s(!0),await a(),s(!1),o(),t("/chat")},he=async()=>{V(!0);try{await y(),await a(),o(),t("/onboarding")}catch(Je){console.error("Google sign-in failed:",Je)}finally{V(!1)}};return j.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[j.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[j.jsx("div",{className:"absolute inset-0 bg-black/20 z-10"}),j.jsx("img",{src:US,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),j.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[j.jsx("div",{className:"flex items-center space-x-2 mb-6",children:j.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),j.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Your health journey encompasses mind, body, and spirit."'})]})]}),j.jsx("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:j.jsxs("div",{className:"w-full max-w-[440px]",children:[j.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-[40px] shadow-[0_8px_40px_rgba(0,0,0,0.03)] border border-black/5",children:[j.jsxs("div",{className:"text-center mb-10",children:[j.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-bg-cream mb-6",children:j.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"medical_services"})}),j.jsx("h1",{className:"serif-font text-4xl text-primary mb-3 leading-tight",children:"Welcome back"}),j.jsx("p",{className:"text-gray-500 text-[15px]",children:"Sign in to manage your health and appointments."})]}),j.jsxs("form",{onSubmit:oe,className:"space-y-6",children:[j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"email",children:"Email Address"}),j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"email",placeholder:"name@example.com",type:"email",defaultValue:"demo@health.me",required:!0})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsxs("div",{className:"flex justify-between items-center ml-1",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400",htmlFor:"password",children:"Password"}),j.jsx("a",{href:"#",className:"text-[11px] font-bold text-gray-500 hover:text-primary",children:"Forgot?"})]}),j.jsxs("div",{className:"relative",children:[j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"password",placeholder:"",type:W?"text":"password",defaultValue:"password",required:!0}),j.jsx("button",{type:"button",onClick:()=>Q(!W),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:j.jsx("span",{className:"material-symbols-outlined text-lg",children:W?"visibility_off":"visibility"})})]})]}),j.jsx("button",{className:"w-full bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all transform active:scale-[0.99] mt-2 text-[15px] shadow-lg shadow-black/10 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"submit",disabled:C,children:C?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Getting your location..."]}):"Sign In"})]}),j.jsxs("div",{className:"flex items-center gap-4 my-6",children:[j.jsx("div",{className:"flex-1 h-px bg-gray-200"}),j.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"or"}),j.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),j.jsx("button",{onClick:he,disabled:B,className:"w-full flex items-center justify-center gap-3 bg-white border-2 border-black/10 rounded-full py-3.5 px-6 text-primary font-bold hover:bg-gray-50 hover:border-primary/30 transition-all shadow-sm disabled:opacity-70 disabled:cursor-not-allowed",children:B?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Signing in..."]}):j.jsxs(j.Fragment,{children:[j.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[j.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),j.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),j.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),j.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),j.jsxs("p",{className:"mt-8 text-center text-[13px] text-gray-500",children:["Don't have an account? ",j.jsx("a",{href:"#/signup",className:"font-bold text-primary hover:underline",children:"Sign up"})]})]}),j.jsxs("footer",{className:"py-8 text-center w-full space-y-6",children:[j.jsx("p",{className:"serif-font text-gray-400 italic text-lg px-4 opacity-80",children:`"Health is everything. Don't settle."`}),j.jsxs("div",{className:"flex justify-center gap-6 text-gray-300",children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"verified_user"}),j.jsx("span",{className:"material-symbols-outlined text-xl",children:"shield"}),j.jsx("span",{className:"material-symbols-outlined text-xl",children:"info"})]})]})]})})]})},b8="/assets/cycling2-DDaqHTRt.jpg",w8=()=>{const[o,t]=He.useState("profile"),a=[{name:"Blood Panel - Annual Checkup",date:"Jan 12, 2024",clinic:"Clinique Mdicale Prive UnionMD",type:"Lab Result",icon:"biotech",color:"bg-blue-50 text-blue-500"},{name:"Radiology Report - Lower Back",date:"Dec 05, 2023",clinic:"CuraMed",type:"Imaging",icon:"visibility",color:"bg-purple-50 text-purple-500"},{name:"Prescription: Lisinopril 10mg",date:"Nov 20, 2023",clinic:"Clinique Sant MD",type:"Prescription",icon:"medication",color:"bg-orange-50 text-orange-500"},{name:"Discharge Summary - Appendectomy",date:"Aug 14, 2023",clinic:"Centre Mdical Westmount",type:"Hospital Record",icon:"description",color:"bg-gray-50 text-gray-500"},{name:"Immunization Record - 2023",date:"Feb 10, 2023",clinic:"Westmount Square Health Group",type:"Vaccination",icon:"vaccines",color:"bg-green-50 text-green-500"}];return j.jsxs("div",{className:"px-8 pb-32",children:[j.jsxs("div",{className:"w-full relative rounded-[24px] p-6 mb-8 overflow-hidden shadow-lg text-white min-h-[250px] flex flex-col justify-end",children:[j.jsxs("div",{className:"absolute inset-0",children:[j.jsx("img",{src:b8,alt:"Cycling Hero",className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 to-black/20"})]}),j.jsxs("div",{className:"max-w-6xl mx-auto relative z-10 flex flex-col md:flex-row justify-between items-end gap-4 flex-1 w-full",children:[j.jsxs("div",{children:[j.jsx("h1",{className:"serif-font text-3xl mb-2 font-medium tracking-tight",children:"Health Profile"}),j.jsx("p",{className:"text-white/80 text-sm max-w-xl font-light leading-relaxed",children:"Your centralized biological data and real-time insights."})]}),j.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 p-1 rounded-xl flex gap-1",children:[j.jsx("button",{onClick:()=>t("profile"),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="profile"?"bg-white text-primary shadow-md":"text-white/70 hover:text-white hover:bg-white/10"}`,children:"Overview"}),j.jsx("button",{onClick:()=>t("records"),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="records"?"bg-white text-primary shadow-md":"text-white/70 hover:text-white hover:bg-white/10"}`,children:"Records"})]})]})]}),j.jsx("div",{className:"max-w-6xl mx-auto",children:o==="profile"?j.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6",children:[j.jsxs("div",{className:"bg-[#F5F2EA] rounded-[32px] p-8 shadow-sm border border-black/5",children:[j.jsxs("h2",{className:"font-bold text-lg mb-6 flex items-center gap-2 text-primary opacity-80",children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"bar_chart"}),"Daily Health Summary"]}),j.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"bloodtype"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Blood Type"}),j.jsx("p",{className:"text-lg font-black text-primary",children:"A+"})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"scale"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Weight"}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("p",{className:"text-lg font-black text-primary",children:"164 lbs"}),j.jsx("span",{className:"text-[9px] text-green-600 bg-green-50 px-1.5 py-0.5 rounded font-bold",children:"-2.1"})]})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-green-50 rounded-xl flex items-center justify-center text-green-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"straighten"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Height"}),j.jsx("p",{className:"text-lg font-black text-primary",children:`5'11"`})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-orange-50 rounded-xl flex items-center justify-center text-orange-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"event"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Age"}),j.jsx("p",{className:"text-lg font-black text-primary",children:"32 yrs"})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"favorite"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Heart Rate"}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsxs("p",{className:"text-lg font-black text-primary",children:["72 ",j.jsx("span",{className:"text-xs text-gray-400/80 font-normal",children:"bpm"})]}),j.jsx("span",{className:"size-1.5 bg-red-500 rounded-full animate-pulse"})]})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"air"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"SpO2"}),j.jsxs("p",{className:"text-lg font-black text-primary",children:["98 ",j.jsx("span",{className:"text-xs text-gray-400/80 font-normal",children:"%"})]})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-purple-50 rounded-xl flex items-center justify-center text-purple-500 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"speed"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Blood Pressure"}),j.jsx("p",{className:"text-lg font-black text-primary",children:"120/80"})]})]}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[j.jsx("div",{className:"size-10 bg-yellow-50 rounded-xl flex items-center justify-center text-yellow-600 shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"thermostat"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Temp"}),j.jsx("p",{className:"text-lg font-black text-primary",children:"98.6F"})]})]})]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[j.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-6 rounded-[24px] border border-black/5 shadow-sm",children:[j.jsxs("h3",{className:"text-xs font-black text-primary mb-4 flex items-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-red-500 text-sm bg-red-50 p-1 rounded-md",children:"warning"}),"Known Allergies"]}),j.jsx("div",{className:"flex flex-wrap gap-2",children:["Peanuts","Penicillin","Dust Mites"].map(u=>j.jsx("span",{className:"px-3 py-1.5 bg-white text-red-700 text-xs font-bold rounded-lg border border-red-100 shadow-sm",children:u},u))})]}),j.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-6 rounded-[24px] border border-black/5 shadow-sm flex flex-col justify-between",children:[j.jsxs("h3",{className:"text-xs font-black text-primary mb-4 flex items-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-500 text-sm bg-gray-50 p-1 rounded-md",children:"watch"}),"Active Source"]}),j.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-black/5 shadow-sm",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("img",{className:"size-5 object-contain",src:"https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",alt:"Apple Health"}),j.jsx("span",{className:"text-xs font-bold text-primary",children:"Apple Watch Ultra"})]}),j.jsx("span",{className:"size-1.5 rounded-full bg-green-500 pulse-green"})]})]})]}),j.jsxs("div",{children:[j.jsx("h2",{className:"serif-font text-3xl text-primary mb-8 px-2",children:"Clinical Timeline"}),j.jsx("div",{className:"relative pl-8 border-l-2 border-gray-100 space-y-12",children:[{year:"2023",event:"Appendectomy",clinic:"Centre Mdical Westmount",icon:"content_cut",type:"Surgery"},{year:"2021",event:"Type 2 Diabetes Diagnosis",clinic:"Clinique Mdicale Prive UnionMD",icon:"medical_information",type:"Diagnosis"},{year:"2018",event:"Left Wrist Fracture",clinic:"Clinique Mdicale Mtro",icon:"orthopedics",type:"Injury"}].map((u,y)=>j.jsxs("div",{className:"relative",children:[j.jsx("div",{className:"absolute -left-[41px] top-6 size-5 rounded-full border-[4px] border-white bg-primary shadow-sm"}),j.jsxs("div",{className:"bg-white p-8 rounded-[32px] border border-black/5 flex items-center gap-6 hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer group shadow-sm",children:[j.jsx("div",{className:"flex flex-col items-center gap-2 mr-4",children:j.jsx("span",{className:"text-2xl font-black serif-font text-primary/30 group-hover:text-primary transition-colors",children:u.year})}),j.jsx("div",{className:"size-14 bg-bg-cream rounded-2xl flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-all shadow-sm flex-shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-2xl",children:u.icon})}),j.jsxs("div",{className:"flex-1",children:[j.jsx("span",{className:"inline-block px-3 py-1 rounded-lg bg-gray-50 text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2",children:u.type}),j.jsx("p",{className:"font-black text-primary text-xl mb-1",children:u.event}),j.jsx("p",{className:"text-sm text-gray-400 font-medium",children:u.clinic})]}),j.jsx("div",{className:"size-10 rounded-full border border-black/5 flex items-center justify-center text-gray-300 group-hover:border-primary group-hover:text-primary transition-all",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"arrow_forward"})})]})]},y))})]})]}):j.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[j.jsxs("div",{className:"lg:col-span-3 bg-primary text-white p-12 rounded-[48px] shadow-2xl relative overflow-hidden mb-6",children:[j.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl"}),j.jsxs("div",{className:"relative z-10 max-w-3xl",children:[j.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[j.jsx("span",{className:"material-symbols-outlined text-white/70 bg-white/10 p-2 rounded-xl",children:"auto_awesome"}),j.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.25em] text-white/50",children:"AI Health Insights"})]}),j.jsx("h2",{className:"serif-font text-4xl mb-8 leading-tight",children:'"All clinical indicators are within nominal ranges. Your recent blood panel shows optimal LDL levels. Suggested next screening: April 2024."'}),j.jsx("button",{className:"bg-white text-primary py-4 px-10 rounded-2xl font-black text-sm hover:scale-105 transition-all shadow-2xl active:scale-95",children:"Generate Detailed Report"})]})]}),a.map((u,y)=>j.jsxs("div",{className:"bg-white p-8 rounded-[40px] border border-black/5 shadow-sm hover:shadow-2xl transition-all group flex flex-col h-full",children:[j.jsx("div",{className:`size-14 ${u.color} rounded-2xl flex items-center justify-center mb-8 shadow-sm group-hover:scale-110 transition-transform`,children:j.jsx("span",{className:"material-symbols-outlined text-2xl",children:u.icon})}),j.jsxs("div",{className:"flex-1 mb-10",children:[j.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-3 leading-none",children:u.type}),j.jsx("h3",{className:"font-black text-2xl text-primary mb-4 leading-tight group-hover:text-primary transition-colors pr-6",children:u.name}),j.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500 font-bold mb-2",children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_today"}),j.jsx("span",{children:u.date})]}),j.jsx("p",{className:"text-xs text-gray-400 font-medium",children:u.clinic})]}),j.jsxs("div",{className:"flex gap-4 mt-auto",children:[j.jsx("button",{className:"flex-1 bg-gray-50 text-primary py-4 rounded-2xl text-xs font-black border border-black/5 hover:bg-black hover:text-white transition-all shadow-sm",children:"Open Record"}),j.jsx("button",{className:"size-14 rounded-2xl border border-black/5 text-gray-400 hover:text-primary hover:bg-gray-50 transition-all flex items-center justify-center shadow-sm",children:j.jsx("span",{className:"material-symbols-outlined text-2xl",children:"download"})})]})]},y)),j.jsxs("button",{className:"bg-transparent border-2 border-dashed border-black/10 p-10 rounded-[40px] flex flex-col items-center justify-center gap-6 hover:border-primary/40 hover:bg-white transition-all group min-h-[320px]",children:[j.jsx("div",{className:"size-20 rounded-full bg-black/5 flex items-center justify-center text-gray-400 group-hover:bg-primary group-hover:text-white transition-all shadow-sm",children:j.jsx("span",{className:"material-symbols-outlined text-5xl",children:"add"})}),j.jsxs("div",{className:"text-center",children:[j.jsx("p",{className:"font-black text-gray-400 group-hover:text-primary transition-all text-sm uppercase tracking-widest mb-1",children:"Upload Result"}),j.jsx("p",{className:"text-[10px] text-gray-300 uppercase tracking-widest font-bold",children:"PDF, JPEG, or HEIC"})]})]})]})})})]})};function T8(o,t){const a={};return(o[o.length-1]===""?[...o,""]:o).join((a.padRight?" ":"")+","+(a.padLeft===!1?"":" ")).trim()}const E8=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,S8=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,A8={};function oM(o,t){return(A8.jsx?S8:E8).test(o)}const I8=/[ \t\n\f\r]/g;function C8(o){return typeof o=="object"?o.type==="text"?lM(o.value):!1:lM(o)}function lM(o){return o.replace(I8,"")===""}class Jv{constructor(t,a,u){this.normal=a,this.property=t,u&&(this.space=u)}}Jv.prototype.normal={};Jv.prototype.property={};Jv.prototype.space=void 0;function uL(o,t){const a={},u={};for(const y of o)Object.assign(a,y.property),Object.assign(u,y.normal);return new Jv(a,u,t)}function EE(o){return o.toLowerCase()}class kc{constructor(t,a){this.attribute=a,this.property=t}}kc.prototype.attribute="";kc.prototype.booleanish=!1;kc.prototype.boolean=!1;kc.prototype.commaOrSpaceSeparated=!1;kc.prototype.commaSeparated=!1;kc.prototype.defined=!1;kc.prototype.mustUseProperty=!1;kc.prototype.number=!1;kc.prototype.overloadedBoolean=!1;kc.prototype.property="";kc.prototype.spaceSeparated=!1;kc.prototype.space=void 0;let R8=0;const lr=m_(),Qa=m_(),SE=m_(),In=m_(),zs=m_(),Iy=m_(),fu=m_();function m_(){return 2**++R8}const AE=Object.freeze(Object.defineProperty({__proto__:null,boolean:lr,booleanish:Qa,commaOrSpaceSeparated:fu,commaSeparated:Iy,number:In,overloadedBoolean:SE,spaceSeparated:zs},Symbol.toStringTag,{value:"Module"})),DT=Object.keys(AE);class GS extends kc{constructor(t,a,u,y){let T=-1;if(super(t,a),cM(this,"space",y),typeof u=="number")for(;++T<DT.length;){const C=DT[T];cM(this,DT[T],(u&AE[C])===AE[C])}}}GS.prototype.defined=!0;function cM(o,t,a){a&&(o[t]=a)}function Yy(o){const t={},a={};for(const[u,y]of Object.entries(o.properties)){const T=new GS(u,o.transform(o.attributes||{},u),y,o.space);o.mustUseProperty&&o.mustUseProperty.includes(u)&&(T.mustUseProperty=!0),t[u]=T,a[EE(u)]=u,a[EE(T.attribute)]=u}return new Jv(t,a,o.space)}const hL=Yy({properties:{ariaActiveDescendant:null,ariaAtomic:Qa,ariaAutoComplete:null,ariaBusy:Qa,ariaChecked:Qa,ariaColCount:In,ariaColIndex:In,ariaColSpan:In,ariaControls:zs,ariaCurrent:null,ariaDescribedBy:zs,ariaDetails:null,ariaDisabled:Qa,ariaDropEffect:zs,ariaErrorMessage:null,ariaExpanded:Qa,ariaFlowTo:zs,ariaGrabbed:Qa,ariaHasPopup:null,ariaHidden:Qa,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:zs,ariaLevel:In,ariaLive:null,ariaModal:Qa,ariaMultiLine:Qa,ariaMultiSelectable:Qa,ariaOrientation:null,ariaOwns:zs,ariaPlaceholder:null,ariaPosInSet:In,ariaPressed:Qa,ariaReadOnly:Qa,ariaRelevant:null,ariaRequired:Qa,ariaRoleDescription:zs,ariaRowCount:In,ariaRowIndex:In,ariaRowSpan:In,ariaSelected:Qa,ariaSetSize:In,ariaSort:null,ariaValueMax:In,ariaValueMin:In,ariaValueNow:In,ariaValueText:null,role:null},transform(o,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function dL(o,t){return t in o?o[t]:t}function fL(o,t){return dL(o,t.toLowerCase())}const M8=Yy({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Iy,acceptCharset:zs,accessKey:zs,action:null,allow:null,allowFullScreen:lr,allowPaymentRequest:lr,allowUserMedia:lr,alt:null,as:null,async:lr,autoCapitalize:null,autoComplete:zs,autoFocus:lr,autoPlay:lr,blocking:zs,capture:null,charSet:null,checked:lr,cite:null,className:zs,cols:In,colSpan:null,content:null,contentEditable:Qa,controls:lr,controlsList:zs,coords:In|Iy,crossOrigin:null,data:null,dateTime:null,decoding:null,default:lr,defer:lr,dir:null,dirName:null,disabled:lr,download:SE,draggable:Qa,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:lr,formTarget:null,headers:zs,height:In,hidden:SE,high:In,href:null,hrefLang:null,htmlFor:zs,httpEquiv:zs,id:null,imageSizes:null,imageSrcSet:null,inert:lr,inputMode:null,integrity:null,is:null,isMap:lr,itemId:null,itemProp:zs,itemRef:zs,itemScope:lr,itemType:zs,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:lr,low:In,manifest:null,max:null,maxLength:In,media:null,method:null,min:null,minLength:In,multiple:lr,muted:lr,name:null,nonce:null,noModule:lr,noValidate:lr,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:lr,optimum:In,pattern:null,ping:zs,placeholder:null,playsInline:lr,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:lr,referrerPolicy:null,rel:zs,required:lr,reversed:lr,rows:In,rowSpan:In,sandbox:zs,scope:null,scoped:lr,seamless:lr,selected:lr,shadowRootClonable:lr,shadowRootDelegatesFocus:lr,shadowRootMode:null,shape:null,size:In,sizes:null,slot:null,span:In,spellCheck:Qa,src:null,srcDoc:null,srcLang:null,srcSet:null,start:In,step:null,style:null,tabIndex:In,target:null,title:null,translate:null,type:null,typeMustMatch:lr,useMap:null,value:Qa,width:In,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:zs,axis:null,background:null,bgColor:null,border:In,borderColor:null,bottomMargin:In,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:lr,declare:lr,event:null,face:null,frame:null,frameBorder:null,hSpace:In,leftMargin:In,link:null,longDesc:null,lowSrc:null,marginHeight:In,marginWidth:In,noResize:lr,noHref:lr,noShade:lr,noWrap:lr,object:null,profile:null,prompt:null,rev:null,rightMargin:In,rules:null,scheme:null,scrolling:Qa,standby:null,summary:null,text:null,topMargin:In,valueType:null,version:null,vAlign:null,vLink:null,vSpace:In,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:lr,disableRemotePlayback:lr,prefix:null,property:null,results:In,security:null,unselectable:null},space:"html",transform:fL}),D8=Yy({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:fu,accentHeight:In,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:In,amplitude:In,arabicForm:null,ascent:In,attributeName:null,attributeType:null,azimuth:In,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:In,by:null,calcMode:null,capHeight:In,className:zs,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:In,diffuseConstant:In,direction:null,display:null,dur:null,divisor:In,dominantBaseline:null,download:lr,dx:null,dy:null,edgeMode:null,editable:null,elevation:In,enableBackground:null,end:null,event:null,exponent:In,externalResourcesRequired:null,fill:null,fillOpacity:In,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Iy,g2:Iy,glyphName:Iy,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:In,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:In,horizOriginX:In,horizOriginY:In,id:null,ideographic:In,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:In,k:In,k1:In,k2:In,k3:In,k4:In,kernelMatrix:fu,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:In,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:In,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:In,overlineThickness:In,paintOrder:null,panose1:null,path:null,pathLength:In,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:zs,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:In,pointsAtY:In,pointsAtZ:In,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:fu,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:fu,rev:fu,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:fu,requiredFeatures:fu,requiredFonts:fu,requiredFormats:fu,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:In,specularExponent:In,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:In,strikethroughThickness:In,string:null,stroke:null,strokeDashArray:fu,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:In,strokeOpacity:In,strokeWidth:null,style:null,surfaceScale:In,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:fu,tabIndex:In,tableValues:null,target:null,targetX:In,targetY:In,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:fu,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:In,underlineThickness:In,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:In,values:null,vAlphabetic:In,vMathematical:In,vectorEffect:null,vHanging:In,vIdeographic:In,version:null,vertAdvY:In,vertOriginX:In,vertOriginY:In,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:In,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:dL}),pL=Yy({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(o,t){return"xlink:"+t.slice(5).toLowerCase()}}),mL=Yy({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:fL}),gL=Yy({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(o,t){return"xml:"+t.slice(3).toLowerCase()}}),P8={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},k8=/[A-Z]/g,uM=/-[a-z]/g,L8=/^data[-\w.:]+$/i;function z8(o,t){const a=EE(t);let u=t,y=kc;if(a in o.normal)return o.property[o.normal[a]];if(a.length>4&&a.slice(0,4)==="data"&&L8.test(t)){if(t.charAt(4)==="-"){const T=t.slice(5).replace(uM,N8);u="data"+T.charAt(0).toUpperCase()+T.slice(1)}else{const T=t.slice(4);if(!uM.test(T)){let C=T.replace(k8,O8);C.charAt(0)!=="-"&&(C="-"+C),t="data"+C}}y=GS}return new y(u,t)}function O8(o){return"-"+o.toLowerCase()}function N8(o){return o.charAt(1).toUpperCase()}const B8=uL([hL,M8,pL,mL,gL],"html"),qS=uL([hL,D8,pL,mL,gL],"svg");function F8(o){return o.join(" ").trim()}var my={},PT,hM;function V8(){if(hM)return PT;hM=1;var o=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,t=/\n/g,a=/^\s*/,u=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,y=/^:\s*/,T=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,C=/^[;\s]*/,s=/^\s+|\s+$/g,B=`
`,V="/",W="*",Q="",oe="comment",he="declaration";function Je(Xe,st){if(typeof Xe!="string")throw new TypeError("First argument must be a string");if(!Xe)return[];st=st||{};var ft=1,ht=1;function Ft(Zt){var dn=Zt.match(t);dn&&(ft+=dn.length);var wt=Zt.lastIndexOf(B);ht=~wt?Zt.length-wt:ht+Zt.length}function fn(){var Zt={line:ft,column:ht};return function(dn){return dn.position=new St(Zt),Ve(),dn}}function St(Zt){this.start=Zt,this.end={line:ft,column:ht},this.source=st.source}St.prototype.content=Xe;function je(Zt){var dn=new Error(st.source+":"+ft+":"+ht+": "+Zt);if(dn.reason=Zt,dn.filename=st.source,dn.line=ft,dn.column=ht,dn.source=Xe,!st.silent)throw dn}function ze(Zt){var dn=Zt.exec(Xe);if(dn){var wt=dn[0];return Ft(wt),Xe=Xe.slice(wt.length),dn}}function Ve(){ze(a)}function Ke(Zt){var dn;for(Zt=Zt||[];dn=qe();)dn!==!1&&Zt.push(dn);return Zt}function qe(){var Zt=fn();if(!(V!=Xe.charAt(0)||W!=Xe.charAt(1))){for(var dn=2;Q!=Xe.charAt(dn)&&(W!=Xe.charAt(dn)||V!=Xe.charAt(dn+1));)++dn;if(dn+=2,Q===Xe.charAt(dn-1))return je("End of comment missing");var wt=Xe.slice(2,dn-2);return ht+=2,Ft(wt),Xe=Xe.slice(dn),ht+=2,Zt({type:oe,comment:wt})}}function et(){var Zt=fn(),dn=ze(u);if(dn){if(qe(),!ze(y))return je("property missing ':'");var wt=ze(T),Jt=Zt({type:he,property:Ye(dn[0].replace(o,Q)),value:wt?Ye(wt[0].replace(o,Q)):Q});return ze(C),Jt}}function be(){var Zt=[];Ke(Zt);for(var dn;dn=et();)dn!==!1&&(Zt.push(dn),Ke(Zt));return Zt}return Ve(),be()}function Ye(Xe){return Xe?Xe.replace(s,Q):Q}return PT=Je,PT}var dM;function j8(){if(dM)return my;dM=1;var o=my&&my.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(my,"__esModule",{value:!0}),my.default=a;const t=o(V8());function a(u,y){let T=null;if(!u||typeof u!="string")return T;const C=(0,t.default)(u),s=typeof y=="function";return C.forEach(B=>{if(B.type!=="declaration")return;const{property:V,value:W}=B;s?y(V,W,B):W&&(T=T||{},T[V]=W)}),T}return my}var lv={},fM;function U8(){if(fM)return lv;fM=1,Object.defineProperty(lv,"__esModule",{value:!0}),lv.camelCase=void 0;var o=/^--[a-zA-Z0-9_-]+$/,t=/-([a-z])/g,a=/^[^-]+$/,u=/^-(webkit|moz|ms|o|khtml)-/,y=/^-(ms)-/,T=function(V){return!V||a.test(V)||o.test(V)},C=function(V,W){return W.toUpperCase()},s=function(V,W){return"".concat(W,"-")},B=function(V,W){return W===void 0&&(W={}),T(V)?V:(V=V.toLowerCase(),W.reactCompat?V=V.replace(y,s):V=V.replace(u,s),V.replace(t,C))};return lv.camelCase=B,lv}var cv,pM;function G8(){if(pM)return cv;pM=1;var o=cv&&cv.__importDefault||function(y){return y&&y.__esModule?y:{default:y}},t=o(j8()),a=U8();function u(y,T){var C={};return!y||typeof y!="string"||(0,t.default)(y,function(s,B){s&&B&&(C[(0,a.camelCase)(s,T)]=B)}),C}return u.default=u,cv=u,cv}var q8=G8();const H8=Fv(q8),_L=yL("end"),HS=yL("start");function yL(o){return t;function t(a){const u=a&&a.position&&a.position[o]||{};if(typeof u.line=="number"&&u.line>0&&typeof u.column=="number"&&u.column>0)return{line:u.line,column:u.column,offset:typeof u.offset=="number"&&u.offset>-1?u.offset:void 0}}}function $8(o){const t=HS(o),a=_L(o);if(t&&a)return{start:t,end:a}}function Ev(o){return!o||typeof o!="object"?"":"position"in o||"type"in o?mM(o.position):"start"in o||"end"in o?mM(o):"line"in o||"column"in o?IE(o):""}function IE(o){return gM(o&&o.line)+":"+gM(o&&o.column)}function mM(o){return IE(o&&o.start)+"-"+IE(o&&o.end)}function gM(o){return o&&typeof o=="number"?o:1}class Cl extends Error{constructor(t,a,u){super(),typeof a=="string"&&(u=a,a=void 0);let y="",T={},C=!1;if(a&&("line"in a&&"column"in a?T={place:a}:"start"in a&&"end"in a?T={place:a}:"type"in a?T={ancestors:[a],place:a.position}:T={...a}),typeof t=="string"?y=t:!T.cause&&t&&(C=!0,y=t.message,T.cause=t),!T.ruleId&&!T.source&&typeof u=="string"){const B=u.indexOf(":");B===-1?T.ruleId=u:(T.source=u.slice(0,B),T.ruleId=u.slice(B+1))}if(!T.place&&T.ancestors&&T.ancestors){const B=T.ancestors[T.ancestors.length-1];B&&(T.place=B.position)}const s=T.place&&"start"in T.place?T.place.start:T.place;this.ancestors=T.ancestors||void 0,this.cause=T.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file="",this.message=y,this.line=s?s.line:void 0,this.name=Ev(T.place)||"1:1",this.place=T.place||void 0,this.reason=this.message,this.ruleId=T.ruleId||void 0,this.source=T.source||void 0,this.stack=C&&T.cause&&typeof T.cause.stack=="string"?T.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Cl.prototype.file="";Cl.prototype.name="";Cl.prototype.reason="";Cl.prototype.message="";Cl.prototype.stack="";Cl.prototype.column=void 0;Cl.prototype.line=void 0;Cl.prototype.ancestors=void 0;Cl.prototype.cause=void 0;Cl.prototype.fatal=void 0;Cl.prototype.place=void 0;Cl.prototype.ruleId=void 0;Cl.prototype.source=void 0;const $S={}.hasOwnProperty,Z8=new Map,W8=/[A-Z]/g,X8=new Set(["table","tbody","thead","tfoot","tr"]),Y8=new Set(["td","th"]),xL="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function K8(o,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const a=t.filePath||void 0;let u;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");u=s9(a,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");u=r9(a,t.jsx,t.jsxs)}const y={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:u,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:a,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?qS:B8,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},T=vL(y,o,void 0);return T&&typeof T!="string"?T:y.create(o,y.Fragment,{children:T||void 0},void 0)}function vL(o,t,a){if(t.type==="element")return Q8(o,t,a);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return J8(o,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return t9(o,t,a);if(t.type==="mdxjsEsm")return e9(o,t);if(t.type==="root")return n9(o,t,a);if(t.type==="text")return i9(o,t)}function Q8(o,t,a){const u=o.schema;let y=u;t.tagName.toLowerCase()==="svg"&&u.space==="html"&&(y=qS,o.schema=y),o.ancestors.push(t);const T=wL(o,t.tagName,!1),C=a9(o,t);let s=WS(o,t);return X8.has(t.tagName)&&(s=s.filter(function(B){return typeof B=="string"?!C8(B):!0})),bL(o,C,T,t),ZS(C,s),o.ancestors.pop(),o.schema=u,o.create(t,T,C,a)}function J8(o,t){if(t.data&&t.data.estree&&o.evaluater){const u=t.data.estree.body[0];return u.type,o.evaluater.evaluateExpression(u.expression)}Bv(o,t.position)}function e9(o,t){if(t.data&&t.data.estree&&o.evaluater)return o.evaluater.evaluateProgram(t.data.estree);Bv(o,t.position)}function t9(o,t,a){const u=o.schema;let y=u;t.name==="svg"&&u.space==="html"&&(y=qS,o.schema=y),o.ancestors.push(t);const T=t.name===null?o.Fragment:wL(o,t.name,!0),C=o9(o,t),s=WS(o,t);return bL(o,C,T,t),ZS(C,s),o.ancestors.pop(),o.schema=u,o.create(t,T,C,a)}function n9(o,t,a){const u={};return ZS(u,WS(o,t)),o.create(t,o.Fragment,u,a)}function i9(o,t){return t.value}function bL(o,t,a,u){typeof a!="string"&&a!==o.Fragment&&o.passNode&&(t.node=u)}function ZS(o,t){if(t.length>0){const a=t.length>1?t:t[0];a&&(o.children=a)}}function r9(o,t,a){return u;function u(y,T,C,s){const V=Array.isArray(C.children)?a:t;return s?V(T,C,s):V(T,C)}}function s9(o,t){return a;function a(u,y,T,C){const s=Array.isArray(T.children),B=HS(u);return t(y,T,C,s,{columnNumber:B?B.column-1:void 0,fileName:o,lineNumber:B?B.line:void 0},void 0)}}function a9(o,t){const a={};let u,y;for(y in t.properties)if(y!=="children"&&$S.call(t.properties,y)){const T=l9(o,y,t.properties[y]);if(T){const[C,s]=T;o.tableCellAlignToStyle&&C==="align"&&typeof s=="string"&&Y8.has(t.tagName)?u=s:a[C]=s}}if(u){const T=a.style||(a.style={});T[o.stylePropertyNameCase==="css"?"text-align":"textAlign"]=u}return a}function o9(o,t){const a={};for(const u of t.attributes)if(u.type==="mdxJsxExpressionAttribute")if(u.data&&u.data.estree&&o.evaluater){const T=u.data.estree.body[0];T.type;const C=T.expression;C.type;const s=C.properties[0];s.type,Object.assign(a,o.evaluater.evaluateExpression(s.argument))}else Bv(o,t.position);else{const y=u.name;let T;if(u.value&&typeof u.value=="object")if(u.value.data&&u.value.data.estree&&o.evaluater){const s=u.value.data.estree.body[0];s.type,T=o.evaluater.evaluateExpression(s.expression)}else Bv(o,t.position);else T=u.value===null?!0:u.value;a[y]=T}return a}function WS(o,t){const a=[];let u=-1;const y=o.passKeys?new Map:Z8;for(;++u<t.children.length;){const T=t.children[u];let C;if(o.passKeys){const B=T.type==="element"?T.tagName:T.type==="mdxJsxFlowElement"||T.type==="mdxJsxTextElement"?T.name:void 0;if(B){const V=y.get(B)||0;C=B+"-"+V,y.set(B,V+1)}}const s=vL(o,T,C);s!==void 0&&a.push(s)}return a}function l9(o,t,a){const u=z8(o.schema,t);if(!(a==null||typeof a=="number"&&Number.isNaN(a))){if(Array.isArray(a)&&(a=u.commaSeparated?T8(a):F8(a)),u.property==="style"){let y=typeof a=="object"?a:c9(o,String(a));return o.stylePropertyNameCase==="css"&&(y=u9(y)),["style",y]}return[o.elementAttributeNameCase==="react"&&u.space?P8[u.property]||u.property:u.attribute,a]}}function c9(o,t){try{return H8(t,{reactCompat:!0})}catch(a){if(o.ignoreInvalidStyle)return{};const u=a,y=new Cl("Cannot parse `style` attribute",{ancestors:o.ancestors,cause:u,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw y.file=o.filePath||void 0,y.url=xL+"#cannot-parse-style-attribute",y}}function wL(o,t,a){let u;if(!a)u={type:"Literal",value:t};else if(t.includes(".")){const y=t.split(".");let T=-1,C;for(;++T<y.length;){const s=oM(y[T])?{type:"Identifier",name:y[T]}:{type:"Literal",value:y[T]};C=C?{type:"MemberExpression",object:C,property:s,computed:!!(T&&s.type==="Literal"),optional:!1}:s}u=C}else u=oM(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(u.type==="Literal"){const y=u.value;return $S.call(o.components,y)?o.components[y]:y}if(o.evaluater)return o.evaluater.evaluateExpression(u);Bv(o)}function Bv(o,t){const a=new Cl("Cannot handle MDX estrees without `createEvaluater`",{ancestors:o.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw a.file=o.filePath||void 0,a.url=xL+"#cannot-handle-mdx-estrees-without-createevaluater",a}function u9(o){const t={};let a;for(a in o)$S.call(o,a)&&(t[h9(a)]=o[a]);return t}function h9(o){let t=o.replace(W8,d9);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function d9(o){return"-"+o.toLowerCase()}const kT={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},f9={};function p9(o,t){const a=f9,u=typeof a.includeImageAlt=="boolean"?a.includeImageAlt:!0,y=typeof a.includeHtml=="boolean"?a.includeHtml:!0;return TL(o,u,y)}function TL(o,t,a){if(m9(o)){if("value"in o)return o.type==="html"&&!a?"":o.value;if(t&&"alt"in o&&o.alt)return o.alt;if("children"in o)return _M(o.children,t,a)}return Array.isArray(o)?_M(o,t,a):""}function _M(o,t,a){const u=[];let y=-1;for(;++y<o.length;)u[y]=TL(o[y],t,a);return u.join("")}function m9(o){return!!(o&&typeof o=="object")}const yM=document.createElement("i");function XS(o){const t="&"+o+";";yM.innerHTML=t;const a=yM.textContent;return a.charCodeAt(a.length-1)===59&&o!=="semi"||a===t?!1:a}function uf(o,t,a,u){const y=o.length;let T=0,C;if(t<0?t=-t>y?0:y+t:t=t>y?y:t,a=a>0?a:0,u.length<1e4)C=Array.from(u),C.unshift(t,a),o.splice(...C);else for(a&&o.splice(t,a);T<u.length;)C=u.slice(T,T+1e4),C.unshift(t,0),o.splice(...C),T+=1e4,t+=1e4}function Yu(o,t){return o.length>0?(uf(o,o.length,0,t),o):t}const xM={}.hasOwnProperty;function g9(o){const t={};let a=-1;for(;++a<o.length;)_9(t,o[a]);return t}function _9(o,t){let a;for(a in t){const y=(xM.call(o,a)?o[a]:void 0)||(o[a]={}),T=t[a];let C;if(T)for(C in T){xM.call(y,C)||(y[C]=[]);const s=T[C];y9(y[C],Array.isArray(s)?s:s?[s]:[])}}}function y9(o,t){let a=-1;const u=[];for(;++a<t.length;)(t[a].add==="after"?o:u).push(t[a]);uf(o,0,0,u)}function EL(o,t){const a=Number.parseInt(o,t);return a<9||a===11||a>13&&a<32||a>126&&a<160||a>55295&&a<57344||a>64975&&a<65008||(a&65535)===65535||(a&65535)===65534||a>1114111?"":String.fromCodePoint(a)}function Cy(o){return o.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ef=Hm(/[A-Za-z]/),pu=Hm(/[\dA-Za-z]/),x9=Hm(/[#-'*+\--9=?A-Z^-~]/);function CE(o){return o!==null&&(o<32||o===127)}const RE=Hm(/\d/),v9=Hm(/[\dA-Fa-f]/),b9=Hm(/[!-/:-@[-`{-~]/);function Gi(o){return o!==null&&o<-2}function Pc(o){return o!==null&&(o<0||o===32)}function cs(o){return o===-2||o===-1||o===32}const w9=Hm(new RegExp("\\p{P}|\\p{S}","u")),T9=Hm(/\s/);function Hm(o){return t;function t(a){return a!==null&&a>-1&&o.test(String.fromCharCode(a))}}function Ky(o){const t=[];let a=-1,u=0,y=0;for(;++a<o.length;){const T=o.charCodeAt(a);let C="";if(T===37&&pu(o.charCodeAt(a+1))&&pu(o.charCodeAt(a+2)))y=2;else if(T<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(T))||(C=String.fromCharCode(T));else if(T>55295&&T<57344){const s=o.charCodeAt(a+1);T<56320&&s>56319&&s<57344?(C=String.fromCharCode(T,s),y=1):C=""}else C=String.fromCharCode(T);C&&(t.push(o.slice(u,a),encodeURIComponent(C)),u=a+y+1,C=""),y&&(a+=y,y=0)}return t.join("")+o.slice(u)}function Ns(o,t,a,u){const y=u?u-1:Number.POSITIVE_INFINITY;let T=0;return C;function C(B){return cs(B)?(o.enter(a),s(B)):t(B)}function s(B){return cs(B)&&T++<y?(o.consume(B),s):(o.exit(a),t(B))}}const E9={tokenize:S9};function S9(o){const t=o.attempt(this.parser.constructs.contentInitial,u,y);let a;return t;function u(s){if(s===null){o.consume(s);return}return o.enter("lineEnding"),o.consume(s),o.exit("lineEnding"),Ns(o,t,"linePrefix")}function y(s){return o.enter("paragraph"),T(s)}function T(s){const B=o.enter("chunkText",{contentType:"text",previous:a});return a&&(a.next=B),a=B,C(s)}function C(s){if(s===null){o.exit("chunkText"),o.exit("paragraph"),o.consume(s);return}return Gi(s)?(o.consume(s),o.exit("chunkText"),T):(o.consume(s),C)}}const A9={tokenize:I9},vM={tokenize:C9};function I9(o){const t=this,a=[];let u=0,y,T,C;return s;function s(ht){if(u<a.length){const Ft=a[u];return t.containerState=Ft[1],o.attempt(Ft[0].continuation,B,V)(ht)}return V(ht)}function B(ht){if(u++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,y&&ft();const Ft=t.events.length;let fn=Ft,St;for(;fn--;)if(t.events[fn][0]==="exit"&&t.events[fn][1].type==="chunkFlow"){St=t.events[fn][1].end;break}st(u);let je=Ft;for(;je<t.events.length;)t.events[je][1].end={...St},je++;return uf(t.events,fn+1,0,t.events.slice(Ft)),t.events.length=je,V(ht)}return s(ht)}function V(ht){if(u===a.length){if(!y)return oe(ht);if(y.currentConstruct&&y.currentConstruct.concrete)return Je(ht);t.interrupt=!!(y.currentConstruct&&!y._gfmTableDynamicInterruptHack)}return t.containerState={},o.check(vM,W,Q)(ht)}function W(ht){return y&&ft(),st(u),oe(ht)}function Q(ht){return t.parser.lazy[t.now().line]=u!==a.length,C=t.now().offset,Je(ht)}function oe(ht){return t.containerState={},o.attempt(vM,he,Je)(ht)}function he(ht){return u++,a.push([t.currentConstruct,t.containerState]),oe(ht)}function Je(ht){if(ht===null){y&&ft(),st(0),o.consume(ht);return}return y=y||t.parser.flow(t.now()),o.enter("chunkFlow",{_tokenizer:y,contentType:"flow",previous:T}),Ye(ht)}function Ye(ht){if(ht===null){Xe(o.exit("chunkFlow"),!0),st(0),o.consume(ht);return}return Gi(ht)?(o.consume(ht),Xe(o.exit("chunkFlow")),u=0,t.interrupt=void 0,s):(o.consume(ht),Ye)}function Xe(ht,Ft){const fn=t.sliceStream(ht);if(Ft&&fn.push(null),ht.previous=T,T&&(T.next=ht),T=ht,y.defineSkip(ht.start),y.write(fn),t.parser.lazy[ht.start.line]){let St=y.events.length;for(;St--;)if(y.events[St][1].start.offset<C&&(!y.events[St][1].end||y.events[St][1].end.offset>C))return;const je=t.events.length;let ze=je,Ve,Ke;for(;ze--;)if(t.events[ze][0]==="exit"&&t.events[ze][1].type==="chunkFlow"){if(Ve){Ke=t.events[ze][1].end;break}Ve=!0}for(st(u),St=je;St<t.events.length;)t.events[St][1].end={...Ke},St++;uf(t.events,ze+1,0,t.events.slice(je)),t.events.length=St}}function st(ht){let Ft=a.length;for(;Ft-- >ht;){const fn=a[Ft];t.containerState=fn[1],fn[0].exit.call(t,o)}a.length=ht}function ft(){y.write([null]),T=void 0,y=void 0,t.containerState._closeFlow=void 0}}function C9(o,t,a){return Ns(o,o.attempt(this.parser.constructs.document,t,a),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function bM(o){if(o===null||Pc(o)||T9(o))return 1;if(w9(o))return 2}function YS(o,t,a){const u=[];let y=-1;for(;++y<o.length;){const T=o[y].resolveAll;T&&!u.includes(T)&&(t=T(t,a),u.push(T))}return t}const ME={name:"attention",resolveAll:R9,tokenize:M9};function R9(o,t){let a=-1,u,y,T,C,s,B,V,W;for(;++a<o.length;)if(o[a][0]==="enter"&&o[a][1].type==="attentionSequence"&&o[a][1]._close){for(u=a;u--;)if(o[u][0]==="exit"&&o[u][1].type==="attentionSequence"&&o[u][1]._open&&t.sliceSerialize(o[u][1]).charCodeAt(0)===t.sliceSerialize(o[a][1]).charCodeAt(0)){if((o[u][1]._close||o[a][1]._open)&&(o[a][1].end.offset-o[a][1].start.offset)%3&&!((o[u][1].end.offset-o[u][1].start.offset+o[a][1].end.offset-o[a][1].start.offset)%3))continue;B=o[u][1].end.offset-o[u][1].start.offset>1&&o[a][1].end.offset-o[a][1].start.offset>1?2:1;const Q={...o[u][1].end},oe={...o[a][1].start};wM(Q,-B),wM(oe,B),C={type:B>1?"strongSequence":"emphasisSequence",start:Q,end:{...o[u][1].end}},s={type:B>1?"strongSequence":"emphasisSequence",start:{...o[a][1].start},end:oe},T={type:B>1?"strongText":"emphasisText",start:{...o[u][1].end},end:{...o[a][1].start}},y={type:B>1?"strong":"emphasis",start:{...C.start},end:{...s.end}},o[u][1].end={...C.start},o[a][1].start={...s.end},V=[],o[u][1].end.offset-o[u][1].start.offset&&(V=Yu(V,[["enter",o[u][1],t],["exit",o[u][1],t]])),V=Yu(V,[["enter",y,t],["enter",C,t],["exit",C,t],["enter",T,t]]),V=Yu(V,YS(t.parser.constructs.insideSpan.null,o.slice(u+1,a),t)),V=Yu(V,[["exit",T,t],["enter",s,t],["exit",s,t],["exit",y,t]]),o[a][1].end.offset-o[a][1].start.offset?(W=2,V=Yu(V,[["enter",o[a][1],t],["exit",o[a][1],t]])):W=0,uf(o,u-1,a-u+3,V),a=u+V.length-W-2;break}}for(a=-1;++a<o.length;)o[a][1].type==="attentionSequence"&&(o[a][1].type="data");return o}function M9(o,t){const a=this.parser.constructs.attentionMarkers.null,u=this.previous,y=bM(u);let T;return C;function C(B){return T=B,o.enter("attentionSequence"),s(B)}function s(B){if(B===T)return o.consume(B),s;const V=o.exit("attentionSequence"),W=bM(B),Q=!W||W===2&&y||a.includes(B),oe=!y||y===2&&W||a.includes(u);return V._open=!!(T===42?Q:Q&&(y||!oe)),V._close=!!(T===42?oe:oe&&(W||!Q)),t(B)}}function wM(o,t){o.column+=t,o.offset+=t,o._bufferIndex+=t}const D9={name:"autolink",tokenize:P9};function P9(o,t,a){let u=0;return y;function y(he){return o.enter("autolink"),o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.enter("autolinkProtocol"),T}function T(he){return ef(he)?(o.consume(he),C):he===64?a(he):V(he)}function C(he){return he===43||he===45||he===46||pu(he)?(u=1,s(he)):V(he)}function s(he){return he===58?(o.consume(he),u=0,B):(he===43||he===45||he===46||pu(he))&&u++<32?(o.consume(he),s):(u=0,V(he))}function B(he){return he===62?(o.exit("autolinkProtocol"),o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.exit("autolink"),t):he===null||he===32||he===60||CE(he)?a(he):(o.consume(he),B)}function V(he){return he===64?(o.consume(he),W):x9(he)?(o.consume(he),V):a(he)}function W(he){return pu(he)?Q(he):a(he)}function Q(he){return he===46?(o.consume(he),u=0,W):he===62?(o.exit("autolinkProtocol").type="autolinkEmail",o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.exit("autolink"),t):oe(he)}function oe(he){if((he===45||pu(he))&&u++<63){const Je=he===45?oe:Q;return o.consume(he),Je}return a(he)}}const F1={partial:!0,tokenize:k9};function k9(o,t,a){return u;function u(T){return cs(T)?Ns(o,y,"linePrefix")(T):y(T)}function y(T){return T===null||Gi(T)?t(T):a(T)}}const SL={continuation:{tokenize:z9},exit:O9,name:"blockQuote",tokenize:L9};function L9(o,t,a){const u=this;return y;function y(C){if(C===62){const s=u.containerState;return s.open||(o.enter("blockQuote",{_container:!0}),s.open=!0),o.enter("blockQuotePrefix"),o.enter("blockQuoteMarker"),o.consume(C),o.exit("blockQuoteMarker"),T}return a(C)}function T(C){return cs(C)?(o.enter("blockQuotePrefixWhitespace"),o.consume(C),o.exit("blockQuotePrefixWhitespace"),o.exit("blockQuotePrefix"),t):(o.exit("blockQuotePrefix"),t(C))}}function z9(o,t,a){const u=this;return y;function y(C){return cs(C)?Ns(o,T,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):T(C)}function T(C){return o.attempt(SL,t,a)(C)}}function O9(o){o.exit("blockQuote")}const AL={name:"characterEscape",tokenize:N9};function N9(o,t,a){return u;function u(T){return o.enter("characterEscape"),o.enter("escapeMarker"),o.consume(T),o.exit("escapeMarker"),y}function y(T){return b9(T)?(o.enter("characterEscapeValue"),o.consume(T),o.exit("characterEscapeValue"),o.exit("characterEscape"),t):a(T)}}const IL={name:"characterReference",tokenize:B9};function B9(o,t,a){const u=this;let y=0,T,C;return s;function s(Q){return o.enter("characterReference"),o.enter("characterReferenceMarker"),o.consume(Q),o.exit("characterReferenceMarker"),B}function B(Q){return Q===35?(o.enter("characterReferenceMarkerNumeric"),o.consume(Q),o.exit("characterReferenceMarkerNumeric"),V):(o.enter("characterReferenceValue"),T=31,C=pu,W(Q))}function V(Q){return Q===88||Q===120?(o.enter("characterReferenceMarkerHexadecimal"),o.consume(Q),o.exit("characterReferenceMarkerHexadecimal"),o.enter("characterReferenceValue"),T=6,C=v9,W):(o.enter("characterReferenceValue"),T=7,C=RE,W(Q))}function W(Q){if(Q===59&&y){const oe=o.exit("characterReferenceValue");return C===pu&&!XS(u.sliceSerialize(oe))?a(Q):(o.enter("characterReferenceMarker"),o.consume(Q),o.exit("characterReferenceMarker"),o.exit("characterReference"),t)}return C(Q)&&y++<T?(o.consume(Q),W):a(Q)}}const TM={partial:!0,tokenize:V9},EM={concrete:!0,name:"codeFenced",tokenize:F9};function F9(o,t,a){const u=this,y={partial:!0,tokenize:fn};let T=0,C=0,s;return B;function B(St){return V(St)}function V(St){const je=u.events[u.events.length-1];return T=je&&je[1].type==="linePrefix"?je[2].sliceSerialize(je[1],!0).length:0,s=St,o.enter("codeFenced"),o.enter("codeFencedFence"),o.enter("codeFencedFenceSequence"),W(St)}function W(St){return St===s?(C++,o.consume(St),W):C<3?a(St):(o.exit("codeFencedFenceSequence"),cs(St)?Ns(o,Q,"whitespace")(St):Q(St))}function Q(St){return St===null||Gi(St)?(o.exit("codeFencedFence"),u.interrupt?t(St):o.check(TM,Ye,Ft)(St)):(o.enter("codeFencedFenceInfo"),o.enter("chunkString",{contentType:"string"}),oe(St))}function oe(St){return St===null||Gi(St)?(o.exit("chunkString"),o.exit("codeFencedFenceInfo"),Q(St)):cs(St)?(o.exit("chunkString"),o.exit("codeFencedFenceInfo"),Ns(o,he,"whitespace")(St)):St===96&&St===s?a(St):(o.consume(St),oe)}function he(St){return St===null||Gi(St)?Q(St):(o.enter("codeFencedFenceMeta"),o.enter("chunkString",{contentType:"string"}),Je(St))}function Je(St){return St===null||Gi(St)?(o.exit("chunkString"),o.exit("codeFencedFenceMeta"),Q(St)):St===96&&St===s?a(St):(o.consume(St),Je)}function Ye(St){return o.attempt(y,Ft,Xe)(St)}function Xe(St){return o.enter("lineEnding"),o.consume(St),o.exit("lineEnding"),st}function st(St){return T>0&&cs(St)?Ns(o,ft,"linePrefix",T+1)(St):ft(St)}function ft(St){return St===null||Gi(St)?o.check(TM,Ye,Ft)(St):(o.enter("codeFlowValue"),ht(St))}function ht(St){return St===null||Gi(St)?(o.exit("codeFlowValue"),ft(St)):(o.consume(St),ht)}function Ft(St){return o.exit("codeFenced"),t(St)}function fn(St,je,ze){let Ve=0;return Ke;function Ke(dn){return St.enter("lineEnding"),St.consume(dn),St.exit("lineEnding"),qe}function qe(dn){return St.enter("codeFencedFence"),cs(dn)?Ns(St,et,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(dn):et(dn)}function et(dn){return dn===s?(St.enter("codeFencedFenceSequence"),be(dn)):ze(dn)}function be(dn){return dn===s?(Ve++,St.consume(dn),be):Ve>=C?(St.exit("codeFencedFenceSequence"),cs(dn)?Ns(St,Zt,"whitespace")(dn):Zt(dn)):ze(dn)}function Zt(dn){return dn===null||Gi(dn)?(St.exit("codeFencedFence"),je(dn)):ze(dn)}}}function V9(o,t,a){const u=this;return y;function y(C){return C===null?a(C):(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),T)}function T(C){return u.parser.lazy[u.now().line]?a(C):t(C)}}const LT={name:"codeIndented",tokenize:U9},j9={partial:!0,tokenize:G9};function U9(o,t,a){const u=this;return y;function y(V){return o.enter("codeIndented"),Ns(o,T,"linePrefix",5)(V)}function T(V){const W=u.events[u.events.length-1];return W&&W[1].type==="linePrefix"&&W[2].sliceSerialize(W[1],!0).length>=4?C(V):a(V)}function C(V){return V===null?B(V):Gi(V)?o.attempt(j9,C,B)(V):(o.enter("codeFlowValue"),s(V))}function s(V){return V===null||Gi(V)?(o.exit("codeFlowValue"),C(V)):(o.consume(V),s)}function B(V){return o.exit("codeIndented"),t(V)}}function G9(o,t,a){const u=this;return y;function y(C){return u.parser.lazy[u.now().line]?a(C):Gi(C)?(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),y):Ns(o,T,"linePrefix",5)(C)}function T(C){const s=u.events[u.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(C):Gi(C)?y(C):a(C)}}const q9={name:"codeText",previous:$9,resolve:H9,tokenize:Z9};function H9(o){let t=o.length-4,a=3,u,y;if((o[a][1].type==="lineEnding"||o[a][1].type==="space")&&(o[t][1].type==="lineEnding"||o[t][1].type==="space")){for(u=a;++u<t;)if(o[u][1].type==="codeTextData"){o[a][1].type="codeTextPadding",o[t][1].type="codeTextPadding",a+=2,t-=2;break}}for(u=a-1,t++;++u<=t;)y===void 0?u!==t&&o[u][1].type!=="lineEnding"&&(y=u):(u===t||o[u][1].type==="lineEnding")&&(o[y][1].type="codeTextData",u!==y+2&&(o[y][1].end=o[u-1][1].end,o.splice(y+2,u-y-2),t-=u-y-2,u=y+2),y=void 0);return o}function $9(o){return o!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Z9(o,t,a){let u=0,y,T;return C;function C(Q){return o.enter("codeText"),o.enter("codeTextSequence"),s(Q)}function s(Q){return Q===96?(o.consume(Q),u++,s):(o.exit("codeTextSequence"),B(Q))}function B(Q){return Q===null?a(Q):Q===32?(o.enter("space"),o.consume(Q),o.exit("space"),B):Q===96?(T=o.enter("codeTextSequence"),y=0,W(Q)):Gi(Q)?(o.enter("lineEnding"),o.consume(Q),o.exit("lineEnding"),B):(o.enter("codeTextData"),V(Q))}function V(Q){return Q===null||Q===32||Q===96||Gi(Q)?(o.exit("codeTextData"),B(Q)):(o.consume(Q),V)}function W(Q){return Q===96?(o.consume(Q),y++,W):y===u?(o.exit("codeTextSequence"),o.exit("codeText"),t(Q)):(T.type="codeTextData",V(Q))}}class W9{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,a){const u=a??Number.POSITIVE_INFINITY;return u<this.left.length?this.left.slice(t,u):t>this.left.length?this.right.slice(this.right.length-u+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-u+this.left.length).reverse())}splice(t,a,u){const y=a||0;this.setCursor(Math.trunc(t));const T=this.right.splice(this.right.length-y,Number.POSITIVE_INFINITY);return u&&uv(this.left,u),T.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),uv(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),uv(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const a=this.left.splice(t,Number.POSITIVE_INFINITY);uv(this.right,a.reverse())}else{const a=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);uv(this.left,a.reverse())}}}function uv(o,t){let a=0;if(t.length<1e4)o.push(...t);else for(;a<t.length;)o.push(...t.slice(a,a+1e4)),a+=1e4}function CL(o){const t={};let a=-1,u,y,T,C,s,B,V;const W=new W9(o);for(;++a<W.length;){for(;a in t;)a=t[a];if(u=W.get(a),a&&u[1].type==="chunkFlow"&&W.get(a-1)[1].type==="listItemPrefix"&&(B=u[1]._tokenizer.events,T=0,T<B.length&&B[T][1].type==="lineEndingBlank"&&(T+=2),T<B.length&&B[T][1].type==="content"))for(;++T<B.length&&B[T][1].type!=="content";)B[T][1].type==="chunkText"&&(B[T][1]._isInFirstContentOfListItem=!0,T++);if(u[0]==="enter")u[1].contentType&&(Object.assign(t,X9(W,a)),a=t[a],V=!0);else if(u[1]._container){for(T=a,y=void 0;T--;)if(C=W.get(T),C[1].type==="lineEnding"||C[1].type==="lineEndingBlank")C[0]==="enter"&&(y&&(W.get(y)[1].type="lineEndingBlank"),C[1].type="lineEnding",y=T);else if(!(C[1].type==="linePrefix"||C[1].type==="listItemIndent"))break;y&&(u[1].end={...W.get(y)[1].start},s=W.slice(y,a),s.unshift(u),W.splice(y,a-y+1,s))}}return uf(o,0,Number.POSITIVE_INFINITY,W.slice(0)),!V}function X9(o,t){const a=o.get(t)[1],u=o.get(t)[2];let y=t-1;const T=[];let C=a._tokenizer;C||(C=u.parser[a.contentType](a.start),a._contentTypeTextTrailing&&(C._contentTypeTextTrailing=!0));const s=C.events,B=[],V={};let W,Q,oe=-1,he=a,Je=0,Ye=0;const Xe=[Ye];for(;he;){for(;o.get(++y)[1]!==he;);T.push(y),he._tokenizer||(W=u.sliceStream(he),he.next||W.push(null),Q&&C.defineSkip(he.start),he._isInFirstContentOfListItem&&(C._gfmTasklistFirstContentOfListItem=!0),C.write(W),he._isInFirstContentOfListItem&&(C._gfmTasklistFirstContentOfListItem=void 0)),Q=he,he=he.next}for(he=a;++oe<s.length;)s[oe][0]==="exit"&&s[oe-1][0]==="enter"&&s[oe][1].type===s[oe-1][1].type&&s[oe][1].start.line!==s[oe][1].end.line&&(Ye=oe+1,Xe.push(Ye),he._tokenizer=void 0,he.previous=void 0,he=he.next);for(C.events=[],he?(he._tokenizer=void 0,he.previous=void 0):Xe.pop(),oe=Xe.length;oe--;){const st=s.slice(Xe[oe],Xe[oe+1]),ft=T.pop();B.push([ft,ft+st.length-1]),o.splice(ft,2,st)}for(B.reverse(),oe=-1;++oe<B.length;)V[Je+B[oe][0]]=Je+B[oe][1],Je+=B[oe][1]-B[oe][0]-1;return V}const Y9={resolve:Q9,tokenize:J9},K9={partial:!0,tokenize:eG};function Q9(o){return CL(o),o}function J9(o,t){let a;return u;function u(s){return o.enter("content"),a=o.enter("chunkContent",{contentType:"content"}),y(s)}function y(s){return s===null?T(s):Gi(s)?o.check(K9,C,T)(s):(o.consume(s),y)}function T(s){return o.exit("chunkContent"),o.exit("content"),t(s)}function C(s){return o.consume(s),o.exit("chunkContent"),a.next=o.enter("chunkContent",{contentType:"content",previous:a}),a=a.next,y}}function eG(o,t,a){const u=this;return y;function y(C){return o.exit("chunkContent"),o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),Ns(o,T,"linePrefix")}function T(C){if(C===null||Gi(C))return a(C);const s=u.events[u.events.length-1];return!u.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(C):o.interrupt(u.parser.constructs.flow,a,t)(C)}}function RL(o,t,a,u,y,T,C,s,B){const V=B||Number.POSITIVE_INFINITY;let W=0;return Q;function Q(st){return st===60?(o.enter(u),o.enter(y),o.enter(T),o.consume(st),o.exit(T),oe):st===null||st===32||st===41||CE(st)?a(st):(o.enter(u),o.enter(C),o.enter(s),o.enter("chunkString",{contentType:"string"}),Ye(st))}function oe(st){return st===62?(o.enter(T),o.consume(st),o.exit(T),o.exit(y),o.exit(u),t):(o.enter(s),o.enter("chunkString",{contentType:"string"}),he(st))}function he(st){return st===62?(o.exit("chunkString"),o.exit(s),oe(st)):st===null||st===60||Gi(st)?a(st):(o.consume(st),st===92?Je:he)}function Je(st){return st===60||st===62||st===92?(o.consume(st),he):he(st)}function Ye(st){return!W&&(st===null||st===41||Pc(st))?(o.exit("chunkString"),o.exit(s),o.exit(C),o.exit(u),t(st)):W<V&&st===40?(o.consume(st),W++,Ye):st===41?(o.consume(st),W--,Ye):st===null||st===32||st===40||CE(st)?a(st):(o.consume(st),st===92?Xe:Ye)}function Xe(st){return st===40||st===41||st===92?(o.consume(st),Ye):Ye(st)}}function ML(o,t,a,u,y,T){const C=this;let s=0,B;return V;function V(he){return o.enter(u),o.enter(y),o.consume(he),o.exit(y),o.enter(T),W}function W(he){return s>999||he===null||he===91||he===93&&!B||he===94&&!s&&"_hiddenFootnoteSupport"in C.parser.constructs?a(he):he===93?(o.exit(T),o.enter(y),o.consume(he),o.exit(y),o.exit(u),t):Gi(he)?(o.enter("lineEnding"),o.consume(he),o.exit("lineEnding"),W):(o.enter("chunkString",{contentType:"string"}),Q(he))}function Q(he){return he===null||he===91||he===93||Gi(he)||s++>999?(o.exit("chunkString"),W(he)):(o.consume(he),B||(B=!cs(he)),he===92?oe:Q)}function oe(he){return he===91||he===92||he===93?(o.consume(he),s++,Q):Q(he)}}function DL(o,t,a,u,y,T){let C;return s;function s(oe){return oe===34||oe===39||oe===40?(o.enter(u),o.enter(y),o.consume(oe),o.exit(y),C=oe===40?41:oe,B):a(oe)}function B(oe){return oe===C?(o.enter(y),o.consume(oe),o.exit(y),o.exit(u),t):(o.enter(T),V(oe))}function V(oe){return oe===C?(o.exit(T),B(C)):oe===null?a(oe):Gi(oe)?(o.enter("lineEnding"),o.consume(oe),o.exit("lineEnding"),Ns(o,V,"linePrefix")):(o.enter("chunkString",{contentType:"string"}),W(oe))}function W(oe){return oe===C||oe===null||Gi(oe)?(o.exit("chunkString"),V(oe)):(o.consume(oe),oe===92?Q:W)}function Q(oe){return oe===C||oe===92?(o.consume(oe),W):W(oe)}}function Sv(o,t){let a;return u;function u(y){return Gi(y)?(o.enter("lineEnding"),o.consume(y),o.exit("lineEnding"),a=!0,u):cs(y)?Ns(o,u,a?"linePrefix":"lineSuffix")(y):t(y)}}const tG={name:"definition",tokenize:iG},nG={partial:!0,tokenize:rG};function iG(o,t,a){const u=this;let y;return T;function T(he){return o.enter("definition"),C(he)}function C(he){return ML.call(u,o,s,a,"definitionLabel","definitionLabelMarker","definitionLabelString")(he)}function s(he){return y=Cy(u.sliceSerialize(u.events[u.events.length-1][1]).slice(1,-1)),he===58?(o.enter("definitionMarker"),o.consume(he),o.exit("definitionMarker"),B):a(he)}function B(he){return Pc(he)?Sv(o,V)(he):V(he)}function V(he){return RL(o,W,a,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(he)}function W(he){return o.attempt(nG,Q,Q)(he)}function Q(he){return cs(he)?Ns(o,oe,"whitespace")(he):oe(he)}function oe(he){return he===null||Gi(he)?(o.exit("definition"),u.parser.defined.push(y),t(he)):a(he)}}function rG(o,t,a){return u;function u(s){return Pc(s)?Sv(o,y)(s):a(s)}function y(s){return DL(o,T,a,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function T(s){return cs(s)?Ns(o,C,"whitespace")(s):C(s)}function C(s){return s===null||Gi(s)?t(s):a(s)}}const sG={name:"hardBreakEscape",tokenize:aG};function aG(o,t,a){return u;function u(T){return o.enter("hardBreakEscape"),o.consume(T),y}function y(T){return Gi(T)?(o.exit("hardBreakEscape"),t(T)):a(T)}}const oG={name:"headingAtx",resolve:lG,tokenize:cG};function lG(o,t){let a=o.length-2,u=3,y,T;return o[u][1].type==="whitespace"&&(u+=2),a-2>u&&o[a][1].type==="whitespace"&&(a-=2),o[a][1].type==="atxHeadingSequence"&&(u===a-1||a-4>u&&o[a-2][1].type==="whitespace")&&(a-=u+1===a?2:4),a>u&&(y={type:"atxHeadingText",start:o[u][1].start,end:o[a][1].end},T={type:"chunkText",start:o[u][1].start,end:o[a][1].end,contentType:"text"},uf(o,u,a-u+1,[["enter",y,t],["enter",T,t],["exit",T,t],["exit",y,t]])),o}function cG(o,t,a){let u=0;return y;function y(W){return o.enter("atxHeading"),T(W)}function T(W){return o.enter("atxHeadingSequence"),C(W)}function C(W){return W===35&&u++<6?(o.consume(W),C):W===null||Pc(W)?(o.exit("atxHeadingSequence"),s(W)):a(W)}function s(W){return W===35?(o.enter("atxHeadingSequence"),B(W)):W===null||Gi(W)?(o.exit("atxHeading"),t(W)):cs(W)?Ns(o,s,"whitespace")(W):(o.enter("atxHeadingText"),V(W))}function B(W){return W===35?(o.consume(W),B):(o.exit("atxHeadingSequence"),s(W))}function V(W){return W===null||W===35||Pc(W)?(o.exit("atxHeadingText"),s(W)):(o.consume(W),V)}}const uG=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],SM=["pre","script","style","textarea"],hG={concrete:!0,name:"htmlFlow",resolveTo:pG,tokenize:mG},dG={partial:!0,tokenize:_G},fG={partial:!0,tokenize:gG};function pG(o){let t=o.length;for(;t--&&!(o[t][0]==="enter"&&o[t][1].type==="htmlFlow"););return t>1&&o[t-2][1].type==="linePrefix"&&(o[t][1].start=o[t-2][1].start,o[t+1][1].start=o[t-2][1].start,o.splice(t-2,2)),o}function mG(o,t,a){const u=this;let y,T,C,s,B;return V;function V(Ne){return W(Ne)}function W(Ne){return o.enter("htmlFlow"),o.enter("htmlFlowData"),o.consume(Ne),Q}function Q(Ne){return Ne===33?(o.consume(Ne),oe):Ne===47?(o.consume(Ne),T=!0,Ye):Ne===63?(o.consume(Ne),y=3,u.interrupt?t:tt):ef(Ne)?(o.consume(Ne),C=String.fromCharCode(Ne),Xe):a(Ne)}function oe(Ne){return Ne===45?(o.consume(Ne),y=2,he):Ne===91?(o.consume(Ne),y=5,s=0,Je):ef(Ne)?(o.consume(Ne),y=4,u.interrupt?t:tt):a(Ne)}function he(Ne){return Ne===45?(o.consume(Ne),u.interrupt?t:tt):a(Ne)}function Je(Ne){const wn="CDATA[";return Ne===wn.charCodeAt(s++)?(o.consume(Ne),s===wn.length?u.interrupt?t:et:Je):a(Ne)}function Ye(Ne){return ef(Ne)?(o.consume(Ne),C=String.fromCharCode(Ne),Xe):a(Ne)}function Xe(Ne){if(Ne===null||Ne===47||Ne===62||Pc(Ne)){const wn=Ne===47,Kn=C.toLowerCase();return!wn&&!T&&SM.includes(Kn)?(y=1,u.interrupt?t(Ne):et(Ne)):uG.includes(C.toLowerCase())?(y=6,wn?(o.consume(Ne),st):u.interrupt?t(Ne):et(Ne)):(y=7,u.interrupt&&!u.parser.lazy[u.now().line]?a(Ne):T?ft(Ne):ht(Ne))}return Ne===45||pu(Ne)?(o.consume(Ne),C+=String.fromCharCode(Ne),Xe):a(Ne)}function st(Ne){return Ne===62?(o.consume(Ne),u.interrupt?t:et):a(Ne)}function ft(Ne){return cs(Ne)?(o.consume(Ne),ft):Ke(Ne)}function ht(Ne){return Ne===47?(o.consume(Ne),Ke):Ne===58||Ne===95||ef(Ne)?(o.consume(Ne),Ft):cs(Ne)?(o.consume(Ne),ht):Ke(Ne)}function Ft(Ne){return Ne===45||Ne===46||Ne===58||Ne===95||pu(Ne)?(o.consume(Ne),Ft):fn(Ne)}function fn(Ne){return Ne===61?(o.consume(Ne),St):cs(Ne)?(o.consume(Ne),fn):ht(Ne)}function St(Ne){return Ne===null||Ne===60||Ne===61||Ne===62||Ne===96?a(Ne):Ne===34||Ne===39?(o.consume(Ne),B=Ne,je):cs(Ne)?(o.consume(Ne),St):ze(Ne)}function je(Ne){return Ne===B?(o.consume(Ne),B=null,Ve):Ne===null||Gi(Ne)?a(Ne):(o.consume(Ne),je)}function ze(Ne){return Ne===null||Ne===34||Ne===39||Ne===47||Ne===60||Ne===61||Ne===62||Ne===96||Pc(Ne)?fn(Ne):(o.consume(Ne),ze)}function Ve(Ne){return Ne===47||Ne===62||cs(Ne)?ht(Ne):a(Ne)}function Ke(Ne){return Ne===62?(o.consume(Ne),qe):a(Ne)}function qe(Ne){return Ne===null||Gi(Ne)?et(Ne):cs(Ne)?(o.consume(Ne),qe):a(Ne)}function et(Ne){return Ne===45&&y===2?(o.consume(Ne),wt):Ne===60&&y===1?(o.consume(Ne),Jt):Ne===62&&y===4?(o.consume(Ne),dt):Ne===63&&y===3?(o.consume(Ne),tt):Ne===93&&y===5?(o.consume(Ne),ci):Gi(Ne)&&(y===6||y===7)?(o.exit("htmlFlowData"),o.check(dG,Kt,be)(Ne)):Ne===null||Gi(Ne)?(o.exit("htmlFlowData"),be(Ne)):(o.consume(Ne),et)}function be(Ne){return o.check(fG,Zt,Kt)(Ne)}function Zt(Ne){return o.enter("lineEnding"),o.consume(Ne),o.exit("lineEnding"),dn}function dn(Ne){return Ne===null||Gi(Ne)?be(Ne):(o.enter("htmlFlowData"),et(Ne))}function wt(Ne){return Ne===45?(o.consume(Ne),tt):et(Ne)}function Jt(Ne){return Ne===47?(o.consume(Ne),C="",En):et(Ne)}function En(Ne){if(Ne===62){const wn=C.toLowerCase();return SM.includes(wn)?(o.consume(Ne),dt):et(Ne)}return ef(Ne)&&C.length<8?(o.consume(Ne),C+=String.fromCharCode(Ne),En):et(Ne)}function ci(Ne){return Ne===93?(o.consume(Ne),tt):et(Ne)}function tt(Ne){return Ne===62?(o.consume(Ne),dt):Ne===45&&y===2?(o.consume(Ne),tt):et(Ne)}function dt(Ne){return Ne===null||Gi(Ne)?(o.exit("htmlFlowData"),Kt(Ne)):(o.consume(Ne),dt)}function Kt(Ne){return o.exit("htmlFlow"),t(Ne)}}function gG(o,t,a){const u=this;return y;function y(C){return Gi(C)?(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),T):a(C)}function T(C){return u.parser.lazy[u.now().line]?a(C):t(C)}}function _G(o,t,a){return u;function u(y){return o.enter("lineEnding"),o.consume(y),o.exit("lineEnding"),o.attempt(F1,t,a)}}const yG={name:"htmlText",tokenize:xG};function xG(o,t,a){const u=this;let y,T,C;return s;function s(tt){return o.enter("htmlText"),o.enter("htmlTextData"),o.consume(tt),B}function B(tt){return tt===33?(o.consume(tt),V):tt===47?(o.consume(tt),fn):tt===63?(o.consume(tt),ht):ef(tt)?(o.consume(tt),ze):a(tt)}function V(tt){return tt===45?(o.consume(tt),W):tt===91?(o.consume(tt),T=0,Je):ef(tt)?(o.consume(tt),ft):a(tt)}function W(tt){return tt===45?(o.consume(tt),he):a(tt)}function Q(tt){return tt===null?a(tt):tt===45?(o.consume(tt),oe):Gi(tt)?(C=Q,Jt(tt)):(o.consume(tt),Q)}function oe(tt){return tt===45?(o.consume(tt),he):Q(tt)}function he(tt){return tt===62?wt(tt):tt===45?oe(tt):Q(tt)}function Je(tt){const dt="CDATA[";return tt===dt.charCodeAt(T++)?(o.consume(tt),T===dt.length?Ye:Je):a(tt)}function Ye(tt){return tt===null?a(tt):tt===93?(o.consume(tt),Xe):Gi(tt)?(C=Ye,Jt(tt)):(o.consume(tt),Ye)}function Xe(tt){return tt===93?(o.consume(tt),st):Ye(tt)}function st(tt){return tt===62?wt(tt):tt===93?(o.consume(tt),st):Ye(tt)}function ft(tt){return tt===null||tt===62?wt(tt):Gi(tt)?(C=ft,Jt(tt)):(o.consume(tt),ft)}function ht(tt){return tt===null?a(tt):tt===63?(o.consume(tt),Ft):Gi(tt)?(C=ht,Jt(tt)):(o.consume(tt),ht)}function Ft(tt){return tt===62?wt(tt):ht(tt)}function fn(tt){return ef(tt)?(o.consume(tt),St):a(tt)}function St(tt){return tt===45||pu(tt)?(o.consume(tt),St):je(tt)}function je(tt){return Gi(tt)?(C=je,Jt(tt)):cs(tt)?(o.consume(tt),je):wt(tt)}function ze(tt){return tt===45||pu(tt)?(o.consume(tt),ze):tt===47||tt===62||Pc(tt)?Ve(tt):a(tt)}function Ve(tt){return tt===47?(o.consume(tt),wt):tt===58||tt===95||ef(tt)?(o.consume(tt),Ke):Gi(tt)?(C=Ve,Jt(tt)):cs(tt)?(o.consume(tt),Ve):wt(tt)}function Ke(tt){return tt===45||tt===46||tt===58||tt===95||pu(tt)?(o.consume(tt),Ke):qe(tt)}function qe(tt){return tt===61?(o.consume(tt),et):Gi(tt)?(C=qe,Jt(tt)):cs(tt)?(o.consume(tt),qe):Ve(tt)}function et(tt){return tt===null||tt===60||tt===61||tt===62||tt===96?a(tt):tt===34||tt===39?(o.consume(tt),y=tt,be):Gi(tt)?(C=et,Jt(tt)):cs(tt)?(o.consume(tt),et):(o.consume(tt),Zt)}function be(tt){return tt===y?(o.consume(tt),y=void 0,dn):tt===null?a(tt):Gi(tt)?(C=be,Jt(tt)):(o.consume(tt),be)}function Zt(tt){return tt===null||tt===34||tt===39||tt===60||tt===61||tt===96?a(tt):tt===47||tt===62||Pc(tt)?Ve(tt):(o.consume(tt),Zt)}function dn(tt){return tt===47||tt===62||Pc(tt)?Ve(tt):a(tt)}function wt(tt){return tt===62?(o.consume(tt),o.exit("htmlTextData"),o.exit("htmlText"),t):a(tt)}function Jt(tt){return o.exit("htmlTextData"),o.enter("lineEnding"),o.consume(tt),o.exit("lineEnding"),En}function En(tt){return cs(tt)?Ns(o,ci,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(tt):ci(tt)}function ci(tt){return o.enter("htmlTextData"),C(tt)}}const KS={name:"labelEnd",resolveAll:TG,resolveTo:EG,tokenize:SG},vG={tokenize:AG},bG={tokenize:IG},wG={tokenize:CG};function TG(o){let t=-1;const a=[];for(;++t<o.length;){const u=o[t][1];if(a.push(o[t]),u.type==="labelImage"||u.type==="labelLink"||u.type==="labelEnd"){const y=u.type==="labelImage"?4:2;u.type="data",t+=y}}return o.length!==a.length&&uf(o,0,o.length,a),o}function EG(o,t){let a=o.length,u=0,y,T,C,s;for(;a--;)if(y=o[a][1],T){if(y.type==="link"||y.type==="labelLink"&&y._inactive)break;o[a][0]==="enter"&&y.type==="labelLink"&&(y._inactive=!0)}else if(C){if(o[a][0]==="enter"&&(y.type==="labelImage"||y.type==="labelLink")&&!y._balanced&&(T=a,y.type!=="labelLink")){u=2;break}}else y.type==="labelEnd"&&(C=a);const B={type:o[T][1].type==="labelLink"?"link":"image",start:{...o[T][1].start},end:{...o[o.length-1][1].end}},V={type:"label",start:{...o[T][1].start},end:{...o[C][1].end}},W={type:"labelText",start:{...o[T+u+2][1].end},end:{...o[C-2][1].start}};return s=[["enter",B,t],["enter",V,t]],s=Yu(s,o.slice(T+1,T+u+3)),s=Yu(s,[["enter",W,t]]),s=Yu(s,YS(t.parser.constructs.insideSpan.null,o.slice(T+u+4,C-3),t)),s=Yu(s,[["exit",W,t],o[C-2],o[C-1],["exit",V,t]]),s=Yu(s,o.slice(C+1)),s=Yu(s,[["exit",B,t]]),uf(o,T,o.length,s),o}function SG(o,t,a){const u=this;let y=u.events.length,T,C;for(;y--;)if((u.events[y][1].type==="labelImage"||u.events[y][1].type==="labelLink")&&!u.events[y][1]._balanced){T=u.events[y][1];break}return s;function s(oe){return T?T._inactive?Q(oe):(C=u.parser.defined.includes(Cy(u.sliceSerialize({start:T.end,end:u.now()}))),o.enter("labelEnd"),o.enter("labelMarker"),o.consume(oe),o.exit("labelMarker"),o.exit("labelEnd"),B):a(oe)}function B(oe){return oe===40?o.attempt(vG,W,C?W:Q)(oe):oe===91?o.attempt(bG,W,C?V:Q)(oe):C?W(oe):Q(oe)}function V(oe){return o.attempt(wG,W,Q)(oe)}function W(oe){return t(oe)}function Q(oe){return T._balanced=!0,a(oe)}}function AG(o,t,a){return u;function u(Q){return o.enter("resource"),o.enter("resourceMarker"),o.consume(Q),o.exit("resourceMarker"),y}function y(Q){return Pc(Q)?Sv(o,T)(Q):T(Q)}function T(Q){return Q===41?W(Q):RL(o,C,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(Q)}function C(Q){return Pc(Q)?Sv(o,B)(Q):W(Q)}function s(Q){return a(Q)}function B(Q){return Q===34||Q===39||Q===40?DL(o,V,a,"resourceTitle","resourceTitleMarker","resourceTitleString")(Q):W(Q)}function V(Q){return Pc(Q)?Sv(o,W)(Q):W(Q)}function W(Q){return Q===41?(o.enter("resourceMarker"),o.consume(Q),o.exit("resourceMarker"),o.exit("resource"),t):a(Q)}}function IG(o,t,a){const u=this;return y;function y(s){return ML.call(u,o,T,C,"reference","referenceMarker","referenceString")(s)}function T(s){return u.parser.defined.includes(Cy(u.sliceSerialize(u.events[u.events.length-1][1]).slice(1,-1)))?t(s):a(s)}function C(s){return a(s)}}function CG(o,t,a){return u;function u(T){return o.enter("reference"),o.enter("referenceMarker"),o.consume(T),o.exit("referenceMarker"),y}function y(T){return T===93?(o.enter("referenceMarker"),o.consume(T),o.exit("referenceMarker"),o.exit("reference"),t):a(T)}}const RG={name:"labelStartImage",resolveAll:KS.resolveAll,tokenize:MG};function MG(o,t,a){const u=this;return y;function y(s){return o.enter("labelImage"),o.enter("labelImageMarker"),o.consume(s),o.exit("labelImageMarker"),T}function T(s){return s===91?(o.enter("labelMarker"),o.consume(s),o.exit("labelMarker"),o.exit("labelImage"),C):a(s)}function C(s){return s===94&&"_hiddenFootnoteSupport"in u.parser.constructs?a(s):t(s)}}const DG={name:"labelStartLink",resolveAll:KS.resolveAll,tokenize:PG};function PG(o,t,a){const u=this;return y;function y(C){return o.enter("labelLink"),o.enter("labelMarker"),o.consume(C),o.exit("labelMarker"),o.exit("labelLink"),T}function T(C){return C===94&&"_hiddenFootnoteSupport"in u.parser.constructs?a(C):t(C)}}const zT={name:"lineEnding",tokenize:kG};function kG(o,t){return a;function a(u){return o.enter("lineEnding"),o.consume(u),o.exit("lineEnding"),Ns(o,t,"linePrefix")}}const Vb={name:"thematicBreak",tokenize:LG};function LG(o,t,a){let u=0,y;return T;function T(V){return o.enter("thematicBreak"),C(V)}function C(V){return y=V,s(V)}function s(V){return V===y?(o.enter("thematicBreakSequence"),B(V)):u>=3&&(V===null||Gi(V))?(o.exit("thematicBreak"),t(V)):a(V)}function B(V){return V===y?(o.consume(V),u++,B):(o.exit("thematicBreakSequence"),cs(V)?Ns(o,s,"whitespace")(V):s(V))}}const Mc={continuation:{tokenize:BG},exit:VG,name:"list",tokenize:NG},zG={partial:!0,tokenize:jG},OG={partial:!0,tokenize:FG};function NG(o,t,a){const u=this,y=u.events[u.events.length-1];let T=y&&y[1].type==="linePrefix"?y[2].sliceSerialize(y[1],!0).length:0,C=0;return s;function s(he){const Je=u.containerState.type||(he===42||he===43||he===45?"listUnordered":"listOrdered");if(Je==="listUnordered"?!u.containerState.marker||he===u.containerState.marker:RE(he)){if(u.containerState.type||(u.containerState.type=Je,o.enter(Je,{_container:!0})),Je==="listUnordered")return o.enter("listItemPrefix"),he===42||he===45?o.check(Vb,a,V)(he):V(he);if(!u.interrupt||he===49)return o.enter("listItemPrefix"),o.enter("listItemValue"),B(he)}return a(he)}function B(he){return RE(he)&&++C<10?(o.consume(he),B):(!u.interrupt||C<2)&&(u.containerState.marker?he===u.containerState.marker:he===41||he===46)?(o.exit("listItemValue"),V(he)):a(he)}function V(he){return o.enter("listItemMarker"),o.consume(he),o.exit("listItemMarker"),u.containerState.marker=u.containerState.marker||he,o.check(F1,u.interrupt?a:W,o.attempt(zG,oe,Q))}function W(he){return u.containerState.initialBlankLine=!0,T++,oe(he)}function Q(he){return cs(he)?(o.enter("listItemPrefixWhitespace"),o.consume(he),o.exit("listItemPrefixWhitespace"),oe):a(he)}function oe(he){return u.containerState.size=T+u.sliceSerialize(o.exit("listItemPrefix"),!0).length,t(he)}}function BG(o,t,a){const u=this;return u.containerState._closeFlow=void 0,o.check(F1,y,T);function y(s){return u.containerState.furtherBlankLines=u.containerState.furtherBlankLines||u.containerState.initialBlankLine,Ns(o,t,"listItemIndent",u.containerState.size+1)(s)}function T(s){return u.containerState.furtherBlankLines||!cs(s)?(u.containerState.furtherBlankLines=void 0,u.containerState.initialBlankLine=void 0,C(s)):(u.containerState.furtherBlankLines=void 0,u.containerState.initialBlankLine=void 0,o.attempt(OG,t,C)(s))}function C(s){return u.containerState._closeFlow=!0,u.interrupt=void 0,Ns(o,o.attempt(Mc,t,a),"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function FG(o,t,a){const u=this;return Ns(o,y,"listItemIndent",u.containerState.size+1);function y(T){const C=u.events[u.events.length-1];return C&&C[1].type==="listItemIndent"&&C[2].sliceSerialize(C[1],!0).length===u.containerState.size?t(T):a(T)}}function VG(o){o.exit(this.containerState.type)}function jG(o,t,a){const u=this;return Ns(o,y,"listItemPrefixWhitespace",u.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function y(T){const C=u.events[u.events.length-1];return!cs(T)&&C&&C[1].type==="listItemPrefixWhitespace"?t(T):a(T)}}const AM={name:"setextUnderline",resolveTo:UG,tokenize:GG};function UG(o,t){let a=o.length,u,y,T;for(;a--;)if(o[a][0]==="enter"){if(o[a][1].type==="content"){u=a;break}o[a][1].type==="paragraph"&&(y=a)}else o[a][1].type==="content"&&o.splice(a,1),!T&&o[a][1].type==="definition"&&(T=a);const C={type:"setextHeading",start:{...o[u][1].start},end:{...o[o.length-1][1].end}};return o[y][1].type="setextHeadingText",T?(o.splice(y,0,["enter",C,t]),o.splice(T+1,0,["exit",o[u][1],t]),o[u][1].end={...o[T][1].end}):o[u][1]=C,o.push(["exit",C,t]),o}function GG(o,t,a){const u=this;let y;return T;function T(V){let W=u.events.length,Q;for(;W--;)if(u.events[W][1].type!=="lineEnding"&&u.events[W][1].type!=="linePrefix"&&u.events[W][1].type!=="content"){Q=u.events[W][1].type==="paragraph";break}return!u.parser.lazy[u.now().line]&&(u.interrupt||Q)?(o.enter("setextHeadingLine"),y=V,C(V)):a(V)}function C(V){return o.enter("setextHeadingLineSequence"),s(V)}function s(V){return V===y?(o.consume(V),s):(o.exit("setextHeadingLineSequence"),cs(V)?Ns(o,B,"lineSuffix")(V):B(V))}function B(V){return V===null||Gi(V)?(o.exit("setextHeadingLine"),t(V)):a(V)}}const qG={tokenize:HG};function HG(o){const t=this,a=o.attempt(F1,u,o.attempt(this.parser.constructs.flowInitial,y,Ns(o,o.attempt(this.parser.constructs.flow,y,o.attempt(Y9,y)),"linePrefix")));return a;function u(T){if(T===null){o.consume(T);return}return o.enter("lineEndingBlank"),o.consume(T),o.exit("lineEndingBlank"),t.currentConstruct=void 0,a}function y(T){if(T===null){o.consume(T);return}return o.enter("lineEnding"),o.consume(T),o.exit("lineEnding"),t.currentConstruct=void 0,a}}const $G={resolveAll:kL()},ZG=PL("string"),WG=PL("text");function PL(o){return{resolveAll:kL(o==="text"?XG:void 0),tokenize:t};function t(a){const u=this,y=this.parser.constructs[o],T=a.attempt(y,C,s);return C;function C(W){return V(W)?T(W):s(W)}function s(W){if(W===null){a.consume(W);return}return a.enter("data"),a.consume(W),B}function B(W){return V(W)?(a.exit("data"),T(W)):(a.consume(W),B)}function V(W){if(W===null)return!0;const Q=y[W];let oe=-1;if(Q)for(;++oe<Q.length;){const he=Q[oe];if(!he.previous||he.previous.call(u,u.previous))return!0}return!1}}}function kL(o){return t;function t(a,u){let y=-1,T;for(;++y<=a.length;)T===void 0?a[y]&&a[y][1].type==="data"&&(T=y,y++):(!a[y]||a[y][1].type!=="data")&&(y!==T+2&&(a[T][1].end=a[y-1][1].end,a.splice(T+2,y-T-2),y=T+2),T=void 0);return o?o(a,u):a}}function XG(o,t){let a=0;for(;++a<=o.length;)if((a===o.length||o[a][1].type==="lineEnding")&&o[a-1][1].type==="data"){const u=o[a-1][1],y=t.sliceStream(u);let T=y.length,C=-1,s=0,B;for(;T--;){const V=y[T];if(typeof V=="string"){for(C=V.length;V.charCodeAt(C-1)===32;)s++,C--;if(C)break;C=-1}else if(V===-2)B=!0,s++;else if(V!==-1){T++;break}}if(t._contentTypeTextTrailing&&a===o.length&&(s=0),s){const V={type:a===o.length||B||s<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:T?C:u.start._bufferIndex+C,_index:u.start._index+T,line:u.end.line,column:u.end.column-s,offset:u.end.offset-s},end:{...u.end}};u.end={...V.start},u.start.offset===u.end.offset?Object.assign(u,V):(o.splice(a,0,["enter",V,t],["exit",V,t]),a+=2)}a++}return o}const YG={42:Mc,43:Mc,45:Mc,48:Mc,49:Mc,50:Mc,51:Mc,52:Mc,53:Mc,54:Mc,55:Mc,56:Mc,57:Mc,62:SL},KG={91:tG},QG={[-2]:LT,[-1]:LT,32:LT},JG={35:oG,42:Vb,45:[AM,Vb],60:hG,61:AM,95:Vb,96:EM,126:EM},eq={38:IL,92:AL},tq={[-5]:zT,[-4]:zT,[-3]:zT,33:RG,38:IL,42:ME,60:[D9,yG],91:DG,92:[sG,AL],93:KS,95:ME,96:q9},nq={null:[ME,$G]},iq={null:[42,95]},rq={null:[]},sq=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:iq,contentInitial:KG,disable:rq,document:YG,flow:JG,flowInitial:QG,insideSpan:nq,string:eq,text:tq},Symbol.toStringTag,{value:"Module"}));function aq(o,t,a){let u={_bufferIndex:-1,_index:0,line:a&&a.line||1,column:a&&a.column||1,offset:a&&a.offset||0};const y={},T=[];let C=[],s=[];const B={attempt:je(fn),check:je(St),consume:ft,enter:ht,exit:Ft,interrupt:je(St,{interrupt:!0})},V={code:null,containerState:{},defineSkip:Ye,events:[],now:Je,parser:o,previous:null,sliceSerialize:oe,sliceStream:he,write:Q};let W=t.tokenize.call(V,B);return t.resolveAll&&T.push(t),V;function Q(qe){return C=Yu(C,qe),Xe(),C[C.length-1]!==null?[]:(ze(t,0),V.events=YS(T,V.events,V),V.events)}function oe(qe,et){return lq(he(qe),et)}function he(qe){return oq(C,qe)}function Je(){const{_bufferIndex:qe,_index:et,line:be,column:Zt,offset:dn}=u;return{_bufferIndex:qe,_index:et,line:be,column:Zt,offset:dn}}function Ye(qe){y[qe.line]=qe.column,Ke()}function Xe(){let qe;for(;u._index<C.length;){const et=C[u._index];if(typeof et=="string")for(qe=u._index,u._bufferIndex<0&&(u._bufferIndex=0);u._index===qe&&u._bufferIndex<et.length;)st(et.charCodeAt(u._bufferIndex));else st(et)}}function st(qe){W=W(qe)}function ft(qe){Gi(qe)?(u.line++,u.column=1,u.offset+=qe===-3?2:1,Ke()):qe!==-1&&(u.column++,u.offset++),u._bufferIndex<0?u._index++:(u._bufferIndex++,u._bufferIndex===C[u._index].length&&(u._bufferIndex=-1,u._index++)),V.previous=qe}function ht(qe,et){const be=et||{};return be.type=qe,be.start=Je(),V.events.push(["enter",be,V]),s.push(be),be}function Ft(qe){const et=s.pop();return et.end=Je(),V.events.push(["exit",et,V]),et}function fn(qe,et){ze(qe,et.from)}function St(qe,et){et.restore()}function je(qe,et){return be;function be(Zt,dn,wt){let Jt,En,ci,tt;return Array.isArray(Zt)?Kt(Zt):"tokenize"in Zt?Kt([Zt]):dt(Zt);function dt(Zn){return Ci;function Ci(Xi){const Gn=Xi!==null&&Zn[Xi],zi=Xi!==null&&Zn.null,jr=[...Array.isArray(Gn)?Gn:Gn?[Gn]:[],...Array.isArray(zi)?zi:zi?[zi]:[]];return Kt(jr)(Xi)}}function Kt(Zn){return Jt=Zn,En=0,Zn.length===0?wt:Ne(Zn[En])}function Ne(Zn){return Ci;function Ci(Xi){return tt=Ve(),ci=Zn,Zn.partial||(V.currentConstruct=Zn),Zn.name&&V.parser.constructs.disable.null.includes(Zn.name)?Kn():Zn.tokenize.call(et?Object.assign(Object.create(V),et):V,B,wn,Kn)(Xi)}}function wn(Zn){return qe(ci,tt),dn}function Kn(Zn){return tt.restore(),++En<Jt.length?Ne(Jt[En]):wt}}}function ze(qe,et){qe.resolveAll&&!T.includes(qe)&&T.push(qe),qe.resolve&&uf(V.events,et,V.events.length-et,qe.resolve(V.events.slice(et),V)),qe.resolveTo&&(V.events=qe.resolveTo(V.events,V))}function Ve(){const qe=Je(),et=V.previous,be=V.currentConstruct,Zt=V.events.length,dn=Array.from(s);return{from:Zt,restore:wt};function wt(){u=qe,V.previous=et,V.currentConstruct=be,V.events.length=Zt,s=dn,Ke()}}function Ke(){u.line in y&&u.column<2&&(u.column=y[u.line],u.offset+=y[u.line]-1)}}function oq(o,t){const a=t.start._index,u=t.start._bufferIndex,y=t.end._index,T=t.end._bufferIndex;let C;if(a===y)C=[o[a].slice(u,T)];else{if(C=o.slice(a,y),u>-1){const s=C[0];typeof s=="string"?C[0]=s.slice(u):C.shift()}T>0&&C.push(o[y].slice(0,T))}return C}function lq(o,t){let a=-1;const u=[];let y;for(;++a<o.length;){const T=o[a];let C;if(typeof T=="string")C=T;else switch(T){case-5:{C="\r";break}case-4:{C=`
`;break}case-3:{C=`\r
`;break}case-2:{C=t?" ":"	";break}case-1:{if(!t&&y)continue;C=" ";break}default:C=String.fromCharCode(T)}y=T===-2,u.push(C)}return u.join("")}function cq(o){const u={constructs:g9([sq,...(o||{}).extensions||[]]),content:y(E9),defined:[],document:y(A9),flow:y(qG),lazy:{},string:y(ZG),text:y(WG)};return u;function y(T){return C;function C(s){return aq(u,T,s)}}}function uq(o){for(;!CL(o););return o}const IM=/[\0\t\n\r]/g;function hq(){let o=1,t="",a=!0,u;return y;function y(T,C,s){const B=[];let V,W,Q,oe,he;for(T=t+(typeof T=="string"?T.toString():new TextDecoder(C||void 0).decode(T)),Q=0,t="",a&&(T.charCodeAt(0)===65279&&Q++,a=void 0);Q<T.length;){if(IM.lastIndex=Q,V=IM.exec(T),oe=V&&V.index!==void 0?V.index:T.length,he=T.charCodeAt(oe),!V){t=T.slice(Q);break}if(he===10&&Q===oe&&u)B.push(-3),u=void 0;else switch(u&&(B.push(-5),u=void 0),Q<oe&&(B.push(T.slice(Q,oe)),o+=oe-Q),he){case 0:{B.push(65533),o++;break}case 9:{for(W=Math.ceil(o/4)*4,B.push(-2);o++<W;)B.push(-1);break}case 10:{B.push(-4),o=1;break}default:u=!0,o=1}Q=oe+1}return s&&(u&&B.push(-5),t&&B.push(t),B.push(null)),B}}const dq=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function fq(o){return o.replace(dq,pq)}function pq(o,t,a){if(t)return t;if(a.charCodeAt(0)===35){const y=a.charCodeAt(1),T=y===120||y===88;return EL(a.slice(T?2:1),T?16:10)}return XS(a)||o}const LL={}.hasOwnProperty;function mq(o,t,a){return typeof t!="string"&&(a=t,t=void 0),gq(a)(uq(cq(a).document().write(hq()(o,t,!0))))}function gq(o){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:T(Qi),autolinkProtocol:Ve,autolinkEmail:Ve,atxHeading:T(Hn),blockQuote:T(zi),characterEscape:Ve,characterReference:Ve,codeFenced:T(jr),codeFencedFenceInfo:C,codeFencedFenceMeta:C,codeIndented:T(jr,C),codeText:T(Va,C),codeTextData:Ve,data:Ve,codeFlowValue:Ve,definition:T(cr),definitionDestinationString:C,definitionLabelString:C,definitionTitleString:C,emphasis:T(Bs),hardBreakEscape:T(Ti),hardBreakTrailing:T(Ti),htmlFlow:T(ur,C),htmlFlowData:Ve,htmlText:T(ur,C),htmlTextData:Ve,image:T(ui),label:C,link:T(Qi),listItem:T(Xs),listItemValue:oe,listOrdered:T(_r,Q),listUnordered:T(_r),paragraph:T(Rl),reference:Ne,referenceString:C,resourceDestinationString:C,resourceTitleString:C,setextHeading:T(Hn),strong:T(rc),thematicBreak:T(vs)},exit:{atxHeading:B(),atxHeadingSequence:fn,autolink:B(),autolinkEmail:Gn,autolinkProtocol:Xi,blockQuote:B(),characterEscapeValue:Ke,characterReferenceMarkerHexadecimal:Kn,characterReferenceMarkerNumeric:Kn,characterReferenceValue:Zn,characterReference:Ci,codeFenced:B(Xe),codeFencedFence:Ye,codeFencedFenceInfo:he,codeFencedFenceMeta:Je,codeFlowValue:Ke,codeIndented:B(st),codeText:B(dn),codeTextData:Ke,data:Ke,definition:B(),definitionDestinationString:Ft,definitionLabelString:ft,definitionTitleString:ht,emphasis:B(),hardBreakEscape:B(et),hardBreakTrailing:B(et),htmlFlow:B(be),htmlFlowData:Ke,htmlText:B(Zt),htmlTextData:Ke,image:B(Jt),label:ci,labelText:En,lineEnding:qe,link:B(wt),listItem:B(),listOrdered:B(),listUnordered:B(),paragraph:B(),referenceString:wn,resourceDestinationString:tt,resourceTitleString:dt,resource:Kt,setextHeading:B(ze),setextHeadingLineSequence:je,setextHeadingText:St,strong:B(),thematicBreak:B()}};zL(t,(o||{}).mdastExtensions||[]);const a={};return u;function u(en){let Tn={type:"root",children:[]};const ri={stack:[Tn],tokenStack:[],config:t,enter:s,exit:V,buffer:C,resume:W,data:a},Oi=[];let Ri=-1;for(;++Ri<en.length;)if(en[Ri][1].type==="listOrdered"||en[Ri][1].type==="listUnordered")if(en[Ri][0]==="enter")Oi.push(Ri);else{const Fs=Oi.pop();Ri=y(en,Fs,Ri)}for(Ri=-1;++Ri<en.length;){const Fs=t[en[Ri][0]];LL.call(Fs,en[Ri][1].type)&&Fs[en[Ri][1].type].call(Object.assign({sliceSerialize:en[Ri][2].sliceSerialize},ri),en[Ri][1])}if(ri.tokenStack.length>0){const Fs=ri.tokenStack[ri.tokenStack.length-1];(Fs[1]||CM).call(ri,void 0,Fs[0])}for(Tn.position={start:Am(en.length>0?en[0][1].start:{line:1,column:1,offset:0}),end:Am(en.length>0?en[en.length-2][1].end:{line:1,column:1,offset:0})},Ri=-1;++Ri<t.transforms.length;)Tn=t.transforms[Ri](Tn)||Tn;return Tn}function y(en,Tn,ri){let Oi=Tn-1,Ri=-1,Fs=!1,gs,ps,kr,yr;for(;++Oi<=ri;){const Vi=en[Oi];switch(Vi[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Vi[0]==="enter"?Ri++:Ri--,yr=void 0;break}case"lineEndingBlank":{Vi[0]==="enter"&&(gs&&!yr&&!Ri&&!kr&&(kr=Oi),yr=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:yr=void 0}if(!Ri&&Vi[0]==="enter"&&Vi[1].type==="listItemPrefix"||Ri===-1&&Vi[0]==="exit"&&(Vi[1].type==="listUnordered"||Vi[1].type==="listOrdered")){if(gs){let ra=Oi;for(ps=void 0;ra--;){const bs=en[ra];if(bs[1].type==="lineEnding"||bs[1].type==="lineEndingBlank"){if(bs[0]==="exit")continue;ps&&(en[ps][1].type="lineEndingBlank",Fs=!0),bs[1].type="lineEnding",ps=ra}else if(!(bs[1].type==="linePrefix"||bs[1].type==="blockQuotePrefix"||bs[1].type==="blockQuotePrefixWhitespace"||bs[1].type==="blockQuoteMarker"||bs[1].type==="listItemIndent"))break}kr&&(!ps||kr<ps)&&(gs._spread=!0),gs.end=Object.assign({},ps?en[ps][1].start:Vi[1].end),en.splice(ps||Oi,0,["exit",gs,Vi[2]]),Oi++,ri++}if(Vi[1].type==="listItemPrefix"){const ra={type:"listItem",_spread:!1,start:Object.assign({},Vi[1].start),end:void 0};gs=ra,en.splice(Oi,0,["enter",ra,Vi[2]]),Oi++,ri++,kr=void 0,yr=!0}}}return en[Tn][1]._spread=Fs,ri}function T(en,Tn){return ri;function ri(Oi){s.call(this,en(Oi),Oi),Tn&&Tn.call(this,Oi)}}function C(){this.stack.push({type:"fragment",children:[]})}function s(en,Tn,ri){this.stack[this.stack.length-1].children.push(en),this.stack.push(en),this.tokenStack.push([Tn,ri||void 0]),en.position={start:Am(Tn.start),end:void 0}}function B(en){return Tn;function Tn(ri){en&&en.call(this,ri),V.call(this,ri)}}function V(en,Tn){const ri=this.stack.pop(),Oi=this.tokenStack.pop();if(Oi)Oi[0].type!==en.type&&(Tn?Tn.call(this,en,Oi[0]):(Oi[1]||CM).call(this,en,Oi[0]));else throw new Error("Cannot close `"+en.type+"` ("+Ev({start:en.start,end:en.end})+"): its not open");ri.position.end=Am(en.end)}function W(){return p9(this.stack.pop())}function Q(){this.data.expectingFirstListItemValue=!0}function oe(en){if(this.data.expectingFirstListItemValue){const Tn=this.stack[this.stack.length-2];Tn.start=Number.parseInt(this.sliceSerialize(en),10),this.data.expectingFirstListItemValue=void 0}}function he(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.lang=en}function Je(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.meta=en}function Ye(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function Xe(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function st(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en.replace(/(\r?\n|\r)$/g,"")}function ft(en){const Tn=this.resume(),ri=this.stack[this.stack.length-1];ri.label=Tn,ri.identifier=Cy(this.sliceSerialize(en)).toLowerCase()}function ht(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.title=en}function Ft(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.url=en}function fn(en){const Tn=this.stack[this.stack.length-1];if(!Tn.depth){const ri=this.sliceSerialize(en).length;Tn.depth=ri}}function St(){this.data.setextHeadingSlurpLineEnding=!0}function je(en){const Tn=this.stack[this.stack.length-1];Tn.depth=this.sliceSerialize(en).codePointAt(0)===61?1:2}function ze(){this.data.setextHeadingSlurpLineEnding=void 0}function Ve(en){const ri=this.stack[this.stack.length-1].children;let Oi=ri[ri.length-1];(!Oi||Oi.type!=="text")&&(Oi=Ur(),Oi.position={start:Am(en.start),end:void 0},ri.push(Oi)),this.stack.push(Oi)}function Ke(en){const Tn=this.stack.pop();Tn.value+=this.sliceSerialize(en),Tn.position.end=Am(en.end)}function qe(en){const Tn=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ri=Tn.children[Tn.children.length-1];ri.position.end=Am(en.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Tn.type)&&(Ve.call(this,en),Ke.call(this,en))}function et(){this.data.atHardBreak=!0}function be(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function Zt(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function dn(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function wt(){const en=this.stack[this.stack.length-1];if(this.data.inReference){const Tn=this.data.referenceType||"shortcut";en.type+="Reference",en.referenceType=Tn,delete en.url,delete en.title}else delete en.identifier,delete en.label;this.data.referenceType=void 0}function Jt(){const en=this.stack[this.stack.length-1];if(this.data.inReference){const Tn=this.data.referenceType||"shortcut";en.type+="Reference",en.referenceType=Tn,delete en.url,delete en.title}else delete en.identifier,delete en.label;this.data.referenceType=void 0}function En(en){const Tn=this.sliceSerialize(en),ri=this.stack[this.stack.length-2];ri.label=fq(Tn),ri.identifier=Cy(Tn).toLowerCase()}function ci(){const en=this.stack[this.stack.length-1],Tn=this.resume(),ri=this.stack[this.stack.length-1];if(this.data.inReference=!0,ri.type==="link"){const Oi=en.children;ri.children=Oi}else ri.alt=Tn}function tt(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.url=en}function dt(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.title=en}function Kt(){this.data.inReference=void 0}function Ne(){this.data.referenceType="collapsed"}function wn(en){const Tn=this.resume(),ri=this.stack[this.stack.length-1];ri.label=Tn,ri.identifier=Cy(this.sliceSerialize(en)).toLowerCase(),this.data.referenceType="full"}function Kn(en){this.data.characterReferenceType=en.type}function Zn(en){const Tn=this.sliceSerialize(en),ri=this.data.characterReferenceType;let Oi;ri?(Oi=EL(Tn,ri==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Oi=XS(Tn);const Ri=this.stack[this.stack.length-1];Ri.value+=Oi}function Ci(en){const Tn=this.stack.pop();Tn.position.end=Am(en.end)}function Xi(en){Ke.call(this,en);const Tn=this.stack[this.stack.length-1];Tn.url=this.sliceSerialize(en)}function Gn(en){Ke.call(this,en);const Tn=this.stack[this.stack.length-1];Tn.url="mailto:"+this.sliceSerialize(en)}function zi(){return{type:"blockquote",children:[]}}function jr(){return{type:"code",lang:null,meta:null,value:""}}function Va(){return{type:"inlineCode",value:""}}function cr(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Bs(){return{type:"emphasis",children:[]}}function Hn(){return{type:"heading",depth:0,children:[]}}function Ti(){return{type:"break"}}function ur(){return{type:"html",value:""}}function ui(){return{type:"image",title:null,url:"",alt:null}}function Qi(){return{type:"link",title:null,url:"",children:[]}}function _r(en){return{type:"list",ordered:en.type==="listOrdered",start:null,spread:en._spread,children:[]}}function Xs(en){return{type:"listItem",spread:en._spread,checked:null,children:[]}}function Rl(){return{type:"paragraph",children:[]}}function rc(){return{type:"strong",children:[]}}function Ur(){return{type:"text",value:""}}function vs(){return{type:"thematicBreak"}}}function Am(o){return{line:o.line,column:o.column,offset:o.offset}}function zL(o,t){let a=-1;for(;++a<t.length;){const u=t[a];Array.isArray(u)?zL(o,u):_q(o,u)}}function _q(o,t){let a;for(a in t)if(LL.call(t,a))switch(a){case"canContainEols":{const u=t[a];u&&o[a].push(...u);break}case"transforms":{const u=t[a];u&&o[a].push(...u);break}case"enter":case"exit":{const u=t[a];u&&Object.assign(o[a],u);break}}}function CM(o,t){throw o?new Error("Cannot close `"+o.type+"` ("+Ev({start:o.start,end:o.end})+"): a different token (`"+t.type+"`, "+Ev({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Ev({start:t.start,end:t.end})+") is still open")}function yq(o){const t=this;t.parser=a;function a(u){return mq(u,{...t.data("settings"),...o,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function xq(o,t){const a={type:"element",tagName:"blockquote",properties:{},children:o.wrap(o.all(t),!0)};return o.patch(t,a),o.applyData(t,a)}function vq(o,t){const a={type:"element",tagName:"br",properties:{},children:[]};return o.patch(t,a),[o.applyData(t,a),{type:"text",value:`
`}]}function bq(o,t){const a=t.value?t.value+`
`:"",u={},y=t.lang?t.lang.split(/\s+/):[];y.length>0&&(u.className=["language-"+y[0]]);let T={type:"element",tagName:"code",properties:u,children:[{type:"text",value:a}]};return t.meta&&(T.data={meta:t.meta}),o.patch(t,T),T=o.applyData(t,T),T={type:"element",tagName:"pre",properties:{},children:[T]},o.patch(t,T),T}function wq(o,t){const a={type:"element",tagName:"del",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Tq(o,t){const a={type:"element",tagName:"em",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Eq(o,t){const a=typeof o.options.clobberPrefix=="string"?o.options.clobberPrefix:"user-content-",u=String(t.identifier).toUpperCase(),y=Ky(u.toLowerCase()),T=o.footnoteOrder.indexOf(u);let C,s=o.footnoteCounts.get(u);s===void 0?(s=0,o.footnoteOrder.push(u),C=o.footnoteOrder.length):C=T+1,s+=1,o.footnoteCounts.set(u,s);const B={type:"element",tagName:"a",properties:{href:"#"+a+"fn-"+y,id:a+"fnref-"+y+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(C)}]};o.patch(t,B);const V={type:"element",tagName:"sup",properties:{},children:[B]};return o.patch(t,V),o.applyData(t,V)}function Sq(o,t){const a={type:"element",tagName:"h"+t.depth,properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Aq(o,t){if(o.options.allowDangerousHtml){const a={type:"raw",value:t.value};return o.patch(t,a),o.applyData(t,a)}}function OL(o,t){const a=t.referenceType;let u="]";if(a==="collapsed"?u+="[]":a==="full"&&(u+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+u}];const y=o.all(t),T=y[0];T&&T.type==="text"?T.value="["+T.value:y.unshift({type:"text",value:"["});const C=y[y.length-1];return C&&C.type==="text"?C.value+=u:y.push({type:"text",value:u}),y}function Iq(o,t){const a=String(t.identifier).toUpperCase(),u=o.definitionById.get(a);if(!u)return OL(o,t);const y={src:Ky(u.url||""),alt:t.alt};u.title!==null&&u.title!==void 0&&(y.title=u.title);const T={type:"element",tagName:"img",properties:y,children:[]};return o.patch(t,T),o.applyData(t,T)}function Cq(o,t){const a={src:Ky(t.url)};t.alt!==null&&t.alt!==void 0&&(a.alt=t.alt),t.title!==null&&t.title!==void 0&&(a.title=t.title);const u={type:"element",tagName:"img",properties:a,children:[]};return o.patch(t,u),o.applyData(t,u)}function Rq(o,t){const a={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};o.patch(t,a);const u={type:"element",tagName:"code",properties:{},children:[a]};return o.patch(t,u),o.applyData(t,u)}function Mq(o,t){const a=String(t.identifier).toUpperCase(),u=o.definitionById.get(a);if(!u)return OL(o,t);const y={href:Ky(u.url||"")};u.title!==null&&u.title!==void 0&&(y.title=u.title);const T={type:"element",tagName:"a",properties:y,children:o.all(t)};return o.patch(t,T),o.applyData(t,T)}function Dq(o,t){const a={href:Ky(t.url)};t.title!==null&&t.title!==void 0&&(a.title=t.title);const u={type:"element",tagName:"a",properties:a,children:o.all(t)};return o.patch(t,u),o.applyData(t,u)}function Pq(o,t,a){const u=o.all(t),y=a?kq(a):NL(t),T={},C=[];if(typeof t.checked=="boolean"){const W=u[0];let Q;W&&W.type==="element"&&W.tagName==="p"?Q=W:(Q={type:"element",tagName:"p",properties:{},children:[]},u.unshift(Q)),Q.children.length>0&&Q.children.unshift({type:"text",value:" "}),Q.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),T.className=["task-list-item"]}let s=-1;for(;++s<u.length;){const W=u[s];(y||s!==0||W.type!=="element"||W.tagName!=="p")&&C.push({type:"text",value:`
`}),W.type==="element"&&W.tagName==="p"&&!y?C.push(...W.children):C.push(W)}const B=u[u.length-1];B&&(y||B.type!=="element"||B.tagName!=="p")&&C.push({type:"text",value:`
`});const V={type:"element",tagName:"li",properties:T,children:C};return o.patch(t,V),o.applyData(t,V)}function kq(o){let t=!1;if(o.type==="list"){t=o.spread||!1;const a=o.children;let u=-1;for(;!t&&++u<a.length;)t=NL(a[u])}return t}function NL(o){const t=o.spread;return t??o.children.length>1}function Lq(o,t){const a={},u=o.all(t);let y=-1;for(typeof t.start=="number"&&t.start!==1&&(a.start=t.start);++y<u.length;){const C=u[y];if(C.type==="element"&&C.tagName==="li"&&C.properties&&Array.isArray(C.properties.className)&&C.properties.className.includes("task-list-item")){a.className=["contains-task-list"];break}}const T={type:"element",tagName:t.ordered?"ol":"ul",properties:a,children:o.wrap(u,!0)};return o.patch(t,T),o.applyData(t,T)}function zq(o,t){const a={type:"element",tagName:"p",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Oq(o,t){const a={type:"root",children:o.wrap(o.all(t))};return o.patch(t,a),o.applyData(t,a)}function Nq(o,t){const a={type:"element",tagName:"strong",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Bq(o,t){const a=o.all(t),u=a.shift(),y=[];if(u){const C={type:"element",tagName:"thead",properties:{},children:o.wrap([u],!0)};o.patch(t.children[0],C),y.push(C)}if(a.length>0){const C={type:"element",tagName:"tbody",properties:{},children:o.wrap(a,!0)},s=HS(t.children[1]),B=_L(t.children[t.children.length-1]);s&&B&&(C.position={start:s,end:B}),y.push(C)}const T={type:"element",tagName:"table",properties:{},children:o.wrap(y,!0)};return o.patch(t,T),o.applyData(t,T)}function Fq(o,t,a){const u=a?a.children:void 0,T=(u?u.indexOf(t):1)===0?"th":"td",C=a&&a.type==="table"?a.align:void 0,s=C?C.length:t.children.length;let B=-1;const V=[];for(;++B<s;){const Q=t.children[B],oe={},he=C?C[B]:void 0;he&&(oe.align=he);let Je={type:"element",tagName:T,properties:oe,children:[]};Q&&(Je.children=o.all(Q),o.patch(Q,Je),Je=o.applyData(Q,Je)),V.push(Je)}const W={type:"element",tagName:"tr",properties:{},children:o.wrap(V,!0)};return o.patch(t,W),o.applyData(t,W)}function Vq(o,t){const a={type:"element",tagName:"td",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}const RM=9,MM=32;function jq(o){const t=String(o),a=/\r?\n|\r/g;let u=a.exec(t),y=0;const T=[];for(;u;)T.push(DM(t.slice(y,u.index),y>0,!0),u[0]),y=u.index+u[0].length,u=a.exec(t);return T.push(DM(t.slice(y),y>0,!1)),T.join("")}function DM(o,t,a){let u=0,y=o.length;if(t){let T=o.codePointAt(u);for(;T===RM||T===MM;)u++,T=o.codePointAt(u)}if(a){let T=o.codePointAt(y-1);for(;T===RM||T===MM;)y--,T=o.codePointAt(y-1)}return y>u?o.slice(u,y):""}function Uq(o,t){const a={type:"text",value:jq(String(t.value))};return o.patch(t,a),o.applyData(t,a)}function Gq(o,t){const a={type:"element",tagName:"hr",properties:{},children:[]};return o.patch(t,a),o.applyData(t,a)}const qq={blockquote:xq,break:vq,code:bq,delete:wq,emphasis:Tq,footnoteReference:Eq,heading:Sq,html:Aq,imageReference:Iq,image:Cq,inlineCode:Rq,linkReference:Mq,link:Dq,listItem:Pq,list:Lq,paragraph:zq,root:Oq,strong:Nq,table:Bq,tableCell:Vq,tableRow:Fq,text:Uq,thematicBreak:Gq,toml:Tb,yaml:Tb,definition:Tb,footnoteDefinition:Tb};function Tb(){}const BL=-1,V1=0,Av=1,f1=2,QS=3,JS=4,eA=5,tA=6,FL=7,VL=8,PM=typeof self=="object"?self:globalThis,Hq=(o,t)=>{const a=(y,T)=>(o.set(T,y),y),u=y=>{if(o.has(y))return o.get(y);const[T,C]=t[y];switch(T){case V1:case BL:return a(C,y);case Av:{const s=a([],y);for(const B of C)s.push(u(B));return s}case f1:{const s=a({},y);for(const[B,V]of C)s[u(B)]=u(V);return s}case QS:return a(new Date(C),y);case JS:{const{source:s,flags:B}=C;return a(new RegExp(s,B),y)}case eA:{const s=a(new Map,y);for(const[B,V]of C)s.set(u(B),u(V));return s}case tA:{const s=a(new Set,y);for(const B of C)s.add(u(B));return s}case FL:{const{name:s,message:B}=C;return a(new PM[s](B),y)}case VL:return a(BigInt(C),y);case"BigInt":return a(Object(BigInt(C)),y);case"ArrayBuffer":return a(new Uint8Array(C).buffer,C);case"DataView":{const{buffer:s}=new Uint8Array(C);return a(new DataView(s),C)}}return a(new PM[T](C),y)};return u},kM=o=>Hq(new Map,o)(0),gy="",{toString:$q}={},{keys:Zq}=Object,hv=o=>{const t=typeof o;if(t!=="object"||!o)return[V1,t];const a=$q.call(o).slice(8,-1);switch(a){case"Array":return[Av,gy];case"Object":return[f1,gy];case"Date":return[QS,gy];case"RegExp":return[JS,gy];case"Map":return[eA,gy];case"Set":return[tA,gy];case"DataView":return[Av,a]}return a.includes("Array")?[Av,a]:a.includes("Error")?[FL,a]:[f1,a]},Eb=([o,t])=>o===V1&&(t==="function"||t==="symbol"),Wq=(o,t,a,u)=>{const y=(C,s)=>{const B=u.push(C)-1;return a.set(s,B),B},T=C=>{if(a.has(C))return a.get(C);let[s,B]=hv(C);switch(s){case V1:{let W=C;switch(B){case"bigint":s=VL,W=C.toString();break;case"function":case"symbol":if(o)throw new TypeError("unable to serialize "+B);W=null;break;case"undefined":return y([BL],C)}return y([s,W],C)}case Av:{if(B){let oe=C;return B==="DataView"?oe=new Uint8Array(C.buffer):B==="ArrayBuffer"&&(oe=new Uint8Array(C)),y([B,[...oe]],C)}const W=[],Q=y([s,W],C);for(const oe of C)W.push(T(oe));return Q}case f1:{if(B)switch(B){case"BigInt":return y([B,C.toString()],C);case"Boolean":case"Number":case"String":return y([B,C.valueOf()],C)}if(t&&"toJSON"in C)return T(C.toJSON());const W=[],Q=y([s,W],C);for(const oe of Zq(C))(o||!Eb(hv(C[oe])))&&W.push([T(oe),T(C[oe])]);return Q}case QS:return y([s,C.toISOString()],C);case JS:{const{source:W,flags:Q}=C;return y([s,{source:W,flags:Q}],C)}case eA:{const W=[],Q=y([s,W],C);for(const[oe,he]of C)(o||!(Eb(hv(oe))||Eb(hv(he))))&&W.push([T(oe),T(he)]);return Q}case tA:{const W=[],Q=y([s,W],C);for(const oe of C)(o||!Eb(hv(oe)))&&W.push(T(oe));return Q}}const{message:V}=C;return y([s,{name:B,message:V}],C)};return T},LM=(o,{json:t,lossy:a}={})=>{const u=[];return Wq(!(t||a),!!t,new Map,u)(o),u},p1=typeof structuredClone=="function"?(o,t)=>t&&("json"in t||"lossy"in t)?kM(LM(o,t)):structuredClone(o):(o,t)=>kM(LM(o,t));function Xq(o,t){const a=[{type:"text",value:""}];return t>1&&a.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),a}function Yq(o,t){return"Back to reference "+(o+1)+(t>1?"-"+t:"")}function Kq(o){const t=typeof o.options.clobberPrefix=="string"?o.options.clobberPrefix:"user-content-",a=o.options.footnoteBackContent||Xq,u=o.options.footnoteBackLabel||Yq,y=o.options.footnoteLabel||"Footnotes",T=o.options.footnoteLabelTagName||"h2",C=o.options.footnoteLabelProperties||{className:["sr-only"]},s=[];let B=-1;for(;++B<o.footnoteOrder.length;){const V=o.footnoteById.get(o.footnoteOrder[B]);if(!V)continue;const W=o.all(V),Q=String(V.identifier).toUpperCase(),oe=Ky(Q.toLowerCase());let he=0;const Je=[],Ye=o.footnoteCounts.get(Q);for(;Ye!==void 0&&++he<=Ye;){Je.length>0&&Je.push({type:"text",value:" "});let ft=typeof a=="string"?a:a(B,he);typeof ft=="string"&&(ft={type:"text",value:ft}),Je.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+oe+(he>1?"-"+he:""),dataFootnoteBackref:"",ariaLabel:typeof u=="string"?u:u(B,he),className:["data-footnote-backref"]},children:Array.isArray(ft)?ft:[ft]})}const Xe=W[W.length-1];if(Xe&&Xe.type==="element"&&Xe.tagName==="p"){const ft=Xe.children[Xe.children.length-1];ft&&ft.type==="text"?ft.value+=" ":Xe.children.push({type:"text",value:" "}),Xe.children.push(...Je)}else W.push(...Je);const st={type:"element",tagName:"li",properties:{id:t+"fn-"+oe},children:o.wrap(W,!0)};o.patch(V,st),s.push(st)}if(s.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:T,properties:{...p1(C),id:"footnote-label"},children:[{type:"text",value:y}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:o.wrap(s,!0)},{type:"text",value:`
`}]}}const jL=(function(o){if(o==null)return tH;if(typeof o=="function")return j1(o);if(typeof o=="object")return Array.isArray(o)?Qq(o):Jq(o);if(typeof o=="string")return eH(o);throw new Error("Expected function, string, or object as test")});function Qq(o){const t=[];let a=-1;for(;++a<o.length;)t[a]=jL(o[a]);return j1(u);function u(...y){let T=-1;for(;++T<t.length;)if(t[T].apply(this,y))return!0;return!1}}function Jq(o){const t=o;return j1(a);function a(u){const y=u;let T;for(T in o)if(y[T]!==t[T])return!1;return!0}}function eH(o){return j1(t);function t(a){return a&&a.type===o}}function j1(o){return t;function t(a,u,y){return!!(nH(a)&&o.call(this,a,typeof u=="number"?u:void 0,y||void 0))}}function tH(){return!0}function nH(o){return o!==null&&typeof o=="object"&&"type"in o}const UL=[],iH=!0,zM=!1,rH="skip";function sH(o,t,a,u){let y;typeof t=="function"&&typeof a!="function"?(u=a,a=t):y=t;const T=jL(y),C=u?-1:1;s(o,void 0,[])();function s(B,V,W){const Q=B&&typeof B=="object"?B:{};if(typeof Q.type=="string"){const he=typeof Q.tagName=="string"?Q.tagName:typeof Q.name=="string"?Q.name:void 0;Object.defineProperty(oe,"name",{value:"node ("+(B.type+(he?"<"+he+">":""))+")"})}return oe;function oe(){let he=UL,Je,Ye,Xe;if((!t||T(B,V,W[W.length-1]||void 0))&&(he=aH(a(B,W)),he[0]===zM))return he;if("children"in B&&B.children){const st=B;if(st.children&&he[0]!==rH)for(Ye=(u?st.children.length:-1)+C,Xe=W.concat(st);Ye>-1&&Ye<st.children.length;){const ft=st.children[Ye];if(Je=s(ft,Ye,Xe)(),Je[0]===zM)return Je;Ye=typeof Je[1]=="number"?Je[1]:Ye+C}}return he}}}function aH(o){return Array.isArray(o)?o:typeof o=="number"?[iH,o]:o==null?UL:[o]}function GL(o,t,a,u){let y,T,C;typeof t=="function"&&typeof a!="function"?(T=void 0,C=t,y=a):(T=t,C=a,y=u),sH(o,T,s,y);function s(B,V){const W=V[V.length-1],Q=W?W.children.indexOf(B):void 0;return C(B,Q,W)}}const DE={}.hasOwnProperty,oH={};function lH(o,t){const a=t||oH,u=new Map,y=new Map,T=new Map,C={...qq,...a.handlers},s={all:V,applyData:uH,definitionById:u,footnoteById:y,footnoteCounts:T,footnoteOrder:[],handlers:C,one:B,options:a,patch:cH,wrap:dH};return GL(o,function(W){if(W.type==="definition"||W.type==="footnoteDefinition"){const Q=W.type==="definition"?u:y,oe=String(W.identifier).toUpperCase();Q.has(oe)||Q.set(oe,W)}}),s;function B(W,Q){const oe=W.type,he=s.handlers[oe];if(DE.call(s.handlers,oe)&&he)return he(s,W,Q);if(s.options.passThrough&&s.options.passThrough.includes(oe)){if("children"in W){const{children:Ye,...Xe}=W,st=p1(Xe);return st.children=s.all(W),st}return p1(W)}return(s.options.unknownHandler||hH)(s,W,Q)}function V(W){const Q=[];if("children"in W){const oe=W.children;let he=-1;for(;++he<oe.length;){const Je=s.one(oe[he],W);if(Je){if(he&&oe[he-1].type==="break"&&(!Array.isArray(Je)&&Je.type==="text"&&(Je.value=OM(Je.value)),!Array.isArray(Je)&&Je.type==="element")){const Ye=Je.children[0];Ye&&Ye.type==="text"&&(Ye.value=OM(Ye.value))}Array.isArray(Je)?Q.push(...Je):Q.push(Je)}}}return Q}}function cH(o,t){o.position&&(t.position=$8(o))}function uH(o,t){let a=t;if(o&&o.data){const u=o.data.hName,y=o.data.hChildren,T=o.data.hProperties;if(typeof u=="string")if(a.type==="element")a.tagName=u;else{const C="children"in a?a.children:[a];a={type:"element",tagName:u,properties:{},children:C}}a.type==="element"&&T&&Object.assign(a.properties,p1(T)),"children"in a&&a.children&&y!==null&&y!==void 0&&(a.children=y)}return a}function hH(o,t){const a=t.data||{},u="value"in t&&!(DE.call(a,"hProperties")||DE.call(a,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:o.all(t)};return o.patch(t,u),o.applyData(t,u)}function dH(o,t){const a=[];let u=-1;for(t&&a.push({type:"text",value:`
`});++u<o.length;)u&&a.push({type:"text",value:`
`}),a.push(o[u]);return t&&o.length>0&&a.push({type:"text",value:`
`}),a}function OM(o){let t=0,a=o.charCodeAt(t);for(;a===9||a===32;)t++,a=o.charCodeAt(t);return o.slice(t)}function NM(o,t){const a=lH(o,t),u=a.one(o,void 0),y=Kq(a),T=Array.isArray(u)?{type:"root",children:u}:u||{type:"root",children:[]};return y&&T.children.push({type:"text",value:`
`},y),T}function fH(o,t){return o&&"run"in o?async function(a,u){const y=NM(a,{file:u,...t});await o.run(y,u)}:function(a,u){return NM(a,{file:u,...o||t})}}function BM(o){if(o)throw o}var OT,FM;function pH(){if(FM)return OT;FM=1;var o=Object.prototype.hasOwnProperty,t=Object.prototype.toString,a=Object.defineProperty,u=Object.getOwnPropertyDescriptor,y=function(V){return typeof Array.isArray=="function"?Array.isArray(V):t.call(V)==="[object Array]"},T=function(V){if(!V||t.call(V)!=="[object Object]")return!1;var W=o.call(V,"constructor"),Q=V.constructor&&V.constructor.prototype&&o.call(V.constructor.prototype,"isPrototypeOf");if(V.constructor&&!W&&!Q)return!1;var oe;for(oe in V);return typeof oe>"u"||o.call(V,oe)},C=function(V,W){a&&W.name==="__proto__"?a(V,W.name,{enumerable:!0,configurable:!0,value:W.newValue,writable:!0}):V[W.name]=W.newValue},s=function(V,W){if(W==="__proto__")if(o.call(V,W)){if(u)return u(V,W).value}else return;return V[W]};return OT=function B(){var V,W,Q,oe,he,Je,Ye=arguments[0],Xe=1,st=arguments.length,ft=!1;for(typeof Ye=="boolean"&&(ft=Ye,Ye=arguments[1]||{},Xe=2),(Ye==null||typeof Ye!="object"&&typeof Ye!="function")&&(Ye={});Xe<st;++Xe)if(V=arguments[Xe],V!=null)for(W in V)Q=s(Ye,W),oe=s(V,W),Ye!==oe&&(ft&&oe&&(T(oe)||(he=y(oe)))?(he?(he=!1,Je=Q&&y(Q)?Q:[]):Je=Q&&T(Q)?Q:{},C(Ye,{name:W,newValue:B(ft,Je,oe)})):typeof oe<"u"&&C(Ye,{name:W,newValue:oe}));return Ye},OT}var mH=pH();const NT=Fv(mH);function PE(o){if(typeof o!="object"||o===null)return!1;const t=Object.getPrototypeOf(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)}function gH(){const o=[],t={run:a,use:u};return t;function a(...y){let T=-1;const C=y.pop();if(typeof C!="function")throw new TypeError("Expected function as last argument, not "+C);s(null,...y);function s(B,...V){const W=o[++T];let Q=-1;if(B){C(B);return}for(;++Q<y.length;)(V[Q]===null||V[Q]===void 0)&&(V[Q]=y[Q]);y=V,W?_H(W,s)(...V):C(null,...V)}}function u(y){if(typeof y!="function")throw new TypeError("Expected `middelware` to be a function, not "+y);return o.push(y),t}}function _H(o,t){let a;return u;function u(...C){const s=o.length>C.length;let B;s&&C.push(y);try{B=o.apply(this,C)}catch(V){const W=V;if(s&&a)throw W;return y(W)}s||(B&&B.then&&typeof B.then=="function"?B.then(T,y):B instanceof Error?y(B):T(B))}function y(C,...s){a||(a=!0,t(C,...s))}function T(C){y(null,C)}}const Qd={basename:yH,dirname:xH,extname:vH,join:bH,sep:"/"};function yH(o,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');e0(o);let a=0,u=-1,y=o.length,T;if(t===void 0||t.length===0||t.length>o.length){for(;y--;)if(o.codePointAt(y)===47){if(T){a=y+1;break}}else u<0&&(T=!0,u=y+1);return u<0?"":o.slice(a,u)}if(t===o)return"";let C=-1,s=t.length-1;for(;y--;)if(o.codePointAt(y)===47){if(T){a=y+1;break}}else C<0&&(T=!0,C=y+1),s>-1&&(o.codePointAt(y)===t.codePointAt(s--)?s<0&&(u=y):(s=-1,u=C));return a===u?u=C:u<0&&(u=o.length),o.slice(a,u)}function xH(o){if(e0(o),o.length===0)return".";let t=-1,a=o.length,u;for(;--a;)if(o.codePointAt(a)===47){if(u){t=a;break}}else u||(u=!0);return t<0?o.codePointAt(0)===47?"/":".":t===1&&o.codePointAt(0)===47?"//":o.slice(0,t)}function vH(o){e0(o);let t=o.length,a=-1,u=0,y=-1,T=0,C;for(;t--;){const s=o.codePointAt(t);if(s===47){if(C){u=t+1;break}continue}a<0&&(C=!0,a=t+1),s===46?y<0?y=t:T!==1&&(T=1):y>-1&&(T=-1)}return y<0||a<0||T===0||T===1&&y===a-1&&y===u+1?"":o.slice(y,a)}function bH(...o){let t=-1,a;for(;++t<o.length;)e0(o[t]),o[t]&&(a=a===void 0?o[t]:a+"/"+o[t]);return a===void 0?".":wH(a)}function wH(o){e0(o);const t=o.codePointAt(0)===47;let a=TH(o,!t);return a.length===0&&!t&&(a="."),a.length>0&&o.codePointAt(o.length-1)===47&&(a+="/"),t?"/"+a:a}function TH(o,t){let a="",u=0,y=-1,T=0,C=-1,s,B;for(;++C<=o.length;){if(C<o.length)s=o.codePointAt(C);else{if(s===47)break;s=47}if(s===47){if(!(y===C-1||T===1))if(y!==C-1&&T===2){if(a.length<2||u!==2||a.codePointAt(a.length-1)!==46||a.codePointAt(a.length-2)!==46){if(a.length>2){if(B=a.lastIndexOf("/"),B!==a.length-1){B<0?(a="",u=0):(a=a.slice(0,B),u=a.length-1-a.lastIndexOf("/")),y=C,T=0;continue}}else if(a.length>0){a="",u=0,y=C,T=0;continue}}t&&(a=a.length>0?a+"/..":"..",u=2)}else a.length>0?a+="/"+o.slice(y+1,C):a=o.slice(y+1,C),u=C-y-1;y=C,T=0}else s===46&&T>-1?T++:T=-1}return a}function e0(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}const EH={cwd:SH};function SH(){return"/"}function kE(o){return!!(o!==null&&typeof o=="object"&&"href"in o&&o.href&&"protocol"in o&&o.protocol&&o.auth===void 0)}function AH(o){if(typeof o=="string")o=new URL(o);else if(!kE(o)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+o+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(o.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return IH(o)}function IH(o){if(o.hostname!==""){const u=new TypeError('File URL host must be "localhost" or empty on darwin');throw u.code="ERR_INVALID_FILE_URL_HOST",u}const t=o.pathname;let a=-1;for(;++a<t.length;)if(t.codePointAt(a)===37&&t.codePointAt(a+1)===50){const u=t.codePointAt(a+2);if(u===70||u===102){const y=new TypeError("File URL path must not include encoded / characters");throw y.code="ERR_INVALID_FILE_URL_PATH",y}}return decodeURIComponent(t)}const BT=["history","path","basename","stem","extname","dirname"];class qL{constructor(t){let a;t?kE(t)?a={path:t}:typeof t=="string"||CH(t)?a={value:t}:a=t:a={},this.cwd="cwd"in a?"":EH.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let u=-1;for(;++u<BT.length;){const T=BT[u];T in a&&a[T]!==void 0&&a[T]!==null&&(this[T]=T==="history"?[...a[T]]:a[T])}let y;for(y in a)BT.includes(y)||(this[y]=a[y])}get basename(){return typeof this.path=="string"?Qd.basename(this.path):void 0}set basename(t){VT(t,"basename"),FT(t,"basename"),this.path=Qd.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Qd.dirname(this.path):void 0}set dirname(t){VM(this.basename,"dirname"),this.path=Qd.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Qd.extname(this.path):void 0}set extname(t){if(FT(t,"extname"),VM(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Qd.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){kE(t)&&(t=AH(t)),VT(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Qd.basename(this.path,this.extname):void 0}set stem(t){VT(t,"stem"),FT(t,"stem"),this.path=Qd.join(this.dirname||"",t+(this.extname||""))}fail(t,a,u){const y=this.message(t,a,u);throw y.fatal=!0,y}info(t,a,u){const y=this.message(t,a,u);return y.fatal=void 0,y}message(t,a,u){const y=new Cl(t,a,u);return this.path&&(y.name=this.path+":"+y.name,y.file=this.path),y.fatal=!1,this.messages.push(y),y}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function FT(o,t){if(o&&o.includes(Qd.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Qd.sep+"`")}function VT(o,t){if(!o)throw new Error("`"+t+"` cannot be empty")}function VM(o,t){if(!o)throw new Error("Setting `"+t+"` requires `path` to be set too")}function CH(o){return!!(o&&typeof o=="object"&&"byteLength"in o&&"byteOffset"in o)}const RH=(function(o){const u=this.constructor.prototype,y=u[o],T=function(){return y.apply(T,arguments)};return Object.setPrototypeOf(T,u),T}),MH={}.hasOwnProperty;class nA extends RH{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=gH()}copy(){const t=new nA;let a=-1;for(;++a<this.attachers.length;){const u=this.attachers[a];t.use(...u)}return t.data(NT(!0,{},this.namespace)),t}data(t,a){return typeof t=="string"?arguments.length===2?(GT("data",this.frozen),this.namespace[t]=a,this):MH.call(this.namespace,t)&&this.namespace[t]||void 0:t?(GT("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[a,...u]=this.attachers[this.freezeIndex];if(u[0]===!1)continue;u[0]===!0&&(u[0]=void 0);const y=a.call(t,...u);typeof y=="function"&&this.transformers.use(y)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const a=Sb(t),u=this.parser||this.Parser;return jT("parse",u),u(String(a),a)}process(t,a){const u=this;return this.freeze(),jT("process",this.parser||this.Parser),UT("process",this.compiler||this.Compiler),a?y(void 0,a):new Promise(y);function y(T,C){const s=Sb(t),B=u.parse(s);u.run(B,s,function(W,Q,oe){if(W||!Q||!oe)return V(W);const he=Q,Je=u.stringify(he,oe);kH(Je)?oe.value=Je:oe.result=Je,V(W,oe)});function V(W,Q){W||!Q?C(W):T?T(Q):a(void 0,Q)}}}processSync(t){let a=!1,u;return this.freeze(),jT("processSync",this.parser||this.Parser),UT("processSync",this.compiler||this.Compiler),this.process(t,y),UM("processSync","process",a),u;function y(T,C){a=!0,BM(T),u=C}}run(t,a,u){jM(t),this.freeze();const y=this.transformers;return!u&&typeof a=="function"&&(u=a,a=void 0),u?T(void 0,u):new Promise(T);function T(C,s){const B=Sb(a);y.run(t,B,V);function V(W,Q,oe){const he=Q||t;W?s(W):C?C(he):u(void 0,he,oe)}}}runSync(t,a){let u=!1,y;return this.run(t,a,T),UM("runSync","run",u),y;function T(C,s){BM(C),y=s,u=!0}}stringify(t,a){this.freeze();const u=Sb(a),y=this.compiler||this.Compiler;return UT("stringify",y),jM(t),y(t,u)}use(t,...a){const u=this.attachers,y=this.namespace;if(GT("use",this.frozen),t!=null)if(typeof t=="function")B(t,a);else if(typeof t=="object")Array.isArray(t)?s(t):C(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function T(V){if(typeof V=="function")B(V,[]);else if(typeof V=="object")if(Array.isArray(V)){const[W,...Q]=V;B(W,Q)}else C(V);else throw new TypeError("Expected usable value, not `"+V+"`")}function C(V){if(!("plugins"in V)&&!("settings"in V))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");s(V.plugins),V.settings&&(y.settings=NT(!0,y.settings,V.settings))}function s(V){let W=-1;if(V!=null)if(Array.isArray(V))for(;++W<V.length;){const Q=V[W];T(Q)}else throw new TypeError("Expected a list of plugins, not `"+V+"`")}function B(V,W){let Q=-1,oe=-1;for(;++Q<u.length;)if(u[Q][0]===V){oe=Q;break}if(oe===-1)u.push([V,...W]);else if(W.length>0){let[he,...Je]=W;const Ye=u[oe][1];PE(Ye)&&PE(he)&&(he=NT(!0,Ye,he)),u[oe]=[V,he,...Je]}}}}const DH=new nA().freeze();function jT(o,t){if(typeof t!="function")throw new TypeError("Cannot `"+o+"` without `parser`")}function UT(o,t){if(typeof t!="function")throw new TypeError("Cannot `"+o+"` without `compiler`")}function GT(o,t){if(t)throw new Error("Cannot call `"+o+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function jM(o){if(!PE(o)||typeof o.type!="string")throw new TypeError("Expected node, got `"+o+"`")}function UM(o,t,a){if(!a)throw new Error("`"+o+"` finished async. Use `"+t+"` instead")}function Sb(o){return PH(o)?o:new qL(o)}function PH(o){return!!(o&&typeof o=="object"&&"message"in o&&"messages"in o)}function kH(o){return typeof o=="string"||LH(o)}function LH(o){return!!(o&&typeof o=="object"&&"byteLength"in o&&"byteOffset"in o)}const zH="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",GM=[],qM={allowDangerousHtml:!0},OH=/^(https?|ircs?|mailto|xmpp)$/i,NH=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function BH(o){const t=FH(o),a=VH(o);return jH(t.runSync(t.parse(a),a),o)}function FH(o){const t=o.rehypePlugins||GM,a=o.remarkPlugins||GM,u=o.remarkRehypeOptions?{...o.remarkRehypeOptions,...qM}:qM;return DH().use(yq).use(a).use(fH,u).use(t)}function VH(o){const t=o.children||"",a=new qL;return typeof t=="string"&&(a.value=t),a}function jH(o,t){const a=t.allowedElements,u=t.allowElement,y=t.components,T=t.disallowedElements,C=t.skipHtml,s=t.unwrapDisallowed,B=t.urlTransform||UH;for(const W of NH)Object.hasOwn(t,W.from)&&(""+W.from+(W.to?"use `"+W.to+"` instead":"remove it")+zH+W.id,void 0);return GL(o,V),K8(o,{Fragment:j.Fragment,components:y,ignoreInvalidStyle:!0,jsx:j.jsx,jsxs:j.jsxs,passKeys:!0,passNode:!0});function V(W,Q,oe){if(W.type==="raw"&&oe&&typeof Q=="number")return C?oe.children.splice(Q,1):oe.children[Q]={type:"text",value:W.value},Q;if(W.type==="element"){let he;for(he in kT)if(Object.hasOwn(kT,he)&&Object.hasOwn(W.properties,he)){const Je=W.properties[he],Ye=kT[he];(Ye===null||Ye.includes(W.tagName))&&(W.properties[he]=B(String(Je||""),he,W))}}if(W.type==="element"){let he=a?!a.includes(W.tagName):T?T.includes(W.tagName):!1;if(!he&&u&&typeof Q=="number"&&(he=!u(W,Q,oe)),he&&oe&&typeof Q=="number")return s&&W.children?oe.children.splice(Q,1,...W.children):oe.children.splice(Q,1),Q}}}function UH(o){const t=o.indexOf(":"),a=o.indexOf("?"),u=o.indexOf("#"),y=o.indexOf("/");return t===-1||y!==-1&&t>y||a!==-1&&t>a||u!==-1&&t>u||OH.test(o.slice(0,t))?o:""}const GH=({onClose:o,onConfirm:t,availableSlots:a=[]})=>{const[u,y]=He.useState(null),T=a&&a.length>0,C={},s=new Set,B=[];if(T){a.forEach(Xe=>{C[Xe.day]||(C[Xe.day]=[],s.has(Xe.day)||(s.add(Xe.day),B.push({day:Xe.day,date:Xe.date}))),C[Xe.day].includes(Xe.time)||C[Xe.day].push(Xe.time)});const Ye=["SUN","MON","TUE","WED","THU","FRI","SAT"];B.sort((Xe,st)=>Ye.indexOf(Xe.day)-Ye.indexOf(st.day))}const V=[{day:"SAT",date:"25"},{day:"SUN",date:"26"},{day:"MON",date:"27"},{day:"TUE",date:"28"},{day:"WED",date:"29"},{day:"THU",date:"30"},{day:"FRI",date:"31"}],W={SAT:["10:00 AM","11:30 AM"],SUN:["09:00 AM","01:00 PM"],MON:["09:00 AM","10:30 AM","02:00 PM"],TUE:["08:00 AM","11:00 AM","03:30 PM"],WED:["02:00 PM","04:30 PM"],THU:["09:00 AM","11:00 AM","02:30 PM","04:00 PM"],FRI:["09:15 AM","03:00 PM","05:00 PM"]},Q=T?B:V,oe=T?C:W,he=(Ye,Xe,st)=>{y({day:Ye,date:Xe,time:st})},Je=()=>{u&&t&&t(u)};return j.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[j.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[j.jsxs("div",{children:[j.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Schedule Appointment"}),j.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:"January 2025  Select an available time"})]}),o&&j.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:j.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),j.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:j.jsx("div",{className:"grid grid-cols-7 gap-2",children:Q.map(Ye=>{var Xe;return j.jsxs("div",{className:"flex flex-col",children:[j.jsxs("div",{className:"text-center pb-2 border-b border-black/5 mb-2",children:[j.jsx("div",{className:"text-[9px] font-black uppercase tracking-wider text-gray-400",children:Ye.day}),j.jsx("div",{className:"text-lg font-black text-primary",children:Ye.date})]}),j.jsx("div",{className:"space-y-2",children:(Xe=oe[Ye.day])==null?void 0:Xe.map(st=>{const ft=(u==null?void 0:u.day)===Ye.day&&(u==null?void 0:u.time)===st;return j.jsx("button",{onClick:()=>he(Ye.day,Ye.date,st),className:`w-full py-2 px-1 rounded-xl text-[10px] font-bold transition-all ${ft?"bg-primary text-white shadow-lg scale-105":"bg-white border border-black/5 text-primary hover:border-primary hover:scale-102"}`,children:st},st)})})]},Ye.day)})})}),j.jsxs("div",{className:"p-4 border-t border-black/5 bg-white/50 backdrop-blur-sm flex-shrink-0 space-y-3",children:[u?j.jsxs("div",{className:"bg-white rounded-xl p-4 border border-black/5 flex items-center gap-3",children:[j.jsx("span",{className:"size-10 rounded-full bg-primary/10 flex items-center justify-center",children:j.jsx("span",{className:"material-symbols-outlined text-primary",children:"event"})}),j.jsxs("div",{className:"flex-1",children:[j.jsx("p",{className:"text-[10px] text-gray-400 font-medium uppercase tracking-wider",children:"Selected"}),j.jsxs("p",{className:"font-bold text-primary text-sm",children:[u.day,", Jan ",u.date," at ",u.time]})]})]}):j.jsx("div",{className:"text-center py-2 text-gray-400 text-xs",children:"Select a time slot above"}),j.jsx("button",{onClick:Je,disabled:!u,className:`w-full py-4 rounded-2xl text-sm font-black transition-all ${u?"bg-primary text-white shadow-lg shadow-black/5 hover:bg-black active:scale-[0.98]":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:"Confirm Appointment"})]})]})},qH=({onClose:o,minimized:t=!1,transcript:a=[],agentNeedsInput:u=!1,agentQuestion:y="",agentContext:T="",onUserResponse:C})=>{const s=He.useRef(null),[B,V]=He.useState(""),[W,Q]=He.useState(!1);He.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[a,u]);const oe=()=>{!B.trim()||!C||(Q(!0),C(B.trim()),V(""),setTimeout(()=>Q(!1),1e3))},he=Je=>Je==="bot"?"ai":"other";return j.jsxs("div",{className:`w-full shadow-xl z-20 flex flex-col ${t?"bg-green-600":"h-full bg-soft-cream"}`,children:[!t&&j.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[j.jsxs("div",{ref:s,className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-6",children:[a.length===0?j.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 opacity-60",children:[j.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"graphic_eq"}),j.jsx("p",{className:"text-sm font-medium",children:"Waiting for conversation..."})]}):a.map((Je,Ye)=>he(Je.sender)==="ai"?j.jsxs("div",{className:"flex flex-row-reverse gap-3",children:[j.jsx("div",{className:"size-8 bg-green-600 rounded-full flex items-center justify-center shadow-md flex-shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-white text-sm fill-1",children:"smart_toy"})}),j.jsxs("div",{className:"bg-green-600 p-4 rounded-2xl rounded-tr-none shadow-xl text-white max-w-[85%]",children:[j.jsx("div",{className:"flex items-center gap-2 mb-1",children:j.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider opacity-80",children:"AI Assistant"})}),j.jsx("p",{className:"text-xs md:text-sm leading-relaxed",children:Je.message})]})]},Ye):j.jsxs("div",{className:"flex gap-3",children:[j.jsx("div",{className:"size-8 rounded-full overflow-hidden border border-black/5 flex-shrink-0 bg-white flex items-center justify-center",children:j.jsx("span",{className:"material-symbols-outlined text-gray-500 text-sm",children:"support_agent"})}),j.jsxs("div",{className:"bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-black/5 max-w-[85%]",children:[j.jsx("div",{className:"flex items-center gap-2 mb-1",children:j.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider text-gray-500",children:"Receptionist"})}),j.jsx("p",{className:"text-xs md:text-sm text-primary leading-relaxed",children:Je.message})]})]},Ye)),u&&j.jsx("div",{children:j.jsxs("div",{className:"bg-card-beige border-2 border-primary/20 rounded-[32px] p-6 shadow-lg",children:[j.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[j.jsx("div",{className:"size-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0 shadow-md",children:j.jsx("span",{className:"material-symbols-outlined text-white",children:"help"})}),j.jsxs("div",{className:"flex-1",children:[j.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[j.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-primary/60",children:"Input Needed"}),j.jsx("span",{className:"size-2 bg-primary rounded-full"})]}),j.jsx("p",{className:"text-primary font-bold text-lg",children:y||"The agent needs information from you"}),T&&j.jsx("p",{className:"text-sm text-gray-500 mt-1",children:T})]})]}),j.jsxs("div",{className:"flex gap-3",children:[j.jsx("input",{type:"text",value:B,onChange:Je=>V(Je.target.value),onKeyDown:Je=>Je.key==="Enter"&&oe(),placeholder:"Type your response...",className:"flex-1 bg-white border border-black/5 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:border-primary/30 focus:ring-2 focus:ring-primary/10 transition-all shadow-sm",autoFocus:!0,disabled:W}),j.jsx("button",{onClick:oe,disabled:!B.trim()||W,className:`px-6 py-3 rounded-2xl font-black text-sm transition-all flex items-center gap-2 ${!B.trim()||W?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10"}`,children:W?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Sending"]}):j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined text-lg",children:"send"}),"Send"]})})]}),j.jsx("p",{className:"text-[10px] text-gray-400 font-medium mt-3 text-center",children:"The receptionist is waiting. Your response will be relayed by the AI agent."})]})})]}),j.jsx("div",{className:"flex justify-center items-center gap-1 py-6 bg-soft-cream/95 backdrop-blur-sm border-t border-black/5 shrink-0 z-10",children:[.1,.4,.2,.6,.3,.5,.2].map((Je,Ye)=>j.jsx("div",{className:"waveform-bar w-1 bg-green-500 rounded-full h-6",style:{height:`${12+Ye%3*8}px`}},Ye))})]}),j.jsxs("div",{className:"bg-green-600 p-4 flex items-center justify-between gap-4 flex-shrink-0",children:[j.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[j.jsx("div",{className:"size-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm flex-shrink-0",children:j.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"phone_in_talk"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-black text-white",children:"Relay Call Active"}),j.jsx("p",{className:"text-[11px] text-white/80 font-mono mt-0.5",children:"Recording  Live"})]})]}),j.jsxs("button",{onClick:o,className:"bg-white text-green-600 rounded-2xl font-black text-xs px-5 py-3 flex items-center justify-center gap-2 hover:bg-gray-100 transition-all active:scale-95",children:[j.jsx("span",{className:"material-symbols-outlined text-lg rotate-[135deg]",children:"call"}),"End"]})]})]})},HH="modulepreload",$H=function(o){return"/"+o},HM={},ZH=function(t,a,u){let y=Promise.resolve();if(a&&a.length>0){let C=function(V){return Promise.all(V.map(W=>Promise.resolve(W).then(Q=>({status:"fulfilled",value:Q}),Q=>({status:"rejected",reason:Q}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),B=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));y=C(a.map(V=>{if(V=$H(V),V in HM)return;HM[V]=!0;const W=V.endsWith(".css"),Q=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${V}"]${Q}`))return;const oe=document.createElement("link");if(oe.rel=W?"stylesheet":HH,W||(oe.as="script"),oe.crossOrigin="",oe.href=V,B&&oe.setAttribute("nonce",B),document.head.appendChild(oe),W)return new Promise((he,Je)=>{oe.addEventListener("load",he),oe.addEventListener("error",()=>Je(new Error(`Unable to preload CSS for ${V}`)))})}))}function T(C){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=C,window.dispatchEvent(s),!s.defaultPrevented)throw C}return y.then(C=>{for(const s of C||[])s.status==="rejected"&&T(s.reason);return t().catch(T)})},WH=He.createContext(null);function XH(o){return{longitude:o.center.lng,latitude:o.center.lat,zoom:o._seaLevelZoom??o.zoom,pitch:o.pitch,bearing:o.bearing,padding:o.padding,elevation:o._centerAltitude}}function YH(o){return Number.isFinite(o.longitude)||Number.isFinite(o.latitude)||Number.isFinite(o.zoom)||Number.isFinite(o.pitch)||Number.isFinite(o.bearing)}function KH(o,t){return!!(Number.isFinite(t.longitude)&&o.center.lng!==t.longitude||Number.isFinite(t.latitude)&&o.center.lat!==t.latitude||Number.isFinite(t.bearing)&&o.bearing!==t.bearing||Number.isFinite(t.pitch)&&o.pitch!==t.pitch||Number.isFinite(t.zoom)&&(o._seaLevelZoom??o.zoom)!==t.zoom||t.padding&&!o.isPaddingEqual(t.padding))}function $M(){}function QH(o,t){const a=o._constrain,u=o._calcMatrices;if(o._constrain=$M,o._calcMatrices=$M,Number.isFinite(t.bearing)&&(o.bearing=t.bearing),Number.isFinite(t.pitch)&&(o.pitch=t.pitch),t.padding&&!o.isPaddingEqual(t.padding)&&(o.padding=t.padding),Number.isFinite(t.longitude)||Number.isFinite(t.latitude)){const y=o.center;o._center=new y.constructor(t.longitude??y.lng,t.latitude??y.lat)}if(Number.isFinite(t.zoom))if(o._centerAltitude=t.elevation??0,o.elevation){o._seaLevelZoom=t.zoom;const y=o.pixelsPerMeter/o.worldSize*o._centerAltitude,T=o._mercatorZfromZoom(t.zoom),C=o._mercatorZfromZoom(o._maxZoom),s=Math.max(T-y,C);o._setZoom(o._zoomFromMercatorZ(s))}else o._seaLevelZoom=null,o.zoom=t.zoom;o._constrain=a,o._calcMatrices=u,o._unmodified||(o._constrain(),o._calcMatrices())}const JH=new Set(["_calcMatrices","_calcFogMatrices","_updateCameraState","_updateSeaLevelZoom"]);function e7(o){let t=!1,a={};const u=o;let y=null;const T={get(C,s){return s==="$reactViewState"?a:s==="$proposedTransform"?y:s==="$internalUpdate"?t:s==="_setZoom"?B=>{t&&(y==null||y[s](B)),Number.isFinite(a.zoom)||u[s](B)}:(t&&s==="_translateCameraConstrained"&&YH(a)&&(y=y||u.clone()),JH.has(s)?function(...B){y==null||y[s](...B),u[s](...B)}:t&&y?y[s]:u[s])},set(C,s,B){if(s==="$reactViewState")return a=B,QH(u,a),!0;if(s==="$proposedTransform")return y=B,!0;if(s==="$internalUpdate")return t=B,!0;let V=B;return s==="center"||s==="_center"?(Number.isFinite(a.longitude)||Number.isFinite(a.latitude))&&(V=new B.constructor(a.longitude??B.lng,a.latitude??B.lat)):s==="zoom"||s==="_zoom"||s==="_seaLevelZoom"?Number.isFinite(a.zoom)&&(V=u[s]):s==="_centerAltitude"?Number.isFinite(a.elevation)&&(V=u[s]):s==="pitch"||s==="_pitch"?Number.isFinite(a.pitch)&&(V=u[s]):(s==="bearing"||s==="rotation"||s==="angle")&&Number.isFinite(a.bearing)&&(V=u[s]),t&&V!==B&&(y=y||u.clone()),t&&y&&(y[s]=B),u[s]=V,!0}};return new Proxy(o,T)}const t7=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ZM(o){if(!o)return null;if(typeof o=="string"||("toJS"in o&&(o=o.toJS()),!o.layers))return o;const t={};for(const u of o.layers)t[u.id]=u;const a=o.layers.map(u=>{let y=null;"interactive"in u&&(y=Object.assign({},u),delete y.interactive);const T=t[u.ref];if(T){y=y||Object.assign({},u),delete y.ref;for(const C of t7)C in T&&(y[C]=T[C])}return y||u});return{...o,layers:a}}function n7(o,t){const a=Array.isArray(o)?o[0]:o?o.x:0,u=Array.isArray(o)?o[1]:o?o.y:0,y=Array.isArray(t)?t[0]:t?t.x:0,T=Array.isArray(t)?t[1]:t?t.y:0;return a===y&&u===T}function eh(o,t){if(o===t)return!0;if(!o||!t)return!1;if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let a=0;a<o.length;a++)if(!eh(o[a],t[a]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof o=="object"&&typeof t=="object"){const a=Object.keys(o),u=Object.keys(t);if(a.length!==u.length)return!1;for(const y of a)if(!t.hasOwnProperty(y)||!eh(o[y],t[y]))return!1;return!0}return!1}var WM={};const XM={version:8,sources:{},layers:[]},YM={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},KM={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},QM={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},i7=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],r7=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Fy{constructor(t,a,u){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=y=>{const T=this.props[QM[y.type]];T?T(y):y.type==="error"&&console.error(y.error)},this._onPointerEvent=y=>{(y.type==="mousemove"||y.type==="mouseout")&&this._updateHover(y);const T=this.props[YM[y.type]];T&&(this.props.interactiveLayerIds&&y.type!=="mouseover"&&y.type!=="mouseout"&&(y.features=this._hoveredFeatures||this._queryRenderedFeatures(y.point)),T(y),delete y.features)},this._onCameraEvent=y=>{if(!this._internalUpdate){const T=this.props[KM[y.type]],C=this._proxyTransform;T&&(y.viewState=XH(C.$proposedTransform??C),T(y)),y.type==="moveend"&&(C.$proposedTransform=null)}y.type in this._deferredEvents&&(this._deferredEvents[y.type]=!1)},this._MapClass=t,this.props=a,this._initialize(u)}get map(){return this._map}get transform(){return this._map.transform}setProps(t){const a=this.props;this.props=t;const u=this._updateSettings(t,a);u&&this._createProxyTransform(this._map);const y=this._updateSize(t),T=this._updateViewState(t,!0);this._updateStyle(t,a),this._updateStyleComponents(t,a),this._updateHandlers(t,a),(u||y||T&&!this._map.isMoving())&&this.redraw()}static reuse(t,a){const u=Fy.savedMaps.pop();if(!u)return null;const y=u.map,T=y.getContainer();for(a.className=T.className;T.childNodes.length>0;)a.appendChild(T.childNodes[0]);y._container=a,u.setProps({...t,styleDiffing:!1}),y.resize();const{initialViewState:C}=t;return C&&(C.bounds?y.fitBounds(C.bounds,{...C.fitBoundsOptions,duration:0}):u._updateViewState(C,!1)),y.isStyleLoaded()?y.fire("load"):y.once("styledata",()=>y.fire("load")),y._update(),u}_initialize(t){const{props:a}=this,{mapStyle:u=XM}=a,y={...a,...a.initialViewState,accessToken:a.mapboxAccessToken||s7()||null,container:t,style:ZM(u)},T=y.initialViewState||y.viewState||y;if(Object.assign(y,{center:[T.longitude||0,T.latitude||0],zoom:T.zoom||0,pitch:T.pitch||0,bearing:T.bearing||0}),a.gl){const Q=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Q,a.gl)}const C=new this._MapClass(y);T.padding&&C.setPadding(T.padding),a.cursor&&(C.getCanvas().style.cursor=a.cursor),this._createProxyTransform(C);const s=C._render;C._render=Q=>{this._inRender=!0,s.call(C,Q),this._inRender=!1};const B=C._renderTaskQueue.run;C._renderTaskQueue.run=Q=>{this._proxyTransform.$internalUpdate=!0,B.call(C._renderTaskQueue,Q),this._proxyTransform.$internalUpdate=!1,this._fireDefferedEvents()};const V=C.jumpTo;C.jumpTo=(...Q)=>(this._proxyTransform.$internalUpdate=!0,V.apply(C,Q),this._proxyTransform.$internalUpdate=!1,C);const W=C.fire;C.fire=this._fireEvent.bind(this,W),C.on("styledata",()=>{this._updateStyleComponents(this.props,{})}),C.on("sourcedata",()=>{this._updateStyleComponents(this.props,{})});for(const Q in YM)C.on(Q,this._onPointerEvent);for(const Q in KM)C.on(Q,this._onCameraEvent);for(const Q in QM)C.on(Q,this._onEvent);this._map=C}recycle(){const a=this.map.getContainer().querySelector("[mapboxgl-children]");a==null||a.remove(),Fy.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createProxyTransform(t){const a=e7(t.transform);t.transform=a,t.painter.transform=a,this._proxyTransform=a}_updateSize(t){const{viewState:a}=t;if(a){const u=this._map;if(a.width!==u.transform.width||a.height!==u.transform.height)return u.resize(),!0}return!1}_updateViewState(t,a){const u=t.viewState||t,y=this._proxyTransform,{zoom:T,pitch:C,bearing:s}=y,B=KH(this._proxyTransform,u);if(y.$reactViewState=u,B&&a){const V=this._deferredEvents;V.move=!0,V.zoom||(V.zoom=T!==y.zoom),V.rotate||(V.rotate=s!==y.bearing),V.pitch||(V.pitch=C!==y.pitch)}return B}_updateSettings(t,a){const u=this._map;let y=!1;for(const T of i7)if(T in t&&!eh(t[T],a[T])){y=!0;const C=u[`set${T[0].toUpperCase()}${T.slice(1)}`];C==null||C.call(u,t[T])}return y}_updateStyle(t,a){if(t.cursor!==a.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==a.mapStyle){const{mapStyle:u=XM,styleDiffing:y=!0}=t,T={diff:y};return"localIdeographFontFamily"in t&&(T.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(ZM(u),T),!0}return!1}_updateStyleComponents(t,a){const u=this._map;let y=!1;return u.isStyleLoaded()&&("light"in t&&u.setLight&&!eh(t.light,a.light)&&(y=!0,u.setLight(t.light)),"fog"in t&&u.setFog&&!eh(t.fog,a.fog)&&(y=!0,u.setFog(t.fog)),"terrain"in t&&u.setTerrain&&!eh(t.terrain,a.terrain)&&(!t.terrain||u.getSource(t.terrain.source))&&(y=!0,u.setTerrain(t.terrain))),y}_updateHandlers(t,a){const u=this._map;let y=!1;for(const T of r7){const C=t[T]??!0,s=a[T]??!0;eh(C,s)||(y=!0,C?u[T].enable(C):u[T].disable())}return y}_queryRenderedFeatures(t){const a=this._map,{interactiveLayerIds:u=[]}=this.props;try{return a.queryRenderedFeatures(t,{layers:u.filter(a.getLayer.bind(a))})}catch{return[]}}_updateHover(t){var y;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const T=t.type,C=((y=this._hoveredFeatures)==null?void 0:y.length)>0,s=this._queryRenderedFeatures(t.point),B=s.length>0;!B&&C&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=s,B&&!C&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=T}else this._hoveredFeatures=null}_fireEvent(t,a,u){const y=this._map,T=this._proxyTransform,C=T.$internalUpdate;try{T.$internalUpdate=!1,t.call(y,a,u)}finally{T.$internalUpdate=C}return y}_fireDefferedEvents(){const t=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&t.fire(a);this._internalUpdate=!1}}Fy.savedMaps=[];function s7(){let o=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);o=t&&t[1]}try{o=o||WM.MapboxAccessToken}catch{}try{o=o||WM.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return o}const a7=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function o7(o){if(!o)return null;const t=o.map,a={getMap:()=>t,getCenter:()=>o.transform.center,getZoom:()=>o.transform.zoom,getBearing:()=>o.transform.bearing,getPitch:()=>o.transform.pitch,getPadding:()=>o.transform.padding,getBounds:()=>o.transform.getBounds(),project:u=>{const y=t.transform;t.transform=o.transform;const T=t.project(u);return t.transform=y,T},unproject:u=>{const y=t.transform;t.transform=o.transform;const T=t.unproject(u);return t.transform=y,T},queryTerrainElevation:(u,y)=>{const T=t.transform;t.transform=o.transform;const C=t.queryTerrainElevation(u,y);return t.transform=T,C},queryRenderedFeatures:(u,y)=>{const T=t.transform;t.transform=o.transform;const C=t.queryRenderedFeatures(u,y);return t.transform=T,C}};for(const u of l7(t))!(u in a)&&!a7.includes(u)&&(a[u]=t[u].bind(t));return a}function l7(o){const t=new Set;let a=o;for(;a;){for(const u of Object.getOwnPropertyNames(a))u[0]!=="_"&&typeof o[u]=="function"&&u!=="fire"&&u!=="setEventedParent"&&t.add(u);a=Object.getPrototypeOf(a)}return Array.from(t)}const c7=typeof document<"u"?He.useLayoutEffect:He.useEffect,u7=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function h7(o,t){for(const u of u7)u in t&&(o[u]=t[u]);const{RTLTextPlugin:a="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;a&&o.getRTLTextPluginStatus&&o.getRTLTextPluginStatus()==="unavailable"&&o.setRTLTextPlugin(a,u=>{u&&console.error(u)},!0)}const Qy=He.createContext(null);function d7(o,t){const a=He.useContext(WH),[u,y]=He.useState(null),T=He.useRef(),{current:C}=He.useRef({mapLib:null,map:null});He.useEffect(()=>{const V=o.mapLib;let W=!0,Q;return Promise.resolve(V||ZH(()=>Promise.resolve().then(()=>M7),[])).then(oe=>{if(!W)return;if(!oe)throw new Error("Invalid mapLib");const he="Map"in oe?oe:oe.default;if(!he.Map)throw new Error("Invalid mapLib");h7(he,o),o.reuseMaps&&(Q=Fy.reuse(o,T.current)),Q||(Q=new Fy(he.Map,o,T.current)),C.map=o7(Q),C.mapLib=he,y(Q),a==null||a.onMapMount(C.map,o.id)}).catch(oe=>{const{onError:he}=o;he?he({type:"error",target:null,error:oe}):console.error(oe)}),()=>{W=!1,Q&&(a==null||a.onMapUnmount(o.id),o.reuseMaps?Q.recycle():Q.destroy())}},[]),c7(()=>{u&&u.setProps(o)}),He.useImperativeHandle(t,()=>C.map,[u]);const s=He.useMemo(()=>({position:"relative",width:"100%",height:"100%",...o.style}),[o.style]),B={height:"100%"};return He.createElement("div",{id:o.id,ref:T,style:s},u&&He.createElement(Qy.Provider,{value:C},He.createElement("div",{"mapboxgl-children":"",style:B},o.children)))}const f7=He.forwardRef(d7),p7=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function g_(o,t){if(!o||!t)return;const a=o.style;for(const u in t){const y=t[u];Number.isFinite(y)&&!p7.test(u)?a[u]=`${y}px`:a[u]=y}}function HL(o,t){if(o===t)return null;const a=JM(o),u=JM(t),y=[];for(const T of u)a.has(T)||y.push(T);for(const T of a)u.has(T)||y.push(T);return y.length===0?null:y}function JM(o){return new Set(o?o.trim().split(/\s+/):[])}const qT=He.memo(He.forwardRef((o,t)=>{const{map:a,mapLib:u}=He.useContext(Qy),y=He.useRef({props:o}),T=He.useMemo(()=>{let st=!1;He.Children.forEach(o.children,Ft=>{Ft&&(st=!0)});const ft={...o,element:st?document.createElement("div"):null},ht=new u.Marker(ft);return ht.setLngLat([o.longitude,o.latitude]),ht.getElement().addEventListener("click",Ft=>{var fn,St;(St=(fn=y.current.props).onClick)==null||St.call(fn,{type:"click",target:ht,originalEvent:Ft})}),ht.on("dragstart",Ft=>{var St,je;const fn=Ft;fn.lngLat=T.getLngLat(),(je=(St=y.current.props).onDragStart)==null||je.call(St,fn)}),ht.on("drag",Ft=>{var St,je;const fn=Ft;fn.lngLat=T.getLngLat(),(je=(St=y.current.props).onDrag)==null||je.call(St,fn)}),ht.on("dragend",Ft=>{var St,je;const fn=Ft;fn.lngLat=T.getLngLat(),(je=(St=y.current.props).onDragEnd)==null||je.call(St,fn)}),ht},[]);He.useEffect(()=>(T.addTo(a.getMap()),()=>{T.remove()}),[]);const{longitude:C,latitude:s,offset:B,style:V,draggable:W=!1,popup:Q=null,rotation:oe=0,rotationAlignment:he="auto",pitchAlignment:Je="auto"}=o;He.useEffect(()=>{g_(T.getElement(),V)},[V]),He.useImperativeHandle(t,()=>T,[]);const Ye=y.current.props;(T.getLngLat().lng!==C||T.getLngLat().lat!==s)&&T.setLngLat([C,s]),B&&!n7(T.getOffset(),B)&&T.setOffset(B),T.isDraggable()!==W&&T.setDraggable(W),T.getRotation()!==oe&&T.setRotation(oe),T.getRotationAlignment()!==he&&T.setRotationAlignment(he),T.getPitchAlignment()!==Je&&T.setPitchAlignment(Je),T.getPopup()!==Q&&T.setPopup(Q);const Xe=HL(Ye.className,o.className);if(Xe)for(const st of Xe)T.toggleClassName(st);return y.current.props=o,ID.createPortal(o.children,T.getElement())}));He.memo(He.forwardRef((o,t)=>{const{map:a,mapLib:u}=He.useContext(Qy),y=He.useMemo(()=>document.createElement("div"),[]),T=He.useRef({props:o}),C=He.useMemo(()=>{const s={...o},B=new u.Popup(s);return B.setLngLat([o.longitude,o.latitude]),B.once("open",V=>{var W,Q;(Q=(W=T.current.props).onOpen)==null||Q.call(W,V)}),B},[]);if(He.useEffect(()=>{const s=B=>{var V,W;(W=(V=T.current.props).onClose)==null||W.call(V,B)};return C.on("close",s),C.setDOMContent(y).addTo(a.getMap()),()=>{C.off("close",s),C.isOpen()&&C.remove()}},[]),He.useEffect(()=>{g_(C.getElement(),o.style)},[o.style]),He.useImperativeHandle(t,()=>C,[]),C.isOpen()){const s=T.current.props;(C.getLngLat().lng!==o.longitude||C.getLngLat().lat!==o.latitude)&&C.setLngLat([o.longitude,o.latitude]),o.offset&&!eh(s.offset,o.offset)&&(C.options.anchor=o.anchor,C.setOffset(o.offset)),(s.anchor!==o.anchor||s.maxWidth!==o.maxWidth)&&C.setMaxWidth(o.maxWidth);const B=HL(s.className,o.className);if(B)for(const V of B)C.toggleClassName(V);T.current.props=o}return ID.createPortal(o.children,y)}));function t0(o,t,a,u){const y=He.useContext(Qy),T=He.useMemo(()=>o(y),[]);return He.useEffect(()=>{const C=t,s=null,B=typeof t=="function"?t:null,{map:V}=y;return V.hasControl(T)||(V.addControl(T,C==null?void 0:C.position),s&&s(y)),()=>{B&&B(y),V.hasControl(T)&&V.removeControl(T)}},[]),T}function m7(o){const t=t0(({mapLib:a})=>new a.AttributionControl(o),{position:o.position});return He.useEffect(()=>{g_(t._container,o.style)},[o.style]),null}He.memo(m7);function g7(o){const t=t0(({mapLib:a})=>new a.FullscreenControl({container:o.containerId&&document.getElementById(o.containerId)}),{position:o.position});return He.useEffect(()=>{g_(t._controlContainer,o.style)},[o.style]),null}He.memo(g7);function _7(o,t){const a=He.useRef({props:o}),u=t0(({mapLib:y})=>{const T=new y.GeolocateControl(o),C=T._setupUI.bind(T);return T._setupUI=s=>{T._container.hasChildNodes()||C(s)},T.on("geolocate",s=>{var B,V;(V=(B=a.current.props).onGeolocate)==null||V.call(B,s)}),T.on("error",s=>{var B,V;(V=(B=a.current.props).onError)==null||V.call(B,s)}),T.on("outofmaxbounds",s=>{var B,V;(V=(B=a.current.props).onOutOfMaxBounds)==null||V.call(B,s)}),T.on("trackuserlocationstart",s=>{var B,V;(V=(B=a.current.props).onTrackUserLocationStart)==null||V.call(B,s)}),T.on("trackuserlocationend",s=>{var B,V;(V=(B=a.current.props).onTrackUserLocationEnd)==null||V.call(B,s)}),T},{position:o.position});return a.current.props=o,He.useImperativeHandle(t,()=>u,[]),He.useEffect(()=>{g_(u._container,o.style)},[o.style]),null}He.memo(He.forwardRef(_7));function y7(o){const t=t0(({mapLib:a})=>new a.NavigationControl(o),{position:o.position});return He.useEffect(()=>{g_(t._container,o.style)},[o.style]),null}const x7=He.memo(y7);function v7(o){const t=t0(({mapLib:T})=>new T.ScaleControl(o),{position:o.position}),a=He.useRef(o),u=a.current;a.current=o;const{style:y}=o;return o.maxWidth!==void 0&&o.maxWidth!==u.maxWidth&&(t.options.maxWidth=o.maxWidth),o.unit!==void 0&&o.unit!==u.unit&&t.setUnit(o.unit),He.useEffect(()=>{g_(t._container,y)},[y]),null}He.memo(v7);function m1(o,t){if(!o)throw new Error(t)}let b7=0;function w7(o,t,a){if(o.style&&o.style._loaded){const u={...a};return delete u.id,delete u.children,o.addSource(t,u),o.getSource(t)}return null}function T7(o,t,a){m1(t.id===a.id,"source id changed"),m1(t.type===a.type,"source type changed");let u="",y=0;for(const C in t)C!=="children"&&C!=="id"&&!eh(a[C],t[C])&&(u=C,y++);if(!y)return;const T=t.type;T==="geojson"?o.setData(t.data):T==="image"?o.updateImage({url:t.url,coordinates:t.coordinates}):"setCoordinates"in o&&y===1&&u==="coordinates"?o.setCoordinates(t.coordinates):"setUrl"in o&&u==="url"?o.setUrl(t.url):"setTiles"in o&&u==="tiles"?o.setTiles(t.tiles):console.warn(`Unable to update <Source> prop: ${u}`)}function E7(o){const t=He.useContext(Qy).map.getMap(),a=He.useRef(o),[,u]=He.useState(0),y=He.useMemo(()=>o.id||`jsx-source-${b7++}`,[]);He.useEffect(()=>{if(t){const C=()=>setTimeout(()=>u(s=>s+1),0);return t.on("styledata",C),C(),()=>{var s;if(t.off("styledata",C),t.style&&t.style._loaded&&t.getSource(y)){const B=(s=t.getStyle())==null?void 0:s.layers;if(B)for(const V of B)V.source===y&&t.removeLayer(V.id);t.removeSource(y)}}}},[t]);let T=t&&t.style&&t.getSource(y);return T?T7(T,o,a.current):T=w7(t,y,o),a.current=o,T&&He.Children.map(o.children,C=>C&&He.cloneElement(C,{source:y}))||null}function S7(o,t,a,u){if(m1(a.id===u.id,"layer id changed"),m1(a.type===u.type,"layer type changed"),a.type==="custom"||u.type==="custom")return;const{layout:y={},paint:T={},filter:C,minzoom:s,maxzoom:B,beforeId:V}=a;if(V!==u.beforeId&&o.moveLayer(t,V),y!==u.layout){const W=u.layout||{};for(const Q in y)eh(y[Q],W[Q])||o.setLayoutProperty(t,Q,y[Q]);for(const Q in W)y.hasOwnProperty(Q)||o.setLayoutProperty(t,Q,void 0)}if(T!==u.paint){const W=u.paint||{};for(const Q in T)eh(T[Q],W[Q])||o.setPaintProperty(t,Q,T[Q]);for(const Q in W)T.hasOwnProperty(Q)||o.setPaintProperty(t,Q,void 0)}eh(C,u.filter)||o.setFilter(t,C),(s!==u.minzoom||B!==u.maxzoom)&&o.setLayerZoomRange(t,s,B)}function A7(o,t,a){if(o.style&&o.style._loaded&&(!("source"in a)||o.getSource(a.source))){const u={...a,id:t};delete u.beforeId,o.addLayer(u,a.beforeId)}}let I7=0;function eD(o){const t=He.useContext(Qy).map.getMap(),a=He.useRef(o),[,u]=He.useState(0),y=He.useMemo(()=>o.id||`jsx-layer-${I7++}`,[]);if(He.useEffect(()=>{if(t){const C=()=>u(s=>s+1);return t.on("styledata",C),C(),()=>{t.off("styledata",C),t.style&&t.style._loaded&&t.getLayer(y)&&t.removeLayer(y)}}},[t]),t&&t.style&&t.getLayer(y))try{S7(t,y,o,a.current)}catch(C){console.warn(C)}else A7(t,y,o);return a.current=o,null}var jb={exports:{}},C7=jb.exports,tD;function R7(){return tD||(tD=1,(function(o,t){(function(a,u){o.exports=u()})(C7,(function(){var a,u,y;function T(s,B){if(!a)a=B;else if(!u)u=B;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",W={};a(W),y=B(W),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}T(["exports"],function(s){var B=1e-6,V=typeof Float32Array<"u"?Float32Array:Array;function W(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i*m-d*l;return _?(r[0]=m*(_=1/_),r[1]=-l*_,r[2]=-d*_,r[3]=i*_,r):null}function Q(){var r=new V(9);return V!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function oe(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8];return r[0]=_*D-v*A,r[1]=d*A-l*D,r[2]=l*v-d*_,r[3]=v*S-m*D,r[4]=i*D-d*S,r[5]=d*m-i*v,r[6]=m*A-_*S,r[7]=l*S-i*A,r[8]=i*_-l*m,r}function he(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=i[0],N=i[1],U=i[2],Z=i[3],K=i[4],X=i[5],te=i[6],se=i[7],le=i[8];return r[0]=k*l+N*_+U*A,r[1]=k*d+N*v+U*D,r[2]=k*m+N*S+U*P,r[3]=Z*l+K*_+X*A,r[4]=Z*d+K*v+X*D,r[5]=Z*m+K*S+X*P,r[6]=te*l+se*_+le*A,r[7]=te*d+se*v+le*D,r[8]=te*m+se*S+le*P,r}function Je(){var r=new V(16);return V!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ye(r){var e=new V(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Xe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function st(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8],P=e[9],k=e[10],N=e[11],U=e[12],Z=e[13],K=e[14],X=e[15],te=i*v-l*_,se=i*S-d*_,le=i*A-m*_,_e=l*S-d*v,me=l*A-m*v,Ee=d*A-m*S,Se=D*Z-P*U,we=D*K-k*U,Me=D*X-N*U,Oe=P*K-k*Z,pt=P*X-N*Z,ot=k*X-N*K,ut=te*ot-se*pt+le*Oe+_e*Me-me*we+Ee*Se;return ut?(r[0]=(v*ot-S*pt+A*Oe)*(ut=1/ut),r[1]=(d*pt-l*ot-m*Oe)*ut,r[2]=(Z*Ee-K*me+X*_e)*ut,r[3]=(k*me-P*Ee-N*_e)*ut,r[4]=(S*Me-_*ot-A*we)*ut,r[5]=(i*ot-d*Me+m*we)*ut,r[6]=(K*le-U*Ee-X*se)*ut,r[7]=(D*Ee-k*le+N*se)*ut,r[8]=(_*pt-v*Me+A*Se)*ut,r[9]=(l*Me-i*pt-m*Se)*ut,r[10]=(U*me-Z*le+X*te)*ut,r[11]=(P*le-D*me-N*te)*ut,r[12]=(v*we-_*Oe-S*Se)*ut,r[13]=(i*Oe-l*we+d*Se)*ut,r[14]=(Z*se-U*_e-K*te)*ut,r[15]=(D*_e-P*se+k*te)*ut,r):null}function ft(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=e[9],N=e[10],U=e[11],Z=e[12],K=e[13],X=e[14],te=e[15],se=i[0],le=i[1],_e=i[2],me=i[3];return r[0]=se*l+le*v+_e*P+me*Z,r[1]=se*d+le*S+_e*k+me*K,r[2]=se*m+le*A+_e*N+me*X,r[3]=se*_+le*D+_e*U+me*te,r[4]=(se=i[4])*l+(le=i[5])*v+(_e=i[6])*P+(me=i[7])*Z,r[5]=se*d+le*S+_e*k+me*K,r[6]=se*m+le*A+_e*N+me*X,r[7]=se*_+le*D+_e*U+me*te,r[8]=(se=i[8])*l+(le=i[9])*v+(_e=i[10])*P+(me=i[11])*Z,r[9]=se*d+le*S+_e*k+me*K,r[10]=se*m+le*A+_e*N+me*X,r[11]=se*_+le*D+_e*U+me*te,r[12]=(se=i[12])*l+(le=i[13])*v+(_e=i[14])*P+(me=i[15])*Z,r[13]=se*d+le*S+_e*k+me*K,r[14]=se*m+le*A+_e*N+me*X,r[15]=se*_+le*D+_e*U+me*te,r}function ht(r,e,i){var l,d,m,_,v,S,A,D,P,k,N,U,Z=i[0],K=i[1],X=i[2];return e===r?(r[12]=e[0]*Z+e[4]*K+e[8]*X+e[12],r[13]=e[1]*Z+e[5]*K+e[9]*X+e[13],r[14]=e[2]*Z+e[6]*K+e[10]*X+e[14],r[15]=e[3]*Z+e[7]*K+e[11]*X+e[15]):(d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=e[9],N=e[10],U=e[11],r[0]=l=e[0],r[1]=d,r[2]=m,r[3]=_,r[4]=v,r[5]=S,r[6]=A,r[7]=D,r[8]=P,r[9]=k,r[10]=N,r[11]=U,r[12]=l*Z+v*K+P*X+e[12],r[13]=d*Z+S*K+k*X+e[13],r[14]=m*Z+A*K+N*X+e[14],r[15]=_*Z+D*K+U*X+e[15]),r}function Ft(r,e,i){var l=i[0],d=i[1],m=i[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function fn(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[4],_=e[5],v=e[6],S=e[7],A=e[8],D=e[9],P=e[10],k=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*d+A*l,r[5]=_*d+D*l,r[6]=v*d+P*l,r[7]=S*d+k*l,r[8]=A*d-m*l,r[9]=D*d-_*l,r[10]=P*d-v*l,r[11]=k*d-S*l,r}function St(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[0],_=e[1],v=e[2],S=e[3],A=e[8],D=e[9],P=e[10],k=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d-A*l,r[1]=_*d-D*l,r[2]=v*d-P*l,r[3]=S*d-k*l,r[8]=m*l+A*d,r[9]=_*l+D*d,r[10]=v*l+P*d,r[11]=S*l+k*d,r}function je(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[0],_=e[1],v=e[2],S=e[3],A=e[4],D=e[5],P=e[6],k=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d+A*l,r[1]=_*d+D*l,r[2]=v*d+P*l,r[3]=S*d+k*l,r[4]=A*d-m*l,r[5]=D*d-_*l,r[6]=P*d-v*l,r[7]=k*d-S*l,r}function ze(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ve(r,e,i){var l,d,m,_=i[0],v=i[1],S=i[2],A=Math.sqrt(_*_+v*v+S*S);return A<B?null:(_*=A=1/A,v*=A,S*=A,l=Math.sin(e),d=Math.cos(e),r[0]=_*_*(m=1-d)+d,r[1]=v*_*m+S*l,r[2]=S*_*m-v*l,r[3]=0,r[4]=_*v*m-S*l,r[5]=v*v*m+d,r[6]=S*v*m+_*l,r[7]=0,r[8]=_*S*m+v*l,r[9]=v*S*m-_*l,r[10]=S*S*m+d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Ke(r,e){var i=e[0],l=e[1],d=e[2],m=e[4],_=e[5],v=e[6],S=e[8],A=e[9],D=e[10];return r[0]=Math.sqrt(i*i+l*l+d*d),r[1]=Math.sqrt(m*m+_*_+v*v),r[2]=Math.sqrt(S*S+A*A+D*D),r}function qe(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i+i,v=l+l,S=d+d,A=i*_,D=l*_,P=l*v,k=d*_,N=d*v,U=d*S,Z=m*_,K=m*v,X=m*S;return r[0]=1-P-U,r[1]=D+X,r[2]=k-K,r[3]=0,r[4]=D-X,r[5]=1-A-U,r[6]=N+Z,r[7]=0,r[8]=k+K,r[9]=N-Z,r[10]=1-A-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var et=ft;function be(){var r=new V(3);return V!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Zt(r){var e=new V(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function dn(r){var e=r[0],i=r[1],l=r[2];return Math.sqrt(e*e+i*i+l*l)}function wt(r,e,i){var l=new V(3);return l[0]=r,l[1]=e,l[2]=i,l}function Jt(r,e,i,l){return r[0]=e,r[1]=i,r[2]=l,r}function En(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function ci(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function tt(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function dt(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function Kt(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Ne(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function wn(r,e,i,l){return r[0]=e[0]+i[0]*l,r[1]=e[1]+i[1]*l,r[2]=e[2]+i[2]*l,r}function Kn(r,e){var i=e[0]-r[0],l=e[1]-r[1],d=e[2]-r[2];return Math.sqrt(i*i+l*l+d*d)}function Zn(r,e){var i=e[0]-r[0],l=e[1]-r[1],d=e[2]-r[2];return i*i+l*l+d*d}function Ci(r){var e=r[0],i=r[1],l=r[2];return e*e+i*i+l*l}function Xi(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Gn(r,e){var i=e[0],l=e[1],d=e[2],m=i*i+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r}function zi(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function jr(r,e,i){var l=e[0],d=e[1],m=e[2],_=i[0],v=i[1],S=i[2];return r[0]=d*S-m*v,r[1]=m*_-l*S,r[2]=l*v-d*_,r}function Va(r,e,i,l){var d=e[0],m=e[1],_=e[2];return r[0]=d+l*(i[0]-d),r[1]=m+l*(i[1]-m),r[2]=_+l*(i[2]-_),r}function cr(r,e,i){var l=e[0],d=e[1],m=e[2],_=i[3]*l+i[7]*d+i[11]*m+i[15];return r[0]=(i[0]*l+i[4]*d+i[8]*m+i[12])/(_=_||1),r[1]=(i[1]*l+i[5]*d+i[9]*m+i[13])/_,r[2]=(i[2]*l+i[6]*d+i[10]*m+i[14])/_,r}function Bs(r,e,i){var l=e[0],d=e[1],m=e[2];return r[0]=l*i[0]+d*i[3]+m*i[6],r[1]=l*i[1]+d*i[4]+m*i[7],r[2]=l*i[2]+d*i[5]+m*i[8],r}function Hn(r,e,i){var l=i[0],d=i[1],m=i[2],_=i[3],v=e[0],S=e[1],A=e[2],D=d*A-m*S,P=m*v-l*A,k=l*S-d*v;return r[0]=v+_*(D+=D)+d*(k+=k)-m*(P+=P),r[1]=S+_*P+m*D-l*k,r[2]=A+_*k+l*P-d*D,r}function Ti(r){return r[0]=0,r[1]=0,r[2]=0,r}function ur(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var ui=ci,Qi=tt,_r=dn;function Xs(){var r=new V(4);return V!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Rl(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function rc(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i*i+l*l+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=l*_,r[2]=d*_,r[3]=m*_,r}function Ur(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function vs(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3];return r[0]=i[0]*l+i[4]*d+i[8]*m+i[12]*_,r[1]=i[1]*l+i[5]*d+i[9]*m+i[13]*_,r[2]=i[2]*l+i[6]*d+i[10]*m+i[14]*_,r[3]=i[3]*l+i[7]*d+i[11]*m+i[15]*_,r}function en(){var r=new V(4);return V!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Tn(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function ri(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+_*v,r[1]=d*S+m*v,r[2]=m*S-d*v,r[3]=_*S-l*v,r}function Oi(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S-m*v,r[1]=d*S+_*v,r[2]=m*S+l*v,r[3]=_*S-d*v,r}be(),Xs();var Ri,Fs,gs,ps=rc,kr=(Ri=be(),Fs=wt(1,0,0),gs=wt(0,1,0),function(r,e,i){var l=zi(e,i);return l<-.999999?(jr(Ri,Fs,e),_r(Ri)<1e-6&&jr(Ri,gs,e),Gn(Ri,Ri),(function(d,m,_){_*=.5;var v=Math.sin(_);d[0]=v*m[0],d[1]=v*m[1],d[2]=v*m[2],d[3]=Math.cos(_)})(r,Ri,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(jr(Ri,e,i),r[0]=Ri[0],r[1]=Ri[1],r[2]=Ri[2],r[3]=1+l,ps(r,r))});function yr(){var r=new V(2);return V!=Float32Array&&(r[0]=0,r[1]=0),r}function Vi(r,e){var i=new V(2);return i[0]=r,i[1]=e,i}function ra(r,e,i){return r[0]=e,r[1]=i,r}function bs(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function cl(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function Ca(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function bo(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function ms(r,e){var i=e[0],l=e[1],d=i*i+l*l;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r}function ji(r,e){return r[0]*e[0]+r[1]*e[1]}en(),en(),Q();var Yr,wo,_u=cl;function ja(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}yr();var ul=(function(){if(wo)return Yr;function r(e,i,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=l,this.p2y=d}return wo=1,Yr=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<i)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=m/_}var v=0,S=1;for(l=e,d=0;d<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<i));d++)e>m?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Yr})(),hl=ja(ul);function Mt(r,e){this.x=r,this.y=e}function no(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!no(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!no(r[i],e[i]))return!1;return!0}return r===e}Mt.prototype={clone(){return new Mt(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround(r,e){const i=Math.cos(r),l=Math.sin(r),d=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Mt},Mt.convert=function(r){if(r instanceof Mt)return r;if(Array.isArray(r))return new Mt(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Mt(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const th=Math.PI/180,Lc=180/Math.PI;function ai(r){return r*th}function Ue(r){return r*Lc}const ne=[[0,0],[1,0],[1,1],[0,1]];function ae(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function ye(r,e,i,l){const d=new hl(r,e,i,l);return function(m){return d.solve(m)}}const De=ye(.25,.1,.25,1);function xe(r,e,i){return Math.min(i,Math.max(e,r))}function Be(r,e,i){return(i=xe((i-r)/(e-r),0,1))*i*(3-2*i)}function it(r,e,i){const l=i-e,d=((r-e)%l+l)%l+e;return d===e?i:d}function Ge(r,e,i){if(!r.length)return i(null,[]);let l=r.length;const d=new Array(r.length);let m=null;r.forEach((_,v)=>{e(_,(S,A)=>{S&&(m=S),d[v]=A,--l===0&&i(m,d)})})}let at=1;function Dt(){return at++}function It(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function tn(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function yn(r,e,i){const l={};for(const d in r)l[d]=e.call(this,r[d],d,r);return l}function bn(r,e,i){const l={};for(const d in r)e.call(this,r[d],d,r)&&(l[d]=r[d]);return l}function kn(r){return Array.isArray(r)?r.map(kn):typeof r=="object"&&r?yn(r,kn):r}function Fn(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const vn={};function Pn(r){vn[r]||(typeof console<"u"&&console.warn(r),vn[r]=!0)}function $i(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function vr(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}function nr([r,e,i]){const l=ai(e+90),d=ai(i);return{x:r*Math.cos(l)*Math.sin(d),y:r*Math.sin(l)*Math.sin(d),z:r*Math.cos(d),azimuthal:e,polar:i}}function br(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function ir(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,d,m)=>{const _=d||m;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let hi=null;function hr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Ni(r,e,i,l){for(;e<i;){const d=e+i>>1;r[d]<l?e=d+1:i=d}return e}function _i(r,e,i,l){for(;e<i;){const d=e+i>>1;r[d]<=l?e=d+1:i=d}return e}function Ei(r){return r>0?1/(1.001-r):1+r}function dr(r){return r>0?1-1/(1.001-r):-r}function Jr(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const es={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!es.API_URL)return null;try{const r=new URL(es.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function fr(r){return es.API_URL_REGEX.test(r)}function ws(r){return es.API_SPRITE_REGEX.test(r)}let Ts,ma,_s,sa,aa,$o;function To(){return Ts==null&&(Ts=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ts}const Ua={now:()=>sa!==void 0?sa:performance.now(),setNow(r){sa=r},restoreNow(){sa=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:l}=r;aa||(aa=document.createElement("canvas"));const d=aa.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(i>aa.width||l>aa.height)&&(aa.width=i,aa.height=l),d.clearRect(-e,-e,i+2*e,l+2*e),d.drawImage(r,0,0,i,l),d.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:r=>(ma||(ma=document.createElement("a")),ma.href=r,ma.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(_s==null&&(_s=window.matchMedia("(prefers-reduced-motion: reduce)")),_s.matches)},hasCanvasFingerprintNoise(){if($o!==void 0)return $o;if(!To())return $o=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let d=0;d<r.width;++d)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(d,0,1,1);const l=e.getImageData(0,0,r.width,r.height);i=0;for(let d=0;d<l.data.length;++d)if(d%4!=3&&i++!==l.data[d])return $o=!0,!0;return $o=!1,!1}};function dl(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(r.slice(i));for(const d in e)l.set(d,e[d]);return`${r.slice(0,i)}?${l.toString()}`}function ga(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const l=new URLSearchParams,d=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const v=d.get(_);v&&l.set(_,v)}const m=l.toString();return`${r.slice(0,i)}${m.length>0?`?${m}`:""}`}const pf="mapbox-tiles";let td=500,nh=50;const yu=["language","worldview","jobid"];let Es,Ys;function Eo(){try{return caches}catch{}}function Ss(){const r=Eo();r&&Es==null&&(Es=r.open(pf))}let So=1/0;const Ra={supported:!1,testSupport:function(r){!Ao&&Ga&&(zc?fl(r):Zo=r)}};let Zo,Ga,Ao=!1,zc=!1;const Oc=typeof self<"u"?self:{};function fl(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ga),r.isContextLost())return;Ra.supported=!0}catch{}r.deleteTexture(e),Ao=!0}Oc.document&&(Ga=Oc.document.createElement("img"),Ga.onload=function(){Zo&&fl(Zo),Zo=null,zc=!0},Ga.onerror=function(){Ao=!0,Zo=null},Ga.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const us={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(us);class Ml extends Error{constructor(e,i,l){i===401&&fr(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sr=br()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,_a=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Sr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,d){const m=new AbortController,_=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Sr(),referrerPolicy:l.referrerPolicy,signal:m.signal});let v=!1,S=!1;const A=(D=_.url).indexOf("sku=")>0&&fr(D);var D;l.type==="json"&&_.headers.set("Accept","application/json");const P=(N,U,Z)=>{if(S)return;if(N&&N.message!=="SecurityError"&&Pn(N.toString()),U&&Z)return k(U);const K=Date.now();fetch(_).then(X=>{if(X.ok){const te=A?X.clone():null;return k(X,te,K)}return d(new Ml(X.statusText,X.status,l.url))}).catch(X=>{X.name!=="AbortError"&&d(new Error(`${X.message} ${l.url}`))})},k=(N,U,Z)=>{(l.type==="arrayBuffer"?N.arrayBuffer():l.type==="json"?N.json():N.text()).then(K=>{S||(U&&Z&&(function(X,te,se){if(Ss(),Es==null)return;const le=ir(te.headers.get("Cache-Control")||"");if(le["no-store"])return;const _e={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((Se,we)=>_e.headers.set(we,Se)),le["max-age"]&&_e.headers.set("Expires",new Date(se+1e3*le["max-age"]).toUTCString());const me=_e.headers.get("Expires");if(!me||new Date(me).getTime()-se<42e4)return;let Ee=ga(X.url,{persistentParams:yu});if(te.status===206){const Se=X.headers.get("Range");if(!Se)return;_e.status=200,Ee=dl(Ee,{range:Se})}(function(Se,we){if(Ys===void 0)try{new Response(new ReadableStream),Ys=!0}catch{Ys=!1}Ys?we(Se.body):Se.blob().then(we).catch(Me=>Pn(Me.message))})(te,Se=>{const we=new Response((Me=te.status)!==200&&Me!==404&&[101,103,204,205,304].includes(Me)?null:Se,_e);var Me;Ss(),Es!=null&&Es.then(Oe=>Oe.put(Ee,we)).catch(Oe=>Pn(Oe.message))})})(_,U,Z),v=!0,d(null,K,N.headers))}).catch(K=>{S||d(new Error(K.message))})};return A?(function(N,U){if(Ss(),Es==null)return U(null);Es.then(Z=>{let K=ga(N.url,{persistentParams:yu});const X=N.headers.get("Range");X&&(K=dl(K,{range:X})),Z.match(K).then(te=>{const se=(function(le){if(!le)return!1;const _e=new Date(le.headers.get("Expires")||0),me=ir(le.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!me["no-cache"]})(te);Z.delete(K).catch(U),se&&Z.put(K,te.clone()).catch(U),U(null,te,se)}).catch(U)}).catch(U)})(_,P):P(null,null),{cancel:()=>{S=!0,v||m.abort()}}})(r,e);if(br(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(l,d){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(l.type==="json")try{_=JSON.parse(m.response)}catch(S){return d(S)}const v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const A=S.split(": "),D=A.shift(),P=A.join(": ");v.append(D,P)}),d(null,_,v)}else d(new Ml(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}})(r,e)},Nc=function(r,e){return _a(Object.assign(r,{type:"arrayBuffer"}),e)};function ih(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const rh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let di,Io;di=[],Io=0;const Co=function(r,e){if(Ra.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Io>=es.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return di.push(m),m}Io++;let i=!1;const l=()=>{if(!i)for(i=!0,Io--;di.length&&Io<es.MAX_PARALLEL_IMAGE_REQUESTS;){const m=di.shift(),{requestParameters:_,callback:v,cancelled:S}=m;S||(m.cancel=Co(_,v).cancel)}},d=Nc(r,(m,_,v)=>{l(),m?e(m):_&&(self.createImageBitmap?(function(S,A){const D=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(D).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(_,(S,A)=>e(S,A,v)):(function(S,A){const D=new Image;D.onload=()=>{A(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=rh})},D.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(S)],{type:"image/png"});D.src=S.byteLength?URL.createObjectURL(P):rh})(_,(S,A)=>e(S,A,v)))});return{cancel:()=>{d.cancel(),l()}}};var ya,sc,Ro,io={exports:{}},Bc={exports:{}},Dl={exports:{}},nd=(function(){if(Ro)return io.exports;Ro=1;var r=(ya||(ya=1,Bc.exports=function(i,l){var d,m,_,v,S,A,D,P;for(m=i.length-(d=3&i.length),_=l,S=3432918353,A=461845907,P=0;P<m;)D=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,_=27492+(65535&(v=5*(65535&(_=(_^=D=(65535&(D=(D=(65535&D)*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((v>>>16)+58964&65535)<<16);switch(D=0,d){case 3:D^=(255&i.charCodeAt(P+2))<<16;case 2:D^=(255&i.charCodeAt(P+1))<<8;case 1:_^=D=(65535&(D=(D=(65535&(D^=255&i.charCodeAt(P)))*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Bc.exports),e=(sc||(sc=1,Dl.exports=function(i,l){for(var d,m=i.length,_=l^m,v=0;m>=4;)d=1540483477*(65535&(d=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:_^=(255&i.charCodeAt(v+2))<<16;case 2:_^=(255&i.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Dl.exports);return io.exports=r,io.exports.murmur3=r,io.exports.murmur2=e,io.exports})(),ro=ja(nd);class Mo{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Fc extends Mo{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function xu(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function ac(r,e,i){if(i&&i[r]){const l=i[r].indexOf(e);l!==-1&&i[r].splice(l,1)}}class pl{on(e,i){return this._listeners=this._listeners||{},xu(e,i,this._listeners),this}off(e,i){return ac(e,i,this._listeners),ac(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},xu(e,i,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,i){const l=typeof e=="string"?new Mo(e,i):e,d=l.type;if(this.listens(d)){l.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const S of m)S.call(this,l);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const S of _)ac(d,S,this._oneTimeListeners),S.call(this,l);const v=this._eventedParent;if(v){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,S),v.fire(l)}}else l instanceof Fc&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Vs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Vs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,l]=e.split("");return new Vs({name:i,iconsetId:l})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Vs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var qa,sh={},ah=(function(){if(qa)return sh;qa=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function i(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function l(m){return(_=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:_>1?1:_;var _}function d(m,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(_-m)*v*6:2*v<1?_:3*v<2?m+(_-m)*(2/3-v)*6:m}try{sh.parseCSSColor=function(m){var _,v=m.replace(/ /g,"").toLowerCase();if(v in r)return r[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var S=v.indexOf("("),A=v.indexOf(")");if(S!==-1&&A+1===v.length){var D=v.substr(0,S),P=v.substr(S+1,A-(S+1)).split(","),k=1;switch(D){case"rgba":if(P.length!==4)return null;k=l(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),k];case"hsla":if(P.length!==4)return null;k=l(P.pop());case"hsl":if(P.length!==3)return null;var N=(parseFloat(P[0])%360+360)%360/360,U=l(P[1]),Z=l(P[2]),K=Z<=.5?Z*(U+1):Z+U-Z*U,X=2*Z-K;return[e(255*d(X,K,N+1/3)),e(255*d(X,K,N)),e(255*d(X,K,N-1/3)),k];default:return null}}return null}}catch{}return sh})();class Si{constructor(e,i,l,d=1){this.r=e,this.g=i,this.b=l,this.a=d}static parse(e){if(!e)return;if(e instanceof Si)return e;if(typeof e!="string")return;const i=ah.parseCSSColor(e);return i?new Si(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,l,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*l)},${d})`}toNonPremultipliedRenderColor(e){const{r:i,g:l,b:d,a:m}=this;return new Pl(e,i,l,d,m)}toPremultipliedRenderColor(e){const{r:i,g:l,b:d,a:m}=this;return new mf(e,i*m,l*m,d*m,m)}clone(){return new Si(this.r,this.g,this.b,this.a)}}class id{constructor(e,i,l,d,m,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const v=e.image.height,S=v*v;this.premultiplied?(i=m===0?0:i/m*(v-1),l=m===0?0:l/m*(v-1),d=m===0?0:d/m*(v-1)):(i*=v-1,l*=v-1,d*=v-1),i=Math.max(0,Math.min(v-1,i)),l=Math.max(0,Math.min(v-1,l)),d=Math.max(0,Math.min(v-1,d));const A=Math.floor(i),D=Math.floor(l),P=Math.floor(d),k=Math.ceil(i),N=Math.ceil(l),U=Math.ceil(d),Z=i-A,K=l-D,X=d-P,te=e.image.data,se=4*(A+D*S+P*v),le=4*(A+D*S+U*v),_e=4*(A+N*S+P*v),me=4*(A+N*S+U*v),Ee=4*(k+D*S+P*v),Se=4*(k+D*S+U*v),we=4*(k+N*S+P*v),Me=4*(k+N*S+U*v);this.r=Cn(Cn(Cn(te[se],te[le],X),Cn(te[_e],te[me],X),K),Cn(Cn(te[Ee],te[Se],X),Cn(te[we],te[Me],X),K),Z)/255*(this.premultiplied?m:1),this.g=Cn(Cn(Cn(te[se+1],te[le+1],X),Cn(te[_e+1],te[me+1],X),K),Cn(Cn(te[Ee+1],te[Se+1],X),Cn(te[we+1],te[Me+1],X),K),Z)/255*(this.premultiplied?m:1),this.b=Cn(Cn(Cn(te[se+2],te[le+2],X),Cn(te[_e+2],te[me+2],X),K),Cn(Cn(te[Ee+2],te[Se+2],X),Cn(te[we+2],te[Me+2],X),K),Z)/255*(this.premultiplied?m:1),this.a=m}else this.r=i,this.g=l,this.b=d,this.a=m}toArray(){const{r:e,g:i,b:l,a:d}=this;return[255*e,255*i,255*l,d]}toHslaArray(){let{r:e,g:i,b:l,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const U=1/d;e*=U,i*=U,l*=U}const m=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),v=Math.min(Math.max(l,0),1),S=Math.min(m,_,v),A=Math.max(m,_,v),D=A-S,P=.5*(S+A);if(D===0)return[0,0,100*P,d];const k=P>.5?D/(2-A-S):D/(A+S);let N;switch(A){case m:N=60*((_-v)/D+(_<v?6:0));break;case _:N=60*((v-m)/D+2);break;default:N=60*((m-_)/D+4)}return[N,100*k,100*P,d]}toArray01(){const{r:e,g:i,b:l,a:d}=this;return[e,i,l,d]}toArray01Scaled(e){const{r:i,g:l,b:d}=this;return[i*e,l*e,d*e]}toArray01Linear(){const{r:e,g:i,b:l,a:d}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(l,2.2),d]}}class Pl extends id{constructor(e,i,l,d,m){super(e,i,l,d,m,!1)}}class mf extends id{constructor(e,i,l,d,m){super(e,i,l,d,m,!0)}}function Cn(r,e,i){return r*(1-i)+e*i}function rd(r,e,i){return r.map((l,d)=>Cn(l,e[d],i))}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1),Si.blue=new Si(0,0,1,1);var oc=Object.freeze({__proto__:null,array:rd,color:function(r,e,i){return new Si(Cn(r.r,e.r,i),Cn(r.g,e.g,i),Cn(r.b,e.b,i),Cn(r.a,e.a,i))},number:Cn});class As extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class xa{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,d]of i)this.bindings[l]=d}concat(e){return new xa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const va={kind:"null"},gn={kind:"number"},pi={kind:"string"},L={kind:"boolean"},ie={kind:"color"},de={kind:"object"},Ce={kind:"value"},Lt={kind:"collator"},Gt={kind:"formatted"},Sn={kind:"resolvedImage"};function oi(r,e){return{kind:"array",itemType:r,N:e}}function Mi(r){if(r.kind==="array"){const e=Mi(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Lr=[va,gn,pi,L,ie,Gt,de,oi(Ce),Sn];function Kr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Kr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Lr)if(!Kr(i,e))return null}}return`Expected ${Mi(r)} but found ${Mi(e)} instead.`}function Do(r,e){return e.some(i=>i.kind===r.kind)}function Po(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function ko(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&ko(r.itemType,e.itemType):r.kind===e.kind}class Wo{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class lc{constructor(e,i,l,d,m){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=d,this.textColor=m}}class Rs{constructor(e){this.sections=e}static fromString(e){return new Rs([new lc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Rs?e:Rs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const d=i.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Ks{constructor(e,i={}){this.id=Vs.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,l,d,m;try{({id:i,params:l,sx:d,sy:m}=JSON.parse(e)||{})}catch{return null}return i?new Ks(i,{params:l,sx:d,sy:m}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class so{constructor(e,i,l,d,m=!1){this.primaryId=Vs.from(e),this.primaryOptions=i,l&&(this.secondaryId=Vs.from(l)),this.secondaryOptions=d,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ks(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ks(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?so.build({name:e}):e}static build(e,i,l,d){return!e||typeof e=="object"&&!("name"in e)?null:new so(e,l,i,d)}}function $m(r,e,i,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,i,l]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vu(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Si||r instanceof Wo||r instanceof Rs||r instanceof so)return!0;if(Array.isArray(r)){for(const e of r)if(!vu(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!vu(r[e]))return!1;return!0}return!1}function Is(r){if(r===null)return va;if(typeof r=="string")return pi;if(typeof r=="boolean")return L;if(typeof r=="number")return gn;if(r instanceof Si)return ie;if(r instanceof Wo)return Lt;if(r instanceof Rs)return Gt;if(r instanceof so)return Sn;if(Array.isArray(r)){const e=r.length;let i;for(const l of r){const d=Is(l);if(i){if(i===d)continue;i=Ce;break}i=d}return oi(i||Ce,e)}return de}function kl(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Rs||r instanceof so||r instanceof Si?r.toString():JSON.stringify(r)}class Xo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!vu(e[1]))return i.error("invalid value");const l=e[1];let d=Is(l);const m=i.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Xo(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Si?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Rs?this.value.serialize():this.value}}class ts{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bu={string:pi,number:gn,boolean:L,object:de};class zn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,d=1;const m=e[0];if(m==="array"){let v,S;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in bu)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=bu[A],d++}else v=Ce;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}l=oi(v,S)}else l=bu[m];const _=[];for(;d<e.length;d++){const v=i.parse(e[d],d,Ce);if(!v)return null;_.push(v)}return new zn(l,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Kr(this.type,Is(l)))return l;if(i===this.args.length-1)throw new ts(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Mi(Is(l))} but was expected to be of type ${Mi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&i.push(d)}}return i.concat(this.args.map(l=>l.serialize()))}}class mn{constructor(e){this.type=Gt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let S=null;if(v["font-scale"]&&(S=i.parseObjectValue(v["font-scale"],_,"font-scale",gn),!S))return null;let A=null;if(v["text-font"]&&(A=i.parseObjectValue(v["text-font"],_,"text-font",oi(pi)),!A))return null;let D=null;if(v["text-color"]&&(D=i.parseObjectValue(v["text-color"],_,"text-color",ie),!D))return null;const P=d[d.length-1];P.scale=S,P.font=A,P.textColor=D}else{const S=i.parse(e[_],_,Ce);if(!S)return null;const A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new mn(d)}evaluate(e){return new Rs(this.sections.map(i=>{const l=i.content.evaluate(e);return ko(Is(l),Sn)?new lc("",l,null,null,null):new lc(kl(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class oh{constructor(e,i,l,d){this._imageWarnHistory={},this.type=Sn,this.namePrimary=e,this.nameSecondary=i,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let l=1;const d=[];function m(){if(l<e.length){const v=i.parse(e[l],l++,pi);return v?(d.push({image:v,options:{}}),!0):(i.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(l<e.length){const S=e[l];if((v=S)===null||typeof v!="object"||Array.isArray(v))return!0;const A=S.params,D=S.iconset,P=i.concat(l);if(!A&&!D)return l++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const k={},N=P.concat(void 0,"params");for(const U in A){if(!U)return N.error("Image parameter name should be non-empty"),!1;const Z=N.concat(void 0,U).parse(A[U],void 0,ie,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;k[U]=Z}d[d.length-1].options.params=k}if(D){if(typeof D!="object"||D.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!D.id)return P.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=D}return l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!_())return;return new oh(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,i){const l={};if(i){for(const d in i)if(i[d])try{l[d]=i[d].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=so.build(i,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){const m=d.getPrimary().id;if(d.available=e.availableImages.some(_=>Vs.isEqual(_,m)),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=e.availableImages.some(v=>Vs.isEqual(v,_)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const l={};if(i&&(l.iconset={id:i}),e){l.params={};for(const d in e)e[d]&&(l.params[d]=e[d].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Ln(r){return ad(r)?"string":Rn(r)?"number":Sp(r)?"boolean":Array.isArray(r)?"array":r===null?"null":sd(r)?"object":typeof r}function sd(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function ad(r){return typeof r=="string"||r instanceof String}function Rn(r){return typeof r=="number"||r instanceof Number}function Sp(r){return typeof r=="boolean"||r instanceof Boolean}const Zm={"to-boolean":L,"to-color":ie,"to-number":gn,"to-string":pi};class cc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0],d=[];let m=va;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);m=oi(i.expectedType.itemType,_)}else{if(!(_>0&&vu(e[1][0])))return null;m=oi(Is(e[1][0]),_)}for(let v=0;v<_;v++){const S=e[1][v];let A;if(Array.isArray(S))A=i.parse(S,void 0,m.itemType);else{const D=Ln(S);if(D!==m.itemType.kind)return i.error(`Expected ${m.itemType.kind} but found ${D}.`);A=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!A)return null;d.push(A)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");m=Zm[l];for(let _=1;_<e.length;_++){const v=i.parse(e[_],_,Ce);if(!v)return null;d.push(v)}}return new cc(m,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const d of this.args){if(i=d.evaluate(e),l=null,i instanceof Si)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:$m(i[0],i[1],i[2],i[3]),!l))return new Si(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ts(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const d=Number(i);if(!isNaN(d))return d}throw new ts(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Rs.fromString(kl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?so.build(kl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):kl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new mn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new oh(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const __=["Unknown","Point","LineString","Polygon"];class od{constructor(e,i,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?__[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-e[0])+this.featureDistanceData.bearing[1]*(d*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Si.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ao{constructor(e,i,l,d,m){this.name=e,this.type=i,this._evaluate=l,this.args=d,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const i=ao.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],d=ao.definitions[l];if(!d)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[];let S=null,A=-1;for(const[D,P]of _){if(Array.isArray(D)&&D.length!==e.length-1)continue;v.push(D),A++,S=new Tf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const k=[];let N=!1;for(let U=1;U<e.length;U++){const Z=e[U],K=Array.isArray(D)?D[U-1]:D.type,X=S.parse(Z,1+k.length,K);if(!X){N=!0;break}k.push(X)}if(!N)if(Array.isArray(D)&&D.length!==k.length)S.error(`Expected ${D.length} arguments, but found ${k.length} instead.`);else{for(let U=0;U<k.length;U++){const Z=Array.isArray(D)?D[U]:D.type,K=k[U];S.concat(U+1).checkSubtype(Z,K.type)}if(S.errors.length===0)return new ao(l,m,P,k,A)}}if(v.length===1)i.errors.push(...S.errors);else{const D=(v.length?v:_.map(([k])=>k)).map(oo).join(" | "),P=[];for(let k=1;k<e.length;k++){const N=i.parse(e[k],1+P.length);if(!N)return null;P.push(Mi(N.type))}i.error(`Expected arguments of type ${D}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){ao.definitions=i;for(const l in i)e[l]=ao}}function oo(r){return Array.isArray(r)?`(${r.map(Mi).join(", ")})`:`(${Mi(r.type)}...)`}class Lo{constructor(e,i,l){this.type=Lt,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const d=l["case-sensitive"]===void 0?i.parse(!1,1,L):i.parseObjectValue(l["case-sensitive"],1,"case-sensitive",L);if(!d)return null;const m=l["diacritic-sensitive"]===void 0?i.parse(!1,1,L):i.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",L);if(!m)return null;let _=null;return l.locale&&(_=i.parseObjectValue(l.locale,1,"locale",pi),!_)?null:new Lo(d,m,_)}evaluate(e){return new Wo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function gf(r,e,i=0,l=r.length-1,d=Vc){for(;l>i;){if(l-i>600){const S=l-i+1,A=e-i+1,D=Math.log(S),P=.5*Math.exp(2*D/3),k=.5*Math.sqrt(D*P*(S-P)/S)*(A-S/2<0?-1:1);gf(r,e,Math.max(i,Math.floor(e-A*P/S+k)),Math.min(l,Math.floor(e+(S-A)*P/S+k)),d)}const m=r[e];let _=i,v=l;for(Yo(r,i,e),d(r[l],m)>0&&Yo(r,i,l);_<v;){for(Yo(r,_,v),_++,v--;d(r[_],m)<0;)_++;for(;d(r[v],m)>0;)v--}d(r[i],m)===0?Yo(r,i,v):(v++,Yo(r,v,l)),v<=e&&(i=v+1),e<=v&&(l=v-1)}}function Yo(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function Vc(r,e){return r<e?-1:r>e?1:0}function y_(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}function lh(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function _f(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function jc(r,e,i){const l=r[0]-e[0],d=r[1]-e[1],m=r[0]-i[0],_=r[1]-i[1];return l*_-m*d===0&&l*m<=0&&d*_<=0}function Ap(r,e,i){return e[1]>r[1]!=i[1]>r[1]&&r[0]<(i[0]-e[0])*(r[1]-e[1])/(i[1]-e[1])+e[0]}function Ha(r,e,i=!1){let l=!1;for(let d=0,m=e.length;d<m;d++){const _=e[d];for(let v=0,S=_.length,A=S-1;v<S;A=v++){const D=_[A],P=_[v];if(jc(r,D,P))return i;Ap(r,D,P)&&(l=!l)}}return l}function Ip(r,e,i,l){const d=l[0]-i[0],m=l[1]-i[1],_=(r[0]-i[0])*m-d*(r[1]-i[1]),v=(e[0]-i[0])*m-d*(e[1]-i[1]);return _>0&&v<0||_<0&&v>0}function yf(r,e,i,l){return(d=[l[0]-i[0],l[1]-i[1]])[0]*(m=[e[0]-r[0],e[1]-r[1]])[1]-d[1]*m[0]!==0&&!(!Ip(r,e,i,l)||!Ip(i,l,r,e));var d,m}function Ll(r){const e=new Mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of r[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),i.x<l.x&&(i.x=l.x),i.y<l.y&&(i.y=l.y);return{min:e,max:i}}const Ko=8192;function Wm(r,e){const i=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(i*d*Ko),Math.round(l*d*Ko)]}function Xm(r,e){for(let i=0;i<e.length;i++)if(Ha(r,e[i]))return!0;return!1}function ch(r,e,i){for(const l of i)for(let d=0,m=l.length,_=m-1;d<m;_=d++)if(yf(r,e,l[_],l[d]))return!0;return!1}function Cp(r,e){for(let i=0;i<r.length;++i)if(!Ha(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(ch(r[i],r[i+1],e))return!1;return!0}function x_(r,e){for(let i=0;i<e.length;i++)if(Cp(r,e[i]))return!0;return!1}function uc(r,e,i){const l=[];for(let d=0;d<r.length;d++){const m=[];for(let _=0;_<r[d].length;_++){const v=Wm(r[d][_],i);lh(e,v),m.push(v)}l.push(m)}return l}function v_(r,e,i){const l=[];for(let d=0;d<r.length;d++){const m=uc(r[d],e,i);l.push(m)}return l}function b_(r,e,i,l){if(r[0]<i[0]||r[0]>i[2]){const d=.5*l;let m=r[0]-i[0]>d?-l:i[0]-r[0]>d?l:0;m===0&&(m=r[0]-i[2]>d?-l:i[2]-r[0]>d?l:0),r[0]+=m}lh(e,r)}function Rp(r,e,i,l){const d=Math.pow(2,l.z)*Ko,m=[l.x*Ko,l.y*Ko],_=[];if(!r)return _;for(const v of r)for(const S of v){const A=[S.x+m[0],S.y+m[1]];b_(A,e,i,d),_.push(A)}return _}function Mp(r,e,i,l){const d=Math.pow(2,l.z)*Ko,m=[l.x*Ko,l.y*Ko],_=[];if(!r)return _;for(const S of r){const A=[];for(const D of S){const P=[D.x+m[0],D.y+m[1]];lh(e,P),A.push(P)}_.push(A)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of _)for(const A of S)b_(A,e,i,d)}var v;return _}class Uc{constructor(e,i){this.type=L,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(vu(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let d=0;d<l.features.length;++d){const m=l.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Uc(l,l.features[d].geometry)}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Uc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Uc(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=uc(l.coordinates,m,_),S=Rp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!Ha(A,v))return!1}if(l.type==="MultiPolygon"){const v=v_(l.coordinates,m,_),S=Rp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!Xm(A,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=uc(l.coordinates,m,_),S=Mp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!Cp(A,v))return!1}if(l.type==="MultiPolygon"){const v=v_(l.coordinates,m,_),S=Mp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!x_(A,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const $a={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qo=1/298.257223563,ld=Qo*(2-Qo),Ma=Math.PI/180;class zl{static fromTile(e,i,l){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),m=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Ma;return new zl(m,l)}static get units(){return $a}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!$a[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys($a).join(", ")}`);const l=6378.137*Ma*(i?$a[i]:1),d=Math.cos(e*Ma),m=1/(1-ld*(1-d*d)),_=Math.sqrt(m);this.kx=l*_*d,this.ky=l*_*m*(1-ld)}distance(e,i){const l=Za(e[0]-i[0])*this.kx,d=(e[1]-i[1])*this.ky;return Math.sqrt(l*l+d*d)}bearing(e,i){const l=Za(i[0]-e[0])*this.kx;return Math.atan2(l,(i[1]-e[1])*this.ky)/Ma}destination(e,i,l){const d=l*Ma;return this.offset(e,Math.sin(d)*i,Math.cos(d)*i)}offset(e,i,l){return[e[0]+i/this.kx,e[1]+l/this.ky]}lineDistance(e){let i=0;for(let l=0;l<e.length-1;l++)i+=this.distance(e[l],e[l+1]);return i}area(e){let i=0;for(let l=0;l<e.length;l++){const d=e[l];for(let m=0,_=d.length,v=_-1;m<_;v=m++)i+=Za(d[m][0]-d[v][0])*(d[m][1]+d[v][1])*(l?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let l=0;if(i<=0)return e[0];for(let d=0;d<e.length-1;d++){const m=e[d],_=e[d+1],v=this.distance(m,_);if(l+=v,l>i)return uh(m,_,(i-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,l){let[d,m]=i,_=Za(l[0]-d)*this.kx,v=(l[1]-m)*this.ky;if(_!==0||v!==0){const S=(Za(e[0]-d)*this.kx*_+(e[1]-m)*this.ky*v)/(_*_+v*v);S>1?(d=l[0],m=l[1]):S>0&&(d+=_/this.kx*S,m+=v/this.ky*S)}return _=Za(e[0]-d)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(e,i){let l=1/0,d=e[0][0],m=e[0][1],_=0,v=0;for(let S=0;S<e.length-1;S++){let A=e[S][0],D=e[S][1],P=Za(e[S+1][0]-A)*this.kx,k=(e[S+1][1]-D)*this.ky,N=0;P===0&&k===0||(N=(Za(i[0]-A)*this.kx*P+(i[1]-D)*this.ky*k)/(P*P+k*k),N>1?(A=e[S+1][0],D=e[S+1][1]):N>0&&(A+=P/this.kx*N,D+=k/this.ky*N)),P=Za(i[0]-A)*this.kx,k=(i[1]-D)*this.ky;const U=P*P+k*k;U<l&&(l=U,d=A,m=D,_=S,v=N)}return{point:[d,m],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,l){let d=this.pointOnLine(l,e),m=this.pointOnLine(l,i);if(d.index>m.index||d.index===m.index&&d.t>m.t){const A=d;d=m,m=A}const _=[d.point],v=d.index+1,S=m.index;!xf(l[v],_[0])&&v<=S&&_.push(l[v]);for(let A=v+1;A<=S;A++)_.push(l[A]);return xf(l[S],m.point)||_.push(m.point),_}lineSliceAlong(e,i,l){let d=0;const m=[];for(let _=0;_<l.length-1;_++){const v=l[_],S=l[_+1],A=this.distance(v,S);if(d+=A,d>e&&m.length===0&&m.push(uh(v,S,(e-(d-A))/A)),d>=i)return m.push(uh(v,S,(i-(d-A))/A)),m;d>e&&m.push(S)}return m}bufferPoint(e,i){const l=i/this.ky,d=i/this.kx;return[e[0]-d,e[1]-l,e[0]+d,e[1]+l]}bufferBBox(e,i){const l=i/this.ky,d=i/this.kx;return[e[0]-d,e[1]-l,e[2]+d,e[3]+l]}insideBBox(e,i){return Za(e[0]-i[0])>=0&&Za(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function xf(r,e){return r[0]===e[0]&&r[1]===e[1]}function uh(r,e,i){const l=Za(e[0]-r[0]);return[r[0]+l*i,r[1]+(e[1]-r[1])*i]}function Za(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class hh{constructor(e=[],i=(l,d)=>l<d?-1:l>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,d=i[e];for(;e>0;){const m=e-1>>1,_=i[m];if(l(d,_)>=0)break;i[e]=_,e=m}i[e]=d}_down(e){const{data:i,compare:l}=this,d=this.length>>1,m=i[e];for(;e<d;){let _=1+(e<<1);const v=_+1;if(v<this.length&&l(i[v],i[_])<0&&(_=v),l(i[_],m)>=0)break;i[e]=i[_],e=_}i[e]=m}}var jt=8192;function Dp(r,e){return e.dist-r.dist}function cd(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function hc(r){return r[1]-r[0]+1}function dc(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function lo(r,e){if(r[0]>r[1])return[null,null];const i=hc(r);if(e){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(i===1)return[r,null];const l=Math.floor(i/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function Gc(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!dc(e,r.length))return i;for(let l=e[0];l<=e[1];++l)lh(i,r[l]);return i}function co(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let l=0;l<r[i].length;++l)lh(e,r[i][l]);return e}function qc(r,e,i){if(cd(r)||cd(e))return NaN;let l=0,d=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(d=r[1]-e[3]),r[3]<e[1]&&(d=e[1]-r[3]),i.distance([0,0],[l,d])}function dh(r){return 360*r-180}function wu(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function ud(r,e){const i=Math.pow(2,e.z),l=(r.y/jt+e.y)/i;return[dh((r.x/jt+e.x)/i),wu(l)]}function w_(r,e){const i=[];for(let l=0;l<r.length;++l)i.push(ud(r[l],e));return i}function Pp(r,e,i){const l=i.pointOnLine(e,r).point;return i.distance(r,l)}function kp(r,e,i,l,d){const m=i.slice(l[0],l[1]+1);let _=1/0;for(let v=e[0];v<=e[1];++v)if((_=Math.min(_,Pp(r[v],m,d)))===0)return 0;return _}function oa(r,e,i,l,d){const m=Math.min(d.pointToSegmentDistance(r,i,l),d.pointToSegmentDistance(e,i,l)),_=Math.min(d.pointToSegmentDistance(i,r,e),d.pointToSegmentDistance(l,r,e));return Math.min(m,_)}function si(r,e,i,l,d){if(!dc(e,r.length)||!dc(l,i.length))return NaN;let m=1/0;for(let _=e[0];_<e[1];++_)for(let v=l[0];v<l[1];++v){if(yf(r[_],r[_+1],i[v],i[v+1]))return 0;m=Math.min(m,oa(r[_],r[_+1],i[v],i[v+1],d))}return m}function hd(r,e,i,l,d){if(!dc(e,r.length)||!dc(l,i.length))return NaN;let m=1/0;for(let _=e[0];_<=e[1];++_)for(let v=l[0];v<=l[1];++v)if((m=Math.min(m,d.distance(r[_],i[v])))===0)return m;return m}function Lp(r,e,i){if(Ha(r,e,!0))return 0;let l=1/0;for(const d of e){const m=d.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[m-1]&&(l=Math.min(l,i.pointToSegmentDistance(r,d[m-1],d[0])))===0||(l=Math.min(l,Pp(r,d,i)))===0)return l}return l}function vf(r,e,i,l){if(!dc(e,r.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Ha(r[m],i,!0))return 0;let d=1/0;for(let m=e[0];m<e[1];++m)for(const _ of i)for(let v=0,S=_.length,A=S-1;v<S;A=v++){if(yf(r[m],r[m+1],_[A],_[v]))return 0;d=Math.min(d,oa(r[m],r[m+1],_[A],_[v],l))}return d}function zo(r,e){for(const i of r)for(let l=0;l<=i.length-1;++l)if(Ha(i[l],e,!0))return!0;return!1}function ml(r,e,i,l=1/0){const d=co(r),m=co(e);if(l!==1/0&&qc(d,m,i)>=l)return l;if(_f(d,m)){if(zo(r,e))return 0}else if(zo(e,r))return 0;let _=l;for(const v of r)for(let S=0,A=v.length,D=A-1;S<A;D=S++)for(const P of e)for(let k=0,N=P.length,U=N-1;k<N;U=k++){if(yf(v[D],v[S],P[U],P[k]))return 0;_=Math.min(_,oa(v[D],v[S],P[U],P[k],i))}return _}function Hi(r,e,i,l,d,m,_){if(m===null||_===null)return;const v=qc(Gc(l,m),Gc(d,_),i);v<e&&r.push({dist:v,range1:m,range2:_})}function fc(r,e,i,l,d=1/0){let m=Math.min(l.distance(r[0],i[0][0]),d);if(m===0)return m;const _=new hh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Dp),v=e?50:100,S=co(i);for(;_.length;){const A=_.pop();if(A.dist>=m)continue;const D=A.range1;if(hc(D)<=v){if(!dc(D,r.length))return NaN;if(e){const P=vf(r,D,i,l);if((m=Math.min(m,P))===0)return m}else for(let P=D[0];P<=D[1];++P){const k=Lp(r[P],i,l);if((m=Math.min(m,k))===0)return m}}else{const P=lo(D,e);if(P[0]!==null){const k=qc(Gc(r,P[0]),S,l);k<m&&_.push({dist:k,range1:P[0],range2:[0,0]})}if(P[1]!==null){const k=qc(Gc(r,P[1]),S,l);k<m&&_.push({dist:k,range1:P[1],range2:[0,0]})}}}return m}function Ol(r,e,i,l,d,m=1/0){let _=Math.min(m,d.distance(r[0],i[0]));if(_===0)return _;const v=new hh([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Dp),S=e?50:100,A=l?50:100;for(;v.length;){const D=v.pop();if(D.dist>=_)continue;const P=D.range1,k=D.range2;if(hc(P)<=S&&hc(k)<=A){if(!dc(P,r.length)||!dc(k,i.length))return NaN;if(e&&l?_=Math.min(_,si(r,P,i,k,d)):e||l?e&&!l?_=Math.min(_,kp(i,k,r,P,d)):!e&&l&&(_=Math.min(_,kp(r,P,i,k,d))):_=Math.min(_,hd(r,P,i,k,d)),_===0)return _}else{const N=lo(P,e),U=lo(k,l);Hi(v,_,d,r,i,N[0],U[0]),Hi(v,_,d,r,i,N[0],U[1]),Hi(v,_,d,r,i,N[1],U[0]),Hi(v,_,d,r,i,N[1],U[1])}}return _}function Nl(r,e,i,l,d=1/0){let m=d;const _=Gc(r,[0,r.length-1]);for(const v of i)if(!(m!==1/0&&qc(_,Gc(v,[0,v.length-1]),l)>=m)&&(m=Math.min(m,Ol(r,e,v,!0,l,m)),m===0))return m;return m}function bf(r,e,i,l,d=1/0){let m=d;const _=Gc(r,[0,r.length-1]);for(const v of i){if(m!==1/0&&qc(_,co(v),l)>=m)continue;const S=fc(r,e,v,l,m);if(isNaN(S))return S;if((m=Math.min(m,S))===0)return m}return m}function wf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Hc{constructor(e,i){this.type=gn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(vu(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let d=0;d<l.features.length;++d)if(wf(l.features[d].geometry.type))return new Hc(l,l.features[d].geometry)}else if(l.type==="Feature"){if(wf(l.geometry.type))return new Hc(l,l.geometry)}else if(wf(l.type))return new Hc(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),l=e.canonicalID();if(i!=null&&l!=null){if(e.geometryType()==="Point")return(function(d,m,_){const v=[];for(const A of d)for(const D of A)v.push(ud(D,m));const S=new zl(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Ol(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S):_.type==="MultiLineString"?Nl(v,!1,_.coordinates,S):_.type==="Polygon"||_.type==="MultiPolygon"?bf(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,S):null})(i,l,this.geometries);if(e.geometryType()==="LineString")return(function(d,m,_){const v=[];for(const A of d){const D=[];for(const P of A)D.push(ud(P,m));v.push(D)}const S=new zl(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Nl(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let A=1/0;for(let D=0;D<_.coordinates.length;D++){const P=Nl(_.coordinates[D],!0,v,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(_.type==="Polygon"||_.type==="MultiPolygon"){let A=1/0;for(let D=0;D<v.length;D++){const P=bf(v[D],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null})(i,l,this.geometries);if(e.geometryType()==="Polygon")return(function(d,m,_){const v=[];for(const A of(function(D){const P=D.length;if(P<=1)return[D];const k=[];let N,U;for(let Z=0;Z<P;Z++){const K=y_(D[Z]);K!==0&&(D[Z].area=Math.abs(K),U===void 0&&(U=K<0),U===K<0?(N&&k.push(N),N=[D[Z]]):N.push(D[Z]))}return N&&k.push(N),k})(d)){const D=[];for(let P=0;P<A.length;++P)D.push(w_(A[P],m));v.push(D)}const S=new zl(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return bf(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let A=1/0;for(let D=0;D<_.coordinates.length;D++){const P=bf(_.coordinates[D],!0,v,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(A,D,P){let k=1/0;for(const N of A)for(const U of D){const Z=ml(N,U,P,k);if(isNaN(Z))return Z;if((k=Math.min(k,Z))===0)return k}return k})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,S):null})(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fh(r){if(r instanceof ao&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Uc||r instanceof Hc)return!1;if(r instanceof Tu)return r.featureConstant;let e=!0;return r.eachChild(i=>{e&&!fh(i)&&(e=!1)}),e}function js(r){if(r instanceof ao&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!js(i)&&(e=!1)}),e}function Gr(r,e){if(r instanceof ao&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(l=>{i&&!Gr(l,e)&&(i=!1)}),i}function pr(r,e,i){return[r,e,i].filter(Boolean).join("")}function pc(r,e){switch(r){case"string":return kl(e);case"number":return+e;case"boolean":return!!e;case"color":return Si.parse(e);case"formatted":return Rs.fromString(kl(e));case"resolvedImage":return so.build(kl(e))}return e}function Jo(r,e,i,l){return l!==void 0&&(r=l*Math.round(r/l)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Tu{constructor(e,i,l,d=!1){this.type=e,this.key=i,this.scope=l,this.featureConstant=d}static parse(e,i){let l=i.expectedType;if(l==null&&(l=Ce),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const d=i.parse(e[1],1);if(!(d instanceof Xo))return i.error("Key name of 'config' expression must be a string literal.");let m,_=!0;const v=kl(d.value);if(e.length>=3){const S=i.parse(e[2],2);if(!(S instanceof Xo))return i.error("Scope of 'config' expression must be a string literal.");m=kl(S.value)}if(i.options){const S=pr(v,m,i._scope),A=i.options.get(S);A&&(_=fh(A.value||A.default))}return new Tu(l,v,m,_)}evaluate(e){const i=pr(this.key,this.scope,e.scope),l=e.getConfig(i);if(!l)return null;const{type:d,value:m,values:_,minValue:v,maxValue:S,stepValue:A}=l,D=l.default.evaluate(e);let P=D;if(m){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),P=m.evaluate(e),e.scope=k}return d&&(P=pc(d,P)),P===void 0||v===void 0&&S===void 0&&A===void 0||(typeof P=="number"?P=Jo(P,v,S,A):Array.isArray(P)&&(P=P.map(k=>typeof k=="number"?Jo(k,v,S,A):k))),m!==void 0&&P!==void 0&&_&&!_.includes(P)&&(P=D,d&&(P=pc(d,P))),(d&&d!==this.type||P!==void 0&&!ko(Is(P),this.type))&&(P=pc(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Bl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Bl(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tf{constructor(e,i=[],l,d=new xa,m=[],_,v,S){this.registry=e,this.path=i,this.key=i.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=d,this.errors=m,this.expectedType=l,this._scope=_,this.options=v,this.iconImageUseTheme=S}parse(e,i,l,d,m={}){return i||l?this.concat(i,null,l,d)._parse(e,m):this._parse(e,m)}parseObjectValue(e,i,l,d,m,_={}){return this.concat(i,l,d,m)._parse(e,_)}_parse(e,i){function l(d,m,_){return _==="assert"?new zn(m,[d]):_==="coerce"?new cc(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,v=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else m=l(m,_,i.typeAnnotation||"coerce");else m=l(m,_,i.typeAnnotation||"assert")}if(!(m instanceof Xo)&&m.type.kind!=="resolvedImage"&&zp(m)){const _=new od(this._scope,this.options,this.iconImageUseTheme);try{m=new Xo(m.type,m.evaluate(_))}catch(v){return this.error(v.message),null}}return m}return cc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l,d){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof i=="string"?m.concat(i):m;const _=d?this.scope.concat(d):this.scope;return new Tf(this.registry,m,l||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const l=`${this.key}${i.map(d=>`[${d}]`).join("")}`;this.errors.push(new As(l,e))}checkSubtype(e,i){const l=Kr(e,i);return l&&this.error(l),l}}function zp(r){if(r instanceof Bl)return zp(r.boundExpression);if(r instanceof ao&&r.name==="error"||r instanceof Lo||r instanceof Uc||r instanceof Hc||r instanceof Tu)return!1;const e=r instanceof cc||r instanceof zn;let i=!0;return r.eachChild(l=>{i=e?i&&zp(l):i&&l instanceof Xo}),!!i&&fh(r)&&Gr(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function $c(r,e){const i=r.length-1;let l,d,m=0,_=i,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),l=r[v],d=r[v+1],l<=e){if(v===i||e<d)return v;m=v+1}else{if(!(l>e))throw new ts("Input is not a number.");_=v-1}return 0}class Fl{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[d,m]of l)this.labels.push(d),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,gn);if(!l)return null;const d=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],S=e[_+1],A=_,D=_+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(d.length&&d[d.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=i.parse(S,D,m);if(!P)return null;m=m||P.type,d.push([v,P])}return new Fl(m,l,d)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return l[0].evaluate(e);const m=i.length;return d>=i[m-1]?l[m-1].evaluate(e):l[$c(i,d)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Op=.95047,dd=1.08883,Np=4/29,gl=6/29,mc=3*gl*gl,Eu=gl*gl*gl,Zc=Math.PI/180,Ym=180/Math.PI;function Ef(r){return r>Eu?Math.pow(r,1/3):r/mc+Np}function Su(r){return r>gl?r*r*r:mc*(r-Np)}function fd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Wc(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ba(r){const e=Wc(r.r),i=Wc(r.g),l=Wc(r.b),d=Ef((.4124564*e+.3575761*i+.1804375*l)/Op),m=Ef((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Ef((.0193339*e+.119192*i+.9503041*l)/dd)),alpha:r.a}}function ph(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*Su(e),i=Op*Su(i),l=dd*Su(l),new Si(fd(3.2404542*i-1.5371385*e-.4985314*l),fd(-.969266*i+1.8760108*e+.041556*l),fd(.0556434*i-.2040259*e+1.0572252*l),r.alpha)}function Sf(r,e,i){const l=e-r;return r+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const pd={forward:ba,reverse:ph,interpolate:function(r,e,i){return{l:Cn(r.l,e.l,i),a:Cn(r.a,e.a,i),b:Cn(r.b,e.b,i),alpha:Cn(r.alpha,e.alpha,i)}}},Af={forward:function(r){const{l:e,a:i,b:l}=ba(r),d=Math.atan2(l,i)*Ym;return{h:d<0?d+360:d,c:Math.sqrt(i*i+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Zc,i=r.c;return ph({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Sf(r.h,e.h,i),c:Cn(r.c,e.c,i),l:Cn(r.l,e.l,i),alpha:Cn(r.alpha,e.alpha,i)}}};var T_=Object.freeze({__proto__:null,hcl:Af,lab:pd});class Ar{constructor(e,i,l,d,m){this.type=e,this.operator=i,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,i,l,d){let m=0;if(e.name==="exponential")m=md(i,e.base,l,d);else if(e.name==="linear")m=md(i,1,l,d);else if(e.name==="cubic-bezier"){const _=e.controlPoints;m=new hl(_[0],_[1],_[2],_[3]).solve(md(i,1,l,d))}return m}static parse(e,i){let[l,d,m,..._]=e;if(!Array.isArray(d)||d.length===0)return i.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const A=d[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const A=d.slice(1);if(A.length!==4||A.some(D=>typeof D!="number"||D<0||D>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,gn),!m)return null;const v=[];let S=null;l==="interpolate-hcl"||l==="interpolate-lab"?S=ie:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let A=0;A<_.length;A+=2){const D=_[A],P=_[A+1],k=A+3,N=A+4;if(typeof D!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=D)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const U=i.parse(P,N,S);if(!U)return null;S=S||U.type,v.push([D,U])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Ar(S,l,d,m,v):i.error(`Type ${Mi(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return l[0].evaluate(e);const m=i.length;if(d>=i[m-1])return l[m-1].evaluate(e);const _=$c(i,d),v=Ar.interpolationFactor(this.interpolation,d,i[_],i[_+1]),S=l[_].evaluate(e),A=l[_+1].evaluate(e);return this.operator==="interpolate"?oc[this.type.kind.toLowerCase()](S,A,v):this.operator==="interpolate-hcl"?Af.reverse(Af.interpolate(Af.forward(S),Af.forward(A),v)):pd.reverse(pd.interpolate(pd.forward(S),pd.forward(A),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function md(r,e,i,l){const d=l-i,m=r-i;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Xc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const d=i.expectedType;d&&d.kind!=="value"&&(l=d);const m=[];for(const v of e.slice(1)){const S=i.parse(v,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,m.push(S)}const _=d&&m.some(v=>Kr(d,v.type));return new Xc(_?Ce:l,m)}evaluate(e){let i,l=null,d=0;for(const m of this.args){if(d++,l=m.evaluate(e),l&&l instanceof so&&!l.available&&(i||(i=l),l=null,d===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class el{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=i.parse(e[m+1],m+1);if(!v)return null;l.push([_,v])}const d=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return d?new el(l,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}class gd{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,gn),d=i.parse(e[2],2,oi(i.expectedType||Ce));return l&&d?new gd(d.type.itemType,l,d):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ts("Array index out of bounds: negative index");if(i>=l.length)throw new ts("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new ts("Array index must be an integer. Use at-interpolated for fractional indices");return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yc{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,gn),d=i.parse(e[2],2,oi(i.expectedType||Ce));return l&&d?new Yc(d.type.itemType,l,d):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ts(`Array index out of bounds: ${i} < 0.`);if(i>l.length-1)throw new ts(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i===Math.floor(i))return l[i];const d=Math.floor(i),m=Math.ceil(i),_=l[d],v=l[m];if(typeof _!="number"||typeof v!="number")throw new ts(`Cannot interpolate between non-number values at index ${i}.`);const S=i-d;return _*(1-S)+v*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Au{constructor(e,i){this.type=L,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,Ce);return l&&d?Do(l.type,[L,pi,gn,va,Ce])?new Au(l,d):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mi(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Po(i,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${Mi(Is(i))} instead.`);if(!Po(l,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${Mi(Is(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class _d{constructor(e,i,l){this.type=gn,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,Ce);if(!l||!d)return null;if(!Do(l.type,[L,pi,gn,va,Ce]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mi(l.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,gn);return m?new _d(l,d,m):null}return new _d(l,d)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Po(i,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${Mi(Is(i))} instead.`);if(!Po(l,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${Mi(Is(l))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return l.indexOf(i,d)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class yd{constructor(e,i,l,d,m,_){this.inputType=e,this.type=i,this.input=l,this.cases=d,this.outputs=m,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,d;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);const m={},_=[];for(let A=2;A<e.length-1;A+=2){let D=e[A];const P=e[A+1];Array.isArray(D)||(D=[D]);const k=i.concat(A);if(D.length===0)return k.error("Expected at least one branch label.");for(const U of D){if(typeof U!="number"&&typeof U!="string")return k.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return k.error("Numeric branch labels must be integer values.");if(l){if(k.checkSubtype(l,Is(U)))return null}else l=Is(U);if(m[String(U)]!==void 0)return k.error("Branch labels must be unique.");m[String(U)]=_.length}const N=i.parse(P,A,d);if(!N)return null;d=d||N.type,_.push(N)}const v=i.parse(e[1],1,Ce);if(!v)return null;const S=i.parse(e[e.length-1],e.length-1,d);return S?v.type.kind!=="value"&&i.concat(1).checkSubtype(l,v.type)?null:new yd(l,d,v,m,_,S):null}evaluate(e){const i=this.input.evaluate(e);return(ko(Is(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],d={};for(const _ of i){const v=d[this.cases[_]];v===void 0?(d[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of l)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class If{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const v=i.parse(e[_],_,L);if(!v)return null;const S=i.parse(e[_+1],_+1,l);if(!S)return null;d.push([v,S]),l=l||S.type}const m=i.parse(e[e.length-1],e.length-1,l);return m?new If(l,d,m):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Cf{constructor(e,i,l,d){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=d}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,gn);if(!l||!d)return null;if(!Do(l.type,[oi(Ce),pi,Ce]))return i.error(`Expected first argument to be of type array or string, but found ${Mi(l.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,gn);return m?new Cf(l.type,l,d,m):null}return new Cf(l.type,l,d)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Po(i,["string","array"]))throw new ts(`Expected first argument to be of type array or string, but found ${Mi(Is(i))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return i.slice(l,d)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Kc{constructor(e,i){this.type=oi(pi),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,pi),d=i.parse(e[2],2,pi);return l&&d?new Kc(l,d):void 0}evaluate(e){const i=this.str.evaluate(e),l=this.delimiter.evaluate(e);return i.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Rf(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function xd(r,e,i,l){return l.compare(e,i)===0}function mh(r,e,i){const l=r!=="=="&&r!=="!=";return class $L{constructor(m,_,v){this.type=L,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const v=m[0];let S=_.parse(m[1],1,Ce);if(!S)return null;if(!Rf(v,S.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Mi(S.type)}'.`);let A=_.parse(m[2],2,Ce);if(!A)return null;if(!Rf(v,A.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Mi(A.type)}'.`);if(S.type.kind!==A.type.kind&&S.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${Mi(S.type)}' and '${Mi(A.type)}'.`);l&&(S.type.kind==="value"&&A.type.kind!=="value"?S=new zn(A.type,[S]):S.type.kind!=="value"&&A.type.kind==="value"&&(A=new zn(S.type,[A])));let D=null;if(m.length===4){if(S.type.kind!=="string"&&A.type.kind!=="string"&&S.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(D=_.parse(m[3],3,Lt),!D)return null}return new $L(S,A,D)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const S=Is(_),A=Is(v);if(S.kind!==A.kind||S.kind!=="string"&&S.kind!=="number")throw new ts(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=Is(_),A=Is(v);if(S.kind!=="string"||A.kind!=="string")return e(m,_,v)}return this.collator?i(m,_,v,this.collator.evaluate(m)):e(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const vd=mh("==",function(r,e,i){return e===i},xd),Km=mh("!=",function(r,e,i){return e!==i},function(r,e,i,l){return!xd(0,e,i,l)}),Mf=mh("<",function(r,e,i){return e<i},function(r,e,i,l){return l.compare(e,i)<0}),Df=mh(">",function(r,e,i){return e>i},function(r,e,i,l){return l.compare(e,i)>0}),Pf=mh("<=",function(r,e,i){return e<=i},function(r,e,i,l){return l.compare(e,i)<=0}),E_=mh(">=",function(r,e,i){return e>=i},function(r,e,i,l){return l.compare(e,i)>=0});class gc{constructor(e,i,l,d,m,_){this.type=pi,this.number=e,this.locale=i,this.currency=l,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,gn);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return i.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=i.parseObjectValue(d.locale,2,"locale",pi),!m))return null;let _=null;if(d.currency&&(_=i.parseObjectValue(d.currency,2,"currency",pi),!_))return null;let v=null;if(d.unit&&(v=i.parseObjectValue(d.unit,2,"unit",pi),!v))return null;let S=null;if(d["min-fraction-digits"]&&(S=i.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",gn),!S))return null;let A=null;return d["max-fraction-digits"]&&(A=i.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",gn),!A)?null:new gc(l,m,_,v,S,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Qc{constructor(e){this.type=gn,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Mi(l.type)} instead.`):new Qc(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ts(`Expected value to be of type string or array, but found ${Mi(Is(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Qm(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Iu={"==":vd,"!=":Km,">":Df,"<":Mf,">=":E_,"<=":Pf,array:zn,at:gd,"at-interpolated":Yc,boolean:zn,case:If,coalesce:Xc,collator:Lo,format:mn,image:oh,in:Au,"index-of":_d,interpolate:Ar,"interpolate-hcl":Ar,"interpolate-lab":Ar,length:Qc,let:el,literal:Xo,match:yd,number:zn,"number-format":gc,object:zn,slice:Cf,step:Fl,string:zn,"to-boolean":cc,"to-color":cc,"to-number":cc,"to-string":cc,var:Bl,within:Uc,distance:Hc,config:Tu,split:Kc};function Cu(r,[e,i,l,d]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const m=d?d.evaluate(r):1,_=$m(e,i,l,m);if(_)throw new ts(_);return new Si(e/255,i/255,l/255,m)}function bd(r,[e,i,l,d]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const m=d?d.evaluate(r):1,_=(function(A,D,P,k){return typeof A=="number"&&A>=0&&A<=360?typeof D=="number"&&D>=0&&D<=100&&typeof P=="number"&&P>=0&&P<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[A,D,P,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[A,D,P,k]:[A,D,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[A,D,P,k]:[A,D,P]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,l,m);if(_)throw new ts(_);const v=`hsla(${e}, ${i}%, ${l}%, ${m})`,S=Si.parse(v);if(!S)throw new ts(`Failed to parse HSLA color: ${v}`);return S}function kf(r,e){return r in e}function gh(r,e){const i=e[r];return i===void 0?null:i}function Vl(r){return{type:r}}function Ru(r){if(r instanceof Tu)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...Ru(i)])}),e}function _c(r){if(r instanceof ao&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild(i=>{!e&&_c(i)&&(e=!0)}),e}function Jm(r){return{result:"success",value:r}}function uo(r){return{result:"error",value:r}}function Lf(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function wd(r){return r["property-type"]==="data-driven"}function yc(r){return Lf(r.expression,"measure-light")}function Jc(r){return Lf(r.expression,"zoom")}function _h(r){return!!r.expression&&r.expression.interpolated}function Td(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Bp(r){return r}function yh(r,e){const i=e.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",d=l||!(l||r.property!==void 0),m=r.type||(_h(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],Si.parse(A[1])])),r.default=Si.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!T_[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,v,S;if(m==="exponential")_=vh;else if(m==="interval")_=S_;else if(m==="categorical"){_=xh,v=Object.create(null);for(const A of r.stops)v[A[0]]=A[1];S=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Fp}if(l){const A={},D=[];for(let N=0;N<r.stops.length;N++){const U=r.stops[N],Z=U[0].zoom;A[Z]===void 0&&(A[Z]={zoom:Z,type:r.type,property:r.property,default:r.default,stops:[]},D.push(Z)),A[Z].stops.push([U[0].value,U[1]])}const P=[];for(const N of D)P.push([A[N].zoom,yh(A[N],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ar.interpolationFactor.bind(void 0,k),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},U)=>vh({stops:P,base:r.base},e,N).evaluate(N,U)}}if(d){const A=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ar.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(D=>D[0]),evaluate:({zoom:D})=>_(r,e,D,v,S)}}return{kind:"source",evaluate(A,D){const P=D&&D.properties?D.properties[r.property]:void 0;return P===void 0?eu(r.default,e.default):_(r,e,P,v,S)}}}function eu(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function xh(r,e,i,l,d){return eu(typeof i===d?l[i]:void 0,r.default,e.default)}function S_(r,e,i){if(!Rn(i))return eu(r.default,e.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const d=$c(r.stops.map(m=>m[0]),i);return r.stops[d][1]}function vh(r,e,i){const l=r.base!==void 0?r.base:1;if(!Rn(i))return eu(r.default,e.default);const d=r.stops.length;if(d===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[d-1][0])return r.stops[d-1][1];const m=$c(r.stops.map(D=>D[0]),i),_=(function(D,P,k,N){const U=N-k,Z=D-k;return U===0?0:P===1?Z/U:(Math.pow(P,Z)-1)/(Math.pow(P,U)-1)})(i,l,r.stops[m][0],r.stops[m+1][0]),v=r.stops[m][1],S=r.stops[m+1][1];let A=oc[e.type]||Bp;if(r.colorSpace&&r.colorSpace!=="rgb"){const D=T_[r.colorSpace];A=(P,k)=>D.reverse(D.interpolate(D.forward(P),D.forward(k),_))}return typeof v.evaluate=="function"?{evaluate(...D){const P=v.evaluate.apply(void 0,D),k=S.evaluate.apply(void 0,D);if(P!==void 0&&k!==void 0)return A(P,k,_)}}:A(v,S,_)}function Fp(r,e,i){return e.type==="color"?i=Si.parse(i):e.type==="formatted"?i=Rs.fromString(i.toString()):e.type==="resolvedImage"?i=so.build(i.toString()):Ln(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),eu(i,r.default,e.default)}ao.register(Iu,{error:[{kind:"error"},[pi],(r,[e])=>{throw new ts(e.evaluate(r))}],typeof:[pi,[Ce],(r,[e])=>Mi(Is(e.evaluate(r)))],"to-rgba":[oi(gn,4),[ie],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[oi(gn,4),[ie],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ie,[gn,gn,gn],Cu],rgba:[ie,[gn,gn,gn,gn],Cu],hsl:[ie,[gn,gn,gn],bd],hsla:[ie,[gn,gn,gn,gn],bd],has:{type:L,overloads:[[[pi],(r,[e])=>kf(e.evaluate(r),r.properties())],[[pi,de],(r,[e,i])=>kf(e.evaluate(r),i.evaluate(r))]]},get:{type:Ce,overloads:[[[pi],(r,[e])=>gh(e.evaluate(r),r.properties())],[[pi,de],(r,[e,i])=>gh(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Ce,[pi],(r,[e])=>gh(e.evaluate(r),r.featureState||{})],properties:[de,[],r=>r.properties()],"geometry-type":[pi,[],r=>r.geometryType()],worldview:[pi,[],r=>r.globals.worldview||""],"is-active-floor":[L,Vl(pi),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some(l=>{const d=l.evaluate(r);return i.has(d)})}],id:[Ce,[],r=>r.id()],zoom:[gn,[],r=>r.globals.zoom],pitch:[gn,[],r=>r.globals.pitch||0],"distance-from-center":[gn,[],r=>r.distanceFromCenter()],"measure-light":[gn,[pi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[gn,[],r=>r.globals.heatmapDensity||0],"line-progress":[gn,[],r=>r.globals.lineProgress||0],"raster-value":[gn,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[gn,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[gn,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ce,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[gn,Vl(gn),(r,e)=>{let i=0;for(const l of e)i+=l.evaluate(r);return i}],"*":[gn,Vl(gn),(r,e)=>{let i=1;for(const l of e)i*=l.evaluate(r);return i}],"-":{type:gn,overloads:[[[gn,gn],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[gn],(r,[e])=>-e.evaluate(r)]]},"/":[gn,[gn,gn],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[gn,[gn,gn],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[gn,[],()=>Math.LN2],pi:[gn,[],()=>Math.PI],e:[gn,[],()=>Math.E],"^":[gn,[gn,gn],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[gn,[gn],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[gn,[gn],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[gn,[gn],(r,[e])=>Math.log(e.evaluate(r))],log2:[gn,[gn],(r,[e])=>Math.log2(e.evaluate(r))],sin:[gn,[gn],(r,[e])=>Math.sin(e.evaluate(r))],cos:[gn,[gn],(r,[e])=>Math.cos(e.evaluate(r))],tan:[gn,[gn],(r,[e])=>Math.tan(e.evaluate(r))],asin:[gn,[gn],(r,[e])=>Math.asin(e.evaluate(r))],acos:[gn,[gn],(r,[e])=>Math.acos(e.evaluate(r))],atan:[gn,[gn],(r,[e])=>Math.atan(e.evaluate(r))],min:[gn,Vl(gn),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[gn,Vl(gn),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[gn,[gn],(r,[e])=>Math.abs(e.evaluate(r))],round:[gn,[gn],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[gn,[gn],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[gn,[gn],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[L,[pi,Ce],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[L,[Ce],(r,[e])=>r.id()===e.value],"filter-type-==":[L,[pi],(r,[e])=>r.geometryType()===e.value],"filter-<":[L,[pi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l<d}],"filter-id-<":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[L,[pi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l>d}],"filter-id->":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[L,[pi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[L,[pi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[L,[Ce],(r,[e])=>e.value in r.properties()],"filter-has-id":[L,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[L,[oi(pi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[L,[oi(Ce)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[L,[pi,oi(Ce)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[L,[pi,oi(Ce)],(r,[e,i])=>(function(l,d,m,_){for(;m<=_;){const v=m+_>>1;if(d[v]===l)return!0;d[v]>l?_=v-1:m=v+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:L,overloads:[[[L,L],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Vl(L),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:L,overloads:[[[L,L],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Vl(L),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[L,[L],(r,[e])=>!e.evaluate(r)],"is-supported-script":[L,[pi],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[pi,[pi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[pi,[pi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[pi,Vl(Ce),(r,e)=>e.map(i=>kl(i.evaluate(r))).join("")],"resolved-locale":[pi,[Lt],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[gn,[gn,gn,Ce],(r,e)=>{const[i,l,d]=e.map(_=>_.evaluate(r));if(i>l||i===l)return i;let m;if(typeof d=="string")m=(function(_){let v=0;if(_.length===0)return v;for(let S=0;S<_.length;S++)v=(v<<5)-v+_.charCodeAt(S),v&=v;return v})(d);else{if(typeof d!="number")throw new ts(`Invalid seed input: ${d}`);m=d}return i+Qm(m)()*(l-i)}]});class zf{constructor(e,i,l,d,m){this.expression=e,this._warningHistory={},this._scope=l,this._options=d,this._iconImageUseTheme=m,this._evaluator=new od(l,d,m),this._defaultValue=i?(function(_){return _.type==="color"&&(Td(_.default)||Array.isArray(_.default))?new Si(0,0,0,0):_.type==="color"?Si.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Ru(e),this.isIndoorDependent=_c(e)}evaluateWithoutErrorHandling(e,i,l,d,m,_,v,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,d,m,_,v,S,A){this._evaluator||(this._evaluator=new od(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=A||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new ts(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){const P=D;return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function bh(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Iu}function xc(r,e,i,l,d){const m=new Tf(Iu,[],e?(function(v){const S={color:ie,string:pi,number:gn,enum:pi,boolean:L,formatted:Gt,resolvedImage:Sn};return v.type==="array"?oi(S[v.value]||Ce,v.length):S[v.type]})(e):void 0,void 0,void 0,i,l,d),_=m.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Jm(new zf(_,e,i,l,d)):uo(m.errors)}class Da{constructor(e,i,l,d){this.kind=e,this._styleExpression=i,this.isLightConstant=l,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!js(i.expression),this.configDependencies=Ru(i.expression),this.isIndoorDependent=_c(i.expression)}evaluateWithoutErrorHandling(e,i,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,d,m,_)}evaluate(e,i,l,d,m,_,v){return this._styleExpression.evaluate(e,i,l,d,m,_,void 0,void 0,v)}}class wa{constructor(e,i,l,d,m,_){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!js(i.expression),this.isIndoorDependent=_c(i.expression),this.isLightConstant=m,this.isLineProgressConstant=_,this.configDependencies=Ru(i.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,i,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,d,m,_)}evaluate(e,i,l,d,m,_){return this._styleExpression.evaluate(e,i,l,d,m,_)}interpolationFactor(e,i,l){return this.interpolationType?Ar.interpolationFactor(this.interpolationType,e,i,l):0}}function jl(r,e,i,l,d){if((r=xc(r,e,i,l,d)).result==="error")return r;const m=r.value.expression,_=fh(m);if(!_&&!wd(e))return uo([new As("","data expressions not supported")]);const v=Gr(m,["zoom","pitch","distance-from-center"]);if(!v&&!Jc(e))return uo([new As("","zoom expressions not supported")]);const S=Gr(m,["measure-light"]);if(!S&&!yc(e))return uo([new As("","measure-light expression not supported")]);const A=Gr(m,["line-progress"]);if(!A&&!(function(k){return Lf(k.expression,"line-progress")})(e))return uo([new As("","line-progress expression not supported")]);const D=e.expression&&e.expression.relaxZoomRestriction,P=Of(m);return P||v||D?P instanceof As?uo([P]):P instanceof Ar&&!_h(e)?uo([new As("",'"interpolate" expressions cannot be used with this property')]):Jm(P?new wa(_&&A?"camera":"composite",r.value,P.labels,P instanceof Ar?P.interpolation:void 0,S,A):new Da(_&&A?"constant":"source",r.value,S,A)):uo([new As("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class wh{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,yh(this._parameters,this._specification))}static deserialize(e){return new wh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Of(r){let e=null;if(r instanceof el)e=Of(r.result);else if(r instanceof Xc){for(const i of r.args)if(e=Of(i),e)break}else(r instanceof Fl||r instanceof Ar)&&r.input instanceof ao&&r.input.name==="zoom"&&(e=r);return e instanceof As||r.eachChild(i=>{const l=Of(i);l instanceof As?e=l:e&&l&&e!==l&&(e=new As("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Pa,Oo,Us=(function(){if(Oo)return Pa;Oo=1,Pa=e;var r=3;function e(i,l,d){var m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(l=_[1])+2*(d=_[2]);for(var v=0;v<this.d*this.d;v++){var S=_[r+v],A=_[r+v+1];m.push(S===A?null:_.subarray(S,A))}var D=_[r+m.length+1];this.keys=_.subarray(_[r+m.length],D),this.bboxes=_.subarray(D),this.insert=this._insertReadonly}else{this.d=l+2*d;for(var P=0;P<this.d*this.d;P++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=d,this.scale=l/i,this.uid=0;var k=d/l*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,l,d,m,_){this._forEachCell(l,d,m,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,l,d,m,_,v){this.cells[_].push(v)},e.prototype.query=function(i,l,d,m,_){var v=this.min,S=this.max;if(i<=v&&l<=v&&S<=d&&S<=m&&!_)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,l,d,m,this._queryCell,A,{},_),A},e.prototype._queryCell=function(i,l,d,m,_,v,S,A){var D=this.cells[_];if(D!==null)for(var P=this.keys,k=this.bboxes,N=0;N<D.length;N++){var U=D[N];if(S[U]===void 0){var Z=4*U;(A?A(k[Z+0],k[Z+1],k[Z+2],k[Z+3]):i<=k[Z+2]&&l<=k[Z+3]&&d>=k[Z+0]&&m>=k[Z+1])?(S[U]=!0,v.push(P[U])):S[U]=!1}}},e.prototype._forEachCell=function(i,l,d,m,_,v,S,A){for(var D=this._convertToCellCoord(i),P=this._convertToCellCoord(l),k=this._convertToCellCoord(d),N=this._convertToCellCoord(m),U=D;U<=k;U++)for(var Z=P;Z<=N;Z++){var K=this.d*Z+U;if((!A||A(this._convertFromCellCoord(U),this._convertFromCellCoord(Z),this._convertFromCellCoord(U+1),this._convertFromCellCoord(Z+1)))&&_.call(this,i,l,d,m,K,v,S,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,l=r+this.cells.length+1+1,d=0,m=0;m<this.cells.length;m++)d+=this.cells[m].length;var _=new Int32Array(l+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=l,S=0;S<i.length;S++){var A=i[S];_[r+S]=v,_.set(A,v),v+=A.length}return _[r+i.length]=v,_.set(this.keys,v),_[r+i.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},Pa})(),vc=ja(Us);const _l={};function Bt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),_l[e]={klass:r,omit:i.omit||[]}}Bt(Object,"Object"),vc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},vc.deserialize=function(r){return new vc(r.buffer)},Object.defineProperty(vc,"name",{value:"Grid"}),Bt(vc,"Grid"),delete Mt.prototype.constructor,Bt(Si,"Color"),Bt(Error,"Error"),Bt(Rs,"Formatted"),Bt(lc,"FormattedSection"),Bt(Ml,"AJAXError"),Bt(so,"ResolvedImage"),Bt(wh,"StylePropertyFunction"),Bt(zf,"StyleExpression",{omit:["_evaluator"]}),Bt(Vs,"ImageId"),Bt(Ks,"ImageVariant"),Bt(wa,"ZoomDependentExpression"),Bt(Da,"ZoomConstantExpression"),Bt(ao,"CompoundExpression",{omit:["_evaluate"]});for(const r in Iu)_l[Iu[r]._classRegistryKey]||Bt(Iu[r],`Expression${r}`);function qr(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Hr(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(qr(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const l of r)i.push(Hr(l,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[l,d]of r.entries())i.entries.push(Hr(l),Hr(d,e));return i}if(r instanceof Set){const i={$name:"Set"};let l=0;for(const d of r.values())i[++l]=Hr(d);return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,l=i._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const d=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const m in r)r.hasOwnProperty(m)&&(_l[l].omit.indexOf(m)>=0||(d[m]=Hr(r[m],e)));r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(d.$name=l),d}throw new Error("can't serialize object of type "+typeof r)}function yl(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||qr(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(yl);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const d=r.entries||[],m=new Map;for(let _=0;_<d.length;_+=2)m.set(yl(d[_]),yl(d[_+1]));return m}if(e==="Set"){const d=new Set;for(const m of Object.keys(r))m!=="$name"&&d.add(yl(r[m]));return d}if(e==="BigInt")return BigInt(r.value);const{klass:i}=_l[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const l=Object.create(i.prototype);for(const d of Object.keys(r))d!=="$name"&&(l[d]=yl(r[d]));return l}throw new Error("can't deserialize object of type "+typeof r)}const Th=r=>r>=1536&&r<=1791,Mu=r=>r>=1872&&r<=1919,Eh=r=>r>=2208&&r<=2303,Du=r=>r>=11904&&r<=12031,Pu=r=>r>=12032&&r<=12255,eg=r=>r>=12272&&r<=12287,ns=r=>r>=12288&&r<=12351,ku=r=>r>=12352&&r<=12447,Sh=r=>r>=12448&&r<=12543,Ul=r=>r>=12544&&r<=12591,tg=r=>r>=12704&&r<=12735,A_=r=>r>=12736&&r<=12783,Vp=r=>r>=12784&&r<=12799,jp=r=>r>=12800&&r<=13055,Nf=r=>r>=13056&&r<=13311,Qs=r=>r>=13312&&r<=19903,ys=r=>r>=19968&&r<=40959,Ed=r=>r>=40960&&r<=42127,Lu=r=>r>=42128&&r<=42191,Bf=r=>r>=44032&&r<=55215,Up=r=>r>=63744&&r<=64255,Gl=r=>r>=64336&&r<=65023,Ff=r=>r>=65040&&r<=65055,Vf=r=>r>=65072&&r<=65103,Gp=r=>r>=65104&&r<=65135,qp=r=>r>=65136&&r<=65279,Hp=r=>r>=65280&&r<=65519;function $p(r){for(const e of r)if(bc(e.charCodeAt(0)))return!0;return!1}function I_(r){for(const e of r)if(!C_(e.charCodeAt(0)))return!1;return!0}function C_(r){return!(Th(r)||Mu(r)||Eh(r)||Gl(r)||qp(r))}function ng(r){return!(r<11904||!(tg(r)||Ul(r)||Vf(r)||Up(r)||Nf(r)||Du(r)||A_(r)||ns(r)||Qs(r)||ys(r)||jp(r)||Hp(r)||ku(r)||eg(r)||Pu(r)||Vp(r)||Sh(r)||Ff(r)||Lu(r)||Ed(r)))}function bc(r){return!(r!==746&&r!==747&&(r<4352||!(tg(r)||Ul(r)||Vf(r)&&!(r>=65097&&r<=65103)||Up(r)||Nf(r)||Du(r)||A_(r)||!(!ns(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Qs(r)||ys(r)||jp(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||Bf(r)||ku(r)||eg(r)||(e=>e>=12688&&e<=12703)(r)||Pu(r)||Vp(r)||Sh(r)&&r!==12540||!(!Hp(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Gp(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Ff(r)||(e=>e>=19904&&e<=19967)(r)||Ed(r)||Lu(r))))}function ig(r){return r===12312||r===12313||r===12316||r===12540||r===12448}function rg(r){return!(bc(r)||(function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ns(e)||Sh(e)||(i=>i>=57344&&i<=63743)(e)||Vf(e)||Gp(e)||Hp(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function jf(r){return Th(r)||Mu(r)||Eh(r)||Gl(r)||qp(r)}function sg(r){return r>=1424&&r<=2303||Gl(r)||qp(r)}function R_(r,e){return!(!e&&sg(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(i=>i>=6016&&i<=6143)(r))}function wc(r){for(const e of r)if(sg(e.charCodeAt(0)))return!0;return!1}const Wa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let tu=null,ka=Wa.unavailable,nu=null;const ag=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ka=Wa.error),tu&&tu(r)};function og(){Zp.fire(new Mo("pluginStateChange",{pluginStatus:ka,pluginURL:nu}))}const Zp=new pl,zu=function(){return ka},Wp=function(){if(ka!==Wa.deferred||!nu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ka=Wa.loading,og(),nu&&Nc({url:nu},r=>{r?ag(r):(ka=Wa.loaded,og())})},No={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ka===Wa.loaded||No.applyArabicShaping!=null,isLoading:()=>ka===Wa.loading,setState(r){ka=r.pluginStatus,nu=r.pluginURL},isParsing:()=>ka===Wa.parsing,isParsed:()=>ka===Wa.parsed,getPluginURL:()=>nu};class Pi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,l){for(const d of i)if(!R_(d.charCodeAt(0),l))return!1;return!0})(e,No.isLoaded())}}class Sd{constructor(e,i,l,d,m){this.property=e,this.value=i,this.expression=(function(_,v,S,A,D){if(Td(_))return new wh(_,v);if(bh(_)||Array.isArray(_)&&_.length>0){const P=jl(_,v,S,A,D);if(P.result==="error")throw new Error(P.value.map(k=>`${k.key}: ${k.message}`).join(", "));return P.value}{let P=_;return typeof _=="string"&&v.type==="color"&&(P=Si.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}})(i===void 0?e.specification.default:i,e.specification,l,d,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l,d){return this.property.possiblyEvaluate(this,e,i,l,d)}}class Ah{constructor(e,i,l,d){this.property=e,this.value=new Sd(e,void 0,i,l,d)}transitioned(e,i){return new lg(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new lg(this.property,this.value,null,{},0)}}class Ad{constructor(e,i,l,d){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return kn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ah(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Sd(this._values[e].property,i===null?void 0:kn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const l=this._properties.properties;if(e)for(const d in e){const m=e[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);l[_]&&this.setTransition(_,m)}else l.hasOwnProperty(d)&&this.setValue(d,m)}}getTransition(e){return kn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ah(this._values[e].property)),this._values[e].transition=kn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const d=this.getTransition(i);d!==void 0&&(e[`${i}-transition`]=d)}return e}transitioned(e,i){const l=new cg(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,i._values[d]);return l}untransitioned(){const e=new cg(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class lg{constructor(e,i,l,d,m){const _=d.delay||0,v=d.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+_,this.end=this.begin+v,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const d=e.now||0,m=this.value.possiblyEvaluate(e,i,l),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(e,i,l);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,l),m,ae(v))}}return m}}class cg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const d=new La(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,i,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xp{constructor(e,i,l,d){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return kn(this._values[e].value)}setValue(e,i){this._values[e]=new Sd(this._values[e].property,i===null?void 0:kn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l,d){const m=new La(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(e,i,l,d);return m}isIndoorDependent(){return this._isIndoorDependent}}class Ou{constructor(e,i,l,d){this.property=e,this.value=i,this.parameters=l,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,d){return this.property.evaluate(this.value,this.parameters,e,i,l,d,this.iconImageUseTheme)}}class La{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ot{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const d=oc[this.specification.type];return d?d(e,i,l):e}}class Xt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,d,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ou(this,{kind:"constant",value:e.expression.evaluate(i,null,{},l,d,void 0,m)},i):new Ou(this,e.expression,i,m)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ou(this,{kind:"constant",value:void 0},e.parameters);const d=oc[this.specification.type];return d?new Ou(this,{kind:"constant",value:d(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,d,m,_,v){return e.kind==="constant"?e.value:e.evaluate(i,l,d,m,_,void 0,v)}}class Ih{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,d){return!!e.expression.evaluate(i,null,{},l,d)}interpolate(){return!1}}class wr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Pi(0,{});for(const l in e){const d=e[l];d.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new Sd(d,void 0),_=this.defaultTransitionablePropertyValues[l]=new Ah(d);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(i)}}}Bt(Xt,"DataDrivenProperty"),Bt(Ot,"DataConstantProperty"),Bt(Ih,"ColorRampProperty");var Ze=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ug(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Yp(r){if(Array.isArray(r))return r.map(Yp);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Yp(r[i]);return e}return ug(r)}function Uf(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Uf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Kp(r,e="",i=null,l="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Uf(r)||(r=Id(r));const d=r;let m=!0;try{m=(function(D){if(!Ch(D))return D;let P=Yp(D);return Gf(P),P=hg(P),P})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=Ze[`filter_${l}`];const D=xc(m,v,e,i);if(D.result==="error")throw new Error(D.value.map(P=>`${P.key}: ${P.message}`).join(", "));_=(P,k,N)=>D.value.evaluate(P,k,{},N)}let S=null,A=null;if(m!==d){const D=xc(d,v,e,i);if(D.result==="error")throw new Error(D.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,k,N,U,Z)=>D.value.evaluate(P,k,{},N,void 0,void 0,U,Z),A=!fh(D.value.expression)}return{filter:_,dynamicFilter:S||void 0,needGeometry:dg(m),needFeature:!!A}}function hg(r){if(!Array.isArray(r))return r;const e=(function(i){if(M_.has(i[0])){for(let l=1;l<i.length;l++)if(Ch(i[l]))return!0}return i})(r);return e===!0?e:e.map(i=>hg(i))}function Gf(r){let e=!1;const i=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)e=e||Ch(r[l]),i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Ch(r[1]);for(let l=2;l<r.length-1;l+=2)i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Ch(r[1]);for(let l=1;l<r.length-1;l+=2)i.push(r[l+1])}e&&(r.length=0,r.push("any",...i));for(let l=1;l<r.length;l++)Gf(r[l])}function Ch(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Ch(r[i]))return!0;return!1}const M_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ex(r,e){return r<e?-1:r>e?1:0}function dg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(dg(r[e]))return!0;return!1}function Id(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Bo(r[1],r[2],"=="):e==="!="?$f(Bo(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bo(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Id))):e==="all"?["all"].concat(r.slice(1).map(Id)):e==="none"?["all"].concat(r.slice(1).map(Id).map($f)):e==="in"?qf(r[1],r.slice(2)):e==="!in"?$f(qf(r[1],r.slice(2))):e==="has"?Hf(r[1]):e!=="!has"||$f(Hf(r[1]));var i}function Bo(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function qf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(ex)]]:["filter-in-small",r,["literal",e]]}}function Hf(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function $f(r){return["!",r]}const Cd="";function ql(r,e){return e?`${r}${Cd}${e}`:r}let Qp;const Zf=()=>Qp||(Qp=new wr({"icon-size":new Xt(Ze.layout_symbol["icon-size"]),"icon-image":new Xt(Ze.layout_symbol["icon-image"]),"icon-rotate":new Xt(Ze.layout_symbol["icon-rotate"]),"icon-offset":new Xt(Ze.layout_symbol["icon-offset"]),"text-size":new Xt(Ze.layout_symbol["text-size"]),"text-rotate":new Xt(Ze.layout_symbol["text-rotate"]),"text-offset":new Xt(Ze.layout_symbol["text-offset"])}));class fg{constructor(e,i,l,d,m,_){const v=xc(e,Ze.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,l){this.properties=new La(Zf()),this.unevaluatedLayout=new Xp(Zf(),d,m,_);for(const S in l)this.unevaluatedLayout.setValue(S,l[S])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),l=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return e||i||l||d}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),l=this.hasProperty("text-rotate");return e||i||l}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Jp="-transition",em=new Set(["fill","line","background","hillshade","raster"]);class za extends pl{constructor(e,i,l,d,m,_){if(super(),this.id=e.id,this.fqid=ql(this.id,l),this.type=e.type,this.scope=l,this.lut=d,this.options=m,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=xc(this.filter,Ze[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Xp(i.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Ad(i.paint,this.scope,m);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new La(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&em.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new fg(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Jp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const l=this._transitionablePaint,d=l._properties.properties;if(e.endsWith(Jp)){const P=e.slice(0,-11);return d[P]&&l.setTransition(P,i||void 0),!1}if(!d[e])return!1;const m=l._values[e],_=m.value.isDataDriven(),v=m.value;l.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const S=l._values[e].value,A=S.isDataDriven(),D=e.endsWith("pattern")||e==="line-dasharray";return A||_||D||this._handleOverridablePaintPropertyUpdate(e,v,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,l){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),bn(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ou&&wd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!js(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Kp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,l){return{}}queryRadius(e){}queryIntersectsFeature(e,i,l,d,m,_,v,S,A,D){}}const pg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fo{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const D_=new ArrayBuffer(0);class sr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=D_),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(r,e=1){let i=0,l=0;return{members:r.map(d=>{const m=pg[d.type].BYTES_PER_ELEMENT,_=i=Wf(i,Math.max(e,m)),v=d.components||1;return l=Math.max(l,m),i+=m*v,{name:d.name,type:d.type,components:v,offset:_}}),size:Wf(i,Math.max(l,e)),alignment:e}}function Wf(r,e){return Math.ceil(r/e)*e}class iu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.int16[d+0]=i,this.int16[d+1]=l,e}}iu.prototype.bytesPerElement=4,Bt(iu,"StructArrayLayout2i4");class Hl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=d,e}}Hl.prototype.bytesPerElement=6,Bt(Hl,"StructArrayLayout3i6");class Tc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=l,this.int16[_+2]=d,this.int16[_+3]=m,e}}Tc.prototype.bytesPerElement=8,Bt(Tc,"StructArrayLayout4i8");class Gs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Gs.prototype.bytesPerElement=4,Bt(Gs,"StructArrayLayout1f4");class Rd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=4*e,_=2*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.float32[_+1]=d,e}}Rd.prototype.bytesPerElement=8,Bt(Rd,"StructArrayLayout2i1f8");class Xf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=d,e}}Xf.prototype.bytesPerElement=8,Bt(Xf,"StructArrayLayout3i8");class Ms extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=l,this.int16[v+2]=d,this.int16[v+3]=m,this.int16[v+4]=_,e}}Ms.prototype.bytesPerElement=10,Bt(Ms,"StructArrayLayout5i10");class la extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=6*e,D=12*e,P=3*e;return this.int16[A+0]=i,this.int16[A+1]=l,this.uint8[D+4]=d,this.uint8[D+5]=m,this.uint8[D+6]=_,this.uint8[D+7]=v,this.float32[P+2]=S,e}}la.prototype.bytesPerElement=12,Bt(la,"StructArrayLayout2i4ub1f12");class tl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=d,e}}tl.prototype.bytesPerElement=12,Bt(tl,"StructArrayLayout3f12");class $l extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=6*e,S=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=l,this.uint16[v+2]=d,this.uint16[v+3]=m,this.float32[S+2]=_,e}}$l.prototype.bytesPerElement=12,Bt($l,"StructArrayLayout4ui1f12");class Rh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=l,this.uint16[_+2]=d,this.uint16[_+3]=m,e}}Rh.prototype.bytesPerElement=8,Bt(Rh,"StructArrayLayout4ui8");class Mh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.int16[S+2]=d,this.int16[S+3]=m,this.int16[S+4]=_,this.int16[S+5]=v,e}}Mh.prototype.bytesPerElement=12,Bt(Mh,"StructArrayLayout6i12");class Dh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,l,d,m,_,v,S,A,D,P,k)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,N){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=l,this.int16[U+2]=d,this.int16[U+3]=m,this.uint16[U+4]=_,this.uint16[U+5]=v,this.uint16[U+6]=S,this.uint16[U+7]=A,this.int16[U+8]=D,this.int16[U+9]=P,this.int16[U+10]=k,this.int16[U+11]=N,e}}Dh.prototype.bytesPerElement=24,Bt(Dh,"StructArrayLayout4i4ui4i24");class tm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=10*e,A=5*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.int16[S+2]=d,this.float32[A+2]=m,this.float32[A+3]=_,this.float32[A+4]=v,e}}tm.prototype.bytesPerElement=20,Bt(tm,"StructArrayLayout3i3f20");class Zl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=l,this.float32[_+2]=d,this.float32[_+3]=m,e}}Zl.prototype.bytesPerElement=16,Bt(Zl,"StructArrayLayout4f16");class nm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}nm.prototype.bytesPerElement=4,Bt(nm,"StructArrayLayout1ul4");class nl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.uint16[d+0]=i,this.uint16[d+1]=l,e}}nl.prototype.bytesPerElement=4,Bt(nl,"StructArrayLayout2ui4");class Nu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,l,d,m,_,v,S,A,D,P,k,N)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,N,U){const Z=20*e,K=10*e;return this.int16[Z+0]=i,this.int16[Z+1]=l,this.int16[Z+2]=d,this.int16[Z+3]=m,this.int16[Z+4]=_,this.float32[K+3]=v,this.float32[K+4]=S,this.float32[K+5]=A,this.float32[K+6]=D,this.int16[Z+14]=P,this.uint32[K+8]=k,this.uint16[Z+18]=N,this.uint16[Z+19]=U,e}}Nu.prototype.bytesPerElement=40,Bt(Nu,"StructArrayLayout5i4f1i1ul2ui40");class Md extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=l,this.int16[A+2]=d,this.int16[A+4]=m,this.int16[A+5]=_,this.int16[A+6]=v,this.int16[A+7]=S,e}}Md.prototype.bytesPerElement=16,Bt(Md,"StructArrayLayout3i2i2i16");class Yf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=4*e,S=8*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=d,this.int16[S+6]=m,this.int16[S+7]=_,e}}Yf.prototype.bytesPerElement=16,Bt(Yf,"StructArrayLayout2f1f2i16");class Kf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=20*e,A=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=l,this.float32[A+1]=d,this.float32[A+2]=m,this.float32[A+3]=_,this.float32[A+4]=v,e}}Kf.prototype.bytesPerElement=20,Bt(Kf,"StructArrayLayout2ub4f20");class xs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=d,e}}xs.prototype.bytesPerElement=6,Bt(xs,"StructArrayLayout3ui6");class Ph extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e){const me=this.length;return this.resize(me+1),this.emplace(me,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e,me){const Ee=30*e,Se=15*e,we=60*e;return this.int16[Ee+0]=i,this.int16[Ee+1]=l,this.int16[Ee+2]=d,this.float32[Se+2]=m,this.float32[Se+3]=_,this.uint16[Ee+8]=v,this.uint16[Ee+9]=S,this.uint32[Se+5]=A,this.uint32[Se+6]=D,this.uint32[Se+7]=P,this.uint16[Ee+16]=k,this.uint16[Ee+17]=N,this.uint16[Ee+18]=U,this.float32[Se+10]=Z,this.float32[Se+11]=K,this.uint8[we+48]=X,this.uint8[we+49]=te,this.uint8[we+50]=se,this.uint32[Se+13]=le,this.int16[Ee+28]=_e,this.uint8[we+58]=me,e}}Ph.prototype.bytesPerElement=60,Bt(Ph,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Bu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e,me,Ee,Se,we,Me,Oe,pt,ot,ut,Tt,vt,bt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e,me,Ee,Se,we,Me,Oe,pt,ot,ut,Tt,vt,bt)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e,me,Ee,Se,we,Me,Oe,pt,ot,ut,Tt,vt,bt,rt){const At=20*e,_t=40*e,Ct=80*e;return this.float32[At+0]=i,this.float32[At+1]=l,this.int16[_t+4]=d,this.int16[_t+5]=m,this.int16[_t+6]=_,this.int16[_t+7]=v,this.int16[_t+8]=S,this.int16[_t+9]=A,this.int16[_t+10]=D,this.int16[_t+11]=P,this.int16[_t+12]=k,this.uint16[_t+13]=N,this.uint16[_t+14]=U,this.uint16[_t+15]=Z,this.uint16[_t+16]=K,this.uint16[_t+17]=X,this.uint16[_t+18]=te,this.uint16[_t+19]=se,this.uint16[_t+20]=le,this.uint16[_t+21]=_e,this.uint16[_t+22]=me,this.uint16[_t+23]=Ee,this.uint16[_t+24]=Se,this.uint16[_t+25]=we,this.uint16[_t+26]=Me,this.uint16[_t+27]=Oe,this.uint32[At+14]=pt,this.float32[At+15]=ot,this.float32[At+16]=ut,this.float32[At+17]=Tt,this.float32[At+18]=vt,this.uint8[Ct+76]=bt,this.uint16[_t+39]=rt,e}}Bu.prototype.bytesPerElement=80,Bt(Bu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Dd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=6*e;return this.float32[S+0]=i,this.float32[S+1]=l,this.float32[S+2]=d,this.float32[S+3]=m,this.float32[S+4]=_,this.float32[S+5]=v,e}}Dd.prototype.bytesPerElement=24,Bt(Dd,"StructArrayLayout6f24");class Fu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=d,this.float32[v+3]=m,this.float32[v+4]=_,e}}Fu.prototype.bytesPerElement=20,Bt(Fu,"StructArrayLayout5f20");class Pd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=l,this.float32[A+2]=d,this.float32[A+3]=m,this.float32[A+4]=_,this.float32[A+5]=v,this.float32[A+6]=S,e}}Pd.prototype.bytesPerElement=28,Bt(Pd,"StructArrayLayout7f28");class kd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,l,d,m,_,v,S,A,D,P)}emplace(e,i,l,d,m,_,v,S,A,D,P,k){const N=11*e;return this.float32[N+0]=i,this.float32[N+1]=l,this.float32[N+2]=d,this.float32[N+3]=m,this.float32[N+4]=_,this.float32[N+5]=v,this.float32[N+6]=S,this.float32[N+7]=A,this.float32[N+8]=D,this.float32[N+9]=P,this.float32[N+10]=k,e}}kd.prototype.bytesPerElement=44,Bt(kd,"StructArrayLayout11f44");class kh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,l,d,m,_,v,S,A)}emplace(e,i,l,d,m,_,v,S,A,D){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=l,this.float32[P+2]=d,this.float32[P+3]=m,this.float32[P+4]=_,this.float32[P+5]=v,this.float32[P+6]=S,this.float32[P+7]=A,this.float32[P+8]=D,e}}kh.prototype.bytesPerElement=36,Bt(kh,"StructArrayLayout9f36");class Vu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.float32[d+0]=i,this.float32[d+1]=l,e}}Vu.prototype.bytesPerElement=8,Bt(Vu,"StructArrayLayout2f8");class Qf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=l,this.uint16[_+3]=d,this.uint16[_+4]=m,e}}Qf.prototype.bytesPerElement=12,Bt(Qf,"StructArrayLayout1ul3ui12");class Ld extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ld.prototype.bytesPerElement=2,Bt(Ld,"StructArrayLayout1ui2");class Wl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K){const X=this.length;return this.resize(X+1),this.emplace(X,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X){const te=16*e;return this.float32[te+0]=i,this.float32[te+1]=l,this.float32[te+2]=d,this.float32[te+3]=m,this.float32[te+4]=_,this.float32[te+5]=v,this.float32[te+6]=S,this.float32[te+7]=A,this.float32[te+8]=D,this.float32[te+9]=P,this.float32[te+10]=k,this.float32[te+11]=N,this.float32[te+12]=U,this.float32[te+13]=Z,this.float32[te+14]=K,this.float32[te+15]=X,e}}Wl.prototype.bytesPerElement=64,Bt(Wl,"StructArrayLayout16f64");class Lh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=10*e,D=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=l,this.uint16[A+2]=d,this.uint16[A+3]=m,this.float32[D+2]=_,this.float32[D+3]=v,this.float32[D+4]=S,e}}Lh.prototype.bytesPerElement=20,Bt(Lh,"StructArrayLayout4ui3f20");class mg extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}mg.prototype.bytesPerElement=2,Bt(mg,"StructArrayLayout1i2");class Jf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Jf.prototype.bytesPerElement=1,Bt(Jf,"StructArrayLayout1ub1");class Ec extends Fo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ec.prototype.size=40;class im extends Nu{get(e){return new Ec(this,e)}}Bt(im,"CollisionBoxArray");class gg extends Fo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}gg.prototype.size=60;class ep extends Ph{get(e){return new gg(this,e)}}Bt(ep,"PlacedSymbolArray");class zd extends Fo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}zd.prototype.size=80;class hs extends Bu{get(e){return new zd(this,e)}}Bt(hs,"SymbolInstanceArray");class tp extends Gs{getoffsetX(e){return this.float32[1*e+0]}}Bt(tp,"GlyphOffsetArray");class P_ extends iu{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Bt(P_,"SymbolLineVertexArray");class _g extends Fo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_g.prototype.size=12;class ru extends Qf{get(e){return new _g(this,e)}}Bt(ru,"FeatureIndexArray");class su extends nl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Bt(su,"FillExtrusionCentroidArray");class rm extends Fo{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}rm.prototype.size=6;class yg extends Hl{get(e){return new rm(this,e)}}Bt(yg,"FillExtrusionWallArray");const Od=ei([{name:"a_pos",components:2,type:"Int16"}],4),Xl=ei([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),xg=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,l,d){let m=this.segments[this.segments.length-1];return e>mr.MAX_VERTEX_ARRAY_LENGTH&&Pn(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>mr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}prepareSegment(e,i,l,d){return this._prepareSegment(e,i.length,l.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,d){return new mr([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function vg(r,e){return 256*(r=xe(Math.floor(r),0,255))+xe(Math.floor(e),0,255)}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(mr,"SegmentVector");const sm=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bg=ei([{name:"a_pattern_b",components:4,type:"Uint16"}]),am=ei([{name:"a_dash",components:4,type:"Uint16"}]);class Nd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,l,d){this.ids.push(Sc(e)),this.positions.push(i,l,d)}eachPosition(e,i){const l=Sc(e);let d=0,m=this.ids.length-1;for(;d<m;){const _=d+m>>1;this.ids[_]>=l?m=_:d=_+1}for(;this.ids[d]===l;)i(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,i){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Ds(l,d,0,l.length-1),i&&(i.add(l.buffer),i.add(d.buffer)),{ids:l,positions:d}}static deserialize(e){const i=new Nd;let l;i.ids=e.ids,i.positions=e.positions;for(const d of i.ids)d!==l&&i.uniqueIds.push(d),l=d;return i.indexed=!0,i}}function Sc(r){const e=+r;return Number.isSafeInteger(e)?e:ro(String(r))}function Ds(r,e,i,l){for(;i<l;){const d=r[i+l>>1];let m=i-1,_=l+1;for(;;){do m++;while(r[m]<d);do _--;while(r[_]>d);if(m>=_)break;zh(r,m,_),zh(e,3*m,3*_),zh(e,3*m+1,3*_+1),zh(e,3*m+2,3*_+2)}_-i<l-_?(Ds(r,e,i,_),i=_+1):(Ds(r,e,_+1,l),l=_)}}function zh(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}Bt(Nd,"FeaturePositionMap");class xl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class $r extends xl{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class ds extends xl{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Vo extends xl{constructor(e){super(e),this.current=[0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Bd extends xl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class is extends xl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class ho extends xl{constructor(e){super(e),this.current=Si.transparent.toPremultipliedRenderColor(null)}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const au=new Float32Array(16);class Oh extends xl{constructor(e){super(e),this.current=au}set(e,i,l){if(this.fetchUniformLocation(e,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const tx=new Float32Array(9),f=new Float32Array(4);class n extends xl{constructor(e){super(e),this.current=f}set(e,i,l){if(this.fetchUniformLocation(e,i)){for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function c(r){return[vg(255*r.r,255*r.g),vg(255*r.b,255*r.a)]}function p(r,e,i,l,d,m,_,v){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Pi(0,{brightness:m,worldview:v}),e,i,d,l,_)==="none":r.value==="none")}class x{constructor(e,i,l,d){this.value=e,this.uniformNames=i.map(m=>`u_${m}`),this.type=l,this.context=d}setUniform(e,i,l,d,m){const _=d.constantOr(this.value);i.set(e,m,_ instanceof Si?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new ho(e):new ds(e)}}class b{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,l,d,m){let _=null;m!=="u_pattern"&&m!=="u_dash"||(_=this.pattern),m==="u_pattern_b"&&(_=this.patternTransition),m==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,m,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new is(e):new ds(e)}}class E{constructor(e,i,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,l,d,m,_,v,S){const A=this.paintVertexArray.length,D=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Pi(0,{brightness:_,worldview:S}),i,{},m,d,v):this.expression.kind==="constant"&&this.expression.value,P=p(this.lutExpression,i,{},d,m,_,v,S);this.paintVertexArray.resize(e),this._setPaintValue(A,e,D,P?null:this.context.lut)}updatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:S},l,d,void 0,m):this.expression.kind==="constant"&&this.expression.value,D=p(this.lutExpression,l,d,m,void 0,v,void 0,S);this._setPaintValue(e,i,A,D?null:this.context.lut)}_setPaintValue(e,i,l,d){if(this.type==="color"){const m=c(l.toPremultipliedRenderColor(d));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class I{constructor(e,i,l,d,m,_){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=d,this.context=m,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.evaluate(new Pi(this.context.zoom,{brightness:_,worldview:S}),i,{},m,d,v),D=this.expression.evaluate(new Pi(this.context.zoom+1,{brightness:_,worldview:S}),i,{},m,d,v),P=p(this.lutExpression,i,{},d,m,_,v,S),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,A,D,P?null:this.context.lut)}updatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:S},l,d,void 0,m),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:S},l,d,void 0,m),P=p(this.lutExpression,l,d,m,void 0,v,void 0,S);this._setPaintValue(e,i,A,D,P?null:this.context.lut)}_setPaintValue(e,i,l,d,m){if(this.type==="color"){const _=c(l.toPremultipliedRenderColor(m)),v=c(d.toPremultipliedRenderColor(m));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,_[0],_[1],v[0],v[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,d,m){const _=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=xe(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,m,v)}getBinding(e,i){return new ds(e)}}class M{constructor(e,i,l,d,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?am:sm).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Rh}populatePaintArray(e,i,l,d){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,d,m,_,v){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,i,l,d){if(!d||!l)return;const m=d[l[0]],_=d[l[1]];if(m){if(m){const{tl:v,br:S,pixelRatio:A}=m;for(let D=e;D<i;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],A)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:S}=_;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,v[0],v[1],S[0],S[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,bg.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class z{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[],this.context=i;const d=[];for(const m in e.paint._values){const _=e.paint.get(m);if(m.endsWith("-use-theme")||!l(m)||!(_ instanceof Ou&&wd(_.property.specification)))continue;const v=G(m,e.type),S=_.value,A=_.property.specification.type,D=!!_.property.useIntegerZoom,P=m==="line-dasharray"||m.endsWith("pattern"),k=e.paint.get(`${m}-use-theme`),N=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(S.kind!=="constant"||N)if(S.kind==="source"||N||P){const U=Y(m,A,"source");this.binders[m]=P?new M(S,v,A,U,e.id):new E(S,v,A,U),d.push(`/a_${m}`)}else{const U=Y(m,A,"composite");this.binders[m]=new I(S,v,A,D,i,U),d.push(`/z_${m}`)}else this.binders[m]=P?new b(S.value,v):new x(S.value,v,A,i),d.push(`/u_${m}`);k&&(this.binders[m].lutExpression=k.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof E||i instanceof I?i.maxValue:0}populatePaintArrays(e,i,l,d,m,_,v,S){for(const A in this.binders){const D=this.binders[A];D.context=this.context,(D instanceof E||D instanceof I||D instanceof M)&&D.populatePaintArray(e,i,l,d,m,_,v,S)}}setConstantPatternPositions(e,i){for(const l in this.binders){const d=this.binders[l];d instanceof b&&d.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof M?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,l,d,m,_,v,S,A,D){let P=!1;const k=Object.keys(e),N=k.length!==0&&!S,U=N?k:i.uniqueIds;this.context.lut=m.lut;for(const Z in this.binders){const K=this.binders[Z];if(K.context=this.context,(K instanceof E||K instanceof I||K instanceof M)&&K.expression&&K.expression.kind&&K.expression.kind!=="constant"&&(K.expression.isStateDependent===!0||K.expression.isLightConstant===!1)){const X=m.paint.get(Z);K.expression=X.value;for(const te of U){const se=e[te.toString()];i.eachPosition(te,(le,_e,me)=>{const Ee=d.feature(le);K.updatePaintArray(_e,me,Ee,se,_,v,A,D)})}if(!N)for(const te of l.uniqueIds){const se=e[te.toString()];l.eachPosition(te,(le,_e,me)=>{const Ee=d.feature(le);K.updatePaintArray(_e,me,Ee,se,_,v,A,D)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof x||l instanceof b)&&e.push(...l.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof x||d instanceof b||d instanceof I)for(const m of d.uniformNames)i.push({name:m,property:l,binding:d.getBinding(e,m)})}return i}setUniforms(e,i,l,d,m){for(const{name:_,property:v,binding:S}of l)this.binders[v].setUniform(e,S,m,d.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof E||i instanceof I||i instanceof M)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof M&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof E||l instanceof I||l instanceof M)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof E||i instanceof I||i instanceof M)&&i.destroy()}}}class O{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new z(d,i,l);this.needsUpload=!1,this._featureMap=new Nd,this._featureMapWithoutIds=new Nd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,l,d,m,_,v,S,A){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,i,d,m,_,v,S,A);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,d,m,_,v,S){for(const A of l)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,d,m,_,v||0,S)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const H={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function G(r,e){return H[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const $={"line-pattern":{source:$l,composite:$l},"fill-pattern":{source:$l,composite:$l},"fill-extrusion-pattern":{source:$l,composite:$l},"line-dasharray":{source:Rh,composite:Rh}},J={color:{source:Vu,composite:Zl},number:{source:Gs,composite:Vu}};function Y(r,e,i){const l=$[r];return l&&l[i]||J[e][i]}Bt(x,"ConstantBinder"),Bt(b,"PatternConstantBinder"),Bt(E,"SourceExpressionBinder"),Bt(M,"PatternCompositeBinder"),Bt(I,"CompositeExpressionBinder"),Bt(z,"ProgramConfiguration",{omit:["_buffers"]}),Bt(O,"ProgramConfigurationSet");const ee=jt/Math.PI/2,re=64,pe=[re,32,16],fe=-ee,ue=ee;function Ie(r,e,i,l=ee){return i=ai(i),[r*Math.sin(i)*l,-e*l,r*Math.cos(i)*l]}function Te(r,e,i){return Ie(Math.cos(ai(r)),Math.sin(ai(r)),e,i)}const Ae=63710088e-1,ve=2*Math.PI*Ae;class ge{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ge(it(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,d=e.lat*i,m=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*i);return Ae*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new Pe({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(e){return Te(this.lat,this.lng,ee+e*ee/Ae)}static convert(e){if(e instanceof ge)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ge(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ge(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Pe{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}setSouthWest(e){return this._sw=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}extend(e){const i=this._sw,l=this._ne;let d,m;if(e instanceof ge)d=e,m=e;else{if(!(e instanceof Pe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pe.convert(e)):this.extend(ge.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ge.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return i||l?(i.lng=Math.min(d.lng,i.lng),i.lat=Math.min(d.lat,i.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new ge(d.lng,d.lat),this._ne=new ge(m.lng,m.lat)),this}getCenter(){return new ge((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ge(this.getWest(),this.getNorth())}getSouthEast(){return new ge(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=ge.convert(e);let d=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){if(e)return e instanceof Pe?e:new Pe(e)}}function Le(r){return ve*Math.cos(r*Math.PI/180)}function Fe(r){return(180+r)/360}function We(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function $e(r,e){return r/Le(e)}function lt(r){return 360*r-180}function xt(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Qe(r,e){return r*Le(xt(e))}const ke=85.051129;function mt(r){return Math.cos(ai(xe(r,-85.051129,ke)))}function nt(r,e){const i=xe(e,0,25.5),l=Math.pow(2,i);return mt(r)*ve/(512*l)}function yt(r){return 1/Math.cos(r*Math.PI/180)}function Pt(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/jt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/jt/(1<<r.z)}class qt{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=ge.convert(e);return new qt(Fe(l.lng),We(l.lat),$e(i,l.lat))}toLngLat(){return new ge(lt(this.x),xt(this.y))}toAltitude(){return Qe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ve*yt(xt(this.y))}}function zt(r,e,i,l,d,m,_,v,S){const A=(e+l)/2,D=(i+d)/2,P=new Mt(A,D);v(P),(function(k,N,U,Z,K,X){const te=U-K,se=Z-X;return Math.abs((Z-N)*te-(U-k)*se)/Math.hypot(te,se)})(P.x,P.y,m.x,m.y,_.x,_.y)>=S?(zt(r,e,i,A,D,m,P,v,S),zt(r,A,D,l,d,P,_,v,S)):r.push(_)}function kt(r,e,i){let l=r[0],d=l.x,m=l.y;e(l);const _=[l];for(let v=1;v<r.length;v++){const S=r[v],{x:A,y:D}=S;e(S),zt(_,d,m,A,D,l,S,e,i),d=A,m=D,l=S}return _}function cn(r,e,i,l){if(l(e,i)){const d=e.add(i)._mult(.5);cn(r,e,d,l),cn(r,d,i,l)}else r.push(i)}function an(r,e){let i=r[0];const l=[i];for(let d=1;d<r.length;d++){const m=r[d];cn(l,i,m,e),i=m}return l}const $t=Math.pow(2,14)-1,on=-$t-1;function xn(r,e){const i=Math.round(r.x*e),l=Math.round(r.y*e);return r.x=xe(i,on,$t),r.y=xe(l,on,$t),(i<r.x||i>r.x+1||l<r.y||l>r.y+1)&&Pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Mn(r,e,i){const l=r.loadGeometry(),d=r.extent,m=jt/d;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:S,y:A,projection:D}=i,P=k=>{const N=lt((e.x+k.x/d)/_),U=xt((e.y+k.y/d)/_),Z=D.project(N,U);k.x=(Z.x*v-S)*d,k.y=(Z.y*v-A)*d};for(let k=0;k<l.length;k++)if(r.type!==1)l[k]=kt(l[k],P,1);else{const N=[];for(const U of l[k])U.x<0||U.x>=d||U.y<0||U.y>=d||(P(U),N.push(U));l[k]=N}}for(const _ of l)for(const v of _)xn(v,m);return l}function Vn(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Mn(r):[]}}class ti{constructor(e,i,l,d,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=m,e.readFields(Dn,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,l=[];let d,m=1,_=0,v=0,S=0;for(;e.pos<i;){if(_<=0){const A=e.readVarint();m=7&A,_=A>>3}if(_--,m===1||m===2)v+=e.readSVarint(),S+=e.readSVarint(),m===1&&(d&&l.push(d),d=[]),d&&d.push(new Mt(v,S));else{if(m!==7)throw new Error(`unknown command ${m}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let l=1,d=0,m=0,_=0,v=1/0,S=-1/0,A=1/0,D=-1/0;for(;e.pos<i;){if(d<=0){const P=e.readVarint();l=7&P,d=P>>3}if(d--,l===1||l===2)m+=e.readSVarint(),_+=e.readSVarint(),m<v&&(v=m),m>S&&(S=m),_<A&&(A=_),_>D&&(D=_);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,A,S,D]}toGeoJSON(e,i,l){const d=this.extent*Math.pow(2,l),m=this.extent*e,_=this.extent*i,v=this.loadGeometry();function S(k){return[360*(k.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+_)/d)*Math.PI))-90]}function A(k){return k.map(S)}let D;if(this.type===1){const k=[];for(const U of v)k.push(U[0]);const N=A(k);D=k.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const k=v.map(A);D=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=(function(U){const Z=U.length;if(Z<=1)return[U];const K=[];let X,te;for(let se=0;se<Z;se++){const le=jn(U[se]);le!==0&&(te===void 0&&(te=le<0),te===le<0?(X&&K.push(X),X=[U[se]]):X&&X.push(U[se]))}return X&&K.push(X),K})(v),N=[];for(const U of k)N.push(U.map(A));D=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const P={type:"Feature",geometry:D,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function Dn(r,e,i){r===1?e.id=i.readVarint():r===2?(function(l,d){const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=d._keys[l.readVarint()],v=d._values[l.readVarint()];d.properties[_]=v}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function jn(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}ti.types=["Unknown","Point","LineString","Polygon"];class On{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new ti(this._pbf,i,this.extent,this._keys,this._values)}}function bi(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(l){let d=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=l.readVarint()>>3;d=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(i))}class mi{constructor(e,i){this.layers=e.readFields(ki,{},i)}}function ki(r,e,i){if(r===3){const l=new On(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}const li="3d_elevation_id",Un="level";class yi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,l){return this.get(e,!0,i,l)}optional(e,i,l){return this.get(e,!1,i,l)}success(){return this._valid}get(e,i,l,d){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?l(d?d(m):m):i&&(this._valid=!1),this}}class gr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,l){return this.featureFunc(e,i,l)}parseVertex(e,i,l){return this.vertexFunc(e,i,l)}}const Li=new gr((r,e,i)=>r.reset(e).require(li,l=>{i.id=l}).optional("fixed_height_relative",l=>{i.constantHeight=l},Bn.decodeRelativeHeight).geometry(l=>{i.bounds=l},Ll).success(),(r,e,i)=>r.reset(e).require(li,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height_relative",l=>{i.height=l},Bn.decodeRelativeHeight).geometry(l=>{i.position=l},Bn.getPoint).success()),Ai=new gr((r,e,i)=>r.reset(e).require(li,l=>{i.id=l}).optional("fixed_height",l=>{i.constantHeight=l},Bn.decodeMetricHeight).geometry(l=>{i.bounds=l},Ll).success(),(r,e,i)=>r.reset(e).require(li,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height",l=>{i.height=l},Bn.decodeMetricHeight).geometry(l=>{i.position=l},Bn.getPoint).success());class Bn{static getPoint(e){return Vi(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ai:void 0:Li}static parse(e){const i=[],l=[],d=e.length,m=new yi;for(let _=0;_<d;_++){const v=e.feature(_),S=v.properties.version,A=Bn.getVersionSchema(S);if(A===void 0){Pn(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const D=v.properties.type;if(!D)continue;const P=ti.types[v.type];if(P==="Point"&&D==="curve_point"){const k={};A.parseVertex(m,v,k)&&i.push(k)}else if(P==="Polygon"&&D==="curve_meta"){const k={};A.parseFeature(m,v,k)&&l.push(k)}}return{vertices:i,features:l}}}class qn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const d=ji(i,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/d;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,!0}}class Ji{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const d=zi(i,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/d;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,i,l){if((function(N,U){var Z=N[0],K=N[1],X=N[2],te=U[0],se=U[1],le=U[2];return Math.abs(Z-te)<=B*Math.max(1,Math.abs(Z),Math.abs(te))&&Math.abs(K-se)<=B*Math.max(1,Math.abs(K),Math.abs(se))&&Math.abs(X-le)<=B*Math.max(1,Math.abs(X),Math.abs(le))})(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[d,m,_]=this.dir,v=this.pos[0]-e[0],S=this.pos[1]-e[1],A=this.pos[2]-e[2],D=d*d+m*m+_*_,P=2*(v*d+S*m+A*_),k=P*P-4*D*(v*v+S*S+A*A-i*i);if(k<0){const N=Math.max(-P/2,0),U=v+d*N,Z=S+m*N,K=A+_*N,X=Math.hypot(U,Z,K);return l[0]=U*i/X,l[1]=Z*i/X,l[2]=K*i/X,!1}{const N=(-P-Math.sqrt(k))/(2*D);if(N<0){const U=Math.hypot(v,S,A);return l[0]=v*i/U,l[1]=S*i/U,l[2]=A*i/U,!1}return l[0]=v+d*N,l[1]=S+m*N,l[2]=A+_*N,!0}}}class zr{constructor(e,i,l,d,m){this.TL=e,this.TR=i,this.BR=l,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(e,i,l){const d=[-1,1,1],m=[1,1,1],_=[1,-1,1],v=[-1,-1,1],S=cr(d,d,e),A=cr(m,m,e),D=cr(_,_,e),P=cr(v,v,e);return new zr(S,A,D,P,i/l)}}function Fi(r,e,i){let l=1/0,d=-1/0;const m=[];for(const _ of r){ui(m,_,e);const v=zi(m,i);l=Math.min(l,v),d=Math.max(d,v)}return[l,d]}function er(r,e){let i=!0;for(let l=0;l<r.planes.length;l++){const d=r.planes[l];let m=0;for(let _=0;_<e.length;_++)m+=+(zi(d,e[_])+d[3]>=0);if(m===0)return 0;m!==e.length&&(i=!1)}return i?2:1}function Ta(r,e){for(const i of r.projections){const l=Fi(e,r.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function Js(r,e){let i=0;const l=[0,0,0,0];for(let d=0;d<r.length;d++)l[0]=r[d][0],l[1]=r[d][1],l[2]=r[d][2],l[3]=1,Ur(l,e)>=0&&i++;return i}class Ps{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ii.fromPoints(this.points),this.projections=[],this.frustumEdges=[ui([],this.points[2],this.points[3]),ui([],this.points[0],this.points[3]),ui([],this.points[4],this.points[0]),ui([],this.points[5],this.points[1]),ui([],this.points[6],this.points[2]),ui([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const d=[0,-l[2],l[1]],m=[l[2],0,-l[0]];this.projections.push({axis:d,projection:Fi(this.points,this.points[0],d)}),this.projections.push({axis:m,projection:Fi(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,i,l,d){const m=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const D=vs([],A,e),P=1/D[3]/i*m;return(k=D)[0]=(N=D)[0]*(U=[P,P,d?1/D[3]:P,P])[0],k[1]=N[1]*U[1],k[2]=N[2]*U[2],k[3]=N[3]*U[3],k;var k,N,U}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const D=Gn([],jr([],ui([],_[A[0]],_[A[1]]),ui([],_[A[2]],_[A[1]]))),P=-zi(D,_[A[1]]);return D.concat(P)}),S=[];for(let A=0;A<_.length;A++)S.push([_[A][0],_[A][1],_[A][2]]);return new Ps(S,v)}intersectsPrecise(e,i,l){for(let d=0;d<i.length;d++)if(!Js(e,i[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Js(e,this.planes[d]))return 0;for(const d of l)for(const m of this.frustumEdges){const _=jr([],d,m),v=dn(_);if(v===0)continue;Ne(_,_,1/v);const S=Fi(this.points,this.points[0],_),A=Fi(e,this.points[0],_);if(S[0]>A[1]||A[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const l=i[3];if(zi([i[0],i[1],i[2]],e)+l<0)return!1}return!0}}class Ii{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const d of e)dt(i,i,d),Kt(l,l,d);return new Ii(i,l)}static fromTileIdAndHeight(e,i,l){const d=1<<e.canonical.z,m=e.canonical.x,_=e.canonical.y;return new Ii([m/d,_/d,i],[(m+1)/d,(_+1)/d,l])}static applyTransform(e,i){const l=e.getCorners();for(let d=0;d<l.length;++d)cr(l[d],l[d],i);return Ii.fromPoints(l)}static applyTransformFast(e,i){const l=[i[12],i[13],i[14]],d=[...l];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const v=i[4*_+m],S=v*e.min[_],A=v*e.max[_];l[m]+=Math.min(S,A),d[m]+=Math.max(S,A)}return new Ii(l,d)}static projectAabbCorners(e,i){const l=e.getCorners();for(let d=0;d<l.length;++d)cr(l[d],l[d],i);return l}constructor(e,i){this.min=e,this.max=i,this.center=Ne([],En([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=Zt(this.min),d=Zt(this.max);for(let m=0;m<i.length;m++)l[m]=i[m]?this.min[m]:this.center[m],d[m]=i[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Ii(l,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?er(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?er(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ta(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ta(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Bt(Ii,"Aabb");class fo{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,l=i[1],d=-i[0],m=(e.extent+1)*this.metersToTile;return[new Mt(Math.trunc(e.position[0]+l*m),Math.trunc(e.position[1]+d*m)),new Mt(Math.trunc(e.position[0]-l*m),Math.trunc(e.position[1]-d*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ea{constructor(e,i,l,d,m,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[yr(),yr(),yr(),yr(),yr(),yr(),yr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=i,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((S=this.vertices[v.a].position)[0]===(A=this.vertices[v.b].position)[0]&&S[1]===A[1]);var S,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Vi(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const S=this.vertices[v.a].position,A=this.vertices[v.b].position,D=cl(yr(),A,S),P=bo(D),k=Ca(yr(),D,1/P);this.edgeProps.push({vec:D,dir:k,len:P});const N=this.vertexProps[v.a].dir,U=this.vertexProps[v.b].dir;bs(N,N,k),bs(U,U,k)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||ms(v.dir,v.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[l,d]=i;return Cn(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,d)}computeSlopeNormal(e,i){const l=this.getClosestEdge(e);if(!l)return wt(0,0,1);const d=l[0],m=this.edges[d],_=this.edgeProps[d].vec,v=wt(_[0],_[1],(this.vertices[m.b].height-this.vertices[m.a].height)*i),S=wt(v[1],-v[0],0);jr(S,S,v);const A=dn(S);return A>0?Ne(S,S,1/A):Jt(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,l=Number.POSITIVE_INFINITY,d=0;const[m,_,v,S,A,D,P]=this._tmpVec2;ra(P,e.x,e.y);const k=new qn(P,null);for(let N=0;N<this.edges.length;N++){const U=this.edges[N],Z=this.edgeProps[N].dir;k.dir=Z;const K=this.vertices[U.a].position,X=this.vertices[U.b].position,te=k.intersectsPlane(K,this.vertexProps[U.a].dir,m),se=k.intersectsPlane(X,this.vertexProps[U.b].dir,_);if(!te||!se)continue;cl(v,_,m),cl(S,P,m);const le=ji(v,v),_e=le>0?ji(S,v)/le:0,me=xe(_e,0,1),Ee=Math.abs((_e-me)*this.edgeProps[N].len);cl(A,P,K),ra(D,Z[1],-Z[0]);const Se=Ee+Math.abs(ji(A,D));Se<l&&(i=N,l=Se,d=me)}return[i,d]}tessellate(e){const i=be(),l=be(),d=be(),m=be();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,S=this.edges[_].b,{position:A,height:D,extent:P}=this.vertices[v],{position:k,height:N,extent:U}=this.vertices[S],Z=this.vertexProps[v].dir,K=this.vertexProps[S].dir;if(Jt(i,A[0]/e,A[1]/e,D),Jt(l,k[0]/e,k[1]/e,N),Jt(d,Z[1],-Z[0],0),Ne(d,d,P),Jt(m,K[1],-K[0],0),Ne(m,m,U),this.distSqLines(wt(i[0]+.5*d[0],i[1]+.5*d[1],i[2]+.5*d[2]),wt(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),wt(i[0]-.5*d[0],i[1]-.5*d[1],i[2]-.5*d[2]),wt(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]))<=.0025000000000000005)continue;const X=this.vertices.length,te=bs(yr(),A,k);this.vertices.push({position:Ca(te,te,.5),height:.5*(D+N),extent:.5*(P+U)});const se=bs(yr(),Z,K);this.vertexProps.push({dir:ms(se,se)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:X}),this.edges.push({a:X,b:S});const le=cl(yr(),this.vertices[X].position,A),_e=bo(le),me={vec:le,dir:Ca(yr(),le,1/_e),len:_e};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(e,i,l,d){const m=ci(be(),i,e),_=ci(be(),d,l),v=ci(be(),e,l),S=zi(m,m),A=zi(m,_),D=zi(m,v),P=zi(_,_),k=zi(_,v),N=S*P-A*A;if(N===0)return Zn(Va(m,l,d,zi(v,_)/zi(_,_)),e);const U=(S*k-A*D)/N;return Zn(Va(m,e,i,(A*k-D*P)/N),Va(_,l,d,U))}}class ca{static parseFrom(e,i){const l=Bn.parse(e);if(!l)return[];let{vertices:d,features:m}=l;const _=1/Pt(i);m.sort((D,P)=>D.id-P.id),d.sort((D,P)=>D.id-P.id||D.idx-P.idx),d=d.filter((D,P,k)=>P===k.findIndex(N=>N.id===D.id&&N.idx===D.idx));const v=new Array;let S=0;const A=d.length;for(const D of m){if(D.constantHeight){v.push(new ea(D.id,D.bounds,D.constantHeight));continue}for(;S!==A&&d[S].id<D.id;)S++;if(S===A||d[S].id!==D.id)continue;const P=new Array,k=new Array,N=S;for(;S!==A&&d[S].id===D.id;){const U=d[S];if(P.push({position:U.position,height:U.height,extent:U.extent}),S!==N&&d[S-1].idx===U.idx-1){const Z=S-N;k.push({a:Z-1,b:Z})}S++}v.push(new ea(D.id,D.bounds,void 0,P,k,_))}return v}static getElevationFeature(e,i){if(!i)return;const l=+e.properties[li];return Number.isNaN(l)?void 0:i.find(d=>d.id===l)}}class jo{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*jt,this.yOffset=(e.y*this.zScale-i.y)*jt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,l){const d=this.constantElevation(i,l);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),l))}computeBiasedHeight(e,i){return i<=0?e:e+i*Be(0,i,e>=0?e:Math.abs(.5*e))}}Bt(ea,"ElevationFeature");class Xa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new iu,this.indexArray=new xs,this.segments=new mr,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Gs),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){const m=this.layers[0],_=[];let v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(const{feature:A,id:D,index:P,sourceLayerIndex:k}of e){const N=this.layers[0]._featureFilter.needGeometry,U=Vn(A,N);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),U,l))continue;const Z=v?v.evaluate(U,{},l):void 0,K={id:D,properties:A.properties,type:A.type,sourceLayerIndex:k,index:P,geometry:N?U.geometry:Mn(A,l,d),patterns:{},sortKey:Z};_.push(K)}v&&_.sort((A,D)=>A.sortKey-D.sortKey);let S=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Mh,S=d.projection);for(const A of _){const{geometry:D,index:P,sourceLayerIndex:k}=A,N=e[P].feature;this.addFeature(A,D,P,i.availableImages,l,S,i.brightness,i.elevationFeatures),i.featureIndex.insert(N,D,P,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Od.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Xl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,l,d,m,_,v,S){let A;this.elevationMode!=="none"&&(A=ca.getElevationFeature(e,S));for(const D of i)for(const P of D){const k=P.x,N=P.y;if(k<0||k>=jt||N<0||N>=jt)continue;if(_){const K=_.projectTilePoint(k,N,m),X=_.upVector(m,k,N);this.addGlobeExtVertex(K,X),this.addGlobeExtVertex(K,X),this.addGlobeExtVertex(K,X),this.addGlobeExtVertex(K,X)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Z=U.vertexLength;if(this.addCircleVertex(k,N,-1,-1),this.addCircleVertex(k,N,1,-1),this.addCircleVertex(k,N,1,1),this.addCircleVertex(k,N,-1,1),this.elevationMode!=="none"){const K=A?A.pointElevation(new Mt(k,N)):0;this.hasElevation=this.hasElevation||K!==0;for(let X=0;X<4;X++)this.elevatedLayoutVertexArray.emplaceBack(K)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},d,m,v,void 0,this.worldview)}addCircleVertex(e,i,l,d){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*i+(d+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Tr(r,e){for(let i=0;i<r.length;i++)if(mo(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(mo(r,e[i]))return!0;return!!Cs(r,e)}function Qr(r,e,i){return!!mo(r,e)||!!Yl(e,r,i)}function rr(r,e){if(r.length===1)return Bh(e,r[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let d=0;d<l.length;d++)if(mo(r,l[d]))return!0}for(let i=0;i<r.length;i++)if(Bh(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Cs(r,e[i]))return!0;return!1}function rs(r,e,i){if(r.length>1){if(Cs(r,e))return!0;for(let l=0;l<e.length;l++)if(Yl(e[l],r,i))return!0}for(let l=0;l<r.length;l++)if(Yl(r[l],e,i))return!0;return!1}function Cs(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const l=r[i],d=r[i+1];for(let m=0;m<e.length-1;m++)if(Ir(l,d,e[m],e[m+1]))return!0}return!1}function Ir(r,e,i,l){return $i(r,i,l)!==$i(e,i,l)&&$i(r,e,i)!==$i(r,e,l)}function po(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Fd(r,e,i,l){const d=po(r,e,l),m=po(r,e,i);if(Math.sign(d)===Math.sign(m))return;const _=po(i,l,r),v=_+m-d;return Math.sign(_)!==Math.sign(v)?[_/(_-v),m/(m-d)]:void 0}function Yl(r,e,i){const l=i*i;if(e.length===1)return r.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(Nh(r,e[d-1],e[d])<l)return!0;return!1}function Nh(r,e,i){const l=e.distSqr(i);if(l===0)return r.distSqr(e);const d=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/l;return r.distSqr(d<0?e:d>1?i:i.sub(e)._mult(d)._add(e))}function Bh(r,e){let i,l,d,m=!1;for(let _=0;_<r.length;_++){i=r[_];for(let v=0,S=i.length-1;v<i.length;S=v++)l=i[v],d=i[S],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(m=!m)}return m}function mo(r,e){let i=!1;for(let l=0,d=r.length-1;l<r.length;d=l++){const m=r[l],_=r[d];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(i=!i)}return i}function il(r,e,i,l,d){for(const _ of r)if(e<=_.x&&i<=_.y&&l>=_.x&&d>=_.y)return!0;const m=[new Mt(e,i),new Mt(e,d),new Mt(l,d),new Mt(l,i)];if(r.length>2){for(const _ of m)if(mo(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Kl(r[_],r[_+1],m))return!0;return!1}function Kl(r,e,i){const l=i[0],d=i[2];if(r.x<l.x&&e.x<l.x||r.x>d.x&&e.x>d.x||r.y<l.y&&e.y<l.y||r.y>d.y&&e.y>d.y)return!1;const m=$i(r,e,i[0]);return m!==$i(r,e,i[1])||m!==$i(r,e,i[2])||m!==$i(r,e,i[3])}function Uo(r,e,i,l,d,m){let _=e.y-r.y,v=r.x-e.x;if(m=m||0){const S=_*_+v*v;if(S===0)return!0;const A=Math.sqrt(S);_/=A,v/=A}return!((i.x-r.x)*_+(i.y-r.y)*v-m<0||(l.x-r.x)*_+(l.y-r.y)*v-m<0||(d.x-r.x)*_+(d.y-r.y)*v-m<0)}function ar(r,e,i,l,d,m,_){return!(Uo(r,e,l,d,m,_)||Uo(e,i,l,d,m,_)||Uo(i,r,l,d,m,_)||Uo(l,d,r,e,i,_)||Uo(d,m,r,e,i,_)||Uo(m,l,r,e,i,_))}function ou(r,e,i){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(r)}function om(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function nx(r,e,i,l,d){if(!e[0]&&!e[1])return r;const m=Mt.convert(e)._mult(d);i==="viewport"&&m._rotate(-l);const _=[];for(let v=0;v<r.length;v++)_.push(r[v].sub(m));return _}function n0(r,e,i,l){const d=Mt.convert(r)._mult(l);return e==="viewport"&&d._rotate(-i),d}let i0,r0;function wg(r,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Bt(Xa,"CircleBucket",{omit:["layers"]});class Ac{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=Vd(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const l=(function(m,_,v){var S=wg(256*m,256*(_=Math.pow(2,v)-_-1),v),A=wg(256*(m+1),256*(_+1),v);return S[0]+","+S[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),d=(function(m,_,v){let S,A="";for(let D=m;D>0;D--)S=1<<D-1,A+=(_&S?1:0)+(v&S?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class k_{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Vd(e,i.z,i.z,i.x,i.y)}}class ua{constructor(e,i,l,d,m){this.overscaledZ=e,this.wrap=i,this.canonical=new Ac(l,+d,+m),this.key=i===0&&e===l?this.canonical.key:Vd(i,e,l,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ua(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ua(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Vd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Vd(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ua(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new ua(i,this.wrap,i,l,d),new ua(i,this.wrap,i,l+1,d),new ua(i,this.wrap,i,l,d+1),new ua(i,this.wrap,i,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ua(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ua(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new k_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vd(r,e,i,l,d){const m=1<<Math.min(i,22);let _=m*(d%m)+l%m;return r&&i<22&&(_+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const jd=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new ua(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new ua(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new ua(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new ua(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Bt(Ac,"CanonicalTileID"),Bt(ua,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ju=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ud}=ju,q1=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var ix=ei([{name:"a_pos",type:"Int16",components:2}]);function Tg(r){return r*ee/Ae}const s0=[new Ii([fe,fe,fe],[ue,ue,ue]),new Ii([fe,fe,fe],[0,0,ue]),new Ii([0,fe,fe],[ue,0,ue]),new Ii([fe,0,fe],[0,ue,ue]),new Ii([0,0,fe],[ue,ue,ue])];function rx(r,e,i,l=!0){const d=Ne([],r._camera.position,r.worldSize),m=[e,i,1,1];vs(m,m,r.pixelMatrixInverse),Rl(m,m,1/m[3]);const _=Gn([],ui([],m,d)),v=r.globeMatrix,S=[v[12],v[13],v[14]],A=ui([],S,d),D=dn(A),P=Gn([],A),k=r.worldSize/(2*Math.PI),N=zi(P,_),U=Math.asin(k/D);if(U<Math.acos(N)){if(!l)return null;const Me=[],Oe=[];Ne(Me,_,D/N),Gn(Oe,ui(Oe,Me,A)),Gn(_,En(_,A,Ne(_,Oe,Math.tan(U)*D)))}const Z=[];new Ji(d,_).closestPointOnSphere(S,k,Z);const K=Gn([],hr(v,0)),X=Gn([],hr(v,1)),te=Gn([],hr(v,2)),se=zi(K,Z),le=zi(X,Z),_e=zi(te,Z),me=Ue(Math.asin(-le/k));let Ee=Ue(Math.atan2(se,_e));Ee=r.center.lng+(function(Me,Oe){const pt=(Oe-Me+180)%360-180;return pt<-180?pt+360:pt})(r.center.lng,Ee);const Se=Fe(Ee),we=xe(We(me),0,1);return new qt(Se,we)}class H1{constructor(e,i,l){this.a=ui([],e,l),this.b=ui([],i,l),this.center=l;const d=Gn([],this.a),m=Gn([],this.b);this.angle=Math.acos(zi(d,m))}}function Eg(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(l,d,m,_){const v=Math.sin(m);return l*(Math.sin((1-_)*m)/v)+d*(Math.sin(_*m)/v)})(r.a[e],r.b[e],r.angle,xe(i,0,1))+r.center[e]}function lu(r){if(r.z<=1)return s0[r.z+2*r.y+r.x];const e=sx(lm(r));return Ii.fromPoints(e)}function Uu(r,e,i){return Ne(r,r,1-i),wn(r,r,e,i)}function a0(r,e,i){for(const l of r)cr(l,l,e),Ne(l,l,i)}function L_(r,e,i,l){const d=e/r.worldSize,m=r.globeMatrix;if(i.z<=1){const we=lu(i).getCorners();return a0(we,m,d),Ii.fromPoints(we)}const _=lm(i,l),v=sx(_,ee+Tg(r._tileCoverLift));a0(v,m,d);const S=Number.MAX_VALUE,A=[-S,-S,-S],D=[S,S,S];if(_.contains(r.center)){for(const Oe of v)dt(D,D,Oe),Kt(A,A,Oe);A[2]=0;const we=r.point,Me=[we.x*d,we.y*d,0];return dt(D,D,Me),Kt(A,A,Me),new Ii(D,A)}if(r._tileCoverLift>0){for(const we of v)dt(D,D,we),Kt(A,A,we);return new Ii(D,A)}const P=[m[12]*d,m[13]*d,m[14]*d],k=_.getCenter(),N=xe(r.center.lat,-85.051129,ke),U=xe(k.lat,-85.051129,ke),Z=Fe(r.center.lng),K=We(N);let X=Z-Fe(k.lng);const te=K-We(U);X>.5?X-=1:X<-.5&&(X+=1);let se=0;Math.abs(X)>Math.abs(te)?se=X>=0?1:3:(se=te>=0?0:2,wn(P,P,[m[4]*d,m[5]*d,m[6]*d],-Math.sin(ai(te>=0?_.getSouth():_.getNorth()))*ee));const le=v[se],_e=v[(se+1)%4],me=new H1(le,_e,P),Ee=[Eg(me,0)||le[0],Eg(me,1)||le[1],Eg(me,2)||le[2]],Se=Fh(r.zoom);if(Se>0){const we=(function({x:Oe,y:pt,z:ot},ut,Tt,vt,bt){const rt=1/(1<<ot);let At=Oe*rt,_t=At+rt,Ct=pt*rt,Et=Ct+rt,nn=0;const rn=(At+_t)/2-vt;return rn>.5?nn=-1:rn<-.5&&(nn=1),At=((At+nn)*ut-(vt*=ut))*Tt+vt,_t=((_t+nn)*ut-vt)*Tt+vt,Ct=(Ct*ut-(bt*=ut))*Tt+bt,Et=(Et*ut-bt)*Tt+bt,[[At,Et,0],[_t,Et,0],[_t,Ct,0],[At,Ct,0]]})(i,e,r._pixelsPerMercatorPixel,Z,K);for(let Oe=0;Oe<v.length;Oe++)Uu(v[Oe],we[Oe],Se);const Me=En([],we[se],we[(se+1)%4]);Ne(Me,Me,.5),Uu(Ee,Me,Se)}for(const we of v)dt(D,D,we),Kt(A,A,we);return D[2]=Math.min(le[2],_e[2]),dt(D,D,Ee),Kt(A,A,Ee),new Ii(D,A)}function lm({x:r,y:e,z:i},l=!1){const d=1/(1<<i),m=new ge(lt(r*d),e===(1<<i)-1&&l?-90:xt((e+1)*d)),_=new ge(lt((r+1)*d),e===0&&l?90:xt(e*d));return new Pe(m,_)}function sx(r,e=ee){const i=ai(r.getNorth()),l=ai(r.getSouth()),d=Math.cos(i),m=Math.cos(l),_=Math.sin(i),v=Math.sin(l),S=r.getWest(),A=r.getEast();return[Ie(m,v,S,e),Ie(m,v,A,e),Ie(d,_,A,e),Ie(d,_,S,e)]}function Sg(r,e,i,l){const d=1<<i.z,m=(r/jt+i.x)/d;return Te(xt((e/jt+i.y)/d),lt(m),l)}function Gd({min:r,max:e}){return 16383/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const o0=new Float64Array(16);function Ag(r){const e=Gd(r),i=ze(o0,[e,e,e]);return ht(i,i,Xi([],r.min))}function or(r){const e=(function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l})(o0,r.min),i=1/Gd(r);return Ft(e,e,[i,i,i])}function Ig(r){const e=jt/(2*Math.PI);return r/(2*Math.PI)/e}function Cg(r,e){return jt/(512*Math.pow(2,r))*Gd(lu(e))}function z_(r,e,i,l,d){const m=Ig(i),_=[r,e,-i/(2*Math.PI)],v=Xe(new Float64Array(16));return ht(v,v,_),Ft(v,v,[m,m,m]),fn(v,v,ai(-d)),St(v,v,ai(-l)),v}function Fh(r){return Be(5,6,r)}function O_(r,e){const i=Te(e.lat,e.lng),l=(function(U){const Z=Te(U._center.lat,U._center.lng);let K=jr([],wt(0,1,0),Z);const X=Ve([],-U.angle,Z);K=cr(K,K,X),Ve(X,-U._pitch,K);const te=Gn([],Z);return Ne(te,te,Tg(U.cameraToCenterDistance/U.pixelsPerMeter)),cr(te,te,X),En([],Z,te)})(r);return _=(d=ci([],l,i))[0],v=d[1],S=d[2],A=(m=i)[0],D=m[1],P=m[2],N=(k=Math.sqrt((_*_+v*v+S*S)*(A*A+D*D+P*P)))&&zi(d,m)/k,Math.acos(Math.min(Math.max(N,-1),1));var d,m,_,v,S,A,D,P,k,N}function np(r,e){return O_(r,e)>Math.PI/2*1.01}const Rg=ai(85),$1=Math.cos(Rg),l0=Math.sin(Rg),Z1=Je(),c0=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function ax(r,e,i,l,d,m,_,v,S){if(m&&r.queryGeometry.isAboveHorizon)return!1;m&&(S*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,D=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const k of P){const N=k.add(v),U=d&&i.elevation?i.elevation.exaggeration()*d.getElevationAt(N.x,N.y,!0):0,Z=i.projection.projectTilePoint(N.x,N.y,A);if(U>0){const se=i.projection.upVector(A,N.x,N.y);Z.x+=se[0]*D*U,Z.y+=se[1]*D*U,Z.z+=se[2]*D*U}const K=m?N:u0(Z.x,Z.y,Z.z,l),X=m?r.tilespaceRays.map(se=>go(se,U)):r.queryGeometry.screenGeometry,te=vs([],[Z.x,Z.y,Z.z,1],l);if(!_&&m?S*=te[3]/i.cameraToCenterDistance:_&&!m&&(S*=i.cameraToCenterDistance/te[3]),m){const se=xt((k.y/jt+A.y)/(1<<A.z));S/=i.projection.pixelsPerMeter(se,1)/$e(1,se)}if(Qr(X,K,S))return!0}return!1}function u0(r,e,i,l){const d=vs([],[r,e,i,1],l);return new Mt(d[0]/d[3],d[1]/d[3])}const ss=wt(0,0,0),ox=wt(0,0,1);function go(r,e){const i=be();return ss[2]=e,r.intersectsPlane(ss,ox,i),new Mt(i[0],i[1])}class h0 extends Xa{}let lx,d0,N_,B_;function Mg(r,{width:e,height:i},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*i*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*i*l);return r.width=e,r.height=i,r.data=d,r}function cx(r,e,i){const{width:l,height:d}=e;l===r.width&&d===r.height||(F_(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,d)},i,null),r.width=l,r.height=d,r.data=e.data)}function F_(r,e,i,l,d,m,_,v){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||i.x>r.width-d.width||i.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const S=r.data,A=e.data,D=m===4&&v;for(let P=0;P<d.height;P++){const k=((i.y+P)*r.width+i.x)*m,N=((l.y+P)*e.width+l.x)*m;if(D)for(let U=0;U<d.width;U++){const Z=k+U*m+3,K=N+U*m;A[K+0]=255,A[K+1]=255,A[K+2]=255,A[K+3]=S[Z]}else if(_)for(let U=0;U<d.width;U++){const Z=k+U*m,K=N+U*m,X=new Si(S[Z+0]/255,S[Z+1]/255,S[Z+2]/255,S[Z+3]).toNonPremultipliedRenderColor(_).toArray();A[K+0]=X[0],A[K+1]=X[1],A[K+2]=X[2],A[K+3]=X[3]}else for(let U=0;U<d.width*m;U++)A[N+U]=S[k+U]}return e}Bt(h0,"HeatmapBucket",{omit:["layers"]});class Gu{constructor(e,i){Mg(this,e,1,i)}resize(e){cx(this,new Gu(e),1)}clone(){return new Gu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,d,m){F_(e,i,l,d,m,1,null)}}class ta{constructor(e,i){Mg(this,e,4,i)}resize(e){cx(this,new ta(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,d,m,_,v){F_(e,i,l,d,m,4,_,v)}}class f0{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function cm(r){const e={},i=r.resolution||256,l=r.clips?r.clips.length:1,d=r.image||new ta({width:i,height:l}),m=(_,v,S)=>{e[r.evaluationKey]=S;const A=r.expression.evaluate(e),D=A?A.toNonPremultipliedRenderColor(null):null;D&&(d.data[_+v+0]=Math.floor(255*D.r),d.data[_+v+1]=Math.floor(255*D.g),d.data[_+v+2]=Math.floor(255*D.b),d.data[_+v+3]=Math.floor(255*D.a))};if(r.clips)for(let _=0,v=0;_<l;++_,v+=4*i)for(let S=0,A=0;S<i;S++,A+=4){const D=S/(i-1),{start:P,end:k}=r.clips[_];m(v,A,P*(1-D)+k*D)}else for(let _=0,v=0;_<i;_++,v+=4)m(0,v,_/(i-1));return d}Bt(Gu,"AlphaImage"),Bt(ta,"RGBAImage");const W1=ei([{name:"a_pos",components:2,type:"Int16"}],4),p0=ei([{name:"a_road_z_offset",components:1,type:"Float32"}],4),X1=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Y1=ei([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ql(r,e,i=2){const l=e&&e.length,d=l?e[0]*i:r.length;let m=ux(r,0,d,i,!0);const _=[];if(!m||m.next===m.prev)return _;let v,S,A;if(l&&(m=(function(D,P,k,N){const U=[];for(let Z=0,K=P.length;Z<K;Z++){const X=ux(D,P[Z]*N,Z<K-1?P[Z+1]*N:D.length,N,!1);X===X.next&&(X.steiner=!0),U.push(g0(X))}U.sort(dx);for(let Z=0;Z<U.length;Z++)k=J1(U[Z],k);return k})(r,e,m,i)),r.length>80*i){v=r[0],S=r[1];let D=v,P=S;for(let k=i;k<d;k+=i){const N=r[k],U=r[k+1];N<v&&(v=N),U<S&&(S=U),N>D&&(D=N),U>P&&(P=U)}A=Math.max(D-v,P-S),A=A!==0?32767/A:0}return ip(m,_,i,v,S,A,0),_}function ux(r,e,i,l,d){let m;if(d===(function(_,v,S,A){let D=0;for(let P=v,k=S-A;P<S;P+=A)D+=(_[k]-_[P])*(_[P+1]+_[k+1]),k=P;return D})(r,e,i,l)>0)for(let _=e;_<i;_+=l)m=px(_/l|0,r[_],r[_+1],m);else for(let _=i-l;_>=e;_-=l)m=px(_/l|0,r[_],r[_+1],m);return m&&rp(m,m.next)&&(zg(m),m=m.next),m}function qd(r,e){if(!r)return r;e||(e=r);let i,l=r;do if(i=!1,l.steiner||!rp(l,l.next)&&Cr(l.prev,l,l.next)!==0)l=l.next;else{if(zg(l),l=e=l.prev,l===l.next)break;i=!0}while(i||l!==e);return e}function ip(r,e,i,l,d,m,_){if(!r)return;!_&&m&&(function(S,A,D,P){let k=S;do k.z===0&&(k.z=Dg(k.x,k.y,A,D,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==S);k.prevZ.nextZ=null,k.prevZ=null,(function(N){let U,Z=1;do{let K,X=N;N=null;let te=null;for(U=0;X;){U++;let se=X,le=0;for(let me=0;me<Z&&(le++,se=se.nextZ,se);me++);let _e=Z;for(;le>0||_e>0&&se;)le!==0&&(_e===0||!se||X.z<=se.z)?(K=X,X=X.nextZ,le--):(K=se,se=se.nextZ,_e--),te?te.nextZ=K:N=K,K.prevZ=te,te=K;X=se}te.nextZ=null,Z*=2}while(U>1)})(k)})(r,l,d,m);let v=r;for(;r.prev!==r.next;){const S=r.prev,A=r.next;if(m?Q1(r,l,d,m):K1(r))e.push(S.i,r.i,A.i),zg(r),r=A.next,v=A.next;else if((r=A)===v){_?_===1?ip(r=m0(qd(r),e),e,i,l,d,m,2):_===2&&hx(r,e,i,l,d,m):ip(qd(r),e,i,l,d,m,1);break}}}function K1(r){const e=r.prev,i=r,l=r.next;if(Cr(e,i,l)>=0)return!1;const d=e.x,m=i.x,_=l.x,v=e.y,S=i.y,A=l.y,D=Math.min(d,m,_),P=Math.min(v,S,A),k=Math.max(d,m,_),N=Math.max(v,S,A);let U=l.next;for(;U!==e;){if(U.x>=D&&U.x<=k&&U.y>=P&&U.y<=N&&um(d,v,m,S,_,A,U.x,U.y)&&Cr(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Q1(r,e,i,l){const d=r.prev,m=r,_=r.next;if(Cr(d,m,_)>=0)return!1;const v=d.x,S=m.x,A=_.x,D=d.y,P=m.y,k=_.y,N=Math.min(v,S,A),U=Math.min(D,P,k),Z=Math.max(v,S,A),K=Math.max(D,P,k),X=Dg(N,U,e,i,l),te=Dg(Z,K,e,i,l);let se=r.prevZ,le=r.nextZ;for(;se&&se.z>=X&&le&&le.z<=te;){if(se.x>=N&&se.x<=Z&&se.y>=U&&se.y<=K&&se!==d&&se!==_&&um(v,D,S,P,A,k,se.x,se.y)&&Cr(se.prev,se,se.next)>=0||(se=se.prevZ,le.x>=N&&le.x<=Z&&le.y>=U&&le.y<=K&&le!==d&&le!==_&&um(v,D,S,P,A,k,le.x,le.y)&&Cr(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;se&&se.z>=X;){if(se.x>=N&&se.x<=Z&&se.y>=U&&se.y<=K&&se!==d&&se!==_&&um(v,D,S,P,A,k,se.x,se.y)&&Cr(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;le&&le.z<=te;){if(le.x>=N&&le.x<=Z&&le.y>=U&&le.y<=K&&le!==d&&le!==_&&um(v,D,S,P,A,k,le.x,le.y)&&Cr(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function m0(r,e){let i=r;do{const l=i.prev,d=i.next.next;!rp(l,d)&&kg(l,i,i.next,d)&&Lg(l,d)&&Lg(d,l)&&(e.push(l.i,i.i,d.i),zg(i),zg(i.next),i=r=d),i=i.next}while(i!==r);return qd(i)}function hx(r,e,i,l,d,m){let _=r;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&Pg(_,v)){let S=sp(_,v);return _=qd(_,_.next),S=qd(S,S.next),ip(_,e,i,l,d,m,0),void ip(S,e,i,l,d,m,0)}v=v.next}_=_.next}while(_!==r)}function dx(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function J1(r,e){const i=(function(d,m){let _=m;const v=d.x,S=d.y;let A,D=-1/0;if(rp(d,_))return _;do{if(rp(d,_.next))return _.next;if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const Z=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Z<=v&&Z>D&&(D=Z,A=_.x<_.next.x?_:_.next,Z===v))return A}_=_.next}while(_!==m);if(!A)return null;const P=A,k=A.x,N=A.y;let U=1/0;_=A;do{if(v>=_.x&&_.x>=k&&v!==_.x&&fx(S<N?v:D,S,k,N,S<N?D:v,S,_.x,_.y)){const Z=Math.abs(S-_.y)/(v-_.x);Lg(_,d)&&(Z<U||Z===U&&(_.x>A.x||_.x===A.x&&Ic(A,_)))&&(A=_,U=Z)}_=_.next}while(_!==P);return A})(r,e);if(!i)return e;const l=sp(i,r);return qd(l,l.next),qd(i,i.next)}function Ic(r,e){return Cr(r.prev,r,e.prev)<0&&Cr(e.next,r,r.next)<0}function Dg(r,e,i,l,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g0(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function fx(r,e,i,l,d,m,_,v){return(d-_)*(e-v)>=(r-_)*(m-v)&&(r-_)*(l-v)>=(i-_)*(e-v)&&(i-_)*(m-v)>=(d-_)*(l-v)}function um(r,e,i,l,d,m,_,v){return!(r===_&&e===v)&&fx(r,e,i,l,d,m,_,v)}function Pg(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,l){let d=i;do{if(d.i!==i.i&&d.next.i!==i.i&&d.i!==l.i&&d.next.i!==l.i&&kg(d,d.next,i,l))return!0;d=d.next}while(d!==i);return!1})(r,e)&&(Lg(r,e)&&Lg(e,r)&&(function(i,l){let d=i,m=!1;const _=(i.x+l.x)/2,v=(i.y+l.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&_<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==i);return m})(r,e)&&(Cr(r.prev,r,e.prev)||Cr(r,e.prev,e))||rp(r,e)&&Cr(r.prev,r,r.next)>0&&Cr(e.prev,e,e.next)>0)}function Cr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function rp(r,e){return r.x===e.x&&r.y===e.y}function kg(r,e,i,l){const d=V_(Cr(r,e,i)),m=V_(Cr(r,e,l)),_=V_(Cr(i,l,r)),v=V_(Cr(i,l,e));return d!==m&&_!==v||!(d!==0||!Cc(r,i,e))||!(m!==0||!Cc(r,l,e))||!(_!==0||!Cc(i,r,l))||!(v!==0||!Cc(i,e,l))}function Cc(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function V_(r){return r>0?1:r<0?-1:0}function Lg(r,e){return Cr(r.prev,r,r.next)<0?Cr(r,e,r.next)>=0&&Cr(r,r.prev,e)>=0:Cr(r,e,r.prev)<0||Cr(r,r.next,e)<0}function sp(r,e){const i=mx(r.i,r.x,r.y),l=mx(e.i,e.x,e.y),d=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=d,d.prev=i,l.next=i,i.prev=l,m.next=l,l.prev=m,l}function px(r,e,i,l){const d=mx(r,e,i);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function zg(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function mx(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Og(r,e){const i=r.length;if(i<=1)return[r];const l=[];let d,m;for(let _=0;_<i;_++){const v=vr(r[_]);v!==0&&(r[_].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(d&&l.push(d),d=[r[_]]):d.push(r[_]))}if(d&&l.push(d),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(gf(l[_],e,1,l[_].length-1,ew),l[_]=l[_].slice(0,e));return l}function ew(r,e){return e.area-r.area}function _0(r,e,i=1){if(!r)return null;const l=typeof r=="string"?so.from(r).getPrimary():r.getPrimary(),d=typeof r=="string"?null:r.getSecondary();for(const m of[l,d]){if(!m)continue;const _=m.id.toString();e.has(_)||e.set(_,[]),m.scaleSelf(i),e.get(_).push(m)}return{primary:l.toString(),secondary:d?d.toString():null}}function gx(r,e,i,l){const d=l.patternDependencies;let m=!1;for(const _ of e){const v=_.paint.get(`${r}-pattern`);v.isConstant()||(m=!0),_0(v.constantOr(null),d,i)&&(m=!0)}return m}function _x(r,e,i,l,d,m){const _=m.patternDependencies;for(const v of e){const S=v.paint.get(`${r}-pattern`).value;if(S.kind!=="constant"){let A=S.evaluate({zoom:l},i,{},m.availableImages);A=A&&A.name?A.name:A;const D=_0(A,_,d);if(!D)continue;const{primary:P,secondary:k}=D;P&&(i.patterns[v.id]=[P,k].filter(Boolean))}}return i}class qu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=jt&&i>=jt}static evaluate(e){if(e.length===0)return new qu;let i=[];for(const S of e)i.push(...S.portals);if(i.length===0)return new qu;for(const S of i){const A=S.va,D=S.vb;(qu.isOnBorder(A.x,D.x)||qu.isOnBorder(A.y,D.y))&&(S.type="border")}const l=i.filter(S=>S.type!=="unevaluated"),d=i.filter(S=>S.type==="unevaluated");if(d.length===0)return new qu;d.sort((S,A)=>S.hash===A.hash?S.isTunnel===A.isTunnel?0:S.isTunnel?-1:1:S.hash<A.hash?1:-1),i=l.concat(d);let m=l.length,_=m,v=m;do if(_++,_===i.length||i[m].hash!==i[_].hash){if(_-m===2){v<m&&(i[v]=i[m],i[m]=null);const S=i[v],A=i[_-1];S.type=S.isTunnel!==A.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:A.connection.a},v++}m=_}while(m!==i.length);return i.splice(v),i.sort((S,A)=>S.hash<A.hash?1:-1),{portals:i}}}Bt(qu,"ElevationPortalGraph");class hm{constructor(e,i,l){this.outPositions=e,this.outNormals=i,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,i,l){let d=e[2];l!=null&&(d*=l);const m=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(m);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(m,v);const S=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),D=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(S,A,D),v}addTriangle(e,i,l){this.outIndices.emplaceBack(e,i,l)}addTriangles(e,i,l){if(e.length===0)return;const d=l.length===1,m=be(),_=be();for(let v=0;v<e.length;v+=3){const S=i[e[v+0]],A=i[e[v+1]],D=i[e[v+2]],P=d?l[0]:l[e[v+1]],k=d?l[0]:l[e[v+2]];Jt(m,S.x,S.y,d?l[0]:l[e[v+0]]);const N=this.addVertex(m,_);Jt(m,A.x,A.y,P);const U=this.addVertex(m,_);Jt(m,D.x,D.y,k);const Z=this.addVertex(m,_);this.outIndices.emplaceBack(N,U,Z)}}addQuad(e,i,l,d,m,_){const v=this.addVertex(e,m,_),S=this.addVertex(i,m,_),A=this.addVertex(l,m,_),D=this.addVertex(d,m,_);this.addTriangle(v,S,A),this.addTriangle(A,D,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Oa{constructor(e,i,l,d){this.unevaluatedPortals=new qu,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Rd,this.vertexNormals=new Xf,this.indexArray=new xs,this.tileToMeters=Pt(e),this.bridgeProgramConfigurations=new O(i,{zoom:l,lut:d},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new O(i,{zoom:l,lut:d},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,i){const l=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(i[d]);return l}addTriangles(e,i,l){const d=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)d.push(m+i)}addRenderableRing(e,i,l,d,m,_){const v=[new Mt(m.min.x,m.min.y),new Mt(m.max.x,m.min.y),new Mt(m.max.x,m.max.y),new Mt(m.min.x,m.max.y)];for(let S=0;S<l-1;S++){const A=i+S,D=A+1,P=this.unevalVertices[A],k=this.unevalVertices[D];if(!(P.x>=m.min.x&&P.x<=m.max.x&&P.y>=m.min.y&&P.y<=m.max.y||k.x>=m.min.x&&k.x<=m.max.x&&k.y>=m.min.y&&k.y<=m.max.y||Kl(P,k,v))||this.isOnBorder(P.x,k.x)||this.isOnBorder(P.y,k.y))continue;const N=Oa.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[D]);let U,Z=this.vertexHashLookup.get(Oa.computePosHash(P));Z!=null?U=Z.next:(Z=this.vertexHashLookup.get(Oa.computePosHash(k)),U=Z!=null?Z.prev:N),this.unevalEdges.push({polygonIdx:e,a:A,b:D,hash:N,portalHash:U,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,l,d,m){if(i.length!==0){this.vertexHashLookup.clear();for(const _ of i){if(_.length===0)continue;const v=_[0];let S=Oa.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let A=0;A<v.length-1;A++){const D=v[A+0],P=v[A+1],k=Vi(P.x-D.x,P.y-D.y),N=bo(k);if(N===0)continue;let U="unevaluated";const Z=d.pointElevation(D),K=d.pointElevation(P);Math.abs(Z)<.01&&Math.abs(K)<.01?U="entrance":(this.isOnBorder(D.x,P.x)||this.isOnBorder(D.y,P.y))&&(U="border");const X=Oa.computeEdgeHash(D,P);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:D,vb:P,vab:k,length:N,hash:X,isTunnel:l,type:U});const te=Oa.computePosHash(D);this.vertexHashLookup.set(te,{prev:S,next:X}),S=X}}}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},d=new hm(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=i(),_=i(),v=i(),S=(k,N)=>{k.sort((Z,K)=>Z.type===N&&K.type!==N?-1:Z.type!==N&&K.type===N?1:0);const U=k.findIndex(Z=>Z.type!==N);return U>=0?U:k.length};let A=0;this.unevalEdges.length>0&&(A=S(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),l(v);const D=i(),P=i();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(A),N=S(k,"tunnel")+A;this.unevalEdges.push(...k),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:N})}l(D),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(P),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(m),this.maskSegments=mr.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=mr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=mr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=mr.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.shadowCasterSegments=mr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,i,l,d,m,_,v,S){this.bridgeProgramConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S),this.tunnelProgramConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,X1.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Y1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,l,d,m){const _=(v,S)=>{for(let A=0;A<S.length-1;A++){const D=S[A].featureIndex,P=S[A+1].vertexStart,k=e.feature(D);v.populatePaintArrays(P,k,D,{},l,i,d,void 0,m)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,l,d,m){const _=new Map;for(let v=d;v<m;v++){const S=l[v],A=S.a,D=S.b,P=Oa.computePosHash(e[A]),k=Oa.computePosHash(e[D]);let N=_.get(P);N||(N={},_.set(P,N));let U=_.get(k);U||(U={},_.set(k,U)),i[A]<=0&&i[D]<=0||(N.to=D,U.from=A)}return _}isTerminalVertex(e,i){const l=Oa.computePosHash(this.unevalVertices[e]),d=i.get(l);return!d||!d.from||!d.to}constructBridgeStructures(e,i,l,d,m,_){e.clearVertexLookup();const v=this.computeVertexConnections(i,l,d,m.min,m.max),S=1/_,A=.5*S,D=(Tt,vt)=>Jt(Tt,i[vt].x,i[vt].y,l[vt]*S),P=be(),k=be(),N=be(),U=be(),Z=be(),K=(Tt,vt)=>{const bt=v.get(Oa.computePosHash(i[vt])),rt=bt.from,At=bt.to;if(!rt||!At)return;D(P,rt),D(k,vt),D(N,At),Ti(U),ur(P,k)||(ui(Z,k,P),Gn(U,Z)),ur(N,k)||(ui(Z,N,k),En(U,U,Gn(Z,Z)));const _t=_r(U);return _t>0?Ne(Tt,U,1/_t):void 0};let X=Number.POSITIVE_INFINITY;this.sortSubarray(d,m.min,m.max,(Tt,vt)=>Tt.featureInfo.featureIndex-vt.featureInfo.featureIndex);const te=be(),se=be(),le=be(),_e=be(),me=be(),Ee=be(),Se=be(),we=be(),Me=be(),Oe=[be(),be(),be(),be()],pt=[be(),be(),be(),be()],ot=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],ut=(Tt,vt)=>Tt>vt;for(let Tt=m.min;Tt<m.max;Tt++){const vt=d[Tt];if(!vt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ot,i,l,vt,ut))continue;const[bt,rt]=ot;if(Jt(te,bt.coord.x,bt.coord.y,S*bt.height),Jt(se,rt.coord.x,rt.coord.y,S*rt.height),ur(te,se))continue;ui(le,se,te),Gn(le,le);const At=K(we,vt.a)||le,_t=K(Me,vt.b)||le;Jt(_e,At[1],-At[0],0),Gn(_e,_e),Jt(me,_t[1],-_t[0],0),Gn(me,me),jr(we,_e,At),Gn(Ee,we),jr(we,me,_t),Gn(Se,we),En(Oe[0],te,Ne(we,ui(we,_e,Ee),A)),En(Oe[1],te,Ne(we,En(we,_e,Ee),A)),En(Oe[2],te,Ne(we,Ee,A)),Oe[3]=te,En(pt[0],se,Ne(we,ui(we,me,Se),A)),En(pt[1],se,Ne(we,En(we,me,Se),A)),En(pt[2],se,Ne(we,Se,A)),pt[3]=se,X=this.addFeatureSection(vt.featureInfo.featureIndex,X,this.bridgeFeatureSections,e);const Ct=e.addVertex(Oe[0],_e,_),Et=e.addVertex(Oe[1],_e,_),nn=e.addVertex(pt[0],me,_),rn=e.addVertex(pt[1],me,_);e.addTriangle(Ct,Et,nn),e.addTriangle(Et,rn,nn);const Ht=e.addVertex(Oe[1],Ee,_),Wt=e.addVertex(Oe[2],Ee,_),An=e.addVertex(pt[1],Se,_),_n=e.addVertex(pt[2],Se,_);e.addTriangle(Ht,Wt,An),e.addTriangle(Wt,_n,An),Xi(_e,_e),Xi(me,me);const Qt=e.addVertex(Oe[2],_e,_),Nn=e.addVertex(Oe[3],_e,_),ii=e.addVertex(pt[2],me,_),Di=e.addVertex(pt[3],me,_);e.addTriangle(Qt,Nn,ii),e.addTriangle(Nn,Di,ii);const Qn=this.isTerminalVertex(vt.a,v),Zi=this.isTerminalVertex(vt.b,v);bt.height<.01&&Qn&&e.addQuad(Oe[3],Oe[2],Oe[1],Oe[0],Xi(At,At),_),rt.height<.01&&Zi&&e.addQuad(pt[0],pt[1],pt[2],pt[3],_t,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,l,d,m,_){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const S=(X,te)=>X.featureInfo.featureIndex-te.featureInfo.featureIndex;this.sortSubarray(d,m.min,m.max,S),this.sortSubarray(d,_.min,_.max,S);const A=X=>Gn(X,X),D=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],P=(X,te)=>X<te,k=be(),N=be(),U=be(),Z=be(),K=be();for(let X=m.min;X<m.max;X++){if(!this.prepareEdgePoints(D,i,l,d[X],P))continue;const[te,se]=D,le=A(Jt(K,-(se.coord.y-te.coord.y),se.coord.x-te.coord.x,0));v=this.addFeatureSection(d[X].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Jt(k,te.coord.x,te.coord.y,te.height),Jt(N,se.coord.x,se.coord.y,se.height),Jt(U,se.coord.x,se.coord.y,d[X].isTunnel?-.1:0),Jt(Z,te.coord.x,te.coord.y,d[X].isTunnel?-.1:0),le)}for(let X=_.min;X<_.max;X++){const te=d[X];te.isTunnel&&([te.a,te.b]=[te.b,te.a]);const se=i[te.a],le=i[te.b],_e=A(Jt(K,-(le.y-se.y),le.x-se.x,0));v=this.addFeatureSection(te.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Jt(k,le.x,le.y,0),Jt(N,se.x,se.y,0),Jt(U,se.x,se.y,l[te.a]+4),Jt(Z,le.x,le.y,l[te.b]+4),_e),e.addQuad(Jt(k,se.x,se.y,0),Jt(N,le.x,le.y,0),Jt(U,le.x,le.y,l[te.b]+4),Jt(Z,se.x,se.y,l[te.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,l,d){e.coord.x=i,e.coord.y=l,e.height=d}prepareEdgePoints(e,i,l,d,m){let _=i[d.a].x,v=i[d.a].y,S=i[d.b].x,A=i[d.b].y,D=l[d.a],P=l[d.b];const k=m(D,0),N=m(P,0);if(k&&N)return this.setElevatedPoint(e[0],_,v,D),this.setElevatedPoint(e[1],S,A,P),!0;if(!k&&!N)return!1;if(k){if(!N){const U=P/(P-D);S=Cn(S,_,U),A=Cn(A,v,U),P=Cn(P,D,U)}}else{const U=D/(D-P);_=Cn(_,S,U),v=Cn(v,A,U),D=Cn(D,P,U)}return this.setElevatedPoint(e[0],_,v,D),this.setElevatedPoint(e[1],S,A,P),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((v,S)=>v.hash===S.hash?S.polygonIdx-v.polygonIdx:S.hash>v.hash?1:-1);let l=0,d=0,m=0,_=i[l].polygonIdx;do d++,(d===i.length||i[l].hash!==i[d].hash)&&((d-l===1||i[d-1].polygonIdx!==_)&&(m<l&&(i[m]=i[l],i[l]=null),i[m].type="none",m++),l=d,l!==i.length&&(_=i[l].polygonIdx));while(l!==i.length);if(i.splice(m),i.length!==0&&e.length!==0){i.sort((A,D)=>A.portalHash<D.portalHash?1:-1);let v=0,S=0;for(;v!==i.length&&S!==e.length;){const A=i[v],D=e[S];A.portalHash>D.hash?v++:D.hash>A.portalHash?S++:(A.type=D.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=jt&&i>=jt}addFeatureSection(e,i,l,d){return e!==i&&(i=e,l.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),i}sortSubarray(e,i,l,d){const m=e.slice(i,l);m.sort(d),e.splice(i,m.length,...m)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Oa.computePosHash(e))<<32n|BigInt(Oa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function y0(r,e){return r>e?1:r<e?-1:0}class yx{constructor(e=y0,i=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!i}rotateLeft(e){var i=e.right;i&&(e.right=i.left,i.left&&(i.left.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.left=e),e.parent=i}rotateRight(e){var i=e.left;i&&(e.left=i.right,i.right&&(i.right.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.right=e),e.parent=i}_splay(e){for(;e.parent;){var i=e.parent;i.parent?i.left===e&&i.parent.left===i?(this.rotateRight(i.parent),this.rotateRight(i)):i.right===e&&i.parent.right===i?(this.rotateLeft(i.parent),this.rotateLeft(i)):i.left===e&&i.parent.right===i?(this.rotateRight(i),this.rotateLeft(i)):(this.rotateLeft(i),this.rotateRight(i)):i.left===e?this.rotateRight(i):this.rotateLeft(i)}}splay(e){for(var i,l,d,m,_;e.parent;)(l=(i=e.parent).parent)&&l.parent?((d=l.parent).left===l?d.left=e:d.right=e,e.parent=d):(e.parent=null,this._root=e),m=e.left,_=e.right,e===i.left?(l&&(l.left===i?(i.right?(l.left=i.right,l.left.parent=l):l.left=null,i.right=l,l.parent=i):(m?(l.right=m,m.parent=l):l.right=null,e.left=l,l.parent=e)),_?(i.left=_,_.parent=i):i.left=null,e.right=i,i.parent=e):(l&&(l.right===i?(i.left?(l.right=i.left,l.right.parent=l):l.right=null,i.left=l,l.parent=i):(_?(l.left=_,_.parent=l):l.left=null,e.right=l,l.parent=e)),m?(i.right=m,m.parent=i):i.right=null,e.left=i,i.parent=e)}replace(e,i){e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,i){var l=this._root,d=null,m=this._compare;if(this._noDuplicates)for(;l;){if(d=l,m(l.key,e)===0)return;l=m(l.key,e)<0?l.right:l.left}else for(;l;)d=l,l=m(l.key,e)<0?l.right:l.left;return l={key:e,data:i,left:null,right:null,parent:d},d?m(d.key,l.key)<0?d.right=l:d.left=l:this._root=l,this.splay(l),this._size++,l}find(e){for(var i=this._root,l=this._compare;i;){var d=l(i.key,e);if(d<0)i=i.right;else{if(!(d>0))return i;i=i.left}}return null}contains(e){for(var i=this._root,l=this._compare;i;){var d=l(e,i.key);if(d===0)return!0;i=d<0?i.left:i.right}return!1}remove(e){var i=this.find(e);if(!i)return!1;if(this.splay(i),i.left)if(i.right){var l=this.minNode(i.right);l.parent!==i&&(this.replace(l,l.right),l.right=i.right,l.right.parent=l),this.replace(i,l),l.left=i.left,l.left.parent=l}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var i=this.find(e);if(i){this.splay(i);var l=i.left,d=i.right,m=null;l&&(l.parent=null,m=this.maxNode(l),this.splay(m),this._root=m),d&&(l?m.right=d:this._root=d,d.parent=m),this._size--}}pop(){var e=this._root,i=null;if(e){for(;e.left;)e=e.left;i={key:e.key,data:e.data},this.remove(e.key)}return i}next(e){var i=e;if(i)if(i.right)for(i=i.right;i&&i.left;)i=i.left;else for(i=e.parent;i&&i.right===e;)e=i,i=i.parent;return i}prev(e){var i=e;if(i)if(i.left)for(i=i.left;i&&i.right;)i=i.right;else for(i=e.parent;i&&i.left===e;)e=i,i=i.parent;return i}forEach(e){for(var i=this._root,l=[],d=!1,m=0;!d;)i?(l.push(i),i=i.left):l.length>0?(e(i=l.pop(),m++),i=i.right):d=!0;return this}range(e,i,l,d){const m=[],_=this._compare;let v,S=this._root;for(;m.length!==0||S;)if(S)m.push(S),S=S.left;else{if(S=m.pop(),v=_(S.key,i),v>0)break;if(_(S.key,e)>=0&&l.call(d,S))return this;S=S.right}return this}keys(){for(var e=this._root,i=[],l=[],d=!1;!d;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),l.push(e.key),e=e.right):d=!0;return l}values(){for(var e=this._root,i=[],l=[],d=!1;!d;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),l.push(e.data),e=e.right):d=!0;return l}at(e){for(var i=this._root,l=[],d=!1,m=0;!d;)if(i)l.push(i),i=i.left;else if(l.length>0){if(i=l.pop(),m===e)return i;m++,i=i.right}else d=!0;return null}load(e=[],i=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const d=e.length;return l&&ap(e,i,0,d-1,this._compare),this._root=Hd(null,e,i,0,d),this._size=d,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,i,l,d,m){return new yx(l,m).load(e,i,d)}}function Hd(r,e,i,l,d){const m=d-l;if(m>0){const _=l+Math.floor(m/2),v={key:e[_],data:i[_],parent:r};return v.left=Hd(v,e,i,l,_),v.right=Hd(v,e,i,_+1,d),v}return null}function ap(r,e,i,l,d){if(i>=l)return;const m=r[i+l>>1];let _=i-1,v=l+1;for(;;){do _++;while(d(r[_],m)<0);do v--;while(d(r[v],m)>0);if(_>=v)break;let S=r[_];r[_]=r[v],r[v]=S,S=e[_],e[_]=e[v],e[v]=S}ap(r,e,i,v,d),ap(r,e,v+1,l,d)}const xx=11102230246251565e-32,Na=134217729,vx=(3+8*xx)*xx;function Ng(r,e,i,l,d){let m,_,v,S,A=e[0],D=l[0],P=0,k=0;D>A==D>-A?(m=A,A=e[++P]):(m=D,D=l[++k]);let N=0;if(P<r&&k<i)for(D>A==D>-A?(_=A+m,v=m-(_-A),A=e[++P]):(_=D+m,v=m-(_-D),D=l[++k]),m=_,v!==0&&(d[N++]=v);P<r&&k<i;)D>A==D>-A?(_=m+A,S=_-m,v=m-(_-S)+(A-S),A=e[++P]):(_=m+D,S=_-m,v=m-(_-S)+(D-S),D=l[++k]),m=_,v!==0&&(d[N++]=v);for(;P<r;)_=m+A,S=_-m,v=m-(_-S)+(A-S),A=e[++P],m=_,v!==0&&(d[N++]=v);for(;k<i;)_=m+D,S=_-m,v=m-(_-S)+(D-S),D=l[++k],m=_,v!==0&&(d[N++]=v);return m===0&&N!==0||(d[N++]=m),N}function $d(r){return new Float64Array(r)}const op=$d(4),bx=$d(8),x0=$d(12),wx=$d(16),rl=$d(4);function lp(r,e,i){e===null?(r.inOut=!1,r.otherInOut=!0):(r.isSubject===e.isSubject?(r.inOut=!e.inOut,r.otherInOut=e.otherInOut):(r.inOut=!e.otherInOut,r.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(r.prevInResult=!v0(e,i)||e.isVertical()?e.prevInResult:e)),r.resultTransition=v0(r,i)?(function(l,d){let m,_=!l.inOut,v=!l.otherInOut;switch(d){case 0:m=_&&v;break;case 1:m=_||v;break;case 3:m=_!==v;break;case 2:m=l.isSubject?_&&!v:v&&!_}return m?1:-1})(r,i):0}function v0(r,e){switch(r.type){case 0:switch(e){case 0:return!r.otherInOut;case 1:return r.otherInOut;case 2:return r.isSubject&&r.otherInOut||!r.isSubject&&!r.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class Vh{constructor(e,i,l,d,m){this.left=i,this.point=e,this.otherEvent=l,this.isSubject=d??!1,this.type=m||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const i=this.point,l=this.otherEvent.point;return this.left?(i[0]-e[0])*(l[1]-e[1])-(l[0]-e[0])*(i[1]-e[1])>0:(l[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(l[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new Vh(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Jl(r,e){return r[0]===e[0]&&r[1]===e[1]}function dm(r,e,i){const l=(function(d,m,_,v,S,A){const D=(m-A)*(_-S),P=(d-S)*(v-A),k=D-P;if(D===0||P===0||D>0!=P>0)return k;const N=Math.abs(D+P);return Math.abs(k)>=33306690738754716e-32*N?k:-(function(U,Z,K,X,te,se,le){let _e,me,Ee,Se,we,Me,Oe,pt,ot,ut,Tt,vt,bt,rt,At,_t,Ct,Et;const nn=U-te,rn=K-te,Ht=Z-se,Wt=X-se;rt=nn*Wt,Me=Na*nn,Oe=Me-(Me-nn),pt=nn-Oe,Me=Na*Wt,ot=Me-(Me-Wt),ut=Wt-ot,At=pt*ut-(rt-Oe*ot-pt*ot-Oe*ut),_t=Ht*rn,Me=Na*Ht,Oe=Me-(Me-Ht),pt=Ht-Oe,Me=Na*rn,ot=Me-(Me-rn),ut=rn-ot,Ct=pt*ut-(_t-Oe*ot-pt*ot-Oe*ut),Tt=At-Ct,we=At-Tt,op[0]=At-(Tt+we)+(we-Ct),vt=rt+Tt,we=vt-rt,bt=rt-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,op[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,op[2]=vt-(Et-we)+(Tt-we),op[3]=Et;let An=(function(Di,Qn){let Zi=Qn[0];for(let xi=1;xi<4;xi++)Zi+=Qn[xi];return Zi})(0,op),_n=22204460492503146e-32*le;if(An>=_n||-An>=_n||(we=U-nn,_e=U-(nn+we)+(we-te),we=K-rn,Ee=K-(rn+we)+(we-te),we=Z-Ht,me=Z-(Ht+we)+(we-se),we=X-Wt,Se=X-(Wt+we)+(we-se),_e===0&&me===0&&Ee===0&&Se===0)||(_n=11093356479670487e-47*le+vx*Math.abs(An),An+=nn*Se+Wt*_e-(Ht*Ee+rn*me),An>=_n||-An>=_n))return An;rt=_e*Wt,Me=Na*_e,Oe=Me-(Me-_e),pt=_e-Oe,Me=Na*Wt,ot=Me-(Me-Wt),ut=Wt-ot,At=pt*ut-(rt-Oe*ot-pt*ot-Oe*ut),_t=me*rn,Me=Na*me,Oe=Me-(Me-me),pt=me-Oe,Me=Na*rn,ot=Me-(Me-rn),ut=rn-ot,Ct=pt*ut-(_t-Oe*ot-pt*ot-Oe*ut),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=rt+Tt,we=vt-rt,bt=rt-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const Qt=Ng(4,op,4,rl,bx);rt=nn*Se,Me=Na*nn,Oe=Me-(Me-nn),pt=nn-Oe,Me=Na*Se,ot=Me-(Me-Se),ut=Se-ot,At=pt*ut-(rt-Oe*ot-pt*ot-Oe*ut),_t=Ht*Ee,Me=Na*Ht,Oe=Me-(Me-Ht),pt=Ht-Oe,Me=Na*Ee,ot=Me-(Me-Ee),ut=Ee-ot,Ct=pt*ut-(_t-Oe*ot-pt*ot-Oe*ut),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=rt+Tt,we=vt-rt,bt=rt-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const Nn=Ng(Qt,bx,4,rl,x0);rt=_e*Se,Me=Na*_e,Oe=Me-(Me-_e),pt=_e-Oe,Me=Na*Se,ot=Me-(Me-Se),ut=Se-ot,At=pt*ut-(rt-Oe*ot-pt*ot-Oe*ut),_t=me*Ee,Me=Na*me,Oe=Me-(Me-me),pt=me-Oe,Me=Na*Ee,ot=Me-(Me-Ee),ut=Ee-ot,Ct=pt*ut-(_t-Oe*ot-pt*ot-Oe*ut),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=rt+Tt,we=vt-rt,bt=rt-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const ii=Ng(Nn,x0,4,rl,wx);return wx[ii-1]})(d,m,_,v,S,A,N)})(r[0],r[1],e[0],e[1],i[0],i[1]);return l>0?-1:l<0?1:0}function Zd(r,e){const i=r.point,l=e.point;return i[0]>l[0]?1:i[0]<l[0]?-1:i[1]!==l[1]?i[1]>l[1]?1:-1:(function(d,m,_){return d.left!==m.left?d.left?1:-1:dm(_,d.otherEvent.point,m.otherEvent.point)!==0?d.isBelow(m.otherEvent.point)?-1:1:!d.isSubject&&m.isSubject?1:-1})(r,e,i)}function Rc(r,e,i){const l=new Vh(e,!1,r,r.isSubject),d=new Vh(e,!0,r.otherEvent,r.isSubject);return Jl(r.point,r.otherEvent.point)&&console.warn("what is that, a collapsed segment?",r),l.contourId=d.contourId=r.contourId,Zd(d,r.otherEvent)>0&&(r.otherEvent.left=!0,d.left=!1),r.otherEvent.otherEvent=d,r.otherEvent=l,i.push(d),i.push(l),i}function j_(r,e){return r[0]*e[1]-r[1]*e[0]}function U_(r,e){return r[0]*e[0]+r[1]*e[1]}function G_(r,e,i){const l=(function(S,A,D,P){const k=[A[0]-S[0],A[1]-S[1]],N=[P[0]-D[0],P[1]-D[1]];function U(Ee,Se,we){return[Ee[0]+Se*we[0],Ee[1]+Se*we[1]]}const Z=[D[0]-S[0],D[1]-S[1]];let K=j_(k,N),X=K*K;const te=U_(k,k);if(X>0){const Ee=j_(Z,N)/K;if(Ee<0||Ee>1)return null;const Se=j_(Z,k)/K;return Se<0||Se>1?null:Ee===0||Ee===1?[U(S,Ee,k)]:Se===0||Se===1?[U(D,Se,N)]:[U(S,Ee,k)]}if(K=j_(Z,k),X=K*K,X>0)return null;const se=U_(k,Z)/te,le=se+U_(k,N)/te,_e=Math.min(se,le),me=Math.max(se,le);return _e<=1&&me>=0?_e===1?[U(S,_e>0?_e:0,k)]:me===0?[U(S,me<1?me:1,k)]:[U(S,_e>0?_e:0,k),U(S,me<1?me:1,k)]:null})(r.point,r.otherEvent.point,e.point,e.otherEvent.point),d=l?l.length:0;if(d===0||d===1&&(Jl(r.point,e.point)||Jl(r.otherEvent.point,e.otherEvent.point))||d===2&&r.isSubject===e.isSubject)return 0;if(d===1)return!Jl(r.point,l[0])&&!Jl(r.otherEvent.point,l[0])&&Rc(r,l[0],i),!Jl(e.point,l[0])&&!Jl(e.otherEvent.point,l[0])&&Rc(e,l[0],i),1;const m=[];let _=!1,v=!1;return Jl(r.point,e.point)?_=!0:Zd(r,e)===1?m.push(e,r):m.push(r,e),Jl(r.otherEvent.point,e.otherEvent.point)?v=!0:Zd(r.otherEvent,e.otherEvent)===1?m.push(e.otherEvent,r.otherEvent):m.push(r.otherEvent,e.otherEvent),_&&v||_?(e.type=1,r.type=e.inOut===r.inOut?2:3,_&&!v&&Rc(m[1].otherEvent,m[0].point,i),2):v?(Rc(m[0],m[1].point,i),3):m[0]!==m[3].otherEvent?(Rc(m[0],m[1].point,i),Rc(m[1],m[2].point,i),3):(Rc(m[0],m[1].point,i),Rc(m[3].otherEvent,m[2].point,i),3)}function b0(r,e){if(r===e)return 0;if(dm(r.point,r.otherEvent.point,e.point)!==0||dm(r.point,r.otherEvent.point,e.otherEvent.point)!==0)return Jl(r.point,e.point)?r.isBelow(e.otherEvent.point)?-1:1:r.point[0]===e.point[0]?r.point[1]<e.point[1]?-1:1:Zd(r,e)===1?e.isAbove(r.point)?-1:1:r.isBelow(e.point)?-1:1;if(r.isSubject!==e.isSubject)return r.isSubject?-1:1;{let i=r.point,l=e.point;if(i[0]===l[0]&&i[1]===l[1])return i=r.otherEvent.point,l=e.otherEvent.point,i[0]===l[0]&&i[1]===l[1]?0:(r.contourId??0)>(e.contourId??0)?1:-1}return Zd(r,e)===1?1:-1}class w0{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Tx(r,e,i,l){let d,m=r+1,_=e[r].point;const v=e.length;for(m<v&&(d=e[m].point);m<v&&d[0]===_[0]&&d[1]===_[1];){if(!i[m])return m;m++,m<v&&(d=e[m].point)}for(m=r-1;i[m]&&m>l;)m--;return m}function T0(r,e,i){const l=new w0;if(r.prevInResult!=null){const d=r.prevInResult,m=d.outputContourId;if(d.resultTransition>0){const _=e[m];if(_.holeOf!=null){const v=_.holeOf;e[v].holeIds.push(i),l.holeOf=v,l.depth=e[m].depth}else e[m].holeIds.push(i),l.holeOf=m,l.depth=e[m].depth+1}else l.holeOf=null,l.depth=e[m].depth}else l.holeOf=null,l.depth=0;return l}const Ex=Math.max,Bg=Math.min;let q_=0;function E0(r,e,i,l,d,m){let _,v,S,A,D,P;for(_=0,v=r.length-1;_<v;_++){if(S=r[_],A=r[_+1],D=new Vh(S,!1,void 0,e),P=new Vh(A,!1,D,e),D.otherEvent=P,S[0]===A[0]&&S[1]===A[1])continue;D.contourId=P.contourId=i,m||(D.isExteriorRing=!1,P.isExteriorRing=!1),Zd(D,P)>0?P.left=!0:D.left=!0;const k=S[0],N=S[1];d[0]=Bg(d[0],k),d[1]=Bg(d[1],N),d[2]=Ex(d[2],k),d[3]=Ex(d[3],N),l.push(D),l.push(P)}}const fm=[];function H_(r,e,i){let l=r,d=e;typeof r[0][0][0]=="number"&&(l=[r]),typeof e[0][0][0]=="number"&&(d=[e]);let m=(function(k,N,U){let Z=null;return k.length*N.length===0&&(U===0?Z=fm:U===2?Z=k:(U===1||U===3)&&(Z=k.length===0?N:k)),Z})(l,d,i);if(m)return m===fm?null:m;const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=(function(k,N,U,Z,K){const X=new hh(void 0,Zd);let te,se,le,_e,me,Ee;for(le=0,_e=k.length;le<_e;le++)for(te=k[le],me=0,Ee=te.length;me<Ee;me++)se=me===0,se&&q_++,E0(te[me],!0,q_,X,U,se);for(le=0,_e=N.length;le<_e;le++)for(te=N[le],me=0,Ee=te.length;me<Ee;me++)se=me===0,K===2&&(se=!1),se&&q_++,E0(te[me],!1,q_,X,Z,se);return X})(l,d,_,v,i);if(m=(function(k,N,U,Z,K){let X=null;return(U[0]>Z[2]||Z[0]>U[2]||U[1]>Z[3]||Z[1]>U[3])&&(K===0?X=fm:K===2?X=k:(K===1||K===3)&&(X=k.concat(N))),X})(l,d,_,v,i),m)return m===fm?null:m;const A=(function(k,N,U,Z,K,X){const te=new yx(b0),se=[],le=Math.min(Z[2],K[2]);let _e,me,Ee;for(;k.length!==0;){let Se=k.pop();if(se.push(Se),X===0&&Se.point[0]>le||X===2&&Se.point[0]>Z[2])break;if(Se.left){me=_e=te.insert(Se),Ee=te.minNode(),_e=_e!==Ee?te.prev(_e):null,me=te.next(me);const we=_e?_e.key:null;let Me;if(lp(Se,we,X),me&&G_(Se,me.key,k)===2&&(lp(Se,we,X),lp(me.key,Se,X)),_e&&G_(_e.key,Se,k)===2){let Oe=_e;Oe=Oe!==Ee?te.prev(Oe):null,Me=Oe?Oe.key:null,lp(we,Me,X),lp(Se,we,X)}}else Se=Se.otherEvent,me=_e=te.find(Se),_e&&me&&(_e=_e!==Ee?te.prev(_e):null,me=te.next(me),te.remove(Se),me&&_e&&G_(_e.key,me.key,k))}return se})(S,0,0,_,v,i),D=(function(k){let N,U;const Z=(function(te){let se,le,_e,me,Ee;const Se=[];for(le=0,_e=te.length;le<_e;le++)se=te[le],(se.left&&se.inResult||!se.left&&se.otherEvent.inResult)&&Se.push(se);let we=!1;for(;!we;)for(we=!0,le=0,_e=Se.length;le<_e;le++)le+1<_e&&Zd(Se[le],Se[le+1])===1&&(me=Se[le],Se[le]=Se[le+1],Se[le+1]=me,we=!1);for(le=0,_e=Se.length;le<_e;le++)se=Se[le],se.otherPos=le;for(le=0,_e=Se.length;le<_e;le++)se=Se[le],se.left||(Ee=se.otherPos,se.otherPos=se.otherEvent.otherPos,se.otherEvent.otherPos=Ee);return Se})(k),K={},X=[];for(N=0,U=Z.length;N<U;N++){if(K[N])continue;const te=X.length,se=T0(Z[N],X,te),le=Ee=>{K[Ee]=!0,Ee<Z.length&&Z[Ee]&&(Z[Ee].outputContourId=te)};let _e=N,me=N;for(se.points.push(Z[N].point);le(_e),_e=Z[_e].otherPos,le(_e),se.points.push(Z[_e].point),_e=Tx(_e,Z,K,me),!(_e==me||_e>=Z.length)&&Z[_e];);X.push(se)}return X})(A),P=[];for(let k=0;k<D.length;k++){let N=D[k];if(N.isExterior()){let U=[N.points];for(let Z=0;Z<N.holeIds.length;Z++)U.push(D[N.holeIds[Z]].points);P.push(U)}}return P}function cp(r,e,i,l){const d=[],m=l===0?(_,v,S,A,D,P)=>{_.push(new Mt(P,S+(P-v)/(A-v)*(D-S)))}:(_,v,S,A,D,P)=>{_.push(new Mt(v+(P-S)/(D-S)*(A-v),P))};for(const _ of r){const v=[];for(const S of _){if(S.length<=2)continue;const A=[];for(let k=0;k<S.length-1;k++){const N=S[k].x,U=S[k].y,Z=S[k+1].x,K=S[k+1].y,X=l===0?N:U,te=l===0?Z:K;X<e?te>e&&m(A,N,U,Z,K,e):X>i?te<i&&m(A,N,U,Z,K,i):A.push(S[k]),te<e&&X>=e&&m(A,N,U,Z,K,e),te>i&&X<=i&&m(A,N,U,Z,K,i)}let D=S[S.length-1];const P=l===0?D.x:D.y;P>=e&&P<=i&&A.push(D),A.length&&(D=A[A.length-1],A[0].x===D.x&&A[0].y===D.y||A.push(A[0]),v.push(A))}v.length&&d.push(v)}return d}function Sx(r,e){const i=H_(Fg(r),Fg([e]),0);return i==null?[]:jh(i)}function S0(r,e){let l=Fg(r,65536);const d=[];for(;e.valid();e.next()){const[m,_]=e.get(),v=m.x*65536,S=m.y*65536,A=_.x*65536,D=_.y*65536,P=A-v,k=D-S,N=Math.hypot(P,k);if(N===0)continue;const U=Math.trunc(k/N*3),Z=-Math.trunc(P/N*3);d.push([[[v,S],[A,D],[A+U,D+Z],[v+U,S+Z],[v,S]]])}return d.length>0&&(l=H_(l,d,2)),jh(l,1/65536,128)}function Fg(r,e=1){return[r.map(i=>i.map(l=>[l.x*e,l.y*e]))]}function jh(r,e=1,i){return r.map(l=>l.map((d,m)=>{const _=d.map(v=>{let S=v[0],A=v[1];return i&&(S=Math.round(S/i)*i,A=Math.round(A/i)*i),new Mt(S*e,A*e)._round()});return m>0&&_.reverse(),_}))}class Hu{constructor(e,i){this.layoutVertexArray=new iu,this.indexArray=new xs,this.lineIndexArray=new nl,this.triangleSegments=new mr,this.lineSegments=new mr,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Gs)}update(e,i,l,d,m,_,v,S){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,W1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,p0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,l,d,m,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,d,m,_,void 0,v)}}class $u{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Hu(e,!1),this.elevationBufferData=new Hu(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.hasPattern=gx("fill",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:S,index:A,sourceLayerIndex:D}of e){const P=this.layers[0]._featureFilter.needGeometry,k=Vn(v,P);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,l))continue;const N=m?m.evaluate(k,{},l,i.availableImages):void 0,U={id:S,properties:v.properties,type:v.type,sourceLayerIndex:D,index:A,geometry:P?k.geometry:Mn(v,l,d),patterns:{},sortKey:N};_.push(U)}m&&_.sort((v,S)=>v.sortKey-S.sortKey);for(const v of _){const{geometry:S,index:A,sourceLayerIndex:D}=v;if(this.hasPattern){const P=_x("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(v,S,A,l,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,S,A,D,this.index)}}update(e,i,l,d,m,_,v){this.bufferData.update(e,i,l,d,m,_,v,this.worldview),this.elevationBufferData.update(e,i,l,d,m,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,l,d,m,_,v,this.worldview)}addFeatures(e,i,l,d,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,d,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,l,d,m,_=[],v,S){const A=Og(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,d,l,S):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,l,m,_,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,m,_,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,i,l,d,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,l,d,m,this.worldview))}addElevatedRoadFeature(e,i,l,d,m){const _=new Array,v=ca.getElevationFeature(e,m);if(!v)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&_.push({polygons:A,elevationFeature:v,elevationTileID:l})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:d};for(const A of _)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Oa(A.elevationTileID,this.layers,this.zoom,this.lut));const P=A.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(Un)&&(k=+e.properties[Un]),this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,A.polygons,P,A.elevationFeature,k)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const D=new jo(l,A.elevationTileID);this.addElevatedGeometry(A.polygons,D,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,S)}}addElevatedGeometry(e,i,l,d,m,_){const v={elevation:l,elevationSampler:i,bias:d,index:m,featureInfo:_},[S,A]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,l){let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,_=null;l&&(_=l.elevationSampler.constantElevation(l.elevation,l.bias),_!=null&&(d=_,m=_));const v=(S,A,D)=>{if(l!=null)if(A.push(S),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),D.push(_);else{const P=l.elevationSampler.pointElevation(S,l.elevation,l.bias);i.elevatedLayoutVertexArray.emplaceBack(P),D.push(P),d=Math.min(d,P),m=Math.max(m,P)}};for(const S of e){let A=0;for(const se of S)A+=se.length;const D=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),P=D.vertexLength,k=[],N=[],U=[],Z=[],K=[],X=i.layoutVertexArray.length;for(const se of S){if(se.length===0)continue;se!==S[0]&&N.push(k.length/2);const le=i.lineSegments.prepareSegment(se.length,i.layoutVertexArray,i.lineIndexArray),_e=le.vertexLength;l&&K.push(i.layoutVertexArray.length-X),v(se[0],U,Z),i.layoutVertexArray.emplaceBack(se[0].x,se[0].y),i.lineIndexArray.emplaceBack(_e+se.length-1,_e),k.push(se[0].x),k.push(se[0].y);for(let me=1;me<se.length;me++)v(se[me],U,Z),i.layoutVertexArray.emplaceBack(se[me].x,se[me].y),i.lineIndexArray.emplaceBack(_e+me-1,_e+me),k.push(se[me].x),k.push(se[me].y);le.vertexLength+=se.length,le.primitiveLength+=se.length}const te=Ql(k,N);for(let se=0;se<te.length;se+=3)i.indexArray.emplaceBack(P+te[se],P+te[se+1],P+te[se+2]);if(te.length>0&&l&&this.elevationMode==="hd-road-base"){const se=l.elevation.isTunnel(),le=l.elevation.safeArea,_e=this.elevatedStructures.addVertices(U,Z);this.elevatedStructures.addTriangles(te,_e,se);const me=K.length;if(me>0){for(let Ee=0;Ee<me-1;Ee++)this.elevatedStructures.addRenderableRing(l.index,K[Ee]+_e,K[Ee+1]-K[Ee],se,le,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,K[me-1]+_e,U.length-K[me-1],se,le,l.featureInfo)}}D.vertexLength+=A,D.primitiveLength+=te.length/3}return[d,m]}prepareElevatedPolygons(e,i,l){const d=1/Pt(l),m=[];for(const _ of e){const v=S0(_,new fo(i,d));m.push(...v)}return m}clipPolygonsToTile(e,i){const l=-i,d=-i,m=jt+i,_=jt+i;let v=0;const S=[],A=[];for(;v<e.length;v++){const k=e[v],N=Ll(k);(N.min.x>=l&&N.max.x<=m&&N.min.y>=d&&N.max.y<=_?S:A).push(k)}if(S.length===e.length)return e;const D=[new Mt(l,d),new Mt(m,d),new Mt(m,_),new Mt(l,_),new Mt(l,d)],P=S;for(const k of A)P.push(...Sx(k,D));return P}}let pm,mm,Uh,A0;Bt($u,"FillBucket",{omit:["layers","patternFeatures"]}),Bt(Hu,"FillBufferData"),Bt(Oa,"ElevatedStructures");class Vg{constructor(e,i,l,d){if(this.triangleCount=i.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,_]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const k=e[P];m.x=Math.min(m.x,k.x),m.y=Math.min(m.y,k.y),_.x=Math.max(_.x,k.x),_.y=Math.max(_.y,k.y)}if(d){const P=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/d);l=Math.max(l,P)}if(l===0)return;this.min=m,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const A=[];for(let P=0;P<this.triangleCount;P++){const k=e[i[3*P+0]].sub(this.min),N=e[i[3*P+1]].sub(this.min),U=e[i[3*P+2]].sub(this.min),Z=vl(Math.floor(Math.min(k.x,N.x,U.x)),this.xScale,this.cellsX),K=vl(Math.floor(Math.max(k.x,N.x,U.x)),this.xScale,this.cellsX),X=vl(Math.floor(Math.min(k.y,N.y,U.y)),this.yScale,this.cellsY),te=vl(Math.floor(Math.max(k.y,N.y,U.y)),this.yScale,this.cellsY),se=new Mt(0,0),le=new Mt(0,0),_e=new Mt(0,0),me=new Mt(0,0);for(let Ee=X;Ee<=te;++Ee){se.y=le.y=Ee*S,_e.y=me.y=(Ee+1)*S;for(let Se=Z;Se<=K;++Se)se.x=_e.x=Se*S,le.x=me.x=(Se+1)*S,(ar(k,N,U,se,le,me)||ar(k,N,U,se,me,_e))&&A.push({cellIdx:Ee*this.cellsX+Se,triIdx:P})}}if(A.length===0)return;A.sort((P,k)=>P.cellIdx-k.cellIdx||P.triIdx-k.triIdx);let D=0;for(;D<A.length;){const P=A[D].cellIdx,k={start:this.payload.length,len:0};for(;D<A.length&&A[D].cellIdx===P;)++k.len,this.payload.push(A[D++].triIdx);this.cells[P]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=vl(e.x-this.min.x,this.xScale,this.cellsX),d=vl(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[d*this.cellsX+l];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const v=this.payload[m.start+_],S=Math.floor(v/8),A=1<<v%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,i.push(v),i.length===this.triangleCount))return}}}query(e,i,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const d=vl(e.x-this.min.x,this.xScale,this.cellsX),m=vl(i.x-this.min.x,this.xScale,this.cellsX),_=vl(e.y-this.min.y,this.yScale,this.cellsY),v=vl(i.y-this.min.y,this.yScale,this.cellsY);for(let S=_;S<=v;S++)for(let A=d;A<=m;A++){const D=this.cells[S*this.cellsX+A];if(D)for(let P=0;P<D.len;P++){const k=this.payload[D.start+P],N=Math.floor(k/8),U=1<<k%8;if(!(this.lookup[N]&U)&&(this.lookup[N]|=U,l.push(k),l.length===this.triangleCount))return}}}}function vl(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Bt(Vg,"TriangleGridIndex");class I0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}updateAppearances(e,i,l,d){}populate(e,i,l,d){const m=[];for(const{feature:_,id:v,index:S,sourceLayerIndex:A}of e){const D=this.layers[0]._featureFilter.needGeometry,P=Vn(_,D);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,l))continue;const k={id:v,properties:_.properties,type:_.type,sourceLayerIndex:A,index:S,geometry:D?P.geometry:Mn(_,l,d),patterns:{}};m.push(k)}for(const _ of m){const{geometry:v,index:S,sourceLayerIndex:A}=_;this.addFeature(_,v,S,l,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,v,S,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,l,d,m,_,v){}destroy(){}addFeature(e,i,l,d,m,_=[],v){for(const S of Og(i,2)){const A=[],D=[],P=[],k=new Mt(1/0,1/0),N=new Mt(-1/0,-1/0);for(const K of S)if(K.length!==0){K!==S[0]&&P.push(D.length/2);for(let X=0;X<K.length;X++)D.push(K[X].x),D.push(K[X].y),A.push(K[X]),k.x=Math.min(k.x,K[X].x),k.y=Math.min(k.y,K[X].y),N.x=Math.max(N.x,K[X].x),N.y=Math.max(N.y,K[X].y)}const U=Ql(D,P),Z=new Vg(A,U,8,256);this.footprints.push({vertices:A,indices:U,grid:Z,min:k,max:N})}}}Bt(I0,"ClipBucket",{omit:["layers"]});const C0=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$_=ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),R0=ei([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),tw=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Z_=ei([{name:"a_join_normal_inside",components:3,type:"Int16"}]),W_=ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),M0=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gm}=C0,_m=Number.MAX_SAFE_INTEGER,Ax=_m-1;function jg(r,e,i,l){return r.order<e||r.order===_m||!(r.clipMask&i)||(function(d,m){return m.length!==0&&m.find(_=>_===d)===void 0})(l,r.clipScope)}function Ug(r,e){return r.x-e.x||r.y-e.y}function D0(r,e){return Ug(r.min,e.min)===0&&Ug(r.max,e.max)===0}function ym(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function h(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!D0(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!no(r[i].clipScope,e[i].clipScope))return!1;return!0}function g(r,e,i){const l=1/jt,d=1/(1<<i.canonical.z),m=(e.x*l+i.canonical.x)*d+i.wrap,_=(e.y*l+i.canonical.y)*d;return{min:new Mt((r.x*l+i.canonical.x)*d+i.wrap,(r.y*l+i.canonical.y)*d),max:new Mt(m,_)}}function w(r,e,i){const l=1<<i.canonical.z,d=((e.x-i.wrap)*l-i.canonical.x)*jt,m=(e.y*l-i.canonical.y)*jt;return{min:new Mt(((r.x-i.wrap)*l-i.canonical.x)*jt,(r.y*l-i.canonical.y)*jt),max:new Mt(d,m)}}function R(r,e,i,l,d,m,_){const v=r.indices,S=r.vertices,A=[];for(let D=l;D<l+d;D+=3){const P=e[i[D+0]+m],k=e[i[D+1]+m],N=e[i[D+2]+m],U=Math.min(P.x,k.x,N.x),Z=Math.max(P.x,k.x,N.x),K=Math.min(P.y,k.y,N.y),X=Math.max(P.y,k.y,N.y);A.length=0,r.grid.query(new Mt(U,K),new Mt(Z,X),A);for(let te=0;te<A.length;te++){const se=A[te];if(ar(S[v[3*se+0]],S[v[3*se+1]],S[v[3*se+2]],P,k,N,_))return!0}}return!1}function F(r,e,i,l){if(!r||!i)return!1;let d=r.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(i.vertices.length<r.vertices.length)return F(i,l,r,e);const m=e.canonical,_=l.canonical,v=Math.pow(2,_.z-m.z);d=r.vertices.map(S=>new Mt((S.x+m.x*jt)*v-_.x*jt,(S.y+m.y*jt)*v-_.y*jt))}return R(i,d,r.indices,0,r.indices.length,0,0)}function q(r,e,i,l){const d=Math.pow(2,l.z-i.z);return new Mt((r+i.x*jt)*d-l.x*jt,(e+i.y*jt)*d-l.y*jt)}function ce(r,e){const i=[];e.grid.queryPoint(r,i);const l=e.indices,d=e.vertices;for(let m=0;m<i.length;m++){const _=i[m];if(mo([d[l[3*_+0]],d[l[3*_+1]],d[l[3*_+2]]],r))return!0}return!1}const Re=[new Mt(0,0),new Mt(jt,0),new Mt(jt,jt),new Mt(0,jt)];function ct(r,e){const i=[];let l=[];if(!e||r.length<2)return[r];if(r.length===2)return Kl(r[0],r[1],Re)?[r]:[];for(let d=0;d<r.length+2;d++){const m=r[d%r.length],_=r[(d+1)%r.length],v=Kl(d===0?r[r.length-1]:r[(d-1)%r.length],m,Re),S=Kl(m,_,Re),A=v||S;A&&l.push(m),A&&S||l.length>0&&(l.length>1&&i.push(l),l=[])}return l.length>1&&i.push(l),i}const Vt=ti.types,sn=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],un=["fill-extrusion-flood-light-ground-radius"],Ut=Math.pow(2,13),Yt=Math.pow(2,15)-1,Wn=new Mt(0,1),fi=2147483648;function Zr(r,e,i,l,d,m,_,v){r.emplaceBack((e<<1)+_,(i<<1)+m,(Math.floor(l*Ut)<<1)+d,Math.round(v))}function Rt(r,e,i){r.emplaceBack(e.x*jt,e.y*jt,i?1:0)}function gt(r,e,i,l,d,m){r.emplaceBack(e.x,e.y,(i.x<<1)+l,(i.y<<1)+d,m)}function Nt(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ln{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class gi{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Or{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,l){this.accCount++,this.acc._add(i);let d=!!this.borders;i.x<e.min.x?(e.min.x=i.x,d=!0):i.x>e.max.x&&(e.max.x=i.x,d=!0),i.y<e.min.y?(e.min.y=i.y,d=!0):i.y>e.max.y&&(e.max.y=i.y,d=!0),((i.x===0||i.x===jt)&&i.x===l.x)!=((i.y===0||i.y===jt)&&i.y===l.y)&&this.processBorderOverlap(i,l),d&&this.checkBorderIntersection(i,l)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Cn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>jt!=e.x>jt&&this.addBorderIntersection(1,Cn(i.y,e.y,(jt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Cn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>jt!=e.y>jt&&this.addBorderIntersection(3,Cn(i.x,e.x,(jt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function ni(r,e){const i=r.add(e)._unit(),l=xe(r.x*i.x+r.y*i.y,-1,1);var d,m,_;return _=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(_)))/4*Yt*((d=r).x*(m=e).y-d.y*m.x<0?-1:1)}const tr=[r=>r.x<0,r=>r.x>jt,r=>r.y<0,r=>r.y>jt];function xr(r,e,i,l){const d=[4];if(l===0)return d;i._mult(l);const m=r.sub(i),_=e.sub(i),v=[r,e,m,_];for(let S=0;S<4;S++)for(const A of v)if(tr[S](A)){d.push(S);break}return d}class Rr{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Ms,this.indexArray=new xs,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut},i=>un.includes(i)),this._segments=new mr,this.hiddenByLandmarkVertexArray=new Jf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,l,d=!1){const m=e.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let S;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const A=e[0],D=e[1];S=ni(A.sub(e[m-1])._perp()._unit(),D.sub(A)._perp()._unit())}for(let A=0;A<m;A++){const D=A===m-1?0:A+1,P=e[A],k=e[D],N=e[D===m-1?0:D+1],U=k.sub(P)._perp()._unit(),Z=ni(U,N.sub(k)._perp()._unit()),K=S,X=Z;if(nw(P,k,i)||d&&cA(P,i)&&cA(k,i)){S=Z;continue}const te=v.vertexLength;gt(this.vertexArray,P,k,1,1,K),gt(this.vertexArray,P,k,1,0,K),gt(this.vertexArray,P,k,0,1,X),gt(this.vertexArray,P,k,0,0,X),v.vertexLength+=4;const se=xr(P,k,U,l);for(const le of se)this._segmentToGroundQuads[_].push({id:te,region:le}),this._segmentToRegionTriCounts[_][le]+=2,v.primitiveLength+=2;S=Z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort((d,m)=>d.region-m.region);for(let l=0;l<i;l++){const d=this._segmentToGroundQuads[l],m=e[l],_=this._segmentToRegionTriCounts[l];_.reduce((S,A)=>S+A,0);let v=0;for(let S=0;S<=4;S++){const A=_[S];if(A!==0){let D=this.regionSegments[S];D||(D=this.regionSegments[S]=new mr);const P={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:A};D.get().push(P)}v+=A}for(let S=0;S<d.length;S++){const A=d[S].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,l,d,m,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,l,d,m,_,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,$_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,R0.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,l,d,m,_,v,S){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,l,d,m,_,v,S)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&fi))}updateHiddenByLandmarkRange(e,i,l){if(!this.hasData())return;const d=i+e;if(i!==0){for(let m=e;m<d;++m)this.hiddenByLandmarkVertexArray.emplace(m,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,W_.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class cu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new xs,this.footprintVertices=new iu,this.footprintSegments=[],this.layoutVertexArray=new Tc,this.centroidVertexArray=new su,this.wallVertexArray=new yg,this.indexArray=new xs,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut},i=>sn.includes(i)),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Rr(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.features=[],this.hasPattern=gx("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Pt(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:_,index:v,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,D=Vn(m,A);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),D,l))continue;const P={id:_,sourceLayerIndex:S,index:v,geometry:A?D.geometry:Mn(m,l,d),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length,N=Vt[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:_x("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const U of P.geometry)for(const Z of ct(U,N))this.addFeature(m.id,P,[Z],v,l,{},i.availableImages,d,i.brightness);else this.addFeature(m.id,P,P.geometry,v,l,{},i.availableImages,d,i.brightness);i.featureIndex.insert(m,P.geometry,v,S,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,l,d,m,_){for(const{featureId:v,feature:S}of this.features){const A=Vt[S.type]==="Polygon",{geometry:D}=S;if(this.wallMode)for(const P of D)for(const k of ct(P,A))this.addFeature(v,S,[k],S.index,i,l,d,m,_);else this.addFeature(v,S,D,S.index,i,l,d,m,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview),this.groundEffect.update(e,i,m,l,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Z_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,M0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,tw.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,d,m,_,v,S,A){const D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,P=[new Mt(0,0),new Mt(jt,jt)],k=S.projection,N=k.name==="globe",U=this.wallMode||Vt[i.type]==="Polygon",Z=new Or;Z.centroidDataIndex=this.centroidData.length;const K=new gi;K.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(K.buildingId=Number(i.properties.building_id));const X=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,te=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let se;if(K.height=te,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Mh),this.wallMode){if(N)return void Pn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;se=(function(Me){const Oe=Me[0].x===Me[Me.length-1].x&&Me[0].y===Me[Me.length-1].y;(function(Ht){let Wt=0;const An=Ht.length;for(let _n=0;_n<An;_n++)Wt+=(Ht[(_n+1)%An].x-Ht[_n].x)*(Ht[(_n+1)%An].y+Ht[_n].y);return Wt>=0})(Me)||(Me=Me.reverse());const ot={geometry:[],joinNormals:[],indices:[]},ut=[],Tt=[],vt=[];let bt=Me.length;for(;bt>=2&&Me[bt-1].equals(Me[bt-2]);)bt--;if(bt<(Oe?3:2))return ot;let rt,At,_t,Ct,Et,nn=0;for(;nn<bt-1&&Me[nn].equals(Me[nn+1]);)nn++;Oe&&(rt=Me[bt-2],Et=Me[nn].sub(rt)._unit()._perp());for(let Ht=nn;Ht<bt;Ht++){if(_t=Ht===bt-1?Oe?Me[nn+1]:void 0:Me[Ht+1],_t&&Me[Ht].equals(_t))continue;Et&&(Ct=Et),rt&&(At=rt),rt=Me[Ht],Et=_t?_t.sub(rt)._unit()._perp():Ct,Ct=Ct||Et;let Wt=Ct.add(Et);Wt.x===0&&Wt.y===0||Wt._unit();const An=Wt.x*Et.x+Wt.y*Et.y,_n=An!==0?1/An:1/0,Qt=Ct.x*Et.y-Ct.y*Et.x>0;let Nn="miter";const ii=2;Nn==="miter"&&_n>ii&&(Nn="bevel"),Nn==="bevel"&&(_n>100&&(Nn="flipbevel"),_n<ii&&(Nn="miter"));const Di=(Qn,Zi,xi,as)=>{const wi=new Mt(Qn.x,Qn.y),Ui=new Mt(Qn.x,Qn.y);wi.x+=Zi.x*as,wi.y+=Zi.y*as,Ui.x-=Zi.x*Math.max(xi,1),Ui.y-=Zi.y*Math.max(xi,1),vt.push(Zi),ut.push(wi),Tt.push(Ui)};if(Nn==="miter")Wt._mult(_n),Di(rt,Wt,0,0);else if(Nn==="flipbevel")Wt=Et.mult(-1),Di(rt,Wt,0,0),Di(rt,Wt.mult(-1),0,0);else{const Qn=-Math.sqrt(_n*_n-1),Zi=Qt?Qn:0,xi=Qt?0:Qn;At&&Di(rt,Ct,Zi,xi),_t&&Di(rt,Et,Zi,xi)}}ot.geometry=[...ut,...Tt.reverse(),ut[0]],ot.joinNormals=[...vt,...vt.reverse(),vt[vt.length-1]];const rn=ot.geometry.length-1;for(let Ht=0;Ht<rn/2;Ht++)if(Ht+1<rn/2){let Wt=Ht,An=Ht+1,_n=rn-1-Ht,Qt=rn-2-Ht;Wt=Wt===0?rn-1:Wt-1,An=An===0?rn-1:An-1,_n=_n===0?rn-1:_n-1,Qt=Qt===0?rn-1:Qt-1,ot.indices.push(_n),ot.indices.push(An),ot.indices.push(Wt),ot.indices.push(_n),ot.indices.push(Qt),ot.indices.push(An)}return ot})(l[0]),l=[se.geometry]}const le=(Me,Oe)=>Me<(Oe.length-1)/2||Me===Oe.length-1,_e=this.wallMode?[l]:Og(l,500);for(let Me=_e.length-1;Me>=0;Me--){const Oe=_e[Me];(Oe.length===0||uz(Oe[0]))&&_e.splice(Me,1)}let me;if(N)me=fA(_e,P,m);else{me=[];for(const Me of _e)me.push({polygon:Me,bounds:P})}const Ee=U?this.edgeRadius:0,Se=Ee>0&&this.zoom<17,we=(Me,Oe)=>{if(Me.length===0)return!1;const pt=Me[Me.length-1];return Oe.x===pt.x&&Oe.y===pt.y};for(const{polygon:Me,bounds:Oe}of me){let pt=0,ot=0;for(const bt of Me)U&&!bt[0].equals(bt[bt.length-1])&&bt.push(bt[0]),ot+=U?bt.length-1:bt.length;const ut=this.segments.prepareSegment((U?5:4)*ot,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const Tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},vt=new ln;if(vt.vertexOffset=this.footprintVertices.length,vt.indexOffset=3*this.footprintIndices.length,vt.ringIndices=[],U){const bt=[],rt=[];pt=ut.vertexLength;for(let _t=0;_t<Me.length;_t++){const Ct=Me[_t];Ct.length&&_t!==0&&rt.push(bt.length/2);const Et=[];let nn,rn;nn=Ct[1].sub(Ct[0])._perp()._unit(),vt.ringIndices.push(Ct.length-1);for(let Ht=1;Ht<Ct.length;Ht++){const Wt=Ct[Ht],An=Ct[Ht===Ct.length-1?1:Ht+1],_n=Wt.clone();if(Ee){rn=An.sub(Wt)._perp()._unit();const Qt=nn.add(rn)._unit(),Nn=Ee*Math.min(4,1/(nn.x*Qt.x+nn.y*Qt.y));_n.x+=Nn*Qt.x,_n.y+=Nn*Qt.y,_n.x=Math.round(_n.x),_n.y=Math.round(_n.y),nn=rn}if(!X||Ee!==0&&!Se||we(Et,_n)||Et.push(_n),Zr(this.layoutVertexArray,_n.x,_n.y,0,0,1,1,0),this.wallMode){const Qt=le(Ht,Ct);Rt(this.wallVertexArray,se.joinNormals[Ht],!Qt)}ut.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),bt.push(Wt.x,Wt.y),N&&Nt(this.layoutVertexExtArray,k.projectTilePoint(_n.x,_n.y,m),k.upVector(m,_n.x,_n.y))}X&&(Ee===0||Se)&&(Et.length!==0&&we(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Oe,D))}const At=this.wallMode?se.indices:Ql(bt,rt);for(let _t=0;_t<At.length;_t+=3)this.footprintIndices.emplaceBack(vt.vertexOffset+At[_t+0],vt.vertexOffset+At[_t+1],vt.vertexOffset+At[_t+2]),this.indexArray.emplaceBack(pt+At[_t],pt+At[_t+2],pt+At[_t+1]),ut.primitiveLength++;vt.indexCount+=At.length,vt.vertexCount+=this.footprintVertices.length-vt.vertexOffset}for(let bt=0;bt<Me.length;bt++){const rt=Me[bt];Z.startRing(K,rt[0]);let At=rt.length>4&&uA(rt[rt.length-2],rt[0],rt[1]),_t=Ee?cz(rt[rt.length-2],rt[0],rt[1],Ee):0;const Ct=[];let Et,nn,rn;nn=rt[1].sub(rt[0])._perp()._unit();let Ht=!0;for(let Wt=1,An=0;Wt<rt.length;Wt++){let _n=rt[Wt-1],Qt=rt[Wt];const Nn=rt[Wt===rt.length-1?1:Wt+1];if(Z.appendEdge(K,Qt,_n),nw(Qt,_n,Oe)){Ee&&(nn=Nn.sub(Qt)._perp()._unit(),Ht=!Ht);continue}const ii=Qt.sub(_n)._perp(),Di=ii.x/(Math.abs(ii.x)+Math.abs(ii.y)),Qn=ii.y>0?1:0,Zi=_n.dist(Qt);if(An+Zi>32768&&(An=0),Ee){rn=Nn.sub(Qt)._perp()._unit();let Ui=lA(_n,Qt,Nn,P0(nn,rn),Ee);isNaN(Ui)&&(Ui=0);const Er=Qt.sub(_n)._unit();_n=_n.add(Er.mult(_t))._round(),Qt=Qt.add(Er.mult(-Ui))._round(),_t=Ui,nn=rn,X&&this.zoom>=17&&(we(Ct,_n)||Ct.push(_n),we(Ct,Qt)||Ct.push(Qt))}const xi=ut.vertexLength,as=rt.length>4&&uA(_n,Qt,Nn);let wi=hA(An,At,Ht);if(Zr(this.layoutVertexArray,_n.x,_n.y,Di,Qn,0,0,wi),Zr(this.layoutVertexArray,_n.x,_n.y,Di,Qn,0,1,wi),this.wallMode){const Ui=le(Wt-1,rt),Er=se.joinNormals[Wt-1];Rt(this.wallVertexArray,Er,Ui),Rt(this.wallVertexArray,Er,Ui)}if(An+=Zi,wi=hA(An,as,!Ht),At=as,Zr(this.layoutVertexArray,Qt.x,Qt.y,Di,Qn,0,0,wi),Zr(this.layoutVertexArray,Qt.x,Qt.y,Di,Qn,0,1,wi),this.wallMode){const Ui=le(Wt,rt),Er=se.joinNormals[Wt];Rt(this.wallVertexArray,Er,Ui),Rt(this.wallVertexArray,Er,Ui)}if(ut.vertexLength+=4,this.indexArray.emplaceBack(xi+0,xi+1,xi+2),this.indexArray.emplaceBack(xi+1,xi+3,xi+2),ut.primitiveLength+=2,Ee){const Ui=pt+(Wt===1?rt.length-2:Wt-2),Er=Wt===1?pt:Ui+1;if(this.indexArray.emplaceBack(xi+1,Ui,xi+3),this.indexArray.emplaceBack(Ui,Er,xi+3),ut.primitiveLength+=2,Et===void 0&&(Et=xi),!nw(Nn,rt[Wt],Oe)){const Nr=Wt===rt.length-1?Et:ut.vertexLength;this.indexArray.emplaceBack(xi+2,xi+3,Nr),this.indexArray.emplaceBack(xi+3,Nr+1,Nr),this.indexArray.emplaceBack(xi+3,Er,Nr+1),ut.primitiveLength+=3}Ht=!Ht}if(N){const Ui=this.layoutVertexExtArray,Er=k.projectTilePoint(_n.x,_n.y,m),Nr=k.projectTilePoint(Qt.x,Qt.y,m),Br=k.upVector(m,_n.x,_n.y),os=k.upVector(m,Qt.x,Qt.y);Nt(Ui,Er,Br),Nt(Ui,Er,Br),Nt(Ui,Nr,os),Nt(Ui,Nr,os)}}U&&(pt+=rt.length-1),X&&Ee&&this.zoom>=17&&(Ct.length!==0&&we(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,Oe,D,Ee>0))}this.footprintSegments.push(vt),Tt.triangleCount=this.indexArray.length-Tt.triangleArrayOffset,this.polygonSegments.push(Tt),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=Z.borders?Wn:this.encodeCentroid(Z,K),this.centroidData.push(K),Z.borders){this.featuresOnBorder.push(Z);const Me=this.featuresOnBorder.length-1;for(let Oe=0;Oe<Z.borders.length;Oe++)Z.borders[Oe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Oe].push(Me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,_,v,m,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,d,_,v,m,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,te)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],A=+(S.min.y+S.max.y>jt),D=2*A+(+(S.min.x+S.max.x>jt)^A);for(let P=0;P<S.polygonSegLen;P++){const k=S.polygonSegIdx+P;e.push({centroidIdx:v,subtile:D,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new xs;e.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let l=0,d=0,m=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;m++}const _=e.length;for(;d!==e.length;){l=e[d].triangleSegmentIdx;let v=0,S=d,A=d;for(let D=S;D<m&&e[D].subtile===v;D++)A++;for(;S!==m;){const D=e[S];v=D.subtile;const P=this.centroidData[D.centroidIdx].min.clone(),k=this.centroidData[D.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=S;U<A;U++){const Z=e[U],K=this.polygonSegments[Z.polygonSegmentIdx],X=this.centroidData[Z.centroidIdx].min,te=this.centroidData[Z.centroidIdx].max,se=this.indexArray.uint16;for(let le=K.triangleArrayOffset;le<K.triangleArrayOffset+K.triangleCount;le++)i.emplaceBack(se[3*le],se[3*le+1],se[3*le+2]);N.primitiveLength+=K.triangleCount,P.x=Math.min(P.x,X.x),P.y=Math.min(P.y,X.y),k.x=Math.max(k.x,te.x),k.y=Math.max(k.y,te.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:P,max:k}),S=A;for(let U=S;U<m&&e[U].subtile===e[S].subtile;U++)A++}d=m;for(let D=d;D<_&&e[D].triangleSegmentIdx===e[d].triangleSegmentIdx;D++)m++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,l){const d=new mr;if(this.wallMode){for(const Z of this.triangleSubSegments)d.segments.push(Z.segment);return d}let m=0,_=0;const v=1<<e.canonical.z;if(i){const Z=i.getMinMaxForTile(e);Z&&(m=Z.min,_=Z.max)}_+=this.maxHeight;const S=e.toUnwrapped();let A;const D=[S.canonical.x/v+S.wrap,S.canonical.y/v],P=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],k=(Z,K,X)=>[Z[0]*(1-X[0])+K[0]*X[0],Z[1]*(1-X[1])+K[1]*X[1]],N=[],U=[];for(const Z of this.triangleSubSegments){N[0]=Z.min.x/jt,N[1]=Z.min.y/jt,U[0]=Z.max.x/jt,U[1]=Z.max.y/jt;const K=k(D,P,N),X=k(D,P,U);if(new Ii([K[0],K[1],m],[X[0],X[1],_]).intersectsPrecise(l)===0){A&&(d.segments.push(A),A=void 0);continue}const te=Z.segment;A&&A.vertexOffset!==te.vertexOffset&&(d.segments.push(A),A=void 0),A?(A.vertexLength+=te.vertexLength,A.primitiveLength+=te.primitiveLength):A={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&d.segments.push(A),d}encodeCentroid(e,i){const l=e.centroid(),d=i.span(),m=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Mt(xe(l.x,1,8191)<<3|m,xe(l.y,1,8191)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Mt(0,0);const i=e.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const d=i[0][0]!==l?0:1;return new Mt(6|(i[0][0]!==l?0:65528),(i[d][0]+i[d][1])/2<<3|6)}{const d=i[2][0]!==l?2:3;return new Mt((i[d][0]+i[d][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,d=e.flags&fi?Wn:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==d.y||m!==d.x){for(let _=i;_<l;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped());if(h(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const S of this.centroidData)S.flags&fi||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y||_.footprint.buildingIds.has(S.buildingId)&&(S.flags|=fi);else for(const S of this.centroidData)if(!(S.flags&fi||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y))for(let A=0;A<S.footprintSegLen;A++){const D=this.footprintSegments[S.footprintSegIdx+A];if(m.length=0,hz(this.footprintVertices,D.vertexOffset,D.vertexCount,_.footprintTileId.canonical,e.canonical,m),R(_.footprint,m,this.footprintIndices.uint16,D.indexOffset,D.indexCount,-D.vertexOffset,-v)){S.flags|=fi;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,l){let d=!1;for(let m=0;m<l.footprintSegLen;m++){const _=this.footprintSegments[l.footprintSegIdx+m];let v=0;for(const S of _.ringIndices){for(let A=v,D=S+v-1;A<S+v;D=A++){const P=this.footprintVertices.int16[2*(A+_.vertexOffset)+0],k=this.footprintVertices.int16[2*(A+_.vertexOffset)+1],N=this.footprintVertices.int16[2*(D+_.vertexOffset)+1];k>i!=N>i&&e<(this.footprintVertices.int16[2*(D+_.vertexOffset)+0]-P)*(i-k)/(N-k)+P&&(d=!d)}v=S}}return d}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,d=!0;const m=4*(e+jt)*jt+(i+jt);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&fi)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=l||this.footprintContainsPoint(e,i,_)&&(l=_.height,this.partLookup[m]=_,d=!!(_.flags&fi));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:d};this.partLookup[m]=void 0}}function P0(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function cz(r,e,i,l){const d=e.sub(r)._perp()._unit(),m=i.sub(e)._perp()._unit();return lA(r,e,i,P0(d,m),l)}function lA(r,e,i,l,d){const m=Math.sqrt(1-l*l);return Math.min(r.dist(e)/3,e.dist(i)/3,d*m/l)}function nw(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function cA(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function uz(r){return r.every(e=>e.x<=0)||r.every(e=>e.x>=jt)||r.every(e=>e.y<=0)||r.every(e=>e.y>=jt)}function uA(r,e,i){if(r.x<0||r.x>=jt||e.x<0||e.x>=jt||i.x<0||i.x>=jt)return!1;const l=i.sub(e),d=l.perp(),m=r.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function hA(r,e,i){const l=e?2|r:-3&r;return i?1|l:-2&l}function dA(){const r=Math.PI/32,e=Math.tan(r),i=Ae;return i*Math.sqrt(1+2*e*e)-i}function fA(r,e,i){const l=1<<i.z,d=lt(i.x/l),m=lt((i.x+1)/l),_=xt(i.y/l),v=xt((i.y+1)/l);return(function(S,A,D,P,k=0,N){const U=[];if(!S.length||!D||!P)return U;const Z=(me,Ee)=>{for(const Se of me)U.push({polygon:Se,bounds:Ee})},K=Math.ceil(Math.log2(D)),X=Math.ceil(Math.log2(P)),te=K-X,se=[];for(let me=0;me<Math.abs(te);me++)se.push(te>0?0:1);for(let me=0;me<Math.min(K,X);me++)se.push(0),se.push(1);let le=S;if(le=cp(le,A[0].y-k,A[1].y+k,1),le=cp(le,A[0].x-k,A[1].x+k,0),!le.length)return U;const _e=[];for(se.length?_e.push({polygons:le,bounds:A,depth:0}):Z(le,A);_e.length;){const me=_e.pop(),Ee=me.depth,Se=se[Ee],we=me.bounds[0],Me=me.bounds[1],Oe=Se===0?we.x:we.y,pt=Se===0?Me.x:Me.y,ot=N?N(Se,Oe,pt):.5*(Oe+pt),ut=cp(me.polygons,Oe-k,ot+k,Se),Tt=cp(me.polygons,ot-k,pt+k,Se);if(ut.length){const vt=[we,new Mt(Se===0?ot:Me.x,Se===1?ot:Me.y)];se.length>Ee+1?_e.push({polygons:ut,bounds:vt,depth:Ee+1}):Z(ut,vt)}if(Tt.length){const vt=[new Mt(Se===0?ot:we.x,Se===1?ot:we.y),Me];se.length>Ee+1?_e.push({polygons:Tt,bounds:vt,depth:Ee+1}):Z(Tt,vt)}}return U})(r,e,Math.ceil((m-d)/11.25),Math.ceil((_-v)/11.25),1,(S,A,D)=>{if(S===0)return .5*(A+D);{const P=xt((i.y+A/jt)/l);return(We(.5*(xt((i.y+D/jt)/l)+P))*l-i.y)*jt}})}function hz(r,e,i,l,d,m){const _=Math.pow(2,l.z-d.z);for(let v=0;v<i;v++){let S=r.int16[2*(v+e)+0],A=r.int16[2*(v+e)+1];S=(S+d.x*jt)*_-l.x*jt,A=(A+d.y*jt)*_-l.y*jt,m.push(new Mt(S,A))}}let pA,mA;Bt(cu,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(gi,"PartData"),Bt(ln,"FootprintSegment"),Bt(Or,"BorderCentroidData"),Bt(Rr,"GroundEffect");class Gg extends Mt{constructor(e,i,l){super(e,i),this.z=l}}class gA extends Gg{constructor(e,i,l,d){super(e,i,l),this.w=d}}function _A(r,e,i,l){const d=i==="x"?"y":"x",m=(l-r[i])/(e[i]-r[i]);r[d]=Math.round(r[d]+(e[d]-r[d])*m),r[i]=l,r.hasOwnProperty("z")&&(r.z=Cn(r.z,e.z,m)),r.hasOwnProperty("w")&&(r.w=Cn(r.w,e.w,m))}function yA(r,e,i,l){const d=i,m=l;for(const _ of["x","y"]){let v=r,S=e;v[_]>=S[_]&&(v=e,S=r),v[_]<d&&S[_]>d&&_A(v,S,_,d),v[_]<m&&S[_]>m&&_A(S,v,_,m)}}function k0(r,e,i,l,d,m){const _=[];for(let v=0;v<r.length;v++){const S=r[v];let A;const D=_.length;let P=0;for(let k=0;k<S.length-1;k++){let N=S[k],U=S[k+1],Z=0;const K=P;let X,te;m&&(Z=Math.hypot(U.x-N.x,U.y-N.y),P+=Z,X=N,te=U),N.x<e&&U.x<e||(N.x<e?N=new Mt(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<e&&(U=new Mt(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<i&&U.y<i||(N.y<i?N=new Mt(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round():U.y<i&&(U=new Mt(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round()),N.x>=l&&U.x>=l||(N.x>=l?N=new Mt(l,N.y+(l-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=l&&(U=new Mt(l,N.y+(l-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=d&&U.y>=d||(N.y>=d?N=new Mt(N.x+(d-N.y)/(U.y-N.y)*(U.x-N.x),d)._round():U.y>=d&&(U=new Mt(N.x+(d-N.y)/(U.y-N.y)*(U.x-N.x),d)._round()),A&&N.equals(A[A.length-1])||(A=[N],_.push(A),m&&m.push({progress:{min:K+xA(X,te,N)*Z,max:1},parentIndex:v,prevPoint:X,nextPoint:te})),A.push(U),m&&(m[m.length-1].progress.max=K+xA(X,te,U)*Z,m[m.length-1].nextPoint=te)))))}if(m&&P>0)for(let k=D;k<_.length;k++)m[k].progress.min/=P,m[k].progress.max/=P}return _}function dz(r,e,i,l,d){if(r.length<2)return void l.push(r);const m=[];for(;e.valid();){const[A,D]=e.get();for(let P=0;P<r.length-1;P++){const k=r[P],N=r[P+1],U=Fd(k,N,A,D);if(U){const[Z]=U,K=new Mt(Cn(k.x,N.x,Z),Cn(k.y,N.y,Z));m.push({t:P+Z,distance:0,point:K})}}e.next()}if(m.length===0)return void l.push(r);m.sort((A,D)=>A.t-D.t);let _=0,v=0,S=[];for(l.push(S);_!==r.length;){if(v===m.length){for(;_!==r.length;)S.length!==0&&S[S.length-1].equals(r[_])||S.push(r[_]),_++;break}m[v].t<=_?(S.length!==0&&S[S.length-1].equals(m[v].point)||S.push(m[v].point),Math.trunc(m[v].t),v++):(S.length!==0&&S[S.length-1].equals(r[_])||S.push(r[_]),_++)}}function xA(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Ix(r,e){return r.x*e.x+r.y*e.y}function vA(r,e){if(r.length===1){let i=0;const l=e[i++];let d;for(;!d||l.equals(d);)if(d=e[i++],!d)return 1/0;for(;i<e.length;i++){const m=e[i],_=r[0],v=d.sub(l),S=m.sub(l),A=_.sub(l),D=Ix(v,v),P=Ix(v,S),k=Ix(S,S),N=Ix(A,v),U=Ix(A,S),Z=D*k-P*P,K=(k*N-P*U)/Z,X=(D*U-P*N)/Z,te=l.z*(1-K-X)+d.z*K+m.z*X;if(isFinite(te))return te}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function bA(r,e,i){let l=1/0;rr(i,e)&&(l=vA(i,e[0]));for(let d=0;d<e.length;d++){const m=e[d],_=r[d];for(let v=0;v<m.length-1;v++){const S=m[v],A=[S,m[v+1],_[v+1],_[v],S];Tr(i,A)&&(l=Math.min(l,vA(i,A)))}}return l!==1/0&&l}function wA(r,e,i,l,d,m,_,v,S,A,D){return r.projection.name==="globe"?(function(P,k,N,U,Z,K,X,te,se,le,_e){const me=[],Ee=[],Se=P.projection.upVectorScale(_e,P.center.lat,P.worldSize).metersToTile,we=[0,0,0,1],Me=[0,0,0,1],Oe=(ot,ut,Tt,vt)=>{ot[0]=ut,ot[1]=Tt,ot[2]=vt,ot[3]=1},pt=dA();N>0&&(N+=pt),U+=pt;for(const ot of k){const ut=[],Tt=[];for(const vt of ot){const bt=vt.x+Z.x,rt=vt.y+Z.y,At=P.projection.projectTilePoint(bt,rt,_e),_t=P.projection.upVector(_e,vt.x,vt.y);let Ct=N,Et=U;if(X){const nn=TA(bt,rt,N,U,X,te,se,le);Ct+=nn.base,Et+=nn.top}N!==0?Oe(we,At.x+_t[0]*Se*Ct,At.y+_t[1]*Se*Ct,At.z+_t[2]*Se*Ct):Oe(we,At.x,At.y,At.z),Oe(Me,At.x+_t[0]*Se*Et,At.y+_t[1]*Se*Et,At.z+_t[2]*Se*Et),cr(we,we,K),cr(Me,Me,K),ut.push(new Gg(we[0],we[1],we[2])),Tt.push(new Gg(Me[0],Me[1],Me[2]))}me.push(ut),Ee.push(Tt)}return[me,Ee]})(r,e,i,l,d,m,_,v,S,A,D):_?(function(P,k,N,U,Z,K,X,te,se){const le=[],_e=[],me=[0,0,0,1];for(const Ee of P){const Se=[],we=[];for(const Me of Ee){const Oe=Me.x+U.x,pt=Me.y+U.y,ot=TA(Oe,pt,k,N,K,X,te,se);me[0]=Oe,me[1]=pt,me[2]=ot.base,me[3]=1,vs(me,me,Z),me[3]=Math.max(me[3],1e-5);const ut=new Gg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);me[0]=Oe,me[1]=pt,me[2]=ot.top,me[3]=1,vs(me,me,Z),me[3]=Math.max(me[3],1e-5);const Tt=new Gg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);Se.push(ut),we.push(Tt)}le.push(Se),_e.push(we)}return[le,_e]})(e,i,l,d,m,_,v,S,A):(function(P,k,N,U,Z){const K=[],X=[],te=Z[8]*k,se=Z[9]*k,le=Z[10]*k,_e=Z[11]*k,me=Z[8]*N,Ee=Z[9]*N,Se=Z[10]*N,we=Z[11]*N;for(const Me of P){const Oe=[],pt=[];for(const ot of Me){const ut=ot.x+U.x,Tt=ot.y+U.y,vt=Z[0]*ut+Z[4]*Tt+Z[12],bt=Z[1]*ut+Z[5]*Tt+Z[13],rt=Z[2]*ut+Z[6]*Tt+Z[14],At=Z[3]*ut+Z[7]*Tt+Z[15],_t=vt+te,Ct=bt+se,Et=rt+le,nn=Math.max(At+_e,1e-5),rn=vt+me,Ht=bt+Ee,Wt=rt+Se,An=Math.max(At+we,1e-5);Oe.push(new Gg(_t/nn,Ct/nn,Et/nn)),pt.push(new Gg(rn/An,Ht/An,Wt/An))}K.push(Oe),X.push(pt)}return[K,X]})(e,i,l,d,m)}function TA(r,e,i,l,d,m,_,v){const S=_*d.getElevationAt(r,e,!0,!0),A=m[0]!==0,D=A?m[1]===0?_*(m[0]/7-450):_*(function(P,k,N){const U=Math.floor(k[0]/8),Z=Math.floor(k[1]/8),K=10*(k[0]-8*U),X=10*(k[1]-8*Z),te=P.getElevationAt(U,Z,!0,!0),se=P.getMeterToDEM(N),le=Math.floor(.5*(K*se-1)),_e=Math.floor(.5*(X*se-1)),me=P.tileCoordToPixel(U,Z),Ee=2*le+1,Se=2*_e+1,we=(function(Tt,vt,bt,rt,At){return[Tt.getElevationAtPixel(vt,bt,!0),Tt.getElevationAtPixel(vt+At,bt,!0),Tt.getElevationAtPixel(vt,bt+At,!0),Tt.getElevationAtPixel(vt+rt,bt+At,!0)]})(P,me.x-le,me.y-_e,Ee,Se),Me=Math.abs(we[0]-we[1]),Oe=Math.abs(we[2]-we[3]),pt=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),ot=Math.min(.25,.5*se*(Me+Oe)/Ee),ut=Math.min(.25,.5*se*pt/Se);return te+Math.max(ot*K,ut*X)})(d,m,v):S;return{base:S+(i===0?-1:i),top:A?Math.max(D+l,S+i+2):S+l}}class fz{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class pz{constructor(){this.tasks={},this.taskQueue=[],tn(["process"],this),this.invoker=new fz(this.process),this.nextId=0}add(e,i){const l=this.nextId++,d=(function({type:m,isSymbolTile:_,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||_?m!=="parseTile"||_?m==="parseTile"&&_?300-v:m==="maybePrepare"&&_?400-v:500:200-v:100-v})(i);if(d===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:i,priority:d,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<i&&(i=m.priority,e=d)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class EA{constructor(e,i,l){this.target=e,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},tn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new pz}send(e,i,l,d,m=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[v]=l);const S=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:Hr(i,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(i.mustQueue||br(self)){const d=this.callbacks[l],m=this.scheduler.add(()=>this.processTask(l,i),d&&d.metadata||{type:"message"});m&&(this.cancelCallbacks[l]=m)}else this.processTask(l,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(i.error?l(yl(i.error)):l(null,yl(i.data)))}else{const l=new Set,d=i.hasCallback?(_,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?Hr(_):null,data:Hr(v,l)},l)}:()=>{},m=yl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,d);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:v,scope:S}=m;this.parent.getWorkerSource(i.sourceMapId,_[0],v,S)[_[1]](m,d)}else d(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Cx={workerUrl:"",workerClass:null,workerParams:void 0};function mz(r){return Cx.workerClass!=null?new Cx.workerClass:new self.Worker(Cx.workerUrl,Object.assign({name:r},Cx.workerParams))}const iw="mapboxgl_preloaded_worker_pool";class qg{constructor(e){this.active={},this.name=e}acquire(e,i=qg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const l=mz(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(l)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[iw]}numActive(){return Object.keys(this.active).length}}qg.workerCount=2;class X_{constructor(e,i,l="Worker",d=qg.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Dt();const m=this.workerPool.acquire(this.id,d);for(let _=0;_<m.length;_++){const v=new X_.Actor(m[_],i,this.id);v.name=`${l} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,l){Ge(this.actors,(d,m)=>{d.send(e,i,m)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Rx,rw;function L0(){return Rx||(Rx=new qg),Rx}X_.Actor=EA;const sw=4096;class gz{constructor(e){this.module=e,this.memoryStack=this.module.malloc(sw),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>sw?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>sw?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,l){this.module.setFauxFacadeOptions(e?1:0,i?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const v of e){const S=this.createIntArray(v.ringIndices),A=this.createFloatArray(v.coordinates);if(S===-1||A===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,A,S,v.ringIndices.length-1)}for(const v of i){let S;S=v.entrances?JSON.parse(v.entrances):[];const A=this.createFloatArray(S),D=this.createFloatArray(v.coordinates);if(A===-1||D===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,A,S.length,D,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const l=this.module.getMeshCount(),d=new Array(l);for(let v=0;v<l;v++){const S=this.module.getPositionsPtr(v),A=this.module.getPositionsLength(v),D=new Float32Array(this.module.heapF32.buffer,S,A),P=this.module.getNormalsPtr(v),k=this.module.getNormalsLength(v),N=new Float32Array(this.module.heapF32.buffer,P,k),U=this.module.getAOPtr(v),Z=this.module.getAOLength(v),K=new Float32Array(this.module.heapF32.buffer,U,Z),X=this.module.getUVPtr(v),te=this.module.getUVLength(v),se=new Float32Array(this.module.heapF32.buffer,X,te),le=this.module.getFauxFacadePtr(v),_e=this.module.getFauxFacadeLength(v),me=new Uint8Array(this.module.heapU8.buffer,le,_e),Ee=this.module.getIndicesPtr(v),Se=this.module.getIndicesLength(v),we=new Int16Array(this.module.heap16.buffer,Ee,Se),Me=this.module.getBuildingPart(v);d[v]={positions:D,normals:N,ao:K,uv:se,isFauxFacade:me,indices:we,buildingPart:Me}}const m=this.module.getRingCount(),_=[];for(let v=0;v<m;v++){const S=this.module.getRingPtr(v),A=this.module.getRingLength(v),D=new Float32Array(this.module.heapF32.buffer,S,A);_.push(D)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Mx,aw,Gh,Y_,ow,K_=null,Q_=null,SA=null,z0=null;function AA(){return br(self)&&self.worker.dracoUrl?self.worker.dracoUrl:aw||es.DRACO_URL}function IA(){if(br(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Y_)return Y_;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Y_=WebAssembly.validate(r)?es.MESHOPT_SIMD_URL:es.MESHOPT_URL,Y_}function _z(){return z0}const CA=5120,RA=5121,MA=5122,DA=5123,PA=5125,kA=5126,O0={[CA]:Int8Array,[RA]:Uint8Array,[MA]:Int16Array,[DA]:Uint16Array,[PA]:Uint32Array,[kA]:Float32Array},yz={[CA]:"DT_INT8",[RA]:"DT_UINT8",[MA]:"DT_INT16",[DA]:"DT_UINT16",[PA]:"DT_UINT32",[kA]:"DT_FLOAT32"},Dx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function LA(r,e,i){const l=i.json.bufferViews.length,d=i.buffers.length;e.bufferView=l,i.json.bufferViews[l]={buffer:d,byteLength:r.byteLength},i.buffers[d]=r}const lw="KHR_draco_mesh_compression";function xz(r,e){const i=r.extensions&&r.extensions[lw];if(!i)return;const l=new Gh.Decoder,d=BA(e,i.bufferView),m=new Gh.Mesh;if(!l.DecodeArrayToMesh(d,d.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],v=O0[_.componentType],S=_.count*v.BYTES_PER_ELEMENT,A=Gh._malloc(S);v===Uint16Array?l.GetTrianglesUInt16Array(m,S,A):l.GetTrianglesUInt32Array(m,S,A),LA(Gh.memory.buffer.slice(A,A+S),_,e),Gh._free(A);for(const D of Object.keys(i.attributes)){const P=l.GetAttributeByUniqueId(m,i.attributes[D]),k=e.json.accessors[r.attributes[D]],N=yz[k.componentType],U=k.count*Dx[k.type]*O0[k.componentType].BYTES_PER_ELEMENT,Z=Gh._malloc(U);l.GetAttributeDataArrayForAllPoints(m,P,Gh[N],U,Z),LA(Gh.memory.buffer.slice(Z,Z+U),k,e),Gh._free(Z)}l.destroy(),m.destroy(),delete r.extensions[lw]}const N0="EXT_meshopt_compression";function vz(r,e){if(!r.extensions||!r.extensions[N0])return;const i=r.extensions[N0],l=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),d=new Uint8Array(i.count*i.byteStride);ow.decodeGltfBuffer(d,i.count,i.byteStride,l,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=d.buffer,delete r.extensions[N0]}const zA=1179937895,OA=new TextDecoder("utf8");function NA(r,e){return new URL(r,e).href}function bz(r,e,i,l){return fetch(NA(r.uri,l)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[i]=d})}function BA(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function wz(r,e,i,l){if(r.uri){const d=NA(r.uri,l);return fetch(d).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[i]=m})}if(r.bufferView!==void 0){const d=BA(e,r.bufferView),m=new Blob([d],{type:r.mimeType});return createImageBitmap(m).then(_=>{e.images[i]=_})}}function FA(r,e=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===zA){const D=new Uint32Array(r,e);let P=2;const k=(D[P++]>>2)-3,N=D[P++]>>2;if(P++,l.json=JSON.parse(OA.decode(D.subarray(P,P+N))),P+=N,P<k){const U=D[P++];P++;const Z=e+(P<<2);l.buffers[0]=r.slice(Z,Z+U)}}else l.json=JSON.parse(OA.decode(new Uint8Array(r,e)));const{buffers:d,images:m,meshes:_,extensionsUsed:v,bufferViews:S}=l.json;let A=Promise.resolve();if(d){const D=[];for(let P=0;P<d.length;P++){const k=d[P];k.uri?D.push(bz(k,l,P,i)):l.buffers[P]||(l.buffers[P]=null)}A=Promise.all(D)}return A.then(()=>{const D=[],P=v&&v.includes(lw),k=v&&v.includes(N0);if(P&&D.push((function(){if(!Gh)return Mx??(Mx=(function(N){let U,Z=null;function K(){U=new Uint8Array(Z.buffer)}function X(){throw new Error("Unexpected Draco error.")}const te={a:{a:X,d:function(se,le,_e){return U.copyWithin(se,le,le+_e)},c:function(se){const le=U.length,_e=Math.max(se>>>0,Math.ceil(1.2*le)),me=Math.ceil((_e-le)/65536);try{return Z.grow(me),K(),!0}catch{return!1}},b:X}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,te):N.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,te))).then(se=>{const{Rb:le,Qb:_e,P:me,T:Ee,X:Se,Ja:we,La:Me,Qa:Oe,Va:pt,Wa:ot,eb:ut,jb:Tt,f:vt,e:bt,yb:rt,zb:At,Ab:_t,Bb:Ct,Db:Et,Gb:nn}=se.instance.exports;Z=bt;const rn=(()=>{let Ht=0,Wt=0,An=0,_n=0;return Qt=>{An&&(le(_n),le(Ht),Wt+=An,An=Ht=0),Ht||(Wt+=128,Ht=_e(Wt));const Nn=Qt.length+7&-8;let ii=Ht;Nn>=Wt&&(An=Nn,ii=_n=_e(Nn));for(let Di=0;Di<Qt.length;Di++)U[ii+Di]=Qt[Di];return ii}})();return K(),vt(),{memory:bt,_free:le,_malloc:_e,Mesh:class{constructor(){this.ptr=me()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){Tt(this.ptr)}DecodeArrayToMesh(Ht,Wt,An){const _n=rn(Ht),Qt=Me(this.ptr,_n,Wt,An.ptr);return!!Se(Qt)}GetAttributeByUniqueId(Ht,Wt){return{ptr:Oe(this.ptr,Ht.ptr,Wt)}}GetTrianglesUInt16Array(Ht,Wt,An){pt(this.ptr,Ht.ptr,Wt,An)}GetTrianglesUInt32Array(Ht,Wt,An){ot(this.ptr,Ht.ptr,Wt,An)}GetAttributeDataArrayForAllPoints(Ht,Wt,An,_n,Qt){ut(this.ptr,Ht.ptr,Wt.ptr,An,_n,Qt)}},DT_INT8:rt(),DT_UINT8:At(),DT_INT16:_t(),DT_UINT16:Ct(),DT_UINT32:Et(),DT_FLOAT32:nn()}})})(fetch(AA())),Mx.then(N=>{Gh=N,Mx=void 0}))})()),k&&D.push((function(){if(ow)return;const N=(function(U){let Z;const K=WebAssembly.instantiateStreaming(U,{}).then(se=>{Z=se.instance,Z.exports.__wasm_call_ctors()}),X={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(se,le,_e,me,Ee,Se){(function(we,Me,Oe,pt,ot,ut,Tt){const vt=we.exports.sbrk,bt=pt+3&-4,rt=vt(bt*ot),At=vt(ut.length),_t=new Uint8Array(we.exports.memory.buffer);_t.set(ut,At);const Ct=Me(rt,pt,ot,At,ut.length);if(Ct===0&&Tt&&Tt(rt,bt,ot),Oe.set(_t.subarray(rt,rt+pt*ot)),vt(rt-vt(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(Z,Z.exports[te[Ee]],se,le,_e,me,Z.exports[X[Se]])}}})(fetch(IA()));return N.ready.then(()=>{ow=N})})()),m)for(let N=0;N<m.length;N++)D.push(wz(m[N],l,N,i));return(D.length?Promise.all(D):Promise.resolve()).then(()=>{if(P&&_)for(const{primitives:N}of _)for(const U of N)xz(U,l);if(k&&_&&S)for(const N of S)vz(N,l);return l})})}function VA(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>FA(e,0,r))}function cw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function uw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hw{constructor(e,i,l,d){this.context=e,this.format=l,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:d&&d.premultiply})}update(e,i){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:_}=m,{x:v,y:S}=i&&i.position?i.position:{x:0,y:0},A=v+l,D=S+d;!this.size||this.size[0]===A&&this.size[1]===D||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&D>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(A,D)))+1:1;_.texStorage2D(_.TEXTURE_2D,k,this.format,A,D),this.size=[A,D]}this.size&&(P?_.texSubImage2D(_.TEXTURE_2D,0,v,S,cw(this.format),uw(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,S,l,d,cw(this.format),uw(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,l=!1){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,l,d,m){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),this.wrapS=l),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Px{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}}const Tz=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),Ez=ei([{name:"a_color_3f",components:3,type:"Float32"}]),Sz=ei([{name:"a_color_4f",components:4,type:"Float32"}]),Az=ei([{name:"a_uv_2f",components:2,type:"Float32"}]),Iz=ei([{name:"a_normal_3f",components:3,type:"Float32"}]),Cz=ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Rz=ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function jA(r,e){const i=B0(r.projection,r.zoom,r.width,r.height),l=(function(m,_,v,S,A){const D=new ge(v.lng-180*xm,v.lat),P=new ge(v.lng+180*xm,v.lat),k=m.project(D.lng,D.lat),N=m.project(P.lng,P.lat),U=-Math.atan2(N.y-k.y,N.x-k.x),Z=qt.fromLngLat(v);Z.y=xe(Z.y,-1+xm,1-xm);const K=Z.toLngLat(),X=m.project(K.lng,K.lat),te=qt.fromLngLat(K);te.x+=xm;const se=te.toLngLat(),le=m.project(se.lng,se.lat),_e=GA(le.x-X.x,le.y-X.y,U),me=qt.fromLngLat(K);me.y+=xm;const Ee=me.toLngLat(),Se=m.project(Ee.lng,Ee.lat),we=GA(Se.x-X.x,Se.y-X.y,U),Me=Math.abs(_e.x)/Math.abs(we.y),Oe=Xe([]);je(Oe,Oe,-U*(1-(A?0:S)));const pt=Xe([]);return Ft(pt,pt,[1,1-(1-Me)*S,1]),pt[4]=-we.x/we.y*S,je(pt,pt,U),ft(pt,Oe,pt),pt})(r.projection,0,r.center,i,e),d=UA(r);return Ft(l,l,[d,d,1]),l}function UA(r){const e=r.projection,i=B0(r.projection,r.zoom,r.width,r.height),l=dw(e,r.center),d=dw(e,ge.convert(e.center));return Math.pow(2,l*i+(1-i)*d)}function B0(r,e,i,l,d=1/0){const m=r.range;if(!m)return 0;const _=Math.min(d,Math.max(i,l)),v=Math.log2(_/1024);return Be(m[0]+v,m[1]+v,e)}const xm=1/4e4;function dw(r,e){const i=xe(e.lat,-85.051129,ke),l=new ge(e.lng-180*xm,i),d=new ge(e.lng+180*xm,i),m=r.project(l.lng,i),_=r.project(d.lng,i),v=qt.fromLngLat(l),S=qt.fromLngLat(d),A=_.x-m.x,D=_.y-m.y,P=S.x-v.x,k=S.y-v.y,N=Math.sqrt((P*P+k*k)/(A*A+D*D));return Math.log2(N)}function GA(r,e,i){const l=Math.cos(i),d=Math.sin(i);return{x:r*l-e*d,y:r*d+e*l}}function qA(r,e,i){Xe(r),je(r,r,ai(e[2])),fn(r,r,ai(e[0])),St(r,r,ai(e[1])),Ft(r,r,i),ft(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function F0(r,e,i,l,d,m,_,v){const S=[i[0]-e[0],i[1]-e[1],0],A=[l[0]-e[0],l[1]-e[1],0];if(dn(S)<1e-12||dn(A)<1e-12)return Tn(r);const D=jr([],S,A);Gn(D,D),ci(A,l,e),S[2]=(m-d)*v,A[2]=(_-d)*v;const P=S;return jr(P,S,A),Gn(P,P),kr(r,D,P)}function V0(r,e,i=!1){const l=Fh(e.zoom),d=(function(m,_,v){const S=_.worldSize,A=[m[12],m[13],m[14]],D=xt(A[1]/S),P=lt(A[0]/S),k=Xe([]),N=$e(1,D)*S,U=$e(1,0)*S*nt(D,_.zoom),Z=1/Ig(S);let K=U*Z;if(v){const le=B0(_.projection,_.zoom,_.width,_.height,1024);K=Z*_.projection.pixelSpaceConversion(_.center.lat,S,le)}const X=Te(D,P);En(X,X,Ne([],Gn([],X),N*K*A[2]));const te=(function(le){const _e=[le[0],le[1],le[2]];let me=[0,1,0];const Ee=jr([],me,_e);return jr(me,_e,Ee),Ci(me)===0&&(me=[0,1,0],jr(Ee,_e,me)),Gn(Ee,Ee),Gn(me,me),Gn(_e,_e),[Ee[0],Ee[1],Ee[2],0,me[0],me[1],me[2],0,_e[0],_e[1],_e[2],0,le[0],le[1],le[2],1]})(X);Ft(k,k,[K,K,K*N]),ht(k,k,[-A[0],-A[1],-A[2]]);const se=ft([],_.globeMatrix,te);return ft(se,se,k),ft(se,se,m),se})(r,e,i);if(l>0){const m=(function(_,v){const S=v.worldSize,A=$e(1,0)*S*nt(v.center.lat,v.zoom)/Ig(S),D=$e(1,v.center.lat)*S,P=Xe([]);St(P,P,ai(v.center.lng)),fn(P,P,ai(v.center.lat)),ht(P,P,[0,0,ee]),Ft(P,P,[A,A,A*D]);const k=v.point;return ht(P,P,[-k.x,-k.y,0]),ft(P,P,_),ft(P,v.globeMatrix,P)})(r,e);return(function(_,v,S){const A=(U,Z,K)=>{const X=dn(U),te=dn(Z),se=Uu(U,Z,K);return Ne(se,se,1/dn(se)*Cn(X,te,K))},D=A([_[0],_[1],_[2]],[v[0],v[1],v[2]],S),P=A([_[4],_[5],_[6]],[v[4],v[5],v[6]],S),k=A([_[8],_[9],_[10]],[v[8],v[9],v[10]],S),N=Uu([_[12],_[13],_[14]],[v[12],v[13],v[14]],S);return[D[0],D[1],D[2],0,P[0],P[1],P[2],0,k[0],k[1],k[2],0,N[0],N[1],N[2],1]})(d,m,l)}return d}function fw(r,e,i,l){const d=Ii.projectAabbCorners(l,i);let m=Number.MAX_VALUE;for(let v=0;v<d.length;++v){const S=d[v];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<m&&(m=S[2])}const _=(function(v){const S=[];let A=0;for(let N=1;N<v.length;N++)(v[N][0]<v[A][0]||v[N][0]===v[A][0]&&v[N][1]<v[A][1])&&(A=N);let D,P=A;const k=new Uint8Array(v.length);do{if(k[P])break;S.push(new Mt(v[P][0],v[P][1])),k[P]=1,D=(P+1)%v.length;for(let N=0;N<v.length;N++){if(v[N][0]===v[D][0]&&v[N][1]===v[D][1]||v[N][0]===v[P][0]&&v[N][1]===v[P][1])continue;const U=[v[N][0]-v[P][0],v[N][1]-v[P][1]],Z=[v[D][0]-v[P][0],v[D][1]-v[P][1]],K=U[0]*Z[1]-U[1]*Z[0];(K>0||K===0&&U[0]*Z[0]+U[1]*Z[1]>=0&&U[0]*U[0]+U[1]*U[1]>Z[0]*Z[0]+Z[1]*Z[1])&&(D=N)}P=D}while(P!==A);return S.length>0&&S.push(S[0]),S})(d);if(Tr(r,_))return m}const Hg=64,J_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function j0(r,e,i,l,d,m,_,v,S,A=!1){const D=i.zoom,P=i.project(l),k=nt(l.lat,D),N=1/k;Xe(r),ht(r,r,[P.x+_[0]*N,P.y+_[1]*N,_[2]]);let U=1,Z=1;const K=i.worldSize;if(A){if(i.projection.name==="mercator"){let le=0;i.elevation&&(le=i.elevation.getAtPointOrZero(new qt(P.x/K,P.y/K),0));const _e=vs([],[P.x,P.y,le,1],i.projMatrix)[3]/i.cameraToCenterDistance;U=_e,Z=_e*nt(i.center.lat,D)}else if(i.projection.name==="globe"){const le=V0(r,i),_e=[0,0,0,1];vs(_e,_e,ft([],i.projMatrix,le));const me=_e[3]/i.cameraToCenterDistance,Ee=Fh(D),Se=i.projection.pixelsPerMeter(l.lat,K)*nt(l.lat,D),we=i.projection.pixelsPerMeter(i.center.lat,K)*nt(i.center.lat,D);U=me/Cn(Se,mt(i.center.lat),Ee),Z=me*k/Se,U*=we,Z*=we}}else U=N;Ft(r,r,[U,U,Z]);const X=[...r],te=e.orientation,se=[];if(qA(se,[te[0]+(d?d[0]:0),te[1]+(d?d[1]:0),te[2]+(d?d[2]:0)],m),ft(r,X,se),v&&i.elevation){let le=0;const _e=[];if(S&&i.elevation){le=(function(Ee,Se,we,Me,Oe){const pt=Se.elevation;if(!pt)return 0;const ot=Ii.projectAabbCorners(we,Me),ut=$e(1,Oe.lat)*Se.worldSize,Tt=(function(Wt,An){const _n=[0,0,1],Qt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Nn of Qt){const ii=Wt[Nn.corners[0]],Di=Wt[Nn.corners[1]],Qn=Wt[Nn.corners[2]],Zi=[Di[0]-ii[0],Di[1]-ii[1],An*(Di[2]-ii[2])],xi=jr(Zi,Zi,[Qn[0]-ii[0],Qn[1]-ii[1],An*(Qn[2]-ii[2])]);Gn(xi,xi),Nn.dotProductWithUp=zi(xi,_n)}return Qt.sort((Nn,ii)=>Nn.dotProductWithUp-ii.dotProductWithUp),Qt[0].corners})(ot,ut),vt=ot[Tt[0]],bt=ot[Tt[1]],rt=ot[Tt[2]],At=ot[Tt[3]],_t=pt.getAtPointOrZero(new qt(vt[0]/Se.worldSize,vt[1]/Se.worldSize),0),Ct=pt.getAtPointOrZero(new qt(bt[0]/Se.worldSize,bt[1]/Se.worldSize),0),Et=pt.getAtPointOrZero(new qt(rt[0]/Se.worldSize,rt[1]/Se.worldSize),0),nn=pt.getAtPointOrZero(new qt(At[0]/Se.worldSize,At[1]/Se.worldSize),0),rn=(_t+nn)/2,Ht=(Ct+Et)/2;return rn>Ht?Ct<Et?F0(Ee,bt,At,vt,Ct,nn,_t,ut):F0(Ee,rt,vt,At,Et,_t,nn,ut):_t<nn?F0(Ee,vt,bt,rt,_t,Ct,Et,ut):F0(Ee,At,rt,bt,nn,Et,Ct,ut),Math.max(rn,Ht)})(_e,i,e.aabb,r,l);const me=ft([],qe([],_e),se);ft(r,X,me)}else le=i.elevation.getAtPointOrZero(new qt(P.x/K,P.y/K),0);le!==0&&(r[14]+=le)}}class HA{constructor(e,i,l,d,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=l!=null?new ge(l[0],l[1]):new ge(0,0),this.orientation=d??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new Ii([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){ft(e.globalMatrix,i,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const _=[];m=l.orientation,Xe(d=_),St(d,d,ai(m[1])),je(d,d,ai(m[2])),fn(d,d,ai(m[0])),ft(e.globalMatrix,e.globalMatrix,_)}var d,m;if(e.meshes)for(const _ of e.meshes){const v=Ii.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Xe([]);this.aabb=new Ii([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,l,d,m,_,v=!1){j0(this.matrix,this,e.transform,this.position,i,l,d,m,_,v)}upload(e){if(!this.uploaded){for(const i of this.nodes)pw(i,e);for(const i of this.nodes)U0(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)mw(e)}}function kx(r,e,i=!1){r.uploaded||(r.gfxTexture=new hw(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function Mz(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,Tz.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,Iz.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,Az.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?Ez:Sz).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,Rz.members,!0)),r.segments=mr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&kx(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&kx(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&kx(l.normalTexture,e),l.occlusionTexture&&kx(l.occlusionTexture,e,i),l.emissionTexture&&kx(l.emissionTexture,e)}function pw(r,e,i){if(r.meshes)for(const l of r.meshes)Mz(l,e,i);if(r.children)for(const l of r.children)pw(l,e,i)}function U0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)U0(e)}function Dz(r){r.pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()}function mw(r){if(r.meshes)for(const e of r.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&Dz(e.material));if(r.children)for(const e of r.children)mw(e)}function $g(r,e){const i=r.json.bufferViews[e.bufferView],l=O0[e.componentType];return new l(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Dx[e.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:Dx[e.type]))}function gw(r,e,i,l){const d=O0[e.componentType],m=(function(D){switch(D){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),_=r.json.bufferViews[e.bufferView],v=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:Dx[e.type],S=i.float32,A=S.length/i.capacity;for(let D=0,P=0;D<e.count*v;D+=v,P+=A)for(let k=0;k<A;k++)S[P+k]=l[D+k]*m;i._trim()}function Pz(r,e,i){const l=r.indices,d=r.attributes,m={};m.indexArray=new xs;const _=e.json.accessors[l],v=_.count/3;m.indexArray.reserve(v);const S=$g(e,_);for(let k=0;k<v;k++)m.indexArray.emplaceBack(S[3*k],S[3*k+1],S[3*k+2]);m.indexArray._trim(),m.vertexArray=new tl;const A=e.json.accessors[d.POSITION];m.vertexArray.reserve(A.count);const D=$g(e,A);for(let k=0;k<A.count;k++)m.vertexArray.emplaceBack(D[3*k],D[3*k+1],D[3*k+2]);if(m.vertexArray._trim(),m.aabb=new Ii(A.min,A.max),m.centroid=(function(k,N){const U=[0,0,0],Z=k.length;if(Z>0){for(let K=0;K<Z;K++){const X=3*k[K];U[0]+=N[X],U[1]+=N[X+1],U[2]+=N[X+2]}U[0]/=Z,U[1]/=Z,U[2]/=Z}return U})(S,D),d.COLOR_0!==void 0){const k=e.json.accessors[d.COLOR_0],N=Dx[k.type],U=$g(e,k);m.colorArray=N===3?new tl:new Zl,m.colorArray.resize(k.count),gw(e,k,m.colorArray,U)}if(d.NORMAL!==void 0){m.normalArray=new tl;const k=e.json.accessors[d.NORMAL];m.normalArray.resize(k.count);const N=$g(e,k);gw(e,k,m.normalArray,N)}if(d.TEXCOORD_0!==void 0&&i.length>0){m.texcoordArray=new Vu;const k=e.json.accessors[d.TEXCOORD_0];m.texcoordArray.resize(k.count);const N=$g(e,k);gw(e,k,m.texcoordArray,N)}if(d._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=$g(e,k))}d._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array($g(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const P=r.material;return m.material=(function(k,N){const{emissiveFactor:U=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:K=.5,normalTexture:X,occlusionTexture:te,emissiveTexture:se,doubleSided:le,name:_e}=k,{baseColorFactor:me=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Se=1,baseColorTexture:we,metallicRoughnessTexture:Me}=k.pbrMetallicRoughness||{},Oe=te?N[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Oe){const pt=te.extensions.KHR_texture_transform;Oe.offsetScale=[pt.offset[0],pt.offset[1],pt.scale[0],pt.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new Si(...me),metallicFactor:Ee,roughnessFactor:Se,baseColorTexture:we?N[we.index]:void 0,metallicRoughnessTexture:Me?N[Me.index]:void 0},doubleSided:le,emissiveFactor:new Si(...U),alphaMode:Z,alphaCutoff:K,normalTexture:X?N[X.index]:void 0,occlusionTexture:Oe,emissionTexture:se?N[se.index]:void 0,defined:k.defined===void 0}})(P!==void 0?e.json.materials[P]:{defined:!1},i),m}function $A(r,e,i){const{matrix:l,rotation:d,translation:m,scale:_,mesh:v,extras:S,children:A,name:D}=r,P={};if(P.name=D,P.localMatrix=l||(function(k,N,U,Z){var K=N[0],X=N[1],te=N[2],se=N[3],le=K+K,_e=X+X,me=te+te,Ee=K*le,Se=K*_e,we=K*me,Me=X*_e,Oe=X*me,pt=te*me,ot=se*le,ut=se*_e,Tt=se*me,vt=Z[0],bt=Z[1],rt=Z[2];return k[0]=(1-(Me+pt))*vt,k[1]=(Se+Tt)*vt,k[2]=(we-ut)*vt,k[3]=0,k[4]=(Se-Tt)*bt,k[5]=(1-(Ee+pt))*bt,k[6]=(Oe+ot)*bt,k[7]=0,k[8]=(we+ut)*rt,k[9]=(Oe-ot)*rt,k[10]=(1-(Ee+Me))*rt,k[11]=0,k[12]=U[0],k[13]=U[1],k[14]=U[2],k[15]=1,k})([],d||[0,0,0,1],m||[0,0,0],_||[1,1,1]),P.globalMatrix=Ye(P.localMatrix),v!==void 0){P.meshes=i[v];const k=P.anchor=[0,0];for(const N of P.meshes){const{min:U,max:Z}=N.aabb;k[0]+=U[0]+Z[0],k[1]+=U[1]+Z[1]}k[0]=Math.floor(k[0]/P.meshes.length/2),k[1]=Math.floor(k[1]/P.meshes.length/2)}if(S&&(S.id&&(P.id=S.id),S.lights&&(P.lights=(function(k){if(!k.length)return[];const N=(function(te){const se=atob(te),le=new Uint8Array(se.length);for(let _e=0;_e<se.length;_e++)le[_e]=se.codePointAt(_e);return le})(k),U=[],Z=N.length/24,K=new Uint16Array(N.buffer),X=new Float32Array(N.buffer);for(let te=0;te<Z;te++){const se=K[2*te*6]/30,le=K[2*te*6+1]/30,_e=K[2*te*6+10]/100,me=X[6*te+1],Ee=X[6*te+2],Se=X[6*te+3],we=X[6*te+4],Me=Se-me,Oe=we-Ee,pt=Math.hypot(Me,Oe);U.push({pos:[me+.5*Me,Ee+.5*Oe,le],normal:[Oe/pt,-Me/pt,0],width:pt,height:se,depth:_e,points:[me,Ee,Se,we]})}return U})(S.lights)),S.MAPBOX_geometry_bloom&&(P.isGeometryBloom=S.MAPBOX_geometry_bloom)),A){const k=[];for(const N of A)k.push($A(e.json.nodes[N],e,i));P.children=k}return P}function kz(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Vg(r.vertices,r.indices,8,256),[i,l]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:l}}function Lz(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],S=_[1];typeof v=="number"&&typeof S=="number"&&l.push(new Mt(v,S))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let d=0;for(let _=0;_<l.length;_++){const v=l[_],S=l[(_+1)%l.length],A=l[(_+2)%l.length];d+=(v.x-S.x)*(A.y-S.y)-(A.x-S.x)*(v.y-S.y)}d>0&&l.reverse();const m=Ql(l.flatMap(_=>[_.x,_.y]),[]);return m.length===0?null:{vertices:l,indices:m}}function zz(r,e){const i=[],l=[];let d=0;const m=[];for(const _ of r){d=i.length;const v=_.vertexArray.float32,S=_.indexArray.uint16;for(let A=0;A<_.vertexArray.length;A++)m[0]=v[3*A+0],m[1]=v[3*A+1],m[2]=v[3*A+2],cr(m,m,e),i.push(new Mt(m[0],m[1]));for(let A=0;A<3*_.indexArray.length;A++)l.push(S[A]+d)}if(l.length%3!=0)return null;for(let _=0;_<l.length;_+=3){const v=i[l[_+0]],S=i[l[_+1]],A=i[l[_+2]];(v.x-S.x)*(A.y-S.y)-(A.x-S.x)*(v.y-S.y)>0&&([l[_+1],l[_+2]]=[l[_+2],l[_+1]])}return{vertices:i,indices:l}}function _w(r){const e=(function(S,A){const D=[],P=WebGL2RenderingContext;if(S.json.textures)for(const k of S.json.textures){const N={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};k.sampler!==void 0&&Object.assign(N,S.json.samplers[k.sampler]),D.push({image:A[k.source],sampler:N,uploaded:!1})}return D})(r,r.images),i=(function(S,A){const D=[];for(const P of S.json.meshes){const k=[];for(const N of P.primitives)k.push(Pz(N,S,A));D.push(k)}return D})(r,e),{scenes:l,scene:d,nodes:m}=r.json,_=l?l[d||0].nodes:[...m.keys()],v=[];for(const S of _)v.push($A(m[S],r,i));return(function(S,A,D){const P={},k=new Set;for(let N=0;N<S.length;N++){const U=D[A[N]];if(!U.extras)continue;const Z=U.extras["mapbox:footprint:version"],K=U.extras["mapbox:footprint:id"];(Z||K)&&k.add(N),Z==="1.0.0"&&K&&(P[K]=N)}for(let N=0;N<S.length;N++){if(k.has(N))continue;const U=S[N],Z=D[A[N]];if(!Z.extras)continue;let K=null;U.id in P&&(K=zz(S[P[U.id]].meshes,U.localMatrix)),K||(K=Lz(Z)),K&&(U.footprint=kz(K))}if(k.size>0){const N=Array.from(k.values()).sort((U,Z)=>U-Z);for(let U=N.length-1;U>=0;U--)S.splice(N[U],1)}})(v,_,r.json.nodes),v}function Oz(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,l=r.aabb.min[1]-1,d=Hg/(r.aabb.max[0]-i+2),m=Hg/(r.aabb.max[1]-l+2);for(let _=0;_<e.length;_+=3){const v=e[_+2],S=(e[_+0]-i)*d|0,A=(e[_+1]-l)*m|0;v>r.heightmap[A*Hg+S]&&(r.heightmap[A*Hg+S]=v)}}function ZA(r,e,i,l,d){i.reserve(i.length+4*r.length),l.reserve(l.length+10*r.length),d.reserve(d.length+10*r.length);let m=l.length;for(const _ of r){const v=Math.min(10,Math.max(4,1.3*_.height))*e,S=[-_.normal[1],_.normal[0],0],A=Math.min(.29,.1*_.width/_.depth),D=_.width-2*_.depth*e*(A+.01),P=wn([],_.pos,S,D/2),k=wn([],_.pos,S,-D/2),N=[P[0],P[1],P[2]+_.height],U=[k[0],k[1],k[2]+_.height],Z=wn([],_.normal,S,A);Ne(Z,Z,v);const K=wn([],_.normal,S,-A);Ne(K,K,v),En(Z,P,Z),En(K,k,K),P[2]+=.1,k[2]+=.1,l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(K[0],K[1],K[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(k[0],k[1],k[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(k[0],k[1],k[2]),l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(K[0],K[1],K[2]);const X=D/v/2;d.emplaceBack(-X-A,-1,X,.8),d.emplaceBack(X+A,-1,X,.8),d.emplaceBack(-X,0,X,1.3),d.emplaceBack(X,0,X,1.3),d.emplaceBack(X+A,-.8,X,.7),d.emplaceBack(X+A,-.8,X,.7),d.emplaceBack(0,0,X,1.3),d.emplaceBack(0,0,X,1.3),d.emplaceBack(X+A,-1.2,X,.8),d.emplaceBack(X+A,-1.2,X,.8),i.emplaceBack(6+m,4+m,8+m),i.emplaceBack(7+m,9+m,5+m),i.emplaceBack(0+m,1+m,2+m),i.emplaceBack(1+m,3+m,2+m),m+=10}}function Nz(r,e){const i={};i.indexArray=new xs,i.vertexArray=new tl,i.colorArray=new Zl,ZA(r,e,i.indexArray,i.vertexArray,i.colorArray);const l={defined:!0};l.emissiveFactor=Si.black;const d={};return d.baseColorFactor=Si.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new Ii([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const WA=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),Bz=ei([{name:"a_normal_3",components:3,type:"Int16"}]),Fz=ei([{name:"a_centroid_3",components:3,type:"Int16"}]),XA=ei([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Vz=ei([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),jz=ei([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Uz=ei([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Gz=ei([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qz=ei([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),YA=ti.types,G0=32767;function Hz(r,e){const i=jt+e;for(const l of r)for(const d of l)if(d.x<-e||d.x>i||d.y<-e||d.y>i)return!1;return!0}function $z(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class yw{constructor(){this.layoutVertexArray=new tl,this.layoutAttenuationArray=new Zl,this.layoutColorArray=new nl,this.indexArray=new xs,this.indexArrayForConflation=new xs,this.segmentsBucket=new mr}}class xw{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new mr,this.entranceBloom=new yw;const i=66560;this.layoutVertexArray=new tl,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new Hl,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new Hl,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new nl,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new Ld,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new Jf,this.layoutAOArray.reserve(i),this.indexArray=new xs,this.indexArray.reserve(66560),this.indexArrayForConflation=new xs,this.segmentsBucket=new mr,this.entranceBloom=new yw,e&&(this.layoutFacadePaintArray=new nl,this.layoutFacadeDataArray=new Rh,this.layoutFacadeVerticalRangeArray=new nl)}reserve(e,i,l){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),l&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class KA{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Vu,this.footprintsIndices=new Ld,this.footprintsMin=new Mt(1/0,1/0),this.footprintsMax=new Mt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new xw(!1),this.buildingWithFacade=new xw(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new Rr(e),this.groundEffect.groundRadiusArray=new Gs,this.hasAppearances=null}updateFootprints(e,i){const l=new Vg([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:l,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:d,id:e})}updateAppearances(e,i,l,d){}prepare(){return(function(){if(z0!=null||SA!=null)return null;if(Q_!=null)return Q_;const e=fetch(es.BUILDING_GEN_URL);return Q_=(function(i){let l,d,m,_,v;function S(){l=new Uint8Array(v.buffer),d=new Int16Array(v.buffer),m=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const D=()=>{},P={a:{a:A,f:function(k){const N=l.length,U=Math.max(k>>>0,Math.ceil(1.2*N)),Z=Math.ceil((U-N)/65536);try{return v.grow(Z),S(),!0}catch{return!1}},g:A,b:D,c:D,d:D,e:D}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,P):i.then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,P))).then(k=>{const N=k.instance.exports;return(0,N.g)(),v=N.f,S(),new gz({setStyle:N.h,setAOOptions:N.i,setMetricOptions:N.j,setStructuralOptions:N.k,setFacadeOptions:N.l,setFauxFacadeOptions:N.m,setFacadeClassifierOptions:N.n,addFeature:N.o,addFacade:N.p,generateMesh:N.q,getLastError:N.r,getOuterRingLength:N.s,getMeshCount:N.t,getPositionsPtr:N.u,getPositionsLength:N.v,getNormalsPtr:N.w,getNormalsLength:N.x,getAOPtr:N.y,getAOLength:N.z,getUVPtr:N.A,getUVLength:N.B,getFauxFacadePtr:N.C,getFauxFacadeLength:N.D,getIndicesPtr:N.E,getIndicesLength:N.F,getBuildingPart:N.G,getRingCount:N.H,getRingPtr:N.I,getRingLength:N.J,malloc:N.K,free:N.L,heapU8:l,heap16:d,heap32:m,heapF32:_})})})(e).then(i=>(Q_=null,z0=i,z0)).catch(i=>{Pn("Could not load building-gen"),Q_=null,SA=i}),Q_})()}populate(e,i,l,d){const m=_z();if(!m)return;const _=Pt(l);this.tileToMeter=_,this.brightness=i.brightness,m.setStyle({normalScale:[1,-1,_],tileToMeters:_}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const v=new Map,S=new Map;let A=0;for(const{feature:X}of e){if(YA[X.type]!=="LineString"){v.set(X.id,X.properties.source_id);continue}const te=this.layers[0]._featureFilter.needGeometry;if(te&&!this.layers[0]._featureFilter.filter(new Pi(this.zoom),X,l))continue;const se=Vn(X,te);if(!te&&!this.layers[0]._featureFilter.filter(new Pi(this.zoom),se,l))continue;const le=te?se.geometry:Mn(X,l,d),_e=[];for(const we of le)for(const Me of we)_e.push(Me.x),_e.push(Me.y);const me={coordinates:_e,crossPerc:X.properties.cross_perc,distanceToRoad:X.properties.distance_to_road,entrances:X.properties.entrances,sourceId:0},Ee=X.properties.source_id;let Se=S.get(Ee);Se||(Se=[],S.set(Ee,Se)),Se.push(me),++A}this.maxHeight=0;const D=new Array,P=new Set,k=X=>{X!=null&&P.add(X)},N=(X,te)=>{X!=null&&D.push({buildingId:X,footprintIndex:te})},U=64*(e.length-A),Z=U/2;this.buildingWithFacade.reserve(U,Z,!0),this.buildingWithoutFacade.reserve(2*U,2*Z,!1),this.footprintsIndices.reserve(16*(e.length-A)),this.footprintsVertices.reserve(8*(e.length-A));for(const{feature:X,id:te,index:se,sourceLayerIndex:le}of e){if(YA[X.type]==="LineString")continue;const _e=this.layers[0]._featureFilter.needGeometry;if(_e&&!this.layers[0]._featureFilter.filter(new Pi(this.zoom),X,l))continue;let me=null;if(X.properties&&X.properties.hasOwnProperty("building_id")&&(me=Number(X.properties.building_id),P.has(me)))continue;const Ee=Vn(X,_e);if(!_e&&!this.layers[0]._featureFilter.filter(new Pi(this.zoom),Ee,l))continue;const Se=_e?Ee.geometry:Mn(X,l,d),we=Og(Se,500);let Me=!1;for(const Jn of we)if(Jn.length!==1){Me=!0;break}if(Me){k(me);continue}if(!Hz(Se,163)){k(me);continue}const Oe=this.layers[0],pt=$z(Oe.layout.get("building-roof-shape").evaluate(X,{},l)),ot=Oe.layout.get("building-base").evaluate(X,{},l),ut=Oe.layout.get("building-height").evaluate(X,{},l),Tt=Oe.layout.get("building-flood-light-ground-radius").evaluate(X,{},l),vt=Oe.paint.get("building-ambient-occlusion-intensity"),bt=Tt/this.tileToMeter;X.properties["building-part"]="roof";const rt=Oe.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),At=Oe.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="wall";const _t=Oe.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),Ct=Oe.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="window";const Et=Oe.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),nn=Oe.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="door";const rn=Oe.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),Ht=Oe.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);let Wt=Oe.layout.get("building-flood-light-wall-radius").evaluate(X,{},l);Wt=xe(Wt,0,2048);const An=Wt/2048*G0,_n=v.get(te),Qt=S.get(_n)||[],Nn=Qt.length!==0&&Oe.layout.get("building-facade").evaluate(X,{},l);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(Nn,!1,1);let ii=0,Di=0,Qn=0,Zi=0,xi=0,as=0,wi=0,Ui=0,Er=0,Nr=0,Br=0;if(Nn){let Jn=Math.round(Oe.layout.get("building-facade-floors").evaluate(X,{},l));if(ot===0){Jn=Math.max(1,Jn-(Qt.length>0?1:0));let ls=4;if(ut>100){const $s=[10,13,15];ls=$s[X.id?X.id%$s.length:0]}else ut<=10&&(ls=3);m.setFacadeOptions(ls,!0),xi=(ut<15?1.3:1.61803)*ls/_}else xi=ot/_;as=ut/_,xi=Math.min(xi,as),Qn=Oe.layout.get("building-facade-unit-width").evaluate(X,{},l)/_,Zi=(as-xi)/Jn,m.setFauxFacadeOptions(!0,!0,Qn);const da=Oe.layout.get("building-facade-window").evaluate(X,{},l);ii=da[0],Di=da[1],wi=Math.floor(65535*Math.min(1,xi/jt)),Ui=Math.floor(65535*Math.min(1,as/jt)),Er=Math.floor(255*ii)<<8|Math.floor(255*Di),Nr=Math.floor(65535*Math.min(1,Qn/jt)),Br=Math.floor(65535*Math.min(1,Zi/jt))}const os=Array(we.length),Ea={x:1/0,y:1/0},Ya={x:-1/0,y:-1/0},ks={x:0,y:0};let Hs=0;for(let Jn=0;Jn<we.length;Jn++){const da=we[Jn];if(da.length>0){const ls=[],$s=Array(da.length+1);$s[0]=0;for(let du=0;du<da.length;du++){const bl=da[du];for(let nc=0;nc<bl.length;nc++){const fa=bl[bl.length-nc-1];Ea.x=Math.min(Ea.x,fa.x),Ea.y=Math.min(Ea.y,fa.y),Ya.x=Math.max(Ya.x,fa.x),Ya.y=Math.max(Ya.y,fa.y),ks.x+=fa.x,ks.y+=fa.y,Hs++,ls.push(fa.x),ls.push(fa.y)}$s[du+1]=ls.length}os[Jn]={id:X.id?X.id:0,height:ut,minHeight:ot,sourceId:0,roofType:pt,coordinates:ls,ringIndices:$s}}}ks.x/=Hs||1,ks.y/=Hs||1;const na=m.generateMesh(os,Qt);if(typeof na=="string"){Pn(`Unable to generate building ${X.id}: ${na}`),k(me);continue}if(na.meshes.length===0||na.modifiedPolygonRings.length===0){k(me);continue}const Yn=Nn?this.buildingWithFacade:this.buildingWithoutFacade;let Fr=0;for(const Jn of na.meshes)Fr+=Jn.positions.length/3;const Xr=Yn.segmentsBucket.prepareSegment(Fr,Yn.layoutVertexArray,Yn.indexArray),tc=[];let Go=null,Sa=0,qo=-1;const Wd=Yn.layoutVertexArray.length,_o=Wd+Fr;Yn.layoutVertexArray.resize(_o),Yn.layoutCentroidArray.resize(_o),Yn.layoutNormalArray.resize(_o),Yn.layoutAOArray.resize(_o),Yn.layoutColorArray.resize(_o),Yn.layoutFloodLightDataArray.resize(_o),Nn&&(Yn.layoutFacadePaintArray.resize(_o),Yn.layoutFacadeDataArray.resize(_o),Yn.layoutFacadeVerticalRangeArray.resize(_o));const pb=Yn.indexArray.length;let hy=0,sl=Wd;for(const Jn of na.meshes){let da,ls;if(Jn.buildingPart===1)da=rt,ls=At;else if(Jn.buildingPart===0)da=_t,ls=Ct;else if(Jn.buildingPart===2)da=Et,ls=nn;else{if(Jn.buildingPart!==3)continue;da=rn,ls=Ht}if(ls=xe(ls,0,1),Jn.buildingPart===3){const Ls=new Array;for(let xo=0;xo<Jn.positions.length;xo+=12){const Em=Jn.positions[xo+0],Ia=Jn.positions[xo+1],wl=Jn.positions[xo+3],Xu=Jn.positions[xo+4],Kd=Jn.positions[xo+2],rT=Jn.positions[xo+8]-Kd,sT=1,iv=wl-Em,fy=Xu-Ia,$h=Math.hypot(iv,fy);Ls.push({pos:[Em+.5*iv,Ia+.5*fy,Kd],normal:[fy/$h,-iv/$h,0],width:$h,height:rT,depth:sT,points:[Em,Ia,wl,Xu]})}const Aa=Yn.entranceBloom.segmentsBucket.prepareSegment(10*Ls.length,Yn.entranceBloom.layoutVertexArray,Yn.entranceBloom.indexArray),Zs=Yn.entranceBloom.layoutVertexArray.length;Sa=Yn.entranceBloom.indexArray.length,ZA(Ls,.5/this.tileToMeter,Yn.entranceBloom.indexArray,Yn.entranceBloom.layoutVertexArray,Yn.entranceBloom.layoutAttenuationArray);const yo=Yn.entranceBloom.layoutVertexArray.length-Zs;qo=Yn.entranceBloom.indexArray.length-Sa;for(let xo=0;xo<yo;xo++)Yn.entranceBloom.layoutColorArray.emplaceBack(255*rn.r<<8|255*rn.g,255*rn.b<<8|51*Ht);Aa.vertexLength+=yo,Aa.primitiveLength+=qo,Go={part:Jn.buildingPart,vertexOffset:Zs,vertexLength:yo}}Yn.layoutVertexArray.float32.set(Jn.positions,3*sl);const $s=Jn.positions.length/3;for(let Ls=0;Ls<$s;++Ls){const Aa=3*Ls;hy=Math.max(hy,Jn.positions[Aa+2]);const Zs=Jn.normals[Aa+1]*G0,yo=Jn.normals[Aa+2]*G0,xo=3*(sl+Ls);Yn.layoutNormalArray.int16[xo]=Jn.normals[Aa]*G0,Yn.layoutNormalArray.int16[xo+1]=Zs,Yn.layoutNormalArray.int16[xo+2]=yo;const Em=Jn.ao[Ls];Yn.layoutAOArray.uint8[sl+Ls]=255*Em;const Ia=1+(Em-1)*vt,wl=255*da.b*Ia<<8|255*ls;Yn.layoutColorArray.uint16[2*(sl+Ls)]=255*da.r*Ia<<8|255*da.g*Ia,Yn.layoutColorArray.uint16[2*(sl+Ls)+1]=wl}const du=Math.floor(ks.x),bl=Math.floor(ks.y),nc=Math.floor(ut);for(let Ls=0;Ls<$s;++Ls){const Aa=3*(sl+Ls);Yn.layoutCentroidArray.int16[Aa]=du,Yn.layoutCentroidArray.int16[Aa+1]=bl,Yn.layoutCentroidArray.int16[Aa+2]=nc}if(Yn.layoutFloodLightDataArray.uint16.fill(Jn.buildingPart===0?An:0,sl,sl+$s),Nn){const Ls=255*Et.r<<8|255*Et.g,Aa=255*Et.b<<8|255*nn;for(let Zs=0;Zs<$s;++Zs){const yo=2*(sl+Zs);Yn.layoutFacadePaintArray.uint16[yo]=Ls,Yn.layoutFacadePaintArray.uint16[yo+1]=Aa}for(let Zs=0;Zs<$s;++Zs)if(Jn.isFauxFacade[Zs]){const yo=Math.min(65535,Math.floor(Jn.uv[2*Zs]*na.outerRingLength));Yn.layoutFacadeDataArray.emplace(sl+Zs,1|yo,Er,Nr,Br),Yn.layoutFacadeVerticalRangeArray.emplace(sl+Zs,wi,Ui)}else Yn.layoutFacadeDataArray.emplace(sl+Zs,0,0,0,0),Yn.layoutFacadeVerticalRangeArray.emplace(sl+Zs,0,0)}const fa=Xr.vertexLength,nv=Jn.indices.length/3,Yd=Yn.indexArray.length;Yn.indexArray.resize(Yd+nv);for(let Ls=0;Ls<nv;++Ls){const Aa=3*Ls,Zs=3*Yd+Aa;Yn.indexArray.uint16[Zs]=fa+Jn.indices[Aa],Yn.indexArray.uint16[Zs+1]=fa+Jn.indices[Aa+1],Yn.indexArray.uint16[Zs+2]=fa+Jn.indices[Aa+2]}Jn.buildingPart!==1&&Jn.buildingPart!==0&&Jn.buildingPart!==2&&Jn.buildingPart!==3||tc.push({part:Jn.buildingPart,vertexOffset:sl,vertexLength:Jn.positions.length/3}),sl+=$s,Xr.vertexLength+=$s,Xr.primitiveLength+=Jn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,hy);const mb=Yn.indexArray.length-pb,Xd=this.footprintsIndices.length,dp=this.footprintsVertices.length,Tm=[],hu=new Mt(1/0,1/0),Wu=new Mt(-1/0,-1/0),tv=this.groundEffect.vertexArray.length;for(const Jn of na.modifiedPolygonRings){const da=[],ls=new Mt(1/0,1/0),$s=new Mt(-1/0,-1/0);for(let du=0;du<Jn.length;du+=2){const bl=Jn.length-du-2;ls.x=Math.min(ls.x,Jn[bl]),ls.y=Math.min(ls.y,Jn[bl+1]),$s.x=Math.max($s.x,Jn[bl]),$s.y=Math.max($s.y,Jn[bl+1]);const nc=new Mt(Jn[bl],Jn[bl+1]);da.push(nc),Tm.push(nc.x,nc.y),this.footprintsVertices.emplaceBack(nc.x,nc.y)}hu.x=Math.min(hu.x,ls.x),hu.y=Math.min(hu.y,ls.y),Wu.x=Math.max(Wu.x,$s.x),Wu.y=Math.max(Wu.y,$s.y),this.groundEffect.addData(da,[ls,$s],bt)}const dy=this.groundEffect.vertexArray.length-tv;this.groundEffect.groundRadiusArray.reserveForAdditional(dy);for(let Jn=0;Jn<dy;Jn++)this.groundEffect.groundRadiusArray.emplaceBack(Tt);(Ea.x<0||Ya.x>jt||Ea.y<0||Ya.y>jt)&&this.featuresOnBorder.push({featureId:X.id,footprintIndex:this.footprints.length});{const Jn=Ql(Tm,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Jn.length),this.footprintsIndices.uint16.set(Jn,Xd),this.buildingIds.add(me??X.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,hu.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,hu.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Wu.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Wu.y);const da={footprintVertexOffset:dp,footprintVertexLength:this.footprintsVertices.length-dp,footprintIndexOffset:Xd,footprintIndexLength:this.footprintsIndices.length-Xd,min:hu,max:Wu,hiddenFlags:0,indicesOffset:pb,indicesLength:mb,bloomIndicesOffset:Sa,bloomIndicesLength:qo,groundEffectVertexOffset:tv,groundEffectVertexLength:dy,hasFauxFacade:Nn,height:hy,promoteId:te,feature:Ee,parts:tc,buildingBloom:Go},ls=this.footprints.length;X.id!==void 0&&this.featureFootprintLookup.set(X.id,ls),N(me,ls),this.footprints.push(da)}this.programConfigurations.populatePaintArrays(Yn.layoutVertexArray.length,X,se,{},i.availableImages,l,i.brightness),this.groundEffect.addPaintPropertiesData(X,se,{},i.availableImages,l,i.brightness),i.featureIndex.insert(X,Se,se,le,this.index,Wd)}D.forEach(({buildingId:X,footprintIndex:te})=>{P.has(X)&&(this.footprints[te].hiddenFlags|=4)});const K=new Set;this.buildingIds.forEach((X,te,se)=>{P.has(X)||K.add(X)}),this.buildingIds=K,this.groundEffect.prepareBorderSegments()}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v),this.groundEffect.update(e,i,m,l,d,_,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,WA.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,Bz.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,Fz.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,qz.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,jz.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,Uz.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,WA.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,Gz.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,l=!0){let d=!1;const m=l?i:0,_=0|(l?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const S=this.footprints[v],A=S.hiddenFlags&_|m;S.hiddenFlags!==A&&(S.hiddenFlags=A,d=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const d of this.footprints){const m=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let S=d.indicesOffset;S<_;S++)m.indexArrayForConflation.uint16[3*S+0]=0,m.indexArrayForConflation.uint16[3*S+1]=0,m.indexArrayForConflation.uint16[3*S+2]=0;const v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let S=d.bloomIndicesOffset;S<v;S++)m.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const l=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=e.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=e.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,XA.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,Vz.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,XA.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const l=e.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const m=i[d.promoteId],_=d.feature;_.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),D=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="door";const N=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical),Z=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const X of d.parts){let te,se=v;X.part===1?(se=v,te=S):X.part===0?(se=A,te=D):X.part===2?(se=P,te=k):X.part===3&&(se=N,te=U),te=xe(te,0,1);for(let le=0;le<X.vertexLength;le++){const _e=X.vertexOffset+le,me=1+(Z.layoutAOArray.uint8[_e]/255-1)*l;Z.layoutColorArray.emplace(_e,se.r*me*255<<8|se.g*me*255,se.b*me*255<<8|255*te),d.hasFauxFacade&&Z.layoutFacadePaintArray.emplace(_e,255*P.r<<8|255*P.g,255*P.b<<8|255*k)}}const K=d.buildingBloom;if(K)for(let X=0;X<K.vertexLength;X++)Z.entranceBloom.layoutColorArray.emplace(K.vertexOffset+X,255*N.r<<8|255*N.g,255*N.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped());if(h(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const m=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const S of this.footprints)S.min.x>_.max.x||S.max.x<_.min.x||S.min.y>_.max.y||S.max.y<_.min.y||(m.length=0,Wz(this.footprintsVertices,S.footprintVertexOffset,S.footprintVertexLength,_.footprintTileId.canonical,e.canonical,m),R(_.footprint,m,this.footprintsIndices.uint16,S.footprintIndexOffset,S.footprintIndexLength,0,-v)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,d=!0;const m=4*(e+jt)*jt+(i+jt);if(this.footprintLookup.hasOwnProperty(m)){const v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Mt(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=l||Zz(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(l=v.height,this.footprintLookup[m]=v,d=v.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:d};this.footprintLookup[m]=void 0}}function Zz(r,e,i){for(let l=0;l<i.length;l+=3){const d=i[l],m=i[l+1],_=i[l+2],v=e[2*d+0],S=e[2*d+1],A=e[2*m+0],D=e[2*m+1],P=e[2*_+0],k=e[2*_+1],N=(v-P)*(r.y-k)-(S-k)*(r.x-P),U=(A-v)*(r.y-S)-(D-S)*(r.x-v);if(N<0!=U<0&&N!==0&&U!==0)continue;const Z=(P-A)*(r.y-D)-(k-D)*(r.x-A);if(Z===0||Z<0==N+U<=0)return!0}return!1}function Wz(r,e,i,l,d,m){const _=Math.pow(2,l.z-d.z);for(let v=0;v<i;v++){let S=r.float32[2*(v+e)+0],A=r.float32[2*(v+e)+1];S=(S+d.x*jt)*_-l.x*jt,A=(A+d.y*jt)*_-l.y*jt,m.push(new Mt(S,A))}}let QA,JA;Bt(KA,"BuildingBucket",{omit:["layers"]}),Bt(xw,"BuildingGeometry"),Bt(yw,"BuildingBloomGeometry");const Xz=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Yz=ei([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Kz}=Xz,Qz=ei([{name:"a_packed",components:3,type:"Float32"}]),{members:Jz}=Qz,eO=ei([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:tO}=eO;class e2{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Gu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=It(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const d=[];let m=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,v=!0;d.push({left:m,right:_,isDash:v,zeroLength:e[0]===0});let S=e[0];for(let A=1;A<e.length;A++){v=!v;const D=e[A];m=S*l,S+=D,_=S*l,d.push({left:m,right:_,isDash:v,zeroLength:D===0})}return d}addRoundDash(e,i,l){const d=i/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let v=0,S=e[v];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++v]);const D=Math.abs(A-S.left),P=Math.abs(A-S.right),k=Math.min(D,P);let N;const U=m/l*(d+1);if(S.isDash){const Z=d-Math.abs(U);N=Math.sqrt(k*k+Z*Z)}else N=d-Math.sqrt(k*k+U*U);this.image.data[_+A]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const A=e[S],D=e[S+1];A.zeroLength?e.splice(S,1):D&&D.isDash===A.isDash&&(D.left=A.left,e.splice(S,1))}const l=e[0],d=e[e.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,v=e[_];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++_]);const A=Math.abs(S-v.left),D=Math.abs(S-v.right),P=Math.min(A,D);this.image.data[m+S]=Math.max(0,Math.min(255,(v.isDash?P:-P)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const d=i==="round",m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Pn("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let D=0;D<e.length;D++)e[D]<0&&(Pn("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),v+=e[D];if(v!==0){const D=this.width/v,P=this.getDashRanges(e,this.width,D);d?this.addRoundDash(P,D,m):this.addRegularDash(P,i==="square"?.5*D:0)}const S=this.nextRow+m;this.nextRow+=_;const A={tl:[S,m],br:[v,0]};return this.positions[l]=A,A}}Bt(e2,"LineAtlas");const nO=ti.types,iO=Math.cos(Math.PI/180*37.5),rO=Math.cos(Math.PI/180*5);class vw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new la,this.layoutVertexArray2=new tl,this.patternVertexArray=new tl,this.indexArray=new xs,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new mr,this.maxLineLength=0,this.zOffsetVertexArray=new tl,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.hasPattern=gx("line",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Pt(l);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),N=k.isConstant()&&!k.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&_==="none"&&Pn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const S=[];for(const{feature:k,id:N,index:U,sourceLayerIndex:Z}of e){const K=this.layers[0]._featureFilter.needGeometry,X=Vn(k,K);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),X,l))continue;const te=m?m.evaluate(X,{},l):void 0,se={id:N,properties:k.properties,type:k.type,sourceLayerIndex:Z,index:U,geometry:K?X.geometry:Mn(k,l,d),patterns:{},sortKey:te};S.push(se)}m&&S.sort((k,N)=>k.sortKey-N.sortKey);const{lineAtlas:A,featureIndex:D}=i,P=this.addConstantDashes(A);for(const k of S){const{geometry:N,index:U,sourceLayerIndex:Z}=k;if(P&&this.addFeatureDashes(k,A),this.hasPattern){const K=_x("line",this.layers,k,this.zoom,this.pixelRatio,i);this.patternFeatures.push(K)}else this.addFeature(k,N,U,l,A.positions,i.availableImages,i.brightness,i.elevationFeatures);D.insert(e[U].feature,N,U,Z,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")i=!0;else{const _=m.value,v=d.value;if(!v)continue;e.addDash(v,_)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(m.kind==="constant"&&_.kind==="constant")continue;let v,S;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:l},e);S=_.kind==="constant"?_.value:_.evaluate({zoom:l},e),i.addDash(v,S),e.patterns[d.id]=[i.getKey(v,S)]}}update(e,i,l,d,m,_,v,S){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}addFeatures(e,i,l,d,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,d,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Jz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,tO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Yz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let l,d;if(i&&i>0?(l=`mapbox_clip_start_${i}`,d=`mapbox_clip_end_${i}`):(l="mapbox_clip_start",d="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(d))return{start:+e.properties[l],end:+e.properties[d]}}addFeature(e,i,l,d,m,_,v,S){const A=this.layers[0].layout,D=A.get("line-join").evaluate(e,{}),P=A.get("line-cap").evaluate(e,{}),k=A.get("line-miter-limit"),N=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const U=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if(Z.kind!=="constant"&&Z.isLineProgressConstant===!1&&(this.variableWidthValue=Z),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,d,S,D,P,k,N)){const[X,te]=this.clipRuntimeLinesToTile(i,1);for(let se=0;se<X.length;se++){const le=X[se],_e=te[se],me={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,le),prevDir:this.computeSegPrevDir(_e,le)};this.addLine(le,e,d,D,P,k,N,me,U&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(K)}}else for(let K=0;K<i.length;K++)this.addLine(i[K],e,d,D,P,k,N,void 0,U&&K>0?K:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,d,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return k0(e,-i,-i,jt+i,jt+i)}clipRuntimeLinesToTile(e,i){const l=[];return[k0(e,-i,-i,jt+i,jt+i,l),l]}addElevatedRoadFeature(e,i,l,d,m,_,v,S){const A=[],D=ca.getElevationFeature(e,d);if(D){const P=this.clipLinesToTile(i,1),k=this.prepareElevatedLines(P,D,l);for(const N of k)A.push({geometry:N,elevation:D,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const P of A){const k=this.layoutVertexArray.length;this.addLine(P.geometry,e,l,m,_,v,S);const N=new jo(l,P.elevationTileID);if(P.elevation)for(let U=k;U<this.layoutVertexArray.length;U++){const Z=new Mt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),K=N.pointElevation(Z,P.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,i,l){if(i.constantHeight!=null)return e;const d=[],m=1/Pt(l);for(const _ of e)dz(_,new fo(i,m),0,d);return d}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,l,d,m,_,v,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const D=d==="none";this.patternJoinNone=this.hasPattern&&D,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=S&&S.progress.min>0,k=S&&S.progress.max<1;if(this.lineClips){let we={min:this.lineClips.start,max:this.lineClips.end},Me=1;if(S){const ot=this.lineClips.end-this.lineClips.start;we=(function(ut,Tt,vt){return{min:Jr(ut.min,Tt,vt),max:Jr(ut.max,Tt,vt)}})(S.progress,{min:0,max:1},we),ot>0&&(Me=(we.max-we.min)/ot)}const Oe=+i.properties.mapbox_clip_feature_len,pt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Oe)||Number.isNaN(pt)){for(let ut=0;ut<e.length-1;ut++)this.totalDistance+=e[ut].dist(e[ut+1]);const ot=this.totalDistance/(we.max-we.min);this.totalFeatureLength=Number.isFinite(ot)?ot:0,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Oe,this.distance=pt*Me,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const N=nO[i.type]==="Polygon";let U=e.length;for(;U>=2&&e[U-1].equals(e[U-2]);)U--;let Z=0;for(;Z<U-1&&e[Z].equals(e[Z+1]);)Z++;if(U<(N?3:2))return;d==="bevel"&&(_=1.05);const K=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let X,te,se,le,_e,me,Ee,Se;S&&S.prevDir&&(me=S.prevDir.perp()),S&&S.nextDir&&(Ee=S.nextDir.perp()),this.e1=this.e2=-1,N&&(X=e[U-2],_e=e[Z].sub(X)._unit()._perp());for(let we=Z;we<U;we++){if(se=we===U-1?N?e[Z+1]:void 0:e[we+1],se&&e[we].equals(se))continue;_e&&(le=_e),X&&(te=X),X=e[we],Se=this.evaluateLineProgressFeatures(te?te.dist(X):0),_e=se?se.sub(X)._unit()._perp():le,le=le||_e;const Me=te&&se;let Oe=Me?d:N||D?"butt":m;const pt=le.x*_e.x+le.y*_e.y;if(D){const _t=function(Ct){if(Ct.patternJoinNone){const Et=Ct.segmentPoints.length/2,nn=Ct.lineSoFar-Ct.segmentStart;for(let rn=0;rn<Et;++rn){const Ht=Ct.segmentPoints[2*rn+1],Wt=Math.round(Ct.segmentPoints[2*rn])+.5+.25*Ht;Ct.patternVertexArray.emplaceBack(Wt,nn,Ct.segmentStart),Ct.patternVertexArray.emplaceBack(Wt,nn,Ct.segmentStart)}Ct.segmentPoints.length=0}Ct.e1=Ct.e2=-1};if(Me&&pt<rO){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,K,Se),_t(this),this.addCurrentVertex(X,_e,-1,-1,K,Se);continue}if(te){if(!se){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,K,Se),_t(this);continue}Oe="miter"}}let ot=le.add(_e);ot.x===0&&ot.y===0||ot._unit();const ut=ot.x*_e.x+ot.y*_e.y,Tt=ut!==0?1/ut:1/0,vt=2*Math.sqrt(2-2*ut),bt=ut<iO&&te&&se,rt=le.x*_e.y-le.y*_e.x>0,At=this.overscaling<=16?122880/(512*this.overscaling):0;if(Me&&Oe==="round"){if(Tt<v)Oe="miter";else if(Tt<=2){const _t=bw(X,-10,8202);Oe=this.elevationType==="offset"&&(_t||this.hasCrossSlope)?"miter":"fakeround"}}if(Oe==="miter"&&Tt>_&&(Oe="bevel"),Oe==="bevel"&&(Tt>2&&(Oe="flipbevel"),Tt<_&&(Oe="miter")),te&&!(Oe==="miter"&&bt)&&this.updateDistance(te,X),Oe==="miter")if(bt){const _t=X.dist(te);if(_t>2*At){const Et=X.sub(X.sub(te)._mult(At/_t)._round());this.updateDistance(te,Et),this.addCurrentVertex(Et,le,0,0,K,Se),te=Et}this.updateDistance(te,X),ot._mult(Tt),this.addCurrentVertex(X,ot,0,0,K,Se);const Ct=X.dist(se);if(Ct>2*At){const Et=X.add(se.sub(X)._mult(At/Ct)._round());this.updateDistance(X,Et),this.addCurrentVertex(Et,_e,0,0,K,Se),X=Et}}else ot._mult(Tt),this.addCurrentVertex(X,ot,0,0,K,Se);else if(Oe==="flipbevel"){if(Tt>100)ot=_e.mult(-1);else{const _t=Tt*le.add(_e).mag()/le.sub(_e).mag();ot._perp()._mult(_t*(rt?-1:1))}this.addCurrentVertex(X,ot,0,0,K,Se),this.addCurrentVertex(X,ot.mult(-1),0,0,K,Se)}else if(Oe==="bevel"||Oe==="fakeround"){Se!=null&&te&&this.addCurrentVertex(X,Ee||le,-1,-1,K,Se);const _t=X.dist(te)<=2*At&&Oe!=="bevel",Ct=ot.mult(rt?1:-1);Ct._mult(Tt);const Et=_e.mult(rt?-1:1),nn=le.mult(rt?-1:1),rn=this.evaluateLineProgressFeatures(this.distance);if(Se==null&&(this.addHalfVertex(X,Ct.x,Ct.y,!1,!rt,0,K,rn),_t||this.addHalfVertex(X,Ct.x+2*nn.x,Ct.y+2*nn.y,!1,rt,0,K,rn)),Oe==="fakeround"){const Ht=Math.round(180*vt/Math.PI/20);this.addHalfVertex(X,nn.x,nn.y,!1,rt,0,K,rn);for(let Wt=0;Wt<Ht;Wt++){let An=Wt/Ht;if(An!==.5){const Qt=An-.5;An+=An*Qt*(An-1)*((1.0904+pt*(pt*(3.55645-1.43519*pt)-3.2452))*Qt*Qt+(.848013+pt*(.215638*pt-1.06021)))}const _n=Et.sub(nn)._mult(An)._add(nn)._unit();this.addHalfVertex(X,_n.x,_n.y,!1,rt,0,K,rn)}this.addHalfVertex(X,Et.x,Et.y,!1,rt,0,K,rn)}_t||Se!=null||this.addHalfVertex(X,Ct.x+2*Et.x,Ct.y+2*Et.y,!1,rt,0,K,rn),Se!=null&&se&&this.addCurrentVertex(X,me||_e,1,1,K,Se)}else if(Oe==="butt")this.addCurrentVertex(X,ot,0,0,K,Se);else if(Oe==="square"){if(!te){const _t=P?0:-1;this.addCurrentVertex(X,ot,_t,_t,K,Se)}if(this.addCurrentVertex(X,ot,0,0,K,Se),te){const _t=k?0:1;this.addCurrentVertex(X,ot,_t,_t,K,Se)}}else if(Oe==="round"){if(te){const _t=!Me&&Ee?Ee:le;this.addCurrentVertex(X,_t,0,0,K,Se),!Me&&k||this.addCurrentVertex(X,_t,1,1,K,Se,!0)}if(se){const _t=!Me&&me?me:_e;!Me&&P||this.addCurrentVertex(X,_t,-1,-1,K,Se,!0),this.addCurrentVertex(X,_t,0,0,K,Se)}}}}addVerticesTo(e,i,l,d,m,_,v,S,A,D){const P=(i.w-e.w)/this.tessellationStep|0;let k=0;const N=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const Z=(i.x-e.x)/P,K=(i.y-e.y)/P,X=(i.z-e.z)/P,te=(i.w-e.w)/P;for(let se=1;se<P;++se){e.x+=Z,e.y+=K,e.z+=X,this.lineSoFar+=te,k+=te;const le=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,l,d,D,!1,v,A,le),this.addHalfVertex(e,m,_,D,!0,-S,A,le)}}this.lineSoFar=i.w,this.scaledDistance=N;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,l,d,D,!1,v,A,U),this.addHalfVertex(i,m,_,D,!0,-S,A,U)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Pn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,l,d,m,_,v=!1){const S=i.x+i.y*l,A=i.y-i.x*l,D=i.y*d-i.x,P=-i.y-i.x*d;if(_!=null){const k=this.elevationType==="offset",N=-10,U=8202,Z=_.zOffset,K=new gA(e.x,e.y,Z,this.lineSoFar),X=!!k&&bw(e,N,U),te=this.lineSoFar,se=this.distance;if(this.currentVertex)if(X){const le=this.currentVertexIsOutside,_e=this.currentVertex,me=new gA(e.x,e.y,Z,this.lineSoFar);if(yA(_e,me,N,U),!bw(me,N,U)){if(le){this.e1=this.e2=-1,this.distance-=_e.dist(K),this.lineSoFar=_e.w;const Ee=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,S,A,v,!1,l,m,Ee),this.addHalfVertex(_e,D,P,v,!0,-d,m,Ee),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,me,S,A,D,P,l,d,m,v),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){yA(le,K,N,U),this.e1=this.e2=-1,this.distance-=le.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const _e=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,S,A,v,!1,l,m,_e),this.addHalfVertex(le,D,P,v,!0,-d,m,_e),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,K,S,A,D,P,l,d,m,v)}else X||(this.addHalfVertex(e,S,A,v,!1,l,m,_),this.addHalfVertex(e,D,P,v,!0,-d,m,_));this.currentVertex=K,this.currentVertexIsOutside=X,this.lineSoFar=te}else this.addHalfVertex(e,S,A,v,!1,l,m,_),this.addHalfVertex(e,D,P,v,!0,-d,m,_)}addHalfVertex({x:e,y:i},l,d,m,_,v,S,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Cn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),_?this.e2=D:this.e1=D,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function bw(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let t2,n2;function i2(r,e,i){return e*(jt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Bt(vw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const r2=(r,e,i)=>(1-i)*r+i*e;function s2(r,e){return 1/i2(r,1,e.tileZoom)}function a2(r,e,i,l){return r.translatePosMatrix(l||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const o2=r=>{const e=[];l2(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=r.layout.get("line-join").constantOr("miter")==="none",d=!!r.paint.get("line-pattern").constantOr(1);return l&&d&&e.push("LINE_JOIN_NONE"),e};function l2(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let ww;const c2=()=>ww||(ww={layout:t2||(t2=new wr({"line-cap":new Xt(Ze.layout_line["line-cap"]),"line-join":new Xt(Ze.layout_line["line-join"]),"line-miter-limit":new Ot(Ze.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Ze.layout_line["line-round-limit"]),"line-sort-key":new Xt(Ze.layout_line["line-sort-key"]),"line-z-offset":new Xt(Ze.layout_line["line-z-offset"]),"line-elevation-reference":new Ot(Ze.layout_line["line-elevation-reference"]),"line-cross-slope":new Ot(Ze.layout_line["line-cross-slope"]),visibility:new Ot(Ze.layout_line.visibility),"line-width-unit":new Ot(Ze.layout_line["line-width-unit"])})),paint:n2||(n2=new wr({"line-opacity":new Xt(Ze.paint_line["line-opacity"]),"line-color":new Xt(Ze.paint_line["line-color"]),"line-translate":new Ot(Ze.paint_line["line-translate"]),"line-translate-anchor":new Ot(Ze.paint_line["line-translate-anchor"]),"line-width":new Xt(Ze.paint_line["line-width"]),"line-gap-width":new Xt(Ze.paint_line["line-gap-width"]),"line-offset":new Xt(Ze.paint_line["line-offset"]),"line-blur":new Xt(Ze.paint_line["line-blur"]),"line-dasharray":new Xt(Ze.paint_line["line-dasharray"]),"line-pattern":new Xt(Ze.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ot(Ze.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ih(Ze.paint_line["line-gradient"]),"line-trim-offset":new Ot(Ze.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ot(Ze.paint_line["line-trim-fade-range"]),"line-trim-color":new Ot(Ze.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(Ze.paint_line["line-emissive-strength"]),"line-border-width":new Xt(Ze.paint_line["line-border-width"]),"line-border-color":new Xt(Ze.paint_line["line-border-color"]),"line-occlusion-opacity":new Ot(Ze.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},ww);class sO extends Xt{possiblyEvaluate(e,i){return i=new Pi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,l,d){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,l,d)}}let Lx;function u2(r,e){return e>0?e+2*r:r}const aO=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oO=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),lO=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cO=ei([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),uO=ei([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),hO=ei([{name:"a_texb",components:2,type:"Uint16"}]),dO=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),fO=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h2=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pO=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ha=24;function mO(r,e,i){return r.sections.forEach(l=>{l.text=(function(d,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),No.applyArabicShaping&&(d=No.applyArabicShaping(d)),d})(l.text,e,i)}),r}const zx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function gO(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function _O(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const Tw=4294967296,d2=1/Tw,f2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let q0=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const l=this.readVarint(),d=l>>3,m=this.pos;this.type=7&l,r(d,e,this),this.pos===m&&this.skip(l)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Tw;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Tw;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,l;return l=e[this.pos++],i=127&l,l<128?i:(l=e[this.pos++],i|=(127&l)<<7,l<128?i:(l=e[this.pos++],i|=(127&l)<<14,l<128?i:(l=e[this.pos++],i|=(127&l)<<21,l<128?i:(l=e[this.pos],i|=(15&l)<<28,(function(d,m,_){const v=_.buf;let S,A;if(A=v[_.pos++],S=(112&A)>>4,A<128||(A=v[_.pos++],S|=(127&A)<<3,A<128)||(A=v[_.pos++],S|=(127&A)<<10,A<128)||(A=v[_.pos++],S|=(127&A)<<17,A<128)||(A=v[_.pos++],S|=(127&A)<<24,A<128)||(A=v[_.pos++],S|=(1&A)<<31,A<128))return ey(d,S,m);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&f2?f2.decode(this.buf.subarray(e,r)):(function(i,l,d){let m="",_=l;for(;_<d;){const v=i[_];let S,A,D,P=null,k=v>239?4:v>223?3:v>191?2:1;if(_+k>d)break;k===1?v<128&&(P=v):k===2?(S=i[_+1],(192&S)==128&&(P=(31&v)<<6|63&S,P<=127&&(P=null))):k===3?(S=i[_+1],A=i[_+2],(192&S)==128&&(192&A)==128&&(P=(15&v)<<12|(63&S)<<6|63&A,(P<=2047||P>=55296&&P<=57343)&&(P=null))):k===4&&(S=i[_+1],A=i[_+2],D=i[_+3],(192&S)==128&&(192&A)==128&&(192&D)==128&&(P=(15&v)<<18|(63&S)<<12|(63&A)<<6|63&D,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,k=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),_+=k}return m})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*d2),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*d2),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let l,d;if(e>=0?(l=e%4294967296|0,d=e/4294967296|0):(l=~(-e%4294967296),d=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(m,_,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(l,0,i),(function(m,_){const v=(7&m)<<4;_.buf[_.pos++]|=v|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))})(d,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(l,d,m){for(let _,v,S=0;S<d.length;S++){if(_=d.charCodeAt(S),_>55295&&_<57344){if(!v){_>56319||S+1===d.length?(l[m++]=239,l[m++]=191,l[m++]=189):v=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[m++]=239,l[m++]=191,l[m++]=189,v=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&p2(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const l=this.pos-i;l>=128&&p2(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,yO,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,xO,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,wO,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,vO,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,bO,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,TO,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,EO,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,SO,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,AO,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function ey(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function p2(r,e,i){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(let d=i.pos-1;d>=r;d--)i.buf[d+l]=i.buf[d]}function yO(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function xO(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function vO(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function bO(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function wO(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function TO(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function EO(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function SO(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function AO(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}function IO(r,e,i){e.glyphs=[],r===1&&i.readMessage(CO,e)}function CO(r,e,i){if(r===3){const{id:l,bitmap:d,width:m,height:_,left:v,top:S,advance:A}=i.readMessage(RO,{});e.glyphs.push({id:l,bitmap:new Gu({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:v,top:S,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function RO(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const ec={horizontal:1,vertical:2,horizontalOnly:3};class Ox{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const l=new Ox;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new Ox;return i.image=e,i}}class ty{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,l){const d=new ty;for(let m=0;m<e.sections.length;m++){const _=e.sections[m];_.image?d.addImageSection(_,l):d.addTextSection(_,i)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,l){let d="";for(let m=0;m<i.length;m++){const _=i.charCodeAt(m+1)||null,v=i.charCodeAt(m-1)||null;d+=!l&&(_&&rg(_)&&!zx[i[m+1]]||v&&rg(v)&&!zx[i[m-1]])||!zx[i[m]]?i[m]:zx[i[m]]}return d})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&H0[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&H0[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new ty;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ox.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(l)}addImageSection(e,i){const l=e.image?e.image.getPrimary():null;if(!l)return void Pn("Can't add FormattedSection with an empty image.");l.scaleSelf(i);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Ox.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ew(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z=1){const K=ty.fromFeature(r,d,Z);P===ec.vertical&&K.verticalizePunctuation(k);let X=[];const te=(function(Ee,Se,we,Me,Oe,pt){if(!Ee)return[];const ot=[],ut=(function(bt,rt,At,_t,Ct,Et){let nn=0;for(let rn=0;rn<bt.length();rn++){const Ht=bt.getSection(rn);nn+=m2(bt.getCodePoint(rn),Ht,_t,Ct,rt,Et)}return nn/Math.max(1,Math.ceil(nn/At))})(Ee,Se,we,Me,Oe,pt),Tt=Ee.text.indexOf("")>=0;let vt=0;for(let bt=0;bt<Ee.length();bt++){const rt=Ee.getSection(bt),At=Ee.getCodePoint(bt);if(H0[At]||(vt+=m2(At,rt,Me,Oe,Se,pt)),bt<Ee.length()-1){const _t=ng(At);(MO[At]||_t||rt.image)&&ot.push(_2(bt+1,vt,ut,ot,DO(At,Ee.getCodePoint(bt+1),_t&&Tt),!1))}}return y2(_2(Ee.length(),vt,ut,ot,0,!0))})(K,A,m,e,l,N),{processBidirectionalText:se,processStyledBidirectionalText:le}=No;if(se&&K.sections.length===1){const Ee=se(K.toString(),te);for(const Se of Ee){const we=new ty;we.text=Se,we.sections=K.sections;for(let Me=0;Me<Se.length;Me++)we.sectionIndex.push(0);X.push(we)}}else if(le){const Ee=le(K.text,K.sectionIndex,te);for(const Se of Ee){const we=new ty;we.text=Se[0],we.sectionIndex=Se[1],we.sections=K.sections,X.push(we)}}else X=(function(Ee,Se){const we=[],Me=Ee.text;let Oe=0;for(const pt of Se)we.push(Ee.substring(Oe,pt)),Oe=pt;return Oe<Me.length&&we.push(Ee.substring(Oe,Me.length)),we})(K,te);const _e=[],me={positionedLines:_e,text:K.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ee,Se,we,Me,Oe,pt,ot,ut,Tt,vt,bt,rt){let At=0,_t=0,Ct=0;const Et=ut==="right"?1:ut==="left"?0:.5;let nn=!1;for(const _n of Oe){const Qt=_n.getSections();for(const Nn of Qt){if(Nn.image)continue;const ii=Se[Nn.fontStack];if(ii&&(nn=ii.ascender!==void 0&&ii.descender!==void 0,!nn))break}if(!nn)break}let rn=0;for(const _n of Oe){_n.trim();const Qt=_n.getMaxScale(),Nn=(Qt-1)*ha,ii={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[rn]=ii;const Di=ii.positionedGlyphs;let Qn=0;if(!_n.length()){_t+=pt,++rn;continue}let Zi=0,xi=0;for(let wi=0;wi<_n.length();wi++){const Ui=_n.getSection(wi),Er=_n.getSectionIndex(wi),Nr=_n.getCodePoint(wi);let Br=Ui.scale,os=null,Ea=null,Ya=null,ks=ha,Hs=0,na=Tt;na===ec.vertical&&ig(Nr)&&(na=ec.horizontal);const Yn=!(na===ec.horizontal||!bt&&!bc(Nr)||bt&&(H0[Nr]||jf(Nr)));if(Ui.image){const Fr=Me.get(Ui.image.toString());if(!Fr)continue;Ya=Ui.image,Ee.iconsInText=Ee.iconsInText||!0,Ea=Fr.paddedRect;const Xr=Fr.displaySize;Br=Br*ha/rt,os={width:Xr[0],height:Xr[1],left:0,top:-3,advance:Yn?Xr[1]:Xr[0],localGlyph:!1},Hs=nn?-os.height*Br:Qt*ha-17-Xr[1]*Br,ks=os.advance;const tc=(Yn?Xr[0]:Xr[1])*Br-ha*Qt;tc>0&&tc>Qn&&(Qn=tc)}else{const Fr=we[Ui.fontStack];if(!Fr)continue;Fr[Nr]&&(Ea=Fr[Nr]);const Xr=Se[Ui.fontStack];if(!Xr)continue;const tc=Xr.glyphs[Nr];if(!tc)continue;if(os=tc.metrics,ks=Nr!==8203?ha:0,nn){const Go=Xr.ascender!==void 0?Math.abs(Xr.ascender):0,Sa=Xr.descender!==void 0?Math.abs(Xr.descender):0,qo=(Go+Sa)*Br;Zi<qo&&(Zi=qo,xi=(Go-Sa)/2*Br),Hs=-Go*Br}else Hs=(Qt-Br)*ha-17}Yn?(Ee.verticalizable=!0,Di.push({glyph:Nr,image:Ya,x:At,y:_t+Hs,vertical:Yn,scale:Br,localGlyph:os.localGlyph,fontStack:Ui.fontStack,sectionIndex:Er,metrics:os,rect:Ea}),At+=ks*Br+vt):(Di.push({glyph:Nr,image:Ya,x:At,y:_t+Hs,vertical:Yn,scale:Br,localGlyph:os.localGlyph,fontStack:Ui.fontStack,sectionIndex:Er,metrics:os,rect:Ea}),At+=os.advance*Br+vt)}Di.length!==0&&(Ct=Math.max(At-vt,Ct),nn?x2(Di,Et,Qn,xi,pt*Qt/2):x2(Di,Et,Qn,0,pt/2)),At=0;const as=pt*Qt+Qn;ii.lineOffset=Math.max(Qn,Nn),_t+=as,++rn}const Ht=_t,{horizontalAlign:Wt,verticalAlign:An}=Sw(ot);(function(_n,Qt,Nn,ii,Di,Qn){const Zi=(Qt-Nn)*Di,xi=-Qn*ii;for(const as of _n)for(const wi of as.positionedGlyphs)wi.x+=Zi,wi.y+=xi})(Ee.positionedLines,Et,Wt,An,Ct,Ht),Ee.top+=-An*Ht,Ee.bottom=Ee.top+Ht,Ee.left+=-Wt*Ct,Ee.right=Ee.left+Ct,Ee.hasBaseline=nn})(me,e,i,l,X,_,v,S,P,A,k,U),!(function(Ee){for(const Se of Ee)if(Se.positionedGlyphs.length!==0)return!1;return!0})(_e))return me}const H0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function m2(r,e,i,l,d,m){if(e.image){const _=l.get(e.image.toString());return _?_.displaySize[0]*e.scale*ha/m+d:0}{const _=i[e.fontStack],v=_&&_.glyphs[r];return v?v.metrics.advance*e.scale+d:0}}function g2(r,e,i,l){const d=Math.pow(r-e,2);return l?r<e?d/2:2*d:d+Math.abs(i)*i}function DO(r,e,i){let l=0;return r===10&&(l-=1e4),i&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function _2(r,e,i,l,d,m){let _=null,v=g2(e,i,d,m);for(const S of l){const A=g2(e-S.x,i,d,m)+S.badness;A<=v&&(_=S,v=A)}return{index:r,x:e,priorBreak:_,badness:v}}function y2(r){return r?y2(r.priorBreak).concat(r.index):[]}function Sw(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function x2(r,e,i,l,d){if(!(e||i||l||d))return;const m=r.length-1,_=r[m],v=(_.x+_.metrics.advance*_.scale)*e;for(let S=0;S<=m;S++)r[S].x-=v,r[S].y+=i+l+d}function Aw(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function $0(r,e,i,l){const{horizontalAlign:d,verticalAlign:m}=Sw(l),_=i[0]-r.displaySize[0]*d,v=i[1]-r.displaySize[1]*m;return{imagePrimary:r,imageSecondary:e,top:v,bottom:v+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function Iw(r,e,i,l,d,m){const _=r.imagePrimary;let v;if(_.content){const K=_.content,X=_.pixelRatio||1;v=[K[0]/X,K[1]/X,_.displaySize[0]-K[2]/X,_.displaySize[1]-K[3]/X]}const S=e.left*m,A=e.right*m;let D,P,k,N;i==="width"||i==="both"?(N=d[0]+S-l[3],P=d[0]+A+l[1]):(N=d[0]+(S+A-_.displaySize[0])/2,P=N+_.displaySize[0]);const U=e.top*m,Z=e.bottom*m;return i==="height"||i==="both"?(D=d[1]+U-l[0],k=d[1]+Z+l[2]):(D=d[1]+(U+Z-_.displaySize[1])/2,k=D+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:D,right:P,bottom:k,left:N,collisionPadding:v}}function v2(r){return!r.imagePrimary.stretchX}function b2(r){return!r.imagePrimary.stretchY}function w2(r){return{width:r.right-r.left,height:r.bottom-r.top}}const up=128;function Zg(r,e,i,l){const{expression:d}=e;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Pi(r+1,{worldview:i}),void 0,void 0,void 0,l)};if(d.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:_}=d;let v=0;for(;v<m.length&&m[v]<=r;)v++;v=Math.max(0,v-1);let S=v;for(;S<m.length&&m[S]<r+1;)S++;S=Math.min(m.length-1,S);const A=m[v],D=m[S];return d.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:_}:{kind:"camera",minZoom:A,maxZoom:D,minSize:d.evaluate(new Pi(A,{worldview:i}),void 0,void 0,void 0,l),maxSize:d.evaluate(new Pi(D,{worldview:i}),void 0,void 0,void 0,l),interpolationType:_}}}function Cw(r,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:d}){return r.kind==="source"?l/up:r.kind==="composite"?Cn(l/up,d/up,i):e}function ny(r,e,i=1){let l=0,d=0;if(r.kind==="constant")d=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:m,minZoom:_,maxZoom:v}=r,S=m?xe(Ar.interpolationFactor(m,e,_,v),0,1):0;r.kind==="camera"?d=Cn(r.minSize,r.maxSize,S)*i:l=S*i}return{uSizeT:l,uSize:d}}class hp extends Mt{constructor(e,i,l,d,m){super(e,i),this.angle=d,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new hp(this.x,this.y,this.z,this.angle,this.segment)}}function T2(r,e,i,l,d){if(e.segment===void 0)return!0;let m=e,_=e.segment+1,v=0;for(;v>-i/2;){if(_--,_<0)return!1;v-=r[_].dist(m),m=r[_]}v+=r[_].dist(r[_+1]),_++;const S=[];let A=0;for(;v<i/2;){const D=r[_],P=r[_+1];if(!P)return!1;let k=r[_-1].angleTo(D)-D.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:k}),A+=k;v-S[0].distance>l;)A-=S.shift().angleDelta;if(A>d)return!1;_++,v+=D.dist(P)}return!0}function E2(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function S2(r,e,i){return r?.6*e*i:0}function A2(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function PO(r,e,i,l,d,m){const _=S2(i,d,m),v=A2(i,l)*m;let S=0;const A=E2(r)/2;for(let D=0;D<r.length-1;D++){const P=r[D],k=r[D+1],N=P.dist(k);if(S+N>A){const U=(A-S)/N,Z=Cn(P.x,k.x,U),K=Cn(P.y,k.y,U),X=new hp(Z,K,0,k.angleTo(P),D);return!_||T2(r,X,v,_,e)?X:void 0}S+=N}}function kO(r,e,i,l,d,m,_,v,S){const A=S2(l,m,_),D=A2(l,d),P=D*_,k=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return e-P<e/4&&(e=P+e/4),I2(r,k?e/2*v%e:(D/2+2*m)*_*v%e,e,A,i,P,k,!1,S)}function I2(r,e,i,l,d,m,_,v,S){const A=m/2,D=E2(r);let P=0,k=e-i,N=[];for(let U=0;U<r.length-1;U++){const Z=r[U],K=r[U+1],X=Z.dist(K),te=K.angleTo(Z);for(;k+i<P+X;){k+=i;const se=(k-P)/X,le=Cn(Z.x,K.x,se),_e=Cn(Z.y,K.y,se);if(le>=0&&le<S&&_e>=0&&_e<S&&k-A>=0&&k+A<=D){const me=new hp(le,_e,0,te,U);l&&!T2(r,me,m,l,d)||N.push(me)}}P+=X}return v||N.length||_||(N=I2(r,P/2,i,l,d,m,_,!0,S)),N}function C2(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let d=0,m=0;for(const _ of r)for(let v=l.length-1;v>=0;v--){const S=l[v];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===S.w&&_.h===S.h){const A=l.pop();A&&v<l.length&&(l[v]=A)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(l.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}Bt(hp,"Anchor");class Nx{static getImagePositionScale(e,i,l){if(i&&e){const{sx:d,sy:m}=e;return{x:d,y:m}}return{x:l,y:l}}constructor(e,i,l,d){this.paddedRect=e;const{pixelRatio:m,version:_,stretchX:v,stretchY:S,content:A,sdf:D,usvg:P}=i;this.pixelRatio=m,this.stretchX=v,this.stretchY=S,this.content=A,this.version=_,this.padding=l,this.sdf=D,this.usvg=P,this.scale=Nx.getImagePositionScale(d,P,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Rw(r,e,i){const l=Ks.parse(r),d=(function(m,_,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*_,h:(m.data?m.data.height:m.height*v[1])+2*_}})(e,i,[l.sx,l.sy]);return{bin:d,imagePosition:new Nx(d,e,i,l),imageVariant:l}}class R2{constructor(e,i,l){const d=new Map,m=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,d,1,_),this.addImages(i,m,2,_);const{w:v,h:S}=C2(_),A=new ta({width:v||1,height:S||1});for(const[D,P]of e.entries()){const k=d.get(D).paddedRect;ta.copy(P.data,A,{x:0,y:0},{x:k.x+1,y:k.y+1},P.data,null,P.sdf)}for(const[D,P]of i.entries()){const k=m.get(D),N=k.paddedRect;let U=k.padding;const Z=N.x+U,K=N.y+U,X=P.data.width,te=P.data.height;U=U>1?U-1:U,ta.copy(P.data,A,{x:0,y:0},{x:Z,y:K},P.data,l),ta.copy(P.data,A,{x:0,y:te-U},{x:Z,y:K-U},{width:X,height:U},l),ta.copy(P.data,A,{x:0,y:0},{x:Z,y:K+te},{width:X,height:U},l),ta.copy(P.data,A,{x:X-U,y:0},{x:Z-U,y:K},{width:U,height:te},l),ta.copy(P.data,A,{x:0,y:0},{x:Z+X,y:K},{width:U,height:te},l),ta.copy(P.data,A,{x:X-U,y:te-U},{x:Z-U,y:K-U},{width:U,height:U},l),ta.copy(P.data,A,{x:0,y:te-U},{x:Z+X,y:K-U},{width:U,height:U},l),ta.copy(P.data,A,{x:0,y:0},{x:Z+X,y:K+te},{width:U,height:U},l),ta.copy(P.data,A,{x:X-U,y:0},{x:Z-U,y:K+te},{width:U,height:U},l)}this.lut=l,this.image=A,this.iconPositions=d,this.patternPositions=m}addImages(e,i,l,d){for(const[m,_]of e.entries()){const{bin:v,imagePosition:S,imageVariant:A}=Rw(m,_,l);i.set(m,S),d.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>e.hasImage(m,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const m of e.getUpdatedImages(l)){for(const _ of this.iconPositions.keys()){const v=Ks.parse(_);if(Vs.isEqual(v.id,m)){const S=e.getImage(m,l);this.patchUpdatedImage(this.iconPositions.get(_),S,i,null)}}for(const _ of this.patternPositions.keys()){const v=Ks.parse(_);if(Vs.isEqual(v.id,m)){const S=e.getImage(m,l);this.patchUpdatedImage(this.patternPositions.get(_),S,i,d||this.lut)}}}}patchUpdatedImage(e,i,l,d=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[m,_]=e.tl,v=e.sdf;if(this.lut||v){const S={width:i.data.width,height:i.data.height},A=new ta(S);ta.copy(i.data,A,{x:0,y:0},{x:0,y:0},S,d,v),l.update(A,{position:{x:m,y:_}})}else l.update(i.data,{position:{x:m,y:_}})}}Bt(Nx,"ImagePosition"),Bt(R2,"ImageAtlas",{omit:["lut"]});const Bx=1e20;function M2(r,e,i,l,d,m,_,v,S){for(let A=e;A<e+l;A++)D2(r,i*m+A,m,d,_,v,S);for(let A=i;A<i+d;A++)D2(r,A*m+e,1,l,_,v,S)}function D2(r,e,i,l,d,m,_){m[0]=0,_[0]=-Bx,_[1]=Bx,d[0]=r[e];for(let v=1,S=0,A=0;v<l;v++){d[v]=r[e+v*i];const D=v*v;do{const P=m[S];A=(d[v]-d[P]+D-P*P)/(v-P)/2}while(A<=_[S]&&--S>-1);S++,m[S]=v,_[S]=A,_[S+1]=Bx}for(let v=0,S=0;v<l;v++){for(;_[S+1]<v;)S++;const A=m[S],D=v-A;r[e+v*i]=d[A]+D*D}}const Mw={none:0,ideographs:1,all:2};class iy{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[],d=this.url||es.GLYPHS_URL;for(const m in e)for(const _ of e[m])l.push({stack:m,id:_});Ge(l,({stack:m,id:_},v)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=S.glyphs[_];if(A!==void 0)return void v(null,{stack:m,id:_,glyph:A});if(A=this._tinySDF(S,m,_),A)return S.glyphs[_]=A,void v(null,{stack:m,id:_,glyph:A});const D=Math.floor(_/256);if(256*D>65535)return Pn("glyphs > 65535 not supported"),void v(null,{stack:m,id:_,glyph:A});if(S.ranges[D])return void v(null,{stack:m,id:_,glyph:A});let P=S.requests[D];P||(P=S.requests[D]=[],iy.loadGlyphRange(m,D,d,this.requestManager,(k,N)=>{if(N){S.ascender=N.ascender,S.descender=N.descender;for(const U in N.glyphs)this._doesCharSupportLocalGlyph(+U)||(S.glyphs[+U]=N.glyphs[+U]);S.ranges[D]=!0}for(const U of P)U(k,N);delete S.requests[D]})),P.push((k,N)=>{k?v(k):N&&v(null,{stack:m,id:_,glyph:N.glyphs[_]||null})})},(m,_)=>{if(m)i(m);else if(_){const v={};for(const{stack:S,id:A,glyph:D}of _)v[S]===void 0&&(v[S]={}),v[S].glyphs===void 0&&(v[S].glyphs={}),v[S].glyphs[A]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;i(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Mw.none&&(this.localGlyphMode===Mw.all?!!this.localFontFamily:!!this.localFontFamily&&(ys(e)||Bf(e)||ku(e)||Sh(e)||ns(e)||Qs(e)||(i=e)>=131072&&i<=173791||(l=>l>=66736&&l<=66815)(e)));var i}_tinySDF(e,i,l){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let Z="400";/bold/i.test(i)?Z="900":/medium/i.test(i)?Z="500":/light/i.test(i)&&(Z="200"),m=e.tinySDF=new iy.TinySDF({fontFamily:d,fontWeight:Z,fontSize:48,buffer:6,radius:16}),m.fontWeight=Z}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCodePoint(l),{data:v,width:S,height:A,glyphWidth:D,glyphHeight:P,glyphLeft:k,glyphTop:N,glyphAdvance:U}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Gu({width:S,height:A},v),metrics:{width:D/2,height:P/2,left:k/2,top:N/2-27,advance:U/2,localGlyph:!0}}}}function P2(r,e){return r+e[1]-e[0]}function Dw(r,e,i,l,d=1){const m=[],_=r.imagePrimary,v=_.pixelRatio,S=_.paddedRect.w-2,A=_.paddedRect.h-2,D=(r.right-r.left)*d,P=(r.bottom-r.top)*d,k=_.stretchX||[[0,S]],N=_.stretchY||[[0,A]],U=k.reduce(P2,0),Z=N.reduce(P2,0),K=S-U,X=A-Z;let te=0,se=U,le=0,_e=Z,me=0,Ee=K,Se=0,we=X;if(_.content&&l){const Oe=_.content;te=Z0(k,0,Oe[0]),le=Z0(N,0,Oe[1]),se=Z0(k,Oe[0],Oe[2]),_e=Z0(N,Oe[1],Oe[3]),me=Oe[0]-te,Se=Oe[1]-le,Ee=Oe[2]-Oe[0]-se,we=Oe[3]-Oe[1]-_e}const Me=(Oe,pt,ot,ut)=>{const Tt=W0(Oe.stretch-te,se,D,r.left*d),vt=X0(Oe.fixed-me,Ee,Oe.stretch,U),bt=W0(pt.stretch-le,_e,P,r.top*d),rt=X0(pt.fixed-Se,we,pt.stretch,Z),At=W0(ot.stretch-te,se,D,r.left*d),_t=X0(ot.fixed-me,Ee,ot.stretch,U),Ct=W0(ut.stretch-le,_e,P,r.top*d),Et=X0(ut.fixed-Se,we,ut.stretch,Z),nn=new Mt(Tt,bt),rn=new Mt(At,bt),Ht=new Mt(At,Ct),Wt=new Mt(Tt,Ct),An=new Mt(vt/v,rt/v),_n=new Mt(_t/v,Et/v),Qt=e*Math.PI/180;if(Qt){const xi=Math.sin(Qt),as=Math.cos(Qt),wi=[as,-xi,xi,as];nn._matMult(wi),rn._matMult(wi),Wt._matMult(wi),Ht._matMult(wi)}const Nn=Oe.stretch+Oe.fixed,ii=ot.stretch+ot.fixed,Di=pt.stretch+pt.fixed,Qn=ut.stretch+ut.fixed,Zi=r.imageSecondary;return{tl:nn,tr:rn,bl:Wt,br:Ht,texPrimary:{x:_.paddedRect.x+1+Nn,y:_.paddedRect.y+1+Di,w:ii-Nn,h:Qn-Di},texSecondary:Zi?{x:Zi.paddedRect.x+1+Nn,y:Zi.paddedRect.y+1+Di,w:ii-Nn,h:Qn-Di}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:An,pixelOffsetBR:_n,minFontScaleX:Ee/v/D,minFontScaleY:we/v/P,isSDF:i}};if(_.stretchX||_.stretchY){const Oe=k2(k,K,U),pt=k2(N,X,Z);for(let ot=0;ot<Oe.length-1;ot++){const ut=Oe[ot],Tt=Oe[ot+1];for(let vt=0;vt<pt.length-1;vt++)m.push(Me(ut,pt[vt],Tt,pt[vt+1]))}}else m.push(Me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:A+1}));return m}function LO(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2]];return r.stretchX||r.stretchY?L2(r.stretchX||[[0,r.paddedRect.w-2]])*L2(i):1}function Z0(r,e,i){let l=0;for(const d of r)l+=Math.max(e,Math.min(i,d[1]))-Math.max(e,Math.min(i,d[0]));return l}function k2(r,e,i){const l=[{fixed:-1,stretch:0}];for(const[d,m]of r){const _=l[l.length-1];l.push({fixed:d-_.stretch,stretch:_.stretch}),l.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return l.push({fixed:e+1,stretch:i}),l}function L2(r){return 2*r.length+1}function W0(r,e,i,l){return r/e*i+l}function X0(r,e,i,l){return r-e*i/l}function zO(r,e,i,l){const d=e+r.positionedLines[l].lineOffset;return l===0?i+d/2:i+(d+(e+r.positionedLines[l-1].lineOffset))/2}function z2(r,e,i,l,d,m,_,v,S){const A=[];if(e.positionedLines.length===0)return A;const D=(S!==void 0?S:l.layout.get("text-rotate").evaluate(m,{}))*Math.PI/180,P=(function(K){const X=K[0],te=K[1],se=X*te;return se>0?[X,-te]:se<0?[-X,te]:X===0?[te,X]:[te,-X]})(i);let k=Math.abs(e.top-e.bottom);for(const K of e.positionedLines)k-=K.lineOffset;const N=e.positionedLines.length,U=k/N;let Z=e.top-i[1];for(let K=0;K<N;++K){const X=e.positionedLines[K];Z=zO(e,U,Z,K);for(const te of X.positionedGlyphs){if(!te.rect)continue;const se=te.rect||{};let le=4,_e=!0,me=1,Ee=0;if(te.image){const rn=_.get(te.image.toString());if(!rn)continue;if(rn.sdf){Pn("SDF images are not supported in formatted text and will be ignored.");continue}_e=!1,me=rn.pixelRatio,le=1/me}const Se=(d||v)&&te.vertical,we=te.metrics.advance*te.scale/2,Me=te.metrics,Oe=te.rect;if(Oe===null)continue;v&&e.verticalizable&&(Ee=te.image?we-te.metrics.width*te.scale/2:0);const pt=d?[te.x+we,te.y]:[0,0];let ot=[0,0],ut=[0,0],Tt=!1;d||(Se?(ut=[te.x+we+P[0],te.y+P[1]-Ee],Tt=!0):ot=[te.x+we+i[0],te.y+i[1]-Ee]);const vt=Oe.w*te.scale/(me*(te.localGlyph?2:1)),bt=Oe.h*te.scale/(me*(te.localGlyph?2:1));let rt,At,_t,Ct;if(Se){const rn=te.y-Z,Ht=new Mt(-we,we-rn),Wt=-Math.PI/2,An=new Mt(...ut);rt=new Mt(-we+ot[0],ot[1]),rt._rotateAround(Wt,Ht)._add(An),rt.x+=-rn+we,rt.y-=(Me.left-le)*te.scale;const _n=te.image?Me.advance*te.scale:ha*te.scale,Qt=String.fromCodePoint(te.glyph);gO(Qt)?rt.x+=(1-le)*te.scale:_O(Qt)?rt.x+=_n-Me.height*te.scale+(-le-1)*te.scale:rt.x+=te.image||Me.width+2*le===Oe.w&&Me.height+2*le===Oe.h?(_n-bt)/2:(_n-(Me.height+2*le)*te.scale)/2,At=new Mt(rt.x,rt.y-vt),_t=new Mt(rt.x+bt,rt.y),Ct=new Mt(rt.x+bt,rt.y-vt)}else{const rn=(Me.left-le)*te.scale-we+ot[0],Ht=(-Me.top-le)*te.scale+ot[1],Wt=rn+vt,An=Ht+bt;rt=new Mt(rn,Ht),At=new Mt(Wt,Ht),_t=new Mt(rn,An),Ct=new Mt(Wt,An)}if(D){let rn;rn=d?new Mt(0,0):Tt?new Mt(P[0],P[1]):new Mt(i[0],i[1]),rt._rotateAround(D,rn),At._rotateAround(D,rn),_t._rotateAround(D,rn),Ct._rotateAround(D,rn)}const Et=new Mt(0,0),nn=new Mt(0,0);A.push({tl:rt,tr:At,bl:_t,br:Ct,texPrimary:se,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:pt,sectionIndex:te.sectionIndex,isSDF:_e,pixelOffsetTL:Et,pixelOffsetBR:nn,minFontScaleX:0,minFontScaleY:0})}}return A}function OO(r,e=1,i=!1){let l=1/0,d=1/0,m=-1/0,_=-1/0;const v=r[0];for(let N=0;N<v.length;N++){const U=v[N];(!N||U.x<l)&&(l=U.x),(!N||U.y<d)&&(d=U.y),(!N||U.x>m)&&(m=U.x),(!N||U.y>_)&&(_=U.y)}const S=Math.min(m-l,_-d);let A=S/2;const D=new hh([],NO);if(S===0)return new Mt(l,d);for(let N=l;N<m;N+=S)for(let U=d;U<_;U+=S)D.push(new ry(N+A,U+A,A,r));let P=(function(N){let U=0,Z=0,K=0;const X=N[0];for(let te=0,se=X.length,le=se-1;te<se;le=te++){const _e=X[te],me=X[le],Ee=_e.x*me.y-me.x*_e.y;Z+=(_e.x+me.x)*Ee,K+=(_e.y+me.y)*Ee,U+=3*Ee}return new ry(Z/U,K/U,0,N)})(r),k=D.length;for(;D.length;){const N=D.pop();(N.d>P.d||!P.d)&&(P=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,k)),N.max-P.d<=e||(A=N.h/2,D.push(new ry(N.p.x-A,N.p.y-A,A,r)),D.push(new ry(N.p.x+A,N.p.y-A,A,r)),D.push(new ry(N.p.x-A,N.p.y+A,A,r)),D.push(new ry(N.p.x+A,N.p.y+A,A,r)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function NO(r,e){return e.max-r.max}iy.loadGlyphRange=function(r,e,i,l,d){const m=256*e,_=m+255,v=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${m}-${_}`),us.Glyphs);Nc(v,(S,A)=>{if(S)d(S);else if(A){const D={},P=(function(k){return new q0(k).readFields(IO,{})})(A);for(const k of P.glyphs)D[k.id]=k;d(null,{glyphs:D,ascender:P.ascender,descender:P.descender})}})},iy.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=e,this.cutoff=l,this.radius=i,this.lang=v;const S=this.size=r+4*e,A=this._createCanvas(S),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${m} ${r}px ${d}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(r),_=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),S=Math.min(this.size-this.buffer,_+Math.ceil(l)),A=v+2*this.buffer,D=S+2*this.buffer,P=Math.max(A*D,0),k=new Uint8ClampedArray(P),N={data:k,width:A,height:D,glyphWidth:v,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||S===0)return N;const{ctx:U,buffer:Z,gridInner:K,gridOuter:X}=this;this.lang&&(U.lang=this.lang),U.clearRect(Z,Z,v,S),U.fillText(r,Z,Z+_);const te=U.getImageData(Z,Z,v,S);X.fill(Bx,0,P),K.fill(0,0,P);for(let se=0;se<S;se++)for(let le=0;le<v;le++){const _e=te.data[4*(se*v+le)+3]/255;if(_e===0)continue;const me=(se+Z)*A+le+Z;if(_e===1)X[me]=0,K[me]=Bx;else{const Ee=.5-_e;X[me]=Ee>0?Ee*Ee:0,K[me]=Ee<0?Ee*Ee:0}}M2(X,0,0,A,D,A,this.f,this.v,this.z),M2(K,Z,Z,v,S,A,this.f,this.v,this.z);for(let se=0;se<P;se++){const le=Math.sqrt(X[se])-Math.sqrt(K[se]);k[se]=Math.round(255-255*(le/this.radius+this.cutoff))}return N}};class ry{constructor(e,i,l,d){this.p=new Mt(e,i),this.h=l,this.d=(function(m,_){let v=!1,S=1/0;for(let A=0;A<_.length;A++){const D=_[A];for(let P=0,k=D.length,N=k-1;P<k;N=P++){const U=D[P],Z=D[N];U.y>m.y!=Z.y>m.y&&m.x<(Z.x-U.x)*(m.y-U.y)/(Z.y-U.y)+U.x&&(v=!v),S=Math.min(S,Nh(m,U,Z))}}return(v?1:-1)*Math.sqrt(S)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const BO=Object.keys,Pw=Number.POSITIVE_INFINITY,FO=Math.sqrt(2);function vm(r,e,i,l,d){const m=Aw(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],_={top:r.top-m[1],bottom:r.bottom+m[3],left:r.left-m[0],right:r.right+m[2],scaled:!1};return l!==void 0&&(function(v,S){v.top*=S,v.bottom*=S,v.left*=S,v.right*=S,v.scaled=!0})(_,l),i&&(function(v,S){if(!S)return;const A=ai(S),D=new Mt(v.left,v.top),P=new Mt(v.right,v.top),k=new Mt(v.left,v.bottom),N=new Mt(v.right,v.bottom),U=new Mt(0,0);D._rotateAround(A,U),P._rotateAround(A,U),k._rotateAround(A,U),N._rotateAround(A,U),v.left=Math.min(D.x,P.x,k.x,N.x),v.right=Math.max(D.x,P.x,k.x,N.x),v.top=Math.min(D.y,P.y,k.y,N.y),v.bottom=Math.max(D.y,P.y,k.y,N.y)})(_,i),d&&(_.left+=d[0],_.right+=d[0],_.top+=d[1],_.bottom+=d[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function O2(r,[e,i]){let l=0,d=0;if(i===Pw){e<0&&(e=0);const m=e/FO;switch(r){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(r){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":d=i-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-i}switch(r){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,d]}function VO(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U){const Z=r.layers[0],K=Z.appearances;if(K.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const X={iconBBox:null,iconVerticalBBox:null},te={textBBox:null,textVerticalBBox:null},{baseIconRotate:se,baseTextRotate:le,iconScaleFactor:_e}=(function(Ee,Se,we){const Me=Ee.get("icon-rotate").evaluate(Se,{},we),Oe=Ee.get("text-rotate").evaluate(Se,{},we),[pt,ot]=Ee.get("icon-size-scale-range");return{baseIconRotate:Me,baseTextRotate:Oe,iconScaleFactor:xe(1,pt,ot)}})(l,d,m);e&&(X.iconBBox=vm(e,X.iconBBox,se,_),i)&&(X.iconVerticalBBox=vm(i,X.iconVerticalBBox,se+90,_));const me=K0(P.horizontal);me&&(te.textBBox=vm(me,te.textBBox,le,1,N)),P.vertical&&(te.textVerticalBBox=vm(P.vertical,te.textVerticalBBox,le+90,1,N));for(const Ee of K)Ee.hasIconProperties()&&jO(X,r,Z,Ee,d,m,v,se,_,S,e,A,_e,D,U),Ee.hasTextProperties()&&UO(te,Z,Ee,d,m,N,le,k,me,P.vertical);return{iconBBox:X.iconBBox,iconVerticalBBox:X.iconVerticalBBox,textBBox:te.textBBox,textVerticalBBox:te.textVerticalBBox}}function jO(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U){const{appearanceIconOffset:Z,appearanceIconRotate:K,appearanceIconSize:X}=N2(l,i,d,m,_,v,S,A.iconScaleFactor);let te=null,se=null,le=null;l.hasProperty("icon-image")?le=(function(_e,me,Ee,Se,we,Me,Oe,pt){let ot=null;const ut=me.getAppearanceValueAndResolveTokens(Ee,"icon-image",Se,we,pt);if(ut){const Tt=_e.getResolvedImageFromTokens(ut),vt=Ee.getUnevaluatedProperty("icon-size"),bt=Fx(Tt,Zg(_e.zoom,vt,_e.worldview,pt),vt,we,_e.zoom,Se,_e.pixelRatio,Oe,_e.worldview,pt);ot=Me.get(bt.iconPrimary.toString())}return ot})(e,i,l,d,m,P,k,U):D&&(le=D.imagePrimary),le&&(te=$0(le,null,Z,N),e.allowVerticalPlacement&&(se=$0(le,null,Z,N))),te&&(r.iconBBox=vm(te,r.iconBBox,K,X)),se&&(r.iconVerticalBBox=vm(se,r.iconVerticalBBox,K+90,X))}function N2(r,e,i,l,d,m,_,v){const S=r.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(r,"icon-offset",i,l,[]):null,A=S&&Array.isArray(S)?S:d,D=r.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(r,"icon-rotate",i,l,[]):null,P=typeof D=="number"?D:m,k=r.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(r,"icon-size",i,l,[]):null;return{appearanceIconOffset:A,appearanceIconRotate:P,appearanceIconSize:typeof k=="number"?k*v:_}}function UO(r,e,i,l,d,m,_,v,S,A){const{appearanceTextOffset:D,appearanceTextRotate:P,appearanceTextSize:k}=B2(i,e,l,d,m,_,v),N=k/v;S&&(r.textBBox=vm(S,r.textBBox,P,N,D)),A&&(r.textVerticalBBox=vm(A,r.textVerticalBBox,P+90,N,D))}function B2(r,e,i,l,d,m,_){const v=r.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(r,"text-offset",i,l,[]):null,S=v&&Array.isArray(v)?[v[0]*ha,v[1]*ha]:d,A=r.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(r,"text-rotate",i,l,[]):null,D=typeof A=="number"?A:m,P=r.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(r,"text-size",i,l,[]):null;return{appearanceTextOffset:S,appearanceTextRotate:D,appearanceTextSize:typeof P=="number"?P:_}}function Y0(r,e,i,l,d,m,_,v,S){if(!e||!e.usvg)return;const A=w2(l),D=w2(d),P=m!=="both"&&m!=="width"||!v2(l)?1:D.width/A.width,k=m!=="both"&&m!=="height"||!b2(l)?1:D.height/A.height;i.scaleSelf(P,k);const N=i.toString();_.set(N,i),v.set(N,e);const{imagePosition:U}=Rw(N,e,1);S.set(N,U)}function F2(r,e,i,l,d,m,_,v,S,A){if(!r)return;const D=(function(P,k,N,U,Z,K,X){if(P.kind==="camera")return P.maxSize;if(P.kind==="composite"){const te=k.possiblyEvaluate(new Pi(P.maxZoom,{worldview:K}),N,X).evaluate(Z,{},N,X),se=k.possiblyEvaluate(new Pi(P.minZoom,{worldview:K}),N,X).evaluate(Z,{},N,X);return Math.max(te,se)}return k.possiblyEvaluate(new Pi(U,{worldview:K}),N,X).evaluate(Z,{},N,X)})(e,i,l,d,m,S,A);return r.scaleSelf(D*v*_)}function Fx(r,e,i,l,d,m,_,v,S,A){return{iconPrimary:F2(r.getPrimary(),e,i,l,d,m,_,v,S,A),iconSecondary:F2(r.getSecondary(),e,i,l,d,m,_,v,S,A)}}function GO(r,e,i){if(!e)return;const l=i.get(r.toString()),d=i.get(e.toString());l&&d&&(l.paddedRect.w===d.paddedRect.w&&l.paddedRect.h===d.paddedRect.h||Pn(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),l.usvg!==d.usvg&&Pn(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function V2(r,e,i,l){if(!r)return;const d=e.get(i.toString());if(r.imagePrimary=d,l){const m=e.get(l.toString());r.imageSecondary=m}}function qO(r,e){for(const i in r.horizontal)j2(r.horizontal[i],e);j2(r.vertical,e)}function j2(r,e){if(r){for(const i of r.positionedLines)for(const l of i.positionedGlyphs)if(l.image!==null){const d=l.image.toString();l.rect=e.get(d).paddedRect}}}function kw(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function HO(r,e,i,l,d,m,_,v,S){const A=K0(m.horizontal)||m.vertical,D=i.get("icon-text-fit-padding").evaluate(l,{},d);let P,k=e;return e&&S!=="none"&&(r.allowVerticalPlacement&&m.vertical&&(P=Iw(e,m.vertical,S,D,v,_)),A&&(k=Iw(e,A,S,D,v,_))),{defaultShapedIcon:k,verticallyShapedIcon:P}}function U2(r,e){return r*e/24}function $O(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te,se,le,_e,me,Ee){let Se=_.textMaxSize.evaluate(e,{},k);Se===void 0?Se=v*_.textScaleFactor:Se*=_.textScaleFactor;const we=r.layers[0].layout,Me=U2(v,_.textScaleFactor),Oe=K0(i.horizontal)||i.vertical,pt=r.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((K!=="none"||pt)&&r.appearanceFeatureData&&r.featureToAppearanceIndex[e.index]<r.appearanceFeatureData.length){const Ht=r.appearanceFeatureData[r.featureToAppearanceIndex[e.index]];Ht&&(Ht.textShaping=Oe,Ht.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(e,{},k),Ht.fontScale=Me,Ht.textScaleFactor=_.textScaleFactor)}const ot=N.name==="globe",ut=r.tilePixelRatio*Se/24,Tt=(Ct=r.overscaling,r.zoom>18&&Ct>2&&(Ct>>=1),Math.max(jt/(512*Ct),1)*we.get("symbol-spacing")),vt=we.get("text-padding")*r.tilePixelRatio,bt=we.get("icon-padding")*r.tilePixelRatio,rt=ai(we.get("text-max-angle")),At=we.get("icon-rotation-alignment")==="map"&&se!=="point",_t=Tt/2;var Ct;r.hasAnyIconTextFit===!1&&K!=="none"&&(r.hasAnyIconTextFit=!0);const Et=e.properties?+e.properties[li]:null,nn=Et&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(Et):65535,rn=(Ht,Wt,An)=>{if(Wt.x<0||Wt.x>=jt||Wt.y<0||Wt.y>=jt)return;let _n=null;if(ot){const{x:Qt,y:Nn,z:ii}=N.projectTilePoint(Wt.x,Wt.y,An);_n={anchor:new hp(Qt,Nn,ii,0,void 0),up:N.upVector(An,Wt.x,Wt.y)}}(function(Qt,Nn,ii,Di,Qn,Zi,xi,as,wi,Ui,Er,Nr,Br,os,Ea,Ya,ks,Hs,na,Yn,Fr,Xr,tc,Go,Sa,qo,Wd,_o,pb,hy,sl,mb){const Xd=Qt.addToLineVertexArray(Nn,Di);let dp,Tm,hu,Wu,tv,dy,Jn,da=0,ls=0,$s=0,du=0,bl=-1,nc=-1;const fa={};let nv=ro("");const Yd=ii?ii.anchor:Nn,Ls=_o!=="none";let Aa=0,Zs=0;if(wi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ia=wi.layout.get("text-offset").evaluate(Fr,{},Sa);Aa=Ia[0]*ha,Zs=Ia[1]*ha}else Aa=wi.layout.get("text-radial-offset").evaluate(Fr,{},Sa)*ha,Zs=Pw;if(Qt.allowVerticalPlacement&&Qn.vertical){const Ia=Qn.vertical;if(Ea)dy=Ow(Ia),as&&(Jn=Ow(as));else{const wl=wi.layout.get("text-rotate").evaluate(Fr,{},Sa)+90;hu=Q0(Ui,Yd,Nn,Er,Nr,Br,Ia,os,wl,Ya,mb),as&&(Wu=Q0(Ui,Yd,Nn,Er,Nr,Br,as,Hs,wl,null,sl))}}if(Zi){const Ia=wi.layout.get("icon-rotate").evaluate(Fr,{},Sa),wl=Dw(Zi,Ia,tc,Ls,Xr.iconScaleFactor),Xu=as?Dw(as,Ia,tc,Ls,Xr.iconScaleFactor):void 0;Tm=Q0(Ui,Yd,Nn,Er,Nr,Br,Zi,Hs,Ia,null,hy);const Kd=(function($h,rN,aC,sN,aN,oC,lC,oN,W$,aT){const cC=$h.layers[0],uC=cC.appearances;let py=rN.length;if(aC&&(py=Math.max(py,aC.length)),uC.length===0)return py;const[lN,cN]=sN.get("icon-size-scale-range"),uN=xe(1,lN,cN);for(const oT of uC){const hC=oT.getUnevaluatedProperties();if(hC._values["icon-image"].value!==void 0){const dC=cC.getAppearanceValueAndResolveTokens(oT,"icon-image",oC,lC,aT);if(dC){const fC=$h.getResolvedImageFromTokens(dC);if(fC){const pC=oT.hasProperty("icon-size")?hC._values["icon-size"]:aN._values["icon-size"],hN=Fx(fC,Zg($h.zoom,pC,$h.worldview,aT),pC,lC,$h.zoom,oC,$h.pixelRatio,uN,$h.worldview,aT),mC=oN.get(hN.iconPrimary.toString());mC&&(py=Math.max(py,LO(mC)))}}}}return py})(Qt,wl,Xu,wi.layout,wi._unevaluatedLayout,Fr,Sa,Qt.iconAtlasPositions,0,Go);da=4*Kd;const rT=wi.layout.get("icon-size").evaluate(Fr,{},Sa,Go),sT=Xr.compositeIconSizes?Xr.compositeIconSizes[0].evaluate(Fr,{},Sa,Go):0,iv=Xr.compositeIconSizes?Xr.compositeIconSizes[1].evaluate(Fr,{},Sa,Go):0,fy=zw(Qt.layerIds[0],Qt.iconSizeData,rT,Xr.iconScaleFactor,sT,iv);Qt.addSymbols(Qt.icon,wl,fy,Yn,na,Fr,void 0,ii,Nn,Xd.lineStartIndex,Xd.lineLength,-1,Go,Sa,qo,Wd,Qt.symbolInstances.length,Kd),bl=Qt.icon.placedSymbolArray.length-1,Xu&&(ls=4*Kd,Qt.addSymbols(Qt.icon,Xu,fy,Yn,na,Fr,ec.vertical,ii,Nn,Xd.lineStartIndex,Xd.lineLength,-1,Go,Sa,qo,Wd,Qt.symbolInstances.length,Kd),nc=Qt.icon.placedSymbolArray.length-1)}for(const Ia in Qn.horizontal){const wl=Ia,Xu=Qn.horizontal[wl];dp||(nv=ro(Xu.text),Ea?tv=Ow(Xu):dp=Q0(Ui,Yd,Nn,Er,Nr,Br,Xu,os,wi.layout.get("text-rotate").evaluate(Fr,{},Sa),Ya,mb));const Kd=Xu.positionedLines.length===1;if($s+=G2(Qt,ii,Nn,Xu,xi,wi,Ea,Fr,Ya,Xd,Qn.vertical?ec.horizontal:ec.horizontalOnly,Kd?BO(Qn.horizontal):[wl],fa,bl,Xr,Go,Sa,Qt.symbolInstances.length,qo),Kd)break}Qn.vertical&&(du+=G2(Qt,ii,Nn,Qn.vertical,xi,wi,Ea,Fr,Ya,Xd,ec.vertical,["vertical"],fa,nc,Xr,Go,Sa,Qt.symbolInstances.length,qo));let yo=-1;const xo=(Ia,wl)=>Ia?Math.max(Ia,wl):wl;yo=xo(tv,yo),yo=xo(dy,yo),yo=xo(Jn,yo);const Em=yo>-1?1:0;Qt.glyphOffsetArray.length>=65535&&Pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fr.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,Fr.sortKey),Qt.symbolInstances.emplaceBack(Nn.x,Nn.y,Yd.x,Yd.y,Yd.z,fa.right>=0?fa.right:-1,fa.center>=0?fa.center:-1,fa.left>=0?fa.left:-1,fa.vertical>=0?fa.vertical:-1,bl,nc,nv,dp!==void 0?dp:Qt.collisionBoxArray.length,dp!==void 0?dp+1:Qt.collisionBoxArray.length,hu!==void 0?hu:Qt.collisionBoxArray.length,hu!==void 0?hu+1:Qt.collisionBoxArray.length,Tm!==void 0?Tm:Qt.collisionBoxArray.length,Tm!==void 0?Tm+1:Qt.collisionBoxArray.length,Wu||Qt.collisionBoxArray.length,Wu?Wu+1:Qt.collisionBoxArray.length,Er,$s,du,da,ls,Em,0,Aa,Zs,yo,0,Ls?1:0,pb)})(r,Wt,_n,Ht,i,l,m,d,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,vt,te,A,0,bt,At,X,e,_,D,P,k,U,Z,K,nn,le,_e,me)};if(se==="line")for(const Ht of k0(e.geometry,0,0,jt,jt)){const Wt=kO(Ht,Tt,rt,i.vertical||Oe,l,24,ut,r.overscaling,jt);for(const An of Wt)Oe&&ZO(r,Oe.text,_t,An)||rn(Ht,An,k)}else if(se==="line-center"){for(const Ht of e.geometry)if(Ht.length>1){const Wt=PO(Ht,rt,i.vertical||Oe,l,24,ut);Wt&&rn(Ht,Wt,k)}}else if(e.type==="Polygon")for(const Ht of Og(e.geometry,0)){const Wt=OO(Ht,16);rn(Ht[0],new hp(Wt.x,Wt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const Ht of e.geometry)rn(Ht,new hp(Ht[0].x,Ht[0].y,0,0,void 0),k);else if(e.type==="Point")for(const Ht of e.geometry)for(const Wt of Ht)rn([Wt],new hp(Wt.x,Wt.y,0,0,void 0),k)}const Lw=255,Wg=Lw*up;function G2(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te){const se=z2(0,l,S,m,_,v,d,r.allowVerticalPlacement,void 0),le=m.layout.get("text-size").evaluate(v,{},K),_e=U.compositeTextSizes?U.compositeTextSizes[0].evaluate(v,{},K):0,me=U.compositeTextSizes?U.compositeTextSizes[1].evaluate(v,{},K):0,Ee=zw(r.layerIds[0],r.textSizeData,le,U.textScaleFactor,_e,me);r.addSymbols(r.text,se,Ee,S,_,v,D,e,i,A.lineStartIndex,A.lineLength,N,Z,K,te,!1,X,se.length);for(const Se of P)k[Se]=r.text.placedSymbolArray.length-1;return 4*se.length}function zw(r,e,i,l,d,m){const _=e;let v=null;return _.kind==="source"?(v=[up*i*l],v[0]>Wg&&Pn(`${r}: Value for "text-size" is >= ${Lw}. Reduce your "text-size".`)):_.kind==="composite"&&(v=[up*d*l,up*m*l],(v[0]>Wg||v[1]>Wg)&&Pn(`${r}: Value for "text-size" is >= ${Lw}. Reduce your "text-size".`)),v}function K0(r){for(const e in r)return r[e];return null}function Q0(r,e,i,l,d,m,_,v,S,A,D){let P,k,N,U;if(P=D?D.top:_.top,k=D?D.bottom:_.bottom,N=D?D.left:_.left,U=D?D.right:_.right,Aw(_)&&_.collisionPadding){const Z=_.collisionPadding;N-=Z[0],P-=Z[1],U+=Z[2],k+=Z[3]}if(S){const Z=new Mt(N,P),K=new Mt(U,P),X=new Mt(N,k),te=new Mt(U,k),se=ai(S);let le=new Mt(0,0);A&&(le=new Mt(A[0],A[1])),Z._rotateAround(se,le),K._rotateAround(se,le),X._rotateAround(se,le),te._rotateAround(se,le),N=Math.min(Z.x,K.x,X.x,te.x),U=Math.max(Z.x,K.x,X.x,te.x),P=Math.min(Z.y,K.y,X.y,te.y),k=Math.max(Z.y,K.y,X.y,te.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,N,P,U,k,v,l,d,m),r.length-1}function Ow(r){Aw(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function ZO(r,e,i,l){const d=r.compareText;if(e in d){const m=d[e];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<i)return!0}else d[e]=[];return d[e].push(l),!1}function q2(r,e){const i=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,d=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),m=Math.sin(i)*d/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*m+d;const v=d*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let S=Math.max(r.zoom-17,0);r.isOrthographic&&(S/=10),_*=1+S}return Math.min(1.01*_,v)}function Vx(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),l=r.x*i,d=(r.x+1)*i,m=r.y*i,_=(r.y+1)*i,v=lt(l),S=lt(d),A=xt(m),D=xt(_),P=e.project(v,A),k=e.project(S,A),N=e.project(S,D),U=e.project(v,D);let Z=Math.min(P.x,k.x,N.x,U.x),K=Math.min(P.y,k.y,N.y,U.y),X=Math.max(P.x,k.x,N.x,U.x),te=Math.max(P.y,k.y,N.y,U.y);const se=i/16;function le(me,Ee,Se,we,Me,Oe){const pt=(Se+Me)/2,ot=(we+Oe)/2,ut=e.project(lt(pt),xt(ot)),Tt=Math.max(0,Z-ut.x,K-ut.y,ut.x-X,ut.y-te);Z=Math.min(Z,ut.x),X=Math.max(X,ut.x),K=Math.min(K,ut.y),te=Math.max(te,ut.y),Tt>se&&(le(me,ut,Se,we,pt,ot),le(ut,Ee,pt,ot,Me,Oe))}le(P,k,l,m,d,m),le(k,N,d,m,d,_),le(N,U,d,_,l,_),le(U,P,l,_,l,m),Z-=se,K-=se,X+=se,te+=se;const _e=1/Math.max(X-Z,te-K);return{scale:_e,x:Z*_e,y:K*_e,x2:X*_e,y2:te*_e,projection:e}}function H2(r,{x:e,y:i},l=0){return new Mt(((e-l)*r.scale-r.x)*jt,(i*r.scale-r.y)*jt)}const WO=Xe(new Float32Array(16));class bm{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ge(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l,d=!0){return e._coordinatePoint(e.locationCoordinate(i,l),d)}pixelsPerMeter(e,i){return $e(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return q2(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,d){const m=e.horizonLineFromTop(!1),_=new Mt(i,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,d))}pointCoordinate3D(e,i,l){const d=new Mt(i,l);if(e.elevation)return e.elevation.pointCoordinate(d);{const m=this.pointCoordinate(e,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return WO}createTileMatrix(e,i,l){let d,m,_;const v=l.canonical,S=Xe(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Vx(v,this);d=1,m=A.x+l.wrap*A.scale,_=A.y,Ft(S,S,[d/A.scale,d/A.scale,e.pixelsPerMeter/i])}else d=i/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*l.wrap)*d,_=v.y*d;return ht(S,S,[m,_,0]),Ft(S,S,[d/jt,d/jt,1]),S}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class XO extends bm{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(ai(i));this.n=(d+Math.sin(ai(l)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:d,r0:m}=this,_=ai(e-this.center[0]),v=ai(i),S=Math.sqrt(d-2*l*Math.sin(v))/l;return{x:S*Math.sin(_*l),y:S*Math.cos(_*l)-m,z:0}}unproject(e,i){const{n:l,c:d,r0:m}=this,_=m+i;let v=Math.atan2(e,Math.abs(_))*Math.sign(_);_*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(_));const S=ai(this.center[0])*l;v=it(v,-Math.PI-S,Math.PI-S);const A=xe(Ue(v/l)+this.center[0],-180,180),D=Math.asin(xe((d-(e*e+_*_)*l*l)/(2*l),-1,1)),P=xe(Ue(D),-85.051129,ke);return new ge(A,P)}}const jx=1.340264,Ux=-.081106,Gx=893e-6,qx=.003796,J0=Math.sqrt(3)/2;class YO extends bm{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(J0*Math.sin(i)),d=l*l,m=d*d*d;return{x:.5*(e*Math.cos(l)/(J0*(jx+3*Ux*d+m*(7*Gx+9*qx*d)))/Math.PI+.5),y:1-.5*(l*(jx+Ux*d+m*(Gx+qx*d))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,d=l*l,m=d*d*d;for(let D,P,k,N=0;N<12&&(P=l*(jx+Ux*d+m*(Gx+qx*d))-i,k=jx+3*Ux*d+m*(7*Gx+9*qx*d),D=P/k,l=xe(l-D,-Math.PI/3,Math.PI/3),d=l*l,m=d*d*d,!(Math.abs(D)<1e-12));++N);const _=J0*e*(jx+3*Ux*d+m*(7*Gx+9*qx*d))/Math.cos(l),v=Math.asin(Math.sin(l)/J0),S=xe(180*_/Math.PI,-180,180),A=xe(180*v/Math.PI,-85.051129,ke);return new ge(S,A)}}class KO extends bm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),d=xe(360*(.5-i),-85.051129,ke);return new ge(l,d)}}const sy=Math.PI/2;function eb(r){return Math.tan((sy+r)/2)}class QO extends bm{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let d=ai(i),m=ai(l);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const _=Math.cos(d),v=eb(d);this.n=d===m?Math.sin(d):Math.log(_/Math.cos(m))/Math.log(eb(m)/v),this.f=_*Math.pow(eb(d),this.n)/this.n}project(e,i){i=ai(i),this.southernCenter&&(i=-i),e=ai(e-this.center[0]);const l=1e-6,{n:d,f:m}=this;m>0?i<-sy+l&&(i=-sy+l):i>sy-l&&(i=sy-l);const _=m/Math.pow(eb(i),d);let v=_*Math.sin(d*e),S=m-_*Math.cos(d*e);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:d}=this,m=d-i,_=Math.sign(m),v=Math.sign(l)*Math.sqrt(e*e+m*m);let S=Math.atan2(e,Math.abs(m))*_;m*l<0&&(S-=Math.PI*Math.sign(e)*_);const A=xe(Ue(S/l)+this.center[0],-180,180),D=xe(Ue(2*Math.atan(Math.pow(d/v,1/l))-sy),-85.051129,ke);return new ge(A,this.southernCenter?-D:D)}}class $2 extends bm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Fe(e),y:We(i),z:0}}unproject(e,i){const l=lt(e),d=xt(i);return new ge(l,d)}}const Z2=ai(ke);class JO extends bm{project(e,i){const l=(i=ai(i))*i,d=l*l;return{x:.5*((e=ai(e))*(.8707-.131979*l+d*(d*(.003971*l-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+d*(.028874*l-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,d=25,m=0,_=l*l;do{_=l*l;const A=_*_;m=(l*(1.007226+_*(.015085+A*(.028874*_-.044475-.005916*A)))-i)/(1.007226+_*(.045255+A*(.259866*_-.311325-.005916*11*A))),l=xe(l-m,-Z2,Z2)}while(Math.abs(m)>1e-6&&--d>0);_=l*l;const v=xe(Ue(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),S=Ue(l);return new ge(v,S)}}const W2=ai(ke);class e3 extends bm{project(e,i){i=ai(i),e=ai(e);const l=Math.cos(i),d=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),_=Math.sin(m)/m,v=.5*(e*d+2*l*Math.sin(e/2)/_)||0,S=.5*(i+Math.sin(i)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,d=i=(2*(1-i)-1)*Math.PI,m=25;const _=1e-6;let v=0,S=0;do{const A=Math.cos(d),D=Math.sin(d),P=2*D*A,k=D*D,N=A*A,U=Math.cos(l/2),Z=Math.sin(l/2),K=2*U*Z,X=Z*Z,te=1-N*U*U,se=te?1/te:0,le=te?Math.acos(A*U)*Math.sqrt(1/te):0,_e=.5*(2*le*A*Z+2*l/Math.PI)-e,me=.5*(le*D+d)-i,Ee=.5*se*(N*X+le*A*U*k)+1/Math.PI,Se=se*(K*P/4-le*D*Z),we=.125*se*(P*Z-le*D*N*K),Me=.5*se*(k*U+le*X*A)+.5,Oe=Se*we-Me*Ee;v=(me*Se-_e*Me)/Oe,S=(_e*we-me*Ee)/Oe,l=xe(l-v,-Math.PI,Math.PI),d=xe(d-S,-W2,W2)}while((Math.abs(v)>_||Math.abs(S)>_)&&--m>0);return new ge(Ue(l),Ue(d))}}class X2 extends bm{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ai(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:d}=this;return{x:ai(e)*d*l+.5,y:-Math.sin(ai(i))/d*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:d}=this,m=-(i-.5)/l,_=xe(Ue((e-.5)/l)/d,-180,180),v=Math.asin(xe(m*d,-1,1)),S=xe(Ue(v),-85.051129,ke);return new ge(_,S)}}class t3 extends $2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const d=Sg(e,i,l);return cr(d,d,Ag(lu(l))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,i,l){const d=Te(i.lat,i.lng),m=Gn([],d),_=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;wn(d,d,m,$e(1,0)*jt*_);const v=Xe(new Float64Array(16));return ft(v,e.pixelMatrix,e.globeMatrix),cr(d,d,v),new Mt(d[0],d[1])}pixelsPerMeter(e,i){return $e(1,0)*i}pixelSpaceConversion(e,i,l){const d=$e(1,e)*i,m=Cn($e(1,45)*i,d,l);return this.pixelsPerMeter(e,i)/m}createTileMatrix(e,i,l){const d=or(lu(l.canonical));return ft(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,i){const{center:l}=e,d=Ag(lu(i));return St(d,d,ai(l.lng)),fn(d,d,ai(l.lat)),Ft(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,i,l,d){return rx(e,i,l,!0)||new qt(0,0)}pointCoordinate3D(e,i,l){const d=this.pointCoordinate(e,i,l,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,i){return!rx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(d,m){const _=d.cameraToCenterDistance,v=d._centerAltitude*m,S=d._camera,A=d._camera.forward(),D=En([],Ne([],A,-_),[0,0,v]),P=d.worldSize/(2*Math.PI),k=[0,0,-P],N=d.width/d.height,U=Math.tan(d.fovAboveCenter),Z=Ne([],S.up(),U),K=Ne([],S.right(),U*N),X=Gn([],En([],En([],A,Z),K)),te=[];let se;if(new Ji(D,X).closestPointOnSphere(k,P,te)){const le=En([],te,k),_e=ui([],le,D);se=Math.cos(d.fovAboveCenter)*dn(_e)}else{const le=ui([],D,k),_e=ui([],k,D);Gn(_e,_e);const me=dn(le)-P;se=Math.sqrt(me*(me+2*P));const Ee=Math.acos(se/(P+me))-Math.acos(zi(A,_e));se*=Math.cos(Ee)}return 1.01*se})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Fh(e.zoom);if(l>0){const d=q2(e,$e(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Cn(i,d+m*(1-Math.cos(_)),Math.pow(l,10))}return i}upVector(e,i,l){return Sg(i,l,e,1)}upVectorScale(e){return{metersToTile:Tg(Gd(lu(e)))}}}function Y2(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new $2(r);case"equirectangular":return new KO(r);case"naturalEarth":return new JO(r);case"equalEarth":return new YO(r);case"winkelTripel":return new e3(r);case"albers":return i?new X2(r):new XO(r);case"lambertConformalConic":return i?new X2(r):new QO(r);case"globe":return new t3(r)}throw new Error(`Invalid projection name: ${r.name}`)}const n3=ti.types,i3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hx(r,e,i,l,d,m,_,v,S,A,D,P,k){const N=v?Math.min(Wg,Math.round(v[0])):0,U=v?Math.min(Wg,Math.round(v[1])):0;r.emplaceBack(e,i,Math.round(32*l),Math.round(32*d),m,_,(N<<1)+(S?1:0),0+(U<<1),16*A,16*D,256*P,256*k)}function $x(r,e,i){r.emplaceBack(e,i)}function Zx(r,e,i,l,d,m,_){r.emplaceBack(e,i,l,d,m,_)}const tb=(r,e,i,l)=>{for(let d=0;d<e;d++)r.emplaceBack(i[0],i[1],i[2],l[0],l[1],l[2])};function ay(r,e,i,l,d){r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d)}function r3(r){for(const e of r.sections)if(wc(e.text))return!0;return!1}class Nw{constructor(e){this.layoutVertexArray=new Dh,this.indexArray=new xs,this.programConfigurations=e,this.segments=new mr,this.dynamicLayoutVertexArray=new Zl,this.opacityVertexArray=new nm,this.placedSymbolArray=new ep,this.iconTransitioningVertexArray=new nl,this.globeExtVertexArray=new tm,this.zOffsetVertexArray=new Gs,this.orientationVertexArray=new Dd,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,i){const l=[],d=this.layoutVertexArray.uint16;for(let m=0;m<i;++m){const _=12*(e+m);l.push(...d.slice(_,_+12))}return l}updateSymbolVertexData(e,i,l,d,m,_,v,S,A,D,P,k,N){const U=this.layoutVertexArray.uint16,Z=12*e;U[Z]=i,U[Z+1]=l,U[Z+2]=d,U[Z+3]=m,U[Z+4]=_,U[Z+5]=v,U[Z+6]=S,U[Z+7]=A,U[Z+8]=D,U[Z+9]=P,U[Z+10]=k,U[Z+11]=N}upload(e,i,l,d,m,_){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aO.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,lO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,i3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,hO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,oO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,cO.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,uO.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Bt(Nw,"SymbolBuffers");class Bw{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new mr,this.collisionVertexArray=new Kf,this.collisionVertexArrayExt=new Zl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,dO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(Bw,"CollisionBuffers");class nb{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xe([]),this.placementViewportMatrix=Xe([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Zg(this.zoom,i["text-size"],this.worldview,e.availableImages),this.iconSizeData=Zg(this.zoom,i["icon-size"],this.worldview,e.availableImages);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>ec[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();if(!i||i.length===0)return!1;const l=Array.isArray(e)?e:[e];return i.some(d=>l.some(m=>d.getProperty(m)!=null))}createArrays(){this.text=new Nw(new O(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Nw(new O(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new tp,this.lineVertexArray=new P_,this.symbolInstances=new hs}calculateGlyphDependencies(e,i,l,d,m){for(const _ of e){const v=_.codePointAt(0);if(v===void 0)break;if(i[v]=!0,d&&m&&v<=65535){const S=zx[_];S&&(i[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,l,d,m,_,v){if(!e.hasProperty("icon-size"))return v*_;let S=1;const A=e.getUnevaluatedProperties()._values["icon-size"],D=Zg(this.zoom,A,this.worldview,m),P=ny(D,i);if(D.kind!=="constant"&&D.kind!=="camera"||(S=P.uSize),D.kind==="composite"){const{minZoom:k,maxZoom:N}=D,U=A.possiblyEvaluate(new Pi(k,{worldview:this.worldview}),d),Z=A.possiblyEvaluate(new Pi(N,{worldview:this.worldview}),d),K=U.evaluate(l,{},d,m);S=K+(Z.evaluate(l,{},d,m)-K)*P.uSizeT}return D.kind==="source"&&(S=A.possiblyEvaluate(new Pi(this.zoom,{worldview:this.worldview}),d).evaluate(l,{},d,m)),S*_}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!h(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?so.build(e):e}populate(e,i,l,d){const m=this.layers[0],_=m.layout,v=this.projection.name==="globe",S=_.get("text-font"),A=_.get("text-field"),D=_.get("icon-image"),[P,k]=_.get("icon-size-scale-range"),N=xe(i.scaleFactor||1,P,k),U=(A.value.kind!=="constant"||A.value.value instanceof Rs&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),Z=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,K=this.hasAnyAppearanceProperty("icon-image"),X=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!U&&!Z&&!K)return;const te=i.iconDependencies,se=i.glyphDependencies,le=i.availableImages,_e=new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),me=Ee=>{const Se=Ee.id.toString();te.has(Se)?te.get(Se).push(Ee):te.set(Se,[Ee])};for(const Ee of e){const{feature:Se,id:we,index:Me,sourceLayerIndex:Oe}=Ee,pt=m._featureFilter.needGeometry,ot=Vn(Se,pt);if(!m._featureFilter.filter(_e,ot,l))continue;if(pt||(ot.geometry=Mn(Se,l,d)),v&&Se.type!==1&&l.z<=5){const Ct=ot.geometry,Et=.98078528056,nn=(rn,Ht)=>zi(Sg(rn.x,rn.y,l,1),Sg(Ht.x,Ht.y,l,1))<Et;for(let rn=0;rn<Ct.length;rn++)Ct[rn]=an(Ct[rn],nn)}let ut,Tt;if(U){const Ct=m.getValueAndResolveTokens("text-field",ot,l,le),Et=Rs.factory(Ct);r3(Et)&&(this.hasRTLText=!0),(!this.hasRTLText||zu()==="unavailable"||this.hasRTLText&&No.isParsed())&&(ut=mO(Et,m,ot))}if(Z){const Ct=m.getValueAndResolveTokens("icon-image",ot,l,le);Tt=this.getResolvedImageFromTokens(Ct)}const vt=this.layers[0];let bt=!1;if(!Tt&&K){const Ct=vt.getAppearances();for(const Et of Ct)if(Et.getProperty("icon-image")){const nn=vt.getAppearanceValueAndResolveTokens(Et,"icon-image",ot,l,le);if(nn){Tt=this.getResolvedImageFromTokens(nn),bt=!0;break}}}if(!ut&&!Tt)continue;const rt=this.sortFeaturesByKey?X.evaluate(ot,{},l):void 0,At={id:we,text:ut,icon:Tt,index:Me,sourceLayerIndex:Oe,geometry:ot.geometry,properties:Se.properties,type:n3[Se.type],sortKey:rt};if(this.features.push(At),this.featureToAppearanceIndex[Me]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:we,properties:Se.properties,usesAppearanceIconAsPlaceholder:bt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),Tt){const Ct=vt._unevaluatedLayout._values,{iconPrimary:Et,iconSecondary:nn}=Fx(Tt,this.iconSizeData,Ct["icon-size"],l,this.zoom,At,this.pixelRatio,N,this.worldview,le);me(Et),nn&&(this.hasAnySecondaryIcon=!0,me(nn))}const _t=vt.getAppearances();if(_t.length!==0&&_t.forEach(Ct=>{if(!Ct.getProperty("icon-image"))return;const Et=this.getCombinedIconPrimary(Ct,vt,ot,l,le,At,N);Et&&me(Et)}),ut){const Ct=S.evaluate(ot,{},l).join(","),Et=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ec.vertical)>=0;for(const nn of ut.sections)if(nn.image){const rn=nn.image.getPrimary().scaleSelf(this.pixelRatio),Ht=rn.id.toString(),Wt=te.get(Ht)||[];Wt.push(rn),te.set(Ht,Wt)}else{const rn=$p(ut.toString()),Ht=nn.fontStack||Ct,Wt=se[Ht]=se[Ht]||{};this.calculateGlyphDependencies(nn.text,Wt,Et,this.allowVerticalPlacement,rn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ee){const Se={},we={},Me=[];let Oe=0;function pt(vt){Me.push(Ee[vt]),Oe++}function ot(vt,bt,rt){const At=we[vt];return delete we[vt],we[bt]=At,Me[At].geometry[0].pop(),Me[At].geometry[0]=Me[At].geometry[0].concat(rt[0]),At}function ut(vt,bt,rt){const At=Se[bt];return delete Se[bt],Se[vt]=At,Me[At].geometry[0].shift(),Me[At].geometry[0]=rt[0].concat(Me[At].geometry[0]),At}function Tt(vt,bt,rt){const At=rt?bt[0][bt[0].length-1]:bt[0][0];return`${vt}:${At.x}:${At.y}`}for(let vt=0;vt<Ee.length;vt++){const bt=Ee[vt],rt=bt.geometry,At=bt.text?bt.text.toString():null;if(!At){pt(vt);continue}const _t=Tt(At,rt),Ct=Tt(At,rt,!0);if(_t in we&&Ct in Se&&we[_t]!==Se[Ct]){const Et=ut(_t,Ct,rt),nn=ot(_t,Ct,Me[Et].geometry);delete Se[_t],delete we[Ct],we[Tt(At,Me[nn].geometry,!0)]=nn,Me[Et].geometry=null}else _t in we?ot(_t,Ct,rt):Ct in Se?ut(_t,Ct,rt):(pt(vt),Se[_t]=Oe-1,we[Ct]=Oe-1)}return Me.filter(vt=>vt.geometry)})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Se)=>Ee.sortKey-Se.sortKey)}getCombinedIconPrimary(e,i,l,d,m,_,v){let S,A;const D=e.getUnevaluatedProperties();if(D._values["icon-image"].value!==void 0){const P=i.getAppearanceValueAndResolveTokens(e,"icon-image",l,d,m);S=this.getResolvedImageFromTokens(P)}else{const P=i.getValueAndResolveTokens("icon-image",l,d,m);S=this.getResolvedImageFromTokens(P)}if(S){const P=e.hasProperty("icon-size")?D._values["icon-size"]:i._unevaluatedLayout._values["icon-size"];A=Fx(S,Zg(this.zoom,P,this.worldview,m),P,d,this.zoom,_,this.pixelRatio,v,this.worldview,m).iconPrimary}return A}updateSymbolInstanceIconVertices(e,i,l,d,m,_,v,S,A,D,P,k,N,U){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(i.activeAppearance===l)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(l){const Z=this.getCombinedIconPrimary(l,A,d,_,v,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:i.properties,type:"Point",id:i.id},D);if(!Z)return{vertexOffsetDelta:0,hasChanges:!1};const K=Z.toString(),X=this.iconAtlasPositions&&this.iconAtlasPositions.get(K);if(X){const{appearanceIconOffset:te,appearanceIconRotate:se}=N2(l,A,d,_,k,U,N,D);let le=$0(X,void 0,te,A.layout.get("icon-anchor").evaluate(d,P,_));const _e=X.sdf,me=A.layout.get("icon-text-fit").constantOr("none");me!=="none"&&i.textShaping&&i.iconTextFitPadding&&i.fontScale&&(le=Iw(le,i.textShaping,me,i.iconTextFitPadding,te,i.fontScale));const Ee=this.calculateEffectiveAppearanceIconSize(l,S.zoom,d,_,v,D,N),Se=0,we=1+(Math.min(Wg,Math.round(Ee*up))<<1),Me=Dw(le,se,_e,me!=="none",D);i.isUsingAppearanceIconVertexData||(i.isUsingAppearanceIconVertexData=!0,i.layoutBasedIconVertexData=this.icon.getSymbolVertexData(m,e.numIconVertices));let Oe=m;for(let ot=0;ot<Me.length;++ot){const ut=Me[ot],Tt=i.layoutBasedIconVertexData[0]||e.tileAnchorX,vt=i.layoutBasedIconVertexData[1]||e.tileAnchorY,bt=16*ut.pixelOffsetTL.x,rt=16*ut.pixelOffsetTL.y,At=16*ut.pixelOffsetBR.x,_t=16*ut.pixelOffsetBR.y,Ct=16*ut.minFontScaleX,Et=16*ut.minFontScaleY;this.icon.updateSymbolVertexData(Oe,Tt,vt,Math.round(32*ut.tl.x),Math.round(32*ut.tl.y),ut.texPrimary.x,ut.texPrimary.y,Se,we,bt,rt,Ct,Et),this.icon.updateSymbolVertexData(Oe+1,Tt,vt,Math.round(32*ut.tr.x),Math.round(32*ut.tr.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y,Se,we,At,rt,Ct,Et),this.icon.updateSymbolVertexData(Oe+2,Tt,vt,Math.round(32*ut.bl.x),Math.round(32*ut.bl.y),ut.texPrimary.x,ut.texPrimary.y+ut.texPrimary.h,Se,we,bt,_t,Ct,Et),this.icon.updateSymbolVertexData(Oe+3,Tt,vt,Math.round(32*ut.br.x),Math.round(32*ut.br.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y+ut.texPrimary.h,Se,we,At,_t,Ct,Et),Oe+=4}const pt=e.numIconVertices-4*Me.length;for(let ot=0;ot<pt;++ot)this.icon.updateSymbolVertexData(Oe+ot,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(i.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(m,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(i.isUsingAppearanceIconVertexData){const K=i.layoutBasedIconVertexData.length/12;for(let X=0;X<K;++X){const te=X*12;this.icon.updateSymbolVertexData(m+X,i.layoutBasedIconVertexData[te+0],i.layoutBasedIconVertexData[te+1],i.layoutBasedIconVertexData[te+2],i.layoutBasedIconVertexData[te+3],i.layoutBasedIconVertexData[te+4],i.layoutBasedIconVertexData[te+5],i.layoutBasedIconVertexData[te+6],i.layoutBasedIconVertexData[te+7],i.layoutBasedIconVertexData[te+8],i.layoutBasedIconVertexData[te+9],i.layoutBasedIconVertexData[te+10],i.layoutBasedIconVertexData[te+11])}return i.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:K,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te){const se=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!se)return{vertexOffsetDelta:se?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(i.activeAppearance===l)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(l&&i.textShaping){const{appearanceTextOffset:le,appearanceTextRotate:_e,appearanceTextSize:me}=B2(l,v,d,_,P,N,k);i.fontScale=U2(me,i.textScaleFactor);const Ee=l.getUnevaluatedProperty("text-size");let Se=this.textSizeData,we=K,Me=X;l.hasProperty("text-size")&&(Se=Zg(this.zoom,Ee,this.worldview,te),we=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Me=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Oe=i.textShaping.bottom-P[1],pt=i.textShaping.left-P[0],ot=i.textShaping.right-P[0];i.textShaping.top=le[1]+(i.textShaping.top-P[1]),i.textShaping.bottom=le[1]+Oe,i.textShaping.left=le[0]+pt,i.textShaping.right=le[0]+ot;const ut=z2(0,i.textShaping,le,v,!1,d,A,this.allowVerticalPlacement,_e),Tt=me&&Se.kind==="composite"?Ee.possiblyEvaluate(new Pi(we,{}),_).evaluate(d,D,_):U,vt=me&&Se.kind==="composite"?Ee.possiblyEvaluate(new Pi(Me,{}),_).evaluate(d,D,_):Z,bt=zw(l.name,Se,me,S,Tt,vt),rt=Array.isArray(bt)?bt[1]:me,At=0,_t=1+(Math.min(Wg,Math.round(rt*up))<<1);i.isUsingAppearanceTextVertexData||(i.isUsingAppearanceTextVertexData=!0,i.layoutBasedTextVertexData=this.text.getSymbolVertexData(m,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let Ct=0;Ct<ut.length&&Ct<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++Ct){const Et=ut[Ct],nn=Et.glyphOffset[1],rn=e.tileAnchorX,Ht=e.tileAnchorY,Wt=m+4*Ct;this.text.updateSymbolVertexData(Wt,rn,Ht,Math.round(32*Et.tl.x),Math.round(32*(nn+Et.tl.y)),Et.texPrimary.x,Et.texPrimary.y,At,_t,Et.pixelOffsetTL.x,Et.pixelOffsetTL.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+1,rn,Ht,Math.round(32*Et.tr.x),Math.round(32*(nn+Et.tr.y)),Et.texPrimary.x+Et.texPrimary.w,Et.texPrimary.y,At,_t,Et.pixelOffsetBR.x,Et.pixelOffsetTL.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+2,rn,Ht,Math.round(32*Et.bl.x),Math.round(32*(nn+Et.bl.y)),Et.texPrimary.x,Et.texPrimary.y+Et.texPrimary.h,At,_t,Et.pixelOffsetTL.x,Et.pixelOffsetBR.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+3,rn,Ht,Math.round(32*Et.br.x),Math.round(32*(nn+Et.br.y)),Et.texPrimary.x+Et.texPrimary.w,Et.texPrimary.y+Et.texPrimary.h,At,_t,Et.pixelOffsetBR.x,Et.pixelOffsetBR.y,Et.minFontScaleX,Et.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(i.isUsingAppearanceTextVertexData){const _e=i.layoutBasedTextVertexData.length/12;for(let me=0;me<_e;++me){const Ee=me*12;this.text.updateSymbolVertexData(m+me,i.layoutBasedTextVertexData[Ee+0],i.layoutBasedTextVertexData[Ee+1],i.layoutBasedTextVertexData[Ee+2],i.layoutBasedTextVertexData[Ee+3],i.layoutBasedTextVertexData[Ee+4],i.layoutBasedTextVertexData[Ee+5],i.layoutBasedTextVertexData[Ee+6],i.layoutBasedTextVertexData[Ee+7],i.layoutBasedTextVertexData[Ee+8],i.layoutBasedTextVertexData[Ee+9],i.layoutBasedTextVertexData[Ee+10],i.layoutBasedTextVertexData[Ee+11])}return i.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:_e,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,i,l,d,m,_,v){this.text.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const l=Pt(e),d=1/l;let m=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v),A=wt(1,0,0),D=wt(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:k,numIconVertices:N,numVerticalIconVertices:U}=S,Z=P>0||k>0,K=N>0,X=this.elevationFeatures[S.elevationFeatureIndex];if(X){const te=new Mt(S.tileAnchorX,S.tileAnchorY),se=.075+X.pointElevation(te);S.zOffset!==se&&(i=!0,S.zOffset=se),se!==0&&(this.hasAnyZOffset=!0);const le=X.computeSlopeNormal(te,d),_e=kr(en(),wt(0,0,1),le);Hn(A,A,_e),Hn(D,D,_e),A[2]*=l,D[2]*=l,A[0]===1&&A[1]===0&&A[2]===0&&D[0]===0&&D[1]===1&&D[2]===0||(m=m||Z,_=_||K)}if(Z&&(tb(this.text.orientationVertexArray,P,A,D),tb(this.text.orientationVertexArray,k,A,D)),K){const{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:se}=S;te>=0&&tb(this.icon.orientationVertexArray,N,A,D),se>=0&&tb(this.icon.orientationVertexArray,U,A,D)}}m||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,_,v)=>{l+=_,l>m.length&&m.resize(l);for(let S=-_;S<0;S++)m.emplace(S+l,v)},i=(m,_,v)=>{d+=_,d>m.length&&m.resize(d);for(let S=-_;S<0;S++)m.emplace(S+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,d=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:A}=_,D=_.zOffset,P=A>0;if((v>0||S>0)&&(e(this.text.zOffsetVertexArray,v,D),e(this.text.zOffsetVertexArray,S,D)),P){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:N}=_;k>=0&&i(this.icon.zOffsetVertexArray,A,D),N>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,D)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,l,d,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,l,d,m){if(!(e&&i&&l&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,v=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!v)return!1;const S=this.layers[0],A=S.layout;let D=1,P=0,k=!1;if(_){const[X,te]=A.get("icon-size-scale-range");D=xe(1,X,te)}let N=1,U=0,Z=!1;if(v){const[X,te]=A.get("text-size-scale-range");N=xe(1,X,te)}const K=new Map;if(m&&l)for(const X of l){const te=m.getImage(X,S.scope);if(te){const se=new Ks(X.toString());K.set(se.toString(),te)}}for(let X=0;X<this.symbolInstances.length;X++){const te=this.symbolInstances.get(X),se=this.featureToAppearanceIndex[te.featureIndex],le=se!==void 0?this.appearanceFeatureData[se]:void 0;if(!le)continue;const _e=le.id,me=i&&_e!==void 0?i[String(_e)]:void 0,Ee={type:"Point",id:le.id,properties:le.properties,geometry:[]},Se=S.appearances&&S.appearances.find(we=>we.isActive({globals:d,feature:Ee,canonical:e,featureState:me}));if(v){const we=A.get("text-size"),Me=A.get("text-offset").evaluate(Ee,me,e),Oe=we.evaluate(Ee,me,e),pt=A.get("text-rotate").evaluate(Ee,me,e),ot=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,ut=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,Tt=we.evaluate(Ee,{zoom:ot},e),vt=we.evaluate(Ee,{zoom:ut},e),bt=this.updateSymbolInstanceTextVertices(te,le,Se,Ee,U,e,S,N,K,me,Me,Oe,pt,Tt,vt,ot,ut,l);U+=bt.vertexOffsetDelta,Z=Z||bt.hasChanges}if(_){const we=A.get("icon-offset").evaluate(Ee,me,e),Me=A.get("icon-size").evaluate(Ee,me,e,l),Oe=A.get("icon-rotate").evaluate(Ee,me,e),pt=this.updateSymbolInstanceIconVertices(te,le,Se,Ee,P,e,l,d,S,D,me,we,Me,Oe);P+=pt.vertexOffsetDelta,k=k||pt.hasChanges}le.activeAppearance=Se}return k&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),Z&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),k||Z}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Y2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:m}of i)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z,K,X,te){const se=e.indexArray,le=e.layoutVertexArray,_e=e.globeExtVertexArray,me=e.segments.prepareSegment(4*te,le,se,this.canOverlap?_.sortKey:void 0),Ee=this.glyphOffsetArray.length,Se=me.vertexLength,we=this.allowVerticalPlacement&&v===ec.vertical?Math.PI/2:0,Me=_.text&&_.text.sections;for(let ot=0;ot<i.length;ot++){const{tl:ut,tr:Tt,bl:vt,br:bt,texPrimary:rt,texSecondary:At,pixelOffsetTL:_t,pixelOffsetBR:Ct,minFontScaleX:Et,minFontScaleY:nn,glyphOffset:rn,isSDF:Ht,sectionIndex:Wt}=i[ot],An=me.vertexLength,_n=rn[1];if(Hx(le,A.x,A.y,ut.x,_n+ut.y,rt.x,rt.y,l,Ht,_t.x,_t.y,Et,nn),Hx(le,A.x,A.y,Tt.x,_n+Tt.y,rt.x+rt.w,rt.y,l,Ht,Ct.x,_t.y,Et,nn),Hx(le,A.x,A.y,vt.x,_n+vt.y,rt.x,rt.y+rt.h,l,Ht,_t.x,Ct.y,Et,nn),Hx(le,A.x,A.y,bt.x,_n+bt.y,rt.x+rt.w,rt.y+rt.h,l,Ht,Ct.x,Ct.y,Et,nn),S){const{x:Qt,y:Nn,z:ii}=S.anchor,[Di,Qn,Zi]=S.up;Zx(_e,Qt,Nn,ii,Di,Qn,Zi),Zx(_e,Qt,Nn,ii,Di,Qn,Zi),Zx(_e,Qt,Nn,ii,Di,Qn,Zi),Zx(_e,Qt,Nn,ii,Di,Qn,Zi),ay(e.dynamicLayoutVertexArray,Qt,Nn,ii,we)}else ay(e.dynamicLayoutVertexArray,A.x,A.y,A.z,we);if(K){const Qt=At||rt;$x(e.iconTransitioningVertexArray,Qt.x,Qt.y),$x(e.iconTransitioningVertexArray,Qt.x+Qt.w,Qt.y),$x(e.iconTransitioningVertexArray,Qt.x,Qt.y+Qt.h),$x(e.iconTransitioningVertexArray,Qt.x+Qt.w,Qt.y+Qt.h)}se.emplaceBack(An,An+1,An+2),se.emplaceBack(An+1,An+2,An+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rn[0]),ot!==i.length-1&&Wt===i[ot+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,_,_.index,{},N,U,Z,Me&&Me[Wt],this.worldview)}const Oe=te-i.length;Oe!==0&&this._addNullVertices(Oe,le,l,S,_e,e,K,me,se);const pt=S?S.anchor:A;e.placedSymbolArray.emplaceBack(pt.x,pt.y,pt.z,A.x,A.y,Ee,this.glyphOffsetArray.length-Ee,Se,D,P,A.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],v,0,0,0,k,0),e.symbolInstanceIndices.push(X)}_addNullVertices(e,i,l,d,m,_,v,S,A){for(let D=0;D<e;D++){for(let k=0;k<4;k++)Hx(i,0,0,0,0,0,0,l,!1,0,0,0,0),d&&Zx(m,0,0,0,0,0,0),ay(_.dynamicLayoutVertexArray,0,0,0,0),v&&$x(_.iconTransitioningVertexArray,0,0);const P=S.vertexLength;A.emplaceBack(P,P+1,P+2),A.emplaceBack(P+1,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,l,d,m,_,v){e.emplaceBack(i,l,d,m,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,l,d,m,_,v){const S=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),A=S.vertexLength,D=v.tileAnchorX,P=v.tileAnchorY;for(let N=0;N<4;N++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Mt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Mt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Mt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Mt(e.x1,e.y2)),S.vertexLength+=4;const k=l.indexArray;k.emplaceBack(A,A+1),k.emplaceBack(A+1,A+2),k.emplaceBack(A+2,A+3),k.emplaceBack(A+3,A),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,d,m,_){for(let v=d;v<m;v++){const S=l.get(v),A=this.getSymbolInstanceTextSize(e,_,i,v);this._addCollisionDebugVertices(S,A,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,l,d,m,_){for(let v=d;v<m;v++){const S=l.get(v),A=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(S,A,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bw(Md,h2.members,nl),this.iconCollisionBox=new Bw(Md,h2.members,nl);const d=ny(this.iconSizeData,e),m=ny(this.textSizeData,e,l);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(m,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,l,d){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:d),_=Cw(this.textSizeData,e,m)/ha;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,l){const d=this.icon.placedSymbolArray.get(l),m=Cw(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,l,d){e.emplaceBack(i,-l,-l,d),e.emplaceBack(i,l,-l,d),e.emplaceBack(i,l,l,d),e.emplaceBack(i,-l,l,d)}_updateTextDebugCollisionBoxes(e,i,l,d,m,_,v){for(let S=d;S<m;S++){const A=l.get(S),D=this.getSymbolInstanceTextSize(e,_,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,A.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,l,d,m,_,v){for(let S=d;S<m;S++){const A=l.get(S),D=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,A.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,l,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=ny(this.iconSizeData,e,d),_=ny(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,l),this._updateTextDebugCollisionBoxes(_,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,l),this._updateIconDebugCollisionBoxes(m,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,d),this._updateIconDebugCollisionBoxes(m,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,d,m,_,v,S,A){const D={};if(i<l){const{x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(i);D.textBox={x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.textFeatureIndex=_e}if(d<m){const{x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(d);D.verticalTextBox={x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.verticalTextFeatureIndex=_e}if(_<v){const{x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(_);D.iconBox={x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.iconFeatureIndex=_e}if(S<A){const{x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(S);D.verticalIconBox={x1:P,y1:k,x2:N,y2:U,padding:Z,projectedAnchorX:K,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.verticalIconFeatureIndex=_e}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),d=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),d=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const S=this.symbolInstances.get(v);d.push(0|Math.round(i*S.tileAnchorX+l*S.tileAnchorY)),m.push(S.featureIndex)}return _.sort((v,S)=>d[v]-d[S]||m[S]-m[v]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:A}=l;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&i<this.elevationFeatures.length&&(l=this.elevationFeatures[i]),l}}function K2(r,e){return e.replace(/{([^{}]+)}/g,(i,l)=>l in r?String(r[l]):"")}let Q2,J2,Fw;Bt(nb,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),nb.addDynamicAttributes=ay;class eI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:va,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(eI,"FormatSectionOverride",{omit:["defaultValue"]});const Vw=()=>Fw||(Fw={layout:Q2||(Q2=new wr({"symbol-placement":new Ot(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Ze.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ot(Ze.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ot(Ze.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ot(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ot(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(Ze.layout_symbol["icon-size"]),"icon-size-scale-range":new Ot(Ze.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Xt(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(Ze.layout_symbol["icon-image"]),"icon-image-use-theme":new Ot({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Xt(Ze.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(Ze.layout_symbol["icon-offset"]),"icon-anchor":new Xt(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(Ze.layout_symbol["text-field"]),"text-font":new Xt(Ze.layout_symbol["text-font"]),"text-size":new Xt(Ze.layout_symbol["text-size"]),"text-size-scale-range":new Ot(Ze.layout_symbol["text-size-scale-range"]),"text-max-width":new Xt(Ze.layout_symbol["text-max-width"]),"text-line-height":new Xt(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(Ze.layout_symbol["text-justify"]),"text-radial-offset":new Xt(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(Ze.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(Ze.layout_symbol["text-rotate"]),"text-padding":new Ot(Ze.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Ze.layout_symbol["text-keep-upright"]),"text-transform":new Xt(Ze.layout_symbol["text-transform"]),"text-offset":new Xt(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ot(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Ze.layout_symbol["text-optional"]),visibility:new Ot(Ze.layout_symbol.visibility)})),paint:J2||(J2=new wr({"icon-opacity":new Xt(Ze.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(Ze.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(Ze.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(Ze.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(Ze.paint_symbol["icon-color"]),"icon-halo-color":new Xt(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Ze.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ot(Ze.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(Ze.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(Ze.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(Ze.paint_symbol["text-color"],{runtimeType:ie,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Xt(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(Ze.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Ze.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ot(Ze.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ot(Ze.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ot(Ze.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ot(Ze.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(Ze.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Fw);class ib extends za{constructor(e,i,l,d){super(e,Vw(),i,l,d,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Xe([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(d=>{d.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const m of l)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,l,d){return this._saturation===e&&this._contrast===i&&this._brightnessMin===l&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(m,_,v,S){m=dr(m),_=Ei(_);const A=Je(),D=m/3,P=1-2*D,k=[P,D,D,0,D,P,D,0,D,D,P,0,0,0,0,1],N=.5-.5*_,U=S-v;return ft(A,[U,0,0,0,0,U,0,0,0,0,U,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,N,N,N,1]),ft(A,A,k),A})(e,i,l,d),this._saturation=e,this._contrast=i,this._brightnessMin=l,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,l,d){const m=this.layout.get(e).evaluate(i,{},l,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||bh(_.value)||!m?m:K2(i.properties,m)}getAppearanceValueAndResolveTokens(e,i,l,d,m){const _=e.getProperty(i);if(!_)return;const v=_.evaluate(l,{},d,m),S=e.getUnevaluatedProperties()._values[i];return S.isDataDriven()||bh(S.value)||!v||typeof v!="string"?v:K2(l.properties,v)}createBucket(e){return new nb(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Vw().paint.overridableProperties){if(!ib.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new eI(i),d=new zf(l,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Da("source",d):new wa("composite",d,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ou(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&ib.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),d=Vw().paint.properties[i];let m=!1;const _=v=>{for(const S of v)if(d.overrides&&d.overrides.hasOverride(S))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Rs)_(l.value.value.sections);else if(l.value.kind==="source"){const v=A=>{m||(A instanceof Xo&&Is(A.value)===Gt?_(A.value.sections):A instanceof mn?_(A.sections):A.eachChild(v))},S=l.value;S._styleExpression&&v(S._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,l){return{config:new z(this,{zoom:i,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let tI,nI,iI,rI;var jw=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function rb(r,e,i,l,d,m,_,v){const S=[r,e,1,i,l,1,d,m,1],A=[_,v,1],D=oe([],S),[P,k,N]=Bs(A,A,D);return he(S,S,[P,0,0,0,k,0,0,0,N])}function sI(r,e,i,l,d,m,_,v){const S=(function(A,D,P,k,N,U,Z,K){const X=rb(0,0,1,0,1,1,0,1),te=rb(A,D,P,k,N,U,Z,K);return he(te,te,oe([],X))})(r,e,i,l,d,m,_,v);return[S[2]/S[8]/jt,S[5]/S[8]/jt]}function sb(r){return[r[0],Math.min(Math.max(r[1],-85.051129),ke)]}class aI extends pl{constructor(e,i,l,d){super(),this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Mo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Co(this.map._requestManager.transformRequest(this.url,us.Image),(l,d)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Fc(l)):d&&(this.image=d instanceof HTMLImageElement?Ua.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Px(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Px||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],l=e[0][1];for(const m of e)m[1]>l&&(l=m[1]),m[1]<i&&(i=m[1]);const d=(l+i)/2;if(d>ke?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(qt.fromLngLat);this.tileID=(function(_){let v=1/0,S=1/0,A=-1/0,D=-1/0;for(const Z of _)v=Math.min(v,Z.x),S=Math.min(S,Z.y),A=Math.max(A,Z.x),D=Math.max(D,Z.y);const P=Math.max(A-v,D-S),k=Math.max(0,Math.floor(-Math.log2(P))),N=Math.pow(2,k);let U=Math.floor((v+A)/2*N);return U>1&&(U-=1),new Ac(k,U,Math.floor((S+D)/2*N))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Mo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Px||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const X in this.tiles){const te=this.tiles[X];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Vx(new Ac(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(X){const te=X[1].x-X[0].x,se=X[1].y-X[0].y,le=X[2].x-X[1].x,_e=X[2].y-X[1].y,me=X[3].x-X[2].x,Ee=X[3].y-X[2].y,Se=X[0].x-X[3].x,we=X[0].y-X[3].y,Me=te*_e-le*se,Oe=le*Ee-me*_e,pt=me*we-Se*Ee,ot=Se*se-te*we;return Me>0&&Oe>0&&pt>0&&ot>0||Me<0&&Oe<0&&pt<0&&ot<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Vx(this.tileID,this.map.transform.projection),[m,_,v,S]=this.coordinates.map(X=>{const te=d.projection.project(X[0],X[1]);return H2(d,te)._round()});this.perspectiveTransform=sI(m.x,m.y,_.x,_.y,v.x,v.y,S.x,S.y);const A=this._boundsArray=new Tc;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(_.x,_.y,jt,0),A.emplaceBack(S.x,S.y,0,jt),A.emplaceBack(v.x,v.y,jt,jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,jw.members),this.boundsSegments=mr.simpleSegment(0,0,4,2);const D=[],P=[sb((k=this.coordinates)[0]),sb(k[1]),sb(k[2]),sb(k[3])];var k;const[N,U,Z,K]=(function(X){let te=X[0][0],se=te,le=X[0][1],_e=le;for(let me=1;me<X.length;me++)X[me][0]<te?te=X[me][0]:X[me][0]>se&&(se=X[me][0]),X[me][1]<le?le=X[me][1]:X[me][1]>_e&&(_e=X[me][1]);return[te,le,se-te,_e-le]})(P);{const X=new Tc,[te,se,le,_e]=(function(bt){let rt=bt[0].x,At=rt,_t=bt[0].y,Ct=_t;for(let Et=1;Et<bt.length;Et++)bt[Et].x<rt?rt=bt[Et].x:bt[Et].x>At&&(At=bt[Et].x),bt[Et].y<_t?_t=bt[Et].y:bt[Et].y>Ct&&(Ct=bt[Et].y);return[rt,_t,At-rt,Ct-_t]})(l),me=bt=>[(bt.x-te)/le,(bt.y-se)/_e],[Ee,Se,we,Me]=l.map(me),Oe=(function(bt,rt,At,_t,Ct,Et,nn,rn){const Ht=rb(0,0,1,0,1,1,0,1);return he(Ht,Ht,oe([],rb(bt,rt,At,_t,Ct,Et,nn,rn)))})(Ee[0],Ee[1],Se[0],Se[1],we[0],we[1],Me[0],Me[1]);this.elevatedGlobePerspectiveTransform=sI(Ee[0],Ee[1],Se[0],Se[1],we[0],we[1],Me[0],Me[1]);const pt=(bt,rt)=>{D.push(bt.lng);const At=Math.round((bt.lng-N)/Z*jt),_t=Math.round((bt.lat-U)/K*jt),Ct=me(rt),Et=Bs([],[Ct[0],Ct[1],1],Oe),nn=Math.round(Et[0]/Et[2]*jt),rn=Math.round(Et[1]/Et[2]*jt);X.emplaceBack(At,_t,nn,rn)},ot=l[3].x-l[0].x,ut=l[3].y-l[0].y,Tt=l[2].x-l[1].x,vt=l[2].y-l[1].y;for(let bt=0;bt<65;bt++){const rt=bt/64,At=[l[0].x+rt*ot,l[0].y+rt*ut],_t=[l[1].x+rt*Tt,l[1].y+rt*vt],Ct=_t[0]-At[0],Et=_t[1]-At[1];for(let nn=0;nn<65;nn++){const rn=nn/64,Ht={x:At[0]+Ct*rn,y:At[1]+Et*rn};pt(i.projection.unproject(Ht.x,Ht.y),Ht)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(X,jw.members)}{this.maxLongitudeTriangleSize=0;let X=[],te=new xs;const se=(le,_e,me)=>{te.emplaceBack(le,_e,me);const Ee=D[le],Se=D[_e],we=D[me],Me=Math.min(Math.min(Ee,Se),we),Oe=Math.max(Math.max(Ee,Se),we)-Me;Oe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Oe),X.push(Me+Oe/2)};for(let le=0;le<64;le++)for(let _e=0;_e<64;_e++){const me=65*le+_e,Ee=me+1,Se=me+65,we=Se+1;se(me,Se,Ee),se(Ee,Se,we)}[X,te]=(function(le,_e){const me=Array.from({length:le.length},(we,Me)=>Me);me.sort((we,Me)=>le[we]-le[Me]);const Ee=[],Se=new xs;for(let we=0;we<me.length;we++){const Me=me[we];Ee.push(le[Me]);const Oe=3*Me,pt=Oe+1;Se.emplaceBack(_e.uint16[Oe],_e.uint16[pt],_e.uint16[pt+1])}return[Ee,Se]})(X,te),this.elevatedGlobeTrianglesCenterLongitudes=X,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(te)}this.elevatedGlobeSegments=mr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/jt,0,K/jt,0,0,U,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof Px||(this.texture?this.texture.update(this.image):(this.texture=new hw(i,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let d=(m=e+180)+360*Math.round((l[0]-m)/360);var m;const _=new mr,v=(P,k)=>{_.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-d)<=S){const P=_i(l,0,l.length,d+S);return P===l.length||v(P,Ni(l,P+1,l.length,d+360-S)-P),_}d<l[0]&&(d+=360);const A=Ni(l,0,l.length,d-S);if(A===l.length)return v(0,l.length),_;v(0,A-0);const D=_i(l,A+1,l.length,d+S);return D!==l.length&&v(D,l.length-D),_}}const Uw=1024,s3=(Math.pow(Uw,2)-1)/268170240;class oI extends za{constructor(e,i,l,d){super(e,{layout:iI||(iI=new wr({visibility:new Ot(Ze.layout_raster.visibility)})),paint:rI||(rI=new wr({"raster-opacity":new Ot(Ze.paint_raster["raster-opacity"]),"raster-color":new Ih(Ze.paint_raster["raster-color"]),"raster-color-mix":new Ot(Ze.paint_raster["raster-color-mix"]),"raster-color-range":new Ot(Ze.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ot(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Ze.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Ze.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Ze.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ot(Ze.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ot(Ze.paint_raster["raster-array-band"]),"raster-elevation":new Ot(Ze.paint_raster["raster-elevation"]),"raster-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof aI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(d)||l===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=cm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:d}],resolution:Uw}),this.colorRampTexture=null,this._curRampRange=[l,d])}is3D(e){return this.paint.get("raster-elevation")>0}}let lI,cI,uI,hI,dI;class fI extends za{constructor(e,i,l,d){super(e,{layout:lI||(lI=new wr({visibility:new Ot(Ze["layout_raster-particle"].visibility)})),paint:cI||(cI=new wr({"raster-particle-array-band":new Ot(Ze["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ot(Ze["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ih(Ze["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ot(Ze["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ot(Ze["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ot(Ze["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ot(Ze["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ot(Ze["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,d),this._updateColorRamp(),this.lastInvalidatedAt=Ua.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=cm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ua.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class a3 extends za{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Gw(r,e,i){const l=[0,0,1],d=Tn([]);return Oi(d,d,i?-ai(r)+Math.PI:ai(r)),ri(d,d,-ai(e)),Hn(l,l,d),Gn(l,l)}const pI={None:0,Model:1,Symbol:2,FillExtrusion:4};class ab{constructor(e,i,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),i!=null&&i.__line__&&(this.line=i.__line__)}}function qw(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class mI{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class gI{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Wl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,l=this.instancedDataArray.float32;let d=Math.floor(l[i+2]);const m=1.05*(l[i+2]-d);return d/=100,[l[i]%1*1.05,l[i+1]%1*1.05,m,d]}tileCoordinatesForInstance(e){const i=16*e,l=this.instancedDataArray.float32;let d=l[i+0];return d=d>jt?d-jt:d,new Mt(Math.trunc(d),Math.trunc(l[i+1]))}translationForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+4],l[i+5],l[i+6]]}rotationScaleForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+7],l[i+8],l[i+9],l[i+10],l[i+11],l[i+12],l[i+13],l[i+14],l[i+15]]}transformForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+7],l[i+8],l[i+9],l[i+4],l[i+10],l[i+11],l[i+12],l[i+5],l[i+13],l[i+14],l[i+15],l[i+6],0,0,0,1]}}class Hw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.tileToMeter=Pt(l);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const _=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?i.elevationFeatures:void 0;for(const{feature:v,id:S,index:A,sourceLayerIndex:D}of e){const P=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),k=Vn(v,m);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,l))continue;const N={id:P,sourceLayerIndex:D,index:A,geometry:m?k.geometry:Mn(v,l,d),properties:v.properties,type:v.type,patterns:{}},U=this.addFeature(N,N.geometry,k,_,l);U&&i.featureIndex.insert(v,N.geometry,A,D,this.index,this.instancesPerModel[U].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let l=0;for(const d of this.modelUris){const m=e.getModel(d,i);if(!m)continue;const _=this.instancesPerModel[d];if(_){const v=.5*Kn(m.aabb.max,m.aabb.min)*_.maxScale+_.maxXYTranslationDistance,S=Math.min(jt,Math.max(v/this.tileToMeter,256));l=Math.max(S,l)}}return l}update(e,i,l,d){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const v in e)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],e[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const d of l.features){const m=this.layers[0],_=d.feature,v=this.canonical,S=m.paint.get("model-rotation").evaluate(_,{},v),A=m.paint.get("model-scale").evaluate(_,{},v),D=m.paint.get("model-translation").evaluate(_,{},v);ur(d.rotation,S)&&ur(d.scale,A)&&ur(d.translation,D)||(this.evaluate(d,d.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,i,l,d){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const m=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(h(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],A=S.instancedDataArray;for(const D of S.features){const P=D.instancedDataOffset,k=D.instancedDataCount;for(let N=0;N<k;N++){const U=16*(N+P);let Z=A.float32[U+0];const K=Z>jt;Z=K?Z-jt:Z;const X=Math.floor(Z),te=Math.floor(A.float32[U+1]);let se=!1;for(const le of this.activeReplacements)if(!jg(le,l,pI.Model,d)&&!(le.min.x>X||X>le.max.x||le.min.y>te||te>le.max.y)&&(se=ce(q(X,te,e.canonical,le.footprintTileId.canonical),le.footprint),se))break;A.float32[U]=se?Z+jt:Z,_=_||se!==K}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,Cz.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)i.removeModel(l,"",!0)}addFeature(e,i,l,d,m){const _=this.layers[0],v=_.layout.get("model-id"),S=_.layout.get("model-allow-density-reduction"),A=v.evaluate(l,{},this.canonical);if(!A)return Pn(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),A;(qw(A,!1)||this.styleDefinedModelURLs[A]!==void 0)&&(this.modelUris.includes(A)||this.modelUris.push(A)),this.instancesPerModel[A]||(this.instancesPerModel[A]=new gI);const D=this.instancesPerModel[A],P=D.instancedDataArray,k=new mI(l,P.length);let N;d&&(N=ca.getElevationFeature(e,d));for(const U of i)for(const Z of U){if(Z.x<0||Z.x>=jt||Z.y<0||Z.y>=jt)continue;if(this.lookupDim!==0&&S){const X=(this.lookupDim-1)/jt,te=this.lookupDim*(Z.y*X|0)+Z.x*X|0;if(this.lookup){if(this.lookup[te]!==0)continue;this.lookup[te]=1}}this.instanceCount++;const K=P.length;if(P.resize(K+1),d){D.instancesRoadElevation||(D.instancesRoadElevation=[]);const X=N?N.pointElevation(new Mt(Z.x,Z.y)):0;D.instancesRoadElevation.push(X)}D.instancesEvaluatedElevation.push(0),P.float32[16*K]=Z.x,P.float32[16*K+1]=Z.y}return k.instancedDataCount=D.instancedDataArray.length-k.instancedDataOffset,k.instancedDataCount>0&&(e.id&&(D.idToFeaturesIndex[e.id]=D.features.length),D.features.push(k),this.evaluate(k,{},D,!1)),A}getModelUris(){return this.modelUris}evaluate(e,i,l,d){const m=this.layers[0],_=e.feature,v=this.canonical,S=e.rotation=m.paint.get("model-rotation").evaluate(_,i,v),A=e.scale=m.paint.get("model-scale").evaluate(_,i,v),D=e.translation=m.paint.get("model-translation").evaluate(_,i,v),P=Object.assign({},m.paint.get("model-color").evaluate(_,i,v));P.a=m.paint.get("model-color-mix-intensity").evaluate(_,i,v);const k=[];this.maxVerticalOffset<D[2]&&(this.maxVerticalOffset=D[2]);const N=D[0]*D[0]+D[1]*D[1],U=N>0?Math.sqrt(N):0;l.maxScale=Math.max(Math.max(l.maxScale,A[0]),Math.max(A[1],A[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,U),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),qA(k,S,A);const Z=Math.round(100*P.a)+P.b/1.05;for(let K=0;K<e.instancedDataCount;++K){const X=e.instancedDataOffset+K,te=16*X,se=l.instancedDataArray.float32;let le=0;d&&(le=se[te+6]-l.instancesEvaluatedElevation[X]);const _e=0|se[te+1];se[te]=(0|se[te])+P.r/1.05,se[te+1]=_e+P.g/1.05,se[te+2]=Z,se[te+3]=1/(v.z>10?this.tileToMeter:Pt(v,_e)),se[te+4]=D[0],se[te+5]=D[1],se[te+6]=D[2]+(l.instancesRoadElevation?l.instancesRoadElevation[X]:0)+le,se[te+7]=k[0],se[te+8]=k[1],se[te+9]=k[2],se[te+10]=k[4],se[te+11]=k[5],se[te+12]=k[6],se[te+13]=k[8],se[te+14]=k[9],se[te+15]=k[10],l.instancesEvaluatedElevation[X]=D[2]}}}let _I,yI;Bt(Hw,"ModelBucket",{omit:["layers"]}),Bt(gI,"PerModelAttributes"),Bt(mI,"ModelFeature");class oy{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const d=l||e.findDEMTileFor(i);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,v=1<<i.canonical.z-_.canonical.z;return new oy(d,m.dim/jt/v,[(i.canonical.x/v-_.canonical.x)*m.dim,(i.canonical.y/v-_.canonical.y)*m.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1];return new Mt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,i,l,d){const m=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],v=Math.floor(m),S=Math.floor(_),A=this._dem;return d=!!d,l?Cn(Cn(A.get(v,S,d),A.get(v,S+1,d),_-S),Cn(A.get(v+1,S,d),A.get(v+1,S+1,d),_-S),m-v):A.get(v,S,d)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*$e(1,e)*this._dem.stride}}const $w=new Float32Array(262144),Xg=new Uint8Array(262144);function xI(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,xI(i));return e}function vI(r,e,i){if(r.meshes)for(const l of r.meshes){if(l.aabb.min[0]===1/0)continue;const d=Ii.applyTransform(l.aabb,r.globalMatrix);i.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(r.children)for(const l of r.children)vI(l,e,i)}const bI=["","wall","door","roof","window","lamp","logo"];class wI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:xI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ii([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ii([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Ii.applyTransformFast(l.aabb,this.node.globalMatrix),i.encapsulate(l.transformedAabb)),e++;this.aabb=i}return this.aabb}}class ob{constructor(e,i,l,d,m,_,v,S){this.id=l,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=J_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=J_.HasMapboxMeshFeatures),m&&(this.modelTraits|=J_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new wI(A)),vI(A,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const l of this.getNodesInfo()){const d=l.node;d.footprint&&i.push({footprint:d.footprint,id:e})}}updateAppearances(e,i,l,d){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const l=i?this.stateDependentLayers:this.layers;if(!no(e,this.states))for(const d of l)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const d=l.node;this.uploaded?this.updatePbrBuffer(d):pw(d,e,!0)}for(const l of i)U0(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(e,i,l){const d=e.transform.projectionOptions,m=e.style.getBrightness(),_=this.brightness!==m;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Wx(l.paint.get("model-color").value,_)||Wx(l.paint.get("model-color-mix-intensity").value,_)||Wx(l.paint.get("model-roughness").value,_)||Wx(l.paint.get("model-emissive-strength").value,_)||Wx(l.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=m;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),d=this.id.canonical;for(const m of l){const _=m.feature;m.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},d),m.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},d)}}evaluate(e,i){const l=this.getNodesInfo();for(const d of l){if(!d.node.meshes)continue;const m=d.feature,_=i&&i[m.id];if(no(_,d.state))continue;d.state=structuredClone(_);const v=d.node.meshes&&d.node.meshes[0].featureData,S=d.evaluatedColor[2],A=d.evaluatedRMEA[2],D=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let P=0;P<bI.length;P++){const k=bI[P];k.length&&(m.properties.part=k);const N=e.paint.get("model-color").evaluate(m,_,D).toPremultipliedRenderColor(null),U=e.paint.get("model-color-mix-intensity").evaluate(m,_,D);d.evaluatedColor[P]=[N.r,N.g,N.b,U],d.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(m,_,D),d.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(m,_,D),d.evaluatedRMEA[P][3]=N.a,d.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,_,D),!d.hasTranslucentParts&&N.a<1&&(d.hasTranslucentParts=!0)}delete m.properties.part,l3(d,S!==d.evaluatedColor[2]||A!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,_,D);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,_,D),d.evaluatedScale=e.paint.get("model-scale").evaluate(m,_,D),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,l,d){const m=e.findDEMTileFor(l);if(m&&(m.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=oy.create(e,l,m);if(!_)return;this.modelTraits&J_.HasMapboxMeshFeatures&&this.updateDEM(e,_,l,d);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const A=S.footprint.vertices;let D=_.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)D=Math.min(D,_.getElevationAt(A[P].x,A[P].y,!0,!0));S.elevation=D}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,l,d){let m=i._dem._modifiedForSources[d];if(m===void 0&&(i._dem._modifiedForSources[d]=[],m=i._dem._modifiedForSources[d]),m.includes(l.canonical))return;const _=i._dem.dim;m.push(l.canonical);let v=!1;for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.grid)continue;const D=A.footprint.grid,P=i.tileCoordToPixel(D.min.x,D.min.y),k=i.tileCoordToPixel(D.max.x,D.max.y),N=Math.min(Math.min(_-k.y,P.x),Math.min(P.y,_-k.x));if(N<0)continue;const U=xe(N,2,5);let Z=Math.max(0,P.x-U),K=Math.max(0,P.y-U),X=Math.min(k.x+U,_-1),te=Math.min(k.y+U,_-1);for(let me=K;me<=te;++me)for(let Ee=Z;Ee<=X;++Ee)Xg[me*_+Ee]=255;let se=0,le=0;for(let me=0;me<D.cellsY;++me)for(let Ee=0;Ee<D.cellsX;++Ee){if(!D.cells[me*D.cellsX+Ee])continue;const Se=i.tileCoordToPixel(D.min.x+Ee/D.xScale,D.min.y+me/D.yScale),we=i.tileCoordToPixel(D.min.x+(Ee+1)/D.xScale,D.min.y+(me+1)/D.yScale);for(let Me=Se.y;Me<=Math.min(we.y+1,_-1);++Me)for(let Oe=Se.x;Oe<=Math.min(we.x+1,_-1);++Oe)Xg[Me*_+Oe]===255&&(Xg[Me*_+Oe]=0,se+=i.getElevationAtPixel(Oe,Me),le++)}const _e=se/le;Z=Math.max(1,P.x-U),K=Math.max(1,P.y-U),X=Math.min(k.x+U,_-2),te=Math.min(k.y+U,_-2),v=!0;for(let me=K;me<=te;++me)for(let Ee=Z;Ee<=X;++Ee)Xg[me*_+Ee]===0&&($w[me*_+Ee]=i._dem.set(Ee,me,_e));for(let me=1;me<U;++me){Z=Math.max(1,P.x-me),K=Math.max(1,P.y-me),X=Math.min(k.x+me,_-2),te=Math.min(k.y+me,_-2);for(let Ee=K;Ee<=te;++Ee)for(let Se=Z;Se<=X;++Se){const we=Ee*_+Se;if(Xg[we]===255){let Me=0,Oe=0,pt=-1,ot=-1;for(let ut=-1;ut<=1;++ut)for(let Tt=-1;Tt<=1;++Tt){const vt=(Ee+ut)*_+Se+Tt;if(Xg[vt]>=me)continue;const bt=$w[vt],rt=Math.abs(bt);rt>Oe&&(Me=bt,Oe=rt,pt=Tt,ot=ut)}if(Oe>.1){const ut=1-(me+.5*Math.abs(pt*ot))/U;let Tt=i._dem.get(Se,Ee)+Me*ut;const vt=i._dem.get(Se+pt,Ee+ot),bt=i._dem.get(Se-pt,Ee-ot,!0);(Tt-vt)*(Tt-bt)>0&&(Tt=(vt+bt)/2),$w[we]=i._dem.set(Se,Ee,Tt),Xg[we]=me}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ua.now())}setFilter(e){this.filter=e?Kp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Pi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)U0(i.node),mw(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());for(const d of this.getNodesInfo()){const m=d.node.footprint;d.hiddenByReplacement=!!m&&!l.find(_=>_.footprint===m)}}getHeightAtTileCoord(e,i){const l=[],d=[0,0,0],m=Xe([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],S=v.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};st(m,_.node.globalMatrix),d[0]=e,d[1]=i,cr(d,d,m);const A=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Hg|0,D=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Hg|0)*Hg+Math.min(63,A),P=v.heightmap[D];if(!(P<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:P,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Mt(e,i),new Mt(e,i),l),l.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Wx(r,e){return r instanceof Da&&!r.isLightConstant&&e}function o3(r,e,i,l,d,m,_,v){let S=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,D=240&e|(240&e)>>4;i[3]>0&&(S=Cn(S,255*i[0],i[3]),A=Cn(A,255*i[1],i[3]),D=Cn(D,255*i[2],i[3]));const P=S<<8|A,k=D<<8|Math.floor(255*l[3]),N=(function(me){const Ee=xe(me,0,2);return Math.min(Math.round(.5*Ee*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],U=xe(d[0],0,1),Z=xe(d[1],0,1),K=xe(d[2],0,1),X=xe(d[3],0,1);let te,se,le,_e;if(U!==Z&&_!==m&&Z!==U){const me=_-m;se=1/(me*(Z-U)),le=-(m+me*U)/(me*(Z-U));const Ee=xe(d[4],-1,1);_e=Math.pow(10,Ee),te=255*K<<8|255*X}else te=65535,se=0,le=1,_e=1;if(r.emplaceBack(P,k,N,te,se,le,_e),v){const me=v.length;v.clear();for(let Ee=0;Ee<me;Ee++)v.emplaceBack(P,k,N,te,se,le,_e)}}function l3(r,e,i){const l=r.node;let d=0;const m=i&J_.HasMeshoptCompression;for(const _ of l.meshes){if(l.lights&&l.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new Lh,_.featureArray.reserve(_.featureData.length);let v=e;for(const S of _.featureData){const A=m?65535&S:S>>16&65535,D=m?S>>16&65535:65535&S,P=(15&D)<8?15&D:0,k=r.evaluatedRMEA[P],N=r.evaluatedColor[P],U=r.emissionHeightBasedParams[P];let Z;if(v&&P===2&&l.lights&&(Z=new Lh,Z.resize(10*l.lights.length)),o3(_.featureArray,A,N,k,U,_.aabb.min[2],_.aabb.max[2],Z),Z&&v){v=!1;const K=l.meshes[l.lightMeshIndex];K.featureArray=Z,K.featureArray._trim()}}_.featureArray._trim(),d++}}Bt(ob,"Tiled3dModelBucket",{omit:["layers"]}),Bt(wI,"Tiled3dModelFeature");const c3=["id","tile","layer","source","sourceLayer","state"];class Yg{constructor(e,i,l,d,m){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=d,this.properties=e?e.properties:{},this.id=m}clone(){const e=new Yg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of c3)this[i]!==void 0&&(e[i]=this[i]);return e}}class Kg extends pl{constructor(e,i,l,d){super(),this.id=e,this.type="model",this.models=[],this._options=i,this._modelsInfo=new Map}loadGLTFFromURI(e){return VA(this.map._requestManager.transformRequest(e,us.Model).url)}load(){for(const e in this._options.models){const i=this._options.models[e],l=this._modelsInfo.get(e);if(l){l.modelSpec=i;const d=l.model;d&&(d.position=i.position!=null?new ge(i.position[0],i.position[1]):new ge(0,0),d.orientation=i.orientation!=null?i.orientation:[0,0,0],Kg.applyModelSpecification(d,i),d.computeBoundsAndApplyParent(),this.models.push(d))}else this._modelsInfo.set(e,{modelSpec:i,model:null}),this.loadGLTFFromURI(i.uri).then(d=>{if(!d)return;const m=this._modelsInfo.get(e);if(!m)return;const _=_w(d),v=m.modelSpec,S=new HA(e,v.uri,v.position,v.orientation,_);Kg.applyModelSpecification(S,v),S.computeBoundsAndApplyParent(),this.models.push(S),m.model=S,this.loaded()&&this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(d=>{this.fire(new Fc(new Error(`Could not load model ${e} from ${i.uri}: ${d.message}`)))})}this.loaded()&&this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,i){i.nodeOverrides&&Kg.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Kg.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(l=>typeof l=="string")){e.nodeOverrideNames=[];for(const l of i)e.nodeOverrideNames.push(l)}else Object.entries(i).forEach(([l,d])=>{const m={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const _=d.orientation;_&&(m.orientation=_)}e.nodeOverrides.set(l,m)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(l=>typeof l=="string")){e.materialOverrideNames=[];for(const l of i)e.materialOverrideNames.push(l)}else Object.entries(i).forEach(([l,d])=>{const m={color:new Si(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=d["model-color"];_!==void 0&&(m.color.r=_[0],m.color.g=_[1],m.color.b=_[2]);const v=d["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);const S=d["model-emissive-strength"];S!==void 0&&(m.emissionStrength=S);const A=d["model-opacity"];A!==void 0&&(m.opacity=A),e.materialOverrides.set(l,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=ql(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const i=new Map;for(const l in e){const d=e[l];if(this._modelsInfo.has(l)){const m=this._modelsInfo.get(l);m&&m.modelSpec.uri===d.uri&&i.set(l,m)}}this._modelsInfo=i,this._options.models=e,this.load()}}function Zw(r,e,i,l){const d=1<<r.z;e.lat=xt((l/jt+r.y)/d),e.lng=lt((i/jt+r.x)/d)}function u3(r,e,i,l){const d=r.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let m=Number.MAX_VALUE;const _=d.node,v=i.tile,S=l.calculatePosMatrix(v.tileID.toUnwrapped(),l.worldSize),A=d.evaluatedScale;let D=0;l.elevation&&_.elevation&&(D=_.elevation*l.elevation.exaggeration()),ht(S,S,[(_.anchor?_.anchor[0]:0)*(A[0]-1),(_.anchor?_.anchor[1]:0)*(A[1]-1),D]),Ft(S,S,A);const P=i.queryGeometry,k=P.isPointQuery()?P.screenBounds:P.screenGeometry,N=function(Z){const K=ft([],S,Z.globalMatrix);ft(K,l.expandedFarZProjMatrix,K);for(let X=0;X<Z.meshes.length;++X){const te=Z.meshes[X];if(X===Z.lightMeshIndex)continue;const se=fw(k,l,K,te.aabb);se!=null&&(m=Math.min(se,m))}if(Z.children)for(const X of Z.children)N(X)};if(N(_),m===Number.MAX_VALUE)return;const U=new ge(0,0);return Zw(v.tileID.canonical,U,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:m,position:U,feature:d.feature}}const h3={circle:class extends za{constructor(r,e,i,l){super(r,{layout:i0||(i0=new wr({"circle-sort-key":new Xt(Ze.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ot(Ze.layout_circle["circle-elevation-reference"]),visibility:new Ot(Ze.layout_circle.visibility)})),paint:r0||(r0=new wr({"circle-radius":new Xt(Ze.paint_circle["circle-radius"]),"circle-color":new Xt(Ze.paint_circle["circle-color"]),"circle-blur":new Xt(Ze.paint_circle["circle-blur"]),"circle-opacity":new Xt(Ze.paint_circle["circle-opacity"]),"circle-translate":new Ot(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(Ze.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ot(Ze.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}createBucket(r){return new Xa(r)}queryRadius(r){const e=r;return ou("circle-radius",this,e)+ou("circle-stroke-width",this,e)+om(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,l,d,m,_,v){const S=n0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return ax(r,l,m,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const l=c0(this);return{config:new z(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends za{createBucket(r){return new h0(r)}constructor(r,e,i,l){super(r,{layout:lx||(lx=new wr({visibility:new Ot(Ze.layout_heatmap.visibility)})),paint:d0||(d0=new wr({"heatmap-radius":new Xt(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ih(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Ze.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return ou("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,l,d,m,_,v){const S=this.paint.get("heatmap-radius").evaluate(e,i);return ax(r,l,m,_,v,!0,!0,new Mt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new z(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends za{constructor(r,e,i,l){super(r,{layout:N_||(N_=new wr({visibility:new Ot(Ze.layout_hillshade.visibility)})),paint:B_||(B_=new wr({"hillshade-illumination-direction":new Ot(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Ze.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ot(Ze.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends za{constructor(r,e,i,l){super(r,{layout:pm||(pm=new wr({"fill-sort-key":new Xt(Ze.layout_fill["fill-sort-key"]),visibility:new Ot(Ze.layout_fill.visibility),"fill-elevation-reference":new Ot(Ze.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Xt(Ze.layout_fill["fill-construct-bridge-guard-rail"])})),paint:mm||(mm=new wr({"fill-antialias":new Ot(Ze.paint_fill["fill-antialias"]),"fill-opacity":new Xt(Ze.paint_fill["fill-opacity"]),"fill-color":new Xt(Ze.paint_fill["fill-color"]),"fill-outline-color":new Xt(Ze.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(Ze.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ot(Ze.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ot(Ze.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(Ze.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Xt(Ze.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Xt(Ze.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new z(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new $u(r)}queryRadius(){return om(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,l,d,m){return!r.queryGeometry.isAboveHorizon&&rr(nx(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends za{constructor(r,e,i,l){super(r,{layout:pA||(pA=new wr({visibility:new Ot(Ze["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ot(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:mA||(mA=new wr({"fill-extrusion-opacity":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ot(Ze["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new cu(r)}queryRadius(){return om(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,l,d,m,_,v,S){const A=n0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],N=v&&m.elevation,U=m.elevation?m.elevation.exaggeration():1,Z=r.tile.getBucket(this);if(N&&Z instanceof cu){const le=Z.centroidVertexArray,_e=S+1;_e<le.length&&(k[0]=le.geta_centroid_pos0(_e),k[1]=le.geta_centroid_pos1(_e))}if(k[0]===0&&k[1]===1)return!1;m.projection.name==="globe"&&(l=fA([l],[new Mt(0,0),new Mt(jt,jt)],r.tileID.canonical).map(le=>le.polygon).flat());const K=N?v:null,[X,te]=wA(m,l,P,D,A,_,K,k,U,m.center.lat,r.tileID.canonical),se=r.queryGeometry;return bA(X,te,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends za{constructor(r,e,i,l){super(r,{layout:QA||(QA=new wr({visibility:new Ot(Ze.layout_building.visibility),"building-facade":new Xt(Ze.layout_building["building-facade"]),"building-facade-floors":new Xt(Ze.layout_building["building-facade-floors"]),"building-facade-unit-width":new Xt(Ze.layout_building["building-facade-unit-width"]),"building-facade-window":new Xt(Ze.layout_building["building-facade-window"]),"building-roof-shape":new Xt(Ze.layout_building["building-roof-shape"]),"building-height":new Xt(Ze.layout_building["building-height"]),"building-base":new Xt(Ze.layout_building["building-base"]),"building-flood-light-wall-radius":new Xt(Ze.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Xt(Ze.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Xt(Ze.layout_building["building-flip-roof-orientation"])})),paint:JA||(JA=new wr({"building-opacity":new Ot(Ze.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ot(Ze.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ot(Ze.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ot(Ze.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ot(Ze.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ot(Ze.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ot(Ze.paint_building["building-cast-shadows"]),"building-color":new Xt(Ze.paint_building["building-color"]),"building-emissive-strength":new Xt(Ze.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ot(Ze.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ot(Ze.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Ot(Ze.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Ot(Ze.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Ot(Ze.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new KA(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,l,d,m,_,v,S,A){let D=this.layout.get("building-height").evaluate(e,i);const P=this.layout.get("building-base").evaluate(e,i),k=r.tile.getBucket(this).getFootprint(e);if(k){if(k.hiddenFlags!==0)return!1;D=k.height}const[N,U]=wA(m,l,P,D,new Mt(0,0),_,null,[0,0],1,m.center.lat,r.tileID.canonical),Z=r.queryGeometry;return bA(N,U,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends za{constructor(r,e,i,l){const d=c2();super(r,d,e,i,l),d.layout&&(this.layout=new La(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Lx)return Lx;const i=c2();return Lx=new sO(i.paint.properties["line-width"].specification),Lx.useIntegerZoom=!0,Lx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new vw(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const l=o2(this);return{config:new z(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}queryRadius(r){const e=r,i=u2(ou("line-width",this,e),ou("line-gap-width",this,e)),l=ou("line-offset",this,e);return i/2+Math.abs(l)+om(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,l,d,m){if(r.queryGeometry.isAboveHorizon)return!1;const _=nx(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*u2(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(l=(function(A,D){const P=[],k=new Mt(0,0);for(let N=0;N<A.length;N++){const U=A[N],Z=[];for(let K=0;K<U.length;K++){const X=U[K],te=U[K+1],se=K===0?k:X.sub(U[K-1])._unit()._perp(),le=K===U.length-1?k:te.sub(X)._unit()._perp(),_e=se._add(le)._unit();_e._mult(1/(_e.x*le.x+_e.y*le.y)),Z.push(_e._mult(D)._add(X))}P.push(Z)}return P})(l,S*r.pixelToTileUnitsFactor)),(function(A,D,P){for(let k=0;k<D.length;k++){const N=D[k];if(A.length>=3){for(let U=0;U<N.length;U++)if(mo(A,N[U]))return!0}if(rs(A,N,P))return!0}return!1})(_,l,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ib,background:class extends za{constructor(r,e,i,l){super(r,{layout:tI||(tI=new wr({visibility:new Ot(Ze.layout_background.visibility)})),paint:nI||(nI=new wr({"background-pitch-alignment":new Ot(Ze.paint_background["background-pitch-alignment"]),"background-color":new Ot(Ze.paint_background["background-color"]),"background-pattern":new Ot(Ze.paint_background["background-pattern"]),"background-opacity":new Ot(Ze.paint_background["background-opacity"]),"background-emissive-strength":new Ot(Ze.paint_background["background-emissive-strength"]),"background-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:oI,"raster-particle":fI,sky:class extends za{constructor(r,e,i,l){super(r,{layout:uI||(uI=new wr({visibility:new Ot(Ze.layout_sky.visibility)})),paint:hI||(hI=new wr({"sky-type":new Ot(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ot(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ot(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ot(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ot(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ih(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ot(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ot(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ot(Ze.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),d=!l,m=r.style.light,_=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&Pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Gw(_.azimuthal,90-_.polar,e):Gw(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return Gw(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends za{constructor(r,e,i,l){super(r,{paint:dI||(dI=new wr({}))},e,null)}},model:class extends za{constructor(r,e,i,l){super(r,{layout:_I||(_I=new wr({visibility:new Ot(Ze.layout_model.visibility),"model-id":new Xt(Ze.layout_model["model-id"]),"model-allow-density-reduction":new Ot(Ze.layout_model["model-allow-density-reduction"])})),paint:yI||(yI=new wr({"model-opacity":new Xt(Ze.paint_model["model-opacity"]),"model-rotation":new Xt(Ze.paint_model["model-rotation"]),"model-scale":new Xt(Ze.paint_model["model-scale"]),"model-translation":new Xt(Ze.paint_model["model-translation"]),"model-color":new Xt(Ze.paint_model["model-color"]),"model-color-mix-intensity":new Xt(Ze.paint_model["model-color-mix-intensity"]),"model-type":new Ot(Ze.paint_model["model-type"]),"model-cast-shadows":new Ot(Ze.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ot(Ze.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ot(Ze.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(Ze.paint_model["model-emissive-strength"]),"model-roughness":new Xt(Ze.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(Ze.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ot(Ze.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ot(Ze.paint_model["model-front-cutoff"]),"model-elevation-reference":new Ot(Ze.paint_model["model-elevation-reference"]),"model-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Hw(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof ob?8191:0}queryRenderedFeatures(r,e,i){const l=e.getSource();if(!(l&&l instanceof Kg))return{};const d=l,m={};m[this.id]=[];const _=m[this.id];let v=0;for(const S of d.models){const A=e.getFeatureState(this.sourceLayer,S.id),D={type:"Unknown",id:S.id,properties:S.featureProperties},P=this.paint.get("model-rotation").evaluate(D,A),k=this.paint.get("model-scale").evaluate(D,A),N=this.paint.get("model-translation").evaluate(D,A),U=this.paint.get("model-elevation-reference");let Z=[];j0(Z,S,i,S.position,P,k,N,U==="ground",U==="ground",!1),i.projection.name==="globe"&&(Z=V0(Z,i));const K=ft([],i.projMatrix,Z),X=fw(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,K,S.aabb);if(X!=null){const te=new Yg(void 0,0,0,0,S.id);te.layer=this.layer,te.properties=structuredClone(S.featureProperties),te.properties.layer=this.id,te.properties.uri=S.uri,te.properties.orientation=S.orientation,te.sourceLayer=this.sourceLayer,te.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},te.state=A,te.source=this.source,_.push({featureIndex:v,feature:te,intersectionZ:X})}++v}return m}queryIntersectsFeature(r,e,i,l,d,m,_,v,S,A){if(!this.modelManager)return!1;const D=this.modelManager,P=r.tile.getBucket(this);if(!(P&&P instanceof Hw))return!1;for(const k in P.instancesPerModel){const N=P.instancesPerModel[k],U=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(U)){const Z=N.features[N.idToFeaturesIndex[U]],K=D.getModel(k,A||this.scope);if(!K)return!1;let X=[];const te=new ge(0,0),se=P.canonical;let le=Number.MAX_VALUE;for(let _e=0;_e<Z.instancedDataCount;++_e){const me=16*(Z.instancedDataOffset+_e),Ee=N.instancedDataArray.float32,Se=[Ee[me+4],Ee[me+5],Ee[me+6]];Zw(se,te,Math.floor(Ee[me]),Math.floor(Ee[me+1])),j0(X,K,m,te,Z.rotation,Z.scale,Se,!1,!1,!1),m.projection.name==="globe"&&(X=V0(X,m));const we=ft([],m.projMatrix,X),Me=r.queryGeometry,Oe=fw(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,m,we,K.aabb);Oe!=null&&(le=Math.min(Oe,le))}return le!==Number.MAX_VALUE&&le}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof wa}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends za{constructor(r,e,i,l){super(r,{layout:Uh||(Uh=new wr({"clip-layer-types":new Ot(Ze.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ot(Ze.layout_clip["clip-layer-scope"]),visibility:new Ot(Ze.layout_clip.visibility)})),paint:A0||(A0=new wr({}))},e,i,l)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new I0(r)}is3D(r){return!0}}},Ww=new Si(0,0,0);function d3(r,e,i){r===1&&e.icons.push((function(l,d){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:_}=m;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&TI(_,"x"),_.stretch_y&&_.stretch_y.length&&TI(_,"y"),m})(l.readFields(f3,{name:void 0},d))})(i,i.readVarint()+i.pos))}function TI(r,e){const i=[],l=r[`stretch_${e}`];let d=null;for(let m=0;m<l.length;m++)d===null?d=i.length===0?l[0]:i[i.length-1][1]+l[m]:(i.push([d,d+l[m]]),d=null);r[`stretch_${e}_areas`]=i}function f3(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(l,d){return l.readFields(p3,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(l,d){return l.readFields(_3,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function p3(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=EI(i,i.readVarint()+i.pos):r===4?e.variables.push((function(l,d){return l.readFields(g3,{name:void 0},d)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=EI(i,i.readVarint()+i.pos))}function EI(r,e){return r.readFields(m3,{},e)}function m3(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function g3(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=ub(i.readVarint()),e.value="rgb_color")}function _3(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(lb(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(l,d){return l.readFields(E3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(l,d){return l.readFields(A3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(l,d){return l.readFields(I3,{children:[]},d)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(l,d){const m=l.readFields(C3,{left:0,width:20,mask_type:1,children:[]},d);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(i,i.readVarint()+i.pos))}function lb(r,e){return r.readFields(y3,{},e)}function y3(r,e,i){r===1?(e.group=(function(l,d){return l.readFields(x3,{opacity:255,children:[]},d)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(l,d){return l.readFields(b3,{paint_order:1,commands:[],step:1,diffs:[],rule:1},d)})(i,i.readVarint()+i.pos),e.node="path")}function x3(r,e,i){r===1?e.transform=cb(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(lb(i,i.readVarint()+i.pos))}function cb(r,e){return r.readFields(v3,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function v3(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function b3(r,e,i){r===1?e.fill=(function(l,d){return l.readFields(w3,{rgb_color:Ww,paint:"rgb_color",opacity:255},d)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(l,d){return l.readFields(T3,{rgb_color:Ww,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function w3(r,e,i){r===1?(e.rgb_color=ub(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function ub(r){return new Si((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function T3(r,e,i){r===1?(e.rgb_color=ub(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function E3(r,e,i){r===1?e.transform=cb(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(SI(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function SI(r,e){return r.readFields(S3,{offset:0,opacity:255,rgb_color:Ww},e)}function S3(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=ub(i.readVarint()))}function A3(r,e,i){r===1?e.transform=cb(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(SI(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function I3(r,e,i){r===1?e.transform=cb(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(lb(i,i.readVarint()+i.pos))}function C3(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(lb(i,i.readVarint()+i.pos))}class R3{static calculate(e={},i=[]){const l=new Map,d=new Map;if(Object.keys(e).length===0)return l;i.forEach(m=>{d.set(m.name,m.rgb_color||new Si(0,0,0))});for(const[m,_]of Object.entries(e))d.has(m)?l.set(d.get(m).toString(),_):console.warn(`Ignoring unknown image variable "${m}"`);return l}}function ly(r,e=255,i){const l=e/255,d=r.toString(),m=i.has(d)?i.get(d).clone():r.clone();return m.a*=l,m.toString()}function Xx(r,e){if(!To()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}let Xw,Yx=null;function Yw(r,e,i,l,d){for(const m of l.children)AI(r,e,i,m,d)}function AI(r,e,i,l,d){l.group?(r.save(),(function(m,_,v,S,A){const D=S.mask_idx!=null?v.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(_=cy(S.transform).preMultiplySelf(_)),!(function(U,Z,K){return U.opacity!==255||Z||K})(S,P!=null,D!=null))return void Yw(m,_,v,S,A);const k=Xx(m.canvas.width,m.canvas.height),N=k.getContext("2d");Yw(N,_,v,S,A),P&&kI(N,_,v,P),D&&LI(N,_,v,D,A),m.globalAlpha=S.opacity/255,m.drawImage(k,0,0)})(r,e,i,l.group,d),r.restore()):l.path&&(r.save(),(function(m,_,v,S,A){m.setTransform(_),S.paint_order===1?(II(m,v,S,A),RI(m,v,S,A)):(RI(m,v,S,A),II(m,v,S,A))})(r,e,i,l.path,d),r.restore())}function II(r,e,i,l){const d=i.fill;if(!d)return;const m=d.opacity/255;switch(r.save(),r.beginPath(),zI(i,r),d.paint){case"rgb_color":r.fillStyle=ly(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":{const _=e.linear_gradients[d.linear_gradient_idx];_.transform&&r.setTransform(cy(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=MI(r,_,m,l);break}case"radial_gradient_idx":{const _=e.radial_gradients[d.radial_gradient_idx];_.transform&&r.setTransform(cy(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=DI(r,_,m,l)}}r.fill(CI(i)),r.restore()}function CI(r){return r.rule===1?"nonzero":r.rule===2?"evenodd":void 0}function RI(r,e,i,l){const d=i.stroke;if(!d)return;const m=OI(i);r.lineWidth=d.width,r.miterLimit=d.miterlimit,r.setLineDash(d.dasharray),r.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":r.strokeStyle=ly(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":r.strokeStyle=MI(r,e.linear_gradients[d.linear_gradient_idx],_,l,!0);break;case"radial_gradient_idx":r.strokeStyle=DI(r,e.radial_gradients[d.radial_gradient_idx],_,l,!0)}switch(d.linejoin){case 2:case 1:r.lineJoin="miter";break;case 3:r.lineJoin="round";break;case 4:r.lineJoin="bevel"}switch(d.linecap){case 1:r.lineCap="butt";break;case 2:r.lineCap="round";break;case 3:r.lineCap="square"}r.stroke(m)}function MI(r,e,i,l,d=!1){if(e.stops.length===1){const k=e.stops[0];return ly(k.rgb_color,k.opacity*i,l)}const{x1:m,y1:_,x2:v,y2:S}=e;let A=new DOMPoint(m,_),D=new DOMPoint(v,S);if(d){const k=cy(e.transform);A=k.transformPoint(A),D=k.transformPoint(D)}const P=r.createLinearGradient(A.x,A.y,D.x,D.y);for(const k of e.stops)P.addColorStop(k.offset,ly(k.rgb_color,k.opacity*i,l));return P}function DI(r,e,i,l,d=!1){if(e.stops.length===1){const X=e.stops[0];return ly(X.rgb_color,X.opacity*i,l)}const m=cy(e.transform),{fx:_,fy:v,fr:S,cx:A,cy:D,r:P}=e;let k=new DOMPoint(_,v),N=new DOMPoint(A,D),U=S,Z=P;if(d){k=m.transformPoint(k),N=m.transformPoint(N);const X=(m.a+m.d)/2;U=S*X,Z=e.r*X}const K=r.createRadialGradient(k.x,k.y,U,N.x,N.y,Z);for(const X of e.stops)K.addColorStop(X.offset,ly(X.rgb_color,X.opacity*i,l));return K}function PI(r,e,i,l){const d=l.transform?cy(l.transform).preMultiplySelf(e):e,m=Xx(r.canvas.width,r.canvas.height),_=m.getContext("2d");for(const S of l.children)if(S.group)PI(_,d,i,S.group);else if(S.path){const A=S.path,D=new Path2D;D.addPath(OI(A),d),_.fill(D,CI(A))}const v=l.clip_path_idx!=null?i.clip_paths[l.clip_path_idx]:null;v&&kI(_,d,i,v),r.globalCompositeOperation="source-over",r.drawImage(m,0,0)}function kI(r,e,i,l){const d=Xx(r.canvas.width,r.canvas.height);PI(d.getContext("2d"),e,i,l),r.globalCompositeOperation="destination-in",r.drawImage(d,0,0)}function LI(r,e,i,l,d){if(l.children.length===0)return;const m=l.mask_idx!=null?i.masks[l.mask_idx]:null;m&&LI(r,e,i,m,d);const _=r.canvas.width,v=r.canvas.height,S=Xx(_,v),A=S.getContext("2d"),D=l.width,P=l.height,k=l.left,N=l.top,U=new Path2D,Z=new Path2D;Z.rect(k,N,D,P),U.addPath(Z,e),A.clip(U);for(const te of l.children)AI(A,e,i,te,d);const K=A.getImageData(0,0,_,v),X=K.data;if(l.mask_type===1)for(let te=0;te<X.length;te+=4)X[te+3]=X[te+3]/255*(.2126*X[te]+.7152*X[te+1]+.0722*X[te+2]);A.putImageData(K,0,0),r.globalCompositeOperation="destination-in",r.drawImage(S,0,0)}function cy(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function zI(r,e){const i=r.step;let l=r.diffs[0]*i,d=r.diffs[1]*i;e.moveTo(l,d);for(let m=0,_=2;m<r.commands.length;m++)switch(r.commands[m]){case 1:l+=r.diffs[_++]*i,d+=r.diffs[_++]*i,e.moveTo(l,d);break;case 2:l+=r.diffs[_++]*i,d+=r.diffs[_++]*i,e.lineTo(l,d);break;case 3:{const v=l+r.diffs[_++]*i,S=d+r.diffs[_++]*i;l=v+r.diffs[_++]*i,d=S+r.diffs[_++]*i,e.quadraticCurveTo(v,S,l,d);break}case 4:{const v=l+r.diffs[_++]*i,S=d+r.diffs[_++]*i,A=v+r.diffs[_++]*i,D=S+r.diffs[_++]*i;l=A+r.diffs[_++]*i,d=D+r.diffs[_++]*i,e.bezierCurveTo(v,S,A,D,l,d);break}case 5:e.closePath();break}return e}function OI(r){return zI(r,new Path2D)}class hb{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Bt(hb,"LRUCache");class Kw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ta(e,e.data)}getFromCache(e,i,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new hb(150)),this.cacheMap.get(l).get(ql(e.toString(),i))}setInCache(e,i,l,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new hb(150));const m=this.cacheDependenciesMap.get(d),_=ql(e.id.toString(),l);m.get(_)||m.set(_,new Set);const v=this.cacheMap.get(d),S=e.toString();m.get(_).add(S),v.put(ql(e.toString(),l),i)}removeImagesFromCacheByIds(e,i,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const d=this.cacheMap.get(l),m=this.cacheDependenciesMap.get(l);for(const _ of e){const v=ql(_.toString(),i);if(m.has(v)){for(const S of m.get(v))d.delete(S);m.delete(v)}}}rasterize(e,i,l,d){const m=this.getFromCache(e,l,d);if(m)return m.clone();const _=(function(S,A){const D=R3.calculate(A.params,S.metadata?S.metadata.variables:[]),P=S.usvg_tree,k=P.width,N=P.height,U=Math.max(1,Math.round(k*A.sx)),Z=Math.max(1,Math.round(N*A.sy)),K=new DOMMatrix([U/k,0,0,Z/N,0,0]);return Yx===null&&(Yx=Xx(10,10),Xw=Yx.getContext("2d",{willReadFrequently:!0})),Yx.width=U,Yx.height=Z,Yw(Xw,K,P,P,D),Xw.getImageData(0,0,U,Z)})(i.icon,e),v=Kw._getImage(_);return this.setInCache(e,v,l,d),v.clone()}}class NI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function BI(r,e,i,l){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const v=1/l[_];let S=(r[_]-i[_])*v,A=(e[_]-i[_])*v;if(S>A){const D=S;S=A,A=D}if(S>d&&(d=S),A<m&&(m=A),d>m)return null}return d}function FI(r,e,i,l,d,m,_,v,S,A,D){const P=l-r,k=d-e,N=m-i,U=_-r,Z=v-e,K=S-i,X=D[1]*K-D[2]*Z,te=D[2]*U-D[0]*K,se=D[0]*Z-D[1]*U,le=P*X+k*te+N*se;if(Math.abs(le)<1e-15)return null;const _e=1/le,me=A[0]-r,Ee=A[1]-e,Se=A[2]-i,we=(me*X+Ee*te+Se*se)*_e;if(we<0||we>1)return null;const Me=Ee*N-Se*k,Oe=Se*P-me*N,pt=me*k-Ee*P,ot=(D[0]*Me+D[1]*Oe+D[2]*pt)*_e;return ot<0||we+ot>1?null:(U*Me+Z*Oe+K*pt)*_e}function VI(r,e,i){return(r-e)/(i-e)}function jI(r,e,i,l,d,m,_,v,S){const A=1<<i,D=m-l,P=_-d,k=(r+1)/A*D+l,N=(e+0)/A*P+d,U=(e+1)/A*P+d;v[0]=(r+0)/A*D+l,v[1]=N,S[0]=k,S[1]=U}class UI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(m){const _=Math.ceil(Math.log2(m.dim/8)),v=[];let S=Math.ceil(Math.pow(2,_));const A=1/S,D=(N,U,Z,K,X)=>{const te=K?1:0,se=(N+1)*Z-te,le=U*Z,_e=(U+1)*Z-te;X[0]=N*Z,X[1]=le,X[2]=se,X[3]=_e};let P=new NI(S);const k=[];for(let N=0;N<S*S;N++){D(N%S,Math.floor(N/S),A,!1,k);const U=wm(k[0],k[1],m),Z=wm(k[2],k[1],m),K=wm(k[2],k[3],m),X=wm(k[0],k[3],m);P.minimums.push(Math.min(U,Z,K,X)),P.maximums.push(Math.max(U,Z,K,X)),P.leaves.push(1)}for(v.push(P),S/=2;S>=1;S/=2){const N=v[v.length-1];P=new NI(S);for(let U=0;U<S*S;U++){D(U%S,Math.floor(U/S),2,!0,k);const Z=N.getElevation(k[0],k[1]),K=N.getElevation(k[2],k[1]),X=N.getElevation(k[2],k[3]),te=N.getElevation(k[0],k[3]),se=N.isLeaf(k[0],k[1]),le=N.isLeaf(k[2],k[1]),_e=N.isLeaf(k[2],k[3]),me=N.isLeaf(k[0],k[3]),Ee=Math.min(Z.min,K.min,X.min,te.min),Se=Math.max(Z.max,K.max,X.max,te.max),we=se&&le&&_e&&me;P.maximums.push(Se),P.minimums.push(Ee),P.leaves.push(Se-Ee<=5&&we?1:0)}v.push(P)}return v})(this.dem),l=i.length-1,d=i[l];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,d,m,_,v=1){return BI([e,i,-100],[l,d,this.maximums[0]*v],m,_)}raycast(e,i,l,d,m,_,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,l,d,m,_,v);if(S==null)return null;const A=[],D=[],P=[],k=[],N=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:U,t:Z,nodex:K,nodey:X,depth:te}=N.pop();if(this.leaves[U]){jI(K,X,te,e,i,l,d,P,k);const le=1<<te,_e=(K+0)/le,me=(K+1)/le,Ee=(X+0)/le,Se=(X+1)/le,we=wm(_e,Ee,this.dem)*v,Me=wm(me,Ee,this.dem)*v,Oe=wm(me,Se,this.dem)*v,pt=wm(_e,Se,this.dem)*v,ot=FI(P[0],P[1],we,k[0],P[1],Me,k[0],k[1],Oe,m,_),ut=FI(k[0],k[1],Oe,P[0],k[1],pt,P[0],P[1],we,m,_),Tt=Math.min(ot!==null?ot:Number.MAX_VALUE,ut!==null?ut:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const vt=wn([],m,_,Z);if(GI(we,Me,pt,Oe,VI(vt[0],P[0],k[0]),VI(vt[1],P[1],k[1]))>=vt[2])return Z}continue}let se=0;for(let le=0;le<this._siblingOffset.length;le++){jI((K<<1)+this._siblingOffset[le][0],(X<<1)+this._siblingOffset[le][1],te+1,e,i,l,d,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[U]+le]*v;const _e=BI(P,k,m,_);if(_e!=null){const me=_e;A[le]=me;let Ee=!1;for(let Se=0;Se<se&&!Ee;Se++)me>=A[D[Se]]&&(D.splice(Se,0,le),Ee=!0);Ee||(D[se]=le),se++}}for(let le=0;le<se;le++){const _e=D[le];N.push({idx:this.childOffsets[U]+_e,t:A[_e],nodex:(K<<1)+this._siblingOffset[_e][0],nodey:(X<<1)+this._siblingOffset[_e][1],depth:te+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,d,m){if(e[d].isLeaf(i,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,v=e[_];let S=0,A=0;for(let D=0;D<this._siblingOffset.length;D++){const P=2*i+this._siblingOffset[D][0],k=2*l+this._siblingOffset[D][1],N=v.getElevation(P,k),U=v.isLeaf(P,k),Z=this._addNode(N.min,N.max,U);U&&(S|=1<<D),A||(A=Z)}for(let D=0;D<this._siblingOffset.length;D++)S&1<<D||this._construct(e,2*i+this._siblingOffset[D][0],2*l+this._siblingOffset[D][1],_,A+D)}}function GI(r,e,i,l,d,m){return Cn(Cn(r,i,m),Cn(e,l,m),d)}function wm(r,e,i){const l=i.dim,d=xe(r*l-.5,0,l-1),m=xe(e*l-.5,0,l-1),_=Math.floor(d),v=Math.floor(m),S=Math.min(_+1,l-1),A=Math.min(v+1,l-1);return GI(i.get(_,v),i.get(S,v),i.get(_,A),i.get(S,A),d-_,m-v)}const M3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function D3(r,e,i){return(256*r*256+256*e+i)/10-1e4}function P3(r,e,i){return 256*r+e+i/256-32768}class db{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,d=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Pn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let S=0;S<m;S++)_[this._idx(-1,S)]=_[this._idx(0,S)],_[this._idx(m,S)]=_[this._idx(m-1,S)],_[this._idx(S,-1)]=_[this._idx(S,0)],_[this._idx(S,m)]=_[this._idx(S,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const v=l==="terrarium"?P3:D3;for(let S=0;S<_.length;++S){const A=4*S;this.floatView[S]=v(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Ua.now()}_buildQuadTree(){this._tree=new UI(this)}get(e,i,l=!1){l&&(e=xe(e,-1,this.dim),i=xe(i,-1,this.dim));const d=this._idx(e,i);return this.floatView[d]}set(e,i,l){const d=this._idx(e,i),m=this.floatView[d];return this.floatView[d]=l,l-m}static getUnpackVector(e){return M3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],d=db.getUnpackVector(i);let m=Math.floor((e+d[3])/d[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new f0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=i*this.dim,m=i*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(i){case-1:d=m-1;break;case 1:m=d+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const S=-i*this.dim,A=-l*this.dim;for(let D=_;D<v;D++)for(let P=d;P<m;P++){const k=4*this._idx(P,D),N=4*this._idx(P+S,D+A);this.pixels[k+0]=e.pixels[N+0],this.pixels[k+1]=e.pixels[N+1],this.pixels[k+2]=e.pixels[N+2],this.pixels[k+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function k3(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(l,d){return l.readFields(B3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(i,i.readVarint()+i.pos))}function L3(r,e,i){r===1?(e.delta_filter=(function(l,d){return l.readFields(z3,{blockSize:0},d)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function z3(r,e,i){r===1&&(e.blockSize=i.readVarint())}function O3(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function N3(r,e,i){let l=0,d=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(m,_){return m.readFields(L3,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(m,_){return m.readFields(O3,{},_)})(i,i.readVarint()+i.pos):r===5?d=i.readFloat():r===6?l=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=l)}function B3(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(l,d){return l.readFields(N3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(i,i.readVarint()+i.pos))}function F3(r,e,i){if(r===2)(function(l,d,m){l.readFields(V3,m,d)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function V3(r,e,i){if(r===1){let l=0;const d=i.readVarint()+i.pos;for(;i.pos<d;)e[l++]=i.readVarint()}}function j3(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let l=2;l>=1;l--){const d=l===1?1:0,m=l===2?1:0;for(let _=0;_<e[0];_++){const v=e[1]*_;for(let S=d;S<e[1];S++){const A=e[2]*(S+v);for(let D=m;D<e[2];D++){const P=e[3]*(D+A);for(let k=0;k<e[3];k++){const N=P+k;r[N]+=r[N-i]}}}}i*=e[l]}return r}function U3(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function G3(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const l=r[i],d=r[i+1];r[i]=(240&l)>>4|(61440&l)>>8|(240&d)<<4|61440&d,r[i+1]=15&l|(3840&l)>>4|(15&d)<<8|(3840&d)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const l=r[i],d=r[i+1],m=r[i+2],_=r[i+3];r[i+0]=(192&l)>>6|(192&d)>>4|(192&m)>>2|192&_,r[i+1]=(48&l)>>4|(48&d)>>2|48&m|(48&_)<<2,r[i+2]=(12&l)>>2|12&d|(12&m)<<2|(12&_)<<4,r[i+3]=3&l|(3&d)<<2|(3&m)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Bt(db,"DEMData"),Bt(UI,"DemMinMaxQuadTree",{omit:["dem"]});var uu=Uint8Array,Kx=Uint16Array,q3=Int32Array,qI=new uu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),HI=new uu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),H3=new uu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$I=function(r,e){for(var i=new Kx(31),l=0;l<31;++l)i[l]=e+=1<<r[l-1];var d=new q3(i[30]);for(l=1;l<30;++l)for(var m=i[l];m<i[l+1];++m)d[m]=m-i[l]<<5|l;return{b:i,r:d}},ZI=$I(qI,2),WI=ZI.b,$3=ZI.r;WI[28]=258,$3[258]=28;for(var Z3=$I(HI,0).b,XI=new Kx(32768),qs=0;qs<32768;++qs){var uy=(43690&qs)>>1|(21845&qs)<<1;XI[qs]=((65280&(uy=(61680&(uy=(52428&uy)>>2|(13107&uy)<<2))>>4|(3855&uy)<<4))>>8|(255&uy)<<8)>>1}var Qx=function(r,e,i){for(var l=r.length,d=0,m=new Kx(e);d<l;++d)r[d]&&++m[r[d]-1];var _,v=new Kx(e);for(d=1;d<e;++d)v[d]=v[d-1]+m[d-1]<<1;_=new Kx(1<<e);var S=15-e;for(d=0;d<l;++d)if(r[d])for(var A=d<<4|r[d],D=e-r[d],P=v[r[d]-1]++<<D,k=P|(1<<D)-1;P<=k;++P)_[XI[P]>>S]=A;return _},Jx=new uu(288);for(qs=0;qs<144;++qs)Jx[qs]=8;for(qs=144;qs<256;++qs)Jx[qs]=9;for(qs=256;qs<280;++qs)Jx[qs]=7;for(qs=280;qs<288;++qs)Jx[qs]=8;var YI=new uu(32);for(qs=0;qs<32;++qs)YI[qs]=5;var W3=Qx(Jx,9),X3=Qx(YI,5),Qw=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},qh=function(r,e,i){var l=e/8|0;return(r[l]|r[l+1]<<8)>>(7&e)&i},Jw=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},Y3=function(r){return(r+7)/8|0},K3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hh=function(r,e,i){var l=new Error(e||K3[r]);if(l.code=r,Error.captureStackTrace&&Error.captureStackTrace(l,Hh),!i)throw l;return l},Q3=new uu(0),J3=typeof TextDecoder<"u"&&new TextDecoder;try{J3.decode(Q3,{stream:!0})}catch{}const eN={gzip_data:"gzip"};class Zu extends Error{constructor(e){super(e),this.name="MRTError"}}const tN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},KI={uint32:1,uint16:2,uint8:4},nN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let eT;class fb{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Zu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),l=new DataView(e);if(i[0]!==13)throw new Zu("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),l=this.getHeaderLength(e);if(i.length<l)throw new Zu(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const d=new eT(i.subarray(0,l)).readFields(k3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Zu(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const m of d.layers)this.layers[m.name]=new QI(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],l=this.getLayer(e.layerName);for(let d of e.blockIndices){const m=l.dataIndex[d],_=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(l._blocksInProgress.has(d))continue;const S={layerName:l.name,firstByte:_,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:d,blockShape:[m.bands.length].concat(l.bandShape),buffer:l.buffer,codec:m.codec.codec,filters:m.filters.map(A=>A.filter)};l._blocksInProgress.add(d),i.push(S)}return new JI(i,()=>{i.forEach(d=>l._blocksInProgress.delete(d.blockIndex))},(d,m)=>{if(i.forEach(_=>l._blocksInProgress.delete(_.blockIndex)),d)throw d;m.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class QI{constructor({version:e,name:i,units:l,tileSize:d,pixelFormat:m,buffer:_,dataIndex:v},S){if(this.version=e,this.version!==1)throw new Zu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=l,this.tileSize=d,this.buffer=_,this.pixelFormat=tN[m],this.dataIndex=v,this.bandShape=[d+2*_,d+2*_,KI[this.pixelFormat]],this._decodedBlocks=new hb(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return KI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[l,d]of this.dataIndex.entries()){for(const[m,_]of d.bands.entries())if(_===e)return{bandIndex:i+m,blockIndex:l,blockBandIndex:m};i+=d.bands.length}break;case"number":for(const[l,d]of this.dataIndex.entries()){if(e>=i&&e<i+d.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-i};i+=d.bands.length}break;default:throw new Zu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,l=-1/0;const d=[],m=new Set;for(const _ of e){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new Zu(`Invalid band: ${JSON.stringify(_)}`);const S=this.dataIndex[v];d.includes(v)||d.push(v),m.add(v),i=Math.min(i,S.firstByte),l=Math.max(l,S.lastByte)}if(m.size>this.cacheSize)throw new Zu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:l,blockIndices:d}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(e);if(i<0)throw new Zu(`Band not found: ${JSON.stringify(e)}`);const d=this._decodedBlocks.get(i.toString());if(!d)throw new Zu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[i],_=this.bandShape.reduce((A,D)=>A*D,1),v=l*_,S=d.subarray(v,v+_);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}fb.setPbf=function(r){eT=r};class JI{constructor(e,i,l){this.tasks=e,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}fb.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(l=>{const{layerName:d,firstByte:m,lastByte:_,pixelFormat:v,blockShape:S,blockIndex:A,filters:D,codec:P}=l,k=i.subarray(m,_+1),N=new Uint32Array(S[0]*S[1]*S[2]);let U;if(P!=="gzip_data")throw new Zu(`Unhandled codec: ${P}`);return U=(function(Z,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve((_e=(function(Se){Se[0]==31&&Se[1]==139&&Se[2]==8||Hh(6,"invalid gzip data");var we=Se[3],Me=10;4&we&&(Me+=2+(Se[10]|Se[11]<<8));for(var Oe=(we>>3&1)+(we>>4&1);Oe>0;Oe-=!Se[Me++]);return Me+(2&we)})(X=Z),_e+8>X.length&&Hh(6,"invalid gzip data"),(function(Se,we,Me,Oe){var pt=Se.length;if(!pt||we.f&&!we.l)return Me||new uu(0);var ot=!Me,ut=ot||we.i!=2,Tt=we.i;ot&&(Me=new uu(3*pt));var vt=function(qo){var Wd=Me.length;if(qo>Wd){var _o=new uu(Math.max(2*Wd,qo));_o.set(Me),Me=_o}},bt=we.f||0,rt=we.p||0,At=we.b||0,_t=we.l,Ct=we.d,Et=we.m,nn=we.n,rn=8*pt;do{if(!_t){bt=qh(Se,rt,1);var Ht=qh(Se,rt+1,3);if(rt+=3,!Ht){var Wt=Se[(wi=Y3(rt)+4)-4]|Se[wi-3]<<8,An=wi+Wt;if(An>pt){Tt&&Hh(0);break}ut&&vt(At+Wt),Me.set(Se.subarray(wi,An),At),we.b=At+=Wt,we.p=rt=8*An,we.f=bt;continue}if(Ht==1)_t=W3,Ct=X3,Et=9,nn=5;else if(Ht==2){var _n=qh(Se,rt,31)+257,Qt=qh(Se,rt+10,15)+4,Nn=_n+qh(Se,rt+5,31)+1;rt+=14;for(var ii=new uu(Nn),Di=new uu(19),Qn=0;Qn<Qt;++Qn)Di[H3[Qn]]=qh(Se,rt+3*Qn,7);rt+=3*Qt;var Zi=Qw(Di),xi=(1<<Zi)-1,as=Qx(Di,Zi);for(Qn=0;Qn<Nn;){var wi,Ui=as[qh(Se,rt,xi)];if(rt+=15&Ui,(wi=Ui>>4)<16)ii[Qn++]=wi;else{var Er=0,Nr=0;for(wi==16?(Nr=3+qh(Se,rt,3),rt+=2,Er=ii[Qn-1]):wi==17?(Nr=3+qh(Se,rt,7),rt+=3):wi==18&&(Nr=11+qh(Se,rt,127),rt+=7);Nr--;)ii[Qn++]=Er}}var Br=ii.subarray(0,_n),os=ii.subarray(_n);Et=Qw(Br),nn=Qw(os),_t=Qx(Br,Et),Ct=Qx(os,nn)}else Hh(1);if(rt>rn){Tt&&Hh(0);break}}ut&&vt(At+131072);for(var Ea=(1<<Et)-1,Ya=(1<<nn)-1,ks=rt;;ks=rt){var Hs=(Er=_t[Jw(Se,rt)&Ea])>>4;if((rt+=15&Er)>rn){Tt&&Hh(0);break}if(Er||Hh(2),Hs<256)Me[At++]=Hs;else{if(Hs==256){ks=rt,_t=null;break}var na=Hs-254;Hs>264&&(na=qh(Se,rt,(1<<(Xr=qI[Qn=Hs-257]))-1)+WI[Qn],rt+=Xr);var Yn=Ct[Jw(Se,rt)&Ya],Fr=Yn>>4;if(Yn||Hh(3),rt+=15&Yn,os=Z3[Fr],Fr>3){var Xr=HI[Fr];os+=Jw(Se,rt)&(1<<Xr)-1,rt+=Xr}if(rt>rn){Tt&&Hh(0);break}ut&&vt(At+131072);var tc=At+na;if(At<os){var Go=0-os,Sa=Math.min(os,tc);for(Go+At<0&&Hh(3);At<Sa;++At)Me[At]=Oe[Go+At]}for(;At<tc;++At)Me[At]=Me[At-os]}}we.l=_t,we.p=ks,we.b=At,we.f=bt,_t&&(bt=1,we.m=Et,we.d=Ct,we.n=nn)}while(!bt);return At!=Me.length&&ot?(function(qo,Wd,_o){return(_o==null||_o>qo.length)&&(_o=qo.length),new uu(qo.subarray(0,_o))})(Me,0,At):Me.subarray(0,At)})(X.subarray(_e,-8),{i:2},new uu(((se=X)[(le=se.length)-4]|se[le-3]<<8|se[le-2]<<16|se[le-1]<<24)>>>0),te)));var X,te,se,le,_e;const me=eN[K];if(!me)throw new Error(`Unhandled codec: ${K}`);const Ee=new globalThis.DecompressionStream(me);return new Response(new Blob([Z]).stream().pipeThrough(Ee)).arrayBuffer().then(Se=>new Uint8Array(Se))})(k,P).then(Z=>((function(K,X){K.readFields(F3,X)})(new eT(Z),N),new nN[v](N.buffer))),U.then(Z=>{for(let K=D.length-1;K>=0;K--)switch(D[K]){case"delta_filter":j3(Z,S);break;case"zigzag_filter":U3(Z);break;case"bitshuffle_filter":G3(Z,v);break;default:throw new Zu(`Unhandled filter "${D[K]}"`)}return{layerName:d,blockIndex:A,data:Z}}).catch(Z=>{throw Z})}))},Bt(JI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Bt(fb,"MapboxRasterTile"),Bt(QI,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class eC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class tC{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vc(jt,16,0),this.featureIndexArray=new ru,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,l,d,m,_=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,m,_);const A=this.grid;for(let D=0;D<i.length;D++){const P=i[D],k=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const U=P[N];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}v!==0&&(k[0]-=v,k[1]-=v,k[2]+=v,k[3]+=v),k[0]<jt&&k[1]<jt&&k[2]>=0&&k[3]>=0&&A.insert(S,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mi(new q0(this.rawTileData)).layers,this.sourceLayerCoder=new eC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:l,transform:d,tileTransform:m,pixelPosMatrix:_,availableImages:v,worldview:S}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=i.queryRadius?i.queryRadius:0,D=l.bufferedTilespaceBounds,P=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(Z,K,X,te)=>il(l.bufferedTilespaceGeometry,Z-A,K-A,X+A,te+A));P.sort(iN);let k=null;d.elevation&&P.length>0&&(k=oy.create(d.elevation,this.tileID));const N={};let U;for(let Z=0;Z<P.length;Z++){const K=P[Z];if(K===U)continue;U=K;const X=this.featureIndexArray.get(K);let te=null;this.is3DTile?this.loadMatchingModelFeature(N,X,e,l,d,S):this.loadMatchingFeature(N,X,e,v,S,(se,le,_e,me=0)=>(te||(te=Mn(se,this.tileID.canonical,m)),le.queryIntersectsFeature(l,se,_e,te,this.z,d,_,k,me,i.scope)))}return N}loadMatchingFeature(e,i,l,d,m,_){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:D}=i,P=this.bucketLayerIDs[S],k=l.layers,N=Object.keys(k);if(N.length&&!Fn(N,P))return;const U=l.sourceCache,Z=this.sourceLayerCoder.decode(A),K=this.vtLayers[Z].feature(v),X=this.getId(K,Z);for(let te=0;te<P.length;te++){const se=P[te];if(!k[se])continue;const{styleLayer:le,targets:_e}=k[se];let me={};X!==void 0&&(me=U.getFeatureState(le.sourceLayer,X));const Ee=!_||_(K,le,me,D);if(!Ee)continue;const Se=new Yg(K,this.z,this.x,this.y,X);Se.tile=this.tileID.canonical,Se.state=me;let we=this.serializedLayersCache.get(se);we||(we=le.serialize(),we.id=se,this.serializedLayersCache.set(se,we)),Se.source=we.source,Se.sourceLayer=we["source-layer"],Se.layer=Object.assign({},we),Se.layer.paint=nC(we.paint,le.paint,K,me,d),Se.layer.layout=nC(we.layout,le.layout,K,me,d);let Me=!1;for(const Oe of _e){this.updateFeatureProperties(Se,Oe);const{filter:pt}=Oe;if(pt){if(K.properties=Se.properties,pt.needGeometry){const ot=Vn(K,!0);if(!pt.filter(new Pi(this.tileID.overscaledZ,{worldview:m}),ot,this.tileID.canonical))continue}else if(!pt.filter(new Pi(this.tileID.overscaledZ,{worldview:m}),K))continue}Me=!0,Oe.targetId&&this.addFeatureVariant(Se,Oe)}Me&&this.appendToResult(e,se,v,Se,Ee)}}loadMatchingModelFeature(e,i,l,d,m,_){const{featureIndex:v,bucketIndex:S}=i,A=this.bucketLayerIDs[S],D=l.layers,P=Object.keys(D);if(!P.length||Fn(P,A))for(let k=0;k<A.length;k++){const N=A[k],{styleLayer:U,targets:Z}=D[N];if(U.type!=="model")continue;const K=d.tile,X=K.getBucket(U);if(!(X&&X instanceof ob))continue;const te=u3(X,v,d,m);if(!te)continue;const{z:se,x:le,y:_e}=K.tileID.canonical,{feature:me,intersectionZ:Ee,position:Se}=te;let we={};me.id!==void 0&&(we=l.sourceCache.getFeatureState(U.sourceLayer,me.id));const Me=new Yg({},se,le,_e,me.id);Me.tile=this.tileID.canonical,Me.state=we,Me.properties=me.properties,Me.geometry={type:"Point",coordinates:[Se.lng,Se.lat]};let Oe=this.serializedLayersCache.get(N);Oe||(Oe=U.serialize(),Oe.id=N,this.serializedLayersCache.set(N,Oe)),Me.source=Oe.source,Me.sourceLayer=Oe["source-layer"],Me.layer=Object.assign({},Oe);let pt=!1;for(const ot of Z){this.updateFeatureProperties(Me,ot);const{filter:ut}=ot;if(ut){if(me.properties=Me.properties,ut.needGeometry){if(!ut.filter(new Pi(this.tileID.overscaledZ,{worldview:_}),me,this.tileID.canonical))continue}else if(!ut.filter(new Pi(this.tileID.overscaledZ,{worldview:_}),me))continue}pt=!0,ot.targetId&&this.addFeatureVariant(Me,ot)}pt&&this.appendToResult(e,N,v,Me,Ee)}}updateFeatureProperties(e,i,l){if(i.properties){const d={};for(const m in i.properties){const _=i.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);_!=null&&(d[m]=_)}e.properties=d}}addFeatureVariant(e,i,l){const d={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(d)}appendToResult(e,i,l,d,m){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:l,feature:d,intersectionZ:m})}lookupSymbolFeatures(e,i,l,d,m,_){const v={};this.loadVTLayers();for(const S of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:l,featureIndex:S,layoutVertexArrayOffset:0},d,m,_);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(l),m=this.vtFeatures[d];if(m[i])return m[i];const _=this.vtLayers[d].feature(i);return m[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const m=xc(d);if(m.result!=="success"){const _=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Pn(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=m.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[d];typeof l=="boolean"&&(l=Number(l))}return l}}function nC(r,e,i,l,d){return yn(r,(m,_)=>{const v=e instanceof La?e.get(_):null;return v&&v.evaluate?v.evaluate(i,l,void 0,d):v})}function iN(r,e){return e-r}Bt(tC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const iC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const m=iC[15&l];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new tT(v,_,m,e)}constructor(e,i=64,l=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=iC.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:v}=this,S=[0,m.length-1,0],A=[];for(;S.length;){const D=S.pop()||0,P=S.pop()||0,k=S.pop()||0;if(P-k<=v){for(let K=k;K<=P;K++){const X=_[2*K],te=_[2*K+1];X>=e&&X<=l&&te>=i&&te<=d&&A.push(m[K])}continue}const N=k+P>>1,U=_[2*N],Z=_[2*N+1];U>=e&&U<=l&&Z>=i&&Z<=d&&A.push(m[N]),(D===0?e<=U:i<=Z)&&(S.push(k),S.push(N-1),S.push(1-D)),(D===0?l>=U:d>=Z)&&(S.push(N+1),S.push(P),S.push(1-D))}return A}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:_}=this,v=[0,d.length-1,0],S=[],A=l*l;for(;v.length;){const D=v.pop()||0,P=v.pop()||0,k=v.pop()||0;if(P-k<=_){for(let K=k;K<=P;K++)sC(m[2*K],m[2*K+1],e,i)<=A&&S.push(d[K]);continue}const N=k+P>>1,U=m[2*N],Z=m[2*N+1];sC(U,Z,e,i)<=A&&S.push(d[N]),(D===0?e-l<=U:i-l<=Z)&&(v.push(k),v.push(N-1),v.push(1-D)),(D===0?e+l>=U:i+l>=Z)&&(v.push(N+1),v.push(P),v.push(1-D))}return S}}function nT(r,e,i,l,d,m){if(d-l<=i)return;const _=l+d>>1;rC(r,e,_,l,d,m),nT(r,e,i,l,_-1,1-m),nT(r,e,i,_+1,d,1-m)}function rC(r,e,i,l,d,m){for(;d>l;){if(d-l>600){const A=d-l+1,D=i-l+1,P=Math.log(A),k=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*k*(A-k)/A)*(D-A/2<0?-1:1);rC(r,e,i,Math.max(l,Math.floor(i-D*k/A+N)),Math.min(d,Math.floor(i+(A-D)*k/A+N)),m)}const _=e[2*i+m];let v=l,S=d;for(ev(r,e,l,i),e[2*d+m]>_&&ev(r,e,l,d);v<S;){for(ev(r,e,v,S),v++,S--;e[2*v+m]<_;)v++;for(;e[2*S+m]>_;)S--}e[2*l+m]===_?ev(r,e,l,S):(S++,ev(r,e,S,d)),S<=i&&(l=S+1),i<=S&&(d=S-1)}}function ev(r,e,i,l){iT(r,i,l),iT(e,2*i,2*l),iT(e,2*i+1,2*l+1)}function iT(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function sC(r,e,i,l){const d=r-i,m=e-l;return d*d+m*m}s.$=Sp,s.A=Ks,s.B=ql,s.C=2,s.D=X_,s.E=pl,s.F=Nx,s.G=C2,s.H=sd,s.I=Vs,s.J=ug,s.K=Ln,s.L=Rn,s.M=_h,s.N=wd,s.O=Jc,s.P=Mt,s.Q=bh,s.R=us,s.S=Yp,s.T=hw,s.U=xc,s.V=ab,s.W=jl,s.X=Gr,s.Y=fh,s.Z=js,s._=ao,s.a=function(r){return es.API_CDN_URL_REGEX.test(r)},s.a$=xt,s.a0=ad,s.a1=ah,s.a2=Uf,s.a3=class extends ab{},s.a4=Td,s.a5=yc,s.a6=Ze,s.a7=function(r){const e=r.value;return e?ad(e)?qw(e,!0)?[]:[new ab(r.key,e,`invalid url "${e}"`)]:[new ab(r.key,e,`string expected, "${Ln(e)}" found`)]:[]},s.a8=Ad,s.a9=wr,s.aA=xe,s.aB=ft,s.aC=vs,s.aD=ee,s.aE=mo,s.aF=Fe,s.aG=kt,s.aH=function(r,e){const i={};for(let l=0;l<e.length;l++){const d=e[l];d in r&&(i[d]=r[d])}return i},s.aI=Pe,s.aJ=We,s.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,l){const d=this.entries[r]=this.entries[r]||{callbacks:[]};if(d.result){const[m,_]=d.result;return this.scheduler?this.scheduler.add(()=>{l(m,_)},e):l(m,_),()=>{}}return d.callbacks.push(l),d.cancel||(d.cancel=i((m,_)=>{d.result=[m,_];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,_)},e):v(m,_);setTimeout(()=>delete this.entries[r],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==l),d.callbacks.length||(d.cancel(),delete this.entries[r]))}}},s.aL=function(r,e,i){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},d=>{const m=Nc(r.request,(_,v,S)=>{_?d(_):v&&d(null,{rawData:v,vectorTile:i?void 0:new mi(new q0(v)),responseHeaders:new Map(S.entries())})});return()=>{m.cancel(),d()}},e)},s.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=Ml,s.aO=function(r){So++,So>nh&&(r.getActor().send("enforceCacheSizeLimit",td),So=0)},s.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},s.aQ=ua,s.aR=oI,s.aS=fI,s.aT=ge,s.aU=aI,s.aV=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<r.length;l++){const d=document.createElement("source");ih(r[l])||(i.crossOrigin="Anonymous"),d.src=r[l],i.appendChild(d)}return{cancel:()=>{}}},s.aW=Px,s.aX=Kg,s.aY=tn,s.aZ=Vx,s.a_=lt,s.aa=Ot,s.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return nr(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Cn(r.x,e.x,i),y:Cn(r.y,e.y,i),z:Cn(r.z,e.z,i),azimuthal:Cn(r.azimuthal,e.azimuthal,i),polar:Cn(r.polar,e.polar,i)}}},s.ac=Pi,s.ad=wa,s.ae=qt,s.af=cr,s.ag=dn,s.ah=Be,s.ai=La,s.aj=Fh,s.ak=Cn,s.al=jt,s.am=rd,s.an=ai,s.ao=Si,s.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,l]){const d=nr([1,i,l]);return{x:d.x,y:d.y,z:d.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Cn(r.x,e.x,i),y:Cn(r.y,e.y,i),z:Cn(r.z,e.z,i)}}},s.aq=function(r,e,i=0,l=!0){const d=new Mt(i,i),m=r.sub(d),_=e.add(d),v=[m,new Mt(_.x,m.y),_,new Mt(m.x,_.y)];return l&&v.push(m.clone()),v},s.ar=function(r,e){const i=[];for(let l=0;l<r.length;l++){const d=it(l-1,-1,r.length-1),m=it(l+1,-1,r.length-1),_=r[l],v=r[m],S=r[d].sub(_).unit(),A=v.sub(_).unit(),D=A.angleWithSep(S.x,S.y),P=S.add(A).unit().mult(-1*e/Math.sin(D/2));i.push(_.add(P))}return i},s.as=H2,s.at=il,s.au=function(r,e,i=0){return wt(((e.x-i)*r.scale-r.x)*jt,(e.y*r.scale-r.y)*jt,Qe(e.z,e.y))},s.av=ui,s.aw=Gn,s.ax=Ji,s.ay=i2,s.az=function(r){let e=1/0,i=1/0,l=-1/0,d=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),l=Math.max(l,m.x),d=Math.max(d,m.y);return{min:new Mt(e,i),max:new Mt(l,d)}},s.b=function(r){return es.API_FONTS_REGEX.test(r)},s.b$=q,s.b0=xs,s.b1=Tc,s.b2=Dt,s.b3=im,s.b4=nb,s.b5=function(){No.isLoading()||No.isLoaded()||zu()!=="deferred"||Wp()},s.b6=Kp,s.b7=Vn,s.b8=Yg,s.b9=ir,s.bA=Xe,s.bB=je,s.bC=Je,s.bD=function(r,e){const{x:i,y:l}=r.point,d=z_(i,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ft(d,d,or(lu(e)))},s.bE=W,s.bF=Ti,s.bG=Kn,s.bH=wn,s.bI=jr,s.bJ=zi,s.bK=ny,s.bL=ec,s.bM=Cw,s.bN=function(r,e,i,l,d){const m=5*e+2;r.float32[m+0]=i,r.float32[m+1]=l,r.float32[m+2]=d},s.bO=ay,s.bP=Vi,s.bQ=Ca,s.bR=bs,s.bS=_u,s.bT=it,s.bU=function(r,e,i,l){var d=new V(4);return d[0]=r,d[1]=e,d[2]=i,d[3]=l,d},s.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,d=Math.floor(r.x),m=Math.floor((r.x-d)*l),_=Math.floor(r.y*l),v=this.findDEMTileFor(new ua(i,d,i,m,_));return!(!v||!v.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||r.y<0||r.y>1)return e;const d=l.getSource().maxzoom,m=1<<d,_=Math.floor(r.x),v=r.x-_,S=new ua(d,_,d,Math.floor(v*m),Math.floor(r.y*m)),A=this.findDEMTileFor(S);if(!A||!A.dem)return e;const D=A.dem,P=1<<A.tileID.canonical.z,k=(v*P-A.tileID.canonical.x)*D.dim,N=(r.y*P-A.tileID.canonical.y)*D.dim,U=Math.floor(k),Z=Math.floor(N);return(i?this.exaggeration():1)*Cn(Cn(D.get(U,Z),D.get(U,Z+1),N-Z),Cn(D.get(U+1,Z),D.get(U+1,Z+1),N-Z),k-U)}static getAtTileOffset(r,e,i,l){const d=1<<r.canonical.z;return l?l.pointElevation(e):i?i.getAtPointOrZero(new qt(r.wrap+(r.canonical.x+e.x/jt)/d,(r.canonical.y+e.y/jt)/d)):0}static getAtTileOffsetFunc(r,e,i,l){return(d,m,_)=>{const v=this.getAtTileOffset(r,d,m,_),S=l.upVector(r.canonical,d.x,d.y);return Ne(S,S,v*l.upVectorScale(r.canonical,e,i).metersToTile),S}}getForTilePoints(r,e,i,l){if(this.isUsingMockSource())return!1;const d=oy.create(this,r,l);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,d=1<<r.canonical.z-l.canonical.z;let m=r.canonical.x/d-l.canonical.x,_=r.canonical.y/d-l.canonical.y,v=0;for(let S=0;S<r.canonical.z-l.canonical.z&&!i.leaves[v];S++){m*=2,_*=2;const A=2*Math.floor(_)+Math.floor(m);v=i.childOffsets[v]+A,m%=1,_%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const d of r){const m=this.getMinMaxForTile(d.tileID);m&&(i=Math.min(i,m.min),l=Math.max(l,m.max),e=!0)}return e?{min:i,max:l}:null}},s.bW=k0,s.bX=Tr,s.bY=ha,s.bZ=jg,s.b_=pI,s.ba=vw,s.bb=$u,s.bc=Mn,s.bd=iu,s.be=Ld,s.bf=ix,s.bg=mr,s.bh=Ql,s.bi=jw,s.bj=function(r,e){const i=Fh(e.zoom);if(i===0)return lu(r);const l=lm(r),d=sx(l),m=Fe(l.getWest())*e.worldSize,_=Fe(l.getEast())*e.worldSize,v=We(l.getNorth())*e.worldSize,S=We(l.getSouth())*e.worldSize,A=[m,v,0],D=[_,v,0],P=[m,S,0],k=[_,S,0],N=st([],e.globeMatrix);return cr(A,A,N),cr(D,D,N),cr(P,P,N),cr(k,k,N),d[0]=Uu(d[0],P,i),d[1]=Uu(d[1],k,i),d[2]=Uu(d[2],D,i),d[3]=Uu(d[3],A,i),Ii.fromPoints(d)},s.bk=Ag,s.bl=st,s.bm=Sg,s.bn=Uu,s.bo=Hl,s.bp=q1,s.bq=ze,s.br=ht,s.bs=fb,s.bt=q0,s.bu=Nc,s.bv=function(r,e){const i=[];for(const l in r)l in e||i.push(l);return i},s.bw=Ge,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=no,s.bz=Ye,s.c=ws,s.c$=function(r,e,i){let l=0;for(let d=0;d<2;++d)r[d]>0&&(l+=(r[d]-0)*(r[d]-0)),e[d]<0&&(l+=(0-e[d])*(0-e[d]));return l},s.c0=ce,s.c1=Sw,s.c2=O2,s.c3=kw,s.c4=tT,s.c5=Ne,s.c6=_r,s.c7=Tn,s.c8=function(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+d*v,r[1]=d*S-l*v,r[2]=m*S+_*v,r[3]=_*S-m*v,r},s.c9=ri,s.cA=be,s.cB=Ps,s.cC=UA,s.cD=Ac,s.cE=L_,s.cF=function(r,e,i,l,d,m,_,v,S){if(S.name==="globe")return L_(r,e,new Ac(i,l,d),!1);const A=Vx({z:i,x:l,y:d},S);return new Ii([(m+A.x/A.scale)*e,e*(A.y/A.scale),_],[(m+A.x2/A.scale)*e,e*(A.y2/A.scale),v])},s.cG=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},s.cH=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},s.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return ne[e]},s.cJ=ke,s.cK=Rl,s.cL=6,s.cM=function(r){const e=Xe(new Float64Array(16));ft(e,r.pixelMatrix,r.globeMatrix);const i=[0,fe,0],l=[0,ue,0];return cr(i,i,e),cr(l,l,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!np(r,new ge(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!np(r,new ge(r.center.lat,-90))]},s.cN=function(r,e){const{scale:i}=r.tileTransform,l=i*jt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(d,m,_){var v=m[1],S=m[2],A=m[3],D=_[0],P=_[1];return d[0]=m[0]*D,d[1]=v*D,d[2]=S*P,d[3]=A*P,d})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.cO=B0,s.cP=et,s.cQ=jA,s.cR=function(r){const e=jA(r,!0);return W([],[e[0],e[1],e[4],e[5]])},s.cS=Ft,s.cT=zr,s.cU=fn,s.cV=function(r){const{x:e,y:i}=r.point,{lng:l,lat:d}=r._center;return z_(e,i,r.worldSize,l,d)},s.cW=tt,s.cX=Ue,s.cY=Vd,s.cZ=Kl,s.c_=5,s.ca=hr,s.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.cc=qe,s.cd=function(r,e,i,l,d){var m=1/Math.tan(e/2);if(r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0){var _=1/(l-d);r[10]=(d+l)*_,r[14]=2*d*l*_}else r[10]=-1,r[14]=-2*l;return r},s.ce=function(r,e,i,l,d,m,_){var v=1/(e-i),S=1/(l-d),A=1/(m-_);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+i)*v,r[13]=(d+l)*S,r[14]=(_+m)*A,r[15]=1,r},s.cf=$e,s.cg=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.ch=$r,s.ci=Bd,s.cj=ds,s.ck=Vo,s.cl=Oh,s.cm=Y2,s.cn=function(){var r=new V(4);return V!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.co=function(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+m*v,r[1]=d*S+_*v,r[2]=l*-v+m*S,r[3]=d*-v+_*S,r},s.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cq=ur,s.cr=function(r){var e=r[0],i=r[1],l=r[2],d=r[3];return Math.sqrt(e*e+i*i+l*l+d*d)},s.cs=ps,s.ct=Hn,s.cu=k_,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Va,s.d=function(r){return es.API_TILEJSON_REGEX.test(r)},s.d$=class{constructor(r,e,i,l){this.context=r,this.format=l,this.size=i,this.texture=r.gl.createTexture();const[d,m,_]=this.size,{gl:v}=r;v.bindTexture(v.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,m,_,0,cw(this.format),uw(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_3D,this.texture),r!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,r),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.d0=function(r){return r*r*r*r*r},s.d1=Le,s.d2=45,s.d3=is,s.d4=function(r,e,i){const l=Math.sqrt(r*r+e*e+i*i),d=l>0?Math.acos(i/l)*Lc:0;let m=r!==0||e!==0?Math.atan2(-e,-r)*Lc+90:0;return m<0&&(m+=360),[l,m,d]},s.d5=wt,s.d6=nr,s.d7=Pt,s.d8=En,s.d9=Ii,s.dA=function(r){return r({pluginStatus:ka,pluginURL:nu}),Zp.on("pluginStateChange",r),r},s.dB=ho,s.dC=class extends xl{constructor(r){super(r),this.current=tx}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dD=ae,s.dE=function(r,e,i){const l=Fh(i.zoom),d=r.style.map._antialias,m=r.terrain&&r.terrain.exaggeration()>0;return l===0&&!d&&!m},s.dF=function(r){const e=r.pixelsPerMeter,i=e/$e(1,r.center.lat),l=Xe(new Float64Array(16));return ht(l,l,[r.point.x,r.point.y,0]),Ft(l,l,[i,i,e]),Float32Array.from(l)},s.dG=lm,s.dH=function(r){const e=80.051129;r=xe(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ai(r))),3);return Math.round(i*(pe.length-1))},s.dI=function(r,e,i,l){const d=e.getNorth(),m=e.getSouth(),_=e.getWest(),v=e.getEast(),S=1<<r.z,A=v-_,D=d-m,P=A/re,k=-D/pe[i],N=[0,P,0,k,0,0,d,_,0];if(r.z>0){const U=180/l;he(N,N,[U/A+1,0,0,0,U/D+1,0,-.5*U/P,.5*U/k,1])}return N[2]=S,N[5]=r.x,N[8]=r.y,N},s.dJ=lu,s.dK=function(r,e,i){const l=Xe(new Float64Array(16)),d=(e/(1<<r)-.5)*Math.PI*2;return St(l,i.globeMatrix,d),Float32Array.from(l)},s.dL=f0,s.dM=Tg,s.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dO=Q,s.dP=function(r,e){var i=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=i,r[2]=0,r[3]=-i,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dQ=Bs,s.dR=Cg,s.dS=Ei,s.dT=dr,s.dU=Uw,s.dV=function(r,e){const i=[0,0,0];return cr(i,i,Ag(lu(e.canonical))),cr(i,i,r),i},s.dW=r=>({u_matrix:new Oh(r),u_texsize:new Vo(r),u_pixels_to_tile_units:new n(r),u_device_pixel_ratio:new ds(r),u_width_scale:new ds(r),u_floor_width_scale:new ds(r),u_image:new $r(r),u_units_to_pixels:new Vo(r),u_tile_units_to_pixels:new ds(r),u_alpha_discard_threshold:new ds(r),u_trim_offset:new Vo(r),u_trim_fade_range:new Vo(r),u_trim_gradient_mix_range:new Vo(r),u_trim_color:new is(r),u_zbias_factor:new ds(r),u_tile_to_meter:new ds(r),u_ground_shadow_factor:new Bd(r),u_pattern_transition:new ds(r)}),s.dX=r=>({u_matrix:new Oh(r),u_pixels_to_tile_units:new n(r),u_device_pixel_ratio:new ds(r),u_width_scale:new ds(r),u_floor_width_scale:new ds(r),u_units_to_pixels:new Vo(r),u_dash_image:new $r(r),u_gradient_image:new $r(r),u_image_height:new ds(r),u_texsize:new Vo(r),u_tile_units_to_pixels:new ds(r),u_alpha_discard_threshold:new ds(r),u_trim_offset:new Vo(r),u_trim_fade_range:new Vo(r),u_trim_gradient_mix_range:new Vo(r),u_trim_color:new is(r),u_zbias_factor:new ds(r),u_tile_to_meter:new ds(r),u_ground_shadow_factor:new Bd(r)}),s.dY=r=>({u_camera_to_center_distance:new ds(r),u_extrude_scale:new n(r),u_device_pixel_ratio:new ds(r),u_matrix:new Oh(r),u_inv_rot_matrix:new Oh(r),u_merc_center:new Vo(r),u_tile_id:new Bd(r),u_zoom_transition:new ds(r),u_up_dir:new Bd(r),u_emissive_strength:new ds(r)}),s.dZ=Yf,s.d_=pO,s.da=ci,s.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.dc=VA,s.dd=_w,s.de=HA,s.df=qw,s.dg=function(r,e){return r.readFields(d3,{icons:[]},e)},s.dh=L0,s.di=iy,s.dj=Mw,s.dk=Sr,s.dl=ag,s.dm=ga,s.dn=ro,s.dp=kn,s.dq=function(r){const e=r.indexOf(Cd);return e>=0?r.slice(0,e):r},s.dr=function(r){return r.indexOf(Cd)>=0},s.ds=function(r){const e=r.lastIndexOf(Cd);return e>=0?r.slice(e+1):""},s.dt=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.du=function(r,e,i,l){return r.type==="custom"?new a3(r,e):new h3[r.type](r,e,i,l)},s.dv=bn,s.dw=function(r){const e=r.indexOf(Cd);return e>=0?r.slice(e+1):""},s.dx=class extends Yg{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.dy=Zp,s.dz=_a,s.e=es,s.e$=Jt,s.e0=c0,s.e1=(r,e,i,l,d,m)=>{const _=r.transform,v=_.projection.name==="globe";let S;if(m.paint.get("circle-pitch-alignment")==="map")if(v){const D=Cg(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;S=Float32Array.from([D,0,0,D])}else S=_.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ua.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Z1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){A.u_inv_rot_matrix=l,A.u_merc_center=d,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Fh(_.zoom);const D=d[0]*jt,P=d[1]*jt;A.u_up_dir=_.projection.upVector(new Ac(0,0,0),D,P)}return A},s.e2=o2,s.e3=so,s.e4=(r,e,i,l,d,m,_,v,S,A)=>{const D=r.transform,P=D.pitch<15?r2(.07,.7,xe((14-D.zoom)/5,0,1)):.07,k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:a2(r,e,i,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:m,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:s2(e,D),u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:P,u_tile_to_meter:Pt(e.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:A}},s.e5=(r,e,i,l,d,m,_,v,S,A)=>{const D=r.transform,P=D.calculatePixelsToTileUnitsMatrix(e),k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=D.pitch<15?r2(.07,.7,xe((14-D.zoom)/5,0,1)):.07;return{u_matrix:a2(r,e,i,l),u_pixels_to_tile_units:P,u_device_pixel_ratio:m,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:l2(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:s2(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:N,u_tile_to_meter:Pt(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e6=It,s.e7=cm,s.e8=Qe,s.e9=jd,s.eA=function(r,e){var i=2*Math.acos(e[3]),l=Math.sin(i/2);return l>B?(r[0]=e[0]/l,r[1]=e[1]/l,r[2]=e[2]/l):(r[0]=1,r[1]=0,r[2]=0),i},s.eB=Zw,s.eC=j0,s.eD=V0,s.eE=[1,1,1],s.eF=oy,s.eG=Xs,s.eH=function(r,e,i,l){var d=e[0],m=e[1],_=e[2],v=e[3];return r[0]=d+l*(i[0]-d),r[1]=m+l*(i[1]-m),r[2]=_+l*(i[2]-_),r[3]=v+l*(i[3]-v),r},s.eI=J_,s.eJ=nl,s.eK=Vu,s.eL=function(r,e,i,l,d,m,_,v,S,A,D,P,k,N,U,Z){var K=new V(16);return K[0]=r,K[1]=e,K[2]=i,K[3]=l,K[4]=d,K[5]=m,K[6]=_,K[7]=v,K[8]=S,K[9]=A,K[10]=D,K[11]=P,K[12]=k,K[13]=N,K[14]=U,K[15]=Z,K},s.eM=Ae,s.eN=kh,s.eO=kd,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=g(new Mt(0,0),new Mt(jt,jt),r),l=[];if(e&&!ym(i,this._globalClipBounds))return l;for(const d of this._activeRegions){if(d.hiddenByOverlap||!ym(i,d))continue;const m=w(d.min,d.max,r);l.push({min:m.min,max:m.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return l}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const l of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(l).buckets[e.layer];d&&d.updateFootprints(l.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),l=r.getClipMask(),d=r.getClipScope();for(const m of e){if(!m.footprint)continue;const _=g(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:i,clipMask:l,clipScope:d})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ug(e.min,i.min)||Ug(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(l,d){const m=(_,v)=>_+v;return l.length-d.length||l.reduce(m,"").localeCompare(d.reduce(m,""))})(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],l=this._prevRegions[e];r=i.priority!==l.priority||!D0(i,l)||i.order!==l.order||i.clipMask!==l.clipMask||!no(i.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==_m&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const l=this._activeRegions;if(i>=l.length)return i;const d=l[i].priority;for(;i<l.length&&l[i].priority===d;)++i;return i};if(this._sourceIds.length>1){let i=0,l=e(i);for(;i!==l;){let d=i;const m=i;for(;d!==l;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let v=0;v<m;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&_.order===_m&&ym(_,S)&&(_.hiddenByOverlap=F(_.footprint,_.tileId,S.footprint,S.tileId),_.hiddenByOverlap))break}++d}i=l,l=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eQ=_m,s.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new iu,l=new xs,d=[],m=r+1+2,_=e[0]+1,v=e[0]+1+(1+e.length),S=(A,D,P)=>{let k=A===m-1?A-2:A===0?A:A-1;return k+=P?24575:0,[k,D]};for(let A=0;A<m;++A)i.emplaceBack(...S(A,0,!0));for(let A=0;A<_;++A)for(let D=0;D<m;++D)i.emplaceBack(...S(D,A,(D===0||D===m-1)&&!0));for(let A=0;A<e.length;++A){const D=e[A];for(let P=0;P<m;++P)i.emplaceBack(...S(P,D,!0))}for(let A=0;A<e.length;++A){const D=l.length,P=e[A]+1+2,k=new xs;for(let Z=0;Z<P-1;Z++){const K=Z===P-2,X=K?m*(v-e.length+A-Z):m;for(let te=0;te<m-1;te++){const se=Z*m+te;Z===0||K||te===0||te===m-2?(k.emplaceBack(se+1,se,se+X),k.emplaceBack(se+X,se+X+1,se+1)):(l.emplaceBack(se+1,se,se+X),l.emplaceBack(se+X,se+X+1,se+1))}}const N=mr.simpleSegment(0,D,i.length,l.length-D);for(let Z=0;Z<k.uint16.length;Z+=3)l.emplaceBack(k.uint16[Z],k.uint16[Z+1],k.uint16[Z+2]);const U=mr.simpleSegment(0,D,i.length,l.length-D);d.push({withoutSkirts:N,withSkirts:U})}return{vertices:i,indices:l,segments:d}}_createGrid(r){const e=this._fillGridMeshWithLods(re,pe);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,ix.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new xs;for(let _=0;_<=re;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Fu,l=new Fu,d=new Fu,m=new Fu;this._poleSegments=[];for(let _=0,v=0;_<5;_++){const S=360/(1<<_);i.emplaceBack(0,-ee,0,.5,0),l.emplaceBack(0,-ee,0,.5,1),d.emplaceBack(0,-ee,0,.5,.5),m.emplaceBack(0,-ee,0,.5,.5);for(let A=0;A<=re;A++){let D=A/re,P=0;const k=Cn(0,S,D),[N,U,Z]=Ie($1,l0,k,ee);i.emplaceBack(N,U,Z,D,P),l.emplaceBack(N,U,Z,D,1-P);const K=ai(k);D=.5+.5*Math.sin(K),P=.5+.5*Math.cos(K),d.emplaceBack(N,U,Z,D,P),m.emplaceBack(N,U,Z,D,1-P)}this._poleSegments.push(mr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Ud,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,Ud,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(d,Ud,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(m,Ud,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eS=Ax,s.eT=ye,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=De,s.eW=yt,s.eX=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},s.eY=Qi,s.eZ=Te,s.e_=Ci,s.ea=cu,s.eb=dA,s.ec=fi,s.ed=450,s.ee=7,s.ef=nt,s.eg=function(r,e){if(r===e){var i=e[1],l=e[2],d=e[3],m=e[6],_=e[7],v=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=l,r[9]=m,r[11]=e[14],r[12]=d,r[13]=_,r[14]=v}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.eh=s3,s.ei=ei,s.ej=mg,s.ek=256,s.el=or,s.em=tl,s.en=St,s.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.ep=Fu,s.eq=Qm,s.er=Pd,s.es=function(r,e,i,l,d){return xe((r-e)/(i-e)*(d-l)+l,l,d)},s.et=Oi,s.eu=function(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8],P=D*_-v*A,k=-D*m+v*S,N=A*m-_*S,U=i*P+l*k+d*N;return U?(r[0]=P*(U=1/U),r[1]=(-D*l+d*A)*U,r[2]=(v*l-d*_)*U,r[3]=k*U,r[4]=(D*i-d*S)*U,r[5]=(-v*i+d*m)*U,r[6]=N*U,r[7]=(-A*i+l*S)*U,r[8]=(_*i-l*m)*U,r):null},s.ev=2,s.ew=Xi,s.ex=en,s.ey=Ke,s.ez=function(r,e){var i=new V(3);Ke(i,e);var l=1/i[0],d=1/i[1],m=1/i[2],_=e[0]*l,v=e[1]*d,S=e[2]*m,A=e[4]*l,D=e[5]*d,P=e[6]*m,k=e[8]*l,N=e[9]*d,U=e[10]*m,Z=_+D+U,K=0;return Z>0?(K=2*Math.sqrt(Z+1),r[3]=.25*K,r[0]=(P-N)/K,r[1]=(k-S)/K,r[2]=(v-A)/K):_>D&&_>U?(K=2*Math.sqrt(1+_-D-U),r[3]=(P-N)/K,r[0]=.25*K,r[1]=(v+A)/K,r[2]=(k+S)/K):D>U?(K=2*Math.sqrt(1+D-_-U),r[3]=(k-S)/K,r[0]=(v+A)/K,r[1]=.25*K,r[2]=(P+N)/K):(K=2*Math.sqrt(1+U-_-D),r[3]=(v-A)/K,r[0]=(k+S)/K,r[1]=(P+N)/K,r[2]=.25*K),r},s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.f0=function([r,e,i]){const l=Math.hypot(r,e,i),d=Math.atan2(r,i),m=.5*Math.PI-Math.acos(-e/l);return new ge(Ue(d),Ue(m))},s.f1=rc,s.f2=dw,s.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(hi==null){const l=i.navigator?i.navigator.userAgent:null;hi=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return hi})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(r,e){td=r,nh=e},s.f5=np,s.f6=O_,s.f7=function(r){const e=[0,0,0],i=Xe(new Float64Array(16));return ft(i,r.pixelMatrix,r.globeMatrix),cr(e,e,i),new Mt(e[0],e[1])},s.f8=function(){const r=Rx;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(iw),Rx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){L0().acquire(iw)},s.fA=db,s.fB=ti,s.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==zA){const i=new Uint32Array(r,0,7),[,,l,d,m,_]=i;e=i.byteLength+d+m+_+m,(l!==r.byteLength||e>=r.byteLength)&&Pn("Invalid b3dm header information.")}return FA(r,e)},s.fD=function(r,e){const i=_w(r);for(const l of i){for(const d of l.meshes)Oz(d);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(Nz(l.lights,e)))}return i},s.fE=ob,s.fF=br,s.fG=EA,s.fH=No,s.fI=Wa,s.fJ=function(r){Ss(),Es!=null&&Es.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-r;l++)e.delete(i[l]).catch(d=>Pn(d.message))}).catch(i=>Pn(i.message))}).catch(e=>Pn(e.message))},s.fa=zu,s.fb=function(r,e,i=!1){if(ka===Wa.deferred||ka===Wa.loading||ka===Wa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");nu=Ua.resolveURL(r),ka=Wa.deferred,tu=e,og(),i||Wp()},s.fc=function(r){Y_=Ua.resolveURL(r),K_||(K_=new X_(L0(),new pl)),K_.broadcast("setMeshoptUrl",Y_)},s.fd=IA,s.fe=function(r){aw=Ua.resolveURL(r),K_||(K_=new X_(L0(),new pl)),K_.broadcast("setDracoUrl",aw)},s.ff=AA,s.fg=Cx,s.fh=function(r){const e=Eo();if(!e)return;const i=e.delete(pf);r&&i.then(()=>r()).catch(r)},s.fi=qg,s.fj=Bt,s.fk=Gu,s.fl=2,s.fm=eC,s.fn=tC,s.fo=e2,s.fp=li,s.fq="hd_road_elevation",s.fr=ca,s.fs=yn,s.ft=qu,s.fu=Rw,s.fv=1,s.fw=function(r,e,i,l,d,m,_,v=1,S,A,D,P){r.createArrays(),r.tilePixelRatio=jt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const k=r.layers[0].layout,N=r.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=v,U.textSizeScaleRange=k.get("text-size-scale-range"),U.iconSizeScaleRange=k.get("icon-size-scale-range");const[Z,K]=U.textSizeScaleRange,[X,te]=U.iconSizeScaleRange;U.textScaleFactor=xe(U.scaleFactor,Z,K),U.iconScaleFactor=xe(U.scaleFactor,X,te);const se=N["text-size"],le=N["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Me,maxZoom:Oe}=r.textSizeData;U.compositeTextSizes=[se.possiblyEvaluate(new Pi(Me,{worldview:D}),m),se.possiblyEvaluate(new Pi(Oe,{worldview:D}),m)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Me,maxZoom:Oe}=r.iconSizeData;U.compositeIconSizes=[le.possiblyEvaluate(new Pi(Me,{worldview:D}),m,P),le.possiblyEvaluate(new Pi(Oe,{worldview:D}),m,P)]}U.layoutTextSize=se.possiblyEvaluate(new Pi(_+1,{worldview:D}),m),U.layoutIconSize=le.possiblyEvaluate(new Pi(_+1,{worldview:D}),m,P),U.textMaxSize=se.possiblyEvaluate(new Pi(18,{worldview:D}),m);const _e=k.get("symbol-placement"),me=k.get("text-rotation-alignment")==="map"&&_e!=="point",Ee=k.get("text-size");let Se=!1;const we=[];for(const Me of r.features){const Oe=k.get("text-font").evaluate(Me,{},m).join(","),pt=Ee.evaluate(Me,{},m)*U.textScaleFactor,ot=U.layoutTextSize.evaluate(Me,{},m)*U.textScaleFactor,ut=U.layoutIconSize.evaluate(Me,{},m,P)*U.iconScaleFactor,Tt={horizontal:{},vertical:void 0},vt=Me.text;let bt,rt=[0,0];if(vt){const xi=vt.toString(),as=k.get("text-letter-spacing").evaluate(Me,{},m)*ha,wi=k.get("text-line-height").evaluate(Me,{},m)*ha,Ui=I_(xi)?as:0,Er=k.get("text-anchor").evaluate(Me,{},m),Nr=k.get("text-variable-anchor");if(!Nr){const ks=k.get("text-radial-offset").evaluate(Me,{},m);if(ks)rt=O2(Er,[ks*ha,Pw]);else{const Hs=k.get("text-offset").evaluate(Me,{},m);rt=[Hs[0]*ha,Hs[1]*ha]}}let Br=me?"center":k.get("text-justify").evaluate(Me,{},m);const os=_e==="point",Ea=os?k.get("text-max-width").evaluate(Me,{},m)*ha:1/0,Ya=ks=>{r.allowVerticalPlacement&&$p(xi)&&(Tt.vertical=Ew(vt,e,i,d,Oe,Ea,wi,Er,ks,Ui,rt,ec.vertical,!0,ot,pt,S))};if(!me&&Nr){const ks=Br==="auto"?Nr.map(na=>kw(na)):[Br];let Hs=!1;for(let na=0;na<ks.length;na++){const Yn=ks[na];if(!Tt.horizontal[Yn])if(Hs)Tt.horizontal[Yn]=Tt.horizontal[0];else{const Fr=Ew(vt,e,i,d,Oe,Ea,wi,"center",Yn,Ui,rt,ec.horizontal,!1,ot,pt,S);Fr&&(Tt.horizontal[Yn]=Fr,Hs=Fr.positionedLines.length===1)}}Ya("left")}else{if(Br==="auto"&&(Br=kw(Er)),os||k.get("text-writing-mode").indexOf("horizontal")>=0||!$p(xi)){const ks=Ew(vt,e,i,d,Oe,Ea,wi,Er,Br,Ui,rt,ec.horizontal,!1,ot,pt,S);ks&&(Tt.horizontal[Br]=ks)}Ya(os?"left":Br)}}let At,_t,Ct,Et,nn,rn,Ht=!1;const Wt=k.get("icon-text-fit").evaluate(Me,{},m);if(Me.icon&&Me.icon.hasPrimary()){const xi=Fx(Me.icon,r.iconSizeData,N["icon-size"],m,r.zoom,Me,S,U.iconScaleFactor,D,P);At=xi.iconPrimary,Ct=xi.iconSecondary;const as=At.toString();if(_t=l.get(as),_t&&(nn=k.get("icon-offset").evaluate(Me,{},m),rn=k.get("icon-anchor").evaluate(Me,{},m),bt=$0(d.get(as),Ct?d.get(Ct.toString()):void 0,nn,rn),Ht=_t.sdf,r.sdfIcons===void 0?r.sdfIcons=_t.sdf:r.sdfIcons!==_t.sdf&&Pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==r.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ct){const wi=Ct.toString();Et=l.get(wi)}}Se=Se||!(!Me.icon||!Me.icon.hasSecondary());const An=K0(Tt.horizontal)||Tt.vertical;r.iconsInText||(r.iconsInText=!!An&&An.iconsInText);const _n=ot*U.textScaleFactor/ha,{defaultShapedIcon:Qt,verticallyShapedIcon:Nn}=HO(r,bt,k,Me,m,Tt,_n,nn,Wt);Wt!=="none"&&bt&&(v2(bt)||b2(bt))&&(Y0(0,_t,At,bt,Qt,Wt,A,l,d),Y0(0,Et,Ct,bt,Qt,Wt,A,l,d),Nn&&(Y0(0,_t,At,bt,Nn,Wt,A,l,d),Y0(0,Et,Ct,bt,Nn,Wt,A,l,d))),bt=Qt;const{iconBBox:ii,iconVerticalBBox:Di,textBBox:Qn,textVerticalBBox:Zi}=VO(r,bt,Nn,k,Me,m,ut,nn,U,d,rn,Tt,ot,rt,P);we.push({feature:Me,shapedTextOrientations:Tt,shapedText:An,shapedIcon:bt,iconPrimary:At,iconSecondary:Ct,iconOffset:nn,iconAnchor:rn,verticallyShapedIcon:Nn,layoutTextSize:ot,layoutIconSize:ut,textOffset:rt,isSDFIcon:Ht,iconTextFit:Wt,iconCollisionBounds:ii,iconVerticalCollisionBounds:Di,textCollisionBounds:Qn,textVerticalCollisionBounds:Zi})}return{featureData:we,sizes:U,hasAnySecondaryIcon:Se,textAlongLine:me,symbolPlacement:_e}},s.fx=R2,s.fy=function(r,e,i,l,d,m,_,v,S,A){r.iconAtlasPositions=A.iconPositions;const{featureData:D,hasAnySecondaryIcon:P,sizes:k,textAlongLine:N,symbolPlacement:U}=e;for(const Z of D){const{shapedIcon:K,verticallyShapedIcon:X,feature:te,shapedTextOrientations:se,shapedText:le,layoutTextSize:_e,textOffset:me,isSDFIcon:Ee,iconPrimary:Se,iconSecondary:we,iconTextFit:Me,iconOffset:Oe,iconCollisionBounds:pt,iconVerticalCollisionBounds:ot,textCollisionBounds:ut}=Z;V2(K,A.iconPositions,Se,we),V2(X,A.iconPositions,Se,we),qO(se,A.iconPositions),GO(Se,we,A.iconPositions),(le||K)&&$O(r,te,se,K,X,S,k,_e,0,me,Ee,l,d,_,v,P,Me,Oe,N,U,pt,ot,ut)}i&&r.generateCollisionDebugBuffers(m,r.collisionBoxArray,k.textScaleFactor)},s.fz=mi,s.g=function(r,e){return _a(Object.assign(r,{method:"GET"}),e)},s.h=function(r){return r.indexOf("mapbox:")===0},s.i=function(r){return es.API_STYLE_REGEX.test(r)&&!ws(r)},s.j=fr,s.k=Ra,s.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(r,e){return _a(Object.assign(r,{type:"json"}),e)},s.n=Co,s.o=Ua,s.p=function(r,e){return _a(Object.assign(r,{method:"POST"}),e)},s.q=ta,s.r=To,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return rw||(rw=new qg("ImageRasterizer")),rw},s.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=Pn,s.x=Kw,s.y=Fc,s.z=Mo}),T(["./shared"],function(s){function B(Ue){const ne=Ue?Ue.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function V(Ue){if(typeof Ue=="number"||typeof Ue=="boolean"||typeof Ue=="string"||Ue==null)return JSON.stringify(Ue);if(Array.isArray(Ue)){let ae="[";for(const ye of Ue)ae+=`${V(ye)},`;return`${ae}]`}let ne="{";for(const ae of Object.keys(Ue).sort())ne+=`${ae}:${V(Ue[ae])},`;return`${ne}}`}function W(Ue){let ne="";for(const ae of s.bx)ne+=`/${V(Ue[ae])}`;return ne}function Q(Ue,ne){return(function ae(ye){return typeof ye=="string"&&ye===ne||(Array.isArray(ye)?ye.some(ae):!(!ye||typeof ye!="object")&&Object.values(ye).some(ae))})(Ue)}class oe{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ae){this._layerConfigs={},this._layers={},this.update(ne,[],ae)}update(ne,ae,ye){this._options=ye;for(const xe of ne)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=s.du(xe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ae)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const De=(function(xe,Be){const it={};for(let at=0;at<xe.length;at++){const Dt=xe[at];let It=Be&&Be[Dt.id];It||(Dt.type==="symbol"?It=Dt.id:(It=W(Dt),Dt.type==="line"&&Dt.paint&&Q(Dt.paint["line-width"],"line-progress")&&(It+=`/${V(Dt.paint["line-width"])}`))),Be&&(Be[Dt.id]=It);let tn=it[It];tn||(tn=it[It]=[]),tn.push(Dt)}const Ge=[];for(const at in it)Ge.push(it[at]);return Ge})(Object.values(this._layerConfigs),this.keyCache);for(const xe of De){const Be=xe.map(tn=>this._layers[tn.id]),it=Be[0];if(it.visibility==="none")continue;const Ge=it.source||"";let at=this.familiesBySource[Ge];at||(at=this.familiesBySource[Ge]={});const Dt=it.sourceLayer||"_geojsonTileLayer";let It=at[Dt];It||(It=at[Dt]=[]),It.push(Be)}}}const he=1*s.fl;class Je{constructor(ne){const ae={},ye=[];for(const it in ne){const Ge=ne[it],at=ae[it]={};for(const Dt in Ge.glyphs){const It=Ge.glyphs[+Dt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const tn=It.metrics.localGlyph?he:1,yn={x:0,y:0,w:It.bitmap.width+2*tn,h:It.bitmap.height+2*tn};ye.push(yn),at[Dt]=yn}}const{w:De,h:xe}=s.G(ye),Be=new s.fk({width:De||1,height:xe||1});for(const it in ne){const Ge=ne[it];for(const at in Ge.glyphs){const Dt=Ge.glyphs[+at];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const It=ae[it][at],tn=Dt.metrics.localGlyph?he:1;s.fk.copy(Dt.bitmap,Be,{x:0,y:0},{x:It.x+tn,y:It.y+tn},Dt.bitmap)}}this.image=Be,this.positions=ae}}function Ye(Ue,ne,ae){Ue[ne]?ae&&(Ue[ne].center=ae):Ue[ne]={floorIds:new Set,center:ae||[0,0],floors:{}}}function Xe(Ue,ne,ae,ye){for(const De of ne)Ye(Ue,De),Ue[De].floors[ae]=ye,Ue[De].floorIds.add(ae)}function st(Ue){return{id:Ue.properties.id.toString(),center:Ue.properties.center.toString().split(";").map(Number)}}function ft(Ue){return{id:Ue.properties.id.toString(),isDefault:!!Ue.properties.is_default&&Ue.properties.is_default,connections:Ue.properties.connected_floor_ids?new Set(Ue.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ue.properties.conflicted_floor_ids?new Set(Ue.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ue.properties.building_ids?new Set(Ue.properties.building_ids.toString().split(";")):new Set,name:Ue.properties.name.toString(),zIndex:Ue.properties.z_index}}function ht(Ue,ne){return ne.every(ae=>Ue.properties&&Ue.properties[ae]!=null)}function Ft(Ue){return ht(Ue,["type","id","name"])&&Ue.properties.type==="building"}function fn(Ue){return ht(Ue,["type","id","name","z_index"])&&Ue.properties.type==="floor"}s.fj(Je,"GlyphAtlas");class St{constructor(ne){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,ae,ye,De,xe,Be){this.status="parsing",this.data=ne,this.collisionBoxArray=new s.b3;const it=new s.fm(Object.keys(ne.layers).sort()),Ge=new s.fn(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const at={},Dt=new s.fo(256,256),It={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Dt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const kn=this.indoor.indoorState.activeFloorsVisible,Fn=(function(vn,Pn,$i){const vr=(function(ir,hi){if(!ir)return s.w("No source layers defined in indoor specification"),hi;if(ir.size===0)return hi;const hr=ir.difference(hi);for(const Ni of hr)s.w(`Missing source layer required in indoor specification: ${Ni}`);return hi.intersection(hi)})(Pn.sourceLayers,new Set(Object.keys(vn.layers))),nr=Pn.indoorState,br=(function(ir,hi,hr,Ni){const _i=new Set,Ei=new Set,dr=new Set,Jr=new Map,es={},fr=ws=>{const Ts=Jr.get(ws)||new Set;for(const ma of _i)if((Jr.get(ma)||new Set).has(ws)||Ts.has(ma))return!0;return!1};for(const ws of hi){const Ts=ir.layers[ws];if(Ts)for(let ma=0;ma<Ts.length;ma++){const _s=Ts.feature(ma);if(Ft(_s)){const{id:sa,center:aa}=st(_s);Ye(es,sa,aa),_i.add(sa);continue}if(fn(_s)){const{id:sa,isDefault:aa,connections:$o,conflicts:To,buildings:Ua,name:dl,zIndex:ga}=ft(_s);Xe(es,Ua,sa,{name:dl,zIndex:ga}),Jr.set(sa,To),(sa===Ni||$o.has(Ni))&&_i.add(sa),Ei.add(sa),aa&&dr.add(sa)}}else s.w(`indoor source layer not found: ${ws}`)}if(hr)for(const ws of hr)Ei.has(ws)&&(fr(ws)||_i.add(ws));for(const ws of dr)_i.has(ws)||fr(ws)||_i.add(ws);return{buildings:es,activeFloors:_i}})(vn,vr,nr.lastActiveFloors,nr.selectedFloorId);return $i.send("setIndoorData",br),br})(ne,this.indoor,xe);It.activeFloors=kn?Fn.activeFloors:void 0}const tn=[],yn=ae.familiesBySource[this.source];for(const kn in yn){const Fn=ne.layers[kn];if(!Fn)continue;let vn=!1,Pn=!1,$i=!1;for(const hi of yn[kn])hi[0].type==="symbol"?vn=!0:Pn=!0,hi[0].is3D()&&hi[0].type!=="model"&&($i=!0);if(this.extraShadowCaster&&!$i||this.isSymbolTile===!0&&!vn||this.isSymbolTile===!1&&!Pn)continue;Fn.version===1&&s.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vr=it.encode(kn),nr=[],br=this.localizableLayerIds&&this.localizableLayerIds.has(kn);let ir=!1;for(let hi=0,hr=0;hi<Fn.length;hi++){const Ni=Fn.feature(hi),_i=Ge.getId(Ni,kn),Ei=Ni.properties?Ni.properties.worldview:null;if(br&&this.worldview&&typeof Ei=="string")if(Ei==="all")Ni.properties.$localized=!0;else{if(!Ei.split(",").includes(this.worldview))continue;Ni.properties.$localized=!0,Ni.properties.worldview=this.worldview}!ir&&Ni.properties&&Ni.properties.hasOwnProperty(s.fp)&&(ir=!0),nr.push({feature:Ni,id:_i,index:hr,sourceLayerIndex:vr}),hr++}ir&&!It.elevationFeatures&&ne.layers.hasOwnProperty(s.fq)&&(It.elevationFeatures=s.fr.parseFrom(ne.layers[s.fq],this.canonical));for(const hi of yn[kn]){const hr=hi[0];if(this.extraShadowCaster&&(!hr.is3D()||hr.type==="model")||this.isSymbolTile!==void 0&&hr.type==="symbol"!==this.isSymbolTile||hr.minzoom&&this.zoom<Math.floor(hr.minzoom)||hr.maxzoom&&this.zoom>=hr.maxzoom||hr.visibility==="none")continue;je(hi,this.zoom,It.brightness,ye,this.worldview);const Ni=at[hr.id]=hr.createBucket({index:Ge.bucketLayerIDs.length,layers:hi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:De,worldview:this.worldview,localizable:br,availableImages:ye});Ge.bucketLayerIDs.push(hi.map(Ei=>s.B(Ei.id,Ei.scope)));let _i=Ni.prepare?Ni.prepare():null;_i!=null?(_i=_i.then(()=>Ni.populate(nr,It,this.tileID.canonical,this.tileTransform)),tn.push(_i)):Ni.populate(nr,It,this.tileID.canonical,this.tileTransform)}}const bn=()=>{let kn,Fn,vn,Pn,$i,vr;Dt.trim();const nr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},br=()=>{if(kn)return this.status="done",Be(kn);if(this.extraShadowCaster)this.status="done",Be(null,{buckets:Object.values(at).filter(hi=>!hi.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:It.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Fn&&vn&&Pn){const hi=new Je(Fn),hr=new Map;for(const[Ei,dr]of vn.entries()){const{imagePosition:Jr}=s.fu(Ei,dr,s.fv);hr.set(Ei,Jr)}const Ni={};for(const Ei in at){const dr=at[Ei];dr instanceof s.b4&&(je(dr.layers,this.zoom,It.brightness,ye,this.worldview),Ni[Ei]=s.fw(dr,Fn,hi.positions,vn,hr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,$i,this.worldview,ye))}const _i={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,vn,$i,()=>{_i.iconsPending=!1,ir(Ni,hi,_i)}),this.rasterizeIfNeeded(xe,Pn,vr,()=>{_i.patternsPending=!1,ir(Ni,hi,_i)})}},ir=(hi,hr,Ni,_i)=>{if(Ni.iconsPending||Ni.patternsPending)return;const Ei=new s.fx(vn,Pn,this.lut);for(const dr in at){const Jr=at[dr];if(dr in hi)s.fy(Jr,hi[dr],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,vn,Ei);else if(Jr.hasPattern&&(Jr instanceof s.ba||Jr instanceof s.bb||Jr instanceof s.ea)){je(Jr.layers,this.zoom,It.brightness,ye,this.worldview);const es=Object.fromEntries(Ei.patternPositions);Jr.addFeatures(It,this.tileID.canonical,es,ye,this.tileTransform,this.brightness)}}this.status="done",Be(null,{buckets:Object.values(at).filter(dr=>!dr.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hr.image,lineAtlas:Dt,imageAtlas:Ei,brightness:It.brightness})};if(!this.extraShadowCaster){const hi=s.fs(It.glyphDependencies,_i=>Object.keys(_i).map(Number));Object.keys(hi).length?xe.send("getGlyphs",{uid:this.uid,stacks:hi},(_i,Ei)=>{kn||(kn=_i,Fn=Ei,br())},void 0,!1,nr):Fn={};const hr=Array.from(It.iconDependencies.keys()).map(_i=>s.I.parse(_i));hr.length?xe.send("getImages",{images:hr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(_i,Ei)=>{kn||(kn=_i,vn=new Map,$i=this.updateImageMapAndGetImageTaskQueue(vn,Ei,It.iconDependencies),br())},void 0,!1,nr):(vn=new Map,$i=new Map);const Ni=Array.from(It.patternDependencies.keys()).map(_i=>s.I.parse(_i));Ni.length?xe.send("getImages",{images:Ni,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(_i,Ei)=>{kn||(kn=_i,Pn=new Map,vr=this.updateImageMapAndGetImageTaskQueue(Pn,Ei,It.patternDependencies),br())},void 0,!1,nr):(Pn=new Map,vr=new Map)}if(It.elevationFeatures&&It.elevationFeatures.length>0){const hi=[];for(const Ni of Object.values(at))if(Ni instanceof s.bb){const _i=Ni.getUnevaluatedPortalGraph();_i&&hi.push(_i)}const hr=s.ft.evaluate(hi);for(const Ni of Object.values(at))if(Ni instanceof s.bb){const _i=ne.layers[it.decode(Ni.sourceLayerIndex)];Ni.setEvaluatedPortalGraph(hr,_i,this.tileID.canonical,It.availableImages,It.brightness)}}br()};tn.length>0?Promise.allSettled(tn).then(bn).catch(Be):bn()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,ae,ye,De){Array.from(ae.values()).some(xe=>xe.usvg)?this.rasterize(ne,ae,ye,De):De()}updateImageMapAndGetImageTaskQueue(ne,ae,ye){const De=new Map;for(const xe of ae.keys()){const Be=ye.get(xe)||[];for(const it of Be){const Ge=it.toString(),at=ae.get(it.id.toString());at.usvg?De.has(Ge)||(De.set(Ge,it),ne.set(Ge,Object.assign({},at))):ne.set(Ge,at)}}return De}rasterize(ne,ae,ye,De){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ye},(xe,Be)=>{if(!xe)for(const[it,Ge]of Be.entries()){const at=Object.assign(ae.get(it),{data:Ge});ae.set(it,at)}De()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function je(Ue,ne,ae,ye,De){const xe=new s.ac(ne,{brightness:ae,worldview:De});for(const Be of Ue)Be.recalculate(xe,ye)}class ze extends s.E{constructor(ne,ae,ye,De,xe,Be,it){super(),this.actor=ne,this.layerIndex=ae,this.availableImages=ye,this.availableModels=De,this.loadVectorData=Be||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ne.scheduler),this.isSpriteLoaded=xe,this.scheduler=ne.scheduler,this.brightness=it}loadTile(ne,ae){const ye=ne.uid,De=ne&&ne.request,xe=De&&De.collectResourceTiming,Be=this.loading[ye]=new St(ne);Be.abort=this.loadVectorData(ne,(it,Ge)=>{const at=!this.loading[ye];if(delete this.loading[ye],Be.cancelRasterize(),at||it||!Ge)return Be.status="done",at||(this.loaded[ye]=Be),ae(it);const Dt=Ge.rawData,It={},tn=s.aM(Ge.responseHeaders);tn&&tn.expires&&(It.expires=tn.expires),tn&&tn.cacheControl&&(It.cacheControl=tn.cacheControl),Be.vectorTile=Ge.vectorTile||new s.fz(new s.bt(Dt));const yn=()=>{Be.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(bn,kn)=>{if(bn||!kn)return ae(bn);const Fn={};if(xe){const vn=B(De);vn.length>0&&(Fn.resourceTiming=JSON.parse(JSON.stringify(vn)))}ae(null,Object.assign({rawTileData:Dt.slice(0),responseHeaders:Ge.responseHeaders},kn,It,Fn))})};this.isSpriteLoaded?yn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yn,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):yn()}),this.loaded=this.loaded||{},this.loaded[ye]=Be})}reloadTile(ne,ae){const ye=this.loaded,De=ne.uid;if(ye&&ye[De]){const xe=ye[De];xe.updateParameters(ne);const Be=(it,Ge)=>{const at=xe.reloadCallback;at&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at)),ae(it,Ge)};xe.status==="parsing"?xe.reloadCallback=Be:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Be):Be())}else ae(null,void 0)}abortTile(ne,ae){const ye=ne.uid,De=this.loading[ye];De&&(De.abort&&De.abort(),delete this.loading[ye]),ae()}removeTile(ne,ae){const ye=this.loaded,De=ne.uid;ye&&ye[De]&&delete ye[De],ae()}}class Ve{loadTile(ne,ae){const{uid:ye,encoding:De,rawImageData:xe,padding:Be}=ne,it=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Be):xe;ae(null,new s.fA(ye,it,De,Be<1))}reloadTile(ne,ae){ae(null,null)}abortTile(ne,ae){ae()}removeTile(ne,ae){ae()}getImageData(ne,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ye=this.offscreenCanvasContext.getImageData(-ae,-ae,ne.width+2*ae,ne.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}s.bs.setPbf(s.bt);class Ke{constructor(ne){this._mrt=new s.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ae){const ye=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ye.parseHeader(ne),this._isHeaderLoaded=!0;const De=[];for(const xe in ye.layers){const Be=ye.getLayer(xe),it=Be.getDataRange(Be.getBandList()),Ge=ye.createDecodingTask(it),at=ne.slice(it.firstByte,it.lastByte+1),Dt=s.bs.performDecoding(at,Ge).then(It=>Ge.complete(null,It)).catch(It=>Ge.complete(It,null));De.push(Dt)}Promise.allSettled(De).then(()=>ae(null,ye)).catch(xe=>ae(xe))}catch(De){ae(De)}}}class qe{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ae){const ye=ne.uid,De=ne.request,xe=this.loading[ye]=new Ke(ne),{cancel:Be}=s.bu(De,(it,Ge,at)=>{const Dt=!this.loading[ye];if(delete this.loading[ye],Dt||it||!Ge)return xe.status="done",Dt||(this.loaded[ye]=xe),ae(it);xe.parse(Ge,(It,tn)=>{if(It||!tn)return ae(It);ae(null,tn,at)}),this.loaded[ye]=xe});xe.abort=Be}reloadTile(ne,ae){ae(null,void 0)}abortTile(ne,ae){const ye=ne.uid,De=this.loading[ye];De&&(De.abort&&De.abort(),delete this.loading[ye]),ae()}removeTile(ne,ae){const ye=ne.uid;this.loaded[ye]&&delete this.loaded[ye],ae()}decodeRasterArray(ne,ae){s.bs.performDecoding(ne.buffer,ne.task).then(ye=>ae(null,ye)).catch(ye=>ae(ye))}}const et=s.fB.prototype.toGeoJSON;class be{constructor(ne){this._feature=ne,this.extent=s.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ae of this._feature.geometry)ne.push([new s.P(ae[0],ae[1])]);return ne}{const ne=[];for(const ae of this._feature.geometry){const ye=[];for(const De of ae)ye.push(new s.P(De[0],De[1]));ne.push(ye)}return ne}}toGeoJSON(ne,ae,ye){return et.call(this,ne,ae,ye)}}class Zt{constructor(ne,ae){this.name=ne,this.extent=s.al,this.length=ae.length,this._jsonFeatures=ae}feature(ne){return new be(this._jsonFeatures[ne])}}class dn{constructor(ne){this.layers={},this.extent=s.al;for(const ae of Object.keys(ne))this.layers[ae]=new Zt(ae,ne[ae])}}const wt=64/4096;class Jt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ae){for(const ye of ne){const De=ye.id;if(De==null)continue;let xe=this.features.get(De);xe&&this.updateCache(xe,ae),ye.geometry?(xe=ci(ye),this.updateCache(xe,ae),this.features.set(De,xe)):this.features.delete(De),this.updateCache(xe,ae)}}updateCache(ne,ae){for(const{canonical:ye,uid:De}of Object.values(ae)){const{z:xe,x:Be,y:it}=ye;En(ne,Math.pow(2,xe),Be,it)&&delete ae[De]}}getTile(ne,ae,ye){const De=Math.pow(2,ne),xe=[];for(const Be of this.features.values())En(Be,De,ae,ye)&&xe.push(Ne(Be,De,ae,ye));return{features:xe}}getFeatures(){return[...this.features.values()]}}function En({minX:Ue,minY:ne,maxX:ae,maxY:ye},De,xe,Be){return Ue<(xe+1+wt)/De&&ne<(Be+1+wt)/De&&ae>(xe-wt)/De&&ye>(Be-wt)/De}function ci(Ue){const{id:ne,geometry:ae,properties:ye}=Ue;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:xe}=ae,Be={id:ne,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},it=Be.geometry;if(De==="Point")tt(xe,it,Be);else if(De==="MultiPoint")for(const Ge of xe)tt(Ge,it,Be);else if(De==="LineString")Be.type=2,dt(xe,it,Be);else if(De==="MultiLineString")Be.type=2,Kt(xe,it,Be);else if(De==="Polygon")Be.type=3,Kt(xe,it,Be,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Be.type=3;for(const Ge of xe)Kt(Ge,it,Be,!0)}return Be}function tt([Ue,ne],ae,ye){const De=s.aF(Ue);let xe=s.aJ(ne);xe=xe<0?0:xe>1?1:xe,ae.push(De,xe),ye.minX=Math.min(ye.minX,De),ye.minY=Math.min(ye.minY,xe),ye.maxX=Math.max(ye.maxX,De),ye.maxY=Math.max(ye.maxY,xe)}function dt(Ue,ne,ae,ye=!1,De=!1){const xe=[];for(const Be of Ue)tt(Be,xe,ae);ne.push(xe),ye&&(function(Be,it){let Ge=0;for(let at=0,Dt=Be.length,It=Dt-2;at<Dt;It=at,at+=2)Ge+=(Be[at]-Be[It])*(Be[at+1]+Be[It+1]);if(Ge>0===it)for(let at=0,Dt=Be.length;at<Dt/2;at+=2){const It=Be[at],tn=Be[at+1];Be[at]=Be[Dt-2-at],Be[at+1]=Be[Dt-1-at],Be[Dt-2-at]=It,Be[Dt-1-at]=tn}})(xe,De)}function Kt(Ue,ne,ae,ye=!1){for(let De=0;De<Ue.length;De++)dt(Ue[De],ne,ae,ye,De===0)}function Ne(Ue,ne,ae,ye){const{id:De,type:xe,geometry:Be,tags:it}=Ue,Ge=[];if(xe===1)(function(at,Dt,It,tn,yn){for(let bn=0;bn<at.length;bn+=2){const kn=Math.round(s.al*(at[bn+0]*Dt-It)),Fn=Math.round(s.al*(at[bn+1]*Dt-tn));yn.push([kn,Fn])}})(Be,ne,ae,ye,Ge);else if(xe===2)for(const at of Be)wn(at,ne,ae,ye,Ge);else if(xe===3)for(const at of Be)Kn(at,ne,ae,ye,Ge);return{id:De,type:xe,geometry:Ge,tags:it}}function wn(Ue,ne,ae,ye,De){const Be=s.al+128;let it;for(let Ge=0;Ge<Ue.length-2;Ge+=2){let at=Math.round(s.al*(Ue[Ge+0]*ne-ae)),Dt=Math.round(s.al*(Ue[Ge+1]*ne-ye)),It=Math.round(s.al*(Ue[Ge+2]*ne-ae)),tn=Math.round(s.al*(Ue[Ge+3]*ne-ye));const yn=It-at,bn=tn-Dt;at<-128&&It<-128||(at<-128?(Dt+=Math.round(bn*((-128-at)/yn)),at=-128):It<-128&&(tn=Dt+Math.round(bn*((-128-at)/yn)),It=-128),Dt<-128&&tn<-128||(Dt<-128?(at+=Math.round(yn*((-128-Dt)/bn)),Dt=-128):tn<-128&&(It=at+Math.round(yn*((-128-Dt)/bn)),tn=-128),at>=Be&&It>=Be||(at>=Be?(Dt+=Math.round(bn*((Be-at)/yn)),at=Be):It>=Be&&(tn=Dt+Math.round(bn*((Be-at)/yn)),It=Be),Dt>=Be&&tn>=Be||(Dt>=Be?(at+=Math.round(yn*((Be-Dt)/bn)),Dt=Be):tn>=Be&&(It=at+Math.round(yn*((Be-Dt)/bn)),tn=Be),it&&at===it[it.length-1][0]&&Dt===it[it.length-1][1]||(it=[[at,Dt]],De.push(it)),it.push([It,tn])))))}}function Kn(Ue,ne,ae,ye,De){const xe=(ae-wt)/ne,Be=(ye-wt)/ne,it=(ae+1+wt)/ne,Ge=(ye+1+wt)/ne;function at(tn,yn){let bn=0;return tn<xe?bn|=1:tn>it&&(bn|=2),yn<Be?bn|=4:yn>Ge&&(bn|=8),bn}let Dt=[];for(let tn=1;tn<=8;tn*=2){let yn=Ue[Ue.length-2],bn=Ue[Ue.length-1],kn=!(at(yn,bn)&tn);for(let Fn=0;Fn<Ue.length;Fn+=2){const vn=Ue[Fn],Pn=Ue[Fn+1],$i=!(at(vn,Pn)&tn);$i!==kn&&(8&tn?Dt.push(yn+(vn-yn)*(Ge-bn)/(Pn-bn),Ge):4&tn?Dt.push(yn+(vn-yn)*(Be-bn)/(Pn-bn),Be):2&tn?Dt.push(it,bn+(Pn-bn)*(it-yn)/(vn-yn)):1&tn&&Dt.push(xe,bn+(Pn-bn)*(xe-yn)/(vn-yn))),$i&&Dt.push(vn,Pn),yn=vn,bn=Pn,kn=$i}if(!(Ue=Dt).length||tn===8)break;Dt=[]}const It=[];for(let tn=0;tn<Dt.length;tn+=2)It.push([Math.round(s.al*(Dt[tn]*ne-ae)),Math.round(s.al*(Dt[tn+1]*ne-ye))]);It.length&&De.push(It)}function Zn({name:Ue,features:ne},ae){ae.writeStringField(1,Ue),ae.writeVarintField(5,s.al);const ye=new Map,De=new Map,xe={keys:ye,values:De,feature:null};for(const Be of ne)xe.feature=Be,ae.writeMessage(2,Ci,xe);for(const Be of ye.keys())ae.writeStringField(3,Be);for(const Be of De.keys())ae.writeMessage(4,Va,Be)}function Ci(Ue,ne){const ae=Ue.feature;ae.id!==void 0&&Number.isSafeInteger(+ae.id)&&ne.writeVarintField(1,+ae.id),ae.tags&&ne.writeMessage(2,Xi,Ue),ne.writeVarintField(3,ae.type),ne.writeMessage(4,jr,ae)}function Xi({keys:Ue,values:ne,feature:ae},ye){for(const De of Object.keys(ae.tags)){let xe=ae.tags[De];if(xe===null)continue;let Be=Ue.get(De);Be===void 0&&(Be=Ue.size,Ue.set(De,Be)),ye.writeVarint(Be);const it=typeof xe;it!=="string"&&it!=="boolean"&&it!=="number"&&(xe=JSON.stringify(xe));let Ge=ne.get(xe);Ge===void 0&&(Ge=ne.size,ne.set(xe,Ge)),ye.writeVarint(Ge)}}function Gn(Ue,ne){return(ne<<3)+(7&Ue)}function zi(Ue){return Ue<<1^Ue>>31}function jr(Ue,ne){const{geometry:ae,type:ye}=Ue;let De=0,xe=0;if(ye===1){ne.writeVarint(Gn(1,ae.length));for(const Be of ae){const it=Be[0]-De,Ge=Be[1]-xe;ne.writeVarint(zi(it)),ne.writeVarint(zi(Ge)),De+=it,xe+=Ge}}else for(const Be of ae){if(Be.length===0)continue;ne.writeVarint(Gn(1,1));const it=Be.length-(ye===3?1:0);for(let Ge=0;Ge<it;Ge++){Ge===1&&ne.writeVarint(Gn(2,it-1));const at=Be[Ge][0]-De,Dt=Be[Ge][1]-xe;ne.writeVarint(zi(at)),ne.writeVarint(zi(Dt)),De+=at,xe+=Dt}ye===3&&ne.writeVarint(Gn(7,1))}}function Va(Ue,ne){const ae=typeof Ue;ae==="string"?ne.writeStringField(1,Ue):ae==="boolean"?ne.writeBooleanField(7,Ue):ae==="number"&&(Ue%1!=0?ne.writeDoubleField(3,Ue):Ue<0?ne.writeSVarintField(6,Ue):ne.writeVarintField(5,Ue))}const cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},Bs=Math.fround||(Hn=new Float32Array(1),Ue=>(Hn[0]=+Ue,Hn[0]));var Hn;class Ti{constructor(ne){this.options=Object.assign(Object.create(cr),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ae,minZoom:ye,maxZoom:De}=this.options;ae&&console.time("total time");const xe=`prepare ${ne.length} points`;ae&&console.time(xe),this.points=ne;const Be=[];for(let Ge=0;Ge<ne.length;Ge++){const at=ne[Ge];if(!at.geometry)continue;const[Dt,It]=at.geometry.coordinates,tn=Bs(Qi(Dt)),yn=Bs(_r(It));Be.push(tn,yn,1/0,Ge,-1,1),this.options.reduce&&Be.push(0)}let it=this.trees[De+1]=this._createTree(Be);ae&&console.timeEnd(xe);for(let Ge=De;Ge>=ye;Ge--){const at=+Date.now();it=this.trees[Ge]=this._createTree(this._cluster(it,Ge)),ae&&console.log("z%d: %d clusters in %dms",Ge,it.numItems,+Date.now()-at)}return ae&&console.timeEnd("total time"),this}getClusters(ne,ae){let ye=((ne[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ne[1]));let xe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ye=-180,xe=180;else if(ye>xe){const It=this.getClusters([ye,De,180,Be],ae),tn=this.getClusters([-180,De,xe,Be],ae);return It.concat(tn)}const it=this.trees[this._limitZoom(ae)],Ge=it.range(Qi(ye),_r(Be),Qi(xe),_r(De)),at=it.data,Dt=[];for(const It of Ge){const tn=this.stride*It;Dt.push(at[tn+5]>1?ur(at,tn,this.clusterProps):this.points[at[tn+3]])}return Dt}getChildren(ne){const ae=this._getOriginId(ne),ye=this._getOriginZoom(ne),De="No cluster with the specified id.",xe=this.trees[ye];if(!xe)throw new Error(De);const Be=xe.data;if(ae*this.stride>=Be.length)throw new Error(De);const it=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ge=xe.within(Be[ae*this.stride],Be[ae*this.stride+1],it),at=[];for(const Dt of Ge){const It=Dt*this.stride;Be[It+4]===ne&&at.push(Be[It+5]>1?ur(Be,It,this.clusterProps):this.points[Be[It+3]])}if(at.length===0)throw new Error(De);return at}getLeaves(ne,ae,ye){const De=[];return this._appendLeaves(De,ne,ae=ae||10,ye=ye||0,0),De}getTile(ne,ae,ye){const De=this.trees[this._limitZoom(ne)],xe=Math.pow(2,ne),{extent:Be,radius:it}=this.options,Ge=it/Be,at=(ye-Ge)/xe,Dt=(ye+1+Ge)/xe,It={features:[]};return this._addTileFeatures(De.range((ae-Ge)/xe,at,(ae+1+Ge)/xe,Dt),De.data,ae,ye,xe,It),ae===0&&this._addTileFeatures(De.range(1-Ge/xe,at,1,Dt),De.data,xe,ye,xe,It),ae===xe-1&&this._addTileFeatures(De.range(0,at,Ge/xe,Dt),De.data,-1,ye,xe,It),It.features.length?It:null}getClusterExpansionZoom(ne){let ae=this._getOriginZoom(ne)-1;for(;ae<=this.options.maxZoom;){const ye=this.getChildren(ne);if(ae++,ye.length!==1)break;ne=ye[0].properties.cluster_id}return ae}_appendLeaves(ne,ae,ye,De,xe){const Be=this.getChildren(ae);for(const it of Be){const Ge=it.properties;if(Ge&&Ge.cluster?xe+Ge.point_count<=De?xe+=Ge.point_count:xe=this._appendLeaves(ne,Ge.cluster_id,ye,De,xe):xe<De?xe++:ne.push(it),ne.length===ye)break}return xe}_createTree(ne){const ae=new s.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<ne.length;ye+=this.stride)ae.add(ne[ye],ne[ye+1]);return ae.finish(),ae.data=ne,ae}_addTileFeatures(ne,ae,ye,De,xe,Be){for(const it of ne){const Ge=it*this.stride,at=ae[Ge+5]>1;let Dt,It,tn;if(at)Dt=ui(ae,Ge,this.clusterProps),It=ae[Ge],tn=ae[Ge+1];else{const kn=this.points[ae[Ge+3]];Dt=kn.properties;const[Fn,vn]=kn.geometry.coordinates;It=Qi(Fn),tn=_r(vn)}const yn={type:1,geometry:[[Math.round(this.options.extent*(It*xe-ye)),Math.round(this.options.extent*(tn*xe-De))]],tags:Dt};let bn;bn=at||this.options.generateId?ae[Ge+3]:this.points[ae[Ge+3]].id,bn!==void 0&&(yn.id=bn),Be.features.push(yn)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ae){const{radius:ye,extent:De,reduce:xe,minPoints:Be}=this.options,it=ye/(De*Math.pow(2,ae)),Ge=ne.data,at=[],Dt=this.stride;for(let It=0;It<Ge.length;It+=Dt){if(Ge[It+2]<=ae)continue;Ge[It+2]=ae;const tn=Ge[It],yn=Ge[It+1],bn=ne.within(Ge[It],Ge[It+1],it),kn=Ge[It+5];let Fn=kn;for(const vn of bn){const Pn=vn*Dt;Ge[Pn+2]>ae&&(Fn+=Ge[Pn+5])}if(Fn>kn&&Fn>=Be){let vn,Pn=tn*kn,$i=yn*kn,vr=-1;const nr=(It/Dt<<5)+(ae+1)+this.points.length;for(const br of bn){const ir=br*Dt;if(Ge[ir+2]<=ae)continue;Ge[ir+2]=ae;const hi=Ge[ir+5];Pn+=Ge[ir]*hi,$i+=Ge[ir+1]*hi,Ge[ir+4]=nr,xe&&(vn||(vn=this._map(Ge,It,!0),vr=this.clusterProps.length,this.clusterProps.push(vn)),xe(vn,this._map(Ge,ir)))}Ge[It+4]=nr,at.push(Pn/Fn,$i/Fn,1/0,nr,-1,Fn),xe&&at.push(vr)}else{for(let vn=0;vn<Dt;vn++)at.push(Ge[It+vn]);if(Fn>1)for(const vn of bn){const Pn=vn*Dt;if(!(Ge[Pn+2]<=ae)){Ge[Pn+2]=ae;for(let $i=0;$i<Dt;$i++)at.push(Ge[Pn+$i])}}}}return at}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ae,ye){if(ne[ae+5]>1){const Be=this.clusterProps[ne[ae+6]];return ye?Object.assign({},Be):Be}const De=this.points[ne[ae+3]].properties,xe=this.options.map(De);return ye&&xe===De?Object.assign({},xe):xe}}function ur(Ue,ne,ae){return{type:"Feature",id:Ue[ne+3],properties:ui(Ue,ne,ae),geometry:{type:"Point",coordinates:[(ye=Ue[ne],360*(ye-.5)),Xs(Ue[ne+1])]}};var ye}function ui(Ue,ne,ae){const ye=Ue[ne+5],De=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,xe=Ue[ne+6],Be=xe===-1?{}:Object.assign({},ae[xe]);return Object.assign(Be,{cluster:!0,cluster_id:Ue[ne+3],point_count:ye,point_count_abbreviated:De})}function Qi(Ue){return Ue/360+.5}function _r(Ue){const ne=Math.sin(Ue*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function Xs(Ue){const ne=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Rl(Ue,ne,ae,ye){let De=ye;const xe=ne+(ae-ne>>1);let Be,it=ae-ne;const Ge=Ue[ne],at=Ue[ne+1],Dt=Ue[ae],It=Ue[ae+1];for(let tn=ne+3;tn<ae;tn+=3){const yn=rc(Ue[tn],Ue[tn+1],Ge,at,Dt,It);if(yn>De)Be=tn,De=yn;else if(yn===De){const bn=Math.abs(tn-xe);bn<it&&(Be=tn,it=bn)}}De>ye&&(Be-ne>3&&Rl(Ue,ne,Be,ye),Ue[Be+2]=De,ae-Be>3&&Rl(Ue,Be,ae,ye))}function rc(Ue,ne,ae,ye,De,xe){let Be=De-ae,it=xe-ye;if(Be!==0||it!==0){const Ge=((Ue-ae)*Be+(ne-ye)*it)/(Be*Be+it*it);Ge>1?(ae=De,ye=xe):Ge>0&&(ae+=Be*Ge,ye+=it*Ge)}return Be=Ue-ae,it=ne-ye,Be*Be+it*it}function Ur(Ue,ne,ae,ye){const De={id:Ue??null,type:ne,geometry:ae,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")vs(De,ae);else if(ne==="Polygon")vs(De,ae[0]);else if(ne==="MultiLineString")for(const xe of ae)vs(De,xe);else if(ne==="MultiPolygon")for(const xe of ae)vs(De,xe[0]);return De}function vs(Ue,ne){for(let ae=0;ae<ne.length;ae+=3)Ue.minX=Math.min(Ue.minX,ne[ae]),Ue.minY=Math.min(Ue.minY,ne[ae+1]),Ue.maxX=Math.max(Ue.maxX,ne[ae]),Ue.maxY=Math.max(Ue.maxY,ne[ae+1])}function en(Ue,ne,ae,ye){if(!ne.geometry)return;const De=ne.geometry.coordinates;if(De&&De.length===0)return;const xe=ne.geometry.type,Be=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let it=[],Ge=ne.id;if(ae.promoteId?Ge=ne.properties[ae.promoteId]:ae.generateId&&(Ge=ye||0),xe==="Point")Tn(De,it);else if(xe==="MultiPoint")for(const at of De)Tn(at,it);else if(xe==="LineString")ri(De,it,Be,!1);else if(xe==="MultiLineString"){if(ae.lineMetrics){for(const at of De)it=[],ri(at,it,Be,!1),Ue.push(Ur(Ge,"LineString",it,ne.properties));return}Oi(De,it,Be,!1)}else if(xe==="Polygon")Oi(De,it,Be,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const at of ne.geometry.geometries)en(Ue,{id:Ge,geometry:at,properties:ne.properties},ae,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of De){const Dt=[];Oi(at,Dt,Be,!0),it.push(Dt)}}Ue.push(Ur(Ge,xe,it,ne.properties))}function Tn(Ue,ne){ne.push(Ri(Ue[0]),Fs(Ue[1]),0)}function ri(Ue,ne,ae,ye){let De,xe,Be=0;for(let Ge=0;Ge<Ue.length;Ge++){const at=Ri(Ue[Ge][0]),Dt=Fs(Ue[Ge][1]);ne.push(at,Dt,0),Ge>0&&(Be+=ye?(De*Dt-at*xe)/2:Math.sqrt(Math.pow(at-De,2)+Math.pow(Dt-xe,2))),De=at,xe=Dt}const it=ne.length-3;ne[2]=1,Rl(ne,0,it,ae),ne[it+2]=1,ne.size=Math.abs(Be),ne.start=0,ne.end=ne.size}function Oi(Ue,ne,ae,ye){for(let De=0;De<Ue.length;De++){const xe=[];ri(Ue[De],xe,ae,ye),ne.push(xe)}}function Ri(Ue){return Ue/360+.5}function Fs(Ue){const ne=Math.sin(Ue*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function gs(Ue,ne,ae,ye,De,xe,Be,it){if(ye/=ne,xe>=(ae/=ne)&&Be<ye)return Ue;if(Be<ae||xe>=ye)return null;const Ge=[];for(const at of Ue){const Dt=at.geometry;let It=at.type;const tn=De===0?at.minX:at.minY,yn=De===0?at.maxX:at.maxY;if(tn>=ae&&yn<ye){Ge.push(at);continue}if(yn<ae||tn>=ye)continue;let bn=[];if(It==="Point"||It==="MultiPoint")ps(Dt,bn,ae,ye,De);else if(It==="LineString")kr(Dt,bn,ae,ye,De,!1,it.lineMetrics);else if(It==="MultiLineString")Vi(Dt,bn,ae,ye,De,!1);else if(It==="Polygon")Vi(Dt,bn,ae,ye,De,!0);else if(It==="MultiPolygon")for(const kn of Dt){const Fn=[];Vi(kn,Fn,ae,ye,De,!0),Fn.length&&bn.push(Fn)}if(bn.length){if(it.lineMetrics&&It==="LineString"){for(const kn of bn)Ge.push(Ur(at.id,It,kn,at.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(bn.length===1?(It="LineString",bn=bn[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=bn.length===3?"Point":"MultiPoint"),Ge.push(Ur(at.id,It,bn,at.tags))}}return Ge.length?Ge:null}function ps(Ue,ne,ae,ye,De){for(let xe=0;xe<Ue.length;xe+=3){const Be=Ue[xe+De];Be>=ae&&Be<=ye&&ra(ne,Ue[xe],Ue[xe+1],Ue[xe+2])}}function kr(Ue,ne,ae,ye,De,xe,Be){let it=yr(Ue);const Ge=De===0?bs:cl;let at,Dt,It=Ue.start;for(let Fn=0;Fn<Ue.length-3;Fn+=3){const vn=Ue[Fn],Pn=Ue[Fn+1],$i=Ue[Fn+2],vr=Ue[Fn+3],nr=Ue[Fn+4],br=De===0?vn:Pn,ir=De===0?vr:nr;let hi=!1;Be&&(at=Math.sqrt(Math.pow(vn-vr,2)+Math.pow(Pn-nr,2))),br<ae?ir>ae&&(Dt=Ge(it,vn,Pn,vr,nr,ae),Be&&(it.start=It+at*Dt)):br>ye?ir<ye&&(Dt=Ge(it,vn,Pn,vr,nr,ye),Be&&(it.start=It+at*Dt)):ra(it,vn,Pn,$i),ir<ae&&br>=ae&&(Dt=Ge(it,vn,Pn,vr,nr,ae),hi=!0),ir>ye&&br<=ye&&(Dt=Ge(it,vn,Pn,vr,nr,ye),hi=!0),!xe&&hi&&(Be&&(it.end=It+at*Dt),ne.push(it),it=yr(Ue)),Be&&(It+=at)}let tn=Ue.length-3;const yn=Ue[tn],bn=Ue[tn+1],kn=De===0?yn:bn;kn>=ae&&kn<=ye&&ra(it,yn,bn,Ue[tn+2]),tn=it.length-3,xe&&tn>=3&&(it[tn]!==it[0]||it[tn+1]!==it[1])&&ra(it,it[0],it[1],it[2]),it.length&&ne.push(it)}function yr(Ue){const ne=[];return ne.size=Ue.size,ne.start=Ue.start,ne.end=Ue.end,ne}function Vi(Ue,ne,ae,ye,De,xe){for(const Be of Ue)kr(Be,ne,ae,ye,De,xe,!1)}function ra(Ue,ne,ae,ye){Ue.push(ne,ae,ye)}function bs(Ue,ne,ae,ye,De,xe){const Be=(xe-ne)/(ye-ne);return ra(Ue,xe,ae+(De-ae)*Be,1),Be}function cl(Ue,ne,ae,ye,De,xe){const Be=(xe-ae)/(De-ae);return ra(Ue,ne+(ye-ne)*Be,xe,1),Be}function Ca(Ue,ne){const ae=[];for(let ye=0;ye<Ue.length;ye++){const De=Ue[ye],xe=De.type;let Be;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Be=bo(De.geometry,ne);else if(xe==="MultiLineString"||xe==="Polygon"){Be=[];for(const it of De.geometry)Be.push(bo(it,ne))}else if(xe==="MultiPolygon"){Be=[];for(const it of De.geometry){const Ge=[];for(const at of it)Ge.push(bo(at,ne));Be.push(Ge)}}ae.push(Ur(De.id,xe,Be,De.tags))}return ae}function bo(Ue,ne){const ae=[];ae.size=Ue.size,Ue.start!==void 0&&(ae.start=Ue.start,ae.end=Ue.end);for(let ye=0;ye<Ue.length;ye+=3)ae.push(Ue[ye]+ne,Ue[ye+1],Ue[ye+2]);return ae}function ms(Ue,ne){if(Ue.transformed)return Ue;const ae=1<<Ue.z,ye=Ue.x,De=Ue.y;for(const xe of Ue.features){const Be=xe.geometry,it=xe.type;if(xe.geometry=[],it===1)for(let Ge=0;Ge<Be.length;Ge+=2)xe.geometry.push(ji(Be[Ge],Be[Ge+1],ne,ae,ye,De));else for(let Ge=0;Ge<Be.length;Ge++){const at=[];for(let Dt=0;Dt<Be[Ge].length;Dt+=2)at.push(ji(Be[Ge][Dt],Be[Ge][Dt+1],ne,ae,ye,De));xe.geometry.push(at)}}return Ue.transformed=!0,Ue}function ji(Ue,ne,ae,ye,De,xe){return[Math.round(ae*(Ue*ye-De)),Math.round(ae*(ne*ye-xe))]}function Yr(Ue,ne,ae,ye,De){const xe=ne===De.maxZoom?0:De.tolerance/((1<<ne)*De.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:Ue.length,source:null,x:ae,y:ye,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of Ue)wo(Be,it,xe,De);return Be}function wo(Ue,ne,ae,ye){const De=ne.geometry,xe=ne.type,Be=[];if(Ue.minX=Math.min(Ue.minX,ne.minX),Ue.minY=Math.min(Ue.minY,ne.minY),Ue.maxX=Math.max(Ue.maxX,ne.maxX),Ue.maxY=Math.max(Ue.maxY,ne.maxY),xe==="Point"||xe==="MultiPoint")for(let it=0;it<De.length;it+=3)Be.push(De[it],De[it+1]),Ue.numPoints++,Ue.numSimplified++;else if(xe==="LineString")_u(Be,De,Ue,ae,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let it=0;it<De.length;it++)_u(Be,De[it],Ue,ae,xe==="Polygon",it===0);else if(xe==="MultiPolygon")for(let it=0;it<De.length;it++){const Ge=De[it];for(let at=0;at<Ge.length;at++)_u(Be,Ge[at],Ue,ae,!0,at===0)}if(Be.length){let it=ne.tags||null;if(xe==="LineString"&&ye.lineMetrics){it={};for(const at in ne.tags)it[at]=ne.tags[at];it.mapbox_clip_start=De.start/De.size,it.mapbox_clip_end=De.end/De.size}const Ge={geometry:Be,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:it};ne.id!==null&&(Ge.id=ne.id),Ue.features.push(Ge)}}function _u(Ue,ne,ae,ye,De,xe){const Be=ye*ye;if(ye>0&&ne.size<(De?Be:ye))return void(ae.numPoints+=ne.length/3);const it=[];for(let Ge=0;Ge<ne.length;Ge+=3)(ye===0||ne[Ge+2]>Be)&&(ae.numSimplified++,it.push(ne[Ge],ne[Ge+1])),ae.numPoints++;De&&(function(Ge,at){let Dt=0;for(let It=0,tn=Ge.length,yn=tn-2;It<tn;yn=It,It+=2)Dt+=(Ge[It]-Ge[yn])*(Ge[It+1]+Ge[yn+1]);if(Dt>0===at)for(let It=0,tn=Ge.length;It<tn/2;It+=2){const yn=Ge[It],bn=Ge[It+1];Ge[It]=Ge[tn-2-It],Ge[It+1]=Ge[tn-1-It],Ge[tn-2-It]=yn,Ge[tn-1-It]=bn}})(it,xe),Ue.push(it)}const ja={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ul{constructor(ne,ae){const ye=(ae=this.options=(function(xe,Be){for(const it in Be)xe[it]=Be[it];return xe})(Object.create(ja),ae)).debug;if(ye&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=(function(xe,Be){const it=[];if(xe.type==="FeatureCollection")for(let Ge=0;Ge<xe.features.length;Ge++)en(it,xe.features[Ge],Be,Ge);else en(it,xe.type==="Feature"?xe:{geometry:xe},Be);return it})(ne,ae);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=(function(xe,Be){const it=Be.buffer/Be.extent;let Ge=xe;const at=gs(xe,1,-1-it,it,0,-1,2,Be),Dt=gs(xe,1,1-it,2+it,0,-1,2,Be);return(at||Dt)&&(Ge=gs(xe,1,-it,1+it,0,-1,2,Be)||[],at&&(Ge=Ca(at,1).concat(Ge)),Dt&&(Ge=Ge.concat(Ca(Dt,-1)))),Ge})(De,ae),De.length&&this.splitTile(De,0,0,0),ye&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ae,ye,De,xe,Be,it){const Ge=[ne,ae,ye,De],at=this.options,Dt=at.debug;for(;Ge.length;){De=Ge.pop(),ye=Ge.pop(),ae=Ge.pop(),ne=Ge.pop();const It=1<<ae,tn=hl(ae,ye,De);let yn=this.tiles[tn];if(!yn&&(Dt>1&&console.time("creation"),yn=this.tiles[tn]=Yr(ne,ae,ye,De,at),this.tileCoords.push({z:ae,x:ye,y:De}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,ye,De,yn.numFeatures,yn.numPoints,yn.numSimplified),console.timeEnd("creation"));const hi=`z${ae}`;this.stats[hi]=(this.stats[hi]||0)+1,this.total++}if(yn.source=ne,xe==null){if(ae===at.indexMaxZoom||yn.numPoints<=at.indexMaxPoints)continue}else{if(ae===at.maxZoom||ae===xe)continue;if(xe!=null){const hi=xe-ae;if(ye!==Be>>hi||De!==it>>hi)continue}}if(yn.source=null,ne.length===0)continue;Dt>1&&console.time("clipping");const bn=.5*at.buffer/at.extent,kn=.5-bn,Fn=.5+bn,vn=1+bn;let Pn=null,$i=null,vr=null,nr=null,br=gs(ne,It,ye-bn,ye+Fn,0,yn.minX,yn.maxX,at),ir=gs(ne,It,ye+kn,ye+vn,0,yn.minX,yn.maxX,at);ne=null,br&&(Pn=gs(br,It,De-bn,De+Fn,1,yn.minY,yn.maxY,at),$i=gs(br,It,De+kn,De+vn,1,yn.minY,yn.maxY,at),br=null),ir&&(vr=gs(ir,It,De-bn,De+Fn,1,yn.minY,yn.maxY,at),nr=gs(ir,It,De+kn,De+vn,1,yn.minY,yn.maxY,at),ir=null),Dt>1&&console.timeEnd("clipping"),Ge.push(Pn||[],ae+1,2*ye,2*De),Ge.push($i||[],ae+1,2*ye,2*De+1),Ge.push(vr||[],ae+1,2*ye+1,2*De),Ge.push(nr||[],ae+1,2*ye+1,2*De+1)}}getTile(ne,ae,ye){ne=+ne,ae=+ae,ye=+ye;const De=this.options,{extent:xe,debug:Be}=De;if(ne<0||ne>24)return null;const it=1<<ne,Ge=hl(ne,ae=ae+it&it-1,ye);if(this.tiles[Ge])return ms(this.tiles[Ge],xe);Be>1&&console.log("drilling down to z%d-%d-%d",ne,ae,ye);let at,Dt=ne,It=ae,tn=ye;for(;!at&&Dt>0;)Dt--,It>>=1,tn>>=1,at=this.tiles[hl(Dt,It,tn)];return at&&at.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",Dt,It,tn),console.time("drilling down")),this.splitTile(at.source,Dt,It,tn,ne,ae,ye),Be>1&&console.timeEnd("drilling down"),this.tiles[Ge]?ms(this.tiles[Ge],xe):null):null}}function hl(Ue,ne,ae){return 32*((1<<Ue)*ae+ne)+Ue}function Mt(Ue,ne){const ae=Ue.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return void ne(null,null);const De=at=>at.tags&&"3d_elevation_id"in at.tags&&"source"in at.tags&&at.tags.source==="elevation",xe=ye.features.filter(at=>De(at));let Be={_geojsonTileLayer:ye.features};xe.length>0&&(Be={_geojsonTileLayer:ye.features.filter(at=>!De(at)),hd_road_elevation:xe});const it=new dn(Be),Ge=(function(at){const Dt=new s.bt;for(const It of Object.keys(at))Dt.writeMessage(3,Zn,{name:It,features:at[It]});return Dt.finish()})(Be).buffer;ne(null,{vectorTile:it,rawData:Ge})}class no extends ze{constructor(ne,ae,ye,De,xe,Be,it){super(ne,ae,ye,De,xe,Mt,it),Be&&(this.loadGeoJSON=Be),this._dynamicIndex=new Jt}loadData(ne,ae){const ye=ne&&ne.request,De=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(xe,Be)=>{if(xe||!Be)return ae(xe);if(typeof Be!="object")return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const Ge=s.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(at=>`${at.key}: ${at.message}`).join(", "));Be.features=Be.features.filter(at=>Ge.value.evaluate({zoom:0},at))}ne.dynamic?(Be.type==="Feature"&&(Be={type:"FeatureCollection",features:[Be]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Be.features,this.loaded),ne.cluster&&(Be.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new Ti((function({superclusterOptions:Ge,clusterProperties:at}){if(!at||!Ge)return Ge;const Dt={},It={},tn={accumulated:null,zoom:0},yn={properties:null},bn=Object.keys(at);for(const kn of bn){const[Fn,vn]=at[kn],Pn=s.U(vn),$i=s.U(typeof Fn=="string"?[Fn,["accumulated"],["get",kn]]:Fn);Dt[kn]=Pn.value,It[kn]=$i.value}return Ge.map=kn=>{yn.properties=kn;const Fn={};for(const vn of bn)Fn[vn]=Dt[vn].evaluate(tn,yn);return Fn},Ge.reduce=(kn,Fn)=>{yn.properties=Fn;for(const vn of bn)tn.accumulated=kn[vn],kn[vn]=It[vn].evaluate(tn,yn)},Ge})(ne)).load(Be.features):ne.dynamic?this._dynamicIndex:(function(Ge,at){return new ul(Ge,at)})(Be,ne.geojsonVtOptions)}catch(Ge){return ae(Ge)}const it={};if(De){const Ge=B(ye);Ge&&(it.resourceTiming={},it.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Ge)))}ae(null,it)}})}reloadTile(ne,ae){const ye=this.loaded;return ye&&ye[ne.uid]?ne.partial?ae(null,void 0):super.reloadTile(ne,ae):this.loadTile(ne,ae)}loadGeoJSON(ne,ae){if(ne.request)s.m(ne.request,ae);else{if(typeof ne.data!="string")return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ae(null,JSON.parse(ne.data))}catch{return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ye){ae(ye)}}getClusterChildren(ne,ae){try{ae(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ye){ae(ye)}}getClusterLeaves(ne,ae){try{ae(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ye){ae(ye)}}}class th{constructor(ne,ae,ye){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ae,this.worldview=ye}parse(ne,ae,ye,De){this.status="parsing";const xe=new s.aQ(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Be=[],it=ae.familiesBySource[ye.source],Ge=new s.fn(xe,ye.promoteId);Ge.bucketLayerIDs=[],Ge.is3DTile=!0,s.fC(ne).then(at=>{if(!at)return De(new Error("Could not parse tile"));const Dt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,It=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),tn=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const yn in it)for(const bn of it[yn]){const kn=bn[0];Ge.bucketLayerIDs.push(bn.map(Pn=>s.B(Pn.id,Pn.scope))),kn.recalculate(tn,[]);const Fn=s.fD(at,1/s.d7(ye.tileID.canonical)),vn=new s.fE(bn,Fn,xe,Dt,It,this.brightness,Ge,this.worldview);Dt||(vn.needsUpload=!0),Be.push(vn),vn.evaluate(kn)}this.status="done",De(null,{buckets:Be,featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(at=>De(new Error(at.message)))}}class Lc{constructor(ne,ae,ye,De,xe,Be,it,Ge){this.actor=ne,this.layerIndex=ae,this.availableImages=ye,this.availableModels=De,this.brightness=it,this.loading={},this.loaded={},this.worldview=Ge}loadTile(ne,ae){const ye=ne.uid,De=this.loading[ye]=new th(ne,this.brightness,this.worldview);s.bu(ne.request,(xe,Be)=>{const it=!this.loading[ye];return delete this.loading[ye],it||xe?(De.status="done",it||(this.loaded[ye]=De),ae(xe)):Be&&Be.byteLength!==0?void De.parse(Be,this.layerIndex,ne,(Ge,at)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[ye]=De,Ge||!at?ae(Ge):ae(null,at)}):(De.status="done",this.loaded[ye]=De,ae())})}reloadTile(ne,ae){const ye=this.loaded,De=ne.uid;if(ye&&ye[De]){const xe=ye[De];xe.projection=ne.projection,xe.brightness=ne.brightness;const Be=(it,Ge)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(ne,ae)),ae(it,Ge)};xe.status==="parsing"?xe.reloadCallback=Be:xe.status==="done"&&this.loadTile(ne,ae)}}abortTile(ne,ae){const ye=ne.uid;this.loading[ye]&&delete this.loading[ye],ae()}removeTile(ne,ae){const ye=this.loaded,De=ne.uid;ye&&ye[De]&&delete ye[De],ae()}}class ai{constructor(ne){this.self=ne,this.actor=new s.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:ze,geojson:no,"raster-dem":Ve,"raster-array":qe,"batched-model":Lc},this.workerSources={},this.self.registerWorkerSource=(ae,ye)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=ye},this.self.registerRTLTextPlugin=ae=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=ae.applyArabicShaping,s.fH.processBidirectionalText=ae.processBidirectionalText,s.fH.processStyledBidirectionalText=ae.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ae,ye){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ye()}checkIfReady(ne,ae,ye){ye()}setReferrer(ne,ae){this.referrer=ae}spriteLoaded(ne,ae){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ye,isLoaded:De}=ae;if(this.isSpriteLoaded[ne][ye]=De,this.workerSources[ne]&&this.workerSources[ne][ye])for(const xe in this.workerSources[ne][ye]){const Be=this.workerSources[ne][ye][xe];for(const it in Be){const Ge=Be[it];Ge instanceof ze&&(Ge.isSpriteLoaded=De,Ge.fire(new s.z("isSpriteLoaded")))}}}setImages(ne,ae,ye){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:De,images:xe}=ae;if(this.availableImages[ne][De]=xe,this.workerSources[ne]&&this.workerSources[ne][De]){for(const Be in this.workerSources[ne][De]){const it=this.workerSources[ne][De][Be];for(const Ge in it)it[Ge].availableImages=xe}ye()}else ye()}setModels(ne,{scope:ae,models:ye},De){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ae]=ye,this.workerSources[ne]&&this.workerSources[ne][ae]){for(const xe in this.workerSources[ne][ae]){const Be=this.workerSources[ne][ae][xe];for(const it in Be)Be[it].availableModels=ye}De()}else De()}setProjection(ne,ae){this.projections[ne]=s.cm(ae)}setBrightness(ne,ae,ye){this.brightness=ae,ye()}setWorldview(ne,ae,ye){this.worldview=ae,ye()}setLayers(ne,ae,ye){this.getLayerIndex(ne,ae.scope).replace(ae.layers,ae.options),ye()}updateLayers(ne,ae,ye){this.getLayerIndex(ne,ae.scope).update(ae.layers,ae.removedIds,ae.options),ye()}loadTile(ne,ae,ye){ae.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ae.type,ae.source,ae.scope).loadTile(ae,ye)}decodeRasterArray(ne,ae,ye){this.getWorkerSource(ne,ae.type,ae.source,ae.scope).decodeRasterArray(ae,ye)}reloadTile(ne,ae,ye){ae.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ae.type,ae.source,ae.scope).reloadTile(ae,ye)}abortTile(ne,ae,ye){this.getWorkerSource(ne,ae.type,ae.source,ae.scope).abortTile(ae,ye)}removeTile(ne,ae,ye){this.getWorkerSource(ne,ae.type,ae.source,ae.scope).removeTile(ae,ye)}removeSource(ne,ae,ye){if(!(this.workerSources[ne]&&this.workerSources[ne][ae.scope]&&this.workerSources[ne][ae.scope][ae.type]&&this.workerSources[ne][ae.scope][ae.type][ae.source]))return;const De=this.workerSources[ne][ae.scope][ae.type][ae.source];delete this.workerSources[ne][ae.scope][ae.type][ae.source],De.removeSource!==void 0?De.removeSource(ae,ye):ye()}loadWorkerSource(ne,ae,ye){try{this.self.importScripts(ae.url),ye()}catch(De){ye(De)}}syncRTLPluginState(ne,ae,ye){if(s.fH.isParsed())ye(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(ye);else try{s.fH.setState(ae);const De=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||De==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(De),s.fH.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(De){ye(De)}}setDracoUrl(ne,ae){this.dracoUrl=ae}getAvailableImages(ne,ae){this.availableImages[ne]||(this.availableImages[ne]={});let ye=this.availableImages[ne][ae];return ye||(ye=[]),ye}getAvailableModels(ne,ae){this.availableModels[ne]||(this.availableModels[ne]={});let ye=this.availableModels[ne][ae];return ye||(ye={}),ye}getLayerIndex(ne,ae){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ye=this.layerIndexes[ne][ae];return ye||(ye=this.layerIndexes[ne][ae]=new oe,ye.scope=ae),ye}getWorkerSource(ne,ae,ye,De){const xe=this.workerSources;return xe[ne]||(xe[ne]={}),xe[ne][De]||(xe[ne][De]={}),xe[ne][De][ae]||(xe[ne][De][ae]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),xe[ne][De][ae][ye]||(xe[ne][De][ae][ye]=new this.workerSourceTypes[ae]({send:(Be,it,Ge,at,Dt,It)=>this.actor.send(Be,it,Ge,ne,Dt,It),scheduler:this.actor.scheduler},this.getLayerIndex(ne,De),this.getAvailableImages(ne,De),this.getAvailableModels(ne,De),this.isSpriteLoaded[ne][De],void 0,this.brightness,this.worldview)),xe[ne][De][ae][ye]}rasterizeImagesWorker(ne,ae,ye){const De=new Map;for(const[xe,{image:Be,imageVariant:it}]of ae.tasks.entries()){const Ge=this.imageRasterizer.rasterize(it,Be,ae.scope,ne);De.set(xe,Ge)}ye(void 0,De)}removeRasterizedImages(ne,ae,ye){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,ne),ye()}enforceCacheSizeLimit(ne,ae){s.fJ(ae)}getWorkerPerformanceMetrics(ne,ae,ye){ye(void 0,void 0)}}return s.fF(self)&&(self.worker=new ai(self)),ai}),T(["./shared"],function(s){var B="3.18.1";const V={create:"create",load:"load",fullLoad:"fullLoad"},W={mark(f){performance.mark(f)},measure(f,n,c){performance.measure(f,n,c)}};function Q(f){const n=f.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var oe,he={},Je=(function(){if(oe)return he;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,E,I=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(I);try{E=new Worker(M),b=!0}catch{b=!1}return E&&E.terminate(),URL.revokeObjectURL(M),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var E=b.getContext("2d");if(!E)return!1;var I=E.getImageData(0,0,1,1);return I&&I.width===b.width})()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=(function(b){var E,I=(function(M){var z=document.createElement("canvas"),O=Object.create(f.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=M,z.getContext("webgl2",O)})(b);if(!I)return!1;try{E=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!E||I.isContextLost())&&(I.shaderSource(E,"void main() {}"),I.compileShader(E),I.getShaderParameter(E,I.COMPILE_STATUS)===!0)})(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}oe=1,he.supported=f,he.notSupportedReason=n;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},he})();function Ye(f,n,c){const p=document.createElement(f);return n!=null&&(p.className=n),c&&c.appendChild(p),p}function Xe(f,n,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(n))p.setAttributeNS(null,x,String(n[x]));return c&&c.appendChild(p),p}const st=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ft=st&&st.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ht;function Ft(){st&&ft&&(ht=st[ft],st[ft]="none")}function fn(){st&&ft&&(st[ft]=ht)}function St(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",St,!0)}function je(){window.addEventListener("click",St,!0),window.setTimeout(()=>{window.removeEventListener("click",St,!0)},0)}function ze(f,n){const c=f.getBoundingClientRect();return qe(f,c,n)}function Ve(f,n){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<n.length;x++)p.push(qe(f,c,n[x]));return p}function Ke(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function qe(f,n,c){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new s.P((c.clientX-n.left)*p,(c.clientY-n.top)*p)}const et="01",be="NO_ACCESS_TOKEN";class Zt{constructor(n,c,p){this._transformRequestFn=n,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",et,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,c){return this._transformRequestFn&&this._transformRequestFn(n,c)||{url:n}}normalizeStyleURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.params.push(`sdk=js-${B}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(n,c,p,x){if(!s.h(n))return n;const b=wt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||c)}normalizeIconsetURL(n,c){const p=wt(n);return s.h(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Jt(p)}normalizeSpriteURL(n,c,p,x){const b=wt(n);return s.h(n)?(b.path=`/styles/v1${b.path}/sprite${c}${p}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${c}${p}`,Jt(b))}normalizeTileURL(n,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const x=wt(n);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||(function(E){for(const I of E){const M=I.match(/^access_token=(.*)$/);if(M)return M[1]}return null})(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(n,c){const p=wt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return c&&(b=b.filter(E=>!E.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(n,c){const p=!!c&&s.h(c),x=[];for(const b of n.tiles||[])s.j(b)?x.push(this.canonicalizeTileURL(b,p)):x.push(b);return x}_makeAPIURL(n,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=wt(s.e.API_URL);if(n.protocol=x.protocol,n.authority=x.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(x.path!=="/"&&(n.path=`${x.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Jt(n);if(c=c||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${c||""}`),Jt(n)}}const dn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wt(f){const n=f.match(dn);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Jt(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const En="mapbox.eventData";function ci(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class tt{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const c=ci(s.e.ACCESS_TOKEN);let p="";return p=c&&c.u?s.f(c.u):s.e.ACCESS_TOKEN||"",n?`${En}.${n}:${p}`:`${En}:${p}`}fetchEventData(){const n=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(n)try{const b=localStorage.getItem(c);b&&(this.eventData=JSON.parse(b));const E=localStorage.getItem(p);E&&(this.anonId=E);const I=localStorage.getItem(x);I&&(this.anonIdTimestamp=Number(I));const M=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<M)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),b=this.anonId,E=this.anonIdTimestamp;if(n&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),E&&localStorage.setItem(x,E.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,c,p,x){if(!s.e.EVENTS_URL)return;const b=wt(s.e.EVENTS_URL);b.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(n).toISOString()},I=c?Object.assign(E,c):E,M={url:Jt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(M,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)})}queueRequest(n,c){this.queue.push(n),this.processRequests(c)}}class dt extends tt{constructor(n){super("metrics"),n&&(this.data=n)}postMetricsEvent(n){if(!s.e.EVENTS_URL||!n&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},n)}}const Kt=new class extends tt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>s.h(c)||s.j(c))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=ci(s.e.ACCESS_TOKEN),c=n?n.u:s.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),E=new Date(x),I=(x-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||b.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:et,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},f):this.processRequests()}},Ne=Kt.postTurnstileEvent.bind(Kt),wn=new class extends tt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,c,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(be)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:et,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},Kn=wn.postMapLoadEvent.bind(wn),Zn=new class extends tt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=s.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:c,style:p,importedStyles:x}=n;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(c),E={mapInstanceId:b,eventId:this.getEventId(b),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},f)}},Ci=Zn.postStyleLoadEvent.bind(Zn),Xi=new dt({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Gn=Xi.postMetricsEvent.bind(Xi),zi=new dt({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),jr=zi.postMetricsEvent.bind(zi),Va=new class extends tt{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:c}=this.queue.shift(),p=(function(x){const b=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),I=(function($){const J={};if($){for(const Y in $)if(Y!=="other")for(const ee of $[Y]){const re=`${Y}ResolveRangeMin`,pe=`${Y}ResolveRangeMax`,fe=`${Y}RequestCount`,ue=`${Y}RequestCachedCount`;J[re]=Math.min(J[re]||1/0,ee.startTime),J[pe]=Math.max(J[pe]||-1/0,ee.responseEnd);const Ie=Te=>{J[Te]===void 0&&(J[Te]=0),++J[Te]};ee.transferSize!==void 0&&ee.transferSize===0&&Ie(ue),Ie(fe)}}return J})((function($,J){const Y={};if($)for(const ee of $){const re=J(ee);Y[re]===void 0&&(Y[re]=[]),Y[re].push(ee)}return Y})(b,Q)),M=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=z?z.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},G=($,J,Y)=>{Y!=null&&$.push({name:J,value:Y.toString()})};for(const $ in I)G(H.counters,$,I[$]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(G(H.counters,"interactionRangeMin",x.interactionRange[0]),G(H.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const $ of Object.values(V)){const J=E.find(Y=>Y.name===$);J&&G(H.counters,$,J.startTime)}return G(H.counters,"visibilityHidden",x.visibilityHidden),G(H.attributes,"style",(function($){if($)for(const J of $){const Y=J.name.split("?")[0];if(s.i(Y)){const ee=Y.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}})(b)),G(H.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),G(H.attributes,"fogEnabled",x.fogEnabled?"true":"false"),G(H.attributes,"projection",x.projection),G(H.attributes,"zoom",x.zoom),G(H.metadata,"devicePixelRatio",M),G(H.metadata,"connectionEffectiveType",O),G(H.metadata,"navigatorUserAgent",navigator.userAgent),G(H.metadata,"screenWidth",window.screen.width),G(H.metadata,"screenHeight",window.screen.height),G(H.metadata,"windowWidth",window.innerWidth),G(H.metadata,"windowHeight",window.innerHeight),G(H.metadata,"mapWidth",x.width/M),G(H.metadata,"mapHeight",x.height/M),G(H.metadata,"webglRenderer",x.renderer),G(H.metadata,"webglVendor",x.vendor),G(H.metadata,"sdkVersion",B),G(H.metadata,"sdkIdentifier","mapbox-gl-js"),H})(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(n,p,()=>{},f)}},cr=Va.postPerformanceEvent.bind(Va),Bs=new class extends tt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,c,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=wt(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${n||""}`),x.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const b={url:Jt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,c,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(be)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},Hn=Bs.getSessionAPI.bind(Bs),Ti=new Set;function ur(f,n){n?Ti.add(f):Ti.delete(f)}class ui{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,c){this._updatedSourceCaches[n]=c,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const c=n.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(n.id),this.setDirty()}removeLayer(n){const c=n.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][n.id]=n,this._updatedLayers[c].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const c in this._updatedLayers)n[c]=n[c]||{},n[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)n[c]=n[c]||{},n[c].removedIds=Object.keys(this._removedLayers[c]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Qi(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class _r extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const c=this.atlasTexture.get(n);c&&(c.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(n.id,n)}removeImageProvider(n,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(n)}getPendingImageProviders(){const n=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,c){if(this.loaded.get(c)!==n&&(this.loaded.set(c,n),n)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(n,c){return!!this.getImage(n,c)}getImage(n,c){return this.images.get(c).get(n.toString())}addImage(n,c,p){this._validate(n,p)&&this.images.get(c).set(n.toString(),p)}_validate(n,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,c){if(!n)return!0;let p=0;for(const x of n){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(n,c){return n?n.length!==4||!c.usvg&&(n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,c,p){const x=this.images.get(c).get(n.toString());p.version=x.version+1,this.images.get(c).set(n.toString(),p),this.updatedImages.get(c).add(n),this.removeFromImageRasterizerCache(n,c)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,c){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([n],c))}removeImage(n,c){const p=this.images.get(c),x=p.get(n.toString());p.delete(n.toString()),this.patterns.get(c).delete(n.toString()),this.removeFromImageRasterizerCache(n,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(c=>s.I.from(c))}getImages(n,c,p){const x=[],b=[],E=this.imageProviders.get(c);for(const O of n){if(!O.iconsetId){x.push(O);continue}const H=E.get(O.iconsetId);H&&(this.getImage(O,c)?b.push(O):H.addPendingRequest(O))}if(x.length===0)return void this._notify(b,c,p);let I=!0;const M=!!this.loaded.get(c),z=this.images.get(c);if(!M)for(const O of x)z.has(O.toString())||(I=!1);M||I?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(n,c){const p=new Map,{tasks:x,scope:b}=n;for(const[E,I]of x.entries()){const M=this.getImage(I.id,b);M&&p.set(E,{image:M,imageVariant:I})}this._rasterizeImages(b,p,c)}_rasterizeImages(n,c,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:n},p);else{const x=new Map;for(const[b,{image:E,imageVariant:I}]of c.entries())x.set(b,this.imageRasterizer.rasterize(I,E,n,0));p(void 0,x)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,c,p){const x=this.images.get(c),b=new Map;for(const E of n){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:E.name}))}const I=x.get(E.toString());if(!I){s.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(M,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),b.set(s.I.toString(E),M)}p(null,b)}getPixelSize(n){const{width:c,height:p}=this.atlasImage.get(n);return{width:c,height:p}}getPattern(n,c,p){const x=n.toString(),b=this.patterns.get(c),E=b.get(x),I=this.getImage(n,c);if(!I)return null;if(E){if(E.position.version===I.version)return E.position;E.position.version=I.version}else{if(I.usvg&&!I.data){const M=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const z=new s.A(n).scaleSelf(s.o.devicePixelRatio),O=new Map([[z.toString(),{image:I,imageVariant:z}]]);return this._rasterizeImages(c,O,(H,G)=>this.storePatternImage(z,c,I,p,G)),null}this.storePattern(n,c,I)}return this._updatePatternAtlas(c,p),b.get(x).position}getPatternInFlightId(n,c){return s.B(n,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,c,p,x,b){const E=n.toString(),I=b?b.get(E):void 0;I&&(p.data=I,this.storePattern(n.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),c)))}storePattern(n,c,p){const x={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},b=new s.F(x,p,s.C);this.patterns.get(c).set(n.toString(),{bin:x,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,c){const p=n.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new s.T(n,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,c){const p=this.patterns.get(n),x=Array.from(p.values()).map(({bin:z})=>z),{w:b,h:E}=s.G(x),I=this.atlasImage.get(n);I.resize({width:b||1,height:E||1});const M=this.images.get(n);for(const[z,{bin:O,position:H}]of p.entries()){let G=H.padding;const $=O.x+G,J=O.y+G,Y=M.get(z).data,ee=Y.width,re=Y.height;G=G>1?G-1:G,s.q.copy(Y,I,{x:0,y:0},{x:$,y:J},{width:ee,height:re},c),s.q.copy(Y,I,{x:0,y:re-G},{x:$,y:J-G},{width:ee,height:G},c),s.q.copy(Y,I,{x:0,y:0},{x:$,y:J+re},{width:ee,height:G},c),s.q.copy(Y,I,{x:ee-G,y:0},{x:$-G,y:J},{width:G,height:re},c),s.q.copy(Y,I,{x:0,y:0},{x:$+ee,y:J},{width:G,height:re},c),s.q.copy(Y,I,{x:ee-G,y:re-G},{x:$-G,y:J-G},{width:G,height:G},c),s.q.copy(Y,I,{x:0,y:re-G},{x:$+ee,y:J-G},{width:G,height:G},c),s.q.copy(Y,I,{x:0,y:0},{x:$+ee,y:J+re},{width:G,height:G},c),s.q.copy(Y,I,{x:ee-G,y:0},{x:$-G,y:J+re},{width:G,height:G},c)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,c){const p=this.images.get(c);for(const x of n){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const b=p.get(x.toString());Qi(b)&&this.updateImage(x,c,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Xs(f){const n=f.value,c=f.valueSpec,p=f.style,x=f.styleSpec,b=f.key,E=f.arrayElementValidator||ji;if(!Array.isArray(n))return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(c.length&&n.length!==c.length)return[new s.V(b,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new s.V(b,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(I.function=c.function),s.H(c.value)&&(I=c.value);let M=[];for(let z=0;z<n.length;z++)M=M.concat(E({array:n,arrayIndex:z,value:n[z],valueSpec:I,style:p,styleSpec:x,key:`${b}[${z}]`},!0));return M}function Rl(f){const n=f.key,c=f.value,p=f.valueSpec;if(!s.L(c))return[new s.V(n,c,`number expected, ${s.K(c)} found`)];if(c!=c)return[new s.V(n,c,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[f.arrayIndex]),c<x)return[new s.V(n,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[f.arrayIndex]),c>x)return[new s.V(n,c,`${c} is greater than the maximum value ${x}`)]}return[]}function rc(f){const n=f.key,c=f.value;if(!s.H(c))return[new s.V(n,c,`object expected, ${s.K(c)} found`)];const p=f.valueSpec,x=s.J(c.type);let b,E,I,M={};const z=x!=="categorical"&&c.property===void 0,O=!z,H=(function(Y){const ee=Y.stops;return Array.isArray(ee)&&Array.isArray(ee[0])&&s.H(ee[0][0])})(c),G=Yr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Y){if(x==="identity")return[new s.V(Y.key,Y.value,'identity function may not have a "stops" property')];let ee=[];const re=Y.value;return ee=ee.concat(Xs({key:Y.key,value:re,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:$})),Array.isArray(re)&&re.length===0&&ee.push(new s.V(Y.key,re,"array must have at least one stop")),ee},default:function(Y){return ji({key:Y.key,value:Y.value,valueSpec:p,style:Y.style,styleSpec:Y.styleSpec})}}});return x==="identity"&&z&&G.push(new s.V(f.key,f.value,'missing required property "property"')),x==="identity"||c.stops||G.push(new s.V(f.key,f.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!s.M(p)&&G.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(O&&!s.N(p)?G.push(new s.V(f.key,f.value,"property functions not supported")):z&&!s.O(p)&&G.push(new s.V(f.key,f.value,"zoom functions not supported"))),x!=="categorical"&&!H||c.property!==void 0||G.push(new s.V(f.key,f.value,'"property" property is required')),G;function $(Y){let ee=[];const re=Y.value,pe=Y.key;if(!Array.isArray(re))return[new s.V(pe,re,`array expected, ${s.K(re)} found`)];if(re.length!==2)return[new s.V(pe,re,`array length 2 expected, length ${re.length} found`)];if(H){if(!s.H(re[0]))return[new s.V(pe,re,`object expected, ${s.K(re[0])} found`)];const fe=re[0];if(fe.zoom===void 0)return[new s.V(pe,re,"object stop key must have zoom")];if(fe.value===void 0)return[new s.V(pe,re,"object stop key must have value")];const ue=s.J(fe.zoom);if(typeof ue!="number")return[new s.V(pe,fe.zoom,"stop zoom values must be numbers")];if(I&&I>ue)return[new s.V(pe,fe.zoom,"stop zoom values must appear in ascending order")];ue!==I&&(I=ue,E=void 0,M={}),ee=ee.concat(Yr({key:`${pe}[0]`,value:re[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Rl,value:J}}))}else ee=ee.concat(J({key:`${pe}[0]`,value:re[0],style:Y.style,styleSpec:Y.styleSpec},re));return s.Q(s.S(re[1]))?ee.concat([new s.V(`${pe}[1]`,re[1],"expressions are not allowed in function stops.")]):ee.concat(ji({key:`${pe}[1]`,value:re[1],valueSpec:p,style:Y.style,styleSpec:Y.styleSpec}))}function J(Y,ee){const re=s.K(Y.value),pe=s.J(Y.value),fe=Y.value!==null?Y.value:ee;if(b){if(re!==b)return[new s.V(Y.key,fe,`${re} stop domain type must match previous stop domain type ${b}`)]}else b=re;if(re!=="number"&&re!=="string"&&re!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new s.V(Y.key,fe,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&x!=="categorical"){let ue=`number expected, ${re} found`;return s.N(p)&&x===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Y.key,fe,ue)]}return x!=="categorical"||re!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?x!=="categorical"&&re==="number"&&typeof pe=="number"&&typeof E=="number"&&E!==void 0&&pe<E?[new s.V(Y.key,fe,"stop domain values must appear in ascending order")]:(E=pe,x==="categorical"&&pe in M?[new s.V(Y.key,fe,"stop domain values must be unique")]:(M[pe]=!0,[])):[new s.V(Y.key,fe,`integer expected, found ${String(pe)}`)]}}function Ur(f){const n=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const c=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(c))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return vs(c,f);if(f.expressionContext==="appearance")return en(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(c,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(c))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(f,n){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return f instanceof s._&&c.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(x=>{p.push(...vs(x,n))}),p)}function en(f,n){const c=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)c.add(x);if(c.size===0)return[];const p=[];return f instanceof s._&&!c.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(x=>{p.push(...en(x,n))}),p)}function Tn(f){const n=f.key,c=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(s.J(c))===-1&&x.push(new s.V(n,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(s.J(c))===-1&&x.push(new s.V(n,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function ri(f){return s.a2(s.S(f.value))?Ur(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Oi(f)}function Oi(f){const n=f.value,c=f.key;if(!Array.isArray(n))return[new s.V(c,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(c,n,"filter array must have at least 1 element")];const p=f.styleSpec;let x=Tn({key:`${c}[0]`,value:n[0],valueSpec:p.filter_operator});const b=()=>{n.length>=2&&(s.a0(n[1])||x.push(new s.V(`${c}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let E=2;E<n.length;E++)s.J(n[1])==="$type"?x=x.concat(Tn({key:`${c}[${E}]`,value:n[E],valueSpec:p.geometry_type})):s.a0(n[E])||s.L(n[E])||s.$(n[E])||x.push(new s.V(`${c}[${E}]`,n[E],`string, number, or boolean expected, ${s.K(n[E])} found.`))};switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&x.push(new s.V(c,n,`"$type" cannot be use with operator "${n[0]}"`)),n.length!==3&&x.push(new s.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"==":case"!=":n.length!==3&&x.push(new s.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let E=1;E<n.length;E++)x=x.concat(Oi({key:`${c}[${E}]`,value:n[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":n.length!==2?x.push(new s.V(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||x.push(new s.V(`${c}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return x}function Ri(f,n){const c=f.key,p=f.style,x=f.layer,b=f.styleSpec,E=f.value,I=f.objectKey,M=b[`${n}_${f.layerType}`];if(!M)return[];const z=I.match(/^(.*)-use-theme$/);if(z&&M[z[1]])return s.Q(s.S(E))?[].concat(ji({key:c,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:I})):ji({key:c,value:E,valueSpec:{type:"string"},style:p,styleSpec:b});const O=I.match(/^(.*)-transition$/);if(n==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return ji({key:c,value:E,valueSpec:b.transition,style:p,styleSpec:b});const H=f.valueSpec||M[I];if(!H)return[new s.a3(c,E,`unknown property "${I}"`)];let G;if(s.a0(E)&&s.N(H)&&!H.tokens&&(G=/^{([^}]+)}$/.exec(E))){const J=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new s.V(c,E,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const $=[];if(f.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||$.push(new s.V(c,E,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(E))&&s.J(E.type)==="identity"&&$.push(new s.V(c,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.N(H)&&(s.a5(H)||s.O(H))){const J=s.W(s.S(E),H).value,Y="expression"in J&&J.expression||"_styleExpression"in J&&J._styleExpression&&J._styleExpression.expression;Y&&!s.X(Y,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(Y)&&s.Z(Y)||$.push(new s.V(c,E,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(ji({key:f.key,value:E,valueSpec:H,style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:I}))}function Fs(f){return Ri(f,"paint")}function gs(f){return Ri(f,"layout")}function ps(f){let n=[];const c=f.value,p=f.key,x=f.style,b=f.styleSpec;if(!s.H(c))return[new s.V(p,c,"object expected")];c.type||c.ref||n.push(new s.V(p,c,'either "type" or "ref" is required'));let E=s.J(c.type);const I=s.J(c.ref);if(c.id){const M=s.J(c.id);for(let z=0;z<f.arrayIndex;z++){const O=x.layers[z];s.J(O.id)===M&&n.push(new s.V(p,c.id,`duplicate layer id "${M}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let M;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&n.push(new s.V(p,c[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{s.J(z.id)===I&&(M=z)}),M?M.ref?n.push(new s.V(p,c.ref,"ref cannot reference another ref layer")):E=s.J(M.type):typeof I=="string"&&n.push(new s.V(p,c.ref,`ref layer "${I}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(c.source)if(s.a0(c.source)){const M=x.sources&&x.sources[c.source],z=M&&s.J(M.type);M?z==="vector"&&E==="raster"?n.push(new s.V(p,c.source,`layer "${c.id}" requires a raster source`)):z==="raster"&&E!=="raster"?n.push(new s.V(p,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&E!=="hillshade"?n.push(new s.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&z==="geojson"&&!M.lineMetrics?n.push(new s.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&z!=="raster-array"&&n.push(new s.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new s.V(p,c.source,`source "${c.source}" not found`))}else n.push(new s.V(`${p}.source`,c.source,'"source" must be a string'));else n.push(new s.V(p,c,'missing required property "source"'));return n=n.concat(Yr({key:p,value:c,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${p}.type`,value:c.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:M=>ri(Object.assign({layerType:E},M)),layout:M=>Yr({layer:c,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":z=>gs(Object.assign({layerType:E},z))}}),paint:M=>Yr({layer:c,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":z=>Fs(Object.assign({layerType:E,layer:c},z))}}),appearances(M){const z=Xs({key:M.key,value:M.value,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:G=>(function($){const{key:J,layer:Y,layerType:ee}=$,re=s.J($.value),pe=s.J(re.name),fe=s.J(re.condition),ue=Yr({key:J,value:re,valueSpec:$.styleSpec.appearance,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{condition:Ie=>(function(Te){const Ae=[];return Ae.push(...Ur({key:Te.key,value:Te.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Ae})(Object.assign({layer:Y,layerType:ee},Ie)),properties:Ie=>(function(Te){const Ae=[],{styleSpec:ve,layer:ge,layerType:Pe}=Te,Le=ve[`paint_${Pe}`],Fe=ve[`layout_${Pe}`],We=Te.object[Te.objectKey];for(const $e in We){const lt=$e in Le?"paint":$e in Fe?"layout":void 0;if(!lt){Ae.push(new s.V(Te.key,$e,`unknown property "${$e}" for layer type "${Pe}"`));continue}const xt=Object.assign({},Te,{key:`${Te.key}.${$e}`,object:We,objectKey:$e,layer:ge,layerType:Pe,value:We[$e],valueSpec:lt==="paint"?Le[$e]:Fe[$e]});Ae.push(...Ri(xt,lt))}return Ae})(Object.assign({layer:Y,layerType:ee},Ie))}});return pe!=="hidden"&&fe===void 0&&ue.push(new s.V($.key,"name",'Appearance with name different than "hidden" must have a condition')),ue})(Object.assign({layerType:E,layer:c},G))}),O=Array.isArray(M.value)?M.value:[],H=new Set;return O.forEach((G,$)=>{const J=s.J(G.name);if(J)if(H.has(J)){const Y=s.J(c.id);z.push(new s.V(M.key,J,`Duplicated appearance name "${J}" for layer "${Y}"`))}else H.add(J)}),z}}})),n}function kr({key:f,value:n}){return s.a0(n)?[]:[new s.V(f,n,`string expected, ${s.K(n)} found`)]}const yr={promoteId:function f({key:n,value:c}){if(s.a0(c))return kr({key:n,value:c});if(Array.isArray(c)){const x=[],b=s.S(c),E=s.U(b);return E.result==="error"&&E.value.forEach(I=>{x.push(new s.V(`${n}${I.key}`,null,`${I.message}`))}),s.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),x}if(!s.H(c))return[new s.V(n,c,`string, expression or object expected, "${s.K(c)}" found`)];const p=[];for(const x in c)p.push(...f({key:`${n}.${x}`,value:c[x]}));return p}};function Vi(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(c,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(c,n,'"type" is required')];const b=s.J(n.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||E.push(new s.a3(c,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Yr({key:c,value:n,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:yr})),E;case"geojson":if(E=Yr({key:c,value:n,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:yr}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${c}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const I in n.clusterProperties){const M=n.clusterProperties[I];if(!Array.isArray(M))return[new s.V(`${c}.clusterProperties.${I}`,M,"array expected")];const[z,O]=M,H=typeof z=="string"?[z,["accumulated"],["get",I]]:z;E.push(...Ur({key:`${c}.${I}.map`,value:O,expressionContext:"cluster-map"})),E.push(...Ur({key:`${c}.${I}.reduce`,value:H,expressionContext:"cluster-reduce"}))}}return E;case"video":return Yr({key:c,value:n,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Yr({key:c,value:n,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new s.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tn({key:`${c}.type`,value:n.type,valueSpec:{values:ra(p)}})}}function ra(f){return f.source.reduce((n,c)=>{const p=f[c];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values||{}))),n},[])}function bs(f){const n=f.value,c=f.styleSpec,p=c.light,x=f.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let b=[];for(const E in n){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);b=b.concat(M&&p[M[1]]?ji({key:E,value:n[E],valueSpec:{type:"string"},style:x,styleSpec:c}):I&&p[I[1]]&&p[I[1]].transition?ji({key:E,value:n[E],valueSpec:c.transition,style:x,styleSpec:c}):p[E]?ji({key:E,value:n[E],valueSpec:p[E],style:x,styleSpec:c}):[new s.V(E,n[E],`unknown property "${E}"`)])}return b}function cl(f){const n=f.value;if(!n)return[];const c=f.key;if(!s.H(n))return[new s.V(c,n,`object expected, ${s.K(n)} found`)];let p=[];const x=f.styleSpec,b=x["light-3d"],E=f.style,I=f.style.lights;for(const O of["type","id"])if(!(O in n))return p=p.concat([new s.V(c,n,`missing property "${O}"`)]),p;if(!s.a0(n.type))return p=p.concat([new s.V(`${c}.type`,n.type,"string expected")]),p;if(I)for(let O=0;O<f.arrayIndex;O++){const H=s.J(n.type),G=I[O];s.J(G.type)===H&&p.push(new s.V(c,n.id,`duplicate light type "${n.type}", previously defined at line ${G.id.__line__}`))}const M=`properties_light_${n.type}`;if(!(M in x))return p=p.concat([new s.V(`${c}.type`,n,`Invalid light type ${n.type}`)]),p;const z=x[M];for(const O in n)if(O==="properties"){const H=n[O];if(!s.H(H))return p=p.concat([new s.V("properties",H,`object expected, ${s.K(H)} found`)]),p;for(const G in H){const $=G.match(/^(.*)-transition$/),J=G.match(/^(.*)-use-theme$/);p=p.concat(J&&z[J[1]]?ji({key:O,value:H[G],valueSpec:{type:"string"},style:E,styleSpec:x}):$&&z[$[1]]&&z[$[1]].transition?ji({key:O,value:n[O],valueSpec:x.transition,style:E,styleSpec:x}):z[G]?ji({key:G,value:H[G],valueSpec:z[G],style:E,styleSpec:x}):[new s.a3(f.key,H[G],`unknown property "${G}"`)])}}else p=p.concat(b[O]?ji({key:O,value:n[O],valueSpec:b[O],style:E,styleSpec:x}):[new s.a3(O,n[O],`unknown property "${O}"`)]);return p}function Ca(f){const n=f.value,c=f.key,p=f.style,x=f.styleSpec,b=x.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let E=[];for(const I in n){const M=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);E=E.concat(z&&b[z[1]]?ji({key:I,value:n[I],valueSpec:{type:"string"},style:p,styleSpec:x}):M&&b[M[1]]&&b[M[1]].transition?ji({key:I,value:n[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?ji({key:I,value:n[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,n[I],`unknown property "${I}"`)])}if(n.source)if(s.a0(n.source)){const I=p.sources&&p.sources[n.source],M=I&&s.J(I.type);I?M!=="raster-dem"&&E.push(new s.V(`${c}.source`,n.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):E.push(new s.V(`${c}.source`,n.source,`source "${n.source}" not found`))}else E.push(new s.V(`${c}.source`,n.source,"source must be a string"));else E.push(new s.V(c,n,'terrain is missing required property "source"'));return E}function bo(f){const n=f.value,c=f.style,p=f.styleSpec,x=p.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let b=[];for(const E in n){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);b=b.concat(M&&x[M[1]]?ji({key:E,value:n[E],valueSpec:{type:"string"},style:c,styleSpec:p}):I&&x[I[1]]&&x[I[1]].transition?ji({key:E,value:n[E],valueSpec:p.transition,style:c,styleSpec:p}):x[E]?ji({key:E,value:n[E],valueSpec:x[E],style:c,styleSpec:p}):[new s.a3(E,n[E],`unknown property "${E}"`)])}return b}const ms={"*":()=>[],array:Xs,boolean:function(f){const n=f.value,c=f.key;return s.$(n)?[]:[new s.V(c,n,`boolean expected, ${s.K(n)} found`)]},number:Rl,color:function({key:f,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(f,n,`color expected, "${n}" found`)]:[]:[new s.V(f,n,`color expected, ${s.K(n)} found`)]},enum:Tn,filter:ri,function:rc,layer:ps,object:Yr,source:Vi,model:s.a7,light:bs,"light-3d":cl,terrain:Ca,fog:bo,string:kr,formatted:function(f){return kr(f).length===0?[]:Ur(f)},resolvedImage:function(f){return kr(f).length===0?[]:Ur(f)},projection:function(f){const n=f.value,c=f.styleSpec,p=c.projection,x=f.style;if(s.H(n)){let b=[];for(const E in n)b=b.concat(ji({key:E,value:n[E],valueSpec:p[E],style:x,styleSpec:c}));return b}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(f){const n=f.key,{value:c,styleSpec:p}=f;if(!s.H(c))return[new s.V(n,c,"import must be an object")];const{data:x,...b}=c;Object.defineProperty(b,"__line__",{value:c.__line__,enumerable:!1});let E=Yr(Object.assign({},f,{value:b,valueSpec:p.import}));return s.J(b.id)===""&&E.push(new s.V(`${f.key}.id`,b,"import id can't be an empty string")),x&&(E=E.concat(_u(x,p,{key:`${f.key}.data`}))),E},iconset:function(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(c,n,"object expected")];if(!n.type)return[new s.V(c,n,'"type" is required')];const b=s.J(n.type);let E=[];if(E=E.concat(Yr({key:c,value:n,valueSpec:p[`iconset_${b}`],style:x,styleSpec:p})),(function(I,M){return!(I!=="source"||!M.source)})(b,n)){const I=x.sources&&x.sources[n.source],M=I&&s.J(I.type);I?M!=="raster-array"&&E.push(new s.V(c,n.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):E.push(new s.V(c,n.source,`source "${n.source}" not found`))}return E}};function ji(f,n=!1){const c=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression){if(s.a4(s.J(c)))return rc(f);if(s.Q(s.S(c)))return Ur(f)}if(p.type&&ms[p.type]){const b=ms[p.type](f);return n===!0&&b.length>0&&Array.isArray(f.value)?Ur(f):b}return Yr(Object.assign({},f,{valueSpec:p.type?x[p.type]:p}))}function Yr(f){const n=f.key,c=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},b=f.style,E=f.styleSpec;if(!s.H(c))return[new s.V(n,c,`object expected, ${s.K(c)} found`)];let I=[];for(const M in c){const z=M.split(".")[0];let O;x[z]?O=x[z]:p[z]?O=ji:x["*"]?O=x["*"]:p["*"]&&(O=ji),O?I=I.concat(O({key:(n&&`${n}.`)+M,value:c[M],valueSpec:p[z]||p["*"],style:b,styleSpec:E,object:c,objectKey:M},c)):I.push(new s.a3(n,c[M],`unknown property "${M}"`))}for(const M in p){if(x[M])continue;const z=p[M];z.required&&z.default===void 0&&c[M]===void 0&&I.push(new s.V(n,c,`missing required property "${M}"`))}return I}function wo({key:f,value:n}){const c=kr({key:f,value:n});if(c.length)return c;const p=n;return p.indexOf("{fontstack}")===-1&&c.push(new s.V(f,n,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new s.V(f,n,'"glyphs" url must include a "{range}" token')),c}function _u(f,n=s.a6,c={}){return Yr({key:c.key||"",value:f,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:f,objectElementValidators:{glyphs:wo}})}function ja(f,n=s.a6){return xe(_u(f,n))}const ul=f=>xe(Vi(f)),hl=f=>xe(bs(f)),Mt=f=>xe(cl(f)),no=f=>xe(Ca(f)),th=f=>xe(bo(f)),Lc=f=>xe((function(n){const c=n.value,p=n.style,x=n.styleSpec,b=x.snow;if(c===void 0)return[];if(!s.H(c))return[new s.V("snow",c,`object expected, ${s.K(c)} found`)];let E=[];for(const I in c){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&b[M[1]]&&b[M[1]].transition?ji({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?ji({key:I,value:c[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return E})(f)),ai=f=>xe((function(n){const c=n.value,p=n.style,x=n.styleSpec,b=x.rain;if(c===void 0)return[];if(!s.H(c))return[new s.V("rain",c,`object expected, ${s.K(c)} found`)];let E=[];for(const I in c){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&b[M[1]]&&b[M[1]].transition?ji({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?ji({key:I,value:c[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return E})(f)),Ue=f=>xe(ps(f)),ne=f=>xe(ri(f)),ae=f=>xe(Fs(f)),ye=f=>xe(gs(f)),De=f=>xe(s.a7(f));function xe(f){return f.slice().sort((n,c)=>n.line&&c.line?n.line-c.line:0)}function Be(f,n){let c=!1;if(n&&n.length)for(const p of n)p instanceof s.a3?s.w(p.message):(f.fire(new s.y(new Error(p.message))),c=!0);return c}const it=s.a6.light;let Ge;class at extends s.E{constructor(n,c="flat"){super(),this._transitionable=new s.a8(Ge||(Ge=new s.a9({anchor:new s.aa(it.anchor),position:new s.ab(it.position),color:new s.aa(it.color),intensity:new s.aa(it.intensity)}))),this.setLight(n,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c,p={}){this._validate(hl,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=c)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Be(this,n.call(ja,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Dt=s.a6.terrain;let It=class extends s.E{constructor(f,n,c,p,x){super(),this.scope=c,this._transitionable=new s.a8(new s.a9({source:new s.aa(Dt.source),exaggeration:new s.aa(Dt.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=x}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let c=-1,p=-1,x=1;for(const b of n.zoomStops)x=n.evaluate(new s.ac(b,{worldview:this.worldview})),x>.01?(c=b,p=-1):p=b;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const tn=.05;function yn(f,n,c,p){const x=s.ah(45,65,c),[b,E]=bn(f,p);let I=1-Math.min(1,Math.exp((n-b)/(E-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*f.alpha}function bn(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}function kn(f,n,c,p,x){const b=s.af([],[n,c,p],x.mercatorFogMatrix);return yn(f,s.ag(b),x.pitch,x._fov)}function Fn(f,n,c,p,x,b,E){const I=[[c,p,0],[x,p,0],[x,b,0],[c,b,0]];let M=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const O of I){const H=s.af([],O,n),G=s.ag(H);M=Math.min(M,G),z=Math.max(z,G)}return[yn(f,M,E.pitch,E._fov),yn(f,z,E.pitch,E._fov)]}const vn=s.a6.fog;class Pn extends s.E{constructor(n,c,p,x){super();const b=new s.a9({range:new s.aa(vn.range),color:new s.aa(vn.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(vn["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(vn["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(vn["horizon-blend"]),"star-intensity":new s.aa(vn["star-intensity"]),"vertical-range":new s.aa(vn["vertical-range"])});this._transitionable=new s.a8(b,p,new Map(x)),this.set(n,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new s.ai(b),this.scope=p}get state(){const n=this._transform,c=n.projection.name==="globe",p=s.aj(n.zoom),x=this.properties.get("range"),b=[.5,3];return{range:c?[s.ak(b[0],x[0],p),s.ak(b[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c,p={}){if(this._validate(th,n,p))return;const x=Object.assign({},n);for(const b of Object.keys(vn))x[b]===void 0&&(x[b]=vn[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?(function(p,x,b){const E=s.ae.fromLngLat(x),I=b.elevation?b.elevation.getAtPointOrZero(E):0;return kn(p,E.x,E.y,I,b)})(this.state,n,c):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Fn(this.state,c,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,c,p,x,b){return this._transform.projection.supportsFog?Fn(this.state,n,c,p,x,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?bn(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=n.points[p];let b;if(x[2]>=0)b=x;else{const E=n.points[p-4];b=s.am(E,x,E[2]/(E[2]-x[2]))}if(kn(this.state,b[0],b[1],0,this._transform)>=tn)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Be(this,n.call(ja,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let $i,vr,nr,br=class extends s.E{constructor(f,n,c,p){super();const x=$i||($i=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(Lc,f,c))return;const p=Object.assign({},f),x=s.a6.snow;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Be(this,f.call(ja,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},ir=class extends s.E{constructor(f,n,c,p){super();const x=vr||(vr=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(ai,f,c))return;const p=Object.assign({},f),x=s.a6.rain;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Be(this,f.call(ja,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class hi extends s.E{constructor(n,c,p,x){super(),this.scope=p,this._options=n,this.properties=new s.ai(c),this._transitionable=new s.a8(c,p,new Map(x)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,c){this._options=n,this._transitionable.setTransitionOrValue(n.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const hr=()=>nr||(nr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let Ni;const _i=()=>Ni||(Ni=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class Ei{constructor(n,c,p){this.screenBounds=n,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,c){let p,x;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);p=[b],x=c.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),E=s.P.convert(n[1]),I=b.add(E)._div(2);p=[b,E],x=s.aq(b,E).every(M=>c.isPointAboveHorizon(M))&&c.isPointAboveHorizon(I)}return new Ei(p,x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),s.ar(x,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,n),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>p.y))+((b.x>c.x)+(b.x>p.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(n,c,p,x=0){const b=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let I=n.tileID.wrap+(E.unwrapped?x:0);const M=E.polygon.map(ee=>s.as(n.tileTransform,ee,I));if(!s.at(M,0,0,s.al,s.al))return;I=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(ee=>s.au(n.tileTransform,ee,I)),O=z.map(ee=>new s.P(ee[0],ee[1])),H=c.getFreeCameraOptions().position||new s.ae(0,0,0),G=s.au(n.tileTransform,H,I),$=z.map(ee=>{const re=s.av(ee,ee,G);return s.aw(re,re),new s.ax(G,re)}),J=s.ay(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:$,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(Y=s.az(M),Y.min.x=s.aA(Y.min.x,0,s.al),Y.min.y=s.aA(Y.min.y,0,s.al),Y.max.x=s.aA(Y.max.x,0,s.al),Y.max.y=s.aA(Y.max.y,0,s.al),Y),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:J};var Y}_bufferedScreenMercator(n,c){const p=es(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(n,c){const p=es(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(n,c){const p=(function(b,E){const I=s.aB([],E.pixelMatrix,E.globeMatrix),M=[0,-s.aD,0,1],z=[0,s.aD,0,1],O=[0,0,0,1];s.aC(M,M,I),s.aC(z,z,I),s.aC(O,O,I);const H=new s.P(M[0]/M[3],M[1]/M[3]),G=new s.P(z[0]/z[3],z[1]/z[3]),$=s.aE(b,H)&&M[3]<O[3],J=s.aE(b,G)&&z[3]<O[3];if(!$&&!J)return null;const Y=(function(Ae,ve,ge){for(let Pe=1;Pe<Ae.length;Pe++){const Le=Jr(ve.pointCoordinate3D(Ae[Pe-1]).x),Fe=Jr(ve.pointCoordinate3D(Ae[Pe]).x);if(ge<0){if(Le<Fe)return{idx:Pe,t:-Le/(Fe-1-Le)}}else if(Fe<Le)return{idx:Pe,t:(1-Le)/(Fe+1-Le)}}return null})(b,E,$?-1:1);if(!Y)return null;const{idx:ee,t:re}=Y;let pe=ee>1?dr(b.slice(0,ee),E):[],fe=ee<b.length?dr(b.slice(ee),E):[];pe=pe.map(Ae=>new s.P(Jr(Ae.x),Ae.y)),fe=fe.map(Ae=>new s.P(Jr(Ae.x),Ae.y));const ue=[...pe];ue.length===0&&ue.push(fe[fe.length-1]);const Ie=s.ak(ue[ue.length-1].y,(fe.length===0?pe[0]:fe[0]).y,re);let Te;return Te=$?[new s.P(0,Ie),new s.P(0,0),new s.P(1,0),new s.P(1,Ie)]:[new s.P(1,Ie),new s.P(1,1),new s.P(0,1),new s.P(0,Ie)],ue.push(...Te),fe.length===0?ue.push(pe[0]):ue.push(...fe),{polygon:ue.map(Ae=>new s.ae(Ae.x,Ae.y)),unwrapped:!1}})(n,c);if(p)return p;const x=(function(b,E){let I=!1,M=-1/0,z=0;for(let H=0;H<b.length-1;H++)b[H].x>M&&(M=b[H].x,z=H);for(let H=0;H<b.length-1;H++){const G=(z+H)%(b.length-1),$=b[G],J=b[G+1];Math.abs($.x-J.x)>.5&&($.x<J.x?($.x+=1,G===0&&(b[b.length-1].x+=1)):(J.x+=1,G+1===b.length-1&&(b[0].x+=1)),I=!0)}const O=s.aF(E.center.lng);return I&&O<Math.abs(O-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:I}})(dr(n,c).map(b=>new s.P(Jr(b.x),b.y)),c);return{polygon:x.polygon.map(b=>new s.ae(b.x,b.y)),unwrapped:x.unwrapped}}}function dr(f,n){return s.aG(f,c=>{const p=n.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Jr(f){return f<0?1+f%1:f%1}function es(f){return 100*f|0}function fr(f,n,c,p,x){const b=function(I,M){if(I)return x(I);if(M){if(f.url&&M.tiles&&f.tiles&&delete f.tiles,M.variants){if(!Array.isArray(M.variants))return x(new Error("variants must be an array"));for(const O of M.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return x(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){M=Object.assign(M,O);break}}}const z=s.aH(Object.assign({},M,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=n.canonicalizeTileset(z,f.url),x(null,z)}},E=(function(I,M,z){if(!I)return null;if(!M&&!z)return I;z=z||I.worldview_default;const O=Object.values(I.language||{});if(O.length===0)return null;const H=Object.values(I.worldview||{});if(H.length===0)return null;const G=O.every(J=>J===M),$=H.every(J=>J===z);return G&&$?I:M in(I.language_options||{})||z in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null})(f.data,c,p);return E?s.o.frame(()=>b(null,E)):f.url?s.m(n.transformRequest(n.normalizeSourceURL(f.url,null,c,p),s.R.Source),b):s.o.frame(()=>{const{data:I,...M}=f;b(null,M)})}function ws(f,n){const c=Math.pow(2,n.z),p=Math.floor(s.aF(f.getWest())*c),x=Math.floor(s.aJ(f.getNorth())*c),b=Math.ceil(s.aF(f.getEast())*c),E=Math.ceil(s.aJ(f.getSouth())*c);return n.x>=p&&n.x<b&&n.y>=x&&n.y<E}class Ts{constructor(n,c,p){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const c of n)this.extraBounds.push(s.aI.convert(this.validateBounds(c)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!ws(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(ws(c,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const c=new Ts(n.bounds,n.minzoom,n.maxzoom);return c.addExtraBounds(n.extra_bounds),c}}class ma extends s.E{constructor(n,c,p,x){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=fr(this._options,this.map._requestManager,c,p,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(x));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of b.vector_layers)this.vectorLayerIds.push(E.id),b.worldview&&b.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Ts.fromTileJSON(b),Ne(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,c){const p=n.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(x,s.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,I=E?{image:E.image.clone()}:null,M={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(p)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",M,z.bind(this));else if(n.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",M,z.bind(this),void 0,!0);else{const O=s.aL.call({deduped:this._deduped},M,(H,G)=>{if(H||!G)z.call(this,H);else{const $=s.aM(G.responseHeaders);M.data={rawData:G.rawData.slice(0),expires:$.expires,cacheControl:$.cacheControl},n.actor&&n.actor.send("loadTile",M,z.bind(this),void 0,!0)}},!0);n.request={cancel:O}}function z(O,H){return delete n.request,n.aborted?c(null):O&&O instanceof s.aN&&O.status!==404?c(O):(H&&H.resourceTiming&&(n.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&n.setExpiryData(H),n.loadVectorData(H,this.map.painter),s.aO(this.dispatcher),c(null,H),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class _s extends s.E{constructor(n,c,p,x){super(),this.id=n,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,s.aH(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=fr(this._options,this.map._requestManager,null,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Ts.fromTileJSON(x),Ne(x.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const p=s.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(x,s.R.Tile),(b,E,I)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(b)return n.state="errored",c(b);if(!E)return c(null);const M=s.aM(I);this.map._refreshExpiredTiles&&n.setExpiryData(M),n.setTexture(E,this.map.painter),n.state="loaded",s.aO(this.dispatcher),c(null)})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c&&c()}unloadTile(n,c){n.texture&&n.texture instanceof s.T?(n.destroy(!1),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sa([f,n],c,p,{scaled:x=!0}={}){const{tileSize:b,buffer:E}=p,{x:I,y:M,z}=c;if(!isFinite(I)||!isFinite(M)||!isFinite(z))throw new Error("Invalid MRT header");const O=2**z,H=O*s.aF(f),G=O*s.aJ(n);return(function([$,J],Y,{scaled:ee=!0}={}){if(!Y)throw new Error("bandView is undefined");const{data:re,tileSize:pe,buffer:fe,offset:ue,scale:Ie,dimension:Te}=Y;if($<-fe||$>pe+fe||J<-fe||J>pe+fe)throw new Error(`Point (${$}, ${J}) out of bounds for tileSize=${pe}, buffer=${fe}`);const Ae=(J+fe)*(pe+2*fe)+($+fe);if(new Uint32Array(re.buffer)[Ae]===4294967295)return null;let ve=[];ve=ee?[]:new Y.data.constructor(Te);for(let ge=0;ge<Te;ge++)ve[ge]=Math.round(1e12*(re[Te*Ae+ge]*Ie+ue))/1e12;return ve})([Math.min(Math.max(-E,Math.floor((H-I)*b)),b-1+E),Math.min(Math.max(-E,Math.floor((G-M)*b)),b-1+E)],p,{scaled:x})}class aa extends _s{constructor(n,c,p,x){super(n,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(n){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,c){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile),b={request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=x,n.actor||(n.actor=this.dispatcher.getActor());const E=(I,M,z)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(I)return I.name==="AbortError"?void 0:(n.state="errored",c(I));if(this.map._refreshExpiredTiles&&M){const O=s.aM(z);n.setExpiryData(O)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!M)return c(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=M}c(null)};n.request=this.partial?n.fetchHeader(void 0,E.bind(this)):n.actor.send("loadTile",b,E.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){const p=n.texturePerLayer;if(n.flushAllQueues(),p.size){n.destroy(!1);for(const x of p.values())this.map.painter.saveTileTexture(x)}else n.destroy()}prepareTile(n,c,p,x){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(c,p,x,(b,E)=>{if(b)return n.state="errored",this.fire(new s.y(b)),void this.triggerRepaint(n);E&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(p,E,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:b})=>b===n),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(n,c,p){if(!n)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;c instanceof s.aR?b=c.paint.get("raster-array-band"):c instanceof s.aS&&(b=c.paint.get("raster-particle-array-band"));const E=b||this.getInitialBand(x);if(E==null)return;if(!n.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(n,x,c.id,E);if(n.updateNeeded(c.id,E)&&!p)return;const I=n.textureDescriptorPerLayer.get(c.id);return Object.assign({},I,{texture:n.texturePerLayer.get(c.id)})}getImages(n,c){const p=new Map;for(const x of n)for(const b of c){const[E,I]=b.split("/"),M=x.getLayer(E);if(!M||!M.hasBand(I)||!M.hasDataForBand(I))continue;const{bytes:z,tileSize:O,buffer:H}=M.getBandView(I),G=O+2*H,$={data:new s.q({width:G,height:G},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,$)}return p}queryRasterArrayValueByBandId(n,c,p){const x=c._mrt;return new Promise(b=>{const E={},I=new Set;for(const[M,z]of Object.entries(x.layers)){if(p.layerName&&M!==p.layerName)continue;const O={};E[M]=O;for(const{bands:H}of z.dataIndex)for(const G of H)p.bands&&!p.bands.includes(G)||(I.add(s.B(M,G)),c.fetchBand(M,null,G,$=>{s.o.frame(()=>{O[G]=$?null:sa([n.lng,n.lat],x,z.getBandView(G)),I.delete(s.B(M,G)),I.size===0&&b(E)})},!1))}I.size===0&&b(E)})}_loadTileForQuery(n,c){if(this._loadTileLoaded[n.uid])return void c(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(c);this._loadTilePending[n.uid]=[c];const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile);n.actor.send("loadTile",{request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,E,I)=>{if(b)return this._loadTilePending[n.uid].forEach(M=>M(b,null)),void delete this._loadTilePending[n.uid];if(!E)return this._loadTilePending[n.uid].forEach(M=>M(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&E){const M=s.aM(I);n.setExpiryData(M)}n._mrt=E,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(M=>M(null,E)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,c,p){return new Promise((x,b)=>{this._loadTileForQuery(c,(E,I)=>{E?b(E):x(I?this.queryRasterArrayValueByBandId(n,c,p):null)})})}queryRasterArrayValue(n,c){const p=s.aT.convert(n),x=this.findLoadedParent(p);return x&&x._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,c):this.queryRasterArrayValueByAllBands(p,x,c):Promise.resolve(null)}findLoadedParent(n){const c=s.ae.fromLngLat(n,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,b=Math.floor(c.x),E=Math.floor((c.x-b)*x),I=Math.floor(c.y*x),M=this.map.style.getSourceCache(this.id),z=new s.aQ(p,b,p,E,I);return M.findLoadedParent(z,this.minzoom)}}const $o={vector:ma,raster:_s,"raster-dem":class extends _s{constructor(f,n,c,p){super(f,n,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,b){x&&(f.state="errored",n(x)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=s.n(this.map._requestManager.transformRequest(c,s.R.Tile),(function(x,b,E){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(x)f.state="errored",n(x);else if(b){const I=s.aM(E);this.map._refreshExpiredTiles&&f.setExpiryData(I);const M=ImageBitmap&&b instanceof ImageBitmap&&s.r(),z=1-(b.width-s.aP(b.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=M?b:s.o.getImageData(b,z),H={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:z};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",H,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),p=(n.x-1+c)%c,x=n.x===0?f.wrap-1:f.wrap,b=(n.x+1+c)%c,E=n.x+1===c?f.wrap+1:f.wrap,I={};return I[new s.aQ(f.overscaledZ,x,n.z,p,n.y).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(I[new s.aQ(f.overscaledZ,x,n.z,p,n.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<c&&(I[new s.aQ(f.overscaledZ,x,n.z,p,n.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y+1).key]={backfilled:!1}),I}},"raster-array":aa,geojson:class extends s.E{constructor(f,n,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const c of this._data.features)n.set(c.id,c);for(const c of f.features)n.set(c.id,c);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:f},this.workerOptions);n.scope=this.scope;const c=this._data;typeof c=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(c),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,b=this._partialReload,E={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};f.request=this.actor.send(c,E,(I,M)=>b&&!M?(f.state="loaded",n(null)):(delete f.request,f.destroy(!1),f.aborted?n(null):I?n(I):(f.loadVectorData(M,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(f,n,c,p){super(f,n,c,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aV(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new s.y(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(f,n,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=fr(this._options,this.map._requestManager,n,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Ts(x.bounds,this.minzoom,this.maxzoom)),Ne(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const b=Object.values(f.buckets);for(const E of b)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(b,E){return f.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadModelData(E,this.map.painter),f.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(f,n,c,p){super(f,n,c,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,n,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ts(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:c,y:p,z:x}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:b.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",n(null)):E===void 0?(f.state="errored",n(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):(function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement})(E)?(this.loadTileData(f,E),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(f.state="errored",n(E))}),f.request.cancel=()=>b.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof s.T?(f.destroy(!1),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},To=function(f,n,c,p){const x=new $o[n.type](f,n,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return s.aY(["load","abort","unload","serialize","prepare"],x),x};function Ua(f,n,c=""){return`${c}:${n.id||""}:${n.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:b}=p;return`featureset:${x}${b?`:import:${b}`:""}`}})(f.target)}`}function dl(f,n,c,p=""){if(f.uniqueFeatureID){const x=Ua(f,n,p);if(c.has(x))return!0;c.add(x)}return!1}function ga(f,n,c,p,x=!1,b=void 0){const E=n.sourceCache.transform,I=n.sourceCache.tilesIn(f,n.has3DLayers,x);I.sort(nh);const M=[];for(const z of I){const O=z.tile.queryRenderedFeatures(n,z,c,p,E,x,b);Object.keys(O).length&&M.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:O})}for(const z in n.layers){const O=n.layers[z];if(O.styleLayer){const H=O.styleLayer.queryRenderedFeatures(f,n.sourceCache,p);Object.keys(H).length&&M.push({wrappedTileID:0,queryResults:H})}}return M.length===0?{}:(function(z){const O={},H={};for(const G of z){const $=G.queryResults,J=G.wrappedTileID,Y=H[J]=H[J]||{};for(const ee in $){const re=$[ee],pe=Y[ee]=Y[ee]||{},fe=O[ee]=O[ee]||[];for(const ue of re)pe[ue.featureIndex]||(pe[ue.featureIndex]=!0,fe.push(ue))}}return O})(M)}function pf(f,n,c,p,x,b){const E={},I=p.queryRenderedSymbols(f),M=[];for(const z of Object.keys(I).map(Number))M.push(x[z]);M.sort(nh);for(const z of M){const O=z.featureIndex.lookupSymbolFeatures(I[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,n,c,b);for(const H in O){const G=E[H]=E[H]||[],$=O[H];$.sort((J,Y)=>{const ee=z.featureSortOrder;if(ee){const re=ee.indexOf(J.featureIndex);return ee.indexOf(Y.featureIndex)-re}return Y.featureIndex-J.featureIndex});for(const J of $)G.push(J)}}return E}function td(f,n){const c=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],x={};for(let b=0;b<c.length;b++){const E=c[b],I=E.tileID.canonical.key;x[I]||(x[I]=!0,E.querySourceFeatures(p,n))}return p}function nh(f,n){const c=f.tileID,p=n.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function yu(f,n){const c={};if(!n)return c;for(const p of f){const x=p.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>x.filter(E=>E.id===b)[0]));for(const b of x)c[b.fqid]=p}}return c}const Es=32,Ys=33,Eo=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,c=0,p=0,x=0,b=0,E=0,I=0;for(1&n?x=b=E=Es:c=p=I=Es;(n>>=1)>1;){const z=c+x>>1,O=p+b>>1;1&n?(x=c,b=p,c=E,p=I):(c=x,p=b,x=E,b=I),E=z,I=O}const M=4*f;Eo[M+0]=c,Eo[M+1]=p,Eo[M+2]=x,Eo[M+3]=b}const Ss=new Uint16Array(2178),So=new Uint8Array(1089),Ra=new Uint16Array(1089);function Zo(f){return f===0?-.03125:f===32?.03125:0}const Ga={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Ao{constructor(n,c,p,x,b,E){this.tileID=n,this.uid=s.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(n){const c=n+this.timeAdded;c<s.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,c,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=yu(n.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b4){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b4&&b.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],E=c.style.getOwnLayer(x);if(!E)continue;const I=E.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,I)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,c,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,yu(n.buckets,c.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,c){for(const b in this.buckets){const E=this.buckets[b];if(E.uploadPending()){let I={},M=[],z={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){M=c.style.listImages();const O=E.layers[0],H=O.sourceLayer||"_geojsonTileLayer",G=c.style.getLayerSourceCache(O);G&&(I=G._state.getState(H,void 0))}z={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}E.upload(n,this.tileID.canonical,I,M,z)}}const p=n.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new s.T(n,x.image,p.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(n,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&c){const b=c.style.getLut(p);this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p,b)}if(!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const c in this.buckets){const p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,p.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,c,p,x,b,E,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=this.evaluateQueryRenderedFeaturePadding(),z=(function(O,H){const G=s.bq([],[.5*O.width,.5*-O.height,1]);return s.br(G,G,[1,-1,0]),s.aB(G,G,O.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(G)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:c,pixelPosMatrix:z,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:M,scope:I})}querySourceFeatures(n,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),b=c?c.sourceLayer:"",E=x._geojsonTileLayer||x[b];if(!E)return;const I=s.b6(c&&c.filter),{z:M,x:z,y:O}=this.tileID.canonical,H={z:M,x:z,y:O};for(let G=0;G<E.length;G++){const $=E.feature(G);if(I.needGeometry){const ee=s.b7($,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ee,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),$))continue;const J=p.getId($,b),Y=new s.b8($,M,z,O,J);Y.tile=H,n.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const c=this.expirationTime;if(n.cacheControl){const p=s.b9(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const c in this.buckets)if(n.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(n,c){if(!this.latestFeatureIndex||!n.style)return;const p=n.style.listImages(),x=n.style.getBrightness();for(const b in this.buckets){if(!n.style.hasLayer(b))continue;const E=this.buckets[b],I=E.layers[0],M=I.sourceLayer||"_geojsonTileLayer",z=n.style.getLayerSourceCache(I);let O={};z&&(O=z._state.getState(M,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},G=Object.keys(O).length>0&&!c;E.hasAppearances=E.layers.some(Y=>Y.appearances&&Y.appearances.length>0);const $=G?E.stateDependentLayers:E.layers;if(G&&E.stateDependentLayers.length!==0||c){const Y=this.latestFeatureIndex.loadVTLayers();E.update(O,Y[M],p,H,$,c,x)}if(G&&E.stateDependentLayers.length!==0||c||E.hasAppearances){const Y={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};E.updateAppearances(this.tileID.canonical,O,p,Y,n.imageManager)}(E instanceof s.ba||E instanceof s.bb)&&n._terrain&&n._terrain.enabled&&z&&E.uploadPending()&&n._terrain._clearRenderCacheForTile(z.id,this.tileID);const J=n&&n.style&&n.style.getOwnLayer(b);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(n,c){const p={};for(const x of c)p[x]=!0;this.dependencies[n]=p}hasDependency(n,c){for(const p of n){const x=this.dependencies[p];if(x){for(const b of c)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=s.bc(Ga,this.tileID.canonical,this.tileTransform)[0],x=new s.bd,b=new s.be;for(let E=0;E<p.length;E++){const{x:I,y:M}=p[E];x.emplaceBack(I,M),b.emplaceBack(E)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(x,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(n,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=s.bc(Ga,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const E=(function(I,M){const z=s.aZ(I,M),O=Math.pow(2,I.z);for(let ee=0;ee<Ys;ee++)for(let re=0;re<Ys;re++){const pe=s.a_((I.x+(re+Zo(re))/Es)/O),fe=s.a$((I.y+(ee+Zo(ee))/Es)/O),ue=M.project(pe,fe),Ie=ee*Ys+re;Ss[2*Ie+0]=Math.round((ue.x*z.scale-z.x)*s.al),Ss[2*Ie+1]=Math.round((ue.y*z.scale-z.y)*s.al)}So.fill(0),Ra.fill(0);for(let ee=2045;ee>=0;ee--){const re=4*ee,pe=Eo[re+0],fe=Eo[re+1],ue=Eo[re+2],Ie=Eo[re+3],Te=pe+ue>>1,Ae=fe+Ie>>1,ve=Te+Ae-fe,ge=Ae+pe-Te,Pe=fe*Ys+pe,Le=Ie*Ys+ue,Fe=Ae*Ys+Te,We=Math.hypot((Ss[2*Pe+0]+Ss[2*Le+0])/2-Ss[2*Fe+0],(Ss[2*Pe+1]+Ss[2*Le+1])/2-Ss[2*Fe+1])>=16;So[Fe]=So[Fe]||(We?1:0),ee<1022&&(So[Fe]=So[Fe]||So[(fe+ge>>1)*Ys+(pe+ve>>1)]||So[(Ie+ge>>1)*Ys+(ue+ve>>1)])}const H=new s.b1,G=new s.b0;let $=0;function J(ee,re){const pe=re*Ys+ee;return Ra[pe]===0&&(H.emplaceBack(Ss[2*pe+0],Ss[2*pe+1],ee*s.al/Es,re*s.al/Es),Ra[pe]=++$),Ra[pe]-1}function Y(ee,re,pe,fe,ue,Ie){const Te=ee+pe>>1,Ae=re+fe>>1;if(Math.abs(ee-ue)+Math.abs(re-Ie)>1&&So[Ae*Ys+Te])Y(ue,Ie,ee,re,Te,Ae),Y(pe,fe,ue,Ie,Te,Ae);else{const ve=J(ee,re),ge=J(pe,fe),Pe=J(ue,Ie);G.emplaceBack(ve,ge,Pe)}}return Y(0,0,Es,Es,Es,0),Y(Es,Es,0,0,0,Es),{vertices:H,indices:G}})(this.tileID.canonical,c);x=E.vertices,b=E.indices}else{x=new s.b1,b=new s.b0;for(const{x:I,y:M}of p)x.emplaceBack(I,M,0,0);const E=s.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let I=0;I<E.length;I+=3)b.emplaceBack(E[I],E[I+1],E[I+2])}this._tileBoundsBuffer=n.createVertexBuffer(x,s.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.bg.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(n,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,b=s.bj(x,c),E=s.bk(b),I=s.aj(c.zoom);let M;I>0&&(M=s.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,x,c,E,M,I),this._makeGlobeTileDebugTextBuffer(n,x,c,E,M,I)}_globePoint(n,c,p,x,b,E,I){let M=s.bm(n,c,p);if(E){const z=1<<p.z,O=s.aF(x.center.lng),H=s.aJ(x.center.lat),G=(p.x+.5)/z-O;let $=0;G>.5?$=-1:G<-.5&&($=1);let J=(n/s.al+p.x)/z+$,Y=(c/s.al+p.y)/z;J=(J-O)*x._pixelsPerMercatorPixel+O,Y=(Y-H)*x._pixelsPerMercatorPixel+H;const ee=[J*x.worldSize,Y*x.worldSize,0];s.af(ee,ee,E),M=s.bn(M,ee,I)}return s.af(M,M,b)}_makeGlobeTileDebugBorderBuffer(n,c,p,x,b,E){const I=new s.bd,M=new s.be,z=new s.bo,O=(G,$,J,Y,ee)=>{const re=(J-G)/(ee-1),pe=(Y-$)/(ee-1),fe=I.length;for(let ue=0;ue<ee;ue++){const Ie=G+ue*re,Te=$+ue*pe;I.emplaceBack(Ie,Te);const Ae=this._globePoint(Ie,Te,c,p,x,b,E);z.emplaceBack(Ae[0],Ae[1],Ae[2]),M.emplaceBack(fe+ue)}},H=s.al;O(0,0,H,0,16),O(H,0,H,H,16),O(H,H,0,H,16),O(0,H,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(M),this._tileDebugBuffer=n.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(z,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,M.length)}_makeGlobeTileDebugTextBuffer(n,c,p,x,b,E){const I=s.al/4,M=new s.bd,z=new s.b0,O=new s.bo,H=25;z.reserve(32),M.reserve(H),O.reserve(H);const G=($,J)=>H*$+J;for(let $=0;$<H;$++){const J=$*I;for(let Y=0;Y<H;Y++){const ee=Y*I;M.emplaceBack(ee,J);const re=this._globePoint(ee,J,c,p,x,b,E);O.emplaceBack(re[0],re[1],re[2])}}for(let $=0;$<4;$++)for(let J=0;J<4;J++){const Y=G($,J),ee=G($,J+1),re=G($+1,J),pe=G($+1,J+1);z.emplaceBack(Y,ee,re),z.emplaceBack(re,ee,pe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(z),this._tileDebugTextBuffer=n.createVertexBuffer(M,s.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(O,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,H,32)}destroy(n=!0){for(const c in this.buckets)this.buckets[c].destroy(n);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class zc extends Ao{constructor(n,c,p,x,b){super(n,c,p,x,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,c,p){const x=p.context,b=x.gl;let E=this.texturePerLayer.get(n)||p.getTileTexture(c.width);E&&E instanceof s.T?E.update(c,{premultiply:!1}):E=new s.T(x,c,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,E)}flushQueues(n){const c=this._workQueuePerLayer.get(n)||[],p=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}}fetchHeader(n=16384,c){const p=this._mrt=new s.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bu(x,(b,E,I)=>{if(b)c(b);else try{const M=p.getHeaderLength(E);if(M>n)return void(this.request=this.fetchHeader(M,c));p.parseHeader(E),this._isHeaderLoaded=!0;let z=0;for(const O of Object.values(p.layers))z=Math.max(z,O.dataIndex[O.dataIndex.length-1].lastByte);E.byteLength>=z&&(this.entireBuffer=E),c(null,this.entireBuffer||E,I)}catch(M){c(M)}}),this.request}fetchBandForRender(n,c,p,x){this.fetchBand(n,c,p,b=>{if(b)return void x(b);this.updateTextureDescriptor(n,c,p);const E=this.textureDescriptorPerLayer.get(c);x(null,E?E.img:null)})}fetchBand(n,c,p,x,b=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void x(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void x(new Error("Can't fetch tile band without an actor"));let M;const z=s.B(String(p),s.B(this.tileID.key,n));let O=this._taskQueue.get(z);O?O.add(x):(O=new Set,O.add(x),this._taskQueue.set(z,O));const H=(Y,ee)=>{M.complete(Y,ee),Y?x(Y):(O.forEach(re=>re(null,ee)),this._taskQueue.delete(z))},G=(Y,ee)=>{if(Y)return x(Y);const re=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ee,task:M},H,void 0,!0);if(c!==null){const pe=this._workQueuePerLayer.get(c)||[];pe.push(()=>{re&&re.cancel(),M.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,pe)}};let $;try{$=E.getLayer(n)}catch(Y){if(this.state==="reloading")return;throw Y}if(!$)return void x(new Error(`Unknown sourceLayer "${n}"`));if($.hasDataForBand(p))return O.forEach(Y=>Y(null,null)),void this._taskQueue.delete(z);const J=$.getDataRange([p]);if(M=E.createDecodingTask(J),!M||M.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)G(null,this.entireBuffer.slice(J.firstByte,J.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${J.firstByte}-${J.lastByte}`}}),ee=s.bu(Y,G);if(c!==null){const re=this._fetchQueuePerLayer.get(c)||[];re.push(()=>{ee.cancel(),M.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,re)}}}updateNeeded(n,c){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,c,p){if(!this._mrt)return;const x=this._mrt.getLayer(n);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:b,tileSize:E,buffer:I,offset:M,scale:z}=x.getBandView(p),O=E+2*I,H=new s.q({width:O,height:O},b),G=this.texturePerLayer.get(c);G&&G instanceof s.T&&G.update(H,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:n,band:p,img:H,buffer:I,offset:M,tileSize:E,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const c of this.texturePerLayer.values())c&&c instanceof s.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Oc{constructor(n,c){this.max=n,this.onRemove=c,this.reset()}reset(){for(const n in this.data)for(const c of this.data[n])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(n,c,p){const x=n.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:c,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},p)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const c=this.data[n].shift();return c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),c.value}getByKey(n){const c=this.data[n];return c?c[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,c){if(!this.has(n))return this;const p=n.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),b=this.data[p][x];return this.data[p].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(n){const c=[];for(const p in this.data)for(const x of this.data[p])n(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class fl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,c,p){const x=String(c);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][x]=this.stateChanges[n][x]||{},Object.assign(this.stateChanges[n][x],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==x&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][x]===null){this.deletedStates[n][x]={};for(const b in this.state[n][x])p[b]||(this.deletedStates[n][x][b]=null)}else for(const b in p)this.deletedStates[n]&&this.deletedStates[n][x]&&this.deletedStates[n][x][b]===null&&delete this.deletedStates[n][x][b]}removeFeatureState(n,c,p){if(this.deletedStates[n]===null)return;const x=String(c);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&c!==void 0)this.deletedStates[n][x]!==null&&(this.deletedStates[n][x]=this.deletedStates[n][x]||{},this.deletedStates[n][x][p]=null);else if(c!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][x])for(p in this.deletedStates[n][x]={},this.stateChanges[n][x])this.deletedStates[n][x][p]=null;else this.deletedStates[n][x]=null;else this.deletedStates[n]=null}getState(n,c){const p=this.state[n]||{},x=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(c!==void 0){const I=String(c),M=Object.assign({},p[I],x[I]);if(b){const z=b[c];if(z===null)return{};for(const O in z)delete M[O]}return M}const E=Object.assign({},p,x);if(b)for(const I in b)delete E[I];return E}initializeTileState(n,c){n.refreshFeatureState(c)}coalesceChanges(n,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),Object.assign(this.state[x][E],this.stateChanges[x][E]),b[E]=this.state[x][E];p[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const E in this.state[x])b[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const I of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][I];b[E]=this.state[x][E]}p[x]=p[x]||{},Object.assign(p[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in n)n[x].refreshFeatureState(c)}}class us extends s.E{constructor(n,c,p){super(),this.id=n,this._onlySymbols=p,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Oc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,c){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,c)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(n,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Ml).map(n=>n.key)}getRenderableIds(n,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,n,c)&&p.push(this._tiles[x]);return n?p.sort((x,b)=>{const E=x.tileID,I=b.tileID,M=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-I.overscaledZ||z.y-M.y||z.x-M.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Ml).map(x=>x.key)}hasRenderableParent(n){const c=this.findLoadedParent(n,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(n,c,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(c||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,c){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,n,c)))}_tileLoaded(n,c,p,x,b){if(x){if(n.state="errored",x.status!==404)this._source.fire(new s.y(x,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=s.o.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(c,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let E=new Map;b&&b.responseHeaders&&(E=b.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(n){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const b=c[x];if(n.neighboringTiles&&n.neighboringTiles[b]){const E=this.getTileByID(b);p(n,E),p(E,n)}}function p(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=b.tileID.canonical.x-x.tileID.canonical.x;const I=b.tileID.canonical.y-x.tileID.canonical.y,M=Math.pow(2,x.tileID.canonical.z),z=b.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,E,I),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,c,p,x){for(const b in this._tiles){let E=this._tiles[b];if(x[b]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>p)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(I=z)}let M=I;for(;M.overscaledZ>c;)if(M=M.scaledTo(M.overscaledZ-1),n[M.key]){x[I.key]=I;break}}}findLoadedParent(n,c){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=n.overscaledZ-1;p>=c;p--){const x=n.scaledTo(p),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(n){const c=this._tiles[n.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,c){c=c||this._source.tileSize;const p=Math.ceil(n.width/c)+1,x=Math.ceil(n.height/c)+1,b=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(I)}handleWrapJump(n){const c=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,c){const p={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(n,c,p,x,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,M=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const G=z.attenuationRange()[0],$=Math.floor(G)-Math.log2(z.getDemUpscale());M>$&&(M=$)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new s.aQ(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y));else if(this.tileCoverLift!==0){const G=n.clone();G.tileCoverLift=this.tileCoverLift,I=G.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&n.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=n.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const G=this._source.hasTile.bind(this._source);I=I.filter($=>G($))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Sr(this._source.type)){const G=n.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),$=Math.min(G,this._source.maxzoom);if(E){const J=n.extendTileCover(I,$);for(const Y of J)I.push(Y)}else if(b){const J=n.extendTileCoverToNearPlane(I,this.transform.getFrustum($),$);for(const Y of J)I.push(Y)}else if(this.castsShadows&&x){const J=n.extendTileCover(I,$,x,16);for(const Y of J)this._shadowCasterTiles[Y.key]=!0,I.push(Y)}}const O=this._updateRetainedTiles(I);if(Sr(this._source.type)&&I.length!==0){const G={},$={},J=Object.keys(O);for(const ee of J){const re=O[ee],pe=this._tiles[ee];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=s.o.now())continue;const fe=this.findLoadedParent(re,Math.max(re.overscaledZ-us.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),G[fe.tileID.key]=fe.tileID),$[ee]=re}const Y=I[I.length-1].overscaledZ;for(const ee in this._tiles){const re=this._tiles[ee];if(O[ee]||!re.hasData())continue;let pe=re.tileID;for(;pe.overscaledZ>Y;){pe=pe.scaledTo(pe.overscaledZ-1);const fe=this._tiles[pe.key];if(fe&&fe.hasData()&&$[pe.key]){O[ee]=re.tileID;break}}}for(const ee in G)O[ee]||(this._coveredTiles[ee]=!0,O[ee]=G[ee])}for(const G in O)this._tiles[G].clearFadeHold();const H=s.bv(this._tiles,O);for(const G of H){const $=this._tiles[G];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(+G)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const c={};if(n.length===0)return c;const p={},x=n.reduce((z,O)=>Math.min(z,O.overscaledZ),1/0),b=n[0].overscaledZ,E=Math.max(b-us.maxOverzooming,this._source.minzoom),I=Math.max(b+us.maxUnderzooming,this._source.minzoom),M={};for(const z of n){const O=this._addTile(z);c[z.key]=z,O.hasData()||x<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,x,I,c);for(const z of n){let O=this._tiles[z.key];if(O.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const G=z.children(this._source.maxzoom)[0],$=this.getTile(G);if($&&$.hasData()){c[G.key]=G;continue}}else{const G=z.children(this._source.maxzoom);if(c[G[0].key]&&c[G[1].key]&&c[G[2].key]&&c[G[3].key])continue}let H=O.wasRequested();for(let G=z.overscaledZ-1;G>=E;--G){const $=z.scaledTo(G);if(p[$.key]||(p[$.key]=!0,O=this.getTile($),!O&&H&&(O=this._addTile($)),O&&(c[$.key]=$,H=O.wasRequested(),O.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const c=[];let p,x=this._tiles[n].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;x=b}for(const b of c)this._loadedParentTiles[b]=p}}_addTile(n){let c=this._tiles[n.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),c;c=this._cache.getAndRemove(n),c&&(this._setTileReloadTimer(n.key,c),c.tileID=n,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();c=this._source.type==="raster-array"?new zc(n,b,this.transform.tileZoom,x,this._isRaster):new Ao(n,b,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,n.key,c.state))}return c.uses++,this._tiles[n.key]=c,p||this._source.fire(new s.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(n,c){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=c.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const c=this._tiles[n];c&&(c.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,c,p){const x=[],b=this.transform;if(!b)return x;const E=b.projection.name==="globe",I=s.aF(b.center.lng);for(const M in this._tiles){const z=this._tiles[M];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let O;if(E){const H=z.tileID.canonical;if(H.z===0){const G=[Math.abs(s.aA(I,..._a(H,-1))-I),Math.abs(s.aA(I,..._a(H,1))-I)];O=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(s.aA(I,..._a(H,-1))-I),Math.abs(s.aA(I,..._a(H,0))-I),Math.abs(s.aA(I,..._a(H,1))-I)];O=[G.indexOf(Math.min(...G))-1]}}else O=[0];for(const H of O){const G=n.containsTile(z,b,c,H);G&&x.push(G)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,c){const p=this.getRenderableIds(n,c).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(n){const c=n.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const E of c){const I=1/(1<<E.canonical.z);b[E.key]=((E.canonical.x+.5)*I+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*I-p[1])*x[1]-p[2]*x[2]}return c.sort((E,I)=>b[E.key]-b[I.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Sr(this._source.type))for(const n in this._tiles){const c=this._tiles[n];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,c,p){this._state.updateState(n=n||"_geojsonTileLayer",c,p)}removeFeatureState(n,c,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",c,p)}getFeatureState(n,c){return this._state.getState(n=n||"_geojsonTileLayer",c)}setDependencies(n,c,p){const x=this._tiles[n];x&&x.setDependencies(c,p)}reloadTilesForDependencies(n,c){for(const p in this._tiles)this._tiles[p].hasDependency(n,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,c))}_preloadTiles(n,c){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(n,c))};return void this._source.on("data",M)}const p=new Map,x=Array.isArray(n)?n:[n],b=this.map.painter.terrain,E=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const M of x){const z=M.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of z)p.set(O.key,O);this.usedForTerrain&&M.updateElevation(!1)}const I=Array.from(p.values());s.bw(I,(M,z)=>{const O=new Ao(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(O,H=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),z(H,O)})},c)}}function Ml(f,n){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-c||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function Sr(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function _a(f,n){const c=1<<f.z;return[f.x/c+n,(f.x+1)/c+n]}us.maxOverzooming=10,us.maxUnderzooming=3;class Nc{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:n,visibilityChanged:c});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:n,visibilityChanged:c})}}}onNewFrame(n){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(n,c){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,E=this.style.getLayerSourceCache(b);let I=1;b.type==="fill-extrusion"?I=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(I=x.visible?b.paint.get("building-vertical-scale"):0);let M=E?E.getTile(c):null;if(!M&&E)for(const z in E._tiles){const O=E._tiles[z];if(c.canonical.isChildOf(O.tileID.canonical)){M=O;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(b):null,tileID:M?M.tileID:c,verticalScale:I})}n.hasAnyZOffset=!1;let p=!1;for(let x=0;x<n.symbolInstances.length;x++){const b=n.symbolInstances.get(x),E=b.zOffset,I=this._getHeightAtTileOffset(c,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==Number.NEGATIVE_INFINITY?I:E,p||E===b.zOffset||(p=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,c,p,x){let b=c,E=p;if(n.canonical.z!==x.canonical.z){const I=x.canonical,M=1/(1<<n.canonical.z-I.z);b=(c+n.canonical.x*s.al)*M-I.x*s.al|0,E=(p+n.canonical.y*s.al)*M-I.y*s.al|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(n,c,p){let x,b;for(let E=0;E<this.layers.length;++E){const I=this.layers[E].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:M,tileID:z,verticalScale:O}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:H,tileY:G}=this._mapCoordToOverlappingTile(n,c,p,z),$=M.getHeightAtTileCoord(H,G);$&&$.height!==void 0&&($.hidden?x=$.height:b=Math.max($.height*O,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){const I=this.layers[E];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:M,tileID:z}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:O,tileY:H}=this._mapCoordToOverlappingTile(n,c,p,z),G=M.getHeightAtTileCoord(O,H);if(G&&!G.hidden)return G.height===void 0&&x!==void 0?Math.min(G.maxHeight,x)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ih(f,n){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return s.bx.forEach(p=>{p in n&&(c[p]=n[p])}),c}function rh(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=ih(f[c],n[f[c].ref]));return f}const di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Io(f,n,c){c.push({command:di.addSource,args:[f,n[f]]})}function Co(f,n,c){n.push({command:di.removeSource,args:[f]}),c[f]=!0}function ya(f,n,c,p){Co(f,c,p),Io(f,n,c)}function sc(f,n,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],n[c][p]))return!1;for(p in n[c])if(n[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],n[c][p]))return!1;return!0}function Ro(f,n,c,p,x,b){let E;for(E in n=n||{},f=f||{})f.hasOwnProperty(E)&&(s.by(f[E],n[E])||c.push({command:b,args:[p,E,n[E],x]}));for(E in n)n.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(s.by(f[E],n[E])||c.push({command:b,args:[p,E,n[E],x]}))}function io(f){return f.id}function Bc(f,n){return f[n.id]=n,f}function Dl(f,n,c){const p=n.createTileMatrix(f,f.worldSize,c.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,p)}function nd(f,n,c){if(n.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(n.projection),Dl(p,n.getProjection(),f)}function ro(f,n,c){return n.name===c.projection.name?f.projMatrix:Dl(c,n,f)}class Mo{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let c=1,p=this._distances[c];const x=n*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const b=c-1,E=this._distances[b],I=p-E,M=I>0?(x-E)/I:0;return this.points[b].mult(1-M).add(this.points[c].mult(M))}}class Fc{constructor(n,c,p){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(c/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,p,x,b){this._forEachCell(c,p,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(n,c,p,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(n,c,p,x,b,E){this.circleCells[b].push(E)}_query(n,c,p,x,b,E){if(p<0||n>this.width||x<0||c>this.height)return!b&&[];const I=[];if(n<=0&&c<=0&&this.width<=p&&this.height<=x){if(b)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],O=this.circles[3*M+1],H=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:z-H,y1:O-H,x2:z+H,y2:O+H})}return E?I.filter(E):I}return this._forEachCell(n,c,p,x,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?I.length>0:I}_queryCircle(n,c,p,x,b){const E=n-p,I=n+p,M=c-p,z=c+p;if(I<0||E>this.width||z<0||M>this.height)return!x&&[];const O=[];return this._forEachCell(E,M,I,z,this._queryCellCircle,O,{hitTest:x,circle:{x:n,y:c,radius:p},seenUids:{box:{},circle:{}}},b),x?O.length>0:O}query(n,c,p,x,b){return this._query(n,c,p,x,!1,b)}hitTest(n,c,p,x,b){return this._query(n,c,p,x,!0,b)}hitTestCircle(n,c,p,x){return this._queryCircle(n,c,p,!0,x)}_queryCell(n,c,p,x,b,E,I,M){const z=I.seenUids,O=this.boxCells[b];if(O!==null){const G=this.bboxes;for(const $ of O)if(!z.box[$]){z.box[$]=!0;const J=4*$;if(n<=G[J+2]&&c<=G[J+3]&&p>=G[J+0]&&x>=G[J+1]&&(!M||M(this.boxKeys[$]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[$],x1:G[J],y1:G[J+1],x2:G[J+2],y2:G[J+3]})}}}const H=this.circleCells[b];if(H!==null){const G=this.circles;for(const $ of H)if(!z.circle[$]){z.circle[$]=!0;const J=3*$;if(this._circleAndRectCollide(G[J],G[J+1],G[J+2],n,c,p,x)&&(!M||M(this.circleKeys[$]))){if(I.hitTest)return E.push(!0),!0;{const Y=G[J],ee=G[J+1],re=G[J+2];E.push({key:this.circleKeys[$],x1:Y-re,y1:ee-re,x2:Y+re,y2:ee+re})}}}}}_queryCellCircle(n,c,p,x,b,E,I,M){const z=I.circle,O=I.seenUids,H=this.boxCells[b];if(H!==null){const $=this.bboxes;for(const J of H)if(!O.box[J]){O.box[J]=!0;const Y=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,$[Y+0],$[Y+1],$[Y+2],$[Y+3])&&(!M||M(this.boxKeys[J])))return E.push(!0),!0}}const G=this.circleCells[b];if(G!==null){const $=this.circles;for(const J of G)if(!O.circle[J]){O.circle[J]=!0;const Y=3*J;if(this._circlesCollide($[Y],$[Y+1],$[Y+2],z.x,z.y,z.radius)&&(!M||M(this.circleKeys[J])))return E.push(!0),!0}}}_forEachCell(n,c,p,x,b,E,I,M){const z=this._convertToXCellCoord(n),O=this._convertToYCellCoord(c),H=this._convertToXCellCoord(p),G=this._convertToYCellCoord(x);for(let $=z;$<=H;$++)for(let J=O;J<=G;J++)if(b.call(this,n,c,p,x,this.xCellCount*J+$,E,I,M))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,p,x,b,E){const I=x-n,M=b-c,z=p+E;return z*z>I*I+M*M}_circleAndRectCollide(n,c,p,x,b,E,I){const M=(E-x)/2,z=Math.abs(n-(x+M));if(z>M+p)return!1;const O=(I-b)/2,H=Math.abs(c-(b+O));if(H>O+p)return!1;if(z<=M||H<=O)return!0;const G=z-M,$=H-O;return G*G+$*$<=p*p}}const xu=Math.tan(85*Math.PI/180);function ac(f,n,c,p,x,b,E){const I=s.bC();if(c)if(b.name==="globe"){const M=s.bD(x,n);s.aB(I,I,M)}else{const M=s.bE([],E);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],p||s.bB(I,I,x.angle)}else s.aB(I,x.labelPlaneMatrix,f);return I}function pl(f,n,c,p,x,b,E){const I=ac(f,n,c,p,x,b,E);return b.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function Vs(f,n,c,p,x,b,E){if(c){if(b.name==="globe"){const I=ac(f,n,c,p,x,b,E);return s.bl(I,I),s.aB(I,f,I),I}{const I=s.bz(f),M=s.bA([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],s.aB(I,I,M),p||s.bB(I,I,-x.angle),I}}return x.glCoordMatrix}function qa(f,n,c,p){const x=[f,n,c,1];c?s.aC(x,x,p):xa(x,x,p);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function sh(f,n){return Math.min(.5+f/n*.5,1.5)}function ah(f,n){const c=f[0]/f[3],p=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&p>=-n[1]&&p<=n[1]}function Si(f,n,c,p,x,b,E,I,M,z,O=1){const H=c.transform,G=p?f.textSizeData:f.iconSizeData,$=s.bK(G,c.transform.zoom,O),J=H.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],ee=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ee.clear();let re=null;J&&(re=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const pe=f.lineVertexArray,fe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ue=c.transform.width/c.transform.height;let Ie,Te=!1;for(let Ae=0;Ae<fe.length;Ae++){const ve=fe.get(Ae),{numGlyphs:ge,writingMode:Pe}=ve;if(Pe!==s.bL.vertical||Te||Ie===s.bL.horizontal||(Te=!0),Ie=Pe,(ve.hidden||Pe===s.bL.vertical)&&!Te){As(ge,ee);continue}Te=!1;const Le=new s.P(ve.tileAnchorX,ve.tileAnchorY),Fe=f.elevationType==="road",We=!!H.elevation||Fe;let{x:$e,y:lt,z:xt}=H.projection.projectTilePoint(Le.x,Le.y,z.canonical),Qe=null;if(We){const on=Fe?f.getElevationFeatureForText(Ae):null;Qe={getElevation:M,elevation:H.elevation,elevationFeature:on};const[xn,Mn,Vn]=M(Le,H.elevation,on);$e+=xn,lt+=Mn,xt+=Vn}const ke=[$e,lt,xt,1];if(s.aC(ke,ke,n),!ah(ke,Y)){As(ge,ee);continue}const mt=ke[3],nt=sh(c.transform.getCameraToCenterDistance(H.projection),mt),yt=s.bM(G,$,ve),Pt=E?yt/nt:yt*nt,qt=qa($e,lt,xt,x);if(qt[3]<=0){As(ge,ee);continue}let zt={};const kt=s.an(f.layers[0].layout.get("text-max-angle")),cn=Math.cos(kt),an=E?null:Qe,$t=mf(ve,Pt,!1,I,n,x,b,f.glyphOffsetArray,pe,ee,re,qt,Le,zt,ue,an,H.projection,z,E,cn);Te=$t.useVertical,an&&$t.needsFlipping&&(zt={}),($t.notEnoughRoom||Te||$t.needsFlipping&&mf(ve,Pt,!0,I,n,x,b,f.glyphOffsetArray,pe,ee,re,qt,Le,zt,ue,an,H.projection,z,E,cn).notEnoughRoom)&&As(ge,ee)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ee),re&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(re)):(f.icon.dynamicLayoutVertexBuffer.updateData(ee),re&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(re))}function id(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee){const{lineStartIndex:re,glyphStartIndex:pe,segment:fe}=I,ue=pe+I.numGlyphs,Ie=re+I.lineLength,Te=n.getoffsetX(pe),Ae=n.getoffsetX(ue-1),ve=oc(f*Te,c,p,x,b,E,fe,re,Ie,M,z,O,H,G,!0,$,J,Y,ee);if(!ve)return null;const ge=oc(f*Ae,c,p,x,b,E,fe,re,Ie,M,z,O,H,G,!0,$,J,Y,ee);return ge?{first:ve,last:ge}:null}function Pl(f,n,c,p){return f===s.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===s.bL.vertical?p>0?{needsFlipping:!0}:null:n!==0&&(function(x,b){return x===0||Math.abs(b/x)>xu})(c,p)?n===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function mf(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe,fe){const ue=n/24,Ie=f.lineOffsetX*ue,Te=f.lineOffsetY*ue,{lineStartIndex:Ae,glyphStartIndex:ve,numGlyphs:ge,segment:Pe,writingMode:Le,flipState:Fe}=f,We=Ae+f.lineLength,$e=lt=>{if(O){const[mt,nt,yt]=lt.up,Pt=z.length;s.bN(O,Pt+0,mt,nt,yt),s.bN(O,Pt+1,mt,nt,yt),s.bN(O,Pt+2,mt,nt,yt),s.bN(O,Pt+3,mt,nt,yt)}const[xt,Qe,ke]=lt.point;s.bO(z,xt,Qe,ke,lt.angle)};if(ge>1){const lt=id(ue,I,Ie,Te,c,H,G,f,M,b,$,Y,!1,ee,re,pe,fe);if(!lt)return{notEnoughRoom:!0};if(p&&!c){let[xt,Qe,ke]=lt.first.point,[mt,nt,yt]=lt.last.point;[xt,Qe]=qa(xt,Qe,ke,E),[mt,nt]=qa(mt,nt,yt,E);const Pt=Pl(Le,Fe,(mt-xt)*J,nt-Qe);if(f.flipState=Pt&&Pt.needsFlipping?1:2,Pt)return Pt}$e(lt.first);for(let xt=ve+1;xt<ve+ge-1;xt++){const Qe=oc(ue*I.getoffsetX(xt),Ie,Te,c,H,G,Pe,Ae,We,M,b,$,Y,!1,!1,ee,re,pe,fe);if(!Qe)return z.length-=4*(xt-ve),{notEnoughRoom:!0};$e(Qe)}$e(lt.last)}else{if(p&&!c){const xt=qa(G.x,G.y,0,x),Qe=Ae+Pe+1,ke=new s.P(M.getx(Qe),M.gety(Qe)),mt=qa(ke.x,ke.y,0,x),nt=mt[3]>0?mt:rd(G,ke,xt,1,x,void 0,ee,re.canonical),yt=Pl(Le,Fe,(nt[0]-xt[0])*J,nt[1]-xt[1]);if(f.flipState=yt&&yt.needsFlipping?1:2,yt)return yt}const lt=oc(ue*I.getoffsetX(ve),Ie,Te,c,H,G,Pe,Ae,We,M,b,$,Y,!1,!1,ee,re,pe,fe);if(!lt)return{notEnoughRoom:!0};$e(lt)}return{}}function Cn(f,n,c,p,x){const{x:b,y:E,z:I}=p.projectTilePoint(f.x,f.y,n);if(!x)return qa(b,E,I,c);const[M,z,O]=x.getElevation(f,x.elevation,x.elevationFeature);return qa(b+M,E+z,I+O,c)}function rd(f,n,c,p,x,b,E,I){const M=Cn(f.sub(n)._unit()._add(f),I,x,E,b);return s.av(M,c,M),s.aw(M,M),s.bH(M,c,M,p)}function oc(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe){const fe=p?f-n:f+n;let ue=fe>0?1:-1,Ie=0;p&&(ue*=-1,Ie=Math.PI),ue<0&&(Ie+=Math.PI);let Te=I+E+(ue>0?0:1)|0,Ae=x,ve=x,ge=0,Pe=0;const Le=Math.abs(fe),Fe=[],We=[];let $e=b,lt=$e,xt=s.bF([]);const Qe=()=>rd(lt,$e,ve,Le-ge+1,O,G,Y,ee.canonical);for(;ge+Pe<=Le;){if(Te+=ue,Te<I||Te>=M)return null;if(ve=Ae,lt=$e,Fe.push(ve),$&&We.push(lt),$e=new s.P(z.getx(Te),z.gety(Te)),Ae=H[Te],!Ae){const an=Cn($e,ee.canonical,O,Y,G);Ae=an[3]>0?H[Te]=an:Qe()}ge+=Pe;const kt=s.av([],Ae,ve),cn=s.bG(ve,Ae);if(c&&cn>0&&Pe>0&&s.bJ(xt,kt)/(Pe*cn)<pe)return null;Pe=cn,xt=kt}J&&G&&(H[Te]&&(Ae=Qe(),Pe=s.bG(ve,Ae),xt=s.av([],Ae,ve)),H[Te]=Ae);const ke=(Le-ge)/Pe,mt=$e.sub(lt)._mult(ke)._add(lt),nt=s.bH([],ve,xt,ke);let yt=[0,0,1],Pt=xt[0],qt=xt[1];if(re&&(yt=Y.upVector(ee.canonical,mt.x,mt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const kt=[yt[2],0,-yt[0]],cn=s.bI([],yt,kt);s.aw(kt,kt),s.aw(cn,cn),Pt=s.bJ(xt,kt),qt=s.bJ(xt,cn)}if(c){const kt=s.bI([],yt,xt);s.aw(kt,kt),s.bH(nt,nt,kt,c*ue)}const zt=Ie+Math.atan2(qt,Pt);return Fe.push(nt),$&&We.push(mt),{point:nt,angle:zt,path:Fe,tilePath:We,up:yt}}function As(f,n){const c=n.length,p=c+4*f;n.resize(p),n.float32.fill(-1/0,4*c,4*p)}function xa(f,n,c){const p=n[0],x=n[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const va=100;class gn{constructor(n,c,p=new Fc(n.width+200,n.height+200,25),x=new Fc(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+va,this.screenBottomBoundary=n.height+va,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,p,x,b,E,I,M,z,O,H){let G=p.projectedAnchorX,$=p.projectedAnchorY,J=p.projectedAnchorZ;const Y=p.tileAnchorX,ee=p.tileAnchorY,re=p.elevation,pe=p.tileID,fe=n.getProjection();if(re&&pe){const[We,$e,lt]=fe.upVector(pe.canonical,p.tileAnchorX,p.tileAnchorY),xt=fe.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=We*re*xt,$+=$e*re*xt,J+=lt*re*xt}const ue=n.projection.name==="globe",Ie=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(pe&&ue&&Ie<1&&!E){const We=1<<pe.canonical.z,$e=s.bP(Y,ee);s.bQ($e,$e,1/s.al),s.bR($e,$e,s.bP(pe.canonical.x,pe.canonical.y)),s.bQ($e,$e,1/We),s.bS($e,$e,s.bP(x[0],x[1])),$e[0]=s.bT($e[0],-.5,.5),s.bQ($e,$e,s.al);const lt=s.bU($e[0],$e[1],s.al/(2*Math.PI),1);s.aC(lt,lt,b),G=s.ak(G,lt[0],Ie),$=s.ak($,lt[1],Ie),J=s.ak(J,lt[2],Ie)}const Te=this.projectAndGetPerspectiveRatio(O,G,$,J,p.tileID,fe.name==="globe"||!!re||this.transform.pitch>0,fe),Ae=z*Te.perspectiveRatio,ve=(p.x1*c+I.x-p.padding)*Ae+Te.point.x,ge=(p.y1*c+I.y-p.padding)*Ae+Te.point.y,Pe=(p.x2*c+I.x+p.padding)*Ae+Te.point.x,Le=(p.y2*c+I.y+p.padding)*Ae+Te.point.y,Fe=Te.perspectiveRatio<=.55||Te.occluded;return!this.isInsideGrid(ve,ge,Pe,Le)||!M&&this.grid.hitTest(ve,ge,Pe,Le,H)||Fe?{box:[],offscreen:!1,occluded:Te.occluded}:{box:[ve,ge,Pe,Le],offscreen:this.isOffscreen(ve,ge,Pe,Le),occluded:!1}}placeCollisionCircles(n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee){const re=[],pe=this.transform.elevation,fe=n.getProjection(),ue=n.elevationType==="road",Ie=!!pe||ue,Te=s.bV.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,fe),Ae=new s.P(p.tileAnchorX,p.tileAnchorY),ve=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:ge,y:Pe,z:Le}=fe.projectTilePoint(ve.x,ve.y,ee.canonical),Fe=null;if(Ie){const cn=ue?n.getElevationFeatureForText(x):null;Fe={getElevation:Te,elevation:pe,elevationFeature:cn};const[an,$t,on]=Te(Ae,pe,cn);ge+=an,Pe+=$t,Le+=on}const We=fe.name==="globe",$e=this.projectAndGetPerspectiveRatio(M,ge,Pe,Le,ee,We||!!pe||this.transform.pitch>0,fe),{perspectiveRatio:lt}=$e,xt=(G?I/lt:I*lt)/s.bY,Qe=qa(ge,Pe,Le,z),ke=p.lineOffsetX*xt,mt=p.lineOffsetY*xt,nt=s.an(n.layers[0].layout.get("text-max-angle")),yt=Math.cos(nt),Pt=$e.signedDistanceFromCamera>0?id(xt,E,ke,mt,ue&&p.flipState===1,Qe,ve,p,b,z,{},Ie&&!G?Fe:null,G&&Ie,fe,ee,G,yt):null;let qt=!1,zt=!1,kt=!0;if(Pt&&!$e.occluded){const cn=.5*J*lt+Y,an=new s.P(-100,-100),$t=new s.P(this.screenRightBoundary,this.screenBottomBoundary),on=new Mo,{first:xn,last:Mn}=Pt,Vn=xn.path.length;let ti=[];for(let On=Vn-1;On>=1;On--)ti.push(xn.path[On]);for(let On=1;On<Mn.path.length;On++)ti.push(Mn.path[On]);const Dn=2.5*cn;O&&(ti=ti.map(([On,bi,mi],ki)=>(Ie&&!We&&(mi=Te(ki<Vn-1?xn.tilePath[Vn-1-ki]:Mn.tilePath[ki-Vn+2],pe,Fe.elevationFeature)[2]),qa(On,bi,mi,O))),ti.some(On=>On[3]<=0)&&(ti=[]));let jn=[];if(ti.length>0){let On=1/0,bi=-1/0,mi=1/0,ki=-1/0;for(const li of ti)On=Math.min(On,li[0]),mi=Math.min(mi,li[1]),bi=Math.max(bi,li[0]),ki=Math.max(ki,li[1]);bi>=an.x&&On<=$t.x&&ki>=an.y&&mi<=$t.y&&(jn=[ti.map(li=>new s.P(li[0],li[1]))],(On<an.x||bi>$t.x||mi<an.y||ki>$t.y)&&(jn=s.bW(jn,an.x,an.y,$t.x,$t.y)))}for(const On of jn){on.reset(On,.25*cn);let bi=0;bi=on.length<=.5*cn?1:Math.ceil(on.paddedLength/Dn)+1;for(let mi=0;mi<bi;mi++){const ki=mi/Math.max(bi-1,1),li=on.lerp(ki),Un=li.x+va,yi=li.y+va;re.push(Un,yi,cn,0);const gr=Un-cn,Li=yi-cn,Ai=Un+cn,Bn=yi+cn;if(kt=kt&&this.isOffscreen(gr,Li,Ai,Bn),zt=zt||this.isInsideGrid(gr,Li,Ai,Bn),!c&&this.grid.hitTestCircle(Un,yi,cn,$)&&(qt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:qt,occluded:!1}}}}return{circles:!H&&qt||!zt?[]:re,offscreen:kt,collisionDetected:qt,occluded:$e.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,b=-1/0,E=-1/0;for(const O of n){const H=new s.P(O.x+va,O.y+va);p=Math.min(p,H.x),x=Math.min(x,H.y),b=Math.max(b,H.x),E=Math.max(E,H.y),c.push(H)}const I=this.grid.query(p,x,b,E).concat(this.ignoredGrid.query(p,x,b,E)),M={},z={};for(const O of I){const H=O.key;if(M[H.bucketInstanceId]===void 0&&(M[H.bucketInstanceId]={}),M[H.bucketInstanceId][H.featureIndex])continue;const G=[new s.P(O.x1,O.y1),new s.P(O.x2,O.y1),new s.P(O.x2,O.y2),new s.P(O.x1,O.y2)];s.bX(c,G)&&(M[H.bucketInstanceId][H.featureIndex]=!0,z[H.bucketInstanceId]===void 0&&(z[H.bucketInstanceId]=[]),z[H.bucketInstanceId].push(H.featureIndex))}return z}insertCollisionBox(n,c,p,x,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,p,x,b){const E=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:x,collisionGroupID:b};for(let M=0;M<n.length;M+=4)E.insertCircle(I,n[M],n[M+1],n[M+2])}projectAndGetPerspectiveRatio(n,c,p,x,b,E,I){const M=[c,p,x,1];let z=!1;x||this.transform.pitch>0?(s.aC(M,M,n),this.fogState&&b&&I.name!=="globe"&&(z=(function(G,$,J,Y,ee,re){const pe=re.calculateFogTileMatrix(ee),fe=[$,J,Y];return s.af(fe,fe,pe),yn(G,s.ag(fe),re.pitch,re._fov)})(this.fogState,c,p,x,b.toUnwrapped(),this.transform)>.9)):xa(M,M,n);const O=M[3];return{point:new s.P((M[0]/O+1)/2*this.transform.width+va,(-M[1]/O+1)/2*this.transform.height+va),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/O*.5,1.5),signedDistanceFromCamera:O,occluded:E&&M[2]>O||z}}isOffscreen(n,c,p,x){return p<va||n>=this.screenRightBoundary||x<va||c>this.screenBottomBoundary}isInsideGrid(n,c,p,x){return p>=0&&n<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=s.bA([]);return s.br(n,n,[-100,-100,0]),n}}class pi{constructor(n,c,p,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class L{constructor(n,c,p,x,b,E=!1){this.text=new pi(n?n.text:null,c,p,b),this.icon=new pi(n?n.icon:null,c,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ie{constructor(n,c,p,x=!1){this.text=n,this.icon=c,this.skipFade=p,this.clipped=x}}class de{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Ce{constructor(n,c,p,x,b){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=b}}class Lt{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[n]}}function Gt(f,n,c,p,x){const{horizontalAlign:b,verticalAlign:E}=s.c1(f),I=-(b-.5)*n,M=-(E-.5)*c,z=s.c2(f,p);return new s.P(I+z[0]*x,M+z[1]*x)}function Sn(f,n,c,p,x){const b=new s.P(f,n);return c&&b._rotate(p?x:-x),b}class oi{constructor(n,c,p,x,b,E){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new gn(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Lt(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(n,c,p,x,b=1){const E=p.getBucket(c),I=p.latestFeatureIndex;if(!E||!I||c.fqid!==E.layerIds[0])return;const M=E.layers[0].layout,z=E.layers[0].paint,O=p.collisionBoxArray,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),G=p.tileSize/s.al,$=p.tileID.toUnwrapped();this.transform.setProjection(E.projection);const J=(Y=p.tileID,ee=E.getProjection(),re=this.transform,ee.name===this.projection?re.calculateProjMatrix(Y.toUnwrapped()):Dl(re,ee,Y));var Y,ee,re;const pe=M.get("text-pitch-alignment")==="map",fe=M.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const ue=c.dynamicFilter(),Ie=c.dynamicFilterNeedsFeature(),Te=this.transform.calculatePixelsToTileUnitsMatrix(p),Ae=pl(J,p.tileID.canonical,pe,fe,this.transform,E.getProjection(),Te);let ve=null;const ge=E.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(pe){const ke=Vs(J,p.tileID.canonical,pe,fe,this.transform,E.getProjection(),Te);ve=s.aB([],this.transform.labelPlaneMatrix,ke)}let Pe=null;ue&&p.latestFeatureIndex&&(Pe={unwrappedTileID:$,dynamicFilter:ue,dynamicFilterNeedsFeature:Ie}),this.retainedQueryData[E.bucketInstanceId]=new Ce(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,p.tileID);const[Le,Fe]=E.layers[0].layout.get("text-size-scale-range"),We=s.aA(b,Le,Fe),[$e,lt]=M.get("icon-size-scale-range"),xt=s.aA(b,$e,lt),Qe={bucket:E,layout:M,paint:z,posMatrix:J,invMatrix:ge,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ae,labelToScreenMatrix:ve,clippingData:Pe,scale:H,textPixelRatio:G,holdingForFade:p.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:s.bK(E.textSizeData,this.transform.zoom,We),partiallyEvaluatedIconSize:s.bK(E.iconSizeData,this.transform.zoom,xt),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const ke of E.sortKeyRanges){const{sortKey:mt,symbolInstanceStart:nt,symbolInstanceEnd:yt}=ke;n.push({sortKey:mt,symbolInstanceStart:nt,symbolInstanceEnd:yt,parameters:Qe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Qe})}attemptAnchorPlacement(n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe,fe,ue,Ie){const{textOffset0:Te,textOffset1:Ae,crossTileID:ve}=Y,ge=[Te,Ae],Pe=Gt(n,E,I,ge,M),Le=this.collisionIndex.placeCollisionBox(re,M,c,p,x,b,Sn(Pe.x,Pe.y,z,O,this.transform.angle),J,H,G,$.predicate);if(fe){const Fe=re.getSymbolInstanceIconSize(Ie,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Fe,fe,p,x,b,Sn(Pe.x,Pe.y,z,O,this.transform.angle),J,H,G,$.predicate).box.length===0)return}if(Le.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(Fe=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:ge,width:E,height:I,anchor:n,textScale:M,prevAnchor:Fe},this.markUsedJustification(re,n,Y,pe),re.allowVerticalPlacement&&(this.markUsedOrientation(re,pe,Y),this.placedOrientations[ve]=pe),{shift:Pe,placedGlyphBoxes:Le}}}placeLayerBucketPart(n,c,p,x,b=1){const{bucket:E,layout:I,paint:M,posMatrix:z,textLabelPlaneMatrix:O,labelToScreenMatrix:H,clippingData:G,textPixelRatio:$,mercatorCenter:J,invMatrix:Y,holdingForFade:ee,collisionBoxArray:re,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:fe,collisionGroup:ue,latestFeatureIndex:Ie}=n.parameters,Te=I.get("text-optional"),Ae=I.get("icon-optional"),ve=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),Pe=I.get("text-rotation-alignment")==="map",Le=I.get("icon-rotation-alignment")==="map",Fe=I.get("text-pitch-alignment")==="map",We=M.get("symbol-z-offset"),$e=I.get("symbol-elevation-reference")==="sea",lt=I.get("symbol-placement"),[xt,Qe]=I.get("text-size-scale-range"),[ke,mt]=I.get("icon-size-scale-range"),nt=s.aA(b,xt,Qe),yt=s.aA(b,ke,mt),Pt=I.get("text-variable-anchor"),qt=Pe&&lt!=="point",zt=Le&&lt!=="point",kt=Pt&&E.hasTextData(),cn=E.hasIconTextFit()&&kt&&E.hasIconData();this.transform.setProjection(E.projection);const an=kt||qt,$t=zt||cn;let on=ve&&(ge||!E.hasIconData()||Ae),xn=ge&&(ve||!E.hasTextData()||Te);const Mn=!We.isConstant();!E.collisionArrays&&re&&E.deserializeCollisionBoxes(re),p&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,re,nt,yt);const Vn=(Dn,jn,On)=>{const{crossTileID:bi,numVerticalGlyphVertices:mi}=Dn;let ki=null;if(G&&G.dynamicFilterNeedsFeature||Mn){const Tr=this.retainedQueryData[E.bucketInstanceId];ki=Ie.loadFeature({featureIndex:Dn.featureIndex,bucketIndex:Tr.bucketIndex,sourceLayerIndex:Tr.sourceLayerIndex,layoutVertexArrayOffset:0});const Qr=ki.properties?ki.properties.worldview:null;if(E.localizable&&E.worldview&&typeof Qr=="string")if(Qr==="all")ki.properties.$localized=!0;else{if(!Qr.split(",").includes(E.worldview))return;ki.properties.$localized=!0,ki.properties.worldview=E.worldview}}if(G&&!(0,G.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},ki,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new s.P(Dn.tileAnchorX,Dn.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[bi]=new ie(!1,!1,!1,!0),void c.add(bi);const li=We.evaluate(ki,{});if(c.has(bi))return;if(ee)return void(this.placements[bi]=new ie(!1,!1,!1));let Un=!1,yi=!1,gr=!0,Li=!1,Ai=!1,Bn=null,qn={box:null,offscreen:null,occluded:null},Ji={box:null},zr=null,Fi=null,er=null,Ta=0,Js=0,Ps=0;On.textFeatureIndex?Ta=On.textFeatureIndex:Dn.useRuntimeCollisionCircles&&(Ta=Dn.featureIndex),On.verticalTextFeatureIndex&&(Js=On.verticalTextFeatureIndex);const Ii=E.elevationFeatures?E.elevationFeatures[Dn.elevationFeatureIndex]:void 0,fo=Tr=>{Tr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Qr=this.transform.elevation;Tr.elevation=$e?li:li+s.bV.getAtTileOffset(Tr.tileID,new s.P(Tr.tileAnchorX,Tr.tileAnchorY),Qr,Ii),Tr.elevation+=Dn.zOffset},ea=On.textBox;if(ea){fo(ea);const Tr=rr=>{let rs=s.bL.horizontal;if(E.allowVerticalPlacement&&!rr&&this.prevPlacement){const Cs=this.prevPlacement.placedOrientations[bi];Cs&&(this.placedOrientations[bi]=Cs,rs=Cs,this.markUsedOrientation(E,rs,Dn))}return rs},Qr=(rr,rs)=>{if(E.allowVerticalPlacement&&mi>0&&On.verticalTextBox){for(const Cs of E.writingModes)if(Cs===s.bL.vertical?(qn=rs(),Ji=qn):qn=rr(),qn&&qn.box&&qn.box.length)break}else qn=rr()};if(Pt){let rr=Pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[bi]){const Ir=this.prevPlacement.variableOffsets[bi];rr.indexOf(Ir.anchor)>0&&(rr=rr.filter(po=>po!==Ir.anchor),rr.unshift(Ir.anchor))}const rs=(Ir,po,Fd)=>{const Yl=E.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,jn),Nh=(Ir.x2-Ir.x1)*Yl+2*Ir.padding,Bh=(Ir.y2-Ir.y1)*Yl+2*Ir.padding,mo=Dn.hasIconTextFit&&!ge?po:null;mo&&fo(mo);let il={box:[],offscreen:!1,occluded:!1};const Kl=ve?2*rr.length:rr.length;for(let Uo=0;Uo<Kl;++Uo){const ar=this.attemptAnchorPlacement(rr[Uo%rr.length],Ir,J,Y,an,Nh,Bh,Yl,Pe,Fe,$,z,ue,Uo>=rr.length,Dn,jn,E,Fd,mo,pe,fe);if(ar&&(il=ar.placedGlyphBoxes,il&&il.box&&il.box.length)){Un=!0,Bn=ar.shift;break}}return il};Qr(()=>rs(ea,On.iconBox,s.bL.horizontal),()=>{const Ir=On.verticalTextBox;return Ir&&fo(Ir),E.allowVerticalPlacement&&!(qn&&qn.box&&qn.box.length)&&mi>0&&Ir?rs(Ir,On.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),qn&&(Un=qn.box,gr=qn.offscreen,Li=qn.occluded);const Cs=Tr(!(!qn||!qn.box));if(!Un&&this.prevPlacement){const Ir=this.prevPlacement.variableOffsets[bi];Ir&&(this.variableOffsets[bi]=Ir,this.markUsedJustification(E,Ir.anchor,Dn,Cs))}}else{const rr=(rs,Cs)=>{const Ir=E.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,jn),po=this.collisionIndex.placeCollisionBox(E,Ir,rs,J,Y,an,new s.P(0,0),ve,$,z,ue.predicate);return po&&po.box&&po.box.length&&(this.markUsedOrientation(E,Cs,Dn),this.placedOrientations[bi]=Cs),po};Qr(()=>rr(ea,s.bL.horizontal),()=>{const rs=On.verticalTextBox;return E.allowVerticalPlacement&&mi>0&&rs?(fo(rs),rr(rs,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Tr(!!(qn&&qn.box&&qn.box.length))}}if(zr=qn,Un=zr&&zr.box&&zr.box.length>0,gr=zr&&zr.offscreen,Li=zr&&zr.occluded,Dn.useRuntimeCollisionCircles){const Tr=Dn.centerJustifiedTextSymbolIndex>=0?Dn.centerJustifiedTextSymbolIndex:Dn.verticalPlacedTextSymbolIndex,Qr=E.text.placedSymbolArray.get(Tr),rr=s.bM(E.textSizeData,pe,Qr),rs=I.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(E,ve,Qr,Tr,E.lineVertexArray,E.glyphOffsetArray,rr,z,O,H,p,Fe,ue.predicate,Dn.collisionCircleDiameter*rr/s.bY,rs,this.retainedQueryData[E.bucketInstanceId].tileID),Un=ve||Fi.circles.length>0&&!Fi.collisionDetected,gr=gr&&Fi.offscreen,Li=Fi.occluded}if(On.iconFeatureIndex&&(Ps=On.iconFeatureIndex),On.iconBox){const Tr=Qr=>{fo(Qr);const rr=Dn.hasIconTextFit&&Bn?Sn(Bn.x,Bn.y,Pe,Fe,this.transform.angle):new s.P(0,0),rs=E.getSymbolInstanceIconSize(fe,this.transform.zoom,Dn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,rs,Qr,J,Y,$t,rr,ge,$,z,ue.predicate)};Ji&&Ji.box&&Ji.box.length&&On.verticalIconBox?(er=Tr(On.verticalIconBox),yi=er.box.length>0):(er=Tr(On.iconBox),yi=er.box.length>0),gr=gr&&er.offscreen,Ai=er.occluded}const ca=Te||Dn.numHorizontalGlyphVertices===0&&mi===0,jo=Ae||Dn.numIconVertices===0;if(ca||jo?jo?ca||(yi=yi&&Un):Un=yi&&Un:yi=Un=yi&&Un,Un&&zr&&zr.box&&this.collisionIndex.insertCollisionBox(zr.box,I.get("text-ignore-placement"),E.bucketInstanceId,Ji&&Ji.box&&Js?Js:Ta,ue.ID),yi&&er&&this.collisionIndex.insertCollisionBox(er.box,I.get("icon-ignore-placement"),E.bucketInstanceId,Ps,ue.ID),Fi&&(Un&&this.collisionIndex.insertCollisionCircles(Fi.circles,I.get("text-ignore-placement"),E.bucketInstanceId,Ta,ue.ID),p)){const Tr=E.bucketInstanceId;let Qr=this.collisionCircleArrays[Tr];Qr===void 0&&(Qr=this.collisionCircleArrays[Tr]=new de);for(let rr=0;rr<Fi.circles.length;rr+=4)Qr.circles.push(Fi.circles[rr+0]),Qr.circles.push(Fi.circles[rr+1]),Qr.circles.push(Fi.circles[rr+2]),Qr.circles.push(Fi.collisionDetected?1:0)}const Xa=E.projection.name!=="globe";on=on&&(Xa||!Li),xn=xn&&(Xa||!Ai),this.placements[bi]=new ie(Un||on,yi||xn,gr||E.justReloaded),c.add(bi)},ti=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,ti),E.elevationType==="road"&&E.updateRoadElevation(ti.canonical),E.updateZOffset(),E.sortFeaturesByY){const Dn=E.getSortedSymbolIndexes(this.transform.angle);for(let jn=Dn.length-1;jn>=0;--jn){const On=Dn[jn];Vn(E.symbolInstances.get(On),On,E.collisionArrays[On])}E.hasAnyZOffset&&s.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Dn=E.getSortedIndexesByZOffset();for(let jn=0;jn<Dn.length;++jn){const On=Dn[jn];Vn(E.symbolInstances.get(On),On,E.collisionArrays[On])}}else for(let Dn=n.symbolInstanceStart;Dn<n.symbolInstanceEnd;Dn++)Vn(E.symbolInstances.get(Dn),Dn,E.collisionArrays[Dn]);if(p&&E.bucketInstanceId in this.collisionCircleArrays){const Dn=this.collisionCircleArrays[E.bucketInstanceId];s.bl(Dn.invProjMatrix,z),Dn.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(n,c,p,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:z}=p,O=s.c3(c),H=x===s.bL.vertical?M:O==="left"?b:O==="center"?E:O==="right"?I:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:z),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:z),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:z),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=H>=0&&M!==H?0:z)}markUsedOrientation(n,c,p){const x=c===s.bL.horizontal||c===s.bL.horizontalOnly?c:0,b=c===s.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:z}=p,O=n.text.placedSymbolArray;E>=0&&(O.get(E).placedOrientation=x),I>=0&&(O.get(I).placedOrientation=x),M>=0&&(O.get(M).placedOrientation=x),z>=0&&(O.get(z).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(n):1,b=c?c.opacities:{},E=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],O=b[M];O?(this.opacities[M]=new L(O,x,z.text,z.icon,null,z.clipped),p=p||z.text!==O.text.placed||z.icon!==O.icon.placed):(this.opacities[M]=new L(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const M in b){const z=b[M];if(!this.opacities[M]){const O=new L(z,x,!1,!1);O.isHidden()||(this.opacities[M]=O,p=p||z.text.placed||z.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c,p,x){x&&(this.lastReplacementSourceUpdateTime=x.updateTime);const b=new Set;for(const E of c){const I=E.getBucket(n);I&&E.latestFeatureIndex&&n.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,b,E,E.collisionBoxArray,p,x,E.tileID,n.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,E.tileID),I.elevationType==="road"&&I.updateRoadElevation(E.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(n,c,p,x,b,E,I,M){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const z=n.layers[0].layout,O=n.layers[0].paint,H=!!n.layers[0].dynamicFilter(),G=new L(null,0,!1,!1,!0),$=z.get("text-allow-overlap"),J=z.get("icon-allow-overlap"),Y=z.get("text-variable-anchor"),ee=z.get("text-rotation-alignment")==="map",re=z.get("text-pitch-alignment")==="map",pe=O.get("symbol-z-offset"),fe=z.get("symbol-elevation-reference")==="sea",ue=!pe.isConstant(),Ie=new L(null,0,$&&(J||!n.hasIconData()||z.get("icon-optional")),J&&($||!n.hasTextData()||z.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const Te=(ve,ge,Pe)=>{for(let Le=0;Le<ge/4;Le++)ve.opacityVertexArray.emplaceBack(Pe)};let Ae=0;E&&n.updateReplacement(I,E);for(let ve=0;ve<n.symbolInstances.length;ve++){const ge=n.symbolInstances.get(ve),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:Le,crossTileID:Fe,numIconVertices:We,tileAnchorX:$e,tileAnchorY:lt}=ge;let xt=null;const Qe=this.retainedQueryData[n.bucketInstanceId];ue&&ge&&Qe&&(xt=p.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const ke=pe.evaluate(xt,{}),mt=c.has(Fe);let nt=this.opacities[Fe];mt?nt=G:nt||(nt=Ie,this.opacities[Fe]=nt),c.add(Fe);const yt=Pe>0||Le>0,Pt=We>0,qt=this.placedOrientations[Fe],zt=qt===s.bL.vertical,kt=qt===s.bL.horizontal||qt===s.bL.horizontalOnly;!yt&&!Pt||nt.isHidden()||Ae++;let cn=!1;if((yt||Pt)&&E)for(const an of n.activeReplacements){if(s.bZ(an,b,s.b_.Symbol,M)||an.min.x>$e||$e>an.max.x||an.min.y>lt||lt>an.max.y)continue;const $t=s.b$($e,lt,I.canonical,an.footprintTileId.canonical);if(cn=s.c0($t,an.footprint),cn)break}if(yt){const an=cn?Ks:Rs(nt.text);Te(n.text,Pe,zt?Ks:an),Te(n.text,Le,kt?Ks:an);const $t=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:on,centerJustifiedTextSymbolIndex:xn,rightJustifiedTextSymbolIndex:Mn,verticalPlacedTextSymbolIndex:Vn}=ge,ti=n.text.placedSymbolArray,Dn=$t||zt?1:0;on>=0&&(ti.get(on).hidden=Dn),xn>=0&&(ti.get(xn).hidden=Dn),Mn>=0&&(ti.get(Mn).hidden=Dn),Vn>=0&&(ti.get(Vn).hidden=$t||kt?1:0);const jn=this.variableOffsets[Fe];jn&&this.markUsedJustification(n,jn.anchor,ge,qt);const On=this.placedOrientations[Fe];On&&(this.markUsedJustification(n,"left",ge,On),this.markUsedOrientation(n,On,ge))}if(Pt){const an=cn?Ks:Rs(nt.icon),{placedIconSymbolIndex:$t,verticalPlacedIconSymbolIndex:on}=ge,xn=n.icon.placedSymbolArray,Mn=nt.icon.isHidden()?1:0;$t>=0&&(Te(n.icon,We,zt?Ks:an),xn.get($t).hidden=Mn),on>=0&&(Te(n.icon,ge.numVerticalIconVertices,kt?Ks:an),xn.get(on).hidden=Mn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const an=n.collisionArrays[ve];if(an){let $t=new s.P(0,0),on=!0;if(an.textBox||an.verticalTextBox){if(Y){const Mn=this.variableOffsets[Fe];Mn?($t=Gt(Mn.anchor,Mn.width,Mn.height,Mn.textOffset,Mn.textScale),ee&&$t._rotate(re?this.transform.angle:-this.transform.angle)):on=!1}H&&(on=!nt.clipped),an.textBox&&Mi(n.textCollisionBox.collisionVertexArray,nt.text.placed,!on||zt,ke,fe,$t.x,$t.y),an.verticalTextBox&&Mi(n.textCollisionBox.collisionVertexArray,nt.text.placed,!on||kt,ke,fe,$t.x,$t.y)}const xn=on&&!!(!kt&&an.verticalIconBox);an.iconBox&&Mi(n.iconCollisionBox.collisionVertexArray,nt.icon.placed,xn,ke,fe,ge.hasIconTextFit?$t.x:0,ge.hasIconTextFit?$t.y:0),an.verticalIconBox&&Mi(n.iconCollisionBox.collisionVertexArray,nt.icon.placed,!xn,ke,fe,ge.hasIconTextFit?$t.x:0,ge.hasIconTextFit?$t.y:0)}}}if(n.fullyClipped=Ae===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ve.invProjMatrix,n.placementViewportMatrix=ve.viewportMatrix,n.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>n}isStale(){return this.stale}setStale(){this.stale=!0}}function Mi(f,n,c,p,x,b,E){f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0)}const Lr=Math.pow(2,25),Kr=Math.pow(2,24),Do=Math.pow(2,17),Po=Math.pow(2,16),ko=Math.pow(2,9),Wo=Math.pow(2,8),lc=Math.pow(2,1);function Rs(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Lr+n*Kr+c*Do+n*Po+c*ko+n*Wo+c*lc+n}const Ks=0;class so{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,p,x,b,E){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(I,x,n[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,z)=>M.sortKey-z.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,p,M.symbolInstanceStart===0,E),this._currentPartIndex++,b())return!0}return!1}}class $m{startNewPlacement(n,c,p,x,b,E,I,M){return this.placement=new oi(n,x,b,E,I,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=p,this._fadeDuration=x,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(n,c,p,x,b){const E=s.o.now(),I=()=>{const M=s.o.now()-E;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&M>2};for(;this._currentPlacementIndex>=0;){const M=c[n[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&M.visibility!=="none"&&(!M.minzoom||M.minzoom<=z)&&(!M.maxzoom||M.maxzoom>z)){const O=M,H=O.layout.get("symbol-z-elevate"),G=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=O.layout.get("symbol-z-order"),J=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&G),Y=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),ee=J&&Y,re=this._inProgressLayer=this._inProgressLayer||new so(O),pe=s.B(M.source,M.scope);if(re.continuePlacement(H||ee?x[pe]:p[pe],this.placement,this._showCollisionBoxes,M,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const vu=512/s.al/2;class Is{constructor(n,c,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*s.al,b=n.canonical.y*s.al;for(let E=0;E<c.length;E++){const{key:I,crossTileID:M,tileAnchorX:z,tileAnchorY:O}=c.get(E),H=Math.floor((x+z)*vu),G=Math.floor((b+O)*vu);this.index.add(H,G),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(n,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=vu/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*s.al,I=c.canonical.y*s.al;for(let M=0;M<n.length;M++){const z=n.get(M);if(z.crossTileID)continue;const{key:O,tileAnchorX:H,tileAnchorY:G}=z,$=Math.floor((E+H)*b),J=Math.floor((I+G)*b),Y=this.index.range($-x,J-x,$+x,J+x).sort((ee,re)=>ee-re);for(const ee of Y){const re=this.crossTileIDs[ee];if(this.keys[ee]===O&&!p.has(re)){p.add(re),z.crossTileID=re;break}}}}}class kl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],b={};for(const E in x){const I=x[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),b[I.tileID.key]=I}this.indexes[p]=b}this.lng=n}addBucket(n,c,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>n.overscaledZ)for(const I in E){const M=E[I];M.tileID.isChildOf(n)&&M.findMatches(c.symbolInstances,n,x)}else{const I=E[n.scaledTo(Number(b)).key];I&&I.findMatches(c.symbolInstances,n,x)}}for(let b=0;b<c.symbolInstances.length;b++){const E=c.symbolInstances.get(b);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Is(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[b]),delete x[b],c=!0)}return c}}class ts{constructor(){this.layerIndexes={},this.crossTileIDs=new kl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,p,x){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new Xo);let E=!1;const I={};x.name!=="globe"&&b.handleWrapJump(p);for(const M of c){const z=M.getBucket(n);z&&n.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(M.tileID,z,this.crossTileIDs)&&(E=!0),I[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(n){const c={};n.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const bu=771;class zn{constructor(n,c,p,x){this.blendFunction=n,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}zn.Replace=[1,0,1,0],zn.disabled=new zn(zn.Replace,s.ao.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,s.ao.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,bu,1,bu],s.ao.transparent,[!0,!0,!0,!0]),zn.alphaBlendedNonPremultiplied=new zn([770,bu,770,bu],s.ao.transparent,[!0,!0,!0,!0]),zn.multiply=new zn([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),zn.additive=new zn([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class mn{constructor(n,c,p){this.func=n,this.mask=c,this.range=p}}mn.ReadOnly=!1,mn.ReadWrite=!0,mn.disabled=new mn(519,mn.ReadOnly,[0,1]);const oh=7680;class Ln{constructor(n,c,p,x,b,E){this.test=n,this.ref=c,this.mask=p,this.fail=x,this.depthFail=b,this.pass=E}}Ln.disabled=new Ln({func:519,mask:0},0,0,oh,oh,oh);const sd=1029,ad=2305;class Rn{constructor(n,c,p){this.enable=n,this.mode=c,this.frontFace=p}}function Sp(f,n){const c=s.ca(f,3);s.cc(f,n),s.cg(f,3,c)}function Zm(f,n){const c=s.c7([]);return s.c8(c,c,-n),s.c9(c,c,-f),c}function cc(f,n){const c=[f[0],f[1],0],p=[n[0],n[1],0];if(s.ag(c)>=1e-15){const E=s.aw([],c);s.c5(p,E,s.bJ(p,E)),n[0]=p[0],n[1]=p[1]}const x=s.bI([],n,f);if(s.c6(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Zm(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Rn.disabled=new Rn(!1,sd,ad),Rn.backCCW=new Rn(!0,sd,ad),Rn.backCW=new Rn(!0,sd,2304),Rn.frontCW=new Rn(!0,1028,2304),Rn.frontCCW=new Rn(!0,1028,ad);class __{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=s.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c,p){if(this.orientation=null,!this.position)return;const x=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0),E=s.ae.fromLngLat(n,b),I=[E.x-x.x,E.y-x.y,E.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=cc(I,c)}setPitchBearing(n,c){this.orientation=Zm(s.an(n),s.an(-c))}}class od{constructor(n,c){this._transform=s.bA([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.ca(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&s.cg(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c7([]),n&&Sp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Zm(n,c),Sp(this._transform,this._orientation)}forward(){const n=s.ca(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.ca(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.ca(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const p=new Float64Array(16);return s.bl(p,this.getWorldToCamera(n,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,c,p){const x=this.position;s.c5(x,x,-n);const b=new Float64Array(16);return s.bq(b,[p,p,p]),s.br(b,b,x),b[10]*=c,b}getWorldToCamera(n,c){const p=new Float64Array(16),x=new Float64Array(4),b=this.position;return s.cb(x,this._orientation),s.c5(b,b,-n),s.cc(p,x),s.br(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(n,c,p,x){const b=new Float64Array(16);return s.cd(b,n,c,p,x),b}getCameraToClipOrthographic(n,c,p,x,b,E){const I=new Float64Array(16);return s.ce(I,n,c,p,x,b,E),I}getDistanceToElevation(n,c=!1){const p=n===0?0:s.cf(n,c?s.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new od([...this.position],[...this.orientation])}}const ao=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n});class oo{constructor(n=0,c=0,p=0,x=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=p,this.right=x}interpolate(n,c,p){return c.top!=null&&n.top!=null&&(this.top=s.ak(n.top,c.top,p)),c.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,c.bottom,p)),c.left!=null&&n.left!=null&&(this.left=s.ak(n.left,c.left,p)),c.right!=null&&n.right!=null&&(this.right=s.ak(n.right,c.right,p)),this}getCenter(n,c){const p=s.aA((this.left+n-this.right)/2,0,n),x=s.aA((this.top+c-this.bottom)/2,0,c);return new s.P(p,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Lo=15;class gf{constructor(n,c,p,x,b,E,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new oo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new od,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new gf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Lo}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const p=this.getProjection(),x=!s.by(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<c.length;E++){const I=new s.P(c[E][0]*this.width,p+c[E][1]*(this.height-p)),M=n.pointCoordinate(I);if(!M)continue;const z=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);x+=M[3]*z,b+=z}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}equals(n){const c=this.elevation,p=n.elevation,x=c!=null!=(p!=null)||c&&p&&c.exaggeration()!==p.exaggeration();return this.width===n.width&&this.height===n.height&&this.center.lng===n.center.lng&&this.center.lat===n.center.lat&&this.zoom===n.zoom&&this.bearing===n.bearing&&this.pitch===n.pitch&&this.fov===n.fov&&this.projection.name===n.projection.name&&this._edgeInsets.equals(n.padding)&&!x}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const x=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!s.cp(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.cq(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new __;return c.position=new s.ae(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!s.cr(n))return!1;s.cs(n,n);const c=s.ct([],[0,0,-1],n),p=s.ct([],[0,-1,0],n);if(p[2]<0)return!1;const x=cc(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=s.aA(n[2],x/p,x/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,p){this._unmodified=!1,this._edgeInsets.interpolate(n,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new s.cu(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),E=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(p.x,x.x,b.x,E.x)),M=Math.floor(Math.max(p.x,x.x,b.x,E.x)),z=1;for(let O=I-z;O<=M+z;O++)O!==0&&c.push(new s.cu(O,n))}return c}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,c,p,x){let b=[];const E=p!=null,I=!E;if(I&&this.zoom<c||E&&p[0]===0&&p[1]===0)return b;const M=new Set,z=(H,G,$,J,Y)=>{const ee=s.cY(G,H,$,J,Y);M.has(ee)||(b.push(new s.aQ(H,G,$,J,Y)),M.add(ee))};for(let H=0;H<n.length;H++){const G=n[H];if(I&&G.canonical.z!==c||E&&x!==void 0&&x>G.canonical.z)continue;const $=G.canonical,J=G.overscaledZ,Y=G.wrap,ee=1<<$.z,re=$.x+1<ee,pe=$.x>0,fe=$.y+1<ee,ue=$.y>0,Ie=G.wrap-(pe?0:1),Te=G.wrap+(re?0:1),Ae=pe?$.x-1:ee-1,ve=re?$.x+1:0;if(E)p[0]<0?(z(J,Te,$.z,ve,$.y),p[1]<0&&fe&&(z(J,Y,$.z,$.x,$.y+1),z(J,Te,$.z,ve,$.y+1)),p[1]>0&&ue&&(z(J,Y,$.z,$.x,$.y-1),z(J,Te,$.z,ve,$.y-1))):p[0]>0?(z(J,Ie,$.z,Ae,$.y),p[1]<0&&fe&&(z(J,Y,$.z,$.x,$.y+1),z(J,Ie,$.z,Ae,$.y+1)),p[1]>0&&ue&&(z(J,Y,$.z,$.x,$.y-1),z(J,Ie,$.z,Ae,$.y-1))):p[1]<0&&fe?z(J,Y,$.z,$.x,$.y+1):ue&&z(J,Y,$.z,$.x,$.y-1);else{const ge=G.visibleQuadrants;1&ge&&(z(J,Ie,$.z,Ae,$.y),ue&&(z(J,Y,$.z,$.x,$.y-1),z(J,Ie,$.z,Ae,$.y-1))),2&ge&&(z(J,Te,$.z,ve,$.y),ue&&(z(J,Y,$.z,$.x,$.y-1),z(J,Te,$.z,ve,$.y-1))),4&ge&&(z(J,Ie,$.z,Ae,$.y),fe&&(z(J,Y,$.z,$.x,$.y+1),z(J,Ie,$.z,Ae,$.y+1))),8&ge&&(z(J,Te,$.z,ve,$.y),fe&&(z(J,Y,$.z,$.x,$.y+1),z(J,Te,$.z,ve,$.y+1)))}}const O=[];for(const H of b)b.some(G=>H.isChildOf(G))||O.push(H);if(b=O.filter(H=>!n.some(G=>!!(H.overscaledZ<c&&G.isChildOf(H))||H.equals(G)||H.isChildOf(G))),I){const H=1<<c,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[H*G.x,H*G.y],J=4,Y=J*J;b=b.filter(ee=>{const re=ee.canonical.x+.5-$[0],pe=ee.canonical.y+.5-$[1];return re*re+pe*pe<Y})}return b}extendTileCoverToNearPlane(n,c,p){const x=[],b=new Set;for(const pe of n)b.add(pe.key);const E=(pe,fe,ue,Ie,Te)=>{const Ae=s.cY(fe,pe,ue,Ie,Te);b.has(Ae)||(x.push(new s.aQ(pe,fe,ue,Ie,Te)),b.add(Ae))},I=n.reduce((pe,fe)=>Math.max(pe,fe.overscaledZ),p),M=1<<p,z=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],O=new s.P(0,0),H=new s.P(0,0),G=(pe,fe)=>{const ue=Math.floor(pe[0]),Ie=Math.floor(pe[1]),Te=(pe[0]-ue)*s.al,Ae=(pe[1]-Ie)*s.al,ve=Math.floor(fe[0]),ge=Math.floor(fe[1]),Pe=(fe[0]-ve)*s.al,Le=(fe[1]-ge)*s.al;for(let Fe=-1;Fe<=1;Fe++){const We=ue+Fe;if(!(We<0||We>=M)){O.x=Te-Fe*s.al,H.x=Pe-(We-ve)*s.al;for(let $e=-1;$e<=1;$e++){const lt=Ie+$e;O.y=Ae-$e*s.al,H.y=Le-(lt-ge)*s.al,s.cZ(O,H,z)&&E(I,0,p,We,lt)}}}},$=c.points,J=$[s.cv],Y=$[s.cw],ee=this._projectToGround(J,$[s.cx]),re=this._projectToGround(Y,$[s.cy]);return G(J,ee),G(Y,re),x}_projectToGround(n,c){return s.cz(s.cA(),n,c,n[2]/(n[2]-c[2]))}coveringTiles(n){let c=this.coveringZoomLevel(n);const p=c,x=this.elevation&&this.elevation.exaggeration(),b=x&&!n.isTerrainDEM,E=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,z=1<<c,O=[z*I.x,z*I.y,0],H=this.projection.name==="globe",G=!H,$=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,G),J=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=z*s.cf(1,this.center.lat),ee=this._camera.position[2]/s.cf(1,this.center.lat),re=[z*J.x,z*J.y,ee*(G?1:Y)],pe=H||x,fe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ue=this.isLODDisabled(!0)?c:0;let Ie;if(this._elevation&&n.isTerrainDEM)Ie=1e4*this._elevation.exaggeration();else if(this._elevation){const ke=this._elevation.getMinMaxForVisibleTiles();Ie=ke?ke.max:this._centerAltitude}else Ie=this._centerAltitude;const Te=n.isTerrainDEM?-Ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?s.cC(this):1,ve=ke=>{const nt=new s.ae(ke.x+25e-6,ke.y,ke.z),yt=new s.ae(ke.x,ke.y+25e-6,ke.z),Pt=ke.toLngLat(),qt=nt.toLngLat(),zt=yt.toLngLat(),kt=this.locationCoordinate(Pt),cn=this.locationCoordinate(qt),an=this.locationCoordinate(zt),$t=Math.hypot(cn.x-kt.x,cn.y-kt.y),on=Math.hypot(an.x-kt.x,an.y-kt.y);return Math.sqrt($t*on)*Ae/25e-6},ge=ke=>{const mt=Ie,nt=Te;return{aabb:s.cF(this,z,0,0,0,ke,nt,mt,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:mt,wrap:ke,fullyVisible:!1}},Pe=[];let Le=[];const Fe=c,We=n.reparseOverscaled?p:c,$e=(ee-this._centerAltitude)*Y,lt=ke=>{if(!this._elevation||!ke.tileID||!E)return;const mt=this._elevation.getMinMaxForTile(ke.tileID),nt=ke.aabb;mt?(nt.min[2]=mt.min,nt.max[2]=mt.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(ke.shouldSplit=Qe(ke),ke.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},xt=(ke,mt)=>{if(.707*mt<ke)return 1;const nt=mt/ke;return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)},Qe=ke=>{if(ke.zoom<ue)return!0;if(ke.zoom===Fe)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const mt=ke.aabb.distanceX(re),nt=ke.aabb.distanceY(re);let yt=$e,Pt=1;if(H){yt=ke.aabb.distanceZ(re);const on=Math.pow(2,ke.zoom),xn=s.a$((ke.y+1)/on),Mn=s.a$(ke.y/on),Vn=Math.min(Math.max(M,xn),Mn),ti=s.d1(Vn)/s.d1(M);if(Pt=Vn===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ti/this._mercatorScaleRatio),this.zoom<=s.c_&&ke.zoom===Fe-1&&ti>=.9)return!0}else if(b&&(yt=ke.aabb.distanceZ(re)*Y),this.projection.isReprojectedInTileSpace&&p<=5){const on=Math.pow(2,ke.zoom),xn=ve(new s.ae((ke.x+.5)/on,(ke.y+.5)/on));Pt=xn>.85?1:xn}if(!E&&!H){const on=Math.sqrt(mt*mt+nt*nt+yt*yt);let xn=(1<<Fe-ke.zoom)*fe*Pt;return xn*=xt(Math.max(yt,$e),on),on<xn}let qt=Number.MAX_VALUE,zt=0;const kt=ke.aabb.getCorners(),cn=[];for(const on of kt){s.av(cn,on,re),H||(b?cn[2]*=Y:cn[2]=$e);const xn=s.bJ(cn,this._camera.forward());xn<qt&&(qt=xn,zt=Math.abs(cn[2]))}let an=(1<<Fe-ke.zoom)*fe*Pt;if(an*=xt(Math.max(zt,$e),qt),qt<an)return!0;const $t=ke.aabb.closestPoint(O);return $t[0]===O[0]&&$t[1]===O[1]};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Pe.push(ge(-ke)),Pe.push(ge(ke));for(Pe.push(ge(0));Pe.length>0;){const ke=Pe.pop(),mt=ke.x,nt=ke.y;let yt=ke.fullyVisible;const Pt=()=>this.projection.name==="globe"&&(ke.y===0||ke.y===(1<<ke.zoom)-1);if(!yt){let qt=pe?ke.aabb.intersects($):ke.aabb.intersectsFlat($);if(qt===0&&Pt()){const zt=new s.cD(ke.zoom,mt,nt);qt=s.cE(this,z,zt,!0).intersects($)}if(qt===0)continue;yt=qt===2}if(ke.zoom===Fe||!Qe(ke)){const qt=ke.zoom===Fe?We:ke.zoom;if(n.minzoom&&n.minzoom>qt)continue;let zt=0;if(!yt){let $t=pe?ke.aabb.intersectsPrecise($):ke.aabb.intersectsPreciseFlat($);if($t===0&&Pt()){const on=new s.cD(ke.zoom,mt,nt);$t=s.cE(this,z,on,!0).intersectsPrecise($)}if($t===0)continue;if(n.calculateQuadrantVisibility)if($.containsPoint(ke.aabb.center))zt=15;else for(let on=0;on<4;on++)ke.aabb.quadrant(on).intersects($)!==0&&(zt|=1<<on)}const kt=O[0]-(.5+mt+(ke.wrap<<ke.zoom))*(1<<c-ke.zoom),cn=O[1]-.5-nt,an=ke.tileID?ke.tileID:new s.aQ(qt,ke.wrap,ke.zoom,mt,nt);n.calculateQuadrantVisibility&&(an.visibleQuadrants=zt),Le.push({tileID:an,distanceSq:kt*kt+cn*cn});continue}for(let qt=0;qt<4;qt++){const zt=(mt<<1)+qt%2,kt=(nt<<1)+(qt>>1),cn={aabb:E?ke.aabb.quadrant(qt):s.cF(this,z,ke.zoom+1,zt,kt,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:zt,y:kt,wrap:ke.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};b&&!H&&(cn.tileID=new s.aQ(ke.zoom+1===Fe?We:ke.zoom+1,ke.wrap,ke.zoom+1,zt,kt),lt(cn)),Pe.push(cn)}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,mt=this.horizonLineFromTop();Le=Le.filter(nt=>{const yt=[0,0,0,1],Pt=[s.al,s.al,0,1],qt=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());s.aC(yt,yt,qt),s.aC(Pt,Pt,qt);const zt=s.cG([],yt,Pt),kt=s.cH([],yt,Pt),cn=s.c$(zt,kt);if(cn===0)return!0;let an=!1;const $t=this._elevation;if($t&&cn>ke&&mt!==0){const on=this.calculateProjMatrix(nt.tileID.toUnwrapped());let xn;n.isTerrainDEM||(xn=$t.getMinMaxForTile(nt.tileID)),xn||(xn={min:Te,max:Ie});const Mn=s.cI(this.rotation),Vn=[Mn[0]*s.al,Mn[1]*s.al,xn.max];s.af(Vn,Vn,on),an=(1-Vn[1])*this.height*.5<mt}return cn<ke||an})}return Le.sort((ke,mt)=>ke.distanceSq-mt.distanceSq).map(ke=>ke.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const c=s.aA(n.lat,-s.cJ,s.cJ),p=this.projection.project(n.lng,c);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let p,x;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(c.x-b.x)/I,x=(c.y-b.y)/I}else{const I=this.pointCoordinate(c),M=this.pointCoordinate(b);p=I.x-M.x,x=I.y-M.y}const E=this.locationCoordinate(n);this.setLocation(new s.ae(E.x-p,E.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,c){return this.projection.locationPoint(this,n,c)}locationPoint3D(n,c){return this.projection.locationPoint(this,n,c,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,c){return this.coordinateLocation(this.pointCoordinate3D(n,c))}locationCoordinate(n,c){const p=c?s.cf(c,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new s.ae(x.x,x.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const p=c??this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.aC(x,x,this.pixelMatrixInverse),s.aC(b,b,this.pixelMatrixInverse);const E=b[3];s.cK(x,x,1/x[3]),s.cK(b,b,1/E);const I=x[2],M=b[2];return{p0:x,p1:b,t:I===M?0:(p-I)/(M-I)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.aC(c,c,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cK(c,c,1/c[3]),s.cK(p,p,1/p[3]),c[2]=s.cf(c[2],this._center.lat)*this.worldSize,p[2]=s.cf(p[2],this._center.lat)*this.worldSize,s.cK(c,c,1/this.worldSize),s.cK(p,p,1/this.worldSize),new s.ax([c[0],c[1],c[2]],s.aw([],s.av([],p,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:p,t:x}=n,b=s.cf(c[2],this._center.lat),E=s.cf(p[2],this._center.lat);return new s.ae(s.ak(c[0],p[0],x)/this.worldSize,s.ak(c[1],p[1],x)/this.worldSize,s.ak(b,E,x))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n,c){if(!this.elevation)return this.pointCoordinate(n,c);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ae(p[0],p[1],p[2]);let x=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,c);const E=.02*b,I=n.clone();for(let M=0;M<10&&b-x>E;M++){I.y=s.ak(x,b,.66);const z=this.projection.pointCoordinate3D(this,I.x,I.y);z?(b=I.y,p=z):x=I.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.aC(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(c,n)),E=this.pointLocation3D(new s.P(x,n)),I=this.pointLocation3D(new s.P(x,p)),M=this.pointLocation3D(new s.P(c,p));let z=Math.min(b.lng,E.lng,I.lng,M.lng),O=Math.max(b.lng,E.lng,I.lng,M.lng),H=Math.min(b.lat,E.lat,I.lat,M.lat),G=Math.max(b.lat,E.lat,I.lat,M.lat);const $=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,Y=(ee,re,pe,fe,ue)=>{const Ie=(ee+pe)/2,Te=(re+fe)/2,Ae=new s.P(Ie,Te),{lng:ve,lat:ge}=this.pointLocation3D(Ae),Pe=Math.max(0,z-ve,H-ge,ve-O,ge-G);z=Math.min(z,ve),O=Math.max(O,ve),H=Math.min(H,ge),G=Math.max(G,ge),(ue<J||Pe>$)&&(Y(ee,re,Ie,Te,ue+1),Y(Ie,Te,pe,fe,ue+1))};if(Y(c,n,x,n,1),Y(x,n,x,p,1),Y(x,p,c,p,1),Y(c,p,c,n,1),this.projection.name==="globe"){const[ee,re]=s.cM(this);ee?(G=90,O=180,z=-180):re&&(H=-90,O=180,z=-180)}return new s.aI(new s.aT(z,H),new s.aT(O,G))}_getBoundsRectangular(n,c){const{top:p,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=new s.P(x,p),M=new s.P(E,p),z=new s.P(E,b),O=new s.P(x,b);let H=this.pointCoordinate(I,n),G=this.pointCoordinate(M,n);const $=this.pointCoordinate(z,c),J=this.pointCoordinate(O,c),Y=(ee,re)=>(re.y-ee.y)/(re.x-ee.x);return H.y>1&&G.y>=0?H=new s.ae((1-J.y)/Y(J,H)+J.x,1):H.y<0&&G.y<=1&&(H=new s.ae(-J.y/Y(J,H)+J.x,0)),G.y>1&&H.y>=0?G=new s.ae((1-$.y)/Y($,G)+$.x,1):G.y<0&&H.y<=1&&(G=new s.ae(-$.y/Y($,G)+$.x,0)),new s.aI().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((p,x)=>{if(x.dem){const b=x.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=n.canonical,b=1/this.height,E=this.cameraWorldSize,I=E/this.zoomScale(x.z),M=(x.x+Math.pow(2,x.z)*n.wrap)*I,z=x.y*I,O=this.point;O.x*=E/this.worldSize,O.y*=E/this.worldSize;const H=this.angle,G=Math.sin(-H),$=-Math.cos(-H);return p[c]={bearing:[G,$],center:[(O.x-M)*b,(O.y-z)*b],scale:I/s.al*b},p[c]}calculateFogTileMatrix(n){const c=n.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(n,c=!1,p=!1){const x=n.key;let b;if(b=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const E=this.calculatePosMatrix(n,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,s.aB(E,I,E),b[x]=new Float32Array(E),b[x]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=s.cN(n,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=s.bq([],[n,n,n]);return s.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=s.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),b=s.cf(1,this._center.lat);p[2]/=b,x[2]/=b,s.aw(x,x);const E=n.raycast(p,x,n.exaggeration());if(E){const I=s.bH([],p,x,E),M=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),z=(M.z+s.ag([M.x-p[0],M.y-p[1],M.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,p=s.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),b=c.getAtPointOrZero(new s.ae(...x)),E=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),M=x[2]-E;if(M<=I)if(M<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),O=[x[0],x[1],z.z-x[2]],H=s.ag(O);O[2]-=(I-M)/this._pixelsPerMercatorPixel;const G=s.ag(O);if(G===0)return;s.c5(O,O,H/G*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const G=this.center;return G.lat=s.aA(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(G.lng=s.aA(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let b=0,E=p,I=x;const M=this.width/2,z=this.height/2,O=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-z<O&&(I=O+z),x+z>H&&(I=H-z),H-O<this.height&&(b=Math.max(b,this.height/(H-O)),I=(H+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,J=this.worldSize/2-(G+$)/2;E=(p+J+this.worldSize)%this.worldSize-J,E-M<G&&(E=G+M),E+M>$&&(E=$-M),$-G<this.width&&(b=Math.max(b,this.width/($-G)),E=($+G)/2)}E===p&&I===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(E,I))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const x=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,b);let I;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-n.x/this.width,M[9]=2*n.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pe=ge*this.aspect,Le=-Pe,Fe=-ge;Pe-=n.x,Le-=n.x,ge+=n.y,Fe+=n.y,I=this._camera.getCameraToClipOrthographic(Le,Pe,Fe,ge,this._nearZ,this._farZ),((We,$e,lt,xt)=>{for(let Qe=0;Qe<16;Qe++)We[Qe]=s.ak($e[Qe],lt[Qe],xt)})(I,I,M,s.d0(this.pitch>=Lo?1:this.pitch/Lo))}else I=M;const z=s.cP([],M,E);let O=s.cP([],I,E);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),Pe=s.bA([]);s.br(Pe,Pe,[ge.x*this.worldSize,ge.y*this.worldSize,0]),s.aB(Pe,Pe,s.cQ(this)),s.br(Pe,Pe,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),s.aB(O,O,Pe),s.aB(z,z,Pe),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],O,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=O,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),c){const ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-n.x/this.width,ge[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cP([],ge,E)}else this.expandedFarZProjMatrix=this.projMatrix;const H=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const G=new Float32Array(16);s.bA(G),s.cS(G,G,[1,-1,1]),s.cU(G,G,this._pitch),s.bB(G,G,this.angle);const $=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz($);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-n.x/this.width,$[9]=2*(n.y+J)/this.height,this.skyboxMatrix=s.aB(G,$,G);const Y=this.point,ee=Y.x,re=Y.y,pe=this.width%2/2,fe=this.height%2/2,ue=Math.cos(this.angle),Ie=Math.sin(this.angle),Te=ee-Math.round(ee)+ue*pe+Ie*fe,Ae=re-Math.round(re)+ue*fe+Ie*pe,ve=new Float64Array(O);if(s.br(ve,ve,[Te>.5?Te-1:Te,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=ve,O=s.bC(),s.cS(O,O,[this.width/2,-this.height/2,1]),s.br(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.bC(),s.cS(O,O,[1,-1,1]),s.br(O,O,[-1,-1,0]),s.cS(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},O=s.bl(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(ge,ge,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,c];s.c5(b,b,x),s.c5(p,p,-1),s.cW(p,p,b);const E=s.bC();s.br(E,E,p),s.cS(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,x)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*b,x.y/this.worldSize-p[1]*b,n/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((c-p)/x,1)),this._camera.position=s.bH([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),b=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((n[2]-b)/Math.cos(p),E),M=this._zoomFromMercatorZ(I);s.bH(n,n,c,I),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(x,-Math.PI,Math.PI),this._setZoom(s.aA(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,p=s.cL,x=0,b=1/0;for(;p-c>1e-6&&p>c;){const E=c+.5*(p-c),I=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,I),z=this.scaleZoom(M/(Math.max(0,n)*this.tileSize)),O=Math.abs(E-z);O<b&&(b=O,x=E),E<z?c=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const p=Math.min(n.x,c.x),x=Math.max(n.x,c.x),b=Math.min(n.y,c.y),E=Math.max(n.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(p,b),new s.P(x,E),new s.P(p,E),new s.P(x,b)],M=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const O of I){const H=this.pointRayIntersection(O);if(H.t<0)return!0;const G=this.rayIntersectionCoordinate(H);if(G.x<M||G.y<0||G.x>z||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,c){const p=s.ag(s.av([],this._camera.position,n)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([c,p,x],b){const E=[c,p,x,1];s.aC(E,E,b);const I=E[3]=Math.max(E[3],1e-6);return E[0]/=I,E[1]/=I,E[2]/=I,E})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,c=this.zoom,p=this.worldSize){const x=s.cO(n,c,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=s.ak(1,E,s.d0(this.pitch>=Lo?1:this.pitch/Lo))),E}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Yo=(f,n)=>{if(n>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?s.ah(60,45,c.pitch):s.ah(30,15,c.pitch),b=c._farZ-c._nearZ,E=n*c.height,I=((1-(M=x))*c.cameraToCenterDistance+M*(c._farZ+E))*p;var M;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/b,(I-E-c._nearZ)/b]}}},Vc=2048;class y_{constructor(n,c){this.aabb=n,this.lastCascade=c}}class lh{add(n,c){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[n.key]=new y_(c,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,c,p){const x=s.d9.fromPoints(n.points);let b=0;for(const E in this.receivers){const I=this.receivers[E];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const M=I.aabb.getCorners();for(let z=0;z<p.length;z++){let O=!0;for(const H of M){const G=[H[0]*c,H[1]*c,H[2]];if(s.af(G,G,p[z].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){O=!1;break}}if(I.lastCascade=z,b=Math.max(b,z),O)break}}return b+1}}class _f{constructor(n){this.painter=n,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new lh,this._depthMode=new mn(n.context.gl.LEQUAL,mn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,c){const p=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity"),b=c.properties.get("shadow-draw-before-layer");if(!c.shadowsEnabled()||x<=0)return;let E=-1,I=0;for(const re of p.style.order){const pe=p.style._mergedLayers[re];pe.hasShadowPass()&&!pe.isHidden(n.zoom)&&(E=I),b&&b===re&&(this._drawShadowAfterLayer=I>0?I-1:0),I+=1}if(this._enabled=E>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=E);const M=p.context,z=Vc,O=Vc;if(this._cascades.length===0||Vc!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<2;++re){const pe=p._shadowMapDebug,fe=M.gl,ue=M.createFramebuffer(z,O,pe?1:0,"texture"),Ie=new s.T(M,{width:z,height:O,data:null},fe.DEPTH_COMPONENT16);if(ue.depthAttachment.set(Ie.texture),pe){const Te=new s.T(M,{width:z,height:O,data:null},fe.RGBA8);ue.colorAttachment0.set(Te.texture)}this._cascades.push({framebuffer:ue,texture:Ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Ap(c);let H=0;if(n.elevation){const re=n.elevation,pe=[1e4,-1e4];re.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const ue=fe.dem.tree;pe[0]=Math.min(pe[0],ue.minimums[0]),pe[1]=Math.max(pe[1],ue.maximums[0])}),pe[0]!==1e4&&(H=(pe[1]-pe[0])*re.exaggeration())}const G=1.5*n.cameraToCenterDistance,$=3*G,J=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const pe=this._cascades[re];let fe=n.height/50,ue=1;re===0?ue=G:(fe=G,ue=$);const[Ie,Te]=Ip(n,this.shadowDirection,fe,ue,Vc,H);pe.scale=n.scale,pe.matrix=Ie,pe.boundingSphereRadius=Te,s.bl(J,pe.matrix),pe.frustum=s.cB.fromInvProjectionMatrix(J,1,0,!0),pe.far=ue}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Vc,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ee=p.transform.elevation;for(const re of this._groundShadowTiles){let pe={min:0,max:0};if(ee){const fe=ee.getMinMaxForTile(re);fe&&(pe=fe)}this.addShadowReceiver(re.toUnwrapped(),pe.min,pe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,Vc,Vc]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:s.ao.white,depth:1});for(const E of n.order){const I=n._mergedLayers[E];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const M=n.getLayerSourceCache(I),z=M?c[M.id]:void 0;(I.type==="model"||z&&z.length)&&p.renderLayer(p,M,I,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,c=n.style,p=n.context,x=p.gl,b=c.directionalLight,E=c.ambientLight;if(!b||!E)return;const I=[],M=Yo(n,n.longestCutoffRange);M.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const z=Ha(c,b,E),O=new mn(x.LEQUAL,mn.ReadOnly,n.depthRangeFor3D),H=new Ln({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const G of this._groundShadowTiles){const $=G.toUnwrapped(),J=n.isTileAffectedByFog(G),Y=n.getOrCreateProgram("groundShadow",{defines:I,overrideFog:J});this.setupShadows($,Y),n.uploadCommonUniforms(p,Y,$,null,M);const ee=ao(n.transform.calculateProjMatrix($),z);Y.draw(n,x.TRIANGLES,O,H,zn.multiply,Rn.disabled,ee,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?zn.unblended:zn.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(n){const c=this.painter.transform,p=c.calculatePosMatrix(n,c.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){const c=s.bz(n);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,n),c}setupShadows(n,c,p){if(!this.enabled)return;const x=this.painter.transform,b=this.painter.context,E=b.gl,I=this._uniformValues,M=new Float64Array(16),z=x.calculatePosMatrix(n,x.worldSize);for(let O=0;O<this._cascades.length;O++)s.aB(M,this._cascades[O].matrix,z),I[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(E.TEXTURE0+11+O),this._cascades[O].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const O=s.d7(n.canonical),H=2/x.tileSize*s.al/Vc,G=H*this._cascades[0].boundingSphereRadius,$=H*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(p==="vector-tile"?1:3)*(function(Y){const ee=s.aA((Y-22)/-22,0,1);return .125*(1-ee)+4*ee})(x.zoom);I.u_shadow_normal_offset=[O,G*J,$*J],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(b,I)}setupShadowsFromMatrix(n,c,p=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,E=this._uniformValues,I=new Float64Array(16);for(let M=0;M<2;M++)s.aB(I,this._cascades[M].matrix,n),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(b.TEXTURE0+11+M),this._cascades[M].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=p,p?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,c,p,x){if(x[2]>=0)return{};const b=(function(M,z,O){const H=O/(1<<M.canonical.z);return new s.d9([M.canonical.x*H+M.wrap*O,M.canonical.y*H+M.wrap*O,0],[(M.canonical.x+1)*H+M.wrap*O,(M.canonical.y+1)*H+M.wrap*O,z])})(n,c,p).getCorners(),E=c/-x[2];x[0]<0?(s.d8(b[0],b[0],[x[0]*E,0,0]),s.d8(b[3],b[3],[x[0]*E,0,0])):x[0]>0&&(s.d8(b[1],b[1],[x[0]*E,0,0]),s.d8(b[2],b[2],[x[0]*E,0,0])),x[1]<0?(s.d8(b[0],b[0],[0,x[1]*E,0]),s.d8(b[1],b[1],[0,x[1]*E,0])):x[1]>0&&(s.d8(b[2],b[2],[0,x[1]*E,0]),s.d8(b[3],b[3],[0,x[1]*E,0]));const I={};return I.vertices=b,I.planes=[jc(b[1],b[0],b[4]),jc(b[2],b[1],b[5]),jc(b[3],b[2],b[6]),jc(b[0],b[3],b[7])],I}addShadowReceiver(n,c,p){this._receivers.add(n,s.d9.fromTileIdAndHeight(n,c,p))}getMaxCascadeForTile(n){const c=this._receivers.get(n);return c&&c.lastCascade?c.lastCascade:0}}function jc(f,n,c){const p=s.av([],c,n),x=s.av([],f,n),b=s.bI([],p,x),E=s.ag(b);return E===0?[0,0,1,0]:(s.c5(b,b,1/E),[b[0],b[1],b[2],-s.bJ(b,n)])}function Ap(f){const n=f.properties.get("direction"),c=s.d4(n.x,n.y,n.z);c[2]=s.aA(c[2],0,75);const p=s.d6([c[0],c[1],c[2]]);return s.d5(p.x,p.y,p.z)}function Ha(f,n,c){const p=n.properties.get("color-use-theme")==="none",x=n.properties.get("color"),b=n.properties.get("intensity"),E=n.properties.get("direction"),I=[E.x,E.y,E.z],M=c.properties.get("color-use-theme")==="none",z=c.properties.get("color"),O=c.properties.get("intensity"),H=Math.max(s.bJ([0,0,1],I),0),G=[0,0,0];s.c5(G,z.toPremultipliedRenderColor(M?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),O);const $=[0,0,0];return s.c5($,x.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),H*b),s.db([G[0]>0?G[0]/(G[0]+$[0]):0,G[1]>0?G[1]/(G[1]+$[1]):0,G[2]>0?G[2]/(G[2]+$[2]):0])}function Ip(f,n,c,p,x,b){const E=f.zoom,I=f.scale,M=f.worldSize,z=1/M,O=f.aspect,H=Math.sqrt(1+O*O)*Math.tan(.5*f.fovX),G=H*H,$=p-c,J=p+c;let Y,ee;G>$/J?(Y=p,ee=p*H):(Y=.5*J*(1+G),ee=.5*Math.sqrt($*$+2*(p*p+c*c)*G+J*J*G*G));const re=f.projection.pixelsPerMeter(f.center.lat,M),pe=f._camera.getCameraToWorldMercator(),fe=[0,0,-Y*z];s.af(fe,fe,pe);let ue=ee*z;const Ie=function(yt){return yt[0]/=I,yt[1]/=I,yt[2]=s.cf(yt[2],f._center.lat),yt},Te=f._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const yt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?re:1),Pt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);Pt[8]=2*-f.centerOffset.x/f.width,Pt[9]=2*f.centerOffset.y/f.height;const qt=new Float64Array(16);s.cP(qt,Pt,yt);const zt=new Float64Array(16);s.bl(zt,qt);const kt=s.cB.fromInvProjectionMatrix(zt,M,E,!0);for(const cn of kt.points){const an=Ie(cn);ue=Math.max(ue,s.c6(s.da([],fe,an)))}}ue*=x/(x-1);const Ae=Math.acos(n[2]),ve=Math.atan2(-n[0],-n[1]),ge=new od;ge.position=fe,ge.setPitchBearing(Ae,ve);const Pe=ge.getWorldToCamera(M,re),Le=ue*M,Fe=Math.min(f._mercatorZfromZoom(17)*M*-2,-2*Le),We=ge.getCameraToClipOrthographic(-Le,Le,-Le,Le,Fe,(Le+b*re)/n[2]),$e=new Float64Array(16);s.aB($e,We,Pe);const lt=s.d5(Math.floor(1e6*fe[0])/1e6*M,Math.floor(1e6*fe[1])/1e6*M,0),xt=.5*x,Qe=[0,0,0];s.af(Qe,lt,$e),s.c5(Qe,Qe,xt);const ke=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],mt=[0,0,0];s.av(mt,Qe,ke),s.c5(mt,mt,-1/xt);const nt=new Float64Array(16);return s.bA(nt),s.br(nt,nt,mt),s.aB($e,nt,$e),[$e,Le]}class yf extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,c){return s.dc(this.requestManager.transformRequest(c,s.R.Model).url).then(p=>{if(!p)return;const x=s.dd(p),b=new s.de(n,c,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${c}: ${p.message}`)))})}load(n,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(n),b=[],E=[];for(const I of x){const M=n[I];this.hasURLBeenRequested(M)&&!p.forceReload||(this.modelByURL[M]={modelId:I,scope:c},b.push(this.loadModel(I,M)),E.push(I)),this.models[c][I]||(this.models[c][I]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+E.length,Promise.allSettled(b).then(I=>{for(let M=0;M<I.length;M++){const{status:z}=I[M];if(z==="rejected")continue;const{value:O}=I[M];this.models[c][E[M]]||(this.models[c][E[M]]={model:null,numReferences:1}),this.models[c][E[M]].model=O}this.numModelsLoading[c]-=E.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,c):this.getModelByURL(this.modelUris[c][n]))}getModel(n,c){return this.models[c]||(this.models[c]={}),this.models[c][n]?this.models[c][n].model:void 0}getModelByURL(n){if(!n)return null;const c=this.modelByURL[n];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(n,c){return this.models[c]&&this.models[c][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===x)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:b,modelId:E}=this.modelByURL[x];this.models[b][E].numReferences++}else this.modelUris[p][n]=x,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in n)p[x]=this.requestManager.normalizeModelURL(n[x])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of n)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&s.df(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,c,p=!1,x=!1){if(this.models[c]&&this.models[c][n]&&(this.models[c][n].numReferences--,this.models[c][n].numReferences===0||x)){const b=this.modelUris[c][n];p||delete this.modelUris[c][n],delete this.modelByURL[b];const E=this.models[c][n].model;if(!E)return;delete this.models[c][n],E.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const c of Object.keys(this.models[n])){const p=this.models[n][c].model;delete this.models[n][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(n.context)}}const Ll=s.a6.colorTheme,Ko=new s.a9({data:new s.aa(Ll.data)});function Wm(f){if(!f.metadata||!f.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:c,top:p,width:x,height:b}=f.metadata.content_area,E=c*n,I=p*n;return[E,I,E+x*n,I+b*n]}function Xm(f){if(f)return f.map(([n,c])=>[n*s.o.devicePixelRatio,c*s.o.devicePixelRatio])}class ch{constructor(n,c,p){this.id=n,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof aa))return n;const x=c.map(E=>this.sourceCache.getTile(E)),b=p.getImages(x,Array.from(this.pendingRequests));for(const[E,I]of b)n.set(s.I.from({name:E,iconsetId:this.id}),I),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),n}}class Cp{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(n,c){const p=Ye("button",n,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return Ye("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,c){this._map&&(n.setAttribute("aria-label",c),n.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const c=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Ye("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,c){for(let p=0;p<n.length;p++){const x=n[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(x.id)}),E=(x.name||"").trim(),I=x.zIndex.toString(),M=E?Array.from(E).slice(0,3).join(""):I;this._setButtonTitle(b,M),this._model&&x.id===this._model.selectedFloorId&&c&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<n.length-1&&this._createSeparator()}}}class x_ extends s.E{constructor(n){super(),this._style=n,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[c,p]of Object.entries(n.buildings))if(this._buildings[c])for(const x of p.floorIds)this._buildings[c].floors[x]||(this._buildings[c].floors[x]=p.floors[x]);else this._buildings[c]=p;for(const c of n.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(n,c){const p=this._style.getIndoorSourceLayers(n,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Cp,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const n=this._style.map.transform,c=(function(p,x,b,E){let I=null,M=Number.MAX_SAFE_INTEGER;if(E<16)return null;for(const[z,O]of Object.entries(p)){const H=O.center;if(H){const G=x.distanceTo(s.aT.convert(H));G<M&&b.contains(H)&&(M=G,I=z)}}return I})(this._buildings,n.center,n.getBounds(),n.zoom);c!==this._closestBuildingId&&(this._closestBuildingId=c,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,c=this._closestBuildingId,p=c&&n?n[c]:void 0;if(!p)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let x=null;for(const E of p.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){x=E;break}const b=Array.from(p.floorIds).map(E=>({id:E,name:p.floors[E].name,zIndex:p.floors[E].zIndex})).sort((E,I)=>I.zIndex-E.zIndex).filter((E,I,M)=>I===0||E.zIndex!==M[I-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const uc=(f,n)=>Be(f,n&&n.filter(c=>c.identifier!=="source.canvas")),v_=s.aH(di,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),b_=s.aH(di,["setCenter","setZoom","setBearing","setPitch"]),Rp=new Set(["background","sky","slot","custom"]),Mp={version:8,layers:[],sources:{}},Uc={duration:300,delay:0};class $a extends s.E{constructor(n,c={}){super(),this.map=n,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Uc),this._buildingIndex=new Nc(this),this.crossTileSymbolIndex=new ts,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new ui,this._hasDataDrivenEmissive=!1,this.indoorManager=new x_(this),this.dispatcher=c.dispatcher?c.dispatcher:new s.D(s.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new _r(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new s.di(n._requestManager,c.localFontFamily?s.dj.all:c.localIdeographFontFamily?s.dj.ideographs:s.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new yf(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const p=this;this._rtlTextPluginCallback=$a.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(s.dl(b),E&&E.every(I=>I))for(const I in p._sourceCaches){const M=p._sourceCaches[I],z=M.getSource().type;z!=="vector"&&z!=="geojson"||M.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===b.id&&this._validateLayer(I)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const c=s.dm(n);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${s.dn(JSON.stringify(n))}`}_diffStyle(n,c,p){this.globalId=this._getGlobalId(n);const x=(b,E)=>{try{E(null,this.setState(b,p))}catch(I){E(I,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),E=this.map._requestManager.transformRequest(b,s.R.Style);s.m(E,(I,M)=>{I?this.fire(new s.y(I)):M&&x(M,c)})}else typeof n=="object"&&x(n,c)}loadURL(n,c={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,c.accessToken),this.resolvedImports.add(n);const x=this.importsCache.get(n);if(x)return this._load(x,p);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(b,(E,I)=>{if(this._request=null,E)this.fire(new s.y(E));else if(I)return this.importsCache.set(n,I),this._load(I,p)})}loadJSON(n,c={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Mp,!1)}_loadImports(n,c,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of n){const E=this._createFragmentStyle(b),I=new Promise(O=>{E.once("style.import.load",O),E.once("error",O)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(b.url)){E.loadEmpty();continue}const M=b.data||this.importsCache.get(b.url);M?(E.loadJSON(M,{validate:c}),this._isInternalStyle(M)&&(E.globalId=null)):b.url?E.loadURL(b.url,{validate:c}):E.loadEmpty();const z={style:E,id:b.id,config:b.config};if(p){const O=this.fragments.findIndex(({id:H})=>H===p);this.fragments=this.fragments.slice(0,O).concat(z).concat(this.fragments.slice(O))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(n=this,c=new Set){for(const p of n.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(n){const c=this.scope?s.B(n.id,this.scope):n.id;let p;const x=this._initialConfig&&this._initialConfig[c];(n.config||x)&&(p=Object.assign({},n.config,x));const b=new $a(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,c){if(this._isInternalStyle(n)){const b=Object.assign({},Mp,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(b,c)}if(this.updateConfig(this._config,n.schema),c&&uc(this,ja(n)))return;this._loaded=!0,this.stylesheet=s.dp(n);const p=()=>{for(const M in n.sources)this.addSource(M,n.sources[M],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const M in n.iconsets)this.addIconset(M,n.iconsets[M]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=rh(this.stylesheet.layers);if(this._order=b.map(M=>M.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new at(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const M of b){const z=s.du(M,this.scope,this._styleColorTheme.lut,this.options);z.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(z.fqid),this._hasAppearances=this._hasAppearances||z.getAppearances().length!==0,z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const O=this.getOwnLayerSourceCache(z),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&z.canCastShadows()&&H&&(O.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();n.imports?this._loadImports(n.imports,c).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(M=>{this.fire(new s.y(new Error("Failed to load imports",M))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const b=this._evaluateColorThemeData(x);this._loadColorTheme(b).then(()=>{p()}).catch(E=>{s.w(`Couldn't load color theme from the stylesheet: ${E}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(n=>n.style.hasAppearances())}mergeAll(){let n,c,p,x,b,E,I,M,z,O;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(G=>{if(G.stylesheet){if(G.light!=null&&(n=G.light),G.stylesheet.lights)for(const $ of G.stylesheet.lights)$.type==="ambient"&&G.ambientLight!=null&&(c=G.ambientLight),$.type==="directional"&&G.directionalLight!=null&&(p=G.directionalLight);x=this._prioritizeTerrain(x,G.terrain,G.stylesheet.terrain),G.stylesheet.fog&&G.fog!=null&&(b=G.fog),G.stylesheet.snow&&G.snow!=null&&(E=G.snow),G.stylesheet.rain&&G.rain!=null&&(I=G.rain),G.stylesheet.camera!=null&&(O=G.stylesheet.camera),G.stylesheet.projection!=null&&(M=G.stylesheet.projection),G.stylesheet.transition!=null&&(z=G.stylesheet.transition),H[G.scope]=G._styleColorTheme}}),this.light=n,this.ambientLight=c,this.directionalLight=p,this.fog=b,this.snow=E,this.rain=I,this._styleColorThemeForScope=H,x===null?delete this.terrain:this.terrain=x,this.camera=O||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=Object.assign({},Uc,z),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const c=p=>{for(const x of p.fragments)c(x.style);n(p)};c(this)}_prioritizeTerrain(n,c,p){const x=n&&n.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?n:null:c!=null&&(!n||x||c&&c.drapeRenderMode===1)?c:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{n=this._prioritizeTerrain(n,c.terrain,c.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(n=c.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},c={},p={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const E=s.B(b,x.scope);n[E]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const E=s.B(b,x.scope);c[E]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const E=s.B(b,x.scope);p[E]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const c of Object.values(n.stylesheet.indoor)){const p=c,x=s.B(p.sourceId,n.scope);this._mergedIndoor[x]=new Set(p.sourceLayers||[])}})}mergeLayers(){const n={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const I of E._order){const M=E._layers[I];if(M.type==="slot"){const z=s.dq(I);if(n[z])continue;n[z]=[]}M.slot&&n[M.slot]?n[M.slot].push(M):c.push(M)}}),this._mergedOrder=[];let x=-1;const b=(E=[])=>{for(const I of E)if(I.type==="slot"){const M=s.dq(I.id);n[M]&&b(n[M]),this._mergedSlots.push(M)}else{const M=s.B(I.id,I.scope);this._mergedOrder.push(M),p[M]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(c),this._has3DLayers){const E={};for(let I=0;I<this._mergedOrder.length;++I){const M=this._mergedOrder[I];E[M]=I===x?1:I<x?p[M].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,M)=>E[I]-E[M])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(c,p,x){const b=Object.assign({},p);for(const I of Object.keys(Ll))b[I]===void 0&&(b[I]=Ll[I].default);const E=new s.a8(Ko,c,new Map(x));return E.setTransitionOrValue(b,x),E.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=n;E.startsWith(b)||(E=b+E);const I=s.I.from("mapbox-reserved-lut"),M=new Image;M.src=E,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:O,data:H}=s.o.getImageData(M);if(O>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==O*O)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:z,height:O},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const G=this.imageManager.getImage(I,this.scope);G?(this._styleColorTheme.lut={image:G.data,data:n},p()):x(new Error("Missing LUT image."))}})}getLut(n){const c=this._styleColorThemeForScope[n];return c?c.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(c,p,x){let b,E,I;const M=s.o.devicePixelRatio>1?"@2x":"";let z=s.m(p.transformRequest(p.normalizeSpriteURL(c,M,".json"),s.R.SpriteJSON),(G,$)=>{z=null,I||(I=G,b=$,H())}),O=s.n(p.transformRequest(p.normalizeSpriteURL(c,M,".png"),s.R.SpriteImage),(G,$)=>{O=null,I||(I=G,E=$,H())});function H(){if(I)x(I);else if(b&&E){const G=s.o.getImageData(E),$={};for(const J in b){const{width:Y,height:ee,x:re,y:pe,sdf:fe,pixelRatio:ue,stretchX:Ie,stretchY:Te,content:Ae}=b[J],ve=new s.q({width:Y,height:ee});s.q.copy(G,ve,{x:re,y:pe},{x:0,y:0},{width:Y,height:ee},null),$[J]={data:ve,pixelRatio:ue!==void 0?ue:1,sdf:fe!==void 0&&fe,stretchX:Ie,stretchY:Te,content:Ae,usvg:!1,version:0}}x(null,$)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}})(n,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.y(c));else if(p){const x=new Map;for(const b in p)x.set(s.I.from(b),p[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(n,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new ch(n,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(b,E)=>{if(this._spriteRequest=null,b)c?this._loadSprite(n):this.fire(new s.y(b));else if(E){const I=new Map;for(const M in E)I.set(s.I.from(M),E[M]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),(b,E)=>{if(b)return void x(b);const I={},M=s.dg(new s.bt(E));for(const z of M.icons){const O={version:1,pixelRatio:s.o.devicePixelRatio,content:Wm(z),stretchX:z.metadata?Xm(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?Xm(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};I[z.name]=O}x(null,I)}))}_validateLayer(n){const c=this.getOwnSource(n.source);if(!c)return;const p=n.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,c)=>{const p=this.fragments[c];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const c=[];for(const p of n){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];if(c._transitionablePaint&&c._transitionablePaint._values){const p=c._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const c=this.getOwnLayer(n);if(c)return c;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const c=this.getOwnSource(n);if(c)return c;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,c){const p=this.map.painter;if(p)for(let x=n.minzoom||0;x<(n.maxzoom||25.5);x++){const b=n.getProgramIds();if(b)for(const E of b){const I=n.getDefaultProgramParams(E,c.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(E,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(E,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(E,I)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const c=this.calculateLightsBrightness();n.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const M in I){const{updatedIds:z,removedIds:O}=I[M];(z||O)&&(this._updateWorkerLayers(M,z,O),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const I in this._mergedSourceCaches){const M=this._mergedSourceCaches[I];b[I]=M.used,M.used=!1,M.tileCoverLift=0}for(const I of this._mergedOrder){const M=this._mergedLayers[I];if(M.visibility!=="none"&&M.recalculate(n,this._availableImages),!M.isHidden(n.zoom)){const z=this.getLayerSourceCache(M);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,n)}):this.precompilePrograms(M,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const I of E)I.sourceCache.used=!0;for(const I in b){const M=this._mergedSourceCaches[I];b[I]!==M.used&&M.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const c of n){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const c in n)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(n,c,p){const x=this.getFragmentStyle(n);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:n,removedIds:p||[],options:x.options})}setState(n,c){if(this._checkLoaded(),uc(this,ja(n)))return!1;(n=s.dp(n)).layers=rh(n.layers);const p=(function(E,I){if(!E)return[{command:di.setStyle,args:[I]}];let M=[];try{if(!s.by(E.version,I.version))return[{command:di.setStyle,args:[I]}];if(s.by(E.center,I.center)||M.push({command:di.setCenter,args:[I.center]}),s.by(E.zoom,I.zoom)||M.push({command:di.setZoom,args:[I.zoom]}),s.by(E.bearing,I.bearing)||M.push({command:di.setBearing,args:[I.bearing]}),s.by(E.pitch,I.pitch)||M.push({command:di.setPitch,args:[I.pitch]}),s.by(E.sprite,I.sprite)||M.push({command:di.setSprite,args:[I.sprite]}),s.by(E.glyphs,I.glyphs)||M.push({command:di.setGlyphs,args:[I.glyphs]}),s.by(E.imports,I.imports)||(function($=[],J=[],Y){J=J||[];const ee=($=$||[]).map(io),re=J.map(io),pe=$.reduce(Bc,{}),fe=J.reduce(Bc,{}),ue=ee.slice();let Ie,Te,Ae,ve;for(Ie=0,Te=0;Ie<ee.length;Ie++)Ae=ee[Ie],fe.hasOwnProperty(Ae)?Te++:(Y.push({command:di.removeImport,args:[Ae]}),ue.splice(ue.indexOf(Ae,Te),1));for(Ie=0,Te=0;Ie<re.length;Ie++)Ae=re[re.length-1-Ie],ue[ue.length-1-Ie]!==Ae&&(pe.hasOwnProperty(Ae)?(Y.push({command:di.removeImport,args:[Ae]}),ue.splice(ue.lastIndexOf(Ae,ue.length-Te),1)):Te++,ve=ue[ue.length-Ie],Y.push({command:di.addImport,args:[fe[Ae],ve]}),ue.splice(ue.length-Ie,0,Ae));for(const ge of J){const Pe=pe[ge.id];Pe&&(delete Pe.data,s.by(Pe,ge)||Y.push({command:di.updateImport,args:[ge.id,ge]}))}})(E.imports,I.imports,M),s.by(E.transition,I.transition)||M.push({command:di.setTransition,args:[I.transition]}),s.by(E.light,I.light)||M.push({command:di.setLight,args:[I.light]}),s.by(E.fog,I.fog)||M.push({command:di.setFog,args:[I.fog]}),s.by(E.snow,I.snow)||M.push({command:di.setSnow,args:[I.snow]}),s.by(E.rain,I.rain)||M.push({command:di.setRain,args:[I.rain]}),s.by(E.projection,I.projection)||M.push({command:di.setProjection,args:[I.projection]}),s.by(E.lights,I.lights)||M.push({command:di.setLights,args:[I.lights]}),s.by(E.camera,I.camera)||M.push({command:di.setCamera,args:[I.camera]}),s.by(E.iconsets,I.iconsets)||(function($,J,Y){let ee;for(ee in J=J||{},$=$||{})$.hasOwnProperty(ee)&&(J.hasOwnProperty(ee)||Y.push({command:di.removeIconset,args:[ee]}));for(ee in J){if(!J.hasOwnProperty(ee))continue;const re=J[ee];$.hasOwnProperty(ee)?s.by($[ee],re)||(Y.push({command:di.removeIconset,args:[ee]}),Y.push({command:di.addIconset,args:[ee,re]})):Y.push({command:di.addIconset,args:[ee,re]})}})(E.iconsets,I.iconsets,M),!s.by(E["color-theme"],I["color-theme"]))return[{command:di.setStyle,args:[I]}];const z={},O=[];(function($,J,Y,ee){let re;for(re in J=J||{},$=$||{})$.hasOwnProperty(re)&&(J.hasOwnProperty(re)||Co(re,Y,ee));for(re in J){if(!J.hasOwnProperty(re))continue;const pe=J[re];$.hasOwnProperty(re)?s.by($[re],pe)||($[re].type==="geojson"&&pe.type==="geojson"&&sc($,J,re)?Y.push({command:di.setGeoJSONSourceData,args:[re,pe.data]}):ya(re,J,Y,ee)):Io(re,J,Y)}})(E.sources,I.sources,O,z);const H=[];E.layers&&E.layers.forEach($=>{$.source&&z[$.source]?M.push({command:di.removeLayer,args:[$.id]}):H.push($)});let G=E.terrain;G&&z[G.source]&&(M.push({command:di.setTerrain,args:[void 0]}),G=void 0),M=M.concat(O),s.by(G,I.terrain)||M.push({command:di.setTerrain,args:[I.terrain]}),(function($,J,Y){J=J||[];const ee=($=$||[]).map(io),re=J.map(io),pe=$.reduce(Bc,{}),fe=J.reduce(Bc,{}),ue=ee.slice(),Ie=Object.create(null);let Te,Ae,ve,ge,Pe,Le,Fe;for(Te=0,Ae=0;Te<ee.length;Te++)ve=ee[Te],fe.hasOwnProperty(ve)?Ae++:(Y.push({command:di.removeLayer,args:[ve]}),ue.splice(ue.indexOf(ve,Ae),1));for(Te=0,Ae=0;Te<re.length;Te++)ve=re[re.length-1-Te],ue[ue.length-1-Te]!==ve&&(pe.hasOwnProperty(ve)?(Y.push({command:di.removeLayer,args:[ve]}),ue.splice(ue.lastIndexOf(ve,ue.length-Ae),1)):Ae++,Le=ue[ue.length-Te],Y.push({command:di.addLayer,args:[fe[ve],Le]}),ue.splice(ue.length-Te,0,ve),Ie[ve]=!0);for(Te=0;Te<re.length;Te++)if(ve=re[Te],ge=pe[ve],Pe=fe[ve],!Ie[ve]&&!s.by(ge,Pe))if(s.by(ge.source,Pe.source)&&s.by(ge["source-layer"],Pe["source-layer"])&&s.by(ge.type,Pe.type)){for(Fe in Ro(ge.layout,Pe.layout,Y,ve,null,di.setLayoutProperty),Ro(ge.paint,Pe.paint,Y,ve,null,di.setPaintProperty),s.by(ge.slot,Pe.slot)||Y.push({command:di.setSlot,args:[ve,Pe.slot]}),s.by(ge.filter,Pe.filter)||Y.push({command:di.setFilter,args:[ve,Pe.filter]}),s.by(ge.minzoom,Pe.minzoom)&&s.by(ge.maxzoom,Pe.maxzoom)||Y.push({command:di.setLayerZoomRange,args:[ve,Pe.minzoom,Pe.maxzoom]}),ge)ge.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?Ro(ge[Fe],Pe[Fe],Y,ve,Fe.slice(6),di.setPaintProperty):s.by(ge[Fe],Pe[Fe])||Y.push({command:di.setLayerProperty,args:[ve,Fe,Pe[Fe]]}));for(Fe in Pe)Pe.hasOwnProperty(Fe)&&!ge.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?Ro(ge[Fe],Pe[Fe],Y,ve,Fe.slice(6),di.setPaintProperty):s.by(ge[Fe],Pe[Fe])||Y.push({command:di.setLayerProperty,args:[ve,Fe,Pe[Fe]]}))}else Y.push({command:di.removeLayer,args:[ve]}),Le=ue[ue.lastIndexOf(ve)+1],Y.push({command:di.addLayer,args:[Pe,Le]})})(H,I.layers,M)}catch(z){console.warn("Unable to compute style diff:",z),M=[{command:di.setStyle,args:[I]}]}return M})(this.serialize(),n).filter(E=>!(E.command in b_));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in v_));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const b=[];return p.forEach(E=>{b.push(this[E.command](...E.args))}),c&&Promise.all(b).then(c).catch(c),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[c,p]of n.entries()){if(this.getImage(c))return this.fire(new s.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,c){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,c,p=!1){this.imageManager.updateImage(n,this.scope,c),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(n){return this.modelManager.addModelURLs(n,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,c,p={}){return this._checkLoaded(),this._validate(De,`models.${n}`,c,null,p)||(this.modelManager.addModel(n,c,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.getActualScope())}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(n,c,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(ul,`sources.${n}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=To(n,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=E=>{const I=(E?"symbol:":"other:")+x.id,M=s.B(I,this.scope),z=this._sourceCaches[I]=new us(M,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const c=this.getOwnSource(n);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([b,E])=>E.type==="source"&&E.source===n);if(x)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const x of p){const b=s.dq(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getOwnSource(n).setData(c),this._changes.setDirty()}getOwnSource(n){const c=this.getOwnSourceCache(n);return c&&c.getSource()}getOwnSources(){const n=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const c in n){const p=n[c]._tiles;for(const x in p){const b=p[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const b of n){if(this._validate(Mt,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(b),E.updateTransitions(c)}else this.ambientLight=new hi(b,hr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(b),E.updateTransitions(c)}else this.directionalLight=new hi(b,_i(),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,c=this.ambientLight;if(!n||!c)return;const p=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),x=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),E=n.properties.get("direction"),I=1-s.d4(E.x,E.y,E.z)[2]/90,M=p(x)*b*I,z=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),O=c.properties.get("intensity"),H=p(z)*O;return Number(((M+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dr(n)){const c=s.ds(n),p=this.fragments.find(({id:b})=>b===c);if(!p)return;const x=s.dq(n);return p.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:p})=>p===n);return c?c.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const c={},p=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in n){const b=this._featuresetSelectors[x]=[];for(const E of n[x].selectors){if(E.featureNamespace){const M=this.getOwnLayer(E.layer);if(!M){s.w(`Layer is undefined for selector: ${E.layer}`);continue}const z=p(M.source,M.sourceLayer);if(z in c&&c[z]!==E.featureNamespace){s.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[z]=E.featureNamespace}let I;if(E.properties)for(const M in E.properties){const z=s.U(E.properties[M]);z.result==="success"&&(I=I||{},I[M]=z.value)}b.push({layerId:E.layer,namespace:E.featureNamespace,properties:I,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const c=this.getFragmentStyle(n);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(n,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const E of x[n].selectors){const I=p.getOwnLayer(E.layer);I&&b.push(I)}return b}getConfigProperty(n,c){const p=this.getFragmentStyle(n);if(!p)return null;const x=s.B(c,p.scope),b=p.options.get(x),E=b?b.value||b.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,c){const p=s.B(n,c);return this._mergedIndoor[p]}setIndoorData(n,c){this.indoorManager.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,c,p){const x=this.getFragmentStyle(n);if(!x)return;const b=x.stylesheet.schema;if(!b||!b[c])return;const E=s.U(p);if(E.result!=="success")return void uc(this,E.value);const I=E.value.expression,M=s.B(c,x.scope),z=x.options.get(M);if(!z)return;let O;const{minValue:H,maxValue:G,stepValue:$,type:J,values:Y}=b[c],ee=s.U(b[c].default);ee.result==="success"&&(O=ee.value.expression),O?(this.options.set(M,Object.assign({},z,{value:I,default:O,minValue:H,maxValue:G,stepValue:$,type:J,values:Y})),this.updateConfigDependencies(c)):this.fire(new s.y(new Error(`No schema defined for the config option "${c}" in the "${n}" fragment.`)))}getConfig(n){const c=this.getFragmentStyle(n);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const b in p){const E=s.B(b,c.scope),I=c.options.get(E),M=I?I.value||I.default:null;x[b]=M?M.serialize():null}return x}setConfig(n,c){const p=this.getFragmentStyle(n);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const c=this.getFragmentStyle(n);return c?c.stylesheet.schema:null}setSchema(n,c){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(n,c){if(this._config=n,n||c)if(c)for(const p in c){let x,b;const E=s.U(c[p].default);if(E.result==="success"&&(x=E.value.expression),n&&n[p]!==void 0){const G=s.U(n[p]);G.result==="success"&&(b=G.value.expression)}const{minValue:I,maxValue:M,stepValue:z,type:O,values:H}=c[p];if(x){const G=s.B(p,this.scope);this.options.set(G,{default:x,value:b,minValue:I,maxValue:M,stepValue:z,type:O,values:H})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,c=()=>!0){for(const p of n){const x=this.getLayer(p);x&&c(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,c=>!n||c.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,c,p={}){this._checkLoaded();const x=n.id;if(this._layers[x])return void this.fire(new s.y(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if(uc(this,s.dt(n)))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=s.dp(n),n=Object.assign(n,{source:x})),this._validate(Ue,`layers.${x}`,n,{arrayIndex:-1},p))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}const E=s.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let I=this._order.length;if(c){const H=this._order.indexOf(c);if(H===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));b.slot&&b.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):I=H}this._order.splice(I,0,x),this._handleLayerOrderChange(),this._layers[x]=b;const M=this.getOwnLayerSourceCache(b),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&b.canCastShadows()&&z&&(M.castsShadows=!0);const O=this._changes.getRemovedLayer(b);if(O&&b.source&&M&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const H=s.B(b.source,b.scope);O.type!==b.type?this._changes.updateSourceCache(H,"clear"):(this._changes.updateSourceCache(H,"reload"),M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,c){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===c)return;const x=this._order.indexOf(n);this._order.splice(x,1);let b=this._order.length;if(c){const E=this._order.indexOf(c);if(E===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot&&p.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):b=E}this._order.splice(b,0,n),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(n){this._checkLoaded();const c=this._checkLayer(n);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let b=!1;for(const E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){b=!0;break}x.castsShadows=b}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,p){this._checkLoaded();const x=this._checkLayer(n);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,c){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(n,c,p={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!s.by(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ne,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=s.dp(c),this._updateLayer(x)))}getFilter(n){const c=this._checkLayer(n);if(c)return s.dp(c.filter)}setLayoutProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.by(b.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&uc(b,ye.call(ja,{key:`layers.${n}.layout.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(c,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);b&&(c==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(c)?this.setPaintProperty(n,c,p,x):this.setLayoutProperty(n,c,p,x))}getLayoutProperty(n,c){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(c)}setPaintProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.by(b.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&uc(b,ae.call(ja,{key:`layers.${n}.paint.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:s.a6})))return;const E=b.setPaintProperty(c,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,c){const p=this._checkLayer(n);if(p)return p.getPaintProperty(c)}setFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:M,importId:z}=n.target,O=this.getFragmentStyle(z),H=O.getFeaturesetLayers(M);for(const{source:G,sourceLayer:$}of H)O.setFeatureState({id:n.id,source:G,sourceLayer:$},c)}else if("layerId"in n.target){const{layerId:M}=n.target,z=this.getLayer(M);this.setFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=n.source,x=n.sourceLayer,b=this._checkSource(p);if(!b)return;const E=b.type;if(E==="geojson"&&x)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const M of I)M.setFeatureState(x,n.id,c)}removeFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:M,importId:z}=n.target,O=this.getFragmentStyle(z),H=O.getFeaturesetLayers(M);for(const{source:G,sourceLayer:$}of H)O.removeFeatureState({id:n.id,source:G,sourceLayer:$},c)}else if("layerId"in n.target){const{layerId:M}=n.target,z=this.getLayer(M);this.removeFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=n.source,x=this._checkSource(p);if(!x)return;const b=x.type,E=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const M of I)M.removeFeatureState(E,n.id,c)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:E,importId:I}=n.target,M=this.getFragmentStyle(I),z=M.getFeaturesetLayers(E);for(const{source:O,sourceLayer:H}of z){const G=M.getFeatureState({id:n.id,source:O,sourceLayer:H});if(G&&!b)b=G;else if(!s.by(b,G))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:E}=n.target,I=this.getLayer(E);b=this.getFeatureState({id:n.id,source:I.source,sourceLayer:I.sourceLayer})}return b}const c=n.source,p=n.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),c=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const c of Object.values(this._mergedLayers))n(c)&&this._updateLayer(c)}_updateLayer(n){this._changes.updateLayer(n);const c=this.getLayerSourceCache(n),p=s.B(n.source,n.scope),x=this._changes.getUpdatedSourceCaches();n.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,x={},b=[];for(let I=p.length-1;I>=0;I--){const M=p[I];if(c(M)){x[M]=I;for(const z of n){const O=z[M];if(O)for(const H of O)b.push(H)}}}b.sort((I,M)=>M.intersectionZ-I.intersectionZ);const E=[];for(let I=p.length-1;I>=0;I--){const M=p[I];if(c(M))for(let z=b.length-1;z>=0;z--){const O=b[z].feature;if(O.layer&&x[O.layer.id]<I)break;E.push(O),b.pop()}else for(const z of n){const O=z[M];if(O)for(const H of O)E.push(H.feature)}}return E}queryRasterValue(n,c,p){const x=this.getOwnSource(n);return x?x.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(c,p):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const b={},E=O=>{if(Rp.has(O.type))return;const H=this.getOwnLayerSourceCache(O),G=b[H.id]=b[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};O.is3D(!!this.terrain)&&(G.has3DLayers=!0),G.layers[O.fqid]=G.layers[O.fqid]||{styleLayer:O,targets:[]},G.layers[O.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const O of c.layers){const H=this._layers[O];if(!H)return this.fire(new s.y(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];E(H)}}else for(const O in this._layers)E(this._layers[O]);const I=this._queryRenderedFeatures(n,b,p),M=this._flattenAndSortRenderedFeatures(I),z=[];for(const O of M)s.dw(O.layer.id)===this.scope&&z.push(O);return z}queryRenderedFeatureset(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const b="mock",E=[];if(c&&c.target)E.push(Object.assign({},c,{targetId:b,filter:x}));else{const O=this.getFeaturesetDescriptors();for(const H of O)E.push({targetId:b,filter:x,target:H});for(const{style:H}of this.fragments){const G=H.getFeaturesetDescriptors();for(const $ of G)E.push({targetId:b,filter:x,target:$})}}const I=this.queryRenderedTargets(n,E,p),M=[],z=new Set;for(const O of I)for(const H of O.variants[b])dl(H,O,z)||M.push(new s.dx(O,H));return M}queryRenderedTargets(n,c,p){const x={},b=(I,M,z,O)=>{const H=x[M.id]=x[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(H.layers[I.fqid]=H.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(H.has3DLayers=!0),!O)return z.uniqueFeatureID=!1,void H.layers[I.fqid].targets.push(z);H.layers[I.fqid].targets.push(Object.assign({},z,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const I of c)if("featuresetId"in I.target){const{featuresetId:M,importId:z}=I.target,O=this.getFragmentStyle(z);if(!O||!O._featuresetSelectors)continue;const H=O._featuresetSelectors[M];if(!H){this.fire(new s.y(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const G of H){const $=O.getOwnLayer(G.layerId);$&&!Rp.has($.type)&&b($,O.getOwnLayerSourceCache($),I,G)}}else if("layerId"in I.target){const{layerId:M}=I.target,z=this.getLayer(M);if(!z||Rp.has(z.type))continue;b(z,this.getLayerSourceCache(z),I)}const E=this._queryRenderedFeatures(n,x,p);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(n,c,p){const x=[],b=!!this.map._showQueryGeometry,E=Ei.createFromScreenPoints(n,p);for(const I in c){const M=ga(E,c[I],this._availableImages,p,b,this.getActualScope());Object.keys(M).length&&x.push(M)}if(this.placement)for(const I in c){if(!c[I].sourceCache._onlySymbols)continue;const M=pf(E.screenGeometry,c[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&x.push(M)}return x}querySourceFeatures(n,c){const p=c&&c.filter;p&&this._validate(ne,"querySourceFeatures.filter",p,null,c);let x=[];const b=this.getOwnSourceCaches(n);for(const E of b)x=x.concat(td(E,c));return x}addSourceType(n,c,p){return $a.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):($a.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,c,p={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const I in n)if(!s.by(n[I],x[I])){b=!0;break}if(!b)return;const E=this._getTransitionParameters();this.light.setLight(n,c,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,c=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const x=!("source"in n)||n.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=s.dp(p),p=Object.assign(p,{source:I})}const b=Object.assign({},p),E={};if(this.terrain&&x){b.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(E.style=I.serialize())}if(this._validate(no,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new s.z("data",{dataType:"style"}))}else{const b=this.terrain,E=b.get();for(const I of Object.keys(s.a6.terrain))!p.hasOwnProperty(I)&&s.a6.terrain[I].default&&(p[I]=s.a6.terrain[I].default);for(const I in n)if(!s.by(n[I],E[I])){b.set(n,this.options),this.stylesheet.terrain=n;const M=this._getTransitionParameters({duration:0});b.updateTransitions(M),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Pn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(n){const c=this.snow=new br(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(n){const c=this.rain=new ir(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),n()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,c){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const p=this.terrain=new It(n,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,p,x,b={}){if(b&&b.validate===!1)return!1;const E=Object.assign({},this.serialize());return uc(this,n.call(ja,Object.assign({key:c,style:E,value:p,styleSpec:s.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const c=this.getSourceCaches(n);for(const p of c)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];c._clear&&c._clear()}}reloadSource(n){const c=this.getSourceCaches(n);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let c;this.directionalLight&&(c=Ap(this.directionalLight));const p=new Set,x=new Set;for(const b in this._mergedLayers){const E=this._mergedLayers[b];E.type==="building"&&p.add(E.source),E.hasElevation()&&!x.has(E.source)&&x.add(E.source)}for(const b in this._mergedSourceCaches){const E=this._mergedSourceCaches[b],I=x.has(E._source.id);p.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(n,void 0,void 0,c,I)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new $m),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(n,c,p,x,b){this.pauseablePlacement||(this.pauseablePlacement=new $m);let E=!1,I=!1;const M={},z={};for(const Y of this._mergedOrder){const ee=this._mergedLayers[Y];if(ee.type!=="symbol")continue;const re=s.B(ee.source,ee.scope);let pe=M[re];if(!pe){const ue=this.getLayerSourceCache(ee);if(!ue)continue;const Ie=ue.getRenderableIds(!0).map(Te=>ue.getTileByID(Te));z[re]=Ie.slice(),pe=M[re]=Ie.sort((Te,Ae)=>Ae.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(Ae.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(ee,pe,n.center.lng,n.projection);E=E||fe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const O=!!(this.placement&&!n.equals(this.placement.transform)),H=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!b||this.placement.lastReplacementSourceUpdateTime!==b.updateTime)),G=O||H||E,$=(G||this.pauseablePlacement.isStale())&&p===0,J=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),n.zoom)&&p!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||$||J)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(n,this._mergedOrder,c,p,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?G&&p!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),E&&this.pauseablePlacement.setStale()),I||E){this._buildingIndex.onNewFrame(n.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const ee=this._mergedLayers[this._mergedOrder[Y]];if(ee.type!=="symbol"||ee.visibility==="none")continue;const re=this.isLayerClipped(ee);this.placement.updateLayerOpacities(ee,M[s.B(ee.source,ee.scope)],Y,re?b:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!c)return p.push(n),this._loadImports([n],!0);const x=p.findIndex(({id:b})=>b===c);return x===-1&&this.fire(new s.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(n).concat(p.slice(x)),this._loadImports([n],!0,c)}updateImport(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);return x===-1?this:typeof c=="string"?(this.setImportUrl(n,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(n,c.url),s.by(c.config,p[x].config)||this.setImportConfig(n,c.config,c.data.schema),s.by(c.data,p[x].data)||this.setImportData(n,c.data),this)}moveImport(n,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(n);if(x===-1)return this;const b=this.getImportIndex(c);if(b===-1)return this;const E=p[x],I=this.fragments[x];return p=p.filter(({id:M})=>M!==n),this.fragments=this.fragments.filter(({id:M})=>M!==n),this.stylesheet.imports=p.slice(0,b).concat(E).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(I).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);if(x===-1)return this;p[x].url=c;const b=this.fragments[x];return b.style=this._createFragmentStyle(p[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(c),this}setImportData(n,c){this._checkLoaded();const p=this.getImportIndex(n),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(n,x[p].url))}setImportConfig(n,c,p){this._checkLoaded();const x=this.getImportIndex(n),b=this.stylesheet.imports||[];if(x===-1)return this;c?b[x].config=c:delete b[x].config;const E=this.fragments[x];p&&E.style.stylesheet&&(E.style.stylesheet.schema=p);const I=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=c,E.style.updateConfig(c,I),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return c===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),c}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&n.push(p.getSource())}return n}getSource(n,c){const p=this.getSourceCache(n,c);return p&&p.getSource()}getLayerSource(n){const c=this.getLayerSourceCache(n);return c&&c.getSource()}getSourceCache(n,c){const p=s.B(n,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const c=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[n]&&c.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&c.push(this._mergedSymbolSourceCaches[n]),c}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const c in n){const p=n[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(n){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=E=>{if(E){const I=c.images.map(M=>s.I.toString(M));E.setDependencies(c.tileID.key,c.type,I)}},b=s.B(c.source,c.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b]),c.images.some(E=>E.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(n,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(n,c,p){return s.dz(c,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this.getOwnSourceCaches(n);return c.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,c){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),x=n.type==="building";if(n.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}$a.getSourceType=function(f){return $o[f]},$a.setSourceType=function(f,n){$o[f]=n},$a.registerForPluginStateChange=s.dA;var Qo=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ld=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ma=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,zl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,uh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Za=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,hh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Dp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,cd=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const hc=/#include\s+"([^"]+)"/g,dc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,lo=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Gc=new Set(["ifdef","ifndef","elif","if","defined"]),co=new Set;oa(Qo,co),oa(Ma,co),oa(ld,co);const qc={"_prelude_fog.vertex.glsl":uh,"_prelude_terrain.vertex.glsl":xf,"_prelude_shadow.vertex.glsl":Dp,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Za,"_prelude_shadow.fragment.glsl":cd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":hh,"_prelude_raster_particle.glsl":jt},dh={};si("",xf),si(Za,uh),si(cd,Dp),si(hh,""),si(jt,"");const wu=si(ld,Ma),ud=Qo,w_=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",ud,wu.fragmentSource].join(`
`),Pp=["precision highp float;",ud,wu.vertexSource].join(`
`);var kp={background:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:si(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:si(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:si(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:si(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:si(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:si(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:si(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:si(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:si(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:si(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zl),skyboxGradient:si(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zl),skyboxCapture:si(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:si(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:si(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:si("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:si("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:si("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:si("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function oa(f,n){const c=f.split(`
`);for(let p of c){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const x=p.match(lo);if(x)for(const b of x)Gc.has(b)||n.add(b)}}function si(f,n){const c=new Set,p=[],x=[];f=f.replace(hc,(E,I)=>(x.push(I),"")),n=n.replace(hc,(E,I)=>(p.push(I),""));let b=new Set(co);oa(f,b),oa(n,b);for(const E of[...p,...x])dh[E]||(dh[E]=new Set,oa(qc[E],dh[E])),b=new Set([...b,...dh[E]]);return{fragmentSource:f=f.replace(dc,(E,I,M,z,O)=>(c.add(O),I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${M} ${z} ${O};
#else
uniform ${M} ${z} u_${O};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${M} ${z} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${M} ${z} ${O};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(dc,(E,I,M,z,O)=>{const H=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,G=z==="float"?"vec2":z,$=`GET_ATTRIBUTE_${G}(a_${O}, materialInfo, ${H})`,J=O.match(/color/)?"color":G;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${M} ${z} a_${O};
#endif
`:c.has(O)?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${H})
        in ${M} ${G} a_${O};
    #endif
out ${M} ${z} ${O};
#else
uniform ${M} ${z} u_${O};
#endif
`:I==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${M} ${z} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O})
    #ifdef ${H}
        ${O} = unpack_mix_${J}(${$}, u_${O}_t);
    #else
        ${O} = unpack_mix_${J}(a_${O}, u_${O}_t);
    #endif
#else
    ${M} ${z} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${M} ${z} a_${O};
    out ${M} ${z} ${O};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${H})
        in ${M} ${G} a_${O};
    #endif
#else
uniform ${M} ${z} u_${O};
#endif
`:I==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${M} ${z} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${G} a_${O};
#else
uniform ${M} ${z} u_${O};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${M} ${z} ${O} = a_${O};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${H}
        ${M} ${z} ${O} = ${$};
    #else
        ${M} ${z} ${O} = a_${O};
    #endif
#else
    ${M} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${H}
        ${M} ${z} ${O} = unpack_mix_${J}(${$}, u_${O}_t);
    #else
        ${M} ${z} ${O} = unpack_mix_${J}(a_${O}, u_${O}_t);
    #endif
#else
    ${M} ${z} ${O} = u_${O};
#endif
`}),usedDefines:b,vertexIncludes:p,fragmentIncludes:x}}class hd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,p,x,b,E,I,M){this.context=n;let z=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!z&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&(z=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let H=0;!O&&H<I.length;H++)this.boundDynamicVertexBuffers[H]!==I[H]&&(O=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||z||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(c,p,x,b,E,I,M);else{n.bindVertexArrayOES.set(this.vao);for(const H of I)H&&(H.bind(),M&&H.instanceCount&&H.setVertexAttribDivisor(n.gl,c,M));b&&b.dynamicDraw&&b.bind()}}freshBind(n,c,p,x,b,E,I){const M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,c.enableAttributes(z,n),c.bind(),c.setVertexAttribPointers(z,n,b);for(const O of p)O.enableAttributes(z,n),O.bind(),O.setVertexAttribPointers(z,n,b);for(const O of E)O&&(O.enableAttributes(z,n),O.bind(),O.setVertexAttribPointers(z,n,b),I&&O.instanceCount&&O.setVertexAttribDivisor(z,n,I));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Lp(f,n){const c=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ae(0,p/c).toLngLat().lat,new s.ae(0,(p+1)/c).toLngLat().lat]}function vf(f,n,c,p,x,b,E){const I=f.context,M=I.gl,z=c.hillshadeFBO;if(!z)return;f.prepareDrawTile();const O=f.isTileAffectedByFog(n),H=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&H.push("USE_MRT1");const G=f.getOrCreateProgram("hillshade",{overrideFog:O,defines:H});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment0.get());const $=((re,pe,fe,ue)=>{const Ie=fe.paint.get("hillshade-shadow-color"),Te=fe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=fe.paint.get("hillshade-highlight-color"),ve=fe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=fe.paint.get("hillshade-accent-color"),Pe=fe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Le=fe.paint.get("hillshade-emissive-strength");let Fe=s.an(fe.paint.get("hillshade-illumination-direction"));if(fe.paint.get("hillshade-illumination-anchor")==="viewport")Fe-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const $e=re.style.directionalLight.properties.get("direction"),lt=s.d4($e.x,$e.y,$e.z);Fe=s.an(lt[1])}const We=!re.options.moving;return{u_matrix:ue||re.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),We),u_image:0,u_latrange:Lp(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),Fe],u_shadow:Ie.toPremultipliedRenderColor(Te?null:fe.lut),u_highlight:Ae.toPremultipliedRenderColor(ve?null:fe.lut),u_emissive_strength:Le,u_accent:ge.toPremultipliedRenderColor(Pe?null:fe.lut)}})(f,c,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(I,G,n.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:Y,tileBoundsSegments:ee}=f.getTileBoundsBuffers(c);G.draw(f,M.TRIANGLES,x,b,E,Rn.disabled,$,p.id,J,Y,ee)}function zo(f,n,c){if(!n.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const b=c.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(p,b,x.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ml(f,n,c){const p=f.context,x=p.gl;if(!n.dem)return;const b=n.dem;if(p.activeTexture.set(x.TEXTURE1),zo(f,n,b),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=b.dim;p.activeTexture.set(x.TEXTURE0);let I=n.hillshadeFBO;if(!I){const G=new s.T(p,{width:E,height:E,data:null},x.RGBA8);G.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=n.hillshadeFBO=p.createFramebuffer(E,E,1,"renderbuffer"),I.colorAttachment0.set(G.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:z,tileBoundsSegments:O}=f.getMercatorTileBoundsBuffers(),H=[];f.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&H.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(f,x.TRIANGLES,mn.disabled,Ln.disabled,zn.unblended,Rn.disabled,((G,$)=>{const J=$.stride,Y=s.bC();return s.ce(Y,0,s.al,-s.al,0,0,1),s.br(Y,Y,[0,-s.al,0]),{u_matrix:Y,u_image:1,u_dimension:[J,J],u_zoom:G.overscaledZ}})(n.tileID,b),c.id,M,z,O),n.needsHillshadePrepare=!1}class Hi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fc extends Hi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ol extends Hi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Nl extends Hi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class bf extends Hi{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class wf extends Hi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Hc extends Hi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class fh extends Hi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class js extends Hi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Gr extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class pr extends Hi{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class pc extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Jo extends Hi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Tu extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Bl extends Hi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Tf extends Hi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zp extends Hi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class $c extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Fl extends Hi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Op extends Hi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let dd=class extends Hi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Np extends Hi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class gl extends Hi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class mc extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Eu extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Zc extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ym extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ef extends Hi{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Su extends Hi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class fd extends Hi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Wc extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ba extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ph extends Hi{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Sf extends ph{constructor(n,c,p=0){super(n,c),this.attachmentPoint=n.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class pd extends ph{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Af extends ph{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class T_ extends pd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ar=(f,n,c,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:n,u_ground_shadow_factor:c,u_emissive_texture_available:p}),md=(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:z,u_globe_pos:O,u_globe_radius:H,u_viewport:G,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:J,u_emissive_texture_available:Y});function Xc(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const el=new class{constructor(){this.operations={}}newMorphing(f,n,c,p,x){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},gd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Yc(f,n,c){if(n===0)return 0;const p=n<1&&c===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Au(f,n){const c=1<<f.z;return!n&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}function _d(f,n){if(!f.style||!f.style.enable3dLights())return;const c=f.context,p=c.gl;c.activeTexture.set(p.TEXTURE1),n?n.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const yd=f=>({u_matrix:f});function If(f,n,c,p,x){if(x>0){const b=s.o.now(),E=(b-f.timeAdded)/x,I=n?(b-n.timeAdded)/x:-1,M=c.getSource(),z=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),H=O&&f.refreshedUponExpiration?1:s.aA(O?E:1-I,0,1);return n?{opacity:1,mix:1-H,isFading:E<1}:{opacity:H,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class Cf extends us{constructor(n){const c=To("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Kc extends us{constructor(n){const c=To("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,p){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const I=new Ao(E,this._source.tileSize*E.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[E.key]=I}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rf extends s.aQ{constructor(n,c,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class xd extends s.bV{constructor(n,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,b]=(function(){const M=new s.bd,z=new s.b0,O=131;M.reserve(17161),z.reserve(33800);const H=s.al/128,G=s.al+H/2,$=G+H;for(let Y=-H;Y<$;Y+=H)for(let ee=-H;ee<$;ee+=H){const re=ee<0||ee>G||Y<0||Y>G?24575:0,pe=s.aA(Math.round(ee),0,s.al),fe=s.aA(Math.round(Y),0,s.al);M.emplaceBack(pe+re,fe)}const J=(Y,ee)=>{const re=ee*O+Y;z.emplaceBack(re+1,re,re+O),z.emplaceBack(re+O,re+O+1,re+1)};for(let Y=1;Y<129;Y++)for(let ee=1;ee<129;ee++)J(ee,Y);return[0,129].forEach(Y=>{for(let ee=0;ee<130;ee++)J(ee,Y),J(Y,ee)}),[M,z,32768]})(),E=n.context;this.gridBuffer=E.createVertexBuffer(p,s.bf.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=s.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Kc(c.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=E.gl;this._overlapStencilMode=new Ln({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cf(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const x=n.terrain.properties,b=n.terrain.drapeRenderMode===0,E=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=n.terrain&&n.terrain.scope,M=x.get("source"),z=b?this._mockSourceCache:n.getSourceCache(M,I);if(!z)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=z,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(c,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const c=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=n.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let I=b-this._previousZoom;const M=this._previousUpdateTimestamp;let z=b;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(b-z)>.5&&(I=.5*(b-z+I)),I*x<0&&(z+=I)),this._evaluationZoom=z;const O=E.getExaggeration(z),H=O===E.getExaggeration(Math.max(0,z-.1));if(H&&Math.abs(O-this._exaggeration)<.01)return O;let G=Math.min(.1,.00375*(this._updateTimestamp-M));return(H||O<.1||Math.abs(I)<1e-4)&&(G=Math.min(.2,4*G)),s.ak(this._exaggeration,O,G)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(M=>{const z=c.getTileByID(M).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(M,z){const O=z.transform.pointCoordinate(z.transform.getCameraPoint()),H=new s.P(O.x,O.y);M.sort((G,$)=>{if($.overscaledZ-G.overscaledZ)return $.overscaledZ-G.overscaledZ;const J=new s.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Y=new s.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ee=H.mult(1<<G.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(J)-ee.distSqr(Y)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const M in E){const z=E[M];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[M],b),z.usedForTerrain))continue;const O=n[M];z.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=x.map(M=>new Rf(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const z=this.terrainTileForTile[M.key];if(!z)continue;const O=z.tileID.key;O in I||(this._visibleDemTiles.push(z),I[O]=O)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),zo(this.painter,x,b))}}_prepareDemTileUniforms(n,c,p,x){if(!c||c.demTexture==null)return!1;const b=n.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-b.z),I=x||"";return p[`u_dem_tl${I}`]=[b.x*E%1,b.y*E%1],p[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const b=x.dem.tree.minimums[0];return b>0&&n++,p+b},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new s.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,x,c.R32F,{premultiply:!1}),b}setupElevationDraw(n,c,p){const x=this.painter.context,b=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let I=null,M=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const $=p.morphing.srcDemTile,J=p.morphing.dstDemTile;z=p.morphing.phase,$&&J&&(this._prepareDemTileUniforms(n,$,E,"_prev")&&(M=$),this._prepareDemTileUniforms(n,J,E)&&(I=J))}const O=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let H=null;var G;if(this.enabled?M&&I?(H=I.demTexture,x.activeTexture.set(b.TEXTURE4),M.demTexture.bind(O(M),b.CLAMP_TO_EDGE),E.u_dem_lerp=z):(I=this.terrainTileForTile[n.tileID.key],H=this._prepareDemTileUniforms(n,I,E)?I.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),H&&(E.u_dem_size=(G=H).size[0]===1?1:G.size[0]-2,H.bind(O(I),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,E),p&&p.useMeterToDem&&I){const $=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=$}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,$)}}globeUniformValues(n,c,p){const x=n.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,s.al,0),u_tile_br_up:x.upVector(c,s.al,s.al),u_tile_bl_up:x.upVector(c,0,s.al),u_tile_up_scale:p?s.dM(1):x.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,b,E,I,M){if(x.transform.projection.name==="globe")(function(z,O,H,G,$){const J=z.context,Y=J.gl;let ee,re;const pe=z.transform,fe=s.dE(z,J,pe),ue=(We,$e)=>{if(re===$e)return;const lt=[gd[$e],"PROJECTION_GLOBE_VIEW"];fe&&lt.push("CUSTOM_ANTIALIASING");const xt=z.isTileAffectedByFog(We);ee=z.getOrCreateProgram("globeRaster",{defines:lt,overrideFog:xt}),re=$e},Ie=z.colorModeForRenderPass(),Te=new mn(Y.LEQUAL,mn.ReadWrite,z.depthRangeFor3D);el.update($);const Ae=s.dF(pe),ve=[s.aF(pe.center.lng),s.aJ(pe.center.lat)],ge=z.globeSharedBuffers,Pe=[pe.width*s.o.devicePixelRatio,pe.height*s.o.devicePixelRatio],Le=Float32Array.from(pe.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};{const We=z.transform,$e=Yc(We.zoom,O.exaggeration(),O.sourceCache._source.tileSize);re=-1;const lt=Y.TRIANGLES;for(const xt of G){const Qe=H.getTile(xt),ke=Ln.disabled,mt=O.prevTerrainTileForTile[xt.key],nt=O.terrainTileForTile[xt.key];Xc(mt,nt)&&el.newMorphing(xt.key,mt,nt,$,250),_d(z,Qe.emissiveTexture),J.activeTexture.set(Y.TEXTURE0),Qe.texture&&Qe.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const yt=el.getMorphValuesForProxy(xt.key),Pt=yt?1:0;yt&&Object.assign(Fe,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:s.dD(yt.phase)}});const qt=s.dG(xt.canonical),zt=s.dH(qt.getCenter().lat),kt=s.dI(xt.canonical,qt,zt,We.worldSize/We._pixelsPerMercatorPixel),cn=s.bk(s.dJ(xt.canonical)),an=z.emissiveMode==="mrt-fallback"?1:0,$t=md(We.expandedFarZProjMatrix,Le,Ae,cn,s.aj(We.zoom),ve,We.frustumCorners.TL,We.frustumCorners.TR,We.frustumCorners.BR,We.frustumCorners.BL,We.globeCenterInViewSpace,We.globeRadius,Pe,$e,We._farZ,an,kt);if(ue(xt,Pt),ee&&(O.setupElevationDraw(Qe,ee,Fe),z.uploadCommonUniforms(J,ee,xt.toUnwrapped()),ge)){const[on,xn,Mn]=ge.getGridBuffers(zt,$e!==0);ee.draw(z,lt,Te,ke,Ie,Rn.backCCW,$t,"globe_raster",on,xn,Mn)}}}if(ge&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&We.push("CUSTOM_ANTIALIASING"),ee=z.getOrCreateProgram("globeRaster",{defines:We});for(const $e of G){const{x:lt,y:xt,z:Qe}=$e.canonical,ke=xt===0,mt=xt===(1<<Qe)-1,[nt,yt,Pt,qt]=ge.getPoleBuffers(Qe,!1);if(qt&&(ke||mt)){const zt=H.getTile($e);_d(z,zt.emissiveTexture),J.activeTexture.set(Y.TEXTURE0),zt.texture&&zt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let kt=s.dK(Qe,lt,pe);const cn=s.bk(s.dJ($e.canonical)),an=z.emissiveMode==="mrt-fallback"?1:0,$t=(on,xn)=>on.draw(z,Y.TRIANGLES,Te,Ln.disabled,Ie,Rn.disabled,md(pe.expandedFarZProjMatrix,kt,kt,cn,0,ve,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Pe,0,pe._farZ,an),"globe_pole_raster",xn,Pt,qt);O.setupElevationDraw(zt,ee,Fe),z.uploadCommonUniforms(J,ee,$e.toUnwrapped()),ke&&z.renderDefaultNorthPole&&$t(ee,nt),mt&&z.renderDefaultSouthPole&&(kt=s.cS(s.bC(),kt,[1,-1,1]),$t(ee,yt))}}}})(x,b,E,I,M);else{const z=x.context,O=z.gl;let H,G;const $=x.shadowRenderer,J=Yo(x,x.longestCutoffRange),Y=Ie=>{if(G===Ie)return;const Te=[];Te.push(gd[Ie]),J.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),$&&(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&Te.push("NORMAL_OFFSET")),H=x.getOrCreateProgram("terrainRaster",{defines:Te}),G=Ie},ee=x.colorModeForRenderPass(),re=new mn(O.LEQUAL,mn.ReadWrite,x.depthRangeFor3D);el.update(M);const pe=x.transform,fe=Yc(pe.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ue=[0,0,0];if($){const Ie=x.style.directionalLight,Te=x.style.ambientLight;Ie&&Te&&(ue=Ha(x.style,Ie,Te))}{G=-1;const Ie=O.TRIANGLES,[Te,Ae]=[b.gridIndexBuffer,b.gridSegments];for(const ve of I){const ge=E.getTile(ve),Pe=Ln.disabled,Le=b.prevTerrainTileForTile[ve.key],Fe=b.terrainTileForTile[ve.key];Xc(Le,Fe)&&el.newMorphing(ve.key,Le,Fe,M,250),_d(x,ge.emissiveTexture),z.activeTexture.set(O.TEXTURE0),ge.texture&&ge.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const We=el.getMorphValuesForProxy(ve.key),$e=We?1:0;let lt;We&&(lt={morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:s.dD(We.phase)}});const xt=x.emissiveMode==="mrt-fallback"?1:0,Qe=Ar(ve.projMatrix,Au(ve.canonical,pe.renderWorldCopies)?fe/10:fe,ue,xt);if(Y($e),!H)continue;b.setupElevationDraw(ge,H,lt);const ke=ve.toUnwrapped();$&&$.setupShadows(ke,H),x.uploadCommonUniforms(z,H,ke,null,J),H.draw(x,Ie,re,Pe,ee,Rn.backCCW,Qe,"terrain_raster",b.gridBuffer,Te,Ae)}}}})(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),I=c.style.order,M=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let z=0;for(const O of b){const H=x.getTileByID(O.proxyTileKey),G=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][n]:void 0,$=G!==void 0?x.renderCache[G]:this.pool[z++],J=G!==void 0;if(H.texture=$.tex,H.emissiveTexture=$.emissiveTex,J&&!$.dirty){M.push(H.tileID);continue}p.bindFramebuffer.set($.fb.framebuffer);const Y=p.gl;let ee;Y.drawBuffers(c.emissiveMode==="mrt-fallback"?[Y.COLOR_ATTACHMENT0,Y.COLOR_ATTACHMENT1]:[Y.COLOR_ATTACHMENT0]),this.renderedToTile=!1,$.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),$.dirty=!1);for(let re=E.start;re<=E.end;++re){const pe=c.style._mergedLayers[I[re]];if(pe.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(pe),ue=fe?this.proxyToSource[O.key][fe.id]:[O];if(!ue)continue;const Ie=ue;p.viewport.set([0,0,$.fb.width,$.fb.height]),ee!==(fe?fe.id:null)&&(this._setupStencil($,ue,pe,fe),ee=fe?fe.id:null),c.renderLayer(c,fe,pe,Ie)}if(Y.drawBuffers([Y.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const pe=c.style._mergedLayers[I[re]];if(pe.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(pe),ue=fe?this.proxyToSource[O.key][fe.id]:[O];if(!ue)continue;const Ie=ue;p.viewport.set([0,0,$.fb.width,$.fb.height]),ee!==(fe?fe.id:null)&&(this._setupStencil($,ue,pe,fe),ee=fe?fe.id:null),c.renderLayer(c,fe,pe,Ie)}this.renderedToTile?($.dirty=!0,M.push(H.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(n){const c=n.order.length;let p=-1,x=c;for(let b=0;b<c;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?p=Math.max(p,b):x=Math.min(x,b);return x>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,I=1<<E.overscaledZ,{x:M,y:z}=E.canonical,O=M/I,H=(M+1)/I,G=z/I,$=(z+1)/I;return{minx:O,miny:G,maxx:H,maxy:$,t:b.dem.tree.raycastRoot(O,G,H,$,n,c,p),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,c,p);if(E!=null)return E}return null}_createFBO(){const n=this.painter.context,c=n.gl,p=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const x=new s.T(n,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=n.createFramebuffer(p[0],p[1],1,null);let E;return b.colorAttachment0.set(x.texture),this._emissiveTexture&&(E=new s.T(n,{width:p[0],height:p[1],data:null},c.R8),E.bind(c.LINEAR,c.CLAMP_TO_EDGE),b.createColorAttachment(n,1),b.colorAttachment1.set(E.texture)),b.depthAttachment=new T_(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,emissiveTex:E,dirty:!1}}_updateFBOs(n){if(this._emissiveTexture!==n){for(const c of this.pool)this._updateFBO(c,n);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,n);this._emissiveTexture=n}}_updateFBO(n,c){const p=n.fb,x=this.painter.context,b=x.gl,E=this.drapeBufferSize;if(c){const I=new s.T(x,{width:E[0],height:E[1],data:null},b.R8);I.bind(b.LINEAR,b.CLAMP_TO_EDGE),n.emissiveTex=I,p.createColorAttachment(x,1),p.colorAttachment1.set(I.texture)}else n.emissiveTex=void 0,p.removeColorAttachment(x,1);n.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._mergedLayers[n],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof ma){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(!b||c[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="line")continue;const E=x.widthExpression(),I=x.emissiveStrengthExpression();if(E instanceof s.ad||I instanceof s.ad){c[b.id]=!0;for(const M of this.proxyCoords){const z=this.proxyToSource[M.key][b.id];if(z)for(const O of z)this._clearRenderCacheForTile(b.id,O)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof _s){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(!b||c[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][b.id];if(M)for(const z of M){const O=If(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,E);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,c=n.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,b=0,E=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<c;)E=this._style._mergedLayers[n[b]];for(;b<c;++b){const I=this._style._mergedLayers[n[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(p.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:b-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<E.length;++I){const M=Object.values(E[I]);c.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const I=p[E];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const M=n[I.key],z=this.proxyToSource[I.key];let O=0;for(const H in z){const G=z[H],$=M[H];if(!$||$.length!==G.length||G.some((J,Y)=>J!==$[Y]||x[H]&&x[H].hasOwnProperty(J.key))){O=-1;break}++O}for(const H in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][H]].dirty=O<0||O!==Object.values(M).length}}const b=[...this._drapedRenderBatches];b.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of b)for(const I of p){if(c.proxyCachedFBO[I.key])continue;let M=c.renderCachePool.pop();M===void 0&&c.renderCache.length<50&&(M=c.renderCache.length,c.renderCache.push(this._createFBO())),M!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][E.start]=M,c.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Ln.disabled}_renderTileClippingMasks(n,c){const p=this.painter,x=this.painter.context,b=x.gl;p._tileClippingMaskIDs={},x.setColorMode(zn.disabled),x.setDepthMode(mn.disabled);const E=p.getOrCreateProgram("clippingMask");for(const I of n){const M=p._tileClippingMaskIDs[I.key]=--c;E.draw(p,b.TRIANGLES,mn.disabled,new Ln({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),zn.disabled,Rn.disabled,yd(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const p=[n.x,n.y,1,1];s.aC(p,p,c.pixelMatrixInverse),s.cK(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,b=s.cf(1,c.center.lat),E=[x[0],x[1],x[2]/b,0],I=s.da([],p.slice(0,3),E);s.aw(I,I);const M=this.raycast(E,I,this._exaggeration);return M!==null&&M?(s.bH(E,E,I,M),E[3]=E[2],E[2]*=b,E):null}_setupProxiedCoordsForOrtho(n,c,p){if(n.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(n,c,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const z=b[M],O=this._findTileCoveringTileID(z,n);if(O){const H=this._createProxiedId(z,O,p[z.key]&&p[z.key][n.id]);x.push(H),this.proxyToSource[z.key][n.id]=[H]}}let E=!1;const I=new Set;for(let M=0;M<c.length;M++){const z=n.getTile(c[M]);if(!z||!z.hasData())continue;const O=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==z.tileID.canonical.z){const H=this.proxyToSource[O.tileID.key][n.id],G=this._createProxiedId(O.tileID,z,p[O.tileID.key]&&p[O.tileID.key][n.id]);H?H.splice(H.length-1,0,G):this.proxyToSource[O.tileID.key][n.id]=[G];const $=this.proxyToSource[O.tileID.key][n.id];I.has($)||I.add($),x.push(G),E=!0}}if(this._sourceTilesOverlap[n.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const M of I)M.sort((z,O)=>O.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(n,c,p){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,E=n.getSource(),I=E.tileID;if(!I)return;const M=new s.P(I.x,I.y)._div(1<<I.z),z=E.coordinates.map(s.ae.fromLngLat).reduce((H,G)=>(H.min.x=Math.min(H.min.x,G.x-M.x),H.min.y=Math.min(H.min.y,G.y-M.y),H.max.x=Math.max(H.max.x,G.x-M.x),H.max.y=Math.max(H.max.y,G.y-M.y),H),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(H,G)=>{const $=H.wrap+H.canonical.x/(1<<H.canonical.z),J=H.canonical.y/(1<<H.canonical.z),Y=s.al/(1<<H.canonical.z),ee=G.wrap+G.canonical.x/(1<<G.canonical.z),re=G.canonical.y/(1<<G.canonical.z);return $+Y<ee+z.min.x||$>ee+z.max.x||J+Y<re+z.min.y||J>re+z.max.y};for(let H=0;H<b.length;H++){const G=b[H];for(let $=0;$<c.length;$++){const J=n.getTile(c[$]);if(!J||!J.hasData()||O(G,J.tileID))continue;const Y=this._createProxiedId(G,J,p[G.key]&&p[G.key][n.id]),ee=this.proxyToSource[G.key][n.id];ee?ee.push(Y):this.proxyToSource[G.key][n.id]=[Y],x.push(Y)}}}_createProxiedId(n,c,p){let x=this.orthoMatrix;if(p){const b=p.find(E=>E.key===c.tileID.key);if(b)return b}if(c.tileID.key!==n.key){const b=n.canonical.z-c.tileID.canonical.z;let E,I,M;x=s.bC();const z=c.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(E=s.al>>b,I=E*((c.tileID.canonical.x<<b)-n.canonical.x+z),M=E*((c.tileID.canonical.y<<b)-n.canonical.y)):(E=s.al<<-b,I=s.al*(c.tileID.canonical.x-(n.canonical.x+z<<-b)),M=s.al*(c.tileID.canonical.y-(n.canonical.y<<-b))),s.ce(x,0,E,0,E,0,1),s.br(x,x,[I,M,0])}return new Rf(c.tileID,n.key,x)}_findTileCoveringTileID(n,c){let p=c.getTile(n);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],b=x[n.key];if(p=b?c.getTileByID(b):null,p&&p.hasData()||b===null)return p;let E=p?p.tileID:n,I=E.overscaledZ;const M=c.getSource().minzoom,z=[];if(!b){const H=c.getSource().maxzoom;if(n.canonical.z>=H){const G=n.canonical.z-H;c.getSource().reparseOverscaled?(I=Math.max(n.canonical.z+2,c.transform.tileZoom),E=new s.aQ(I,n.wrap,H,n.canonical.x>>G,n.canonical.y>>G)):G!==0&&(I=H,E=new s.aQ(I,n.wrap,H,n.canonical.x>>G,n.canonical.y>>G))}E.key!==n.key&&(z.push(E.key),p=c.getTile(E))}const O=H=>{z.forEach(G=>{x[G]=H}),z.length=0};for(I-=1;I>=M&&(!p||!p.hasData());I--){p&&O(p.tileID.key);const H=E.calculateScaledKey(I);if(p=c.getTileByID(H),p&&p.hasData())break;const G=x[H];if(G===null)break;G===void 0?z.push(H):p=c.getTileByID(G)}return O(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[c.key]=!0}}function mh(f,n,c){const p=(function(I,M,z){const O=s.bJ(M,I),H=s.bJ(z,[.2126,.7152,.0722]),G=(J,Y,ee)=>(1-ee)*J+ee*Y,$=G(1-.3*Math.min(H,1),1,Math.min(O+1,1));return G(.92,1,Math.asin(s.aA(M[2],-1,1))/Math.PI+.5)*$})(f,[0,0,1],n),x=[0,0,0];s.c5(x,c.slice(0,3),p);const b=[0,0,0];s.c5(b,n.slice(0,3),f[2]);const E=[0,0,0];return s.d8(E,x,b),s.db(E)}const vd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Km=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Mf{static cacheKey(n,c,p,x){const b=[c];x&&b.push(x.cacheKey);for(const E of p)n.usedDefines.has(E)&&b.push(E);return b.join("/")}constructor(n,c,p,x,b,E){const I=n.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...E];const M=`#version 300 es
${(x?x.defines():[]).concat(E.map(Y=>`#define ${Y}`)).join(`
`)}`,z=[M,w_];for(const Y of p.fragmentIncludes)z.push(qc[Y]);z.push(p.fragmentSource);const O=z.join(`
`),H=[M,Pp];for(const Y of p.vertexIncludes)H.push(qc[Y]);this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&H.push("uniform int u_instanceID;"),H.push(p.vertexSource);let G=H.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const $=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource($,O),I.compileShader($),I.attachShader(this.program,$);const J=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(J,G),I.compileShader(J),I.attachShader(this.program,J),this.attributes={},I.linkProgram(this.program),I.deleteShader(J),I.deleteShader($),this.fixedUniforms=b(n),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=x?x.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new s.ch(Y)}))(n)),(E.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(Y=>({u_dem:new s.ch(Y),u_dem_prev:new s.ch(Y),u_dem_tl:new s.ck(Y),u_dem_scale:new s.cj(Y),u_dem_tl_prev:new s.ck(Y),u_dem_scale_prev:new s.cj(Y),u_dem_size:new s.cj(Y),u_dem_lerp:new s.cj(Y),u_exaggeration:new s.cj(Y),u_depth:new s.ch(Y),u_depth_size_inv:new s.ck(Y),u_depth_range_unpack:new s.ck(Y),u_occluder_half_size:new s.cj(Y),u_occlusion_depth_offset:new s.cj(Y),u_meter_to_dem:new s.cj(Y),u_label_plane_matrix_inv:new s.cl(Y)}))(n)),E.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new s.ci(Y),u_tile_tr_up:new s.ci(Y),u_tile_br_up:new s.ci(Y),u_tile_bl_up:new s.ci(Y),u_tile_up_scale:new s.cj(Y)}))(n)),E.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new s.cl(Y),u_fog_range:new s.ck(Y),u_fog_color:new s.d3(Y),u_fog_horizon_blend:new s.cj(Y),u_fog_vertical_limit:new s.ck(Y),u_fog_temporal_offset:new s.cj(Y),u_frustum_tl:new s.ci(Y),u_frustum_tr:new s.ci(Y),u_frustum_br:new s.ci(Y),u_frustum_bl:new s.ci(Y),u_globe_pos:new s.ci(Y),u_globe_radius:new s.cj(Y),u_globe_transition:new s.cj(Y),u_is_globe:new s.ch(Y),u_viewport:new s.ck(Y)}))(n)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new s.d3(Y)}))(n)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new s.ci(Y),u_lighting_directional_dir:new s.ci(Y),u_lighting_directional_color:new s.ci(Y),u_ground_radiance:new s.ci(Y)}))(n)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new s.cl(Y),u_light_matrix_1:new s.cl(Y),u_fade_range:new s.ck(Y),u_shadow_normal_offset:new s.ci(Y),u_shadow_intensity:new s.cj(Y),u_shadow_texel_size:new s.cj(Y),u_shadow_map_resolution:new s.cj(Y),u_shadow_direction:new s.ci(Y),u_shadow_bias:new s.ci(Y),u_shadowmap_0:new s.ch(Y),u_shadowmap_1:new s.ch(Y)}))(n)))}getAttributeLocation(n,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=n.getAttribLocation(this.program,c)),p}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(n,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(n,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(n,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(n,c,p,x,b,E,I,M,z,O){const H=n.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const G=n.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||n._terrain&&n._terrain.renderingToTexture||!vd.includes(this.name))||!(!H.layers3D||!Km.includes(this.name))))return;const $=G.gl,J=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,G);if(!J)return;const Y=[...this.fixedDefines,"DEBUG_WIREFRAME"],ee=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});G.program.set(ee.program);const re=(ue,Ie,Te)=>{if(Ie[ue]&&Te[ue])for(const Ae in Ie[ue])Te[ue][Ae]&&Te[ue][Ae].set(Te.program,Ae,Ie[ue][Ae].current)};z&&z.setUniforms(ee.program,G,ee.binderUniforms,I,{zoom:M}),re("fixedUniforms",this,ee),re("terrainUniforms",this,ee),re("globeUniforms",this,ee),re("fogUniforms",this,ee),re("lightsUniforms",this,ee),re("shadowUniforms",this,ee),J.bind(),G.setColorMode(new zn([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],s.ao.transparent,[!0,!0,!0,!1])),G.setDepthMode(new mn(c.func===$.LESS?$.LEQUAL:c.func,mn.ReadOnly,c.range)),G.setStencilMode(Ln.disabled);const pe=3*E.primitiveLength*2,fe=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ue=O||1;for(let Ie=0;Ie<ue;++Ie)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ie),$.drawElements($.LINES,pe,$.UNSIGNED_SHORT,fe)}else O&&O>1?$.drawElementsInstanced($.LINES,pe,$.UNSIGNED_SHORT,fe,O):$.drawElements($.LINES,pe,$.UNSIGNED_SHORT,fe);b.bind(),G.program.set(this.program),G.setDepthMode(c),G.setStencilMode(p),G.setColorMode(x)}checkUniforms(n,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${x} not set but required by ${c} being defined`)}}draw(n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee){const re=n.context,pe=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(p),re.setStencilMode(x),re.setColorMode(b),re.setCullFace(E);for(const[ve,ge]of this.fixedUniformsEntries)ge.set(this.program,ve,I[ve]);J&&J.setUniforms(this.program,re,this.binderUniforms,G,{zoom:$});const fe={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[c];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const ue=Y||[],Ie=J?J.getPaintVertexBuffers():[],Te=c===pe.TRIANGLES&&O,Ae=ee&&ee>0?1:void 0;for(const ve of H.get()){const ge=ve.vaos||(ve.vaos={});if((ge[M]||(ge[M]=new hd)).bind(re,this,z,Ie,O,ve.vertexOffset,ue,Ae),this.forceManualRenderingForInstanceIDShaders){const Pe=ee||1;for(let Le=0;Le<Pe;++Le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),O?pe.drawElements(c,ve.primitiveLength*fe,pe.UNSIGNED_SHORT,ve.primitiveOffset*fe*2):pe.drawArrays(c,ve.vertexOffset,ve.vertexLength)}else ee&&ee>1?pe.drawElementsInstanced(c,ve.primitiveLength*fe,pe.UNSIGNED_SHORT,ve.primitiveOffset*fe*2,ee):O?pe.drawElements(c,ve.primitiveLength*fe,pe.UNSIGNED_SHORT,ve.primitiveOffset*fe*2):pe.drawArrays(c,ve.vertexOffset,ve.vertexLength);Te&&this._drawDebugWireframe(n,p,x,b,O,ve,G,$,J,ee)}}}function Df(f,n,c=0){const p=Math.pow(2,n.tileID.overscaledZ),x=n.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=x*(n.tileID.canonical.x+n.tileID.wrap*p),E=x*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E],u_pattern_transition:c}}const Pf={terrain:0,flat:1},E_=s.bC(),gc=(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re)=>{const pe=n.style.light,fe=pe.properties.get("position"),ue=[fe.x,fe.y,fe.z],Ie=s.dO();pe.properties.get("anchor")==="viewport"&&(s.dP(Ie,-n.transform.angle),s.dQ(ue,ue,Ie));const Te=pe.properties.get("color").toPremultipliedRenderColor(null),Ae=n.transform,ve={u_matrix:f,u_lightpos:ue,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:E_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Pf[z],u_base_type:Pf[O],u_ao:x,u_edge_radius:b,u_width_scale:E,u_flood_light_color:J,u_vertical_scale:Y,u_flood_light_intensity:ee,u_ground_shadow_factor:re};return Ae.projection.name==="globe"&&(ve.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ve.u_zoom_transition=H,ve.u_inv_rot_matrix=$,ve.u_merc_center=G,ve.u_up_dir=Ae.projection.upVector(new s.cD(0,0,0),G[0]*s.al,G[1]*s.al),ve.u_height_lift=M),ve},Qc=(f,n,c,p,x,b)=>({u_matrix:f,u_edge_radius:n,u_width_scale:c,u_vertical_scale:p,u_height_type:Pf[x],u_base_type:Pf[b]}),Qm=(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re)=>{const pe=gc(f,n,c,p,x,b,E,I,z,O,H,G,$,J,Y,ee,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return Object.assign(pe,Df(n,M,re),fe)},Iu=(f,n,c)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:c}),Cu=(f,n,c,p,x,b=0)=>Object.assign(Iu(f,n,x),Df(c,p,b)),bd=(f,n,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:n,u_ground_shadow_factor:p}),kf=(f,n,c,p,x,b,E=0)=>Object.assign(Cu(f,n,c,p,b,E),{u_world:x}),gh=(f,n)=>({u_matrix:f,u_depth_bias:n}),Vl=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),Ru=(f,n,c,p,x)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),_c=(f,n,c,p,x,b,E,I,M)=>({u_matrix:f,u_normal_matrix:n,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:b,u_facade_emissive_chance:E,u_flood_light_color:I,u_flood_light_intensity:M}),Jm=f=>({u_matrix:f}),uo=f=>({u_matrix:f}),Lf=(f,n,c,p,x,b,E,I)=>{const M=s.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(I),u_extrude_scale:[c.pixelsToGLUnits[0]/M,c.pixelsToGLUnits[1]/M],u_zoom_transition:p,u_tile_id:E,u_merc_center:x}},wd=(f,n,c,p)=>({u_matrix:f,u_inv_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(p),u_viewport_size:[c.width,c.height]}),yc=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),Jc=s.bC(),_h=(f,n,c,p,x,b,E)=>{const I=f.transform,M=I.projection.name==="globe",z=M?s.dR(I.zoom,n.canonical)*I._pixelsPerMercatorPixel:s.ay(c,1,b),O={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:Jc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=p,O.u_merc_center=x,O.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],O.u_zoom_transition=s.aj(I.zoom);const H=x[0]*s.al,G=x[1]*s.al;O.u_up_dir=I.projection.upVector(new s.cD(0,0,0),H,G)}return O};function Td(f,[n,c,p,x],[b,E]){if(b===E)return[0,0,0,0];const I=255*(f-1)/(f*(E-b));return[n*I,c*I,p*I,x*I]}function Bp(f,n,[c,p]){return c===p?0:.5/f+(n-c)*(f-1)/(f*(p-c))}const yh=(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe,fe,ue)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:O.mix,u_opacity:O.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(H.paint.get("raster-saturation")),u_contrast_factor:s.dS(H.paint.get("raster-contrast")),u_spin_weights:eu(H.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:$,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:Td(s.dU,Y,re),u_colorization_offset:Bp(s.dU,ee,re),u_color_ramp:J,u_texture_offset:[fe/(pe+2*fe),pe/(pe+2*fe)],u_texture_res:[pe+2*fe,pe+2*fe],u_emissive_strength:ue});function eu(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const xh=.05,S_=(f,n,c,p,x,b,E,I,M,z,O,H)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:z,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M}),vh=(f,n,c,p,x,b,E,I,M,z)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:c,u_velocity:p,u_color_ramp:b,u_velocity_res:x,u_max_speed:E,u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[xh,xh]}),Fp=(f,n,c,p,x,b,E,I,M,z)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:b,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[xh,xh]}),zf=s.bC(),bh=(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe,fe,ue,Ie,Te,Ae)=>{const ve=x.transform,ge={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(pe),u_rotate_symbol:+c,u_aspect_ratio:ve.width/ve.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+z,u_elevation_from_sea:M?1:0,u_pitch_with_map:+p,u_texsize:O,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zf,u_up_vector:[0,-1,0],u_color_adj_mat:Ie,u_icon_transition:Te||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(pe)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ae||1,u_ground_shadow_factor:fe,u_inv_matrix:s.bl(s.bC(),E),u_normal_scale:ue,u_lutTexture:10};return pe.name==="globe"&&(ge.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],ge.u_zoom_transition=J,ge.u_inv_rot_matrix=ee,ge.u_merc_center=Y,ge.u_camera_forward=ve._camera.forward(),ge.u_ecef_origin=s.dV(ve.globeMatrix,$.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(ve.globeMatrix),ge.u_up_vector=re),ge},xc=(f,n,c,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:c,u_color:p}),Da=(f,n,c,p,x,b,E,I,M)=>Object.assign((function(z,O,H,G,$,J){const{width:Y,height:ee}=G.imageManager.getPixelSize(O),re=Math.pow(2,J.tileID.overscaledZ),pe=J.tileSize*Math.pow(2,G.transform.tileZoom)/re,fe=pe*(J.tileID.canonical.x+J.tileID.wrap*re),ue=pe*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[Y,ee],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:$?[G.transform.width,-1*G.transform.height]:[1/s.ay(J,1,G.transform.tileZoom),1/s.ay(J,1,G.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,ue>>16],u_pixel_coord_lower:[65535&fe,65535&ue]}})(0,b,E,p,I,M),{u_matrix:f,u_emissive_strength:n,u_opacity:c}),wa=new Float32Array(s.bA([])),jl=(f,n,c,p,x,b,E,I,M,z,O,H,G,$=[0,0,0],J,Y,ee)=>{const re=x.style.light,pe=re.properties.get("position"),fe=[-pe.x,-pe.y,pe.z],ue=s.dO();re.properties.get("anchor")==="viewport"&&(s.dP(ue,-x.transform.angle),s.dQ(fe,fe,ue));const Ie=O.alphaMode==="MASK",Te=re.properties.get("color").toNonPremultipliedRenderColor(null),Ae=G.paint.get("model-ambient-occlusion-intensity"),ve=G.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return ve.a=G.paint.get("model-color-mix-intensity").constantOr(0),ee&&(ve.r=ee[0],ve.g=ee[1],ve.b=ee[2],ve.a=ee[3]),Y&&(ve.r=Y.color.r,ve.g=Y.color.g,ve.b=Y.color.b,ve.a=Y.colorMix,H=Y.emissionStrength,b*=Y.opacity),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:c,u_node_matrix:p||wa,u_lightpos:fe,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_camera_pos:$,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ie,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:z,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:ve.toArray01(),u_aoIntensity:Ae,u_emissive_strength:H,u_occlusionTextureTransform:J||[0,0,0,0]}},wh=(f,n=wa,c=wa)=>({u_matrix:f,u_instance:n,u_node_matrix:c}),Of={fillExtrusion:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_opacity:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_flood_light_color:new s.ci(f),u_vertical_scale:new s.cj(f),u_flood_light_intensity:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new s.cl(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_vertical_scale:new s.cj(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_height_factor:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_opacity:new s.cj(f),u_pattern_transition:new s.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.cl(f),u_opacity:new s.cj(f),u_ao_pass:new s.cj(f),u_meter_to_tile:new s.cj(f),u_ao:new s.ck(f),u_flood_light_intensity:new s.cj(f),u_flood_light_color:new s.ci(f),u_attenuation:new s.cj(f),u_edge_radius:new s.cj(f),u_fb:new s.ch(f),u_fb_size:new s.cj(f),u_dynamic_offset:new s.cj(f)}),fill:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),fillOutline:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_ground_shadow_factor:new s.ci(f)}),fillOutlinePattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),building:f=>({u_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_opacity:new s.cj(f),u_faux_facade_ao_intensity:new s.cj(f),u_camera_pos:new s.ci(f),u_tile_to_meter:new s.cj(f),u_facade_emissive_chance:new s.cj(f),u_flood_light_color:new s.ci(f),u_flood_light_intensity:new s.cj(f)}),buildingBloom:f=>({u_matrix:new s.cl(f)}),buildingDepth:f=>({u_matrix:new s.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.cl(f),u_depth_bias:new s.cj(f)}),elevatedStructures:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.cl(f),u_camera_pos:new s.ci(f),u_depth_bias:new s.cj(f),u_height_scale:new s.cj(f),u_reset_depth:new s.cj(f)}),circle:s.dY,collisionBox:f=>({u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_extrude_scale:new s.ck(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f)}),collisionCircle:f=>({u_matrix:new s.cl(f),u_inv_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_viewport_size:new s.ck(f)}),debug:f=>({u_color:new s.dB(f),u_matrix:new s.cl(f),u_overlay:new s.ch(f),u_overlay_scale:new s.cj(f)}),clippingMask:f=>({u_matrix:new s.cl(f)}),heatmap:f=>({u_extrude_scale:new s.cj(f),u_intensity:new s.cj(f),u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_up_dir:new s.ci(f)}),heatmapTexture:f=>({u_image:new s.ch(f),u_color_ramp:new s.ch(f),u_opacity:new s.cj(f)}),hillshade:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_latrange:new s.ck(f),u_light:new s.ck(f),u_shadow:new s.dB(f),u_highlight:new s.dB(f),u_emissive_strength:new s.cj(f),u_accent:new s.dB(f)}),hillshadePrepare:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_dimension:new s.ck(f),u_zoom:new s.cj(f)}),line:s.dX,linePattern:s.dW,raster:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_brightness_low:new s.cj(f),u_brightness_high:new s.cj(f),u_saturation_factor:new s.cj(f),u_contrast_factor:new s.cj(f),u_spin_weights:new s.ci(f),u_perspective_transform:new s.ck(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f),u_colorization_mix:new s.d3(f),u_colorization_offset:new s.cj(f),u_color_ramp:new s.ch(f),u_texture_offset:new s.ck(f),u_texture_res:new s.ck(f),u_emissive_strength:new s.cj(f)}),rasterParticle:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f)}),rasterParticleTexture:f=>({u_texture:new s.ch(f),u_opacity:new s.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_tile_offset:new s.ck(f),u_velocity:new s.ch(f),u_color_ramp:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_velocity:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_speed_factor:new s.cj(f),u_reset_rate:new s.cj(f),u_rand_seed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new s.ch(f),u_is_size_feature_constant:new s.ch(f),u_size_t:new s.cj(f),u_size:new s.cj(f),u_camera_to_center_distance:new s.cj(f),u_rotate_symbol:new s.ch(f),u_aspect_ratio:new s.cj(f),u_fade_change:new s.cj(f),u_matrix:new s.cl(f),u_label_plane_matrix:new s.cl(f),u_coord_matrix:new s.cl(f),u_is_text:new s.ch(f),u_elevation_from_sea:new s.ch(f),u_pitch_with_map:new s.ch(f),u_texsize:new s.ck(f),u_texsize_icon:new s.ck(f),u_texture:new s.ch(f),u_texture_icon:new s.ch(f),u_gamma_scale:new s.cj(f),u_device_pixel_ratio:new s.cj(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_camera_forward:new s.ci(f),u_tile_matrix:new s.cl(f),u_up_vector:new s.ci(f),u_ecef_origin:new s.ci(f),u_is_halo:new s.ch(f),u_icon_transition:new s.cj(f),u_color_adj_mat:new s.cl(f),u_scale_factor:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_inv_matrix:new s.cl(f),u_normal_scale:new s.cj(f),u_lutTexture:new s.ch(f)}),background:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_color:new s.dB(f)}),backgroundPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_image:new s.ch(f),u_pattern_tl:new s.ck(f),u_pattern_br:new s.ck(f),u_texsize:new s.ck(f),u_pattern_size:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_pattern_units_to_pixels:new s.ck(f)}),terrainRaster:f=>({u_matrix:new s.cl(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_skirt_height:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_emissive_texture_available:new s.cj(f)}),skybox:f=>({u_matrix:new s.cl(f),u_sun_direction:new s.ci(f),u_cubemap:new s.ch(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxGradient:f=>({u_matrix:new s.cl(f),u_color_ramp:new s.ch(f),u_center_direction:new s.ci(f),u_radius:new s.cj(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dC(f),u_sun_direction:new s.ci(f),u_sun_intensity:new s.cj(f),u_color_tint_r:new s.d3(f),u_color_tint_m:new s.d3(f),u_luminance:new s.cj(f)}),globeRaster:f=>({u_proj_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_grid_matrix:new s.dC(f),u_skirt_height:new s.cj(f),u_far_z_cutoff:new s.cj(f),u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_globe_pos:new s.ci(f),u_globe_radius:new s.cj(f),u_viewport:new s.ck(f),u_emissive_texture_available:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_horizon:new s.cj(f),u_transition:new s.cj(f),u_fadeout_range:new s.cj(f),u_atmosphere_fog_color:new s.d3(f),u_high_color:new s.d3(f),u_space_color:new s.d3(f),u_temporal_offset:new s.cj(f),u_horizon_angle:new s.cj(f)}),model:f=>({u_matrix:new s.cl(f),u_lighting_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_node_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_camera_pos:new s.ci(f),u_opacity:new s.cj(f),u_baseColorFactor:new s.d3(f),u_emissiveFactor:new s.d3(f),u_metallicFactor:new s.cj(f),u_roughnessFactor:new s.cj(f),u_baseTextureIsAlpha:new s.ch(f),u_alphaMask:new s.ch(f),u_alphaCutoff:new s.cj(f),u_baseColorTexture:new s.ch(f),u_metallicRoughnessTexture:new s.ch(f),u_normalTexture:new s.ch(f),u_occlusionTexture:new s.ch(f),u_emissionTexture:new s.ch(f),u_lutTexture:new s.ch(f),u_color_mix:new s.d3(f),u_aoIntensity:new s.cj(f),u_emissive_strength:new s.cj(f),u_occlusionTextureTransform:new s.d3(f)}),modelDepth:f=>({u_matrix:new s.cl(f),u_instance:new s.cl(f),u_node_matrix:new s.cl(f)}),groundShadow:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),stars:f=>({u_matrix:new s.cl(f),u_up:new s.ci(f),u_right:new s.ci(f),u_intensity_multiplier:new s.cj(f)}),snowParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_horizontalOscillationRadius:new s.cj(f),u_horizontalOscillationRate:new s.cj(f),u_boxSize:new s.cj(f),u_billboardSize:new s.cj(f),u_simpleShapeParameters:new s.ck(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_particleColor:new s.d3(f),u_direction:new s.ci(f)}),rainParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_texScreen:new s.ch(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_boxSize:new s.cj(f),u_rainDropletSize:new s.ck(f),u_distortionStrength:new s.cj(f),u_rainDirection:new s.ci(f),u_color:new s.d3(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_shapeDirectionalPower:new s.cj(f),u_shapeNormalPower:new s.cj(f),u_mode:new s.cj(f)}),vignette:f=>({u_vignetteShape:new s.ci(f),u_vignetteColor:new s.d3(f)}),occlusion:f=>({u_matrix:new s.cl(f),u_anchorPos:new s.ci(f),u_screenSizePx:new s.ck(f),u_occluderSizePx:new s.ck(f),u_color:new s.d3(f)})};class Pa{constructor(n,c,p,x){this.id=Pa.uniqueIdxCounter,Pa.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Pa.uniqueIdxCounter,Pa.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Pa.uniqueIdxCounter=0;const Oo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Us{constructor(n,c,p,x,b,E){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=n;const I=n.gl;this.buffer=I.createBuffer(),n.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let p=0;p<this.attributes.length;p++){const x=c.getAttributeLocation(n,this.attributes[p].name);x!==-1&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,c,p){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=c.getAttributeLocation(n,b.name);E!==-1&&n.vertexAttribPointer(E,b.components,n[Oo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,c,p){for(let x=0;x<this.attributes.length;x++){const b=c.getAttributeLocation(n,this.attributes[x].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vc{constructor(n,c,p,x,b){this.context=n,this.width=c,this.height=p;const E=this.framebuffer=n.gl.createFramebuffer();x>0&&(this.colorAttachment0=new Sf(n,E,0)),x>1&&(this.colorAttachment1=new Sf(n,E,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new pd(n,E):new Af(n,E))}createColorAttachment(n,c){c===0?this.colorAttachment0=new Sf(n,this.framebuffer,0):c===1&&(this.colorAttachment1=new Sf(n,this.framebuffer,1))}removeColorAttachment(n,c){const p=this.context.gl;let x;c===0?(x=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(x=this.colorAttachment1.get(),this.colorAttachment1=void 0),x&&p.deleteTexture(x)}destroy(){const n=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&n.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&n.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&n.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&n.deleteTexture(c)}n.deleteFramebuffer(this.framebuffer)}}class _l{constructor(n,c){this.gl=n,this.clearColor=new fc(this),this.clearDepth=new Ol(this),this.clearStencil=new Nl(this),this.colorMask=new bf(this),this.depthMask=new wf(this),this.stencilMask=new Hc(this),this.stencilFunc=new fh(this),this.stencilOp=new js(this),this.stencilTest=new Gr(this),this.depthRange=new pr(this),this.depthTest=new pc(this),this.depthFunc=new Jo(this),this.blend=new Tu(this),this.blendFunc=new Bl(this),this.blendColor=new Tf(this),this.blendEquation=new zp(this),this.cullFace=new $c(this),this.cullFaceSide=new Fl(this),this.frontFace=new Op(this),this.program=new dd(this),this.activeTexture=new Np(this),this.viewport=new gl(this),this.bindFramebuffer=new mc(this),this.bindRenderbuffer=new Eu(this),this.bindTexture=new Zc(this),this.bindVertexBuffer=new Ym(this),this.bindElementBuffer=new Ef(this),this.bindVertexArrayOES=new Su(this),this.pixelStoreUnpack=new fd(this),this.pixelStoreUnpackPremultiplyAlpha=new Wc(this),this.pixelStoreUnpackFlipY=new ba(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=n.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c,p){return new Pa(this,n,c,p)}createVertexBuffer(n,c,p,x,b){return new Us(this,n,c,p,x,b)}createRenderbuffer(n,c,p){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(n,c,p,x){return new vc(this,n,c,p,x)}clear({color:n,depth:c,stencil:p,colorMask:x}){const b=this.gl;let E=0;n&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(E)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.by(n.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Bt;function qr(f,n,c,p,x,b,E){const I=f.context,M=I.gl,z=f.transform,O=[s.aF(z.center.lng),s.aJ(z.center.lat)],H=c.layout.get("symbol-placement"),G=c.layout.get("text-variable-anchor"),$=c.layout.get("icon-rotation-alignment")==="map",J=c.layout.get("text-rotation-alignment")==="map",Y=H!=="point",ee=[];let re=0,pe=0;for(let ve=0;ve<p.length;ve++){const ge=p[ve],Pe=n.getTile(ge),Le=Pe.getBucket(c);if(!Le)continue;const Fe=Le.getProjection().createInversionMatrix(z,ge.canonical),We=[],$e=nd(ge,Le,z),lt=!E&&$&&Y,xt=E&&J&&Y,Qe=G&&Le.hasTextData(),ke=Le.hasIconTextFit()&&Qe&&Le.hasIconData(),mt=lt||xt||E&&Qe||ke,nt=Le.projection.name==="globe",yt=nt?s.aj(z.zoom):0;nt&&(We.push("PROJECTION_GLOBE_VIEW"),mt&&We.push("PROJECTED_POS_ON_VIEWPORT"));const Pt=f.getOrCreateProgram("collisionBox",{defines:We});let qt=$e;x[0]===0&&x[1]===0||(qt=f.translatePosMatrix($e,Pe,x,b));const zt=E?Le.textCollisionBox:Le.iconCollisionBox,kt=Le.collisionCircleArray;if(kt.length>0){const an=s.bC(),$t=qt;s.cP(an,Le.placementInvProjMatrix,z.glCoordMatrix),s.cP(an,an,Le.placementViewportMatrix),ee.push({circleArray:kt,circleOffset:pe,transform:$t,invTransform:an,projection:Le.getProjection()}),re+=kt.length/4,pe=re}if(!zt)continue;f.terrain&&f.terrain.setupElevationDraw(Pe,Pt);const cn=nt?[ge.canonical.x,ge.canonical.y,1<<ge.canonical.z]:[0,0,0];Pt.draw(f,M.LINES,mn.disabled,Ln.disabled,f.colorModeForRenderPass(),Rn.disabled,Lf(qt,Fe,z,yt,O,Pe,cn,Le.getProjection()),c.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,z.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt])}if(!E||!ee.length)return;const fe=f.getOrCreateProgram("collisionCircle"),ue=new s.dZ;ue.resize(4*re),ue._trim();let Ie=0;for(const ve of ee)for(let ge=0;ge<ve.circleArray.length/4;ge++){const Pe=4*ge,Le=ve.circleArray[Pe+0],Fe=ve.circleArray[Pe+1],We=ve.circleArray[Pe+2],$e=ve.circleArray[Pe+3];ue.emplace(Ie++,Le,Fe,We,$e,0),ue.emplace(Ie++,Le,Fe,We,$e,1),ue.emplace(Ie++,Le,Fe,We,$e,2),ue.emplace(Ie++,Le,Fe,We,$e,3)}(!Bt||Bt.length<2*re)&&(Bt=(function(ve){const ge=2*ve,Pe=new s.b0;Pe.resize(ge),Pe._trim();for(let Le=0;Le<ge;Le++){const Fe=6*Le;Pe.uint16[Fe+0]=4*Le+0,Pe.uint16[Fe+1]=4*Le+1,Pe.uint16[Fe+2]=4*Le+2,Pe.uint16[Fe+3]=4*Le+2,Pe.uint16[Fe+4]=4*Le+3,Pe.uint16[Fe+5]=4*Le+0}return Pe})(re));const Te=I.createIndexBuffer(Bt,!0),Ae=I.createVertexBuffer(ue,s.d_.members,!0);for(const ve of ee){const ge=wd(ve.transform,ve.invTransform,z,ve.projection);fe.draw(f,M.TRIANGLES,mn.disabled,Ln.disabled,f.colorModeForRenderPass(),Rn.disabled,ge,c.id,Ae,Te,s.bg.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,z.zoom)}Ae.destroy(),Te.destroy()}const Hr=s.bC();function yl(f){const n=f._camera.getWorldToCamera(f.worldSize,1),c=s.aB([],n,f.globeMatrix);s.bl(c,c);const p=[0,0,0],x=[0,1,0,0];return s.aC(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],s.aw(p,p),p}function Th({width:f,height:n,anchor:c,textOffset:p,textScale:x},b){const{horizontalAlign:E,verticalAlign:I}=s.c1(c),M=-(E-.5)*f,z=-(I-.5)*n,O=s.c2(c,p);return new s.P((M/x+O[0])*b,(z/x+O[1])*b)}function Mu(f,n,c,p,x,b,E,I,M,z){const O=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,G=f.icon.dynamicLayoutVertexArray,$={},J=f.getProjection(),Y=ro(E,J,x),ee=x.elevation,re=J.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;H.clear();for(let pe=0;pe<O.length;pe++){const fe=O.get(pe),{tileAnchorX:ue,tileAnchorY:Ie,numGlyphs:Te}=fe,Ae=fe.hidden||!fe.crossTileID||f.allowVerticalPlacement&&!fe.placedOrientation?null:p[fe.crossTileID];if(Ae){let ve=0,ge=0,Pe=0;const Le=f.elevationType==="road";if(ee||Le){const nt=Le?f.getElevationFeatureForText(pe):null,yt=s.bV.getAtTileOffset(E,new s.P(ue,Ie),ee,nt),[Pt,qt,zt]=J.upVector(E.canonical,ue,Ie);ve=yt*Pt*re,ge=yt*qt*re,Pe=yt*zt*re}let[Fe,We,$e,lt]=qa(fe.projectedAnchorX+ve,fe.projectedAnchorY+ge,fe.projectedAnchorZ+Pe,c?Y:b);const xt=sh(x.getCameraToCenterDistance(J),lt);let Qe=s.bM(f.textSizeData,M,fe)*xt/s.bY;c&&(Qe*=f.tilePixelRatio/I);const ke=Th(Ae,Qe);c?({x:Fe,y:We,z:$e}=J.projectTilePoint(ue+ke.x,Ie+ke.y,E.canonical),[Fe,We,$e]=qa(Fe+ve,We+ge,$e+Pe,b)):(n&&ke._rotate(-x.angle),Fe+=ke.x,We+=ke.y,$e=0);const mt=f.allowVerticalPlacement&&fe.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let nt=0;nt<Te;nt++)s.bO(H,Fe,We,$e,mt);z&&fe.associatedIconIndex>=0&&($[fe.associatedIconIndex]={x:Fe,y:We,z:$e,angle:mt})}else As(Te,H)}if(z){G.clear();const pe=f.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const ue=pe.get(fe),{numGlyphs:Ie}=ue,Te=$[fe];if(ue.hidden||!Te)As(Ie,G);else{const{x:Ae,y:ve,z:ge,angle:Pe}=Te;for(let Le=0;Le<Ie;Le++)s.bO(G,Ae,ve,ge,Pe)}}f.icon.dynamicLayoutVertexBuffer.updateData(G)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function Eh(f,n,c,p,x,b,E={}){const I=c.paint.get("icon-translate"),M=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),O=c.paint.get("text-translate-anchor"),H=c.layout.get("icon-rotation-alignment"),G=c.layout.get("text-rotation-alignment"),$=c.layout.get("icon-pitch-alignment"),J=c.layout.get("text-pitch-alignment"),Y=c.layout.get("icon-keep-upright"),ee=c.layout.get("text-keep-upright"),re=c.paint.get("icon-color-saturation"),pe=c.paint.get("icon-color-contrast"),fe=c.paint.get("icon-color-brightness-min"),ue=c.paint.get("icon-color-brightness-max"),Ie=c.layout.get("symbol-elevation-reference")==="sea",Te=c.layout.get("icon-image-use-theme")==="none",Ae=f.context,ve=Ae.gl,ge=f.transform,Pe=H==="map",Le=G==="map",Fe=$==="map",We=J==="map",$e=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const xt=f.depthModeForSublayer(0,mn.ReadOnly),Qe=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),ke=[s.aF(ge.center.lng),s.aJ(ge.center.lat)],mt=c.layout.get("text-variable-anchor"),nt=ge.projection.name==="globe",yt=[],Pt=[0,-1,0];for(const qt of p){const zt=n.getTile(qt),kt=zt.getBucket(c);if(!kt||kt.projection.name==="mercator"&&nt||kt.fullyClipped)continue;const cn=kt.projection.name==="globe",an=cn?s.aj(ge.zoom):0,$t=ro(qt,kt.getProjection(),ge),on=ge.calculatePixelsToTileUnitsMatrix(zt),xn=mt&&kt.hasTextData(),Mn=kt.hasIconTextFit()&&xn&&kt.hasIconData(),Vn=kt.getProjection().createInversionMatrix(ge,qt.canonical),ti=(1<<zt.tileID.canonical.z)*s.al/f.transform.worldSize,Dn=Ai=>{let Bn=[0,0,0];if(Ai){const qn=f.style.directionalLight,Ji=f.style.ambientLight;qn&&Ji&&(Bn=Ha(f.style,qn,Ji))}return Bn},jn=Ai=>{ge.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(Ai.push("DEPTH_D24"),Ai.push("DEPTH_OCCLUSION"))},On=Ai=>{c.lut&&!Te&&(c.lut.texture||(c.lut.texture=new s.d$(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ae.gl.RGBA8)),Ae.activeTexture.set(Ae.gl.TEXTURE0+10),c.lut.texture&&c.lut.texture.bind(Ae.gl.LINEAR,Ae.gl.CLAMP_TO_EDGE),Ai.push("APPLY_LUT_ON_GPU"))},bi=()=>{const Ai=Pe&&c.layout.get("symbol-placement")!=="point",Bn=[];jn(Bn),On(Bn);const qn=Ai||Mn,Ji=kt.elevationType==="road",zr=f.shadowRenderer,Fi=Ji&&Fe&&!!zr&&zr.enabled,er=Dn(Fi),Ta=Ji&&Fe&&!f.terrain?Qe:xt,Js=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Fe&&Bn.push("PITCH_WITH_MAP_TERRAIN"),cn&&(Bn.push("PROJECTION_GLOBE_VIEW"),qn&&Bn.push("PROJECTED_POS_ON_VIEWPORT")),Js>0&&kt.hasAnySecondaryIcon&&Bn.push("ICON_TRANSITION"),!kt.icon.zOffsetVertexBuffer||Ji&&f.terrain||Bn.push("Z_OFFSET"),re===0&&pe===0&&fe===0&&ue===1||Bn.push("COLOR_ADJUSTMENT"),kt.sdfIcons&&Bn.push("RENDER_SDF"),Fi&&Bn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ji&&Fe&&!f.terrain&&kt.icon.orientationVertexBuffer&&Bn.push("ELEVATED_ROADS");const Ps=kt.icon.programConfigurations.get(c.id),Ii=f.getOrCreateProgram("symbol",{config:Ps,defines:Bn}),fo=zt.imageAtlasTexture?zt.imageAtlasTexture.size:[0,0],ea=kt.iconSizeData,ca=s.bK(ea,ge.zoom),jo=Fe||!ge.isOrthographic,Xa=ac($t,zt.tileID.canonical,Fe,Pe,ge,kt.getProjection(),on),Tr=Vs($t,zt.tileID.canonical,Fe,Pe,ge,kt.getProjection(),on),Qr=f.translatePosMatrix(Tr,zt,I,z,!0),rr=f.translatePosMatrix($t,zt,I,z),rs=qn?Hr:Xa,Cs=Pe&&!Fe&&!Ai;let Ir=Pt;!nt&&!ge.mercatorFromTransition||Pe||(Ir=yl(ge));const po=cn?Ir:Pt,Fd=c.getColorAdjustmentMatrix(re,pe,fe,ue),Yl=bh(ea.kind,ca,Cs,Fe,f,rr,rs,Qr,Ie,!1,fo,[0,0],0,qt,an,ke,Vn,po,kt.getProjection(),er,ti,Fd,Js,null),Nh=zt.imageAtlasTexture?zt.imageAtlasTexture:null,Bh=c.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear,mo=kt.sdfIcons||f.options.rotating||f.options.zooming||Bh||jo?ve.LINEAR:ve.NEAREST,il=kt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Kl=f.terrain&&Fe&&Ai?s.bl(s.bC(),Xa):Hr;if(Ai&&kt.icon){const Uo=s.bV.getAtTileOffsetFunc(qt,ge.center.lat,ge.worldSize,kt.getProjection()),ar=pl($t,zt.tileID.canonical,Fe,Pe,ge,kt.getProjection(),on),ou=c.layout.get("icon-size-scale-range"),om=s.aA(f.scaleFactor,ou[0],ou[1]);Si(kt,$t,f,!1,ar,Tr,Fe,Y,Uo,qt,om)}return{program:Ii,buffers:kt.icon,uniformValues:Yl,atlasTexture:Nh,atlasTextureIcon:null,atlasInterpolation:mo,atlasInterpolationIcon:null,isSDF:kt.sdfIcons,hasHalo:il,depthMode:Ta,tile:zt,renderWithShadows:Fi,labelPlaneMatrixInv:Kl}},mi=()=>{const Ai=Le&&c.layout.get("symbol-placement")!=="point",Bn=[],qn=Ai||mt||Mn,Ji=kt.elevationType==="road",zr=f.shadowRenderer,Fi=Ji&&We&&!!zr&&zr.enabled,er=Dn(Fi),Ta=Ji&&We&&!f.terrain?Qe:xt;f.terrainRenderModeElevated()&&We&&Bn.push("PITCH_WITH_MAP_TERRAIN"),cn&&(Bn.push("PROJECTION_GLOBE_VIEW"),qn&&Bn.push("PROJECTED_POS_ON_VIEWPORT")),!kt.text.zOffsetVertexBuffer||Ji&&f.terrain||Bn.push("Z_OFFSET"),kt.iconsInText&&Bn.push("RENDER_TEXT_AND_SYMBOL"),Bn.push("RENDER_SDF"),Fi&&Bn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ji&&We&&!f.terrain&&kt.text.orientationVertexBuffer&&Bn.push("ELEVATED_ROADS"),jn(Bn);const Js=kt.text.programConfigurations.get(c.id),Ps=f.getOrCreateProgram("symbol",{config:Js,defines:Bn});let Ii,fo=[0,0],ea=null;const ca=kt.textSizeData;kt.iconsInText&&(fo=zt.imageAtlasTexture?zt.imageAtlasTexture.size:[0,0],ea=zt.imageAtlasTexture?zt.imageAtlasTexture:null,Ii=We||!ge.isOrthographic||f.options.rotating||f.options.zooming||ca.kind==="composite"||ca.kind==="camera"?ve.LINEAR:ve.NEAREST);const jo=zt.glyphAtlasTexture?zt.glyphAtlasTexture.size:[0,0],Xa=c.layout.get("text-size-scale-range"),Tr=s.aA(f.scaleFactor,Xa[0],Xa[1]),Qr=s.bK(ca,ge.zoom,Tr),rr=ac($t,zt.tileID.canonical,We,Le,ge,kt.getProjection(),on),rs=Vs($t,zt.tileID.canonical,We,Le,ge,kt.getProjection(),on),Cs=f.translatePosMatrix(rs,zt,M,O,!0),Ir=f.translatePosMatrix($t,zt,M,O),po=qn?Hr:rr,Fd=Le&&!We&&!Ai;let Yl=Pt;!nt&&!ge.mercatorFromTransition||Le||(Yl=yl(ge));const Nh=bh(ca.kind,Qr,Fd,We,f,Ir,po,Cs,Ie,!0,jo,fo,0,qt,an,ke,Vn,cn?Yl:Pt,kt.getProjection(),er,ti,null,null,Tr),Bh=zt.glyphAtlasTexture?zt.glyphAtlasTexture:null,mo=ve.LINEAR,il=c.paint.get("text-halo-width").constantOr(1)!==0,Kl=f.terrain&&We&&Ai?s.bl(s.bC(),rr):Hr;if(Ai&&kt.text){const Uo=s.bV.getAtTileOffsetFunc(qt,ge.center.lat,ge.worldSize,kt.getProjection()),ar=pl($t,zt.tileID.canonical,We,Le,ge,kt.getProjection(),on);Si(kt,$t,f,!0,ar,rs,We,ee,Uo,qt,Tr)}return{program:Ps,buffers:kt.text,uniformValues:Nh,atlasTexture:Bh,atlasTextureIcon:ea,atlasInterpolation:mo,atlasInterpolationIcon:Ii,isSDF:!0,hasHalo:il,depthMode:Ta,tile:zt,renderWithShadows:Fi,labelPlaneMatrixInv:Kl}},ki=kt.icon.segments.get().length,li=kt.text.segments.get().length,Un=ki&&!E.onlyText?bi():null,yi=li&&!E.onlyIcons?mi():null,gr=c.paint.get("icon-opacity").constantOr(1),Li=c.paint.get("text-opacity").constantOr(1);if($e&&kt.canOverlap){lt=!0;const Ai=gr&&!E.onlyText?kt.icon.segments.get():[],Bn=Li&&!E.onlyIcons?kt.text.segments.get():[];for(const qn of Ai)yt.push({segments:new s.bg([qn]),sortKey:qn.sortKey,state:Un});for(const qn of Bn)yt.push({segments:new s.bg([qn]),sortKey:qn.sortKey,state:yi})}else E.onlyText||yt.push({segments:gr?kt.icon.segments:new s.bg([]),sortKey:0,state:Un}),E.onlyIcons||yt.push({segments:Li?kt.text.segments:new s.bg([]),sortKey:0,state:yi})}lt&&yt.sort((qt,zt)=>qt.sortKey-zt.sortKey);for(const qt of yt){const zt=qt.state;if(zt)if(f.terrain?f.terrain.setupElevationDraw(zt.tile,zt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:zt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,zt.program),Ae.activeTexture.set(ve.TEXTURE0),zt.atlasTexture&&zt.atlasTexture.bind(zt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),zt.atlasTextureIcon&&(Ae.activeTexture.set(ve.TEXTURE1),zt.atlasTextureIcon&&zt.atlasTextureIcon.bind(zt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),zt.renderWithShadows&&f.shadowRenderer.setupShadows(zt.tile.tileID.toUnwrapped(),zt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,zt.program),zt.hasHalo){const kt=zt.uniformValues;kt.u_is_halo=1,Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,kt,2),kt.u_is_halo=0}else{if(zt.isSDF){const kt=zt.uniformValues;zt.hasHalo&&(kt.u_is_halo=1,Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,kt,1)),kt.u_is_halo=0}Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,zt.uniformValues,1)}}}function Du(f,n,c,p,x,b,E,I,M,z){const O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,b,E,I,Rn.disabled,M,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),O,z)}function Pu(f,n){const c=1<<f.canonical.z,p=(n.x*c-f.canonical.x-f.wrap*c)*s.al,x=(n.y*c-f.canonical.y)*s.al,b=s.e8(n.z,n.y);return s.d5(p,x,b)}function eg(f,n,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,E=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),I=new mn(f.context.gl.GREATER,mn.ReadWrite,f.depthRangeFor3D),M=(function($){let J=.01;return $.isOrthographic&&(J=s.ak(1e-4,J,s.d0($.pitch>=Lo?1:$.pitch/Lo))),2*J})(f.transform),z=f.transform.getFreeCameraOptions().position,O="elevatedStructuresDepthReconstruct",H=f.getOrCreateProgram(O,{defines:["DEPTH_RECONSTRUCTION"]}),G=f.getOrCreateProgram(O);for(const $ of p){const J=n.getTile($),Y=J.getBucket(c);if(!Y)continue;const ee=Y.elevatedStructures;if(!ee)continue;const re=Y.elevationBufferData.heightRange,pe=Pu($.toUnwrapped(),z),fe=f.translatePosMatrix($.projMatrix,J,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ue,Ie,Te,Ae;if(x==="initialize"){if(!re||re.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,M,1,0),Ie=E,Te=ee.depthSegments,Ae=H}else if(x==="reset"){if(!re||re.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,0,0,1),Ie=I,Te=ee.maskSegments,Ae=H}else if(x==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,M,1,0),Ie=E,Te=ee.depthSegments,Ae=G}Ae.draw(f,b.TRIANGLES,Ie,Ln.disabled,zn.disabled,Rn.disabled,ue,c.id,ee.vertexBuffer,ee.indexBuffer,Te,c.paint,f.transform.zoom)}}function ns(f,n,c,p){const{painter:x,sourceCache:b,layer:E,coords:I,colorMode:M,elevationType:z,terrainEnabled:O,pass:H}=f,G=x.context.gl,$=E.paint.get("fill-pattern"),J=E.paint.get("fill-pattern-cross-fade"),Y=$.constantOr(null);let ee=z;z!=="road"||n&&!O||(ee="none");const re=ee==="road",pe=f.painter.shadowRenderer,fe=re&&!!pe&&pe.enabled,ue=new mn(x.context.gl.LEQUAL,mn.ReadOnly,x.depthRangeFor3D);let Ie=[0,0,0];if(fe){const ge=x.style.directionalLight,Pe=x.style.ambientLight;ge&&Pe&&(Ie=Ha(x.style,ge,Pe))}const Te=$&&$.constantOr(1),Ae=x.terrain&&x.terrain.renderingToTexture,ve=(ge,Pe)=>{let Le,Fe,We,$e,lt;Pe?(Le=Te&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=G.LINES):(Le=Te?"fillPattern":"fill",We=G.TRIANGLES);for(const xt of I){const Qe=b.getTile(xt);if(Te&&!Qe.patternsLoaded())continue;const ke=Qe.getBucket(E);if(!ke)continue;const mt=n?ke.elevationBufferData:ke.bufferData;if(mt.isEmpty())continue;x.prepareDrawTile();const nt=mt.programConfigurations.get(E.id),yt=x.isTileAffectedByFog(xt),Pt=[],qt=[];re&&(Pt.push("ELEVATED_ROADS"),qt.push(mt.elevatedLayoutVertexBuffer)),fe&&Pt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ae&&c&&Pt.push("USE_MRT1"),Te&&(x.context.activeTexture.set(G.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),nt.updatePaintBuffers());let zt=!1;if(Y&&Qe.imageAtlas){const on=Qe.imageAtlas,xn=s.e3.from(Y),Mn=xn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Vn=xn.getSecondary(),ti=on.patternPositions.get(Mn),Dn=Vn?on.patternPositions.get(Vn.scaleSelf(s.o.devicePixelRatio).toString()):null;zt=!!ti&&!!Dn,ti&&nt.setConstantPatternPositions(ti,Dn)}J>0&&(zt||nt.getPatternTransitionVertexBuffer("fill-pattern"))&&Pt.push("FILL_PATTERN_TRANSITION");const kt=x.getOrCreateProgram(Le,{config:nt,overrideFog:yt,defines:Pt}),cn=x.translatePosMatrix(xt.projMatrix,Qe,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));fe&&pe.setupShadows(Qe.tileID.toUnwrapped(),kt,"vector-tile");const an=E.paint.get("fill-emissive-strength");if(Pe){$e=mt.lineIndexBuffer,lt=mt.lineSegments;const on=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];Fe=Le==="fillOutlinePattern"&&Te?kf(cn,an,x,Qe,on,Ie,J):bd(cn,an,on,Ie)}else $e=mt.indexBuffer,lt=mt.triangleSegments,Fe=Te?Cu(cn,an,x,Qe,Ie,J):Iu(cn,an,Ie);x.uploadCommonUniforms(x.context,kt,xt.toUnwrapped());let $t=ge;(z==="road"&&!O||z==="offset")&&($t=ue),kt.draw(x,We,$t,p||x.stencilModeForClipping(xt),M,Rn.disabled,Fe,E.id,mt.layoutVertexBuffer,$e,lt,E.paint,x.transform.zoom,nt,qt)}};x.renderPass===H&&ve(x.depthModeForSublayer(1,x.renderPass==="opaque"?mn.ReadWrite:mn.ReadOnly),!1),ee==="none"&&x.renderPass==="translucent"&&E.paint.get("fill-antialias")&&ve(x.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,mn.ReadOnly),!0)}function ku(f,n,c,p,x,b,E,I){c.resetLayerRenderingStats(f);const M=f.context,z=M.gl,O=f.transform,H=c.paint.get("fill-extrusion-pattern"),G=c.paint.get("fill-extrusion-pattern-cross-fade"),$=H.constantOr(null),J=H.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),ee=f.style.enable3dLights(),re=c.paint.get(ee&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),re],fe=c.layout.get("fill-extrusion-edge-radius"),ue=fe>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ie=ue?0:fe,Te=O.projection.name==="globe"?s.eb():0,Ae=O.projection.name==="globe",ve=Ae?s.aj(O.zoom):0,ge=[s.aF(O.center.lng),s.aJ(O.center.lat)],Pe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Le=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Pe?null:c.lut).toArray01().slice(0,3),Fe=c.paint.get("fill-extrusion-flood-light-intensity"),We=c.paint.get("fill-extrusion-vertical-scale"),$e=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,lt=c.paint.get("fill-extrusion-height-alignment"),xt=c.paint.get("fill-extrusion-base-alignment"),Qe=Yo(f,c.paint.get("fill-extrusion-cutoff-fade-range")),ke=[];let mt;Ae&&ke.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&ke.push("FAUX_AO"),ue&&ke.push("ZERO_ROOF_RADIUS"),I&&ke.push("HAS_CENTROID"),Fe>0&&ke.push("FLOOD_LIGHT"),Qe.shouldRenderCutoff&&ke.push("RENDER_CUTOFF"),$e&&ke.push("RENDER_WALL_MODE");const nt=f.renderPass==="shadow",yt=f.shadowRenderer,Pt=nt&&!!yt,qt=nt?Rn.disabled:Rn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let zt=[0,0,0];if(yt){const an=f.style.directionalLight,$t=f.style.ambientLight;an&&$t&&(zt=Ha(f.style,an,$t)),nt||(ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&ke.push("NORMAL_OFFSET")),mt=ke.concat(["SHADOWS_SINGLE_CASCADE"])}const kt=Pt?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",cn=c.getLayerRenderingStats();for(const an of p){const $t=n.getTile(an),on=$t.getBucket(c);if(!on||on.projection.name!==O.projection.name)continue;let xn=!1;yt&&(xn=yt.getMaxCascadeForTile(an.toUnwrapped())===0);const Mn=f.isTileAffectedByFog(an),Vn=on.programConfigurations.get(c.id);let ti=!1;if($&&$t.imageAtlas){const li=$t.imageAtlas,Un=s.e3.from($),yi=Un.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),gr=Un.getSecondary(),Li=li.patternPositions.get(yi),Ai=gr?li.patternPositions.get(gr.scaleSelf(s.o.devicePixelRatio).toString()):null;ti=!!Li&&!!Ai,Li&&Vn.setConstantPatternPositions(Li,Ai)}G>0&&(ti||Vn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ke.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Dn=f.getOrCreateProgram(kt,{config:Vn,defines:xn?mt:ke,overrideFog:Mn});if(f.terrain&&f.terrain.setupElevationDraw($t,Dn,{useMeterToDem:!0}),!on.centroidVertexBuffer){const li=Dn.getAttributeLocation(z,"a_centroid_pos");li!==-1&&z.vertexAttrib2f(li,0,0)}!nt&&yt&&yt.setupShadows($t.tileID.toUnwrapped(),Dn,"vector-tile"),J&&(f.context.activeTexture.set(z.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Vn.updatePaintBuffers());const jn=c.paint.get("fill-extrusion-vertical-gradient"),On=1/on.tileToMeter;let bi;if(nt&&yt){if(Nf($t.tileID,on.maxHeight,f))continue;const li=yt.calculateShadowPassMatrixFromTile($t.tileID.toUnwrapped());bi=Qc(li,Ie,On,We,lt,xt)}else{const li=f.translatePosMatrix(an.expandedProjMatrix,$t,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Un=O.projection.createInversionMatrix(O,an.canonical);bi=J?Qm(li,f,jn,Y,pe,Ie,On,an,$t,Te,lt,xt,ve,ge,Un,Le,We,G):gc(li,f,jn,Y,pe,Ie,On,an,Te,lt,xt,ve,ge,Un,Le,We,Fe,zt)}f.uploadCommonUniforms(M,Dn,an.toUnwrapped(),null,Qe);let mi=on.segments;if(O.projection.name==="mercator"&&!nt&&(mi=on.getVisibleSegments($t.tileID,f.terrain,f.transform.getFrustum(0)),!mi.get().length))continue;if(cn)if(nt)for(const li of mi.get())cn.numRenderedVerticesInShadowPass+=li.primitiveLength;else for(const li of mi.get())cn.numRenderedVerticesInTransparentPass+=li.primitiveLength;const ki=[];(f.terrain||I)&&ki.push(on.centroidVertexBuffer),Ae&&ki.push(on.layoutVertexExtBuffer),$e&&ki.push(on.wallVertexBuffer),Dn.draw(f,M.gl.TRIANGLES,x,b,E,qt,bi,c.id,on.layoutVertexBuffer,on.indexBuffer,mi,c.paint,f.transform.zoom,Vn,ki)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Sh{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ul(f,n,c,p,x,b,E,I,M,z,O,H,G,$,J,Y,ee,re,pe,fe){const ue=n.context,Ie=ue.gl,Te=n.transform,Ae=n.transform.zoom,ve=[],ge=f.translate,Pe=f.translateAnchor,Le=f.edgeRadius,Fe=Yo(n,f.cutoffFadeRange);O==="clear"?(ve.push("CLEAR_SUBPASS"),fe&&(ve.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(Ie.TEXTURE0),fe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):O==="sdf"?ve.push("SDF_SUBPASS"):O==="emissive"&&(ve.push("USE_MRT1"),ue.activeTexture.set(Ie.TEXTURE0),fe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)),re&&ve.push("HAS_CENTROID"),Fe.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const We=($e,lt,xt,Qe,ke)=>{let mt=ve;lt.groundRadiusBuffer!=null&&(mt=ve.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const nt=lt.programConfigurations.get(p.id),yt=n.isTileAffectedByFog($e),Pt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:mt,overrideFog:yt}),qt=((kt,cn,an,$t,on,xn,Mn,Vn,ti,Dn,jn)=>({u_matrix:cn,u_opacity:an,u_ao_pass:$t?1:0,u_meter_to_tile:on,u_ao:xn,u_flood_light_intensity:Mn,u_flood_light_color:Vn,u_attenuation:ti,u_edge_radius:Dn,u_fb:0,u_fb_size:jn,u_dynamic_offset:1}))(0,Qe,H,z,ke,[G,$*ke],J,Y,ee,Ae>=17?0:Le*ke,fe?fe.size[0]:0),zt=[];re&&zt.push(lt.hiddenByLandmarkVertexBuffer),lt.groundRadiusBuffer!=null&&zt.push(lt.groundRadiusBuffer),n.uploadCommonUniforms(ue,Pt,$e.toUnwrapped(),null,Fe),Pt.draw(n,ue.gl.TRIANGLES,b,E,I,M,qt,p.id,lt.vertexBuffer,lt.indexBuffer,xt,p.paint,Ae,nt,zt)};for(const $e of x){const lt=c.getTile($e),xt=lt.getBucket(p);if(!xt||xt.projection.name!==Te.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const Qe=xt.groundEffect,ke=1/xt.tileToMeter;{const mt=n.translatePosMatrix($e.projMatrix,lt,ge,Pe),nt=Qe.getDefaultSegment();We($e,Qe,nt,mt,ke)}if(pe)for(let mt=0;mt<4;mt++){const nt=s.e9[mt]($e),yt=c.getTile(nt);if(!yt)continue;const Pt=yt.getBucket(p);if(!Pt||Pt.projection.name!==Te.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const qt=Pt.groundEffect;let zt,kt;mt===0?(zt=[-s.al,0,0],kt=1):mt===1?(zt=[s.al,0,0],kt=0):mt===2?(zt=[0,-s.al,0],kt=3):(zt=[0,s.al,0],kt=2);const cn=qt.regionSegments[kt];if(!cn)continue;const an=new Float32Array(16);s.br(an,$e.projMatrix,zt),We($e,qt,cn,n.translatePosMatrix(an,lt,ge,Pe),ke)}}}function tg(f,n,c,p,x,b,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=b?b.findDEMTileFor(c):null;if(!(I&&I.dem||E))return;b&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const M=(ee,re)=>{(ee.flags|re.flags)&s.ec?(ee.flags|=s.ec,re.flags|=s.ec):(ee.flags&=~s.ec,re.flags&=~s.ec)},z=ee=>new s.P(Math.ceil((ee+s.ed)*s.ee),0),O=ee=>{const re=n.getSource().minzoom,pe=ue=>{const Ie=n.getTileByID(ue);if(Ie&&Ie.hasData())return Ie.getBucket(x)},fe=[0,-1,1];for(const ue of fe){if(ee.overscaledZ+ue<re)continue;const Ie=pe(ee.calculateScaledKey(ee.overscaledZ+ue));if(Ie)return Ie}},H=[0,0,0],G=(ee,re)=>(H[0]=Math.min(ee.min.y,re.min.y),H[1]=Math.max(ee.max.y,re.max.y),H[2]=s.al-re.min.x>ee.max.x?re.min.x-s.al:ee.max.x,H),$=(ee,re)=>(H[0]=Math.min(ee.min.x,re.min.x),H[1]=Math.max(ee.max.x,re.max.x),H[2]=s.al-re.min.y>ee.max.y?re.min.y-s.al:ee.max.y,H),J=[(ee,re)=>G(ee,re),(ee,re)=>G(re,ee),(ee,re)=>$(ee,re),(ee,re)=>$(re,ee)],Y=(ee,re,pe,fe,ue,Ie,Te)=>{if(!b)return 0;const Ae=[[Ie?pe:ee,Ie?ee:pe,0],[Ie?pe:re,Ie?re:pe,0]],ve=Te<0?s.al+Te:Te,ge=[Ie?ve:(ee+re)/2,Ie?(ee+re)/2:ve,0];return pe===0&&Te<0||pe!==0&&Te>0?b.getForTilePoints(ue,[ge],!0,fe):Ae.push(ge),b.getForTilePoints(c,Ae,!0,I),Math.max(Ae[0][2],Ae[1][2],ge[2])/b.exaggeration()};for(let ee=0;ee<4;ee++){const re=p.borderFeatureIndices[ee];if(re.length===0)continue;const pe=s.e9[ee](c),fe=O(pe);if(!(fe&&fe instanceof s.ea))continue;const ue=b?b.findDEMTileFor(pe):null;if(!(ue&&ue.dem||E)||(b&&ue&&ue.dem&&p.borderDEMTileTimestamp[ee]!==ue.dem._timestamp&&(p.borderDoneWithNeighborZ[ee]=-1,p.borderDEMTileTimestamp[ee]=ue.dem._timestamp),p.borderDoneWithNeighborZ[ee]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const Ie=(ee<2?1:5)-ee,Te=fe.borderDoneWithNeighborZ[Ie]!==p.canonical.z,Ae=fe.borderFeatureIndices[Ie];let ve=0;if(p.canonical.z!==fe.canonical.z){for(const ge of re)p.showCentroid(p.featuresOnBorder[ge]);if(Te)for(const ge of Ae)fe.showCentroid(fe.featuresOnBorder[ge]);p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ie]=p.canonical.z}for(const ge of re){const Pe=p.featuresOnBorder[ge],Le=p.centroidData[Pe.centroidDataIndex],Fe=Pe.borders[ee];let We;for(;ve<Ae.length;){We=fe.featuresOnBorder[Ae[ve]];const $e=We.borders[Ie];if($e[1]>Fe[0]+3||$e[0]>Fe[0]-3)break;fe.showCentroid(We),ve++}if(We&&ve<Ae.length){const $e=ve;let lt=0;for(;!(We.borders[Ie][0]>Fe[1]-3)&&(lt++,++ve!==Ae.length);)We=fe.featuresOnBorder[Ae[ve]];We=fe.featuresOnBorder[Ae[$e]];let xt=!1;if(lt>=1){const mt=We.borders[Ie];Math.abs(Fe[0]-mt[0])<3&&Math.abs(Fe[1]-mt[1])<3&&(lt=1,xt=!0,ve=$e+1)}else if(lt===0){p.showCentroid(Pe);continue}const Qe=fe.centroidData[We.centroidDataIndex];E&&xt&&M(Le,Qe);const ke=Pe.intersectsCount()>1||We.intersectsCount()>1;if(lt>1)ve=$e,Le.centroidXY=Qe.centroidXY=new s.P(0,0);else if(ue&&ue.dem&&!ke){const mt=J[ee](Le,Qe),nt=ee%2?s.al-1:0,yt=Y(mt[0],Math.min(s.al-1,mt[1]),nt,ue,pe,ee<2,mt[2]);Le.centroidXY=Qe.centroidXY=z(yt)}else ke?Le.centroidXY=Qe.centroidXY=new s.P(0,0):(Le.centroidXY=p.encodeBorderCentroid(Pe),Qe.centroidXY=fe.encodeBorderCentroid(We));p.writeCentroidToBuffer(Le),fe.writeCentroidToBuffer(Qe)}else p.showCentroid(Pe)}p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ie]=p.canonical.z}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const A_=[1,0,0],Vp=[0,1,0],jp=[0,0,1];function Nf(f,n,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const b=f.toUnwrapped(),E=p.tileSize*x._cascades[c.currentShadowCascade].scale;let I=n;if(p.elevation){const Y=p.elevation.getMinMaxForTile(f);Y&&(I+=Y.max)}const M=[...x.shadowDirection];M[2]=-M[2];const z=x.computeSimplifiedTileShadowVolume(b,I,E,M);if(!z)return!1;const O=[A_,Vp,jp,M,[M[0],0,M[2]],[0,M[1],M[2]]],H=p.projection.name==="globe",G=p.scaleZoom(E),$=s.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,G,!H),J=x.getCurrentCascadeFrustum();return $.intersectsPrecise(z.vertices,z.planes,O)===0||J.intersectsPrecise(z.vertices,z.planes,O)===0}function Qs(f){const{painter:n,source:c,layer:p,coords:x}=f;let b=f.defines;const E=n.context,I=n.renderPass==="shadow",M=n.renderPass==="light-beam",z=n.shadowRenderer,O=s.ef(n.transform.center.lat,n.transform.zoom),H=Yo(n,p.paint.get("building-cutoff-fade-range"));H.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const G of x){const $=c.getTile(G),J=$.getBucket(p);if(!J)continue;z&&z.getMaxCascadeForTile(G.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const Y=J.programConfigurations.get(p.id);let ee,re,pe,fe=n.translatePosMatrix(G.expandedProjMatrix,$,[0,0],"map");if(fe=s.cS(s.bC(),fe,[1,1,f.verticalScale]),I&&z){if(Nf($.tileID,J.maxHeight*O,n))continue;let Ie=z.calculateShadowPassMatrixFromTile($.tileID.toUnwrapped());Ie=s.cS(s.bC(),Ie,[1,1,f.verticalScale]),pe=uo(Ie),ee=re=n.getOrCreateProgram("buildingDepth",{config:Y,defines:b,overrideFog:!1})}else if(M)ee=re=n.getOrCreateProgram("buildingBloom",{config:Y,defines:b,overrideFog:!1}),pe=Jm(fe);else{const Ie=n.transform.calculatePosMatrix(G.toUnwrapped(),n.transform.worldSize);s.cS(Ie,Ie,[1,1,f.verticalScale]);const Te=s.bC();s.cS(Te,Ie,[1,-1,1/O]),s.bl(Te,Te),s.eg(Te,Te);const Ae=n.transform.getFreeCameraOptions().position,ve=1<<G.canonical.z;if(pe=_c(fe,Te,f.opacity,f.facadeAOIntensity,[((Ae.x-G.wrap)*ve-G.canonical.x)*s.al,(Ae.y*ve-G.canonical.y)*s.al,Ae.z*ve*s.al],J.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),re=n.getOrCreateProgram("building",{config:Y,defines:b,overrideFog:!1}),f.depthOnly===!0)ee=re;else{const ge=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ee=n.getOrCreateProgram("building",{config:Y,defines:ge,overrideFog:!1})}z&&(z.setupShadowsFromMatrix(Ie,re,!0),ee!==re&&z.setupShadowsFromMatrix(Ie,ee,!0))}const ue=(Ie,Te)=>{if(M){const Ae=Ie.entranceBloom;Te.draw(n,E.gl.TRIANGLES,f.depthMode,Ln.disabled,f.blendMode,Rn.disabled,pe,p.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segmentsBucket,p.paint,n.transform.zoom,Y,[Ae.layoutAttenuationBuffer,Ae.layoutColorBuffer])}else{const Ae=Ie.segmentsBucket;let ve=[Ie.layoutNormalBuffer,Ie.layoutCentroidBuffer,Ie.layoutColorBuffer,Ie.layoutFloodLightDataBuffer];Ie.layoutFacadePaintBuffer&&(ve=ve.concat([Ie.layoutFacadeDataBuffer,Ie.layoutFacadeVerticalRangeBuffer,Ie.layoutFacadePaintBuffer])),Te.draw(n,E.gl.TRIANGLES,f.depthMode,Ln.disabled,f.blendMode,I?Rn.disabled:Rn.backCW,pe,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ae,p.paint,n.transform.zoom,Y,ve)}};n.uploadCommonUniforms(E,re,G.toUnwrapped(),null,H),J.buildingWithoutFacade&&ue(J.buildingWithoutFacade,re),J.buildingWithFacade&&(ee!==re&&n.uploadCommonUniforms(E,ee,G.toUnwrapped(),null,H),ue(J.buildingWithFacade,ee))}}function ys(f,n,c,p,x,b,E,I,M,z,O,H,G){const $=f.context.gl,J=f.depthModeForSublayer(1,mn.ReadOnly,$.LEQUAL,!0),Y=.1*(1-(ee=O))+3*ee;var ee;const re=f._showOverdrawInspector,pe=H,fe=new Sh;re||Ul(fe,f,n,c,p,J,new Ln({func:$.ALWAYS,mask:255},255,255,$.KEEP,$.KEEP,$.REPLACE),new zn([$.ONE,$.ONE,$.ONE,$.ONE],s.ao.transparent,[!1,!1,!1,!0],$.MIN),Rn.disabled,x,"sdf",b,E,I,M,z,Y,pe,!1);{const ue=re?Ln.disabled:new Ln({func:$.EQUAL,mask:255},255,255,$.KEEP,$.DECR,$.DECR),Ie=re?f.colorModeForRenderPass():new zn([$.ONE_MINUS_DST_ALPHA,$.DST_ALPHA,$.ONE,$.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ul(fe,f,n,c,p,J,ue,Ie,Rn.disabled,x,"color",b,E,I,M,z,Y,pe,!1)}}function Ed(f){return[f[0]*s.eh,f[1]*s.eh,f[2]*s.eh,0]}function Lu(f,n,c,p,x,b,E,I,M){const z=p.getSource(),O=c.globeSharedBuffers;if(!O)return;let H,G,$;if(n&&(H=p.getTile(n)),z instanceof s.aU?(G=z.texture,$=s.dK(0,0,c.transform)):H&&n&&(G=H.texture,$=s.dK(n.canonical.z,n.canonical.x,c.transform)),!G||!$)return;f||($=s.cS(s.bC(),$,[1,-1,1]));const J=c.context,Y=J.gl,ee=x.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,re=c.colorModeForDrapableLayerRenderPass(b),pe=E.defines;pe.push("GLOBE_POLES");const fe=new mn(Y.LEQUAL,mn.ReadWrite,c.depthRangeFor3D),ue=Float32Array.from(c.transform.expandedFarZProjMatrix),Ie=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),J.activeTexture.set(Y.TEXTURE0),G.bind(ee,Y.CLAMP_TO_EDGE),J.activeTexture.set(Y.TEXTURE1),G.bind(ee,Y.CLAMP_TO_EDGE),"useMipmap"in G&&J.extTextureFilterAnisotropic&&c.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Te,Ae,ve,ge]=n?O.getPoleBuffers(n.canonical.z,!1):O.getPoleBuffers(0,!0),Pe=x.paint.get("raster-elevation");let Le;f?(Le=Te,c.renderDefaultNorthPole=Pe!==0):(Le=Ae,c.renderDefaultSouthPole=Pe!==0);const Fe=Ed(E.mix),We=((lt,xt,Qe,ke,mt,nt,yt,Pt,qt,zt,kt,cn,an)=>yh(lt,xt,Qe,new Float32Array(16),new Float32Array(9),[0,0],ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},nt,[0,0],Pt,2,zt,kt,cn,1,0,an))(ue,Ie,$,s.aj(c.transform.zoom),0,x,0,Pe,0,Fe,E.offset,E.range,b),$e=c.getOrCreateProgram("raster",{defines:pe});c.uploadCommonUniforms(J,$e,null),$e.draw(c,Y.TRIANGLES,fe,M,re,I,We,x.id,Le,ve,ge)}function Bf(f){if(f.isOrthographic)return[0,0,0,0];const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,b=n+x;return[n,c,(b-x-n)/p,(b-n)/p]}function Up(f,n,c,p){if(f)return n instanceof aa&&f instanceof zc?n.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:Ed(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Gl=s.ei([{name:"a_index",type:"Int16",components:1}]);class Ff{constructor(n,c,p,x){const b={width:p[0],height:p[1],data:null},E=n.gl;this.targetColorTexture=new s.T(n,b,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,E.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(n,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ej;b.reserve(x);for(let E=0;E<x;E++)b.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(b,Gl.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Vf(f,n,c){if(!f)return null;const p=n.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:x,mix:b,offset:E,tileSize:I,buffer:M,format:z}=p;if(!x||!z)return null;let O=!1;return z==="uint32"&&(O=!0,b[3]=0,b=Td(s.ek,b,[0,c.paint.get("raster-particle-max-speed")]),E=Bp(s.ek,E,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:O,scale:b,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Gp(f){const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,b=n+x;return[n,c,(b-x-n)/p,(b-n)/p]}const qp=new s.ao(1,0,0,1),Hp=new s.ao(0,1,0,1),$p=new s.ao(0,0,1,1),I_=new s.ao(1,0,1,1),C_=new s.ao(0,1,1,1);function ng(f,n,c,p,x,b){for(let E=0;E<c.length;E++)if(x){const z=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);bc(f,n,c[E],p,-1,-1,b),bc(f,n,c[E],p,-1,1,b),bc(f,n,c[E],p,1,1,b),bc(f,n,c[E],p,1,-1,b),bc(f,n,c[E],z,0,0,b)}else bc(f,n,c[E],p,0,0,b)}function bc(f,n,c,p,x,b,E){const I=f.context,M=f.transform,z=I.gl,O=M.projection.name==="globe",H=O?["PROJECTION_GLOBE_VIEW"]:[];let G=s.bz(c.projMatrix);if(O&&s.aj(M.zoom)>0){const Fe=s.bj(c.canonical,M),We=s.el(Fe);G=s.aB(new Float32Array(16),M.globeMatrix,We),s.aB(G,M.projMatrix,G)}const $=s.bC();$[12]+=2*x/(s.o.devicePixelRatio*M.width),$[13]+=2*b/(s.o.devicePixelRatio*M.height),s.aB(G,$,G);const J=f.getOrCreateProgram("debug",{defines:H}),Y=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(Y,J);const ee=mn.disabled,re=Ln.disabled,pe=f.colorModeForRenderPass(),fe="$debug";I.activeTexture.set(z.TEXTURE0),f.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),O?Y._makeGlobeTileDebugBuffers(f.context,M):Y._makeDebugTileBoundsBuffers(f.context,M.projection);const ue=Y._tileDebugBuffer||f.debugBuffer,Ie=Y._tileDebugIndexBuffer||f.debugIndexBuffer,Te=Y._tileDebugSegments||f.debugSegments;if(J.draw(f,z.LINE_STRIP,ee,re,pe,Rn.disabled,yc(G,p.toPremultipliedRenderColor(null)),fe,ue,Ie,Te,null,null,null,[Y._globeTileDebugBorderBuffer]),E){const Fe=Y.latestRawTileData,We=Math.floor((Fe&&Fe.byteLength||0)/1024);let $e=c.canonical.toString();c.overscaledZ!==c.canonical.z&&($e+=` => ${c.overscaledZ}`),$e+=` ${Y.state}`,$e+=` ${We}kb`,(function(lt,xt){lt.initDebugOverlayCanvas();const Qe=lt.debugOverlayCanvas,ke=lt.context.gl,mt=lt.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Qe.width,Qe.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(xt,5,5),mt.strokeText(xt,5,5),lt.debugOverlayTexture.update(Qe),lt.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)})(f,$e)}const Ae=n.getTile(c).tileSize,ve=512/Math.min(Ae,512)*(c.overscaledZ/M.zoom)*.5,ge=Y._tileDebugTextBuffer||f.debugBuffer,Pe=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Le=Y._tileDebugTextSegments||f.debugSegments;J.draw(f,z.TRIANGLES,ee,re,zn.alphaBlended,Rn.disabled,yc(G,s.ao.transparent.toPremultipliedRenderColor(null),ve),fe,ge,Pe,Le,null,null,null,[Y._globeTileDebugTextBuffer])}function ig(f,n,c,p){jf(f,0,n+c/2,f.transform.width,c,p)}function rg(f,n,c,p){jf(f,n-c/2,0,c,f.transform.height,p)}function jf(f,n,c,p,x,b){const E=f.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*s.o.devicePixelRatio,c*s.o.devicePixelRatio,p*s.o.devicePixelRatio,x*s.o.devicePixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}const sg=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:R_}=sg;function wc(f,n,c,p){f.emplaceBack(n,c,p)}class Wa{constructor(n){this.vertexArray=new s.em,this.indices=new s.b0,wc(this.vertexArray,-1,-1,1),wc(this.vertexArray,1,-1,1),wc(this.vertexArray,-1,1,1),wc(this.vertexArray,1,1,1),wc(this.vertexArray,-1,-1,-1),wc(this.vertexArray,1,-1,-1),wc(this.vertexArray,-1,1,-1),wc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,R_),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function tu(f,n,c,p,x,b){const E=f.context.gl,I=n.paint.get("sky-atmosphere-color"),M=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),O=((H,G,$,J,Y)=>({u_matrix_3f:H,u_sun_direction:G,u_sun_intensity:$,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(s.eo(s.dO(),p),x,z,I.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),c.draw(f,E.TRIANGLES,mn.disabled,Ln.disabled,zn.unblended,Rn.frontCW,O,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ka=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nu{constructor(n){const c=new s.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new s.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,ka.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ag=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class og{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zp{constructor(n){this.colorModeAlphaBlendedWriteRGB=new zn([1,bu,1,bu],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new zn([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new og,this.updateNeeded=!0}update(n){const c=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new nu(c);const p=this.params.sizeRange,x=this.params.intensityRange,b=(function(O){const H=s.eq(30),G=[];for(let $=0;$<O;++$){const J=2*Math.PI*H(),Y=Math.acos(1-2*H())-.5*Math.PI;G.push(s.d5(Math.cos(Y)*Math.cos(J),Math.cos(Y)*Math.sin(J),Math.sin(Y)))}return G})(this.params.starsCount),E=s.eq(300),I=new s.er,M=new s.b0;let z=0;for(let O=0;O<b.length;++O){const H=s.c5([],b[O],200),G=Math.max(0,1+.01*p*(1*E()-.5)),$=Math.max(0,1+.01*x*(1*E()-.5));I.emplaceBack(H[0],H[1],H[2],-1,-1,G,$),I.emplaceBack(H[0],H[1],H[2],1,-1,G,$),I.emplaceBack(H[0],H[1],H[2],1,1,G,$),I.emplaceBack(H[0],H[1],H[2],-1,1,G,$),M.emplaceBack(z+0,z+1,z+2),M.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(I,ag.members),this.starsIdx=c.createIndexBuffer(M),this.starsSegments=s.bg.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,c){const p=n.context,x=p.gl,b=n.transform,E=new mn(x.LEQUAL,mn.ReadOnly,[0,1]),I=s.aj(b.zoom),M=n.style.getLut(c.scope),z=c.properties.get("color-use-theme")==="none",O=c.properties.get("color").toNonPremultipliedRenderColor(z?null:M),H=c.properties.get("high-color-use-theme")==="none",G=c.properties.get("high-color").toNonPremultipliedRenderColor(H?null:M),$=c.properties.get("space-color-use-theme")==="none",J=c.properties.get("space-color").toNonPremultipliedRenderColor($?null:M),Y=5e-4,ee=s.es(c.properties.get("horizon-blend"),0,1,Y,.25),re=s.dE(n,p,b)&&ee===Y?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,pe=n.frameCounter/1e3%1,fe=s.ag(b.globeCenterInViewSpace),ue=Math.sqrt(Math.pow(fe,2)-Math.pow(re,2)),Ie=Math.acos(ue/fe),Te=Ae=>{const ve=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ae&&ve.push("ALPHA_PASS");const ge=n.getOrCreateProgram("globeAtmosphere",{defines:ve}),Pe=((Fe,We,$e,lt,xt,Qe,ke,mt,nt,yt,Pt,qt)=>({u_frustum_tl:Fe,u_frustum_tr:We,u_frustum_br:$e,u_frustum_bl:lt,u_horizon:xt,u_transition:Qe,u_fadeout_range:ke,u_atmosphere_fog_color:mt.toArray01(),u_high_color:nt.toArray01(),u_space_color:yt.toArray01(),u_temporal_offset:Pt,u_horizon_angle:qt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,ee,O,G,J,pe,Ie);n.uploadCommonUniforms(p,ge);const Le=this.atmosphereBuffer;Le&&ge.draw(n,x.TRIANGLES,E,Ln.disabled,Ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Rn.backCW,Pe,Ae?"atmosphere_glow_alpha":"atmosphere_glow",Le.vertexBuffer,Le.indexBuffer,Le.segments)};Te(!1),Te(!0)}drawStars(n,c){const p=s.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=n.context,b=x.gl,E=n.transform,I=n.getOrCreateProgram("stars"),M=s.c7([]);s.c9(M,M,-E._pitch),s.c8(M,M,-E.angle),s.c9(M,M,s.an(E._center.lat)),s.et(M,M,-s.an(E._center.lng));const z=s.cc(new Float32Array(16),M),O=s.aB([],E.starsProjMatrix,z),H=s.eo([],z),G=s.eu([],H),$=[0,1,0];s.dQ($,$,G),s.c5($,$,this.params.sizeMultiplier);const J=[1,0,0];s.dQ(J,J,G),s.c5(J,J,this.params.sizeMultiplier);const Y=(ee=$,re=J,pe=p,{u_matrix:Float32Array.from(O),u_up:ee,u_right:re,u_intensity_multiplier:pe});var ee,re,pe;n.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(n,b.TRIANGLES,mn.disabled,Ln.disabled,this.colorModeAlphaBlendedWriteRGB,Rn.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class zu{constructor(){this.visibleTiles=[]}updateBorders(n,c){const p=[],x=[],b=n._getRenderableCoordinates(!1,!0);for(const M of b){const z=n.getTile(M);if(!z.hasData())continue;const O=z.getBucket(c);O&&(O.isEmpty()||(p.push(M.key),x.push({bucket:O,tileID:M.canonical})))}let E=p.length!==this.visibleTiles.length;if(!E){p.sort();for(let M=0;M<p.length;M++)if(p[M]!==this.visibleTiles[M]){E=!0;break}}if(!E)return;const I=new Set;this.visibleTiles=p,x.sort((M,z)=>M.tileID.z-z.tileID.z||M.tileID.x-z.tileID.x||M.tileID.y-z.tileID.y);for(const M of x){const z=new Array,O=new Array,H=M.bucket;for(const G of H.featuresOnBorder)I.has(G.featureId)?O.push(G.footprintIndex):(I.add(G.featureId),z.push(G.footprintIndex));H.updateFootprintHiddenFlags(z,s.ev,!1),H.updateFootprintHiddenFlags(O,s.ev,!0)}}}function Wp(f,n){const c=[...f],p=n.cameraWorldSizeForFog/n.worldSize,x=s.bA([]);return s.cS(x,x,[p,p,1]),s.aB(c,x,c),s.aB(c,n.worldToFogMatrix,c),c}function No(f,n,c,p,x){const b=c.material,E=p.context,{baseColorTexture:I,metallicRoughnessTexture:M}=b.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:O,emissionTexture:H}=b;function G(J,Y,ee){if(J&&(f.push(Y),E.activeTexture.set(E.gl.TEXTURE0+ee),J.gfxTexture)){const{minFilter:re,magFilter:pe,wrapS:fe,wrapT:ue}=J.sampler;J.gfxTexture.bindExtraParam(re,pe,fe,ue)}}G(I,"HAS_TEXTURE_u_baseColorTexture",5),G(M,"HAS_TEXTURE_u_metallicRoughnessTexture",6),G(z,"HAS_TEXTURE_u_normalTexture",7),G(O,"HAS_TEXTURE_u_occlusionTexture",8),G(H,"HAS_TEXTURE_u_emissionTexture",9),x&&(x.texture||(x.texture=new s.d$(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+10),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(c.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const $=p.shadowRenderer;$&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Pi(f,n,c,p,x,b){const E=f.modelOpacity,I=n.context,M=new mn(n.context.gl.LEQUAL,f.isLightMesh?mn.ReadOnly:mn.ReadWrite,n.depthRangeFor3D),z=n.transform,O=f.mesh,H=O.material,G=H.pbrMetallicRoughness,$=n.style.fog;let J;J=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],p.zScaleMatrix,f.nodeModelMatrix),s.aB(J,p.negCameraPosMatrix,J);const Y=s.bl([],J);s.eg(Y,Y);const ee=c.paint.get("model-color-use-theme").constantOr("default")==="none",re=c.paint.get("model-emissive-strength").constantOr(0),pe=jl(new Float32Array(f.worldViewProjection),new Float32Array(J),new Float32Array(Y),null,n,E,G.baseColorFactor,H.emissiveFactor,G.metallicFactor,G.roughnessFactor,H,re,c,void 0,void 0,f.materialOverride,f.modelColor),fe={defines:[]},ue=[],Ie=n.shadowRenderer;Ie&&(Ie.useNormalOffset=!1),No(fe.defines,ue,O,n,ee?null:c.lut);let Te=null;if($){const ge=Wp(f.nodeModelMatrix,n.transform);if(Te=new Float32Array(ge),z.projection.name!=="globe"){const Pe=O.aabb.min,Le=O.aabb.max,[Fe,We]=$.getOpacityForBounds(ge,Pe[0],Pe[1],Le[0],Le[1]);fe.overrideFog=Fe>=tn||We>=tn}}const Ae=Yo(n,c.paint.get("model-cutoff-fade-range"));Ae.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const ve=n.getOrCreateProgram("model",fe);n.uploadCommonUniforms(I,ve,null,Te,Ae),n.renderPass!=="shadow"&&Ie&&Ie.setupShadowsFromMatrix(f.nodeModelMatrix,ve),ve.draw(n,I.gl.TRIANGLES,M,x,b,O.material.doubleSided?Rn.disabled:Rn.backCCW,pe,c.id,O.vertexBuffer,O.indexBuffer,O.segments,c.paint,n.transform.zoom,void 0,ue)}function Sd(f,n){return f.style._importedAsBasemap?"basemap":n.scope}function Ah(f,n,c,p,x,b,E,I,M,z){const O=f.transform,H=!!n.isGeometryBloom&&n.isGeometryBloom;if(H&&f.renderPass==="shadow")return;const G=O.projection.name==="globe"?s.eD(c,O):[...c];s.aB(G,G,n.globalMatrix);const $=s.aB([],p,G);if(n.meshes)for(const J of n.meshes){const Y=I.get(J.material.name);if(Y&&Y.opacity<=0)continue;if(J.material.alphaMode!=="BLEND"){E.push({mesh:J,depth:0,modelIndex:x,worldViewProjection:$,nodeModelMatrix:G,isLightMesh:H,materialOverride:Y,modelOpacity:M,modelColor:z});continue}const ee=s.af([],J.centroid,$);!O.isOrthographic&&ee[2]<=0||b.push({mesh:J,depth:ee[2],modelIndex:x,worldViewProjection:$,nodeModelMatrix:G,isLightMesh:H,materialOverride:Y,modelOpacity:M,modelColor:z})}if(n.children)for(const J of n.children)Ah(f,J,c,p,x,b,E,I,M,z)}function Ad(f,n,c,p){const x=c.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(n),M=wh(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,b,Ln.disabled,E,Rn.disabled,M,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function lg(f,n,c,p,x,b){for(const E of x){const I=Object.assign({},p);I.part=E;const M={type:"Unknown",id:n,properties:I},z={orientation:f.paint.get("model-rotation").evaluate(M,c)};b.set(E,z)}}function cg(f,n,c,p,x,b){for(const E of x){const I=Object.assign({},p);I.part=E;const M={type:"Unknown",id:n,properties:I},z={color:f.paint.get("model-color").evaluate(M,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(M,c),opacity:f.paint.get("model-opacity").evaluate(M,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(M,c)};b.set(E,z)}}function Xp(f,n,c,p,x){let b=!1;for(const I of p)I.modelOpacity!==1&&(Pi(I,f,n,x[I.modelIndex],Ln.disabled,zn.disabled),b=!0);for(const I of p)Pi(I,f,n,x[I.modelIndex],I.modelOpacity!==1?f.stencilModeFor3D():Ln.disabled,f.colorModeForRenderPass());b&&f.resetStencilClippingMasks();const E=zn.additive;for(const I of c)Pi(I,f,n,x[I.modelIndex],Ln.disabled,I.isLightMesh?E:f.colorModeForRenderPass())}function Ou(f,n,c){const p=n.updateZoomBasedPaintProperties(),x=(function(b,E,I){let M,z,O,H=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&H>0){const G=b.terrain,$=G.findDEMTileFor(I);$&&$.dem?M=s.eF.create(G,I,$):H=0}if(H===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),H===E.validForExaggeration&&(H===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const G in E.instancesPerModel){const $=E.instancesPerModel[G];for(let J=0;J<$.instancedDataArray.length;++J){const Y=(M?H*M.getElevationAt(0|$.instancedDataArray.float32[16*J],0|$.instancedDataArray.float32[16*J+1],!0,!0):0)+$.instancesEvaluatedElevation[J];$.instancedDataArray.float32[16*J+6]=Y,z=z?Math.min(E.terrainElevationMin,Y):Y,O=O?Math.max(E.terrainElevationMax,Y):Y}}return E.terrainElevationMin=z||0,E.terrainElevationMax=O||0,E.validForExaggeration=H,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,n,c);(p||x)&&(n.uploaded=!1,n.upload(f.context))}const La={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function Ot(f,n){const c=1<<f.canonical.z,p=n.getFreeCameraOptions().position,x=n.elevation,b=f.canonical.x/c,E=(f.canonical.x+1)/c,I=f.canonical.y/c,M=(f.canonical.y+1)/c;let z=n._centerAltitude;if(x){const $=x.getMinMaxForTile(f);$&&$.max>z&&(z=$.max)}const O=s.aA(p.x,b,E)-p.x,H=s.aA(p.y,I,M)-p.y,G=s.cf(z,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(O*O+H*H+G*G))}function Xt(f,n,c,p,x,b,E){const I=f.context,M=f.renderPass==="shadow",z=f.shadowRenderer,O=M&&z?z.getShadowPassDepthMode():new mn(I.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),H=f.isTileAffectedByFog(b),G=f.transform.projection.name==="globe";if(c.meshes)for(const $ of c.meshes){const J=G?[]:["MODEL_POSITION_ON_GPU"],Y=[];let ee,re,pe;const fe=!G&&p.instancedDataArray.length>20;fe&&J.push("INSTANCED_ARRAYS");const ue=Yo(f,n.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),M&&z)ee=f.getOrCreateProgram("modelDepth",{defines:J}),re=wh(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.globalMatrix)),pe=z.getShadowPassColorMode();else{No(J,Y,$,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),ee=f.getOrCreateProgram("model",{defines:J,overrideFog:H});const Te=$.material,Ae=Te.pbrMetallicRoughness,ve=n.paint.get("model-opacity").constantOr(1),ge=n.paint.get("model-emissive-strength").constantOr(0);re=jl(b.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,ve,Ae.baseColorFactor,Te.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,Te,ge,n,x),z&&(E.shadowUniformsInitialized?ee.setShadowUniformValues(I,z.getShadowUniformValues()):(z.setupShadows(b.toUnwrapped(),ee,"model-tile"),E.shadowUniformsInitialized=!0)),pe=ue.shouldRenderCutoff||ve<1||Te.alphaMode!=="OPAQUE"?zn.alphaBlended:zn.unblended}f.uploadCommonUniforms(I,ee,b.toUnwrapped(),null,ue);const Ie=$.material.doubleSided?Rn.disabled:Rn.backCCW;if(fe)Y.push(p.instancedDataBuffer),ee.draw(f,I.gl.TRIANGLES,O,Ln.disabled,pe,Ie,re,n.id,$.vertexBuffer,$.indexBuffer,$.segments,n.paint,f.transform.zoom,void 0,Y,p.instancedDataArray.length);else{const Te=M?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<p.instancedDataArray.length;++Ae)re[Te]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ae,16),ee.draw(f,I.gl.TRIANGLES,O,Ln.disabled,pe,Ie,re,n.id,$.vertexBuffer,$.indexBuffer,$.segments,n.paint,f.transform.zoom,void 0,Y)}}if(c.children)for(const $ of c.children)Xt(f,n,$,p,x,b,E)}const Ih=[1,-1,1];function wr(f,n,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const b=c.shadowRenderer,E=n.aabb;let I=!0,M=f.maxHeight;if(M===0){let O=0;for(const H in f.instancesPerModel){const G=x.getModel(H,p);G?O=Math.max(O,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):I=!1}M=f.maxScale*O*1.41+f.maxVerticalOffset,I&&(f.maxHeight=M)}E.max[2]=M,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,s.af(E.min,E.min,n.tileMatrix),s.af(E.max,E.max,n.tileMatrix);const z=E.intersects(b.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=z===2),z===0}function Ze(f,n){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===c||b===x?1:s.aA(((n-c)/(p-c)-x)/(b-x),0,1)}function ug(f,n,c,p){if(n.pitch<20)return 1;const x=n.getWorldToCameraMatrix();s.aB(x,x,f);const b=s.bU(c.min[0],c.min[1],c.min[2],1);let E=s.aC(s.eG(),b,x),I=E,M=E;b[1]=c.max[1],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,b[0]=c.max[0],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,b[1]=c.min[1],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M;const z=s.aA(p[0],0,1),O=100*n.pixelsPerMeter*s.aA(p[1],0,1),H=s.aA(p[2],0,1),G=s.eH(s.eG(),I,M,z),$=Math.tan(.5*n.fovX),J=-G[2]*$;if(O===0)return G[1]<-Math.abs(J)?H:1;const Y=(-Math.abs(J)-G[1])/O,ee=(pe,fe,ue)=>(1-ue)*pe+ue*fe,re=s.aA(ee(1,H,Y),H,1);return ee(1,re,s.aA((n.pitch-20)/20,0,1))}class Yp{}class Uf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,c,p){{const H=this._storage.get(c.id);if(H)return H.lastUsedFrameIdx=n,H.buf}const x=p.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(b),I=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const M=new s.eJ;for(let H=0;H<b/2;H+=3){const G=I[H],$=I[H+1],J=I[H+2];M.emplaceBack(G,$),M.emplaceBack($,J),M.emplaceBack(J,G)}const z=p.bindVertexArrayOES.current,O=new Yp;return O.buf=new Pa(p,M),O.lastUsedFrameIdx=n,this._storage.set(c.id,O),p.bindVertexArrayOES.set(z),O.buf}update(n){for(const[c,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[n,c]of this._storage)c.buf.destroy(),this._storage.delete(n)}}class Kp{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const hg=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Gf{constructor(n){this.revealStart=11,this.revealRange=2}}const Ch=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class M_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,c){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new s.eK,I=new s.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(E,Ch.members),this.vignetteIdx=n.context.createIndexBuffer(I)}const x=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const E={u_vignetteShape:(b={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,mn.disabled,Ln.disabled,zn.alphaBlended,Rn.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class ex{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,c){const p=n.getFreeCameraOptions().position,x=p.toAltitude(),b=p.toLngLat(),E=s.an(b.lng),I=s.an(b.lat),M=n.pixelsPerMeter/c,z=E*s.eM,O=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+O,G=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*M,this._accumulatedOffsetY+=H*M,this._accumulatedElevation+=G*M,this._offsetXPrev=z,this._offsetYPrev=O,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function dg(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function Id(f){const n=s.eq(1323123451230),c=[];for(let p=0;p<f;++p){const x=2*n()-1,b=2*n()-1,E=2*n()-1;c.push(s.d5(x,b,E))}return c}function Bo(f,n,c,p,x){const b=s.aA((x-c)/(p-c),0,1);return(1-b)*f+b*n}class qf{constructor(n){this._movement=new ex,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new M_,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,c){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,b=s.c7([]);s.c9(b,b,s.an(90)-p._pitch),s.c8(b,b,-p.angle);const E=s.cc(new Float32Array(16),b),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=s.eg([],I),z=s.aB([],M,E),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*c,this._prevTime=O,{projectionMatrix:x,modelviewMatrix:z}}}class Hf extends qf{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Gf("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=Id(this.particlesCount),x=new s.eN,b=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<p.length;++M){const z=p[M],O=[2*I()-1,I(),I(),I()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...O),x.emplaceBack(z[0],z[1],z[2],1,-1,...O),x.emplaceBack(z[0],z[1],z[2],1,1,...O),x.emplaceBack(z[0],z[1],z[2],-1,1,...O),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,hg.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(c.revealStart>p)return;const x=Bo(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let E=[-b.direction.x,b.direction.y,-100];s.aw(E,E);const I=structuredClone(this._vignetteParams);I.strength*=x,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),E=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(n.style.rain.state.vignetteColor));const M=this.updateOnRender(n,b.timeFactor),z=n.context,O=z.gl,H=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(z,{width:n.width,height:n.height,data:null},O.RGBA8)),b.distortionStrength>0&&(z.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const G=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(z,G),z.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const $=[b.color.r,b.color.g,b.color.b,b.color.a],J=(Y,ee)=>{const re=dg(this._movement.getPosition(),Y),pe=b.dropletSizeX,fe=b.dropletSizeX*b.dropletSizeYScale,ue=n.width/2,Ie=n.height/2,Te=Bo(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ae=Bo(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),ve=Bo(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),ge=(Pe={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:Y,rainDropletSize:[pe,fe],distortionStrength:b.distortionStrength,rainDirection:E,color:$,screenSize:[H.width,H.height],thinningCenterPos:[ue,Ie],thinningShape:[Te,Ae,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:ve,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(Pe.modelview),u_projection:Float32Array.from(Pe.projection),u_time:Pe.time,u_cam_pos:Pe.camPos,u_texScreen:0,u_velocityConeAperture:Pe.velocityConeAperture,u_velocity:Pe.velocity,u_boxSize:Pe.boxSize,u_rainDropletSize:Pe.rainDropletSize,u_distortionStrength:Pe.distortionStrength,u_rainDirection:Pe.rainDirection,u_color:Pe.color,u_screenSize:Pe.screenSize,u_thinningCenterPos:Pe.thinningCenterPos,u_thinningShape:Pe.thinningShape,u_thinningAffectedRatio:Pe.thinningAffectedRatio,u_thinningParticleOffset:Pe.thinningParticleOffset,u_shapeDirectionalPower:Pe.shapeDirectionalPower,u_shapeNormalPower:Pe.shapeNormalPower,u_mode:Pe.mode});var Pe;const Le=Math.round(b.intensity*this.particlesCount),Fe=s.bg.simpleSegment(0,0,4*Le,2*Le);G.draw(n,O.TRIANGLES,mn.disabled,Ln.disabled,zn.alphaBlended,Rn.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,Fe)};b.distortionStrength>0&&J(b.boxSize,!0),J(b.boxSize,!1),this._vignette.draw(n,I)}}const $f=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Cd extends qf{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Gf("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=Id(this.particlesCount),x=new s.eO,b=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<p.length;++M){const z=p[M],O=I(),H=I(),G=I(),$=[M/p.length,O,H,G],J=[I(),I()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...$,...J),x.emplaceBack(z[0],z[1],z[2],1,-1,...$,...J),x.emplaceBack(z[0],z[1],z[2],1,1,...$,...J),x.emplaceBack(z[0],z[1],z[2],-1,1,...$,...J),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,$f.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];s.aw(p,p);const x=structuredClone(this._vignetteParams),b=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=n.transform.zoom;if(b.revealStart>E)return;const I=Bo(0,1,b.revealStart,b.revealStart+b.revealRange,E);x.strength*=I,c.overrideStyleParameters||(c.intensity=n.style.snow.state.density,c.timeFactor=n.style.snow.state.intensity,c.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),c.screenThinning.intensity=n.style.snow.state.centerThinning,c.billboardSize=2.79*n.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(n.style.snow.state.vignetteColor));const M=this.updateOnRender(n,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=n.context,O=z.gl,H=n.transform,G=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(z,G),(($,J,Y)=>{const ee=dg(this._movement.getPosition(),$),re=H.width/2,pe=H.height/2,fe=Bo(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),ue=Bo(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ie=Bo(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Te=(Ae={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:$,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[re,pe],thinningShape:[fe,ue,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ie,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:p},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_horizontalOscillationRadius:Ae.horizontalOscillationRadius,u_horizontalOscillationRate:Ae.horizontalOscillationRate,u_boxSize:Ae.boxSize,u_billboardSize:Ae.billboardSize,u_simpleShapeParameters:Ae.simpleShapeParameters,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_particleColor:Ae.color,u_direction:Ae.direction});var Ae;const ve=Math.round(Y.intensity*this.particlesCount),ge=s.bg.simpleSegment(0,0,4*ve,2*ve);this.particlesVx&&this.particlesIdx&&G.draw(n,O.TRIANGLES,mn.disabled,Ln.disabled,zn.alphaBlended,Rn.disabled,Te,"snow_particles",this.particlesVx,this.particlesIdx,ge)})(c.boxSize,0,c),this._vignette.draw(n,x)}}const ql={symbol:function(f,n,c,p,x){if(f.renderPass!=="translucent")return;const b=Ln.disabled,E=f.colorModeForRenderPass(),I=c.layout.get("text-variable-anchor"),M=c.layout.get("text-size-scale-range"),z=s.aA(f.scaleFactor,M[0],M[1]);I&&(function(G,$,J,Y,ee,re,pe,fe){const ue=$.transform,Ie=ee==="map",Te=re==="map";for(const Ae of G){const ve=Y.getTile(Ae),ge=ve.getBucket(J);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const Pe=s.bK(ge.textSizeData,ue.zoom,fe),Le=ro(Ae,ge.getProjection(),ue),Fe=ue.calculatePixelsToTileUnitsMatrix(ve),We=ac(Le,ve.tileID.canonical,Te,Ie,ue,ge.getProjection(),Fe),$e=ge.hasIconTextFit()&&ge.hasIconData();Pe&&Mu(ge,Ie,Te,pe,ue,We,Ae,Math.pow(2,ue.zoom-ve.tileID.overscaledZ),Pe,$e)}})(p,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,z);const O=c.paint.get("icon-opacity").constantOr(1)!==0,H=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||H)?Eh(f,n,c,p,b,E):(O&&Eh(f,n,c,p,b,E,{onlyIcons:!0}),H&&Eh(f,n,c,p,b,E,{onlyText:!0})),n.map.showCollisionBoxes&&(qr(f,n,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),qr(f,n,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,M=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const z=f.context,O=z.gl,H=f.transform,G=!(!f.terrain||!f.terrain.enabled),$=c.layout.get("circle-elevation-reference"),J=f.depthModeForSublayer(0,mn.ReadOnly),Y=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),ee=$==="none"||G?J:Y,re=Ln.disabled,pe=f.colorModeForDrapableLayerRenderPass(M),fe=H.projection.name==="globe",ue=[s.aF(H.center.lng),s.aJ(H.center.lat)],Ie=[];for(let Ae=0;Ae<p.length;Ae++){const ve=p[Ae],ge=n.getTile(ve),Pe=ge.getBucket(c);if(!Pe||Pe.projection.name!==H.projection.name)continue;const Le=Pe.programConfigurations.get(c.id),Fe=Pe.layoutVertexBuffer,We=Pe.globeExtVertexBuffer,$e=Pe.indexBuffer,lt=s.e0(c),xt=[We],Qe=f.isTileAffectedByFog(ve);fe&&lt.push("PROJECTION_GLOBE_VIEW"),lt.push("DEPTH_D24"),f.terrain&&H.depthOcclusionForSymbolsAndCircles&&lt.push("DEPTH_OCCLUSION"),Pe.hasElevation&&!f.terrain&&(lt.push("ELEVATED_ROADS"),xt.push(Pe.elevatedLayoutVertexBuffer));const ke=f.getOrCreateProgram("circle",{config:Le,defines:lt,overrideFog:Qe}),mt=H.projection.createInversionMatrix(H,ve.canonical),nt={programConfiguration:Le,program:ke,layoutVertexBuffer:Fe,dynamicBuffers:xt,indexBuffer:$e,uniformValues:s.e1(f,ve,ge,mt,ue,c),tile:ge};if(I){const yt=Pe.segments.get();for(const Pt of yt)Ie.push({segments:new s.bg([Pt]),sortKey:Pt.sortKey,state:nt})}else Ie.push({segments:Pe.segments,sortKey:0,state:nt})}I&&Ie.sort((Ae,ve)=>Ae.sortKey-ve.sortKey);const Te={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const Ae of Ie){const{programConfiguration:ve,program:ge,layoutVertexBuffer:Pe,dynamicBuffers:Le,indexBuffer:Fe,uniformValues:We,tile:$e}=Ae.state,lt=Ae.segments;f.terrain&&f.terrain.setupElevationDraw($e,ge,Te),f.uploadCommonUniforms(z,ge,$e.tileID.toUnwrapped()),ge.draw(f,O.TRIANGLES,ee,re,pe,Rn.disabled,We,c.id,Pe,Fe,lt,c.paint,H.zoom,ve,Le)}},heatmap:function(f,n,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,b=x.gl,E=Ln.disabled,I=new zn([b.ONE,b.ONE,b.ONE,b.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function($,J,Y,ee){const re=$.gl,pe=J.width*ee,fe=J.height*ee;$.activeTexture.set(re.TEXTURE1),$.viewport.set([0,0,pe,fe]);let ue=Y.heatmapFbo;if(!ue||ue&&(ue.width!==pe||ue.height!==fe)){ue&&ue.destroy();const Ie=re.createTexture();re.bindTexture(re.TEXTURE_2D,Ie),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),ue=Y.heatmapFbo=$.createFramebuffer(pe,fe,1,null),(function(Te,Ae,ve,ge,Pe,Le){const Fe=Te.gl;Fe.texImage2D(Fe.TEXTURE_2D,0,Te.extRenderToTextureHalfFloat?Fe.RGBA16F:Fe.RGBA,Pe,Le,0,Fe.RGBA,Te.extRenderToTextureHalfFloat?Fe.HALF_FLOAT:Fe.UNSIGNED_BYTE,null),ge.colorAttachment0.set(ve)})($,0,Ie,ue,pe,fe)}else re.bindTexture(re.TEXTURE_2D,ue.colorAttachment0.get()),$.bindFramebuffer.set(ue.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:s.ao.transparent});const M=f.transform,z=M.projection.name==="globe",O=z?["PROJECTION_GLOBE_VIEW"]:[],H=z?Rn.frontCCW:Rn.disabled,G=[s.aF(M.center.lng),s.aJ(M.center.lat)];for(let $=0;$<p.length;$++){const J=p[$];if(n.hasRenderableParent(J))continue;const Y=n.getTile(J),ee=Y.getBucket(c);if(!ee||ee.projection.name!==M.projection.name)continue;const re=f.isTileAffectedByFog(J),pe=ee.programConfigurations.get(c.id),fe=f.getOrCreateProgram("heatmap",{config:pe,defines:O,overrideFog:re}),{zoom:ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,fe),f.uploadCommonUniforms(x,fe,J.toUnwrapped());const Ie=M.projection.createInversionMatrix(M,J.canonical);fe.draw(f,b.TRIANGLES,mn.disabled,E,I,H,_h(f,J,Y,Ie,G,ue,c.paint.get("heatmap-intensity")),c.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,c.paint,f.transform.zoom,pe,z?[ee.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(x,b){const E=x.context,I=E.gl,M=b.heatmapFbo;if(!M)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment0.get()),E.activeTexture.set(I.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new s.T(E,b.colorRamp,I.RGBA8)),z.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,mn.disabled,Ln.disabled,x.colorModeForRenderPass(),Rn.disabled,((O,H)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)})(f,c))},line:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=c.paint.get("line-emissive-strength").isConstant(),I=c.paint.get("line-emissive-strength").constantOr(0),M=c.paint.get("line-occlusion-opacity"),z=c.layout.get("line-elevation-reference"),O=c.layout.get("line-width-unit")==="meters",H=z==="sea",G=!(!f.terrain||!f.terrain.enabled),$=f.context,J=$.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Y=c.layout.get("line-cross-slope"),ee=Y!==void 0,re=Y<1,pe=f.colorModeForDrapableLayerRenderPass(E?I:null),fe=f.terrain&&f.terrain.renderingToTexture,ue=fe?1:s.o.devicePixelRatio,Ie=c.paint.get("line-dasharray"),Te=Ie.constantOr(1),Ae=c.layout.get("line-cap"),ve=Ie.constantOr(null),ge=Ae.constantOr(null),Pe=c.paint.get("line-pattern"),Le=Pe.constantOr(1),Fe=c.paint.get("line-pattern-cross-fade"),We=Pe.constantOr(null),$e=c.paint.get("line-opacity").constantOr(1);let lt=!Le&&$e!==1||f.depthOcclusion&&M>0&&M<1;const xt=c.paint.get("line-gradient"),Qe=Le?"linePattern":"line",ke=s.e2(c);let mt;if(fe&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(lt=!1),M!==0&&f.depthOcclusion){const qt=c.paint._values["line-opacity"];qt&&qt.value&&qt.value.kind==="constant"?mt=qt.value:s.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ke.push("VARIABLE_LINE_WIDTH"),fe&&(f.emissiveMode!=="dual-source-blending"||E?f.emissiveMode==="mrt-fallback"&&ke.push("USE_MRT1"):ke.push("DUAL_SOURCE_BLENDING"));const nt=(qt,zt,kt,cn,an,$t)=>{for(const on of qt){const xn=n.getTile(on);if(Le&&!xn.patternsLoaded())continue;const Mn=xn.getBucket(c);if(!Mn||Mn.elevationType!=="none"&&!an||Mn.elevationType==="none"&&an)continue;f.prepareDrawTile();const Vn=[...zt],ti=f.shadowRenderer,Dn=Mn.elevationType==="road"&&!!ti&&ti.enabled;let jn=[0,0,0];if(Dn){const qn=f.style.directionalLight,Ji=f.style.ambientLight;qn&&Ji&&(jn=Ha(f.style,qn,Ji)),Vn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const On=Mn.programConfigurations.get(c.id);let bi=!1;if(We&&xn.imageAtlas){const qn=s.e3.from(We),Ji=qn.getPrimary().scaleSelf(ue).toString(),zr=xn.imageAtlas.patternPositions.get(Ji),Fi=qn.getSecondary(),er=Fi?xn.imageAtlas.patternPositions.get(Fi.scaleSelf(ue).toString()):null;bi=!!zr&&!!er,zr&&On.setConstantPatternPositions(zr,er)}Fe>0&&(bi||On.getPatternTransitionVertexBuffer("line-pattern"))&&Vn.push("LINE_PATTERN_TRANSITION");const mi=f.isTileAffectedByFog(on),ki=f.getOrCreateProgram(Qe,{config:On,defines:Vn,overrideFog:mi});if(!Le&&ve&&ge&&xn.lineAtlas){const qn=xn.lineAtlas.getDash(ve,ge);qn&&On.setConstantPatternPositions(qn)}Dn&&ti.setupShadows(xn.tileID.toUnwrapped(),ki,"vector-tile");let[li,Un]=c.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&li!==Un&&(li===0&&(li-=1),Un===1&&(Un+=1));const yi=fe?on.projMatrix:null,gr=O?1/Mn.tileToMeter/s.ay(xn,1,f.transform.zoom):1,Li=O?1/Mn.tileToMeter/s.ay(xn,1,Math.floor(f.transform.zoom)):1,Ai=Le?s.e4(f,xn,c,yi,ue,gr,Li,[li,Un],jn,Fe):s.e5(f,xn,c,yi,Mn.lineClipsArray.length,ue,gr,Li,[li,Un],jn);if(xt){const qn=Mn.gradients[c.id];let Ji=qn.texture;if(c.gradientVersion!==qn.version){let zr=256;if(c.stepInterpolant){const Fi=n.getSource().maxzoom,er=on.canonical.z===Fi?Math.ceil(1<<f.transform.maxZoom-on.canonical.z):1;zr=s.aA(s.e6(Mn.maxLineLength/s.al*1024*er),256,$.maxTextureSize)}qn.gradient=s.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:zr,image:qn.gradient||void 0,clips:Mn.lineClipsArray}),qn.texture?qn.texture.update(qn.gradient):qn.texture=new s.T($,qn.gradient,J.RGBA8),qn.version=c.gradientVersion,Ji=qn.texture}$.activeTexture.set(J.TEXTURE1),Ji.bind(c.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Te&&($.activeTexture.set(J.TEXTURE0),xn.lineAtlasTexture&&xn.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),On.updatePaintBuffers()),Le&&($.activeTexture.set(J.TEXTURE0),xn.imageAtlasTexture&&xn.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),On.updatePaintBuffers()),an&&!H&&f.terrain.setupElevationDraw(xn,ki),f.uploadCommonUniforms($,ki,on.toUnwrapped());const Bn=qn=>{mt!=null&&(mt.value=$e*M),ki.draw(f,J.TRIANGLES,kt,qn,pe,Rn.disabled,Ai,c.id,Mn.layoutVertexBuffer,Mn.indexBuffer,Mn.segments,c.paint,f.transform.zoom,On,[Mn.layoutVertexBuffer2,Mn.patternVertexBuffer,Mn.zOffsetVertexBuffer]),mt!=null&&(mt.value=$e)};if(lt&&!an){const qn=f.stencilModeForClipping(on).ref;qn===0&&fe&&$.clear({stencil:0});const Ji={func:J.EQUAL,mask:255};Ai.u_alpha_discard_threshold=.8,Bn(new Ln(Ji,qn,255,J.KEEP,J.KEEP,J.INVERT)),Ai.u_alpha_discard_threshold=0,Bn(new Ln(Ji,qn,255,J.KEEP,J.KEEP,J.KEEP))}else Ai.u_alpha_discard_threshold=lt&&an&&$t?.8:0,Bn(an?cn:f.stencilModeForClipping(on))}};let yt=f.depthModeForSublayer(0,mn.ReadOnly);const Pt=new mn(f.depthOcclusion?J.GREATER:J.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const qt=!fe&&f.terrain;M!==0&&qt?s.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):qt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):nt(p,ke,yt,Ln.disabled,!1,!0)}if(c.hasElevatedBuckets){z==="hd-road-markup"?G||(yt=Pt,ke.push("ELEVATED_ROADS")):(ke.push("ELEVATED"),yt=Pt,ee&&ke.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),H&&ke.push("ELEVATION_REFERENCE_SEA"));const qt=lt?f.stencilModeFor3D():Ln.disabled;f.forceTerrainMode=!0,nt(p,ke,yt,qt,!0,!0),lt&&nt(p,ke,yt,qt,!0,!1),f.forceTerrainMode=!1}lt&&(f.resetStencilClippingMasks(),fe&&$.clear({stencil:0})),M===0||f.depthOcclusion||fe||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,c,p){const x=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=c.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(E),M=c.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!M.constantOr(1)&&x.constantOr(s.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let O="none";c.layout.get("fill-elevation-reference")!=="none"?O="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(O="offset");const H=!(!f.terrain||!f.terrain.enabled),G={painter:f,sourceCache:n,layer:c,coords:p,colorMode:I,elevationType:O,terrainEnabled:H,pass:z};if(f.renderPass==="shadow")return void(f.shadowRenderer&&O==="road"&&!H&&(function(J){const{painter:Y,sourceCache:ee,layer:re,coords:pe}=J,fe=Y.context.gl,ue=J.painter.shadowRenderer;for(const Ie of pe){const Te=ee.getTile(Ie),Ae=Te.getBucket(re);if(!Ae)continue;const ve=Ae.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ge=Ae.bufferData.programConfigurations.get(re.id),Pe=Y.isTileAffectedByFog(Ie),Le=Y.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:Pe}),Fe=ue.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,Le,Ie.toUnwrapped());const We=gh(Fe,0);Le.draw(Y,fe.TRIANGLES,ue.getShadowPassDepthMode(),Ln.disabled,ue.getShadowPassColorMode(),Rn.disabled,We,re.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,re.paint,Y.transform.zoom,ge)}})(G));const $=f.emissiveMode==="mrt-fallback";if(O!=="offset"){if(ns(G,!1,$),O==="road"){const J=!H&&f.renderPass==="translucent";J&&eg(f,n,c,p,"geometry"),ns(G,!0,$,Ln.disabled),J&&(function(Y){const{painter:ee,sourceCache:re,layer:pe,coords:fe,colorMode:ue}=Y,Ie=ee.context.gl,Te=Y.painter.shadowRenderer,Ae=!!Te&&Te.enabled,ve=new mn(ee.context.gl.LEQUAL,mn.ReadOnly,ee.depthRangeFor3D);let ge=[0,0,0];if(Ae){const Le=ee.style.directionalLight,Fe=ee.style.ambientLight;Le&&Fe&&(ge=Ha(ee.style,Le,Fe))}const Pe=Le=>{for(const Fe of fe){const We=re.getTile(Fe),$e=We.getBucket(pe);if(!$e)continue;const lt=$e.elevatedStructures;if(!lt)continue;let xt,Qe;if(Le?(xt=lt.renderableBridgeSegments,Qe=lt.bridgeProgramConfigurations.get(pe.id)):(xt=lt.renderableTunnelSegments,Qe=lt.tunnelProgramConfigurations.get(pe.id)),!xt||xt.segments[0].primitiveLength===0)continue;Qe.updatePaintBuffers(),ee.prepareDrawTile();const ke=ee.isTileAffectedByFog(Fe),mt=[];Ae&&mt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=ee.getOrCreateProgram("elevatedStructures",{config:Qe,overrideFog:ke,defines:mt}),yt=ee.translatePosMatrix(Fe.projMatrix,We,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));Ae&&Te.setupShadows(We.tileID.toUnwrapped(),nt,"vector-tile");const Pt=Vl(yt,ge);ee.uploadCommonUniforms(ee.context,nt,Fe.toUnwrapped()),nt.draw(ee,Ie.TRIANGLES,ve,Ln.disabled,ue,Rn.backCCW,Pt,pe.id,lt.vertexBuffer,lt.indexBuffer,xt,pe.paint,ee.transform.zoom,Qe,[lt.vertexBufferNormal])}};Pe(!0),Pe(!1)})(G)}}else ns(G,!1,$,f.stencilModeFor3D())},"fill-extrusion":function(f,n,c,p){const x=c.paint.get("fill-extrusion-opacity"),b=f.context,E=b.gl,I=f.terrain,M=I&&I.renderingToTexture;if(x===0)return;const z=f.emissiveMode==="mrt-fallback",O=f.conflationActive&&f.style.isLayerClipped(c,n.getSource()),H=f.style.order.indexOf(c.fqid);if(O&&(function(G,$,J,Y,ee){for(const re of Y){const pe=$.getTile(re).getBucket(J);pe&&(pe.updateReplacement(re,G.replacementSource,ee),pe.uploadCentroid(G.context))}})(f,n,c,p,H),I||O)for(const G of p){const $=n.getTile(G).getBucket(c);$&&tg(f.context,n,G,$,c,I,O)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(I&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const $=G.getShadowPassDepthMode(),J=G.getShadowPassColorMode();ku(f,n,c,p,$,Ln.disabled,J,O)}else if(f.renderPass==="translucent"){const G=!c.paint.get("fill-extrusion-pattern").constantOr(1),$=c.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!M&&$.a!==0){const J=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D);x===1&&G?ku(f,n,c,p,J,Ln.disabled,zn.unblended,O):(ku(f,n,c,p,J,Ln.disabled,zn.disabled,O),ku(f,n,c,p,J,f.stencilModeFor3D(),f.colorModeForRenderPass(),O),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!I&&f.transform.projection.name!=="globe"||M)){const J=c.paint.get("fill-extrusion-opacity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=c.paint.get("fill-extrusion-flood-light-intensity"),pe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",fe=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:c.lut).toArray01().slice(0,3),ue=Y>0&&ee>0,Ie=re>0,Te=(ge,Pe,Le)=>(1-Le)*ge+Le*Pe,Ae=new Sh;Ae.translate=c.paint.get("fill-extrusion-translate"),Ae.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const ve=ge=>{const Pe=f.depthModeForSublayer(1,mn.ReadOnly,E.LEQUAL,!0),Le=c.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=Te(.1,3,Le),We=f._showOverdrawInspector;if(!We){const $e=new Ln({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),lt=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ul(Ae,f,n,c,p,Pe,$e,lt,Rn.disabled,ge,"sdf",J,Y,ee,re,fe,Fe,O,!1)}{const $e=We?Ln.disabled:new Ln({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),lt=We?f.colorModeForRenderPass():new zn([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ul(Ae,f,n,c,p,Pe,$e,lt,Rn.disabled,ge,"color",J,Y,ee,re,fe,Fe,O,!1)}};if(M){const ge=()=>{const Le=I.drapeBufferSize[0],Fe=I.drapeBufferSize[1];let We=I.framebufferCopyTexture;return We&&(!We||We.size[0]===Le&&We.size[1]===Fe)||(We&&We.destroy(),We=I.framebufferCopyTexture=new s.T(b,new s.q({width:Le,height:Fe}),E.RGBA8)),We.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Le,Fe),We},Pe=(Le,Fe,We)=>{const $e=f.depthModeForSublayer(1,mn.ReadOnly,E.LEQUAL,!1),lt=c.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xt=Te(.1,3,lt);{const Qe=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0]);Ul(Ae,f,n,c,p,$e,Ln.disabled,Qe,Rn.disabled,Le,"clear",J,Y,ee,re,fe,xt,O,Fe)}{const Qe=new Ln({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ke=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ul(Ae,f,n,c,p,$e,Qe,ke,Rn.disabled,Le,"sdf",J,Y,ee,re,fe,xt,O,Fe)}z&&!Le&&(We=ge());{const Qe=Le?E.ZERO:E.ONE_MINUS_DST_ALPHA,ke=new Ln({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),mt=new zn([Qe,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Ul(Ae,f,n,c,p,$e,ke,mt,Rn.disabled,Le,"color",J,Y,ee,re,fe,xt,O,Fe)}if(!z||Le){const Qe=new zn([E.ONE,E.ONE,E.ONE,Le?E.ZERO:E.ONE],s.ao.transparent,[!1,!1,!1,!0],Le?E.FUNC_ADD:E.MAX);Ul(Ae,f,n,c,p,$e,Ln.disabled,Qe,Rn.disabled,Le,"clear",J,Y,ee,re,fe,xt,O,Fe,We)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const Qe=new Ln({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),ke=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!0,!1,!1,!1],E.MAX);Ul(Ae,f,n,c,p,$e,Qe,ke,Rn.disabled,Le,"emissive",J,Y,ee,re,fe,xt,O,Fe,We),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(ue||Ie){let Le;f.prepareDrawTile(),z&&!ue||(Le=ge()),ue&&Pe(!0,!1,Le),Ie&&Pe(!1,!0,Le)}}else ue&&ve(!0),Ie&&ve(!1),(ue||Ie)&&f.resetStencilClippingMasks()}}},building:function(f,n,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const x=c.paint.get("building-ambient-occlusion-ground-intensity"),b=c.paint.get("building-ambient-occlusion-ground-radius"),E=c.paint.get("building-ambient-occlusion-ground-attenuation"),I=c.paint.get("building-opacity");if(I<=0)return;let M=x>0&&b>0,z=!0;const O=c.paint.get("building-vertical-scale");if(O<=0)return;f.shadowRenderer||(z=!1);const H=f.conflationActive&&f.style.isLayerClipped(c,n.getSource()),G=f.style.order.indexOf(c.fqid);if((function($,J,Y,ee,re,pe){for(const fe of pe){const ue=J.getTile(fe).getBucket(Y);ue&&(re&&ue.updateReplacement(fe,$.replacementSource,ee),ue.uploadUpdatedIndexBuffer($.context))}})(f,n,c,G,H,p),(function($,J,Y,ee){for(const re of ee){const pe=J.getTile(re).getBucket(Y);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer($.context)}})(f,n,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const $=f.shadowRenderer,J=[],Y=$.getShadowPassDepthMode();Qs({painter:f,source:n,layer:c,coords:p,defines:J,blendMode:$.getShadowPassColorMode(),depthMode:Y,opacity:I,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];z&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const J=c.paint.get("building-facade-emissive-chance"),Y=c.paint.get("building-ambient-occlusion-intensity"),ee=c.paint.get("building-flood-light-intensity"),re=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(re?null:c.lut).toArray01().slice(0,3),fe=c.paint.get("building-flood-light-ground-attenuation"),ue=ee>0,Ie=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D);I<1&&Qs({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:zn.disabled,depthMode:Ie,opacity:I,verticalScale:O,facadeEmissiveChance:J,facadeAOIntensity:Y,floodLightIntensity:ee,floodLightColor:pe,depthOnly:!0});const Te=f.colorModeForRenderPass();Qs({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:Te,depthMode:Ie,opacity:I,verticalScale:O,facadeEmissiveChance:J,facadeAOIntensity:Y,floodLightIntensity:ee,floodLightColor:pe}),M&&ys(f,n,c,p,!0,I,x,b,ee,pe,E,H),ue&&ys(f,n,c,p,!1,I,x,b,ee,pe,fe,H)}else if(f.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],J=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);Qs({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:zn.alphaBlended,depthMode:J,opacity:I,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,n,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,b=f.terrain&&f.terrain.renderingToTexture,[E,I]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const M of I){const z=n.getTile(M);if(z.needsHillshadePrepare&&f.renderPass==="offscreen")ml(f,z,c);else if(f.renderPass==="translucent"){const O=f.depthModeForSublayer(0,mn.ReadOnly),H=c.paint.get("hillshade-emissive-strength"),G=f.colorModeForDrapableLayerRenderPass(H),$=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];vf(f,M,z,c,O,$,G)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,p,x,b){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,M=I&&E;if(f.renderElevatedRasterBackface&&!M)return;const z=f.context,O=z.gl,H=n.getSource(),G=(function(Te,Ae,ve,ge,Pe){const Le=Ae.paint.get("raster-color"),Fe=Te.type==="raster-array",We=[],$e=Ae.paint.get("raster-resampling"),lt=Ae.paint.get("raster-color-mix");let xt=Ae.paint.get("raster-color-range");const Qe=[lt[0],lt[1],lt[2],0],ke=lt[3];let mt=$e==="nearest"?ge.NEAREST:ge.LINEAR;if(Fe&&(We.push("RASTER_ARRAY"),Le||We.push("RASTER_COLOR"),$e==="linear"&&We.push("RASTER_ARRAY_LINEAR"),mt=ge.NEAREST,!xt&&Te.rasterLayers)){const nt=Te.rasterLayers.find(({id:yt})=>yt===Ae.sourceLayer);nt&&nt.fields&&nt.fields.range&&(xt=nt.fields.range)}if(xt=xt||[0,1],Le){We.push("RASTER_COLOR"),ve.activeTexture.set(ge.TEXTURE2),Ae.updateColorRamp(xt);let nt=Ae.colorRampTexture;nt||(nt=Ae.colorRampTexture=new s.T(ve,Ae.colorRamp,ge.RGBA8)),nt.bind(mt,ge.CLAMP_TO_EDGE)}return Pe&&We.push("USE_MRT1"),{mix:Qe,range:xt,offset:ke,defines:We,resampling:mt}})(H,c,z,O,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(H instanceof s.aU&&!p.length&&!E)return;const $=c.paint.get("raster-emissive-strength"),J=f.colorModeForDrapableLayerRenderPass($),Y=f.terrain&&f.terrain.renderingToTexture,ee=!f.options.moving,re=c.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(H instanceof s.aU&&!p.length&&(H.onNorthPole||H.onSouthPole)){const Te=I?f.stencilModeFor3D():Ln.disabled;return void Lu(!!H.onNorthPole,null,f,n,c,$,G,Rn.disabled,Te)}if(!p.length)return;const[pe,fe]=H instanceof s.aU||Y?[{},p]:f.stencilConfigForOverlap(p),ue=fe[fe.length-1].overscaledZ;M&&G.defines.push("PROJECTION_GLOBE_VIEW"),I&&G.defines.push("RENDER_CUTOFF");const Ie=(Te,Ae,ve)=>{for(const ge of Te){const Pe=ge.toUnwrapped(),Le=n.getTile(ge);if(Y&&(!Le||!Le.hasData()))continue;z.activeTexture.set(O.TEXTURE0);const Fe=Up(Le,H,c,G);if(!Fe||!Fe.texture)continue;const{texture:We,mix:$e,offset:lt,tileSize:xt,buffer:Qe}=Fe;let ke,mt;Y?(ke=mn.disabled,mt=ge.projMatrix):I?(ke=new mn(O.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),mt=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Pe,ee)):(ke=f.depthModeForSublayer(ge.overscaledZ-ue,c.paint.get("raster-opacity")===1?mn.ReadWrite:mn.ReadOnly,O.LESS),mt=f.transform.calculateProjMatrix(Pe,ee));const nt=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(ge):pe[ge.overscaledZ],yt=b?0:c.paint.get("raster-fade-duration");Le.registerFadeDuration(yt);const Pt=n.findLoadedParent(ge,0),qt=If(Le,Pt,n,f.transform,yt);let zt,kt;!qt.isFading&&Le.refreshedUponExpiration&&(Le.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),z.activeTexture.set(O.TEXTURE0),We.bind(re,O.CLAMP_TO_EDGE),z.activeTexture.set(O.TEXTURE1),Pt?(Pt.texture&&Pt.texture.bind(re,O.CLAMP_TO_EDGE),zt=Math.pow(2,Pt.tileID.overscaledZ-Le.tileID.overscaledZ),kt=[Le.tileID.canonical.x*zt%1,Le.tileID.canonical.y*zt%1]):We.bind(re,O.CLAMP_TO_EDGE),"useMipmap"in We&&z.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const cn=f.transform;let an;const $t=I?Bf(cn):[0,0,0,0];let on,xn,Mn,Vn,ti,Dn=0;if(M&&H instanceof s.aU&&H.coordinates.length>3)on=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),xn=Float32Array.from(cn.globeMatrix),Mn=Float32Array.from(s.dF(cn)),Vn=[s.aF(cn.center.lng),s.aJ(cn.center.lat)],an=H.elevatedGlobePerspectiveTransform,ti=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const mi=s.dG(ge.canonical);Dn=s.dH(mi.getCenter().lat),on=Float32Array.from(s.bk(s.dJ(ge.canonical))),xn=Float32Array.from(cn.globeMatrix),Mn=Float32Array.from(s.dF(cn)),Vn=[s.aF(cn.center.lng),s.aJ(cn.center.lat)],an=[0,0],ti=Float32Array.from(s.dI(ge.canonical,mi,Dn,cn.worldSize/cn._pixelsPerMercatorPixel))}else an=H instanceof s.aU?H.perspectiveTransform:[0,0],on=new Float32Array(16),xn=new Float32Array(9),Mn=new Float32Array(16),Vn=[0,0],ti=new Float32Array(9);const jn=yh(mt,on,xn,Mn,ti,kt||[0,0],s.aj(f.transform.zoom),Vn,$t,zt||1,qt,c,an,I?c.paint.get("raster-elevation"):0,2,$e,lt,G.range,xt,Qe,$),On=f.isTileAffectedByFog(ge),bi=f.getOrCreateProgram("raster",{defines:G.defines,overrideFog:On});if(f.uploadCommonUniforms(z,bi,Pe),H instanceof s.aU){const mi=H.elevatedGlobeVertexBuffer,ki=H.elevatedGlobeIndexBuffer;if(Y||!E)H.boundsBuffer&&H.boundsSegments&&bi.draw(f,O.TRIANGLES,ke,Ln.disabled,J,Rn.disabled,jn,c.id,H.boundsBuffer,f.quadTriangleIndexBuffer,H.boundsSegments);else if(mi&&ki){const li=cn.zoom<=s.c_?H.elevatedGlobeSegments:H.getSegmentsForLongitude(cn.center.lng);li&&bi.draw(f,O.TRIANGLES,ke,Ln.disabled,J,Ae,jn,c.id,mi,ki,li)}}else if(M){ke=new mn(O.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);const mi=f.globeSharedBuffers;if(mi){const[ki,li,Un]=mi.getGridBuffers(Dn,!1);bi.draw(f,O.TRIANGLES,ke,ve||nt,f.colorModeForRenderPass(),Ae,jn,c.id,ki,li,Un)}}else{const{tileBoundsBuffer:mi,tileBoundsIndexBuffer:ki,tileBoundsSegments:li}=f.getTileBoundsBuffers(Le);bi.draw(f,O.TRIANGLES,ke,nt,J,Rn.disabled,jn,c.id,mi,ki,li)}}if(!(H instanceof s.aU)&&M)for(const ge of Te){const Pe=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&Lu(!0,ge,f,n,c,$,G,Ae,ve||Ln.disabled),Pe&&Lu(!1,ge,f,n,c,$,G,Ae===Rn.frontCW?Rn.backCW:Rn.frontCW,ve||Ln.disabled)}};M?Ie(fe,f.renderElevatedRasterBackface?Rn.backCW:Rn.frontCW,f.stencilModeFor3D()):Ie(fe,Rn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,c,p,x,b){f.renderPass==="offscreen"&&(function(E,I,M,z){if(!z.length)return;const O=E.context,H=O.gl,G=I.getSource();if(!(G instanceof aa))return;const $=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let J=M.particlePositionRGBAImage;if(!J||J.width!==$){const fe=(function(ue){const Ie=ue*ue,Te=new Uint8Array(4*Ie),Ae=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},ve=.9090909090909091;for(let ge=0;ge<Ie;ge++){const Pe=ve*(Ae(2*ge+0)+xh),Le=ve*(Ae(2*ge+1)+xh),Fe=255*Pe%1,We=255*Le%1,$e=Fe,lt=Le-We/255,xt=We;Te[4*ge+0]=255*(Pe-Fe/255),Te[4*ge+1]=255*$e,Te[4*ge+2]=255*lt,Te[4*ge+3]=255*xt}return Te})($);J=M.particlePositionRGBAImage=new s.q({width:$,height:$},fe)}let Y=M.particleFramebuffer;Y?Y.width!==$&&(Y.destroy(),Y=M.particleFramebuffer=O.createFramebuffer($,$,1,null)):Y=M.particleFramebuffer=O.createFramebuffer($,$,1,null);const ee=[];for(const fe of z){const ue=I.getTile(fe);if(!(ue instanceof zc))continue;const Ie=Vf(ue,G,M);if(!Ie)continue;const Te=[ue.tileSize,ue.tileSize];let Ae=M.tileFramebuffer;Ae||(Ae=M.tileFramebuffer=O.createFramebuffer(Te[0],Te[1],1,null));let ve=ue.rasterParticleState;ve||(ve=ue.rasterParticleState=new Ff(O,fe,Te,J));const ge=ve.update(M.lastInvalidatedAt);ve.particleTextureDimension!==$&&ve.updateParticleTexture(fe,J);const Pe=ve.targetColorTexture;ve.targetColorTexture=ve.backgroundColorTexture,ve.backgroundColorTexture=Pe;const Le=ve.particleTexture0;ve.particleTexture0=ve.particleTexture1,ve.particleTexture1=Le,ee.push([fe,Ie,ve,ge])}if(ee.length===0)return;const re=s.o.now(),pe=M.previousDrawTimestamp?.001*(re-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=re,M.hasColorMap()){O.activeTexture.set(H.TEXTURE0+2);let fe=M.colorRampTexture;fe||(fe=M.colorRampTexture=new s.T(O,M.colorRamp,H.RGBA8)),fe.bind(H.LINEAR,H.CLAMP_TO_EDGE)}O.bindFramebuffer.set(M.tileFramebuffer.framebuffer),(function(fe,ue,Ie){const Te=fe.context,Ae=Te.gl,ve=ue.tileFramebuffer;Te.activeTexture.set(Ae.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(Le=ue.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},Pe=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const Fe of Ie){const[,,We,$e]=Fe;ve.colorAttachment0.set(We.targetColorTexture.texture),Te.viewport.set([0,0,ve.width,ve.height]),Te.clear({color:s.ao.transparent}),$e&&(We.backgroundColorTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE),Pe.draw(fe,Ae.TRIANGLES,mn.disabled,Ln.disabled,zn.alphaBlended,Rn.disabled,ge,ue.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}})(E,M,ee),(function(fe,ue,Ie,Te){const Ae=fe.context,ve=Ae.gl,ge=Ie.tileFramebuffer,Pe=fe.transform.projection.name==="globe",Le=Ie.paint.get("raster-particle-max-speed");for(const Fe of Te){const[We,$e,lt]=Fe;Ae.activeTexture.set(ve.TEXTURE0+0),$e.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ge.colorAttachment0.set(lt.targetColorTexture.texture);const xt=fe.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1});Ae.activeTexture.set(ve.TEXTURE0+1);const Qe=$e.scalarData?[]:[0,1,2,3].map(nt=>s.e9[nt](We));Qe.push(We);const ke=We.canonical.x,mt=We.canonical.y;for(const nt of Qe){const yt=ue.getTile(Pe?nt.wrapped():nt);if(!yt)continue;const Pt=yt.rasterParticleState;if(!Pt)continue;const qt=nt.canonical.x+(1<<nt.canonical.z)*(nt.wrap-We.wrap),zt=nt.canonical.y;Pt.particleTexture0.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const kt=vh(1,Pt.particleTexture0.size[0],[qt-ke,zt-mt],0,$e.texture.size,2,Le,$e.textureOffset,$e.scale,$e.offset);xt.draw(fe,ve.POINTS,mn.disabled,Ln.disabled,zn.alphaBlended,Rn.disabled,kt,Ie.id,Pt.particleIndexBuffer,void 0,Pt.particleSegment)}}})(E,I,M,ee),O.bindFramebuffer.set(M.particleFramebuffer.framebuffer),(function(fe,ue,Ie,Te){const Ae=fe.context,ve=Ae.gl,ge=ue.paint.get("raster-particle-max-speed"),Pe=Te*ue.paint.get("raster-particle-speed-factor")*.15,Le=(function(We){return Math.pow(We,6)})(.01+1*ue.paint.get("raster-particle-reset-rate-factor")),Fe=ue.particleFramebuffer;Ae.viewport.set([0,0,Fe.width,Fe.height]);for(const We of Ie){const[,$e,lt]=We;Ae.activeTexture.set(ve.TEXTURE0+0),$e.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Ae.activeTexture.set(ve.TEXTURE0+1);const xt=lt.particleTexture0;xt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Qe=Fp(1,xt.size[0],0,$e.texture.size,ge,Pe,Le,$e.textureOffset,$e.scale,$e.offset);Fe.colorAttachment0.set(lt.particleTexture1.texture),Ae.clear({color:s.ao.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:$e.defines}).draw(fe,ve.TRIANGLES,mn.disabled,Ln.disabled,zn.unblended,Rn.disabled,Qe,ue.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}})(E,M,ee,pe)})(f,n,c,p),f.renderPass==="translucent"&&((function(E,I,M,z){const O=E.context,H=O.gl,G=I.getSource().tileSize,$=5*(1-s.ah(s.cL,s.cL+1,E.transform.zoom))*G+M.paint.get("raster-particle-elevation"),J=!E.options.moving,Y=E.transform.projection.name==="globe";if(!z.length)return;const[ee,re]=E.stencilConfigForOverlap(z),pe=[];Y&&pe.push("PROJECTION_GLOBE_VIEW");const fe=E.stencilModeFor3D();for(const ue of re){const Ie=ue.toUnwrapped(),Te=I.getTile(ue);if(!Te.rasterParticleState)continue;const Ae=Te.rasterParticleState,ve=100;Te.registerFadeDuration(ve);const ge=I.findLoadedParent(ue,0),Pe=If(Te,ge,I,E.transform,ve);let Le,Fe;E.terrain&&E.terrain.prepareDrawTile(),O.activeTexture.set(H.TEXTURE0),Ae.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),O.activeTexture.set(H.TEXTURE1),ge&&ge.rasterParticleState?(ge.rasterParticleState.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Le=Math.pow(2,ge.tileID.overscaledZ-Te.tileID.overscaledZ),Fe=[Te.tileID.canonical.x*Le%1,Te.tileID.canonical.y*Le%1]):Ae.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const We=Y?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ie,J),$e=E.transform,lt=Gp($e),xt=s.dG(ue.canonical),Qe=s.dH(xt.getCenter().lat);let ke,mt,nt,yt,Pt;Y?(ke=Float32Array.from(s.bk(s.dJ(ue.canonical))),mt=Float32Array.from($e.globeMatrix),nt=Float32Array.from(s.dF($e)),yt=[s.aF($e.center.lng),s.aJ($e.center.lat)],Pt=Float32Array.from(s.dI(ue.canonical,xt,Qe,$e.worldSize/$e._pixelsPerMercatorPixel))):(ke=new Float32Array(16),mt=new Float32Array(9),nt=new Float32Array(16),yt=[0,0],Pt=new Float32Array(9));const qt=S_(We,ke,mt,nt,Pt,Fe||[0,0],s.aj(E.transform.zoom),yt,lt,Le||1,Pe,$),zt=E.isTileAffectedByFog(ue),kt=E.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:zt});if(E.uploadCommonUniforms(O,kt,Ie),Y){const cn=new mn(H.LEQUAL,mn.ReadOnly,E.depthRangeFor3D),an=0,$t=E.globeSharedBuffers;if($t){const[on,xn,Mn]=$t.getGridBuffers(Qe,an!==0);kt.draw(E,H.TRIANGLES,cn,fe,zn.alphaBlended,E.renderElevatedRasterBackface?Rn.frontCCW:Rn.backCCW,qt,M.id,on,xn,Mn)}}else{const cn=E.depthModeForSublayer(0,mn.ReadOnly),an=ee[ue.overscaledZ],{tileBoundsBuffer:$t,tileBoundsIndexBuffer:on,tileBoundsSegments:xn}=E.getTileBoundsBuffers(Te);kt.draw(E,H.TRIANGLES,cn,an,zn.alphaBlended,Rn.disabled,qt,M.id,$t,on,xn)}}E.resetStencilClippingMasks()})(f,n,c,p),f.style.map.triggerRepaint())},background:function(f,n,c,p){const x=c.paint.get("background-color"),b=c.paint.get("background-color-use-theme").constantOr("default")==="none",E=c.paint.get("background-opacity"),I=c.paint.get("background-emissive-strength"),M=c.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const z=f.context,O=z.gl,H=f.transform,G=H.tileSize,$=c.paint.get("background-pattern");let J;if($!==void 0&&($===null||(J=f.imageManager.getPattern(s.I.from($.toString()),c.scope,f.style.getLut(c.scope)),!J)))return;const Y=!$&&x.a===1&&E===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const ee=Ln.disabled,re=f.depthModeForSublayer(0,Y==="opaque"?mn.ReadWrite:mn.ReadOnly),pe=f.colorModeForDrapableLayerRenderPass(I),fe=$?"backgroundPattern":"background";let ue,Ie=p;Ie||(ue=f.getBackgroundTiles(),Ie=Object.values(ue).map(Ae=>Ae.tileID)),$&&(z.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context,c.scope));const Te=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Te.push("USE_MRT1"),M){const Ae=f.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0,defines:Te}),ve=new Float32Array(s.bA([])),ge=new s.aQ(0,0,0,0,0),Pe=$?Da(ve,I,E,f,0,c.scope,J,M,{tileID:ge,tileSize:G}):xc(ve,I,E,x.toPremultipliedRenderColor(b?null:c.lut));return void Ae.draw(f,O.TRIANGLES,re,ee,pe,Rn.disabled,Pe,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}for(const Ae of Ie){const ve=f.isTileAffectedByFog(Ae),ge=f.getOrCreateProgram(fe,{overrideFog:ve,defines:Te}),Pe=Ae.toUnwrapped(),Le=p?Ae.projMatrix:f.transform.calculateProjMatrix(Pe);f.prepareDrawTile();const Fe=n?n.getTile(Ae):ue?ue[Ae.key]:new Ao(Ae,G,H.zoom,f),We=$?Da(Le,I,E,f,0,c.scope,J,M,{tileID:Ae,tileSize:G}):xc(Le,I,E,x.toPremultipliedRenderColor(b?null:c.lut));f.uploadCommonUniforms(z,ge,Pe);const{tileBoundsBuffer:$e,tileBoundsIndexBuffer:lt,tileBoundsSegments:xt}=f.getTileBoundsBuffers(Fe);ge.draw(f,O.TRIANGLES,re,ee,pe,Rn.disabled,We,c.id,$e,lt,xt)}},sky:function(f,n,c){const p=f._atmosphere?s.aj(f.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const b=f.context,E=c.paint.get("sky-type"),I=new mn(b.gl.LEQUAL,mn.ReadOnly,[0,1]),M=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&((function(z,O){const H=z.context,G=H.gl;let $=O.skyboxFbo;if(!$){$=O.skyboxFbo=H.createFramebuffer(32,32,1,null),O.skyboxGeometry=new Wa(H),O.skyboxTexture=H.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,O.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let re=0;re<6;++re)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}H.bindFramebuffer.set($.framebuffer),H.viewport.set([0,0,32,32]);const J=O.getCenter(z,!0),Y=z.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);s.bA(ee),s.en(ee,ee,.5*-Math.PI),tu(z,O,Y,ee,J,0),s.bA(ee),s.en(ee,ee,.5*Math.PI),tu(z,O,Y,ee,J,1),s.bA(ee),s.cU(ee,ee,.5*-Math.PI),tu(z,O,Y,ee,J,2),s.bA(ee),s.cU(ee,ee,.5*Math.PI),tu(z,O,Y,ee,J,3),s.bA(ee),tu(z,O,Y,ee,J,4),s.bA(ee),s.en(ee,ee,Math.PI),tu(z,O,Y,ee,J,5),H.viewport.set([0,0,z.width,z.height])})(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&(function(z,O,H,G,$){const J=z.context,Y=J.gl,ee=z.transform,re=z.getOrCreateProgram("skybox");J.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture);const pe=((fe,ue,Ie,Te,Ae)=>({u_matrix:fe,u_sun_direction:ue,u_cubemap:0,u_opacity:Te,u_temporal_offset:Ae}))(ee.skyboxMatrix,O.getCenter(z,!1),0,G,$);z.uploadCommonUniforms(J,re),re.draw(z,Y.TRIANGLES,H,Ln.disabled,z.colorModeForRenderPass(),Rn.backCW,pe,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(f,c,I,x,M):E==="gradient"&&f.renderPass==="sky"&&(function(z,O,H,G,$){const J=z.context,Y=J.gl,ee=z.transform,re=z.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Wa(J)),J.activeTexture.set(Y.TEXTURE0);let pe=O.colorRampTexture;pe||(pe=O.colorRampTexture=new s.T(J,O.colorRamp,Y.RGBA8)),pe.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const fe=((ue,Ie,Te,Ae,ve)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:Ie,u_radius:s.an(Te),u_opacity:Ae,u_temporal_offset:ve}))(ee.skyboxMatrix,O.getCenter(z,!1),O.paint.get("sky-gradient-radius"),G,$);z.uploadCommonUniforms(J,re),re.draw(z,Y.TRIANGLES,H,Ln.disabled,z.colorModeForRenderPass(),Rn.backCW,fe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(f,c,I,x,M)},custom:function(f,n,c,p){const x=f.context,b=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(n)){if(f.renderPass==="offscreen"){const E=b.prerender;if(E){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;E.call(b,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else E.call(b,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=b.renderToTile;if(I){const M=p[0].canonical,z={x:M.x+p[0].wrap*(b.wrapTileId?0:1<<M.z),y:M.y,z:M.z};x.setDepthMode(mn.disabled),x.setStencilMode(Ln.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(b,x.gl,z),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(Ln.disabled);const E=b.renderingMode==="3d"?new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,mn.ReadOnly);if(x.setDepthMode(E),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;b.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else b.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,c,p){if(f.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1),b=c.paint.get("model-elevation-reference"),E=b==="ground",I=b==="ground";if(x===0)return;const M=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!M||f.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const z=f.shadowRenderer,O=c.paint.get("model-receive-shadows");z&&(z.useNormalOffset=!0,O||(z.enabled=!1));const H=()=>{z&&(z.useNormalOffset=!0,O||(z.enabled=!0))},G=n.getSource();if(f.renderPass==="light-beam"&&G.type!=="batched-model")return;if(G.type==="vector"||G.type==="geojson")return(function(ue,Ie,Te,Ae,ve){const ge=ue.transform,Pe=ge.projection.name==="globe",Le=ge.getFreeCameraOptions().position;if(!ue.modelManager)return;const Fe=ue.modelManager;Te.modelManager=Fe;const We=ue.shadowRenderer;if(!Te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const $e=Te._unevaluatedLayout._values["model-id"],lt=Object.assign({},Te.layout.get("model-id").parameters),xt=ue.style.order.indexOf(Te.fqid),Qe=Te.paint.get("model-opacity").constantOr(1);for(const ke of Ae){const mt=Ie.getTile(ke).getBucket(Te);if(!mt||mt.projection.name!==ge.projection.name)continue;const nt=mt.getModelUris();if(nt&&!mt.modelsRequested&&(Fe.addModelsFromBucket(nt,ve),mt.modelsRequested=!0),Pe)lt.zoom=ke.overscaledZ;else{const $t=Ot(ke,ge);lt.zoom=$t}const yt=$e.possiblyEvaluate(lt);if(Ou(ue,mt,ke),La.shadowUniformsInitialized=!1,La.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(ke.toUnwrapped())===0,ue.renderPass==="shadow"&&We){if(ue.currentShadowCascade===1&&mt.isInsideFirstShadowMapFrustum)continue;const $t=ge.calculatePosMatrix(ke.toUnwrapped(),ge.worldSize);if(La.tileMatrix.set($t),La.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix($t)),La.aabb.min=[0,0,0],La.aabb.max[0]=La.aabb.max[1]=s.al,La.aabb.max[2]=0,wr(mt,La,ue,Te.scope))continue}const Pt=1<<ke.canonical.z,qt=[((Le.x-ke.wrap)*Pt-ke.canonical.x)*s.al,(Le.y*Pt-ke.canonical.y)*s.al,Le.z*Pt*s.al];ue.conflationActive&&Object.keys(mt.instancesPerModel).length>0&&ue.style.isLayerClipped(Te,Ie.getSource())&&mt.updateReplacement(ke,ue.replacementSource,xt,Te.scope)&&(mt.uploaded=!1,mt.upload(ue.context));let zt=0;const kt=new Array,cn=new Array,an=new Array;for(let $t in mt.instancesPerModel){const on=mt.instancesPerModel[$t];on.features.length>0&&!Pe&&($t=yt.evaluate(on.features[0].feature,{}));const xn=Fe.getModel($t,ve);if(xn||Fe.hasURLBeenRequested($t)||mt.modelUris.includes($t)||(mt.modelUris.push($t),mt.modelsRequested=!1),xn&&xn.uploaded)if(Pe){const Mn=s.c5([],[Le.x,Le.y,Le.z],ue.transform.worldSize);s.ew(Mn,Mn);for(let Vn=0;Vn<on.instancedDataArray.length;++Vn){const ti=[0,0,0],Dn=[1,1,1],jn=s.ex(),On=on.tileCoordinatesForInstance(Vn),bi=on.transformForInstance(Vn);s.ey(Dn,bi),s.ez(jn,bi),s.eA(ti,jn);const mi=on.translationForInstance(Vn),ki=new s.aT(0,0);s.eB(mt.canonical,ki,On.x,On.y);const li=s.bC();s.eC(li,xn,ue.transform,ki,ti,Dn,mi,!0,!1,!1);const Un=on.colorForInstance(Vn),yi=s.bA([]),gr=s.ef(ki.lat,ue.transform.zoom),Li=s.bq([],[1,1,1/gr]);s.br(yi,yi,Mn),an.push({zScaleMatrix:Li,negCameraPosMatrix:yi});for(const Ai of xn.nodes)Ah(ue,Ai,li,ue.transform.expandedFarZProjMatrix,zt,kt,cn,xn.materialOverrides,Qe,Un);++zt}}else for(const Mn of xn.nodes)Xt(ue,Te,Mn,on,qt,ke,La)}if(Pe)if(ue.renderPass==="shadow"){for(const $t of cn)Ad($t.mesh,$t.nodeModelMatrix,ue,Te);for(const $t of kt)Ad($t.mesh,$t.nodeModelMatrix,ue,Te)}else Xp(ue,Te,kt,cn,an)}})(f,n,c,p,Sd(f,c)),void H();if(!G.loaded())return;if(G.type==="batched-model")return(function(ue,Ie,Te,Ae){Te.resetLayerRenderingStats(ue);const ve=ue.context,ge=ue.transform,Pe=ue.style.fog,Le=ue.shadowRenderer;if(ge.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const Fe=ue.transform.getFreeCameraOptions().position,We=s.c5([],[Fe.x,Fe.y,Fe.z],ue.transform.worldSize),$e=s.ew([],We),lt=s.bA([]),xt=s.ef(ge.center.lat,ge.zoom),Qe=s.bq([],[1,1,1/xt]);s.br(lt,lt,$e);const ke=Te.paint.get("model-opacity").constantOr(1),mt=new mn(ve.gl.LEQUAL,mn.ReadWrite,ue.depthRangeFor3D),nt=new mn(ve.gl.LEQUAL,mn.ReadOnly,ue.depthRangeFor3D),yt=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Pt=ue.renderPass==="shadow",qt=Pt&&Le?Le.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),zt=Te.paint.get("model-front-cutoff"),kt=zt[2]<1,cn=Yo(ue,Te.paint.get("model-cutoff-fade-range")),an=Te.getLayerRenderingStats();(function($t,on,xn,Mn){const Vn=$t.terrain?$t.terrain.exaggeration():0,ti=$t.transform.zoom;for(const Dn of Mn){const jn=on.getTile(Dn).getBucket(xn);jn&&(jn.setFilter(xn.filter),$t.conflationActive&&jn.updateReplacement(Dn,$t.replacementSource),jn.evaluateTransform($t,xn),$t.terrain&&Vn>0&&jn.elevationUpdate($t.terrain,Vn,Dn,xn.source),jn.needsReEvaluation($t,ti,xn)&&jn.evaluate(xn))}})(ue,Ie,Te,Ae),(function(){let $t,on,xn;kt?($t=Ae.length-1,on=-1,xn=-1):($t=0,on=Ae.length,xn=1);const Mn=new Float64Array(16),Vn=s.cA(),ti=new s.P(0,0);for(let Dn=$t;Dn!==on;Dn+=xn){const jn=Ae[Dn],On=Ie.getTile(jn).getBucket(Te);if(!On||!On.uploaded)continue;let bi=!1;Le&&(bi=Le.getMaxCascadeForTile(jn.toUnwrapped())===0);const mi=ge.calculatePosMatrix(jn.toUnwrapped(),ge.worldSize),ki=On.modelTraits;!Pt&&kt&&(s.bl(Mn,mi),s.af(Vn,We,Mn),ti.x=Vn[0],ti.y=Vn[1]);const li=[];On.setFilter(Te.filter);for(const Un of On.getNodesInfo()){if(Un.hiddenByReplacement||!Un.node.meshes)continue;const yi=Un.node;let gr=0;ue.terrain&&yi.elevation&&(gr=yi.elevation*ue.terrain.exaggeration());const Li=(()=>{const Ii=Un.aabb;return yt.min=[...Ii.min],yt.max=[...Ii.max],yt.min[2]+=gr,yt.max[2]+=gr,s.af(yt.min,yt.min,mi),s.af(yt.max,yt.max,mi),yt})(),Ai=Un.evaluatedScale;if(Ai[0]<=1&&Ai[1]<=1&&Ai[2]<=1&&Li.intersects(qt)===0)continue;if(!Pt&&kt){const Ii=.16666666666666666;Un.cameraCollisionOpacity=We[0]>Li.min[0]&&We[0]<Li.max[0]&&We[1]>Li.min[1]&&We[1]<Li.max[1]&&We[2]*xt<Li.max[2]&&yi.footprint&&s.c0(ti,yi.footprint)?Math.max(Un.cameraCollisionOpacity-Ii,0):Math.min(1,Un.cameraCollisionOpacity+Ii)}const Bn=[...mi],qn=1/s.d7(jn.canonical),Ji=yi.anchor?yi.anchor[0]:0,zr=yi.anchor?yi.anchor[1]:0;s.br(Bn,Bn,[Ji*(Ai[0]-1)+Un.evaluatedTranslation[0]*qn,zr*(Ai[1]-1)+Un.evaluatedTranslation[1]*qn,gr+Un.evaluatedTranslation[2]]),s.cq(Ai,s.eE)||s.cS(Bn,Bn,Ai);const Fi=s.aB([],Bn,yi.globalMatrix),er=s.aB([],ge.expandedFarZProjMatrix,Fi),Ta=s.aB([],ge.expandedFarZProjMatrix,Bn),Js=s.aC([],[Ji,zr,gr,1],er)[2];yi.hidden=!1;let Ps=ke;Pt||(kt&&(Ps*=Un.cameraCollisionOpacity,Ps*=ug(Bn,ge,Un.aabb,zt)),Ps*=Ze(cn,Js)),Ps!==0?li.push({nodeInfo:Un,depth:Js,opacity:Ps,wvpForNode:er,wvpForTile:Ta,nodeModelMatrix:Fi,tileModelMatrix:Bn}):yi.hidden=!0}Pt||li.sort((Un,yi)=>!kt||Un.opacity===1&&yi.opacity===1?Un.depth<yi.depth?-1:1:Un.opacity===1?-1:yi.opacity===1?1:Un.depth>yi.depth?-1:1);for(const Un of li){const yi=Un.nodeInfo,gr=yi.node;let Li=s.aB([],Qe,Un.tileModelMatrix);s.aB(Li,lt,Li);const Ai=s.bl([],Li);s.eg(Ai,Ai),s.cS(Ai,Ai,Ih),Li=s.aB(Li,Li,gr.globalMatrix);const Bn=ue.renderPass==="light-beam",qn=Te.paint.get("model-color-use-theme").constantOr("default")==="none",Ji=ki&s.eI.HasMapboxMeshFeatures,zr=Ji?0:yi.evaluatedRMEA[0][2];for(let Fi=0;Fi<gr.meshes.length;++Fi){const er=gr.meshes[Fi],Ta=Fi===gr.lightMeshIndex;let Js=Un.wvpForNode;if(Ta){if(!Bn&&!ue.terrain&&ue.shadowRenderer){ue.currentLayer<ue.firstLightBeamLayer&&(ue.firstLightBeamLayer=ue.currentLayer);continue}Js=Un.wvpForTile}else if(Bn)continue;const Ps={defines:[]},Ii=[];if(!Pt&&Le&&(Le.useNormalOffset=!!er.normalBuffer),No(Ps.defines,Ii,er,ue,qn?null:Te.lut),Ji||Ps.defines.push("DIFFUSE_SHADED"),bi&&Ps.defines.push("SHADOWS_SINGLE_CASCADE"),an&&(Pt?an.numRenderedVerticesInShadowPass+=er.vertexArray.length:an.numRenderedVerticesInTransparentPass+=er.vertexArray.length),Pt){Ad(er,Un.nodeModelMatrix,ue,Te);continue}let fo=null;if(Pe){const Qr=Wp(Un.nodeModelMatrix,ue.transform);if(fo=new Float32Array(Qr),ge.projection.name!=="globe"){const rr=er.aabb.min,rs=er.aabb.max,[Cs,Ir]=Pe.getOpacityForBounds(Qr,rr[0],rr[1],rs[0],rs[1]);Ps.overrideFog=Cs>=tn||Ir>=tn}}const ea=er.material;let ca;ea.occlusionTexture&&ea.occlusionTexture.offsetScale&&(ca=ea.occlusionTexture.offsetScale,Ps.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const jo=ue.getOrCreateProgram("model",Ps);!Pt&&Le&&Le.setupShadowsFromMatrix(Un.tileModelMatrix,jo,Le.useNormalOffset),ue.uploadCommonUniforms(ve,jo,null,fo);const Xa=ea.pbrMetallicRoughness;Xa.metallicFactor=.9,Xa.roughnessFactor=.5;const Tr=jl(new Float32Array(Js),new Float32Array(Li),new Float32Array(Ai),new Float32Array(gr.globalMatrix),ue,Un.opacity,Xa.baseColorFactor,ea.emissiveFactor,Xa.metallicFactor,Xa.roughnessFactor,ea,zr,Te,[0,0,0],ca);!Ta&&(yi.hasTranslucentParts||Un.opacity<1)&&jo.draw(ue,ve.gl.TRIANGLES,mt,Ln.disabled,zn.disabled,Rn.backCCW,Tr,Te.id,er.vertexBuffer,er.indexBuffer,er.segments,Te.paint,ue.transform.zoom,void 0,Ii),jo.draw(ue,ve.gl.TRIANGLES,Ta?nt:mt,Ln.disabled,Ta||Un.opacity<1||yi.hasTranslucentParts?zn.alphaBlended:zn.unblended,Rn.backCCW,Tr,Te.id,er.vertexBuffer,er.indexBuffer,er.segments,Te.paint,ue.transform.zoom,void 0,Ii)}}}})()})(f,n,c,p),void H();if(G.type!=="model")return;const $=G.getModels(),J=[],Y=f.transform.getFreeCameraOptions().position,ee=s.c5([],[Y.x,Y.y,Y.z],f.transform.worldSize);s.ew(ee,ee);const re=[],pe=[];let fe=0;for(const ue of $){const Ie=n.getFeatureState("",ue.id),Te={type:"Unknown",id:ue.id,properties:ue.featureProperties},Ae=c.paint.get("model-rotation").evaluate(Te,Ie),ve=c.paint.get("model-scale").evaluate(Te,Ie),ge=c.paint.get("model-translation").evaluate(Te,Ie),Pe=c.paint.get("model-opacity").evaluate(Te,Ie);lg(c,ue.id,Ie,ue.featureProperties,ue.nodeOverrideNames,ue.nodeOverrides),cg(c,ue.id,Ie,ue.featureProperties,ue.materialOverrideNames,ue.materialOverrides),ue.nodeOverrides.size>0&&ue.computeBoundsAndApplyParent(),ue.computeModelMatrix(f,Ae,ve,ge,I,E,!1);const Le=s.bA([]),Fe=s.ef(ue.position.lat,f.transform.zoom),We=s.bq([],[1,1,1/Fe]);s.br(Le,Le,ee),J.push({zScaleMatrix:We,negCameraPosMatrix:Le});for(const $e of ue.nodes)Ah(f,$e,ue.matrix,f.transform.expandedFarZProjMatrix,fe,re,pe,ue.materialOverrides,Pe);fe++}if(re.sort((ue,Ie)=>Ie.depth-ue.depth),f.renderPass!=="shadow")Xp(f,c,re,pe,J),H();else{for(const ue of pe)Ad(ue.mesh,ue.nodeModelMatrix,f,c);for(const ue of re)Ad(ue.mesh,ue.nodeModelMatrix,f,c);H()}}},Qp={line:function(f,n,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const x of p){const b=n.getTile(x).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,c){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Sd(c,f)));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const b of x)b.upload(c.context)},raster:function(f,n,c){const p=n.getSource();if(!(p instanceof aa&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(x);if(b==null)return;const E=n.getIds().map(I=>n.getTileByID(I));for(const I of E)I.updateNeeded(f.id,b)&&p.prepareTile(I,x,f.id,b)},"raster-particle":function(f,n,c){const p=n.getSource();if(!(p instanceof aa&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(b==null)return;const E=n.getIds().map(I=>n.getTileByID(I));for(const I of E)I.updateNeeded(f.id,b)&&p.prepareTile(I,x,f.id,b)}},Zf={fill:eg},fg={fill:function(f,n,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const x=f.context.gl,b=new mn(x.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),E=new Ln({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),I=f.transform.getFreeCameraOptions().position,M=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of p){const O=n.getTile(z),H=O.getBucket(c);if(!H)continue;const G=H.elevatedStructures;if(!G||G.depthSegments.segments[0].primitiveLength===0)continue;const $=Pu(z.toUnwrapped(),I),J=f.translatePosMatrix(z.projMatrix,O,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Y=Ru(J,$,0,1,0);M.draw(f,x.TRIANGLES,b,E,zn.disabled,Rn.disabled,Y,c.id,G.vertexBuffer,G.indexBuffer,G.depthSegments,c.paint,f.transform.zoom)}}};class Jp{constructor(n,c,p,x,b){this.context=new _l(n,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of E)this._debugParams.enabledLayers[M]=!0;for(const M of E);this.occlusionParams=new Kp,this.setup(),this.numSublayers=us.maxUnderzooming+us.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _f(this),this._wireframeDebugCache=new Uf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(n,c){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xd(this,n));const x=this._terrain;this.transform.elevation=p?x:null,x.update(n,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const b=p+.78*(x-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new xd(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,c){if(this.width=n*s.o.devicePixelRatio,this.height=c*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(c,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const p=new s.bd;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(p,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const x=new s.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const b=new s.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(s.al,0,s.al,0),b.emplaceBack(0,s.al,0,s.al),b.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const E=new s.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E);const I=new s.be;for(const z of[0,1,3,2,0])I.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(I),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bC();const M=this.context.gl;this.stencilClearMode=new Ln({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,mn.disabled,this.stencilClearMode,zn.disabled,Rn.disabled,yd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,p){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const x=this.context,b=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(zn.disabled),x.setDepthMode(mn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const M=c.getTile(I),z=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:H,tileBoundsSegments:G}=this.getTileBoundsBuffers(M);E.draw(this,b.TRIANGLES,mn.disabled,new Ln({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),zn.disabled,Rn.disabled,yd(I.projMatrix),"$clipping",O,H,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new Ln({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new Ln({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,p=n.sort((E,I)=>I.overscaledZ-E.overscaledZ),x=p[p.length-1].overscaledZ,b=p[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let I=0;I<b;I++)E[I+x]=new Ln({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[E,p]}return[{[x]:Ln.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new zn([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}colorModeForDrapableLayerRenderPass(n){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?n!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new zn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new zn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(n,c,p,x=!1){if(this.depthOcclusion)return new mn(this.context.gl.GREATER,mn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return mn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new mn(p||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new vc(this.context,c,p,0,"texture"),this.depthTexture=new s.T(this.context,{width:c,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,c,p,0,0,c,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,c)=>n+c/this._fpsHistory.length,0))}render(n,c){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=c;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(b).filter(Qe=>{const ke=x[Qe];return!(ke.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ke.type]});let I=E(),M=!1,z=!1,O=null,H=0,G=!1;for(const Qe of I){const ke=x[Qe];ke.visibility!=="none"&&(ke.type==="circle"?M=!0:ke.type==="building"?(O=ke,++H):ke.type==="symbol"&&(ke.hasOcclusionOpacityProperties?z=!0:M=!0))}this.updateEmissiveMode();let $=I.map(Qe=>x[Qe]);const J=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Qe in J){const ke=J[Qe];ke.used&&(ke.prepare(this.context),ke.getSource().usedInConflation&&++H)}let Y=!1;for(const Qe of $)Qe.isHidden(this.transform.zoom)||(Qe.type==="clip"&&(Y=!0),this.prepareLayer(Qe));const ee={},re={},pe={},fe={},ue={};for(const Qe in J){const ke=J[Qe];ee[Qe]=ke.getVisibleCoordinates(),re[Qe]=ee[Qe].slice().reverse(),pe[Qe]=ke.getVisibleCoordinates(!0).reverse(),fe[Qe]=ke.getShadowCasterCoordinates(),ue[Qe]=ke.sortCoordinatesByDistance(ee[Qe])}const Ie=Qe=>{const ke=this.style.getLayerSourceCache(Qe);return ke&&ke.used?ke.getSource():null};if(H||Y||this._clippingActiveLastFrame){const Qe=[],ke=[];let mt=0;for(const nt of $)this.isSourceForClippingOrConflation(nt,Ie(nt))&&(Qe.push(nt),ke.push(mt)),mt++;if(Qe&&(Y||Qe.length>1)||this._clippingActiveLastFrame){Y=!1;const nt=[];for(let yt=0;yt<Qe.length;yt++){const Pt=Qe[yt],qt=ke[yt],zt=this.style.getLayerSourceCache(Pt);if(!zt||!zt.used||!zt.getSource().usedInConflation&&Pt.type!=="clip"&&Pt.type!=="building")continue;let kt=s.eQ,cn=s.b_.None;const an=[];let $t=!0;if(Pt.type==="building")kt=s.eS;else if(Pt.type==="clip")if(kt=qt,Pt.isHidden(this.transform.zoom))$t=!1;else{if(!Pt.layout){$t=!1;continue}for(const on of Pt.layout.get("clip-layer-types"))cn|=on==="model"?s.b_.Model:on==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const on of Pt.layout.get("clip-layer-scope"))an.push(on);Y=!0}$t&&nt.push({layer:Pt.fqid,cache:zt,order:kt,clipMask:cn,clipScope:an})}this.replacementSource.setSources(nt),G=!0}}this._clippingActiveLastFrame=Y,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Qe=0;Qe<$.length;Qe++){const ke=$[Qe];if(ke.visibility==="none")continue;const mt=ke.cutoffRange();if(this.longestCutoffRange=Math.max(mt,this.longestCutoffRange),mt>0){const nt=Ie(ke);nt&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom)),ke.minzoom&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom))}ke.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Qe),this._lastOcclusionLayer=Qe)}const Te=this.style&&this.style.fog;Te?(this._fogVisible=Te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=E(),$=I.map(Qe=>x[Qe]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Qe in J)for(const ke of ee[Qe]){let mt={min:0,max:0};this.terrain&&(mt=this.terrain.getMinMaxForTile(ke)||mt),Ae.addShadowReceiver(ke.toUnwrapped(),mt.min,mt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new Cd(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Hf(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),O){this.buildingTileBorderManager||(this.buildingTileBorderManager=new zu);const Qe=this.style.getLayerSourceCache(O);this.buildingTileBorderManager.updateBorders(Qe,O)}if(!Ti.has(this.context.gl))return;this.renderPass="offscreen";for(const Qe of $){const ke=n.getLayerSourceCache(Qe);if(!Qe.hasOffscreenPass()||Qe.isHidden(this.transform.zoom))continue;const mt=ke?re[ke.id]:void 0;(Qe.type==="custom"||Qe.type==="raster"||Qe.type==="raster-particle"||Qe.isSky()||mt&&mt.length)&&this.renderLayer(this,ke,Qe,mt)}this.depthRangeFor3D=[0,1-($.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,fe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Le=(()=>{if(c.showOverdrawInspector)return s.ao.black;const Qe=this.style.fog;if(Qe&&this.transform.projection.supportsFog){const ke=this.style.getLut(Qe.scope);if(!Pe){const mt=Qe.properties.get("color-use-theme")==="none",nt=Qe.properties.get("color").toNonPremultipliedRenderColor(mt?null:ke).toArray01();return new s.ao(...nt)}if(Pe){const mt=Qe.properties.get("space-color-use-theme")==="none",nt=Qe.properties.get("space-color").toNonPremultipliedRenderColor(mt?null:ke).toArray01();return new s.ao(...nt)}}return s.ao.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Qe=$[this.currentLayer],ke=n.getLayerSourceCache(Qe);if(Qe.isSky())continue;const mt=ke?(Qe.is3D(b)?ue:re)[ke.id]:void 0;this._renderTileClippingMasks(Qe,ke,mt),this.renderLayer(this,ke,Qe,mt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Qe=$[this.currentLayer],ke=n.getLayerSourceCache(Qe);Qe.isSky()&&this.renderLayer(this,ke,Qe,ke?re[ke.id]:void 0)}function Fe(Qe,ke){let mt;return ke&&(mt=(Qe.type==="symbol"?pe:Qe.is3D(b)?ue:re)[ke.id]),mt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Qe=$[this.currentLayer];if(Qe.type==="raster"||Qe.type==="raster-particle"){const ke=n.getLayerSourceCache(Qe);this.renderLayer(this,ke,Qe,Fe(Qe,ke))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const We=Ae?Ae.getGroundShadowLayerIndex():-1;let $e=!1,lt=-1;for(let Qe=0;Qe<I.length;++Qe){const ke=$[Qe];ke.isHidden(this.transform.zoom)||ke.is3D(b)&&(lt=Qe)}z&&lt===-1&&(M=!0);let xt=!1;for(;this.currentLayer<I.length;){const Qe=$[this.currentLayer],ke=n.getLayerSourceCache(Qe);if(Qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Qe)){if(Qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!xt&&Qe.is3D(b)&&!b){const mt=this.currentLayer,nt=yt=>{for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const Pt=$[this.currentLayer];if(Zf[Pt.type]){const qt=this.style.getLayerSourceCache(Pt);Zf[Pt.type](this,qt,Pt,Fe(Pt,qt),yt)}}};nt("initialize"),nt("reset"),this.currentLayer=mt,xt=!0}if(M&&!$e&&this.terrain&&!this.transform.isOrthographic&&($e=!0,this.blitDepth()),z&&lt!==-1&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Qe,ke,ke?ee[ke.id]:void 0),this.renderLayer(this,ke,Qe,Fe(Qe,ke)),!this.terrain&&Ae&&this.currentLayer===We){{this.clearStencil(),this.resetStencilClippingMasks();const mt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const nt=$[this.currentLayer];if(fg[nt.type]){const yt=this.style.getLayerSourceCache(nt);fg[nt.type](this,yt,nt,Fe(nt,yt))}}this.currentLayer=mt}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const mt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=mt;this.currentLayer++){const nt=$[this.currentLayer];if(!nt.hasLightBeamPass())continue;const yt=n.getLayerSourceCache(nt);this.renderLayer(this,yt,nt,yt?re[yt.id]:void 0)}this.currentLayer=mt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const mt=this.currentLayer;this.depthOcclusion=!0;for(const nt of this.layersWithOcclusionOpacity){this.currentLayer=nt;const yt=$[this.currentLayer],Pt=n.getLayerSourceCache(yt),qt=Pt?re[Pt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,Pt,Pt?ee[Pt.id]:void 0),this.renderLayer(this,Pt,yt,qt)}this.depthOcclusion=!1,this.currentLayer=mt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Qe=null;$.forEach(ke=>{const mt=n.getLayerSourceCache(ke);mt&&!ke.isHidden(this.transform.zoom)&&mt.getVisibleCoordinates().length&&(!Qe||Qe.getSource().maxzoom<mt.getSource().maxzoom)&&(Qe=mt)}),Qe&&this.options.showTileBoundaries&&ng(this,Qe,Qe.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ng(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Qe){const ke=Qe.transform.padding;ig(Qe,Qe.transform.height-(ke.top||0),3,qp),ig(Qe,ke.bottom||0,3,Hp),rg(Qe,ke.left||0,3,$p),rg(Qe,Qe.transform.width-(ke.right||0),3,I_);const mt=Qe.transform.centerPoint;(function(nt,yt,Pt,qt){jf(nt,yt-1,Pt-10,2,20,qt),jf(nt,yt-10,Pt-1,20,2,qt)})(Qe,mt.x,Qe.transform.height-mt.y,C_)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(n.type);if(Qp[n.type]&&(p||this.terrain&&n.type==="custom")){const x=this.style.getLayerSourceCache(n);Qp[n.type](n,x,this)}this.gpuTimingEnd()}renderLayer(n,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||ql[p.type](n,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const p in n){const x=n[p],b=this.context.extTimerQuery,E=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),c[p]=E}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of n)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(n,c,p,x,b){if(!p[0]&&!p[1])return n;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),O=Math.cos(E);p=[p[0]*O-p[1]*z,p[0]*z+p[1]*O]}const I=[b?p[0]:s.ay(c,p[0],this.transform.zoom),b?p[1]:s.ay(c,p[1],this.transform.zoom),0],M=new Float32Array(16);return s.br(M,n,I),M}saveTileTexture(n){if(n.context!==this.context)return;const c=n.size[0],p=this._tileTextures[c];p?p.push(n):this._tileTextures[c]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||b.push("FOG"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,b=this.currentGlobalDefines(n,c&&c.overrideFog,c&&c.overrideRtt).concat(p),E=Mf.cacheKey(kp[n],n,b,x);return this.cache[E]||(this.cache[E]=new Mf(this.context,n,kp[n],x,Of[n],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const b=((E,I,M)=>{const z=E.properties.get("direction"),O=E.properties.get("color-use-theme")==="none",H=E.properties.get("color").toNonPremultipliedRenderColor(O?null:M.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),$=I.properties.get("color-use-theme")==="none",J=I.properties.get("color").toNonPremultipliedRenderColor($?null:M.getLut(I.scope)).toArray01(),Y=I.properties.get("intensity"),ee=[z.x,z.y,z.z],re=s.dN(J,Y),pe=s.dN(H,G);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ee,u_lighting_directional_color:pe,u_ground_radiance:mh(ee,pe,re)}})(p,x,this.style);c.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,c,p,x,b){if(this.uploadCommonLightUniforms(n,c),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const I=E.getOpacity(this.transform.pitch),M=((z,O,H,G,$,J,Y,ee,re,pe,fe,ue)=>{const Ie=z.transform,Te=O.properties.get("color-use-theme")==="none",Ae=O.properties.get("color").toNonPremultipliedRenderColor(Te?null:z.style.getLut(O.scope)).toArray01();Ae[3]=G;const ve=z.frameCounter/1e3%1,[ge,Pe]=O.properties.get("vertical-range");return{u_fog_matrix:H?Ie.calculateFogTileMatrix(H):ue||z.identityMat,u_fog_range:O.getFovAdjustedRange(Ie._fov),u_fog_color:Ae,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,Pe),Pe],u_fog_temporal_offset:ve,u_frustum_tl:$,u_frustum_tr:J,u_frustum_br:Y,u_frustum_bl:ee,u_globe_pos:re,u_globe_radius:pe,u_viewport:fe,u_globe_transition:s.aj(Ie.zoom),u_is_globe:+(Ie.projection.name==="globe")}})(this,E,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],x);c.setFogUniformValues(n,M)}b&&c.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=n[x.key]||new Ao(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,c){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[n.key];return c||(this._cachedTileFogOpacities[n.key]=c=this.style.fog.getOpacityForTile(n)),c[0]>=tn||c[1]>=tn}setupDepthForOcclusion(n,c,p){const x=this.context,b=x.gl,E=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),E||c.setTerrainUniformValues(x,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const n=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=n?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function em(f,n){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,n),c=!1)};return()=>(c=!0,p||x(),p)}class za{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=em(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=pg(n);if(this._hashName){const p=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(E=>{const I=E.split("=")[0];return I===p?(x=!0,`${I}=${c}`):E}).filter(E=>E);return x||b.push(`${p}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function pg(f,n){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),E=Math.round(c.lng*b)/b,I=Math.round(c.lat*b)/b,M=f.getBearing(),z=f.getPitch();let O=n?`/${E}/${I}/${p}`:`${p}/${I}/${E}`;return(M||z)&&(O+="/"+Math.round(10*M)/10),z&&(O+=`/${Math.round(z)}`),O}const Fo={linearity:.3,easing:s.eT(0,0,.3,1)},D_=Object.assign({deceleration:2500,maxSpeed:1400},Fo),sr=Object.assign({deceleration:20,maxSpeed:1400},Fo),ei=Object.assign({deceleration:1e3,maxSpeed:360},Fo),Wf=Object.assign({deceleration:1e3,maxSpeed:90},Fo);class iu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=s.o.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const b=Tc(c.pan.mag(),p,Object.assign({},D_,n||{}));x.offset=c.pan.mult(b.amount/c.pan.mag()),x.center=this._map.transform.center,Hl(x,b)}if(c.zoom){const b=Tc(c.zoom,p,sr);x.zoom=this._map.transform.zoom+b.amount,Hl(x,b)}if(c.bearing){const b=Tc(c.bearing,p,ei);x.bearing=this._map.transform.bearing+s.aA(b.amount,-179,179),Hl(x,b)}if(c.pitch){const b=Tc(c.pitch,p,Wf);x.pitch=this._map.transform.pitch+b.amount,Hl(x,b)}if(x.zoom||x.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Hl(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Tc(f,n,c){const{maxSpeed:p,linearity:x,deceleration:b}=c,E=s.aA(f*x/(n/1e3),-p,p),I=Math.abs(E)/(b*x);return{easing:c.easing,duration:1e3*I,amount:E*(I/2)}}class Gs extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p,x={}){const b=ze(c.getCanvasContainer(),p),E=c.unproject(b);super(n,Object.assign({point:b,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class Rd extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p){const x=n==="touchend"?p.changedTouches:p.touches,b=Ve(c.getCanvasContainer(),x),E=b.map(M=>c.unproject(M)),I=b.reduce((M,z,O,H)=>M.add(z.div(H.length)),new s.P(0,0));super(n,{points:b,point:I,lngLats:E,lngLat:c.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Xf extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Ms{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Xf(this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Gs(n.type,this._map,n))}mouseup(n){this._map.fire(new Gs(n.type,this._map,n))}preclick(n){const c=new MouseEvent("preclick",n);this._map.fire(new Gs(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Gs(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Gs(n.type,this._map,n))}mouseover(n){this._map.fire(new Gs(n.type,this._map,n))}mouseout(n){this._map.fire(new Gs(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Rd(n.type,this._map,n))}touchmove(n){this._map.fire(new Rd(n.type,this._map,n))}touchend(n){this._map.fire(new Rd(n.type,this._map,n))}touchcancel(n){this._map.fire(new Rd(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class la{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Gs(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Gs(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tl{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ft(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const p=c,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const E=Math.min(x.x,p.x),I=Math.max(x.x,p.x),M=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=I-E+"px",this._box.style.height=z-M+"px")})}mouseupWindow(n,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&n.button===0){if(this.reset(),je(),p.x!==x.x||p.y!==x.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),fn(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new s.z(n,{originalEvent:c}))}}function $l(f,n){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=n[p];return c}class Rh{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const b=new s.P(0,0);for(const E of x)b._add(E);return b.div(x.length)})(c),this.touches=$l(p,c)))}touchmove(n,c,p){if(this.aborted||!this.centroid)return;const x=$l(p,c);for(const b in this.touches){const E=x[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,c,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Mh{constructor(n){this.singleTap=new Rh(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,p){this.singleTap.touchstart(n,c,p)}touchmove(n,c,p){this.singleTap.touchmove(n,c,p)}touchend(n,c,p){const x=this.singleTap.touchend(n,c,p);if(x){const b=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Dh{constructor(){this._zoomIn=new Mh({numTouches:1,numTaps:2}),this._zoomOut=new Mh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,p){this._zoomIn.touchstart(n,c,p),this._zoomOut.touchstart(n,c,p)}touchmove(n,c,p){this._zoomIn.touchmove(n,c,p),this._zoomOut.touchmove(n,c,p)}touchend(n,c,p){const x=this._zoomIn.touchend(n,c,p),b=this._zoomOut.touchend(n,c,p);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tm=0,Zl=2,nm={[tm]:1,[Zl]:2},nl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Nu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const p=Ke(n);this._correctButton(n,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(n,c){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&(function(x,b){const E=nm[b];return x.buttons===void 0||(x.buttons&E)!==E})(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(n){this._lastPoint&&Ke(n)===this._eventButton&&(this._moved&&je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Md extends Nu{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class Yf extends Nu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?nl[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=.8*(c.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Kf extends Nu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?nl[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=-.5*(c.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class xs{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,c,p){return this._calculateTransform(n,c,p)}touchmove(n,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,p)}}touchend(n,c,p){this._calculateTransform(n,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,p){p.length>0&&(this._active=!0);const x=$l(p,c),b=new s.P(0,0),E=new s.P(0,0);let I=0;for(const z in x){const O=x[z],H=this._touches[z];H&&(b._add(O),E._add(O.sub(H)),I++,x[z]=O)}if(this._touches=x,I<this._minTouches||!E.mag())return;const M=E.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ph{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,p){return{}}touchstart(n,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,p){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[b,E]=x,I=Bu(p,c,b),M=Bu(p,c,E);if(!I||!M)return;const z=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],z,n)}touchend(n,c,p){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=Bu(p,c,x),I=Bu(p,c,b);E&&I||(this._active&&je(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bu(f,n,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return n[p]}function Dd(f,n){return Math.log2(f/n)}class Fu extends Ph{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Dd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dd(this._distance,p),pinchAround:c}}}function Pd(f,n){return 180*f.angleWith(n)/Math.PI}class kd extends Ph{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pd(this._vector,p),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=Pd(n,p);return Math.abs(x)<c}}function kh(f){return Math.abs(f.y)>Math.abs(f.x)}class Vu extends Ph{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,kh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,p){const x=this._lastPoints;if(!x)return;const b=n[0].sub(x[0]),E=n[1].sub(x[1]);return this._map._cooperativeGestures&&!s.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(n,c,p){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=c.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=n.y>0==c.y>0;return kh(n)&&kh(c)&&E}}const Qf={panStep:100,bearingStep:15,pitchStep:10};class Ld{constructor(){const n=Qf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,p=0,x=0,b=0,E=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),E=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Wl,zoom:c?Math.round(M)+c*(n.shiftKey?2:1):M,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wl(f){return f*(2-f)}const Lh=4.000244140625,mg=1/450;class Jf{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mg,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%Lh===0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ze(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Lh?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&O!==0&&(O=1/O);const H=c(),G=Math.pow(2,H),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*O))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,b=this._easing;let E,I=!1;if(this._type==="wheel"&&x&&b){const z=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),O=b(z);E=s.ak(x,p,O),z<1?this._frameId||(this._frameId=!0):I=!0}else E=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-c();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=s.eV;if(this._prevEase){const p=this._prevEase,x=(s.o.now()-p.start)/p.duration,b=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);c=s.eT(E,I,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ec{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class im{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gg{constructor(){this._tap=new Mh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,c,p))}touchmove(n,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,c,p)}touchend(n,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,c,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep{constructor(n,c,p){this._el=n,this._mousePan=c,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zd{constructor(n,c,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hs{constructor(n,c,p,x){this._el=n,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tp=f=>f.zoom||f.drag||f.pitch||f.rotate;class P_ extends s.z{}class _g{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const p=s.av([],c,n);this.radius=s.ag(p[2]<0?s.eX([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.eX(n,n,this.constants),s.aw(n,n),s.eY(n,n,this.constants);const c=s.c5([],n,this.radius);if(c[2]>0){const p=s.c5([],[0,0,1],s.bJ(c,[0,0,1])),x=s.c5([],s.aw([],[c[0],c[1],0]),this.radius),b=s.d8([],c,s.c5([],s.av([],s.d8([],x,p),c),2));c[0]=b[0],c[1]=b[1]}return c}}function ru(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class su{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new iu(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _g,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,E]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,I,E)}}destroy(){for(const[n,c,p]of this._listeners){const x=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(c,x,p)}}_addDefaultHandlers(n){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Ms(c,n));const x=c.boxZoom=new tl(c,n);this._add("boxZoom",x);const b=new Dh,E=new im;c.doubleClickZoom=new Ec(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const I=new gg;this._add("tapDragZoom",I);const M=c.touchPitch=new Vu(c);this._add("touchPitch",M);const z=new Yf(n),O=new Kf(n);c.dragRotate=new zd(n,z,O),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const H=new Md(n),G=new xs(c,n);c.dragPan=new ep(p,H,G),this._add("mousePan",H),this._add("touchPan",G,["touchZoom","touchRotate"]);const $=new kd,J=new Fu;c.touchZoomRotate=new hs(p,J,$,I),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new la(c));const Y=c.scrollZoom=new Jf(c,this);this._add("scrollZoom",Y,["mousePan"]);const ee=c.keyboard=new Ld;this._add("keyboard",ee);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[re]&&c[re].enable(n[re])}_add(n,c,p){this._handlers.push({handlerName:n,handler:c,allowed:p}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!tp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,p){for(const x in n)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const p of n)this._el.contains(p.target)&&c.push(p);return c}handleEvent(n,c){this._updatingCamera=!0;const p=n.type==="renderFrame",x=p?void 0:n,b={needsRenderFrame:!1},E={},I={},M=n.touches?this._getMapTouches(n.touches):void 0,z=M?Ve(this._el,M):p?void 0:ze(this._el,n);for(const{handlerName:G,handler:$,allowed:J}of this._handlers){if(!$.isEnabled())continue;let Y;this._blockedByActive(I,J,G)?$.reset():$[c||n.type]&&(Y=$[c||n.type](n,z,M),this.mergeHandlerResult(b,E,Y,G,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||$.isActive())&&(I[G]=$)}const O={};for(const G in this._previousActiveHandlers)I[G]||(O[G]=x);this._previousActiveHandlers=I,(Object.keys(O).length||ru(b))&&(this._changes.push([b,E,O]),this._triggerRenderFrame()),(Object.keys(I).length||ru(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(n,c,p,x,b){if(!p)return;Object.assign(n,p);const E={handlerName:x,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(c.zoom=E),p.panDelta!==void 0&&(c.drag=E),p.pitchDelta!==void 0&&(c.pitch=E),p.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const n={},c={},p={};for(const[x,b,E]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),Object.assign(c,b),Object.assign(p,E);this._updateMapTransform(n,c,p),this._changes=[]}_updateMapTransform(n,c,p){const x=this._map,b=x.transform,E=pe=>[pe.x,pe.y,pe.z];if((()=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!ru(n)){const pe=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),pe!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!ru(n))return void this._fireEvents(c,p,!0);let{panDelta:I,zoomDelta:M,bearingDelta:z,pitchDelta:O,around:H,aroundCoord:G,pinchAround:$}=n;b._isCameraConstrained&&(M>0&&(M=0),b._isCameraConstrained=!1),$!==void 0&&(H=$),(M||(pe=>c[pe]&&!this._eventsInProgress[pe])("drag"))&&H&&(this._dragOrigin=E(b.pointCoordinate3D(H)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,z&&(b.bearing+=z),O&&(b.pitch+=O),b._updateCameraState();const J=[0,0,0];if(I)if(b.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),fe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(I)).dir);J[0]=fe[0]-pe[0],J[1]=fe[1]-pe[1]}else{const pe=b.pointCoordinate(H);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const fe=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-I.x*s.eW(s.a$(pe.y))*fe,J[1]=-I.y*s.eW(b.center.lat)*fe}else{const fe=b.pointCoordinate(H.sub(I));pe&&fe&&(J[0]=fe.x-pe.x,J[1]=fe.y-pe.y)}}const Y=b.zoom,ee=[0,0,0];if(M){const pe=E(G||b.pointCoordinate3D(H)),fe={dir:s.aw([],s.av([],pe,b._camera.position))};if(fe.dir[2]<0){const ue=b.zoomDeltaToMovement(pe,M);s.c5(ee,fe.dir,ue)}}const re=s.d8(J,J,ee);b._translateCameraConstrained(re),M&&Math.abs(b.zoom-Y)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,p,!0)}_fireEvents(n,c,p){const x=tp(this._eventsInProgress),b=tp(n),E={};for(const O in n){const{originalEvent:H}=n[O];this._eventsInProgress[O]||(E[`${O}start`]=H),this._eventsInProgress[O]=n[O]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in n){const{originalEvent:H}=n[O];this._fireEvent(O,H)}const I={};let M;for(const O in this._eventsInProgress){const{handlerName:H,originalEvent:G}=this._eventsInProgress[O];this._handlersById[H].isActive()||(delete this._eventsInProgress[O],M=c[H]||G,I[`${O}end`]=M)}for(const O in I)this._fireEvent(O,I[O]);const z=tp(this._eventsInProgress);if(p&&(x||b)&&!z){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;O?(H(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new s.z("moveend",{originalEvent:M})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new s.z(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new P_("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const rm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class yg extends s.E{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},c),p)}panTo(n,c,p){return this.easeTo(Object.assign({center:n},c),p)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,p){return this.easeTo(Object.assign({zoom:n},c),p)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,p){return this.easeTo(Object.assign({bearing:n},c),p)}resetNorth(n,c){return this.rotateTo(0,Object.assign({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=s.aI.convert(n);const p=c&&c.bearing||0,x=c&&c.pitch||0,b=n.getNorthWest(),E=n.getSouthEast();return this._cameraForBounds(this.transform,b,E,p,x,c)}_extendPadding(n){const c={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},c,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},c,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,p,x,b,E){const I=n.clone(),M=this._extendCameraOptions(E);I.bearing=x,I.pitch=b;const z=s.aT.convert(c),O=s.aT.convert(p),H=.5*(z.lat+O.lat),G=.5*(z.lng+O.lng),$=s.eZ(H,G),J=s.aw([],$),Y=s.aw([],s.bI([],J,[0,1,0])),ee=s.bI([],Y,J),re=[Y[0],Y[1],Y[2],0,ee[0],ee[1],ee[2],0,J[0],J[1],J[2],0,0,0,0,1],pe=[$,s.eZ(z.lat,z.lng),s.eZ(O.lat,z.lng),s.eZ(O.lat,O.lng),s.eZ(z.lat,O.lng),s.eZ(H,z.lng),s.eZ(H,O.lng),s.eZ(z.lat,G),s.eZ(O.lat,G)];let fe=s.d9.fromPoints(pe.map(nt=>[s.bJ(Y,nt),s.bJ(ee,nt),s.bJ(J,nt)]));const ue=s.af([],fe.center,re);s.e_(ue)===0&&s.e$(ue,0,0,1),s.aw(ue,ue),s.c5(ue,ue,s.aD),I.center=s.f0(ue);const Ie=I.getWorldToCameraMatrix(),Te=s.bl(new Float64Array(16),Ie);fe=s.d9.applyTransform(fe,s.aB([],Ie,re));const Ae=this._extendAABB(fe,I,M,x);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Ae,s.af(ue,ue,Ie);const ve=.5*(fe.max[2]-fe.min[2]),ge=this._minimumAABBFrustumDistance(I,fe),Pe=s.c5([],[0,0,1],ve),Le=s.d8(Pe,ue,Pe),Fe=ge+(I.pitch===0?0:s.bG(ue,Le)),We=I.globeCenterInViewSpace,$e=s.av([],ue,[We[0],We[1],We[2]]);s.aw($e,$e),s.c5($e,$e,Fe);const lt=s.d8([],ue,$e);s.af(lt,lt,Te);const xt=s.eM/s.aD,Qe=s.ag(lt),ke=s.cf(Math.max(Qe*xt-s.eM,Number.EPSILON),0),mt=Math.min(I.zoomFromMercatorZAdjusted(ke),M.maxZoom);return mt>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=mt,this._cameraForBounds(I,c,p,x,b,E)):{center:I.center,zoom:mt,bearing:x,pitch:b}}_extendAABB(n,c,p,x){const b=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=E,M=b,z=b,O=E,H=c.width-(M+z),G=c.height-(I+O),$=s.av([],n.max,n.min),J=Math.min(H/$[0],G/$[1]),Y=Math.min(c.scaleZoom(c.scale*J),p.maxZoom);if(isNaN(Y))return null;const ee=c.scale/c.zoomScale(Y),re=new s.d9([n.min[0]-M*ee,n.min[1]-O*ee,n.min[2]],[n.max[0]+z*ee,n.max[1]+I*ee,n.max[2]]),pe=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(x));return re.center[0]-=pe.x*ee,re.center[1]+=pe.y*ee,re}queryTerrainElevation(n,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(s.ae.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,p,x,b,E){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,p,x,b,E);const I=n.clone(),M=this._extendCameraOptions(E);I.bearing=x,I.pitch=b;const z=s.aT.convert(c),O=s.aT.convert(p),H=new s.aT(z.lng,O.lat),G=new s.aT(O.lng,z.lat),$=I.project(z),J=I.project(O),Y=this.queryTerrainElevation(z),ee=this.queryTerrainElevation(O),re=this.queryTerrainElevation(H),pe=this.queryTerrainElevation(G),fe=[[$.x,$.y,Math.min(Y||0,ee||0,re||0,pe||0)],[J.x,J.y,Math.max(Y||0,ee||0,re||0,pe||0)]];let ue=s.d9.fromPoints(fe);const Ie=I.getWorldToCameraMatrix(),Te=s.bl(new Float64Array(16),Ie);ue=s.d9.applyTransform(ue,Ie);const Ae=this._extendAABB(ue,I,M,x);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=Ae;const ve=.5*s.av([],ue.max,ue.min)[2],ge=this._minimumAABBFrustumDistance(I,ue),Pe=[0,0,1,0];s.aC(Pe,Pe,Ie),s.f1(Pe,Pe);const Le=s.c5([],Pe,ge+ve),Fe=s.d8([],ue.center,Le);s.af(ue.center,ue.center,Te),s.af(Fe,Fe,Te);const We=I.unproject(new s.P(ue.center[0],ue.center[1])),$e=s.f2(I.projection,We),lt=Math.pow(2,$e),xt=Math.min(I._zoomFromMercatorZ(Fe[2]*I.pixelsPerMeter*lt/I.worldSize),M.maxZoom);return I.mercatorFromTransition&&xt<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=xt,this._cameraForBounds(I,c,p,x,b,E)):{center:We,zoom:xt,bearing:x,pitch:b}}fitBounds(n,c,p){const x=this.cameraForBounds(n,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(n,c,p,x,b){const E=s.P.convert(n),I=s.P.convert(c),M=new s.P(Math.min(E.x,I.x),Math.min(E.y,I.y)),z=new s.P(Math.max(E.x,I.x),Math.max(E.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,I))return this;const O=this.transform.pointLocation3D(M),H=this.transform.pointLocation3D(z),G=this.transform.pointLocation3D(new s.P(M.x,z.y)),$=this.transform.pointLocation3D(new s.P(z.x,M.y)),J=[Math.min(O.lng,H.lng,G.lng,$.lng),Math.min(O.lat,H.lat,G.lat,$.lat)],Y=[Math.max(O.lng,H.lng,G.lng,$.lng),Math.max(O.lat,H.lat,G.lat,$.lat)],ee=x&&x.pitch?x.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,J,Y,p,ee,x);return this._fitInternal(re,x,b)}_fitInternal(n,c,p){return n?(c=Object.assign(n,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(n,c){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;"zoom"in n&&p.zoom!==+n.zoom&&(x=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.aT.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(b=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(E=!0,p.pitch=+n.pitch);const I=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(I))if(n.retainPadding===!1){const M=p.clone();M.padding=I,p.setLocationAtPoint(p.center,M.centerPoint)}else p.padding=I;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),x&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),b&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),E&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(rm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(rm),this;this.stop();const x=p.zoom,b=p.pitch,E=p.bearing;p.setFreeCameraOptions(n);const I=x!==p.zoom,M=b!==p.pitch,z=E!==p.bearing;return this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),I&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),z&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),M&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eV},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in n?+n.zoom:x,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,O="pitch"in n?+n.pitch:E,H=this._extendPadding(n.padding),G=s.P.convert(n.offset);let $,J,Y;if(p.projection.name==="globe"){const Pe=s.ae.fromLngLat(p.center),Le=G.rotate(-p.angle);Pe.x+=Le.x/p.worldSize,Pe.y+=Le.y/p.worldSize;const Fe=Pe.toLngLat(),We=s.aT.convert(n.center||Fe);this._normalizeCenter(We),$=p.centerPoint.add(Le),J=new s.P(Pe.x,Pe.y).mult(p.worldSize),Y=new s.P(s.aF(We.lng),s.aJ(We.lat)).mult(p.worldSize).sub(J)}else{$=p.centerPoint.add(G);const Pe=p.pointLocation($),Le=s.aT.convert(n.center||Pe);this._normalizeCenter(Le),J=p.project(Pe),Y=p.project(Le).sub(J)}const ee=p.zoomScale(M-x);let re,pe;n.around&&(re=s.aT.convert(n.around),pe=p.locationPoint(re));const fe=this._zooming||M!==x,ue=this._rotating||b!==z,Ie=this._pitching||O!==E,Te=!p.isPaddingEqual(H),Ae=n.retainPadding===!1?p.clone():p,ve=Pe=>Le=>{if(fe&&(Pe.zoom=s.ak(x,M,Le)),ue&&(Pe.bearing=s.ak(b,z,Le)),Ie&&(Pe.pitch=s.ak(E,O,Le)),Te&&(Ae.interpolatePadding(I,H,Le),$=Ae.centerPoint.add(G)),re)Pe.setLocationAtPoint(re,pe);else{const Fe=Pe.zoomScale(Pe.zoom-x),We=M>x?Math.min(2,ee):Math.max(.5,ee),$e=Math.pow(We,1-Le),lt=Pe.unproject(J.add(Y.mult(Le*$e)).mult(Fe));Pe.setLocationAtPoint(Pe.renderWorldCopies?lt.wrap():lt,$)}return n.preloadOnly||this._fireMoveEvents(c),Pe};if(n.preloadOnly){const Pe=this._emulate(ve,n.duration,p);return this._preloadTiles(Pe),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ue,this._pitching=Ie,this._padding=Te,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ge),this._ease(ve(p),Pe=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Pe)},n),this}_prepareEase(n,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new s.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",n)),x&&this.fire(new s.z("rotateend",n)),b&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const nt=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(nt,c)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},n);const p=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in n?s.aA(+n.zoom,p.minZoom,p.maxZoom):x,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,O="pitch"in n?+n.pitch:E,H=this._extendPadding(n.padding),G=p.zoomScale(M-x),$=s.P.convert(n.offset);let J=p.centerPoint.add($);const Y=p.pointLocation(J),ee=s.aT.convert(n.center||Y);this._normalizeCenter(ee);const re=p.project(Y),pe=p.project(ee).sub(re);let fe=n.curve;const ue=Math.max(p.width,p.height),Ie=ue/G,Te=pe.mag();if("minZoom"in n){const nt=s.aA(Math.min(n.minZoom,x,M),p.minZoom,p.maxZoom),yt=ue/p.zoomScale(nt-x);fe=Math.sqrt(yt/Te*2)}const Ae=fe*fe;function ve(nt){const yt=(Ie*Ie-ue*ue+(nt?-1:1)*Ae*Ae*Te*Te)/(2*(nt?Ie:ue)*Ae*Te);return Math.log(Math.sqrt(yt*yt+1)-yt)}function ge(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function Pe(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Le=ve(0);let Fe=function(nt){return Pe(Le)/Pe(Le+fe*nt)},We=function(nt){return ue*((Pe(Le)*(ge(yt=Le+fe*nt)/Pe(yt))-ge(Le))/Ae)/Te;var yt},$e=(ve(1)-Le)/fe;if(Math.abs(Te)<1e-6||!isFinite($e)){if(Math.abs(ue-Ie)<1e-6)return this.easeTo(n,c);const nt=Ie<ue?-1:1;$e=Math.abs(Math.log(Ie/ue))/fe,We=function(){return 0},Fe=function(yt){return Math.exp(nt*fe*yt)}}n.duration="duration"in n?+n.duration:1e3*$e/("screenSpeed"in n?+n.screenSpeed/fe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const lt=b!==z,xt=O!==E,Qe=!p.isPaddingEqual(H),ke=n.retainPadding===!1?p.clone():p,mt=nt=>yt=>{const Pt=yt*$e,qt=1/Fe(Pt);nt.zoom=yt===1?M:x+nt.scaleZoom(qt),lt&&(nt.bearing=s.ak(b,z,yt)),xt&&(nt.pitch=s.ak(E,O,yt)),Qe&&(ke.interpolatePadding(I,H,yt),J=ke.centerPoint.add($));const zt=yt===1?ee:nt.unproject(re.add(pe.mult(We(Pt))).mult(qt));return nt.setLocationAtPoint(nt.renderWorldCopies?zt.wrap():zt,J),nt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),nt};if(n.preloadOnly){const nt=this._emulate(mt,n.duration,p);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=lt,this._pitching=xt,this._padding=Qe,this._prepareEase(c,!1),this._ease(mt(p),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,c,p){p.animate===!1||p.duration===0?(n(1),c()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=s.bT(n,-180,180);const p=Math.abs(n-c);return Math.abs(n-360-c)<p&&(n-=360),Math.abs(n+360-c)<p&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=n.lng-c.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,p){const x=Math.ceil(15*c/1e3),b=[],E=n(p.clone());for(let I=0;I<=x;I++){const M=E(I/x);b.push(M.clone())}return b}_preloadTiles(n,c){}}class Od{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=Ye("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=Ye("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=c.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<c.length-1?"&":""}`),x),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${pg(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const b=c[x];if(b.used){const E=b.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n.sort((x,b)=>x.length-b.length),n=n.filter((x,b)=>{for(let E=b+1;E<n.length;E++)if(n[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.map(x=>(function(b){const E=new DOMParser().parseFromString(b,"text/html");return Array.from(E.body.querySelectorAll("*")).reverse().forEach(I=>{const M=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(...I.childNodes);const z=I.getAttribute("href");if(!z||!/^(https?:|mailto:)/i.test(z))return void I.replaceWith(E.createTextNode(M));const O=E.createElement("a");O.href=z,O.textContent=M,O.rel="noopener nofollow";const H=I.getAttribute("class");H&&(O.className=H),I.replaceWith(O)}),E.body.innerHTML})(x)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xl{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Ye("div","mapboxgl-ctrl");const c=Ye("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const p=n[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class xg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class mr{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=s.dD((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,p){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+p}}const vg={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class sm extends s.z{constructor(n,c,p,x){const{point:b,lngLat:E,originalEvent:I,target:M}=n;super(n.type,{point:b,lngLat:E,originalEvent:I,target:M}),this.preventDefault=()=>{n.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class bg{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,c){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(n,s.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,c)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(n,c),this.typeById.set(n,x)}get(n){const c=this.typeById.get(n);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(n):void 0}remove(n){const c=this.typeById.get(n);if(!c)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(c);p&&(p.delete(n),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(n,c){const p=[];for(const[x,b]of c)b.target&&p.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());c.length&&(n.type="mouseenter",this.handleType(n,c));const p=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(b.id,b);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(n.type="mouseleave",this.handleType(n,c)),this.hoveredFeatures.clear()}handleType(n,c){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!c;c=c||this.queryTargets(n.point,x);let E=!1;const I=new Set;for(const M of c){for(const[z,O]of x){if(!O.target)continue;const H=M.variants?M.variants[z]:null;if(H){for(const G of H){if(dl(G,M,I,z))continue;const $=new s.dx(M,G),J=Ua(G,M,z);b&&$.id!==void 0&&($.state=this.map.getFeatureState($));const Y=p?this.prevHoveredFeatures.get(J):null,ee=new sm(n,z,O,$),re=Y?Y.stop:O.handler(ee);if(p&&this.hoveredFeatures.set(J,{feature:M,stop:re}),re!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[M,z]of x){const{handler:O,target:H}=z;if(!H&&O(new sm(n,M,z,null))!==!1)break}}}function am(f,n){if(Array.isArray(f)&&Array.isArray(n)){const c=new Set(f),p=new Set(n);return c.size===p.size&&f.every(x=>p.has(x))}return s.by(f,n)}const Nd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ds{constructor(n,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Yf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Kf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),Ft()}move(n,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(n,c),b=x&&x.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(n,c),I=E&&E.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){fn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ze(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ze(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ve(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ve(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function zh(f,n,c){if(f=new s.aT(f.lng,f.lat),n){const p=new s.aT(f.lng-360,f.lat),x=new s.aT(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint3D(f).distSqr(n),I=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint3D(p).distSqr(n)<E&&(I||Math.abs(p.lng-c.center.lng)<b)?f=p:c.locationPoint3D(x).distSqr(n)<E&&(I||Math.abs(x.lng-c.center.lng)<b)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const xl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},$r={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ds extends s.E{constructor(n,c){super(),(n instanceof HTMLElement||c)&&(n=Object.assign({element:n},c)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:b=1,draggable:E=!1,clickTolerance:I=0,rotation:M=$r.rotation,rotationAlignment:z=$r.rotationAlignment,pitchAlignment:O=$r.pitchAlignment,occludedOpacity:H=$r.occludedOpacity,altitude:G=$r.altitude}=n||{};this._anchor=p,this._color=x,this._scale=b,this._draggable=E,this._clickTolerance=I,this._rotation=M,this._rotationAlignment=z,this._pitchAlignment=O,this._occludedOpacity=H,this._altitude=G,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const $=this._element.classList;for(const Y in xl)$.remove(`mapboxgl-marker-anchor-${Y}`);$.add(`mapboxgl-marker-anchor-${this._anchor}`);const J=n&&n.className?n.className.trim().split(/\s+/):[];$.add(...J),this._popup=null}_createDefaultMarker(){const n=Ye("div"),c=Xe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=Xe("radialGradient",{id:"shadowGradient"},Xe("defs",{},c));Xe("stop",{offset:"10%","stop-opacity":.4},p),Xe("stop",{offset:"100%","stop-opacity":.05},p),Xe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Xe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Xe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Xe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aT.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||$r.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,p=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const p=n.unproject(c,this._altitude),x=n.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(c,this._altitude);let x;n._showingGlobe()&&s.f5(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${xl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!n||p!=="map")return"";if(!c._showingGlobe()){const M=c.getPitch();return M?`rotateX(${M}deg)`:""}const x=s.cX(s.f6(c.transform,this._lngLat)),b=n.sub(s.f7(c.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const I=x/E;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const b=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=s.cX(Math.atan2(E.y,E.x))-90}else p=-c.getBearing();else if(x==="horizon"){const b=s.ah(4,6,c.getZoom()),E=s.f7(c.transform);E.y+=b*c.transform.height;const I=n.sub(E),M=s.cX(Math.atan2(I.y,I.x));p=(M>90?M-270:M+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=zh(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(n.point.dist(p)<b)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,p=this._pos;c&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||$r.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||$r.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||$r.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||$r.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Bd={maxWidth:100,unit:"metric"},is={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ho={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Oh(f=new s.P(0,0),n="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new s.P(0,f);case"top-left":return new s.P(c,c);case"top-right":return new s.P(-c,c);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(c,-c);case"bottom-right":return new s.P(-c,-c);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[n]||[0,0])}return{version:B,supported:Je.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends yg{constructor(f){W.mark(V.create);const n=f;if((f=Object.assign({},Nd,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.f3(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gf(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new xg,this._domRenderTaskQueue=new xg,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},vg,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Zt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new su(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new za(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Od({customAttribution:f.customAttribution})),this._logoControl=new Xl,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new s.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new s.z(`${c.dataType}dataloading`,c))}),this._interactions=new bg(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),n&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let c;n==="globe"&&f.zoom>=s.cL?(f.setMercatorFromTransition(),c=!0):n==="mercator"&&f.zoom<s.cL&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;const c=this.transform.mercatorFromTransition;n=f.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(n||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(s.aT.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(s.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,c){const p=x=>{let b=[];if(Array.isArray(n)){const E=n.filter(I=>this.getLayer(I));b=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else b=this.queryRenderedFeatures(x,{target:n});return b};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:E=>{const I=p(E.point);I.length?x||(x=!0,c.call(this,new Gs(f,this,E.originalEvent,{features:I}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:I=>{p(I.point).length?x=!0:x&&(x=!1,c.call(this,new Gs(f,this,I.originalEvent)))},mouseout:I=>{x&&(x=!1,c.call(this,new Gs(f,this,I.originalEvent)))}}}}{const x=b=>{const E=p(b.point);E.length&&(b.features=E,c.call(this,b),delete b.features)};return{listener:c,targets:n,delegates:{[f]:x}}}}on(f,n,c){if(typeof n=="function"||c===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,n,c){if(typeof n=="function"||c===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,n,c){if(typeof n=="function"||c===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let b=0;b<x.length;b++){const E=x[b];if(E.listener===c&&am(E.targets,n)){for(const I in E.delegates)this.off(I,E.delegates[I]);return x.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),E=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(E)}let c=!0;if(n.target&&(c=this._isTargetValid(n.target),c&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,n,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),x}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}queryRasterValue(f,n,c){return this._isValidId(f)?this.style.queryRasterValue(f,n,c):Promise.resolve(null)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;s.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=Object.assign({},n);n&&n.config&&(c.initialConfig=n.config,delete c.config),this.style=new $a(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new $a(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:b,content:E}={}){this._lazyInitEmptyStyle();const I=s.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:M,height:z,data:O}=s.o.getImageData(n);this.style.addImage(I,{data:new s.q({width:M,height:z},O),pixelRatio:c,stretchX:x,stretchY:b,content:E,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:z}=n,O=n;this.style.addImage(I,{data:new s.q({width:M,height:z},new Uint8Array(O.data)),pixelRatio:c,stretchX:x,stretchY:b,content:E,sdf:p,usvg:!1,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const c=s.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:b,height:E,data:I}=x;if(b===void 0||E===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||E!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const M=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new s.q({width:b,height:E},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(I,M),this.style.updateImage(c,p,z)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,n){s.n(this._requestManager.transformRequest(f,s.R.Image),(c,p)=>{n(c,p instanceof HTMLImageElement?s.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch(c=>this.fire(new s.y(new Error("Failed to add import",c)))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,c),this._update(!0)):this}setFilter(f,n,c={}){return this._isValidId(f)?(this.style.setFilter(f,n,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,c,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,c,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}setLayerProperty(f,n,c,p={}){return this._isValidId(f)?(n==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,n,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,c){return this.style.setConfigProperty(f,n,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.style.indoorManager.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.style.indoorManager.setActiveFloorsVisibility(f)}getIndoorTileOptions(f,n){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(f,n):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,p,x,b=this._container;for(;b&&(!p||!x);){const E=window.getComputedStyle(b).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ye("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Ye("div","mapboxgl-canvas-container",f);this._canvas=Ye("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Ye("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=Ye("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=s.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=Object.assign({},Je.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(ur(n,!0),this.painter=new Jp(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{if(c.dataType==="source"){const p=this.transform.elevation?this.transform.elevation._source():null;p&&c.sourceCacheId===p.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new s.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=s.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,z=this.transform.pitch,O=s.o.now(),H=new s.ac(M,{now:O,fadeDuration:b,pitch:z,transition:this.style.transition,worldview:this._worldview});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,W.mark(V.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=s.o.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const z=x.getQueryParameter(n,x.QUERY_RESULT)/1e6;x.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:M,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(M);this.fire(new s.z("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(M);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:z}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,W.mark(V.fullLoad),this._performanceMetricsCollection&&cr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const E=Math.abs(x-b);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){Hn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===be||f.status===401)){const n=this.painter.context.gl;ur(n,!1),this._logoControl instanceof Xl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Kn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ci(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Gn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){jr(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(f,n,c){let p=c[1]-c[0];const x=f.length/4;for(let b=0;b<n.length;b++){const E=n[b];let I=0;for(let M=0;M<E.length;M+=4)E[M]===f[M]&&E[M+1]===f[M+1]&&E[M+2]===f[M+2]&&E[M+3]===f[M+3]&&(I+=1);p+=(c[b+2]-c[b+1])*(1-I/x)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ti.delete(this.painter.context.gl),Bs.remove(),wn.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return s.bw(n,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,n){s.f4(f,n)}get version(){return B}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},Sc,f),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=Ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),c=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ds(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const c=Ye("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.E{constructor(f={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Vo,f),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=em(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const n=new s.aT(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new s.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=s.cf(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:f.code,message:f.message,PERMISSION_DENIED:f.PERMISSION_DENIED,POSITION_UNAVAILABLE:f.POSITION_UNAVAILABLE,TIMEOUT:f.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const f=this.options.positionOptions.timeout;f&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},f))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Ye("button","mapboxgl-ctrl-geolocate",this._container),Ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ye("div","mapboxgl-user-location"),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ds({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ds({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(f){return this.options.followUserLocation=f??Vo.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const f=()=>{const n="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(n,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Od,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Bd,f),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,p=n._containerWidth/2-f/2,x=n.unproject([p,c]),b=n.unproject([p+f,c]),E=x.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*E;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,n,c){this._map._requestDomTask(()=>{const p=(function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z})(I),E*I})(n),x=p/n;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${is[c]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ye("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Cp,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create(ho),f),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Ye("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const c=this._closeButton=Ye("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,p=this._pos;if(!n||!c||!p)return"bottom";const x=c.offsetWidth,b=c.offsetHeight,E=p.x<x/2,I=p.x>n.transform.width-x/2;if(p.y+f<b)return E?"top-left":I?"top-right":"top";if(p.y>n.transform.height-b){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=Ye("div","mapboxgl-popup",n.getContainer()),this._tip=Ye("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zh(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof s.P?f:n.project(this._lngLat,this._altitude),b=Oh(this.options.offset),E=this._anchor=this._getAnchor(b.y),I=Oh(this.options.offset,E),M=x.add(I).round();n._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${xl[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=s.f5(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(au);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ds,Style:$a,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:__,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.fi.workerCount},set workerCount(f){s.fi.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.fh(f)},get workerUrl(){return s.fg.workerUrl},set workerUrl(f){s.fg.workerUrl=f},get workerClass(){return s.fg.workerClass},set workerClass(f){s.fg.workerClass=f},get workerParams(){return s.fg.workerParams},set workerParams(f){s.fg.workerParams=f},get dracoUrl(){return s.ff()},set dracoUrl(f){s.fe(f)},get meshoptUrl(){return s.fd()},set meshoptUrl(f){s.fc(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var C=y;return C}))})(jb)),jb.exports}var ZL=R7();const WL=Fv(ZL),M7=dN({__proto__:null,default:WL},[ZL]),HT="pk.eyJ1IjoiYmVybnlpbmRlZWQiLCJhIjoiY21rdDBnenY3MWt5eTNycTU1MTh5c3kzZSJ9.vGUkQt_FtPFQJRup6SFNzg",D7={longitude:-73.5791,latitude:45.4953},P7=[{id:"clinic-1",name:"Clinique Mdicale Crescent",address:"1198 Crescent St, Montreal, Quebec H3G 2A9",distance:.3,rating:2.1,phone:"(514) 933-8383"},{id:"clinic-2",name:"Clinique Mdicale Prive UnionMD",address:"1191 Avenue Union, Montreal, Quebec H3B 3C3",distance:.5,rating:4.5,phone:"(514) 332-4546"},{id:"clinic-3",name:"CuraMed",address:"4150 Rue Sainte-Catherine O #330, Westmount, Quebec H3Z 2Y5",distance:1.8,rating:4.8,phone:"(514) 612-2430"},{id:"clinic-4",name:"Clinique Sant MD",address:"1411 Peel St, Montreal, Quebec H3A 1S5",distance:.4,rating:4.2,phone:"(514) 843-1234"},{id:"clinic-5",name:"Centre Mdical Westmount",address:"5025 Sherbrooke St W, Westmount, Quebec H3Z 1H2",distance:2.1,rating:4.6,phone:"(514) 481-0268"},{id:"clinic-6",name:"Clinique Mdicale 1851",address:"1851 Sherbrooke St E, Montreal, Quebec H2K 1B4",distance:3.5,rating:3.9,phone:"(514) 524-7548"},{id:"clinic-7",name:"Clinique Mdicale du Plateau",address:"1315 Mont-Royal Ave E, Montreal, Quebec H2J 1Y6",distance:2.8,rating:4.1,phone:"(514) 521-1223"},{id:"clinic-8",name:"Clinique Mdicale Mtro",address:"1844 Rue Sainte-Catherine O, Montreal, Quebec H3H 1M1",distance:.2,rating:3.8,phone:"(514) 932-2334"},{id:"clinic-9",name:"Westmount Square Health Group",address:"1 Westmount Sq, Westmount, Quebec H3Z 2P9",distance:1.5,rating:4.9,phone:"(514) 934-2334"},{id:"clinic-10",name:"Rockland MD",address:"100 Chemin Rockland, Mont-Royal, Quebec H3P 2V9",distance:4.2,rating:4.7,phone:"(514) 341-2555"},{id:"clinic-11",name:"Clinique Mdicale Greene",address:"1241 Greene Ave, Westmount, Quebec H3Z 2A4",distance:1.6,rating:4.4,phone:"(514) 932-1111"},{id:"clinic-12",name:"Medi-Club",address:"2155 Guy St #500, Montreal, Quebec H3H 2R9",distance:.6,rating:3.5,phone:"(514) 935-8555"}],k7=[{id:"l1",type:"cafe",name:"Caf Myriade",lat:45.4948,lng:-73.5785},{id:"l2",type:"gym",name:"Nautilus Plus",lat:45.496,lng:-73.577},{id:"l3",type:"park",name:"Dorchester Square",lat:45.5005,lng:-73.571},{id:"l4",type:"pharmacy",name:"Jean Coutu",lat:45.4935,lng:-73.5765},{id:"l5",type:"cafe",name:"Starbucks",lat:45.4975,lng:-73.578},{id:"l6",type:"gym",name:"Econofitness",lat:45.4925,lng:-73.58},{id:"l7",type:"park",name:"Place du Canada",lat:45.499,lng:-73.572},{id:"l8",type:"cafe",name:"Humble Lion",lat:45.503,lng:-73.575},{id:"l9",type:"pharmacy",name:"Pharmaprix",lat:45.495,lng:-73.573},{id:"l10",type:"gym",name:"YMCA Centre-ville",lat:45.501,lng:-73.5745}],L7=({onClose:o,onClinicSelect:t})=>{const{userLocation:a,requestLocation:u}=RD(),y=He.useRef(null),[T,C]=He.useState([]),[s,B]=He.useState(null),[V,W]=He.useState(null),[Q,oe]=He.useState(!0);He.useEffect(()=>{a||u()},[]),He.useEffect(()=>{a&&y.current&&y.current.flyTo({center:[a.longitude,a.latitude],zoom:15.5,pitch:60,bearing:-17.6,duration:2e3})},[a]);const he=a||D7;He.useEffect(()=>{(async()=>{oe(!0);const fn=[];for(const St of P7){try{const ze=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(St.address)}.json?access_token=${HT}&limit=1`)).json();ze.features&&ze.features[0]&&fn.push({...St,longitude:ze.features[0].center[0],latitude:ze.features[0].center[1]})}catch(je){console.error(`Error geocoding ${St.name}:`,je)}await new Promise(je=>setTimeout(je,50))}C(fn),oe(!1)})()},[]);const Je=He.useCallback(()=>{y.current&&y.current.resize()},[]),Ye=async Ft=>{try{const St=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${he.longitude},${he.latitude};${Ft.longitude},${Ft.latitude}?geometries=geojson&access_token=${HT}`)).json();if(St.routes&&St.routes[0]){const je=St.routes[0];if(W({type:"Feature",properties:{},geometry:je.geometry}),y.current){const ze=je.geometry.coordinates,Ve=ze.reduce((Ke,qe)=>Ke.extend(qe),new WL.LngLatBounds(ze[0],ze[0]));y.current.fitBounds(Ve,{padding:50,pitch:45,bearing:-10})}}}catch(fn){console.error("Error getting route:",fn)}},Xe=Ft=>{B(Ft),Ye(Ft)},st=()=>{t&&s&&t(s)},ft=Ft=>{switch(Ft){case"cafe":return"local_cafe";case"gym":return"fitness_center";case"park":return"park";case"pharmacy":return"medication";default:return"place"}},ht=Ft=>{switch(Ft){case"cafe":return"text-amber-600 bg-amber-50";case"gym":return"text-purple-600 bg-purple-50";case"park":return"text-green-600 bg-green-50";case"pharmacy":return"text-teal-600 bg-teal-50";default:return"text-gray-600 bg-gray-50"}};return j.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[j.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[j.jsxs("div",{children:[j.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Find Nearby Doctors"}),j.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:a?"Showing clinics near your location":"Enable location to find nearby clinics"})]}),o&&j.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:j.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),j.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[j.jsx("div",{className:"min-h-[300px] h-1/2 bg-gray-100 relative flex-shrink-0",children:j.jsxs(f7,{ref:y,initialViewState:{longitude:he.longitude,latitude:he.latitude,zoom:15.5,pitch:60,bearing:-17.6},style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",mapboxAccessToken:HT,onLoad:Je,reuseMaps:!0,fog:{range:[.8,8],color:"#dc9f9f","horizon-blend":.5,"high-color":"#245bde","space-color":"#333","star-intensity":.15},children:[j.jsx(x7,{position:"bottom-right"}),j.jsx(eD,{id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}}),V&&j.jsx(E7,{id:"route",type:"geojson",data:V,children:j.jsx(eD,{id:"route-line",type:"line",paint:{"line-color":"#3b82f6","line-width":4,"line-opacity":.8}})}),k7.map(Ft=>j.jsx(qT,{longitude:Ft.lng,latitude:Ft.lat,anchor:"bottom",children:j.jsx("div",{className:`p-1.5 rounded-full border border-white shadow-sm opacity-90 scale-75 hover:scale-100 transition-transform ${ht(Ft.type)}`,children:j.jsx("span",{className:"material-symbols-outlined text-sm",children:ft(Ft.type)})})},Ft.id)),j.jsx(qT,{longitude:he.longitude,latitude:he.latitude,anchor:"bottom",children:j.jsx("div",{className:"relative",children:j.jsx("div",{className:"size-6 bg-primary rounded-full border-4 border-white shadow-2xl pulse-red"})})}),T.map((Ft,fn)=>j.jsx(qT,{longitude:Ft.longitude,latitude:Ft.latitude,anchor:"bottom",onClick:()=>Xe(Ft),children:j.jsx("div",{className:`cursor-pointer transition-transform ${(s==null?void 0:s.id)===Ft.id?"scale-125":"hover:scale-110"}`,children:j.jsx("span",{className:`material-symbols-outlined text-3xl drop-shadow-md ${(s==null?void 0:s.id)===Ft.id?"text-blue-500":"text-red-500"}`,children:"location_on"})})},Ft.id))]},`${he.longitude}-${he.latitude}`)}),j.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-4",children:Q?j.jsx("div",{className:"flex items-center justify-center py-12",children:j.jsx("span",{className:"material-symbols-outlined animate-spin text-3xl text-gray-400",children:"progress_activity"})}):T.length===0?j.jsxs("div",{className:"text-center py-12 text-gray-400",children:[j.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"search_off"}),j.jsx("p",{children:"No clinics found nearby"})]}):T.map((Ft,fn)=>j.jsxs("div",{onClick:()=>Xe(Ft),className:`bg-white p-5 rounded-2xl border transition-all cursor-pointer shadow-sm hover:shadow-md ${(s==null?void 0:s.id)===Ft.id?"border-blue-500 ring-2 ring-blue-100":"border-black/5 hover:border-primary"}`,children:[j.jsxs("div",{className:"flex justify-between items-start mb-2",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("span",{className:"size-6 rounded-full bg-red-50 flex items-center justify-center text-red-500 text-xs font-black",children:fn+1}),j.jsx("h3",{className:"font-bold text-lg text-primary leading-tight",children:Ft.name})]}),j.jsxs("span",{className:"text-xs font-bold text-gray-400 whitespace-nowrap ml-2 bg-gray-50 px-2 py-1 rounded-lg",children:[Ft.distance.toFixed(1)," mi"]})]}),j.jsxs("div",{className:"flex items-center gap-1 text-orange-500 mb-2 ml-8",children:[[1,2,3,4,5].map(St=>j.jsx("span",{className:`material-symbols-outlined text-[16px] ${St<=Math.round(Ft.rating)?"fill-1":"opacity-30"}`,children:"star"},St)),j.jsx("span",{className:"text-sm font-black ml-1",children:Ft.rating})]}),j.jsx("p",{className:"text-xs text-gray-400 mb-1 ml-8",children:Ft.address}),j.jsxs("p",{className:"text-xs text-gray-500 font-medium mb-3 ml-8",children:[j.jsx("span",{className:"material-symbols-outlined text-[12px] align-middle mr-1",children:"call"}),Ft.phone]}),(s==null?void 0:s.id)===Ft.id&&j.jsx("button",{onClick:St=>{St.stopPropagation(),st()},className:"w-full bg-primary text-white py-3 rounded-xl text-xs font-black shadow-lg shadow-black/5 hover:bg-black transition-all mt-2",children:"Select This Center"})]},Ft.id))})]})]})},z7=({onClose:o,onSubmit:t,question:a})=>{const[u,y]=He.useState(""),T=C=>{C==null||C.preventDefault(),u.trim()&&(t(u),y(""))};return j.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[j.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[j.jsxs("div",{children:[j.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Information Needed"}),j.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:"Please provide the following details"})]}),o&&j.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:j.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),j.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 flex flex-col justify-center",children:[j.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-black/5 shadow-sm text-center mb-8",children:[j.jsx("div",{className:"size-16 bg-primary/5 rounded-full flex items-center justify-center mx-auto mb-6",children:j.jsx("span",{className:"material-symbols-outlined text-3xl text-primary",children:"help"})}),j.jsx("h3",{className:"serif-font text-2xl text-primary mb-3 leading-tight",children:a}),j.jsx("p",{className:"text-gray-500 text-sm",children:"Your input helps our AI assistant coordinate more effectively."})]}),j.jsx("form",{onSubmit:T,children:j.jsxs("div",{className:"mb-4",children:[j.jsx("label",{htmlFor:"answer",className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 mb-2 ml-1",children:"Your Answer"}),j.jsx("textarea",{id:"answer",value:u,onChange:C=>y(C.target.value),className:"w-full p-4 rounded-2xl bg-white border-0 ring-1 ring-black/5 focus:ring-2 focus:ring-primary text-primary placeholder:text-gray-300 transition-all resize-none text-lg min-h-[120px]",placeholder:"Type your response here...",autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),T())}})]})})]}),j.jsx("div",{className:"p-4 border-t border-black/5 bg-white/50 backdrop-blur-sm flex-shrink-0",children:j.jsxs("button",{onClick:()=>T(),disabled:!u.trim(),className:`w-full py-4 rounded-2xl text-sm font-black transition-all flex items-center justify-center gap-2 ${u.trim()?"bg-primary text-white shadow-lg shadow-black/5 hover:bg-black active:scale-[0.98]":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[j.jsx("span",{children:"Submit Answer"}),j.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})]})})]})},O7="438 520 2457",N7=({onCancel:o,onConfirm:t,countdownSeconds:a=7,phoneNumber:u=O7})=>{const[y,T]=He.useState(a);return He.useEffect(()=>{if(y<=0){t();return}const C=setInterval(()=>{T(s=>s-1)},1e3);return()=>clearInterval(C)},[y,t]),j.jsx("div",{className:"fixed inset-0 bg-red-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-300",children:j.jsxs("div",{className:"bg-white rounded-[40px] shadow-2xl overflow-hidden w-full max-w-sm border-2 border-red-500 relative",children:[j.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gray-100",children:j.jsx("div",{className:"h-full bg-red-600 transition-all duration-1000 ease-linear",style:{width:`${y/a*100}%`}})}),j.jsxs("div",{className:"p-8 text-center",children:[j.jsx("div",{className:"size-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:j.jsx("span",{className:"material-symbols-outlined text-4xl text-red-600",children:"emergency"})}),j.jsx("h2",{className:"text-2xl font-black text-gray-900 mb-2 leading-tight",children:"Emergency Detected"}),j.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"Calling emergency line in"}),j.jsx("div",{className:"text-6xl font-black text-red-600 tabular-nums mb-4",children:y}),j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6",children:[j.jsx("p",{className:"text-xs text-red-600 font-bold uppercase tracking-wider mb-1",children:"Calling"}),j.jsx("p",{className:"text-2xl font-black text-red-700 tracking-wider",children:u})]}),j.jsxs("div",{className:"space-y-3",children:[j.jsx("button",{onClick:t,className:"w-full bg-red-600 text-white rounded-2xl py-4 font-black text-sm uppercase tracking-widest hover:bg-red-700 transition-all shadow-lg shadow-red-200",children:"Call Now"}),j.jsx("button",{onClick:o,className:"w-full bg-gray-100 text-gray-500 rounded-2xl py-4 font-bold text-sm uppercase tracking-widest hover:bg-gray-200 transition-all",children:"Cancel"})]})]})]})})},hf=Object.create(null);hf.open="0";hf.close="1";hf.ping="2";hf.pong="3";hf.message="4";hf.upgrade="5";hf.noop="6";const Ub=Object.create(null);Object.keys(hf).forEach(o=>{Ub[hf[o]]=o});const LE={type:"error",data:"parser error"},XL=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",YL=typeof ArrayBuffer=="function",KL=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,iA=({type:o,data:t},a,u)=>XL&&t instanceof Blob?a?u(t):nD(t,u):YL&&(t instanceof ArrayBuffer||KL(t))?a?u(t):nD(new Blob([t]),u):u(hf[o]+(t||"")),nD=(o,t)=>{const a=new FileReader;return a.onload=function(){const u=a.result.split(",")[1];t("b"+(u||""))},a.readAsDataURL(o)};function iD(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}let $T;function B7(o,t){if(XL&&o.data instanceof Blob)return o.data.arrayBuffer().then(iD).then(t);if(YL&&(o.data instanceof ArrayBuffer||KL(o.data)))return t(iD(o.data));iA(o,!1,a=>{$T||($T=new TextEncoder),t($T.encode(a))})}const rD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_v=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<rD.length;o++)_v[rD.charCodeAt(o)]=o;const F7=o=>{let t=o.length*.75,a=o.length,u,y=0,T,C,s,B;o[o.length-1]==="="&&(t--,o[o.length-2]==="="&&t--);const V=new ArrayBuffer(t),W=new Uint8Array(V);for(u=0;u<a;u+=4)T=_v[o.charCodeAt(u)],C=_v[o.charCodeAt(u+1)],s=_v[o.charCodeAt(u+2)],B=_v[o.charCodeAt(u+3)],W[y++]=T<<2|C>>4,W[y++]=(C&15)<<4|s>>2,W[y++]=(s&3)<<6|B&63;return V},V7=typeof ArrayBuffer=="function",rA=(o,t)=>{if(typeof o!="string")return{type:"message",data:QL(o,t)};const a=o.charAt(0);return a==="b"?{type:"message",data:j7(o.substring(1),t)}:Ub[a]?o.length>1?{type:Ub[a],data:o.substring(1)}:{type:Ub[a]}:LE},j7=(o,t)=>{if(V7){const a=F7(o);return QL(a,t)}else return{base64:!0,data:o}},QL=(o,t)=>{switch(t){case"blob":return o instanceof Blob?o:new Blob([o]);case"arraybuffer":default:return o instanceof ArrayBuffer?o:o.buffer}},JL="",U7=(o,t)=>{const a=o.length,u=new Array(a);let y=0;o.forEach((T,C)=>{iA(T,!1,s=>{u[C]=s,++y===a&&t(u.join(JL))})})},G7=(o,t)=>{const a=o.split(JL),u=[];for(let y=0;y<a.length;y++){const T=rA(a[y],t);if(u.push(T),T.type==="error")break}return u};function q7(){return new TransformStream({transform(o,t){B7(o,a=>{const u=a.length;let y;if(u<126)y=new Uint8Array(1),new DataView(y.buffer).setUint8(0,u);else if(u<65536){y=new Uint8Array(3);const T=new DataView(y.buffer);T.setUint8(0,126),T.setUint16(1,u)}else{y=new Uint8Array(9);const T=new DataView(y.buffer);T.setUint8(0,127),T.setBigUint64(1,BigInt(u))}o.data&&typeof o.data!="string"&&(y[0]|=128),t.enqueue(y),t.enqueue(a)})}})}let ZT;function Ab(o){return o.reduce((t,a)=>t+a.length,0)}function Ib(o,t){if(o[0].length===t)return o.shift();const a=new Uint8Array(t);let u=0;for(let y=0;y<t;y++)a[y]=o[0][u++],u===o[0].length&&(o.shift(),u=0);return o.length&&u<o[0].length&&(o[0]=o[0].slice(u)),a}function H7(o,t){ZT||(ZT=new TextDecoder);const a=[];let u=0,y=-1,T=!1;return new TransformStream({transform(C,s){for(a.push(C);;){if(u===0){if(Ab(a)<1)break;const B=Ib(a,1);T=(B[0]&128)===128,y=B[0]&127,y<126?u=3:y===126?u=1:u=2}else if(u===1){if(Ab(a)<2)break;const B=Ib(a,2);y=new DataView(B.buffer,B.byteOffset,B.length).getUint16(0),u=3}else if(u===2){if(Ab(a)<8)break;const B=Ib(a,8),V=new DataView(B.buffer,B.byteOffset,B.length),W=V.getUint32(0);if(W>Math.pow(2,21)-1){s.enqueue(LE);break}y=W*Math.pow(2,32)+V.getUint32(4),u=3}else{if(Ab(a)<y)break;const B=Ib(a,y);s.enqueue(rA(T?B:ZT.decode(B),t)),u=0}if(y===0||y>o){s.enqueue(LE);break}}}})}const ez=4;function to(o){if(o)return $7(o)}function $7(o){for(var t in to.prototype)o[t]=to.prototype[t];return o}to.prototype.on=to.prototype.addEventListener=function(o,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(t),this};to.prototype.once=function(o,t){function a(){this.off(o,a),t.apply(this,arguments)}return a.fn=t,this.on(o,a),this};to.prototype.off=to.prototype.removeListener=to.prototype.removeAllListeners=to.prototype.removeEventListener=function(o,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+o];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var u,y=0;y<a.length;y++)if(u=a[y],u===t||u.fn===t){a.splice(y,1);break}return a.length===0&&delete this._callbacks["$"+o],this};to.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),a=this._callbacks["$"+o],u=1;u<arguments.length;u++)t[u-1]=arguments[u];if(a){a=a.slice(0);for(var u=0,y=a.length;u<y;++u)a[u].apply(this,t)}return this};to.prototype.emitReserved=to.prototype.emit;to.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};to.prototype.hasListeners=function(o){return!!this.listeners(o).length};const U1=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,a)=>a(t,0),Ku=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Z7="arraybuffer";function tz(o,...t){return t.reduce((a,u)=>(o.hasOwnProperty(u)&&(a[u]=o[u]),a),{})}const W7=Ku.setTimeout,X7=Ku.clearTimeout;function G1(o,t){t.useNativeTimers?(o.setTimeoutFn=W7.bind(Ku),o.clearTimeoutFn=X7.bind(Ku)):(o.setTimeoutFn=Ku.setTimeout.bind(Ku),o.clearTimeoutFn=Ku.clearTimeout.bind(Ku))}const Y7=1.33;function K7(o){return typeof o=="string"?Q7(o):Math.ceil((o.byteLength||o.size)*Y7)}function Q7(o){let t=0,a=0;for(let u=0,y=o.length;u<y;u++)t=o.charCodeAt(u),t<128?a+=1:t<2048?a+=2:t<55296||t>=57344?a+=3:(u++,a+=4);return a}function nz(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function J7(o){let t="";for(let a in o)o.hasOwnProperty(a)&&(t.length&&(t+="&"),t+=encodeURIComponent(a)+"="+encodeURIComponent(o[a]));return t}function e$(o){let t={},a=o.split("&");for(let u=0,y=a.length;u<y;u++){let T=a[u].split("=");t[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return t}class t$ extends Error{constructor(t,a,u){super(t),this.description=a,this.context=u,this.type="TransportError"}}class sA extends to{constructor(t){super(),this.writable=!1,G1(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,a,u){return super.emitReserved("error",new t$(t,a,u)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const a=rA(t,this.socket.binaryType);this.onPacket(a)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,a={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const a=J7(t);return a.length?"?"+a:""}}class n$ extends sA{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const a=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let u=0;this._polling&&(u++,this.once("pollComplete",function(){--u||a()})),this.writable||(u++,this.once("drain",function(){--u||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const a=u=>{if(this.readyState==="opening"&&u.type==="open"&&this.onOpen(),u.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(u)};G7(t,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,U7(t,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=nz()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(t,a)}}let iz=!1;try{iz=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const i$=iz;function r$(){}class s$ extends n${constructor(t){if(super(t),typeof location<"u"){const a=location.protocol==="https:";let u=location.port;u||(u=a?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||u!==t.port}}doWrite(t,a){const u=this.request({method:"POST",data:t});u.on("success",a),u.on("error",(y,T)=>{this.onError("xhr post error",y,T)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(a,u)=>{this.onError("xhr poll error",a,u)}),this.pollXhr=t}}let Ry=class Gb extends to{constructor(t,a,u){super(),this.createRequest=t,G1(this,u),this._opts=u,this._method=u.method||"GET",this._uri=a,this._data=u.data!==void 0?u.data:null,this._create()}_create(){var t;const a=tz(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const u=this._xhr=this.createRequest(a);try{u.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let y in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(y)&&u.setRequestHeader(y,this._opts.extraHeaders[y])}}catch{}if(this._method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(u),"withCredentials"in u&&(u.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(u.timeout=this._opts.requestTimeout),u.onreadystatechange=()=>{var y;u.readyState===3&&((y=this._opts.cookieJar)===null||y===void 0||y.parseCookies(u.getResponseHeader("set-cookie"))),u.readyState===4&&(u.status===200||u.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof u.status=="number"?u.status:0)},0))},u.send(this._data)}catch(y){this.setTimeoutFn(()=>{this._onError(y)},0);return}typeof document<"u"&&(this._index=Gb.requestsCount++,Gb.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=r$,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Gb.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Ry.requestsCount=0;Ry.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",sD);else if(typeof addEventListener=="function"){const o="onpagehide"in Ku?"pagehide":"unload";addEventListener(o,sD,!1)}}function sD(){for(let o in Ry.requests)Ry.requests.hasOwnProperty(o)&&Ry.requests[o].abort()}const a$=(function(){const o=rz({xdomain:!1});return o&&o.responseType!==null})();class o$ extends s${constructor(t){super(t);const a=t&&t.forceBase64;this.supportsBinary=a$&&!a}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Ry(rz,this.uri(),t)}}function rz(o){const t=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||i$))return new XMLHttpRequest}catch{}if(!t)try{return new Ku[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const sz=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class l$ extends sA{get name(){return"websocket"}doOpen(){const t=this.uri(),a=this.opts.protocols,u=sz?{}:tz(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(u.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,a,u)}catch(y){return this.emitReserved("error",y)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let a=0;a<t.length;a++){const u=t[a],y=a===t.length-1;iA(u,this.supportsBinary,T=>{try{this.doWrite(u,T)}catch{}y&&U1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=nz()),this.supportsBinary||(a.b64=1),this.createUri(t,a)}}const WT=Ku.WebSocket||Ku.MozWebSocket;class c$ extends l${createSocket(t,a,u){return sz?new WT(t,a,u):a?new WT(t,a):new WT(t)}doWrite(t,a){this.ws.send(a)}}class u$ extends sA{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const a=H7(Number.MAX_SAFE_INTEGER,this.socket.binaryType),u=t.readable.pipeThrough(a).getReader(),y=q7();y.readable.pipeTo(t.writable),this._writer=y.writable.getWriter();const T=()=>{u.read().then(({done:s,value:B})=>{s||(this.onPacket(B),T())}).catch(s=>{})};T();const C={type:"open"};this.query.sid&&(C.data=`{"sid":"${this.query.sid}"}`),this._writer.write(C).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let a=0;a<t.length;a++){const u=t[a],y=a===t.length-1;this._writer.write(u).then(()=>{y&&U1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const h$={websocket:c$,webtransport:u$,polling:o$},d$=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function zE(o){if(o.length>8e3)throw"URI too long";const t=o,a=o.indexOf("["),u=o.indexOf("]");a!=-1&&u!=-1&&(o=o.substring(0,a)+o.substring(a,u).replace(/:/g,";")+o.substring(u,o.length));let y=d$.exec(o||""),T={},C=14;for(;C--;)T[f$[C]]=y[C]||"";return a!=-1&&u!=-1&&(T.source=t,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=p$(T,T.path),T.queryKey=m$(T,T.query),T}function p$(o,t){const a=/\/{2,9}/g,u=t.replace(a,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&u.splice(0,1),t.slice(-1)=="/"&&u.splice(u.length-1,1),u}function m$(o,t){const a={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(u,y,T){y&&(a[y]=T)}),a}const OE=typeof addEventListener=="function"&&typeof removeEventListener=="function",qb=[];OE&&addEventListener("offline",()=>{qb.forEach(o=>o())},!1);class Bm extends to{constructor(t,a){if(super(),this.binaryType=Z7,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(a=t,t=null),t){const u=zE(t);a.hostname=u.host,a.secure=u.protocol==="https"||u.protocol==="wss",a.port=u.port,u.query&&(a.query=u.query)}else a.host&&(a.hostname=zE(a.host).host);G1(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(u=>{const y=u.prototype.name;this.transports.push(y),this._transportsByName[y]=u}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=e$(this.opts.query)),OE&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},qb.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const a=Object.assign({},this.opts.query);a.EIO=ez,a.transport=t,this.id&&(a.sid=this.id);const u=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](u)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Bm.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(t);a.open(),this.setTransport(a)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",Bm.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=t.data,this._onError(a);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let u=0;u<this.writeBuffer.length;u++){const y=this.writeBuffer[u].data;if(y&&(a+=K7(y)),u>0&&a>this._maxPayload)return this.writeBuffer.slice(0,u);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,U1(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,a,u){return this._sendPacket("message",t,a,u),this}send(t,a,u){return this._sendPacket("message",t,a,u),this}_sendPacket(t,a,u,y){if(typeof a=="function"&&(y=a,a=void 0),typeof u=="function"&&(y=u,u=null),this.readyState==="closing"||this.readyState==="closed")return;u=u||{},u.compress=u.compress!==!1;const T={type:t,data:a,options:u};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),y&&this.once("flush",y),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),t()},u=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?u():t()}):this.upgrading?u():t()),this}_onError(t){if(Bm.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),OE&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const u=qb.indexOf(this._offlineEventListener);u!==-1&&qb.splice(u,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,a),this.writeBuffer=[],this._prevBufferLen=0}}}Bm.protocol=ez;class g$ extends Bm{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let a=this.createTransport(t),u=!1;Bm.priorWebsocketSuccess=!1;const y=()=>{u||(a.send([{type:"ping",data:"probe"}]),a.once("packet",Q=>{if(!u)if(Q.type==="pong"&&Q.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Bm.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{u||this.readyState!=="closed"&&(W(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const oe=new Error("probe error");oe.transport=a.name,this.emitReserved("upgradeError",oe)}}))};function T(){u||(u=!0,W(),a.close(),a=null)}const C=Q=>{const oe=new Error("probe error: "+Q);oe.transport=a.name,T(),this.emitReserved("upgradeError",oe)};function s(){C("transport closed")}function B(){C("socket closed")}function V(Q){a&&Q.name!==a.name&&T()}const W=()=>{a.removeListener("open",y),a.removeListener("error",C),a.removeListener("close",s),this.off("close",B),this.off("upgrading",V)};a.once("open",y),a.once("error",C),a.once("close",s),this.once("close",B),this.once("upgrading",V),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{u||a.open()},200):a.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const a=[];for(let u=0;u<t.length;u++)~this.transports.indexOf(t[u])&&a.push(t[u]);return a}}let _$=class extends g${constructor(t,a={}){const u=typeof t=="object"?t:a;(!u.transports||u.transports&&typeof u.transports[0]=="string")&&(u.transports=(u.transports||["polling","websocket","webtransport"]).map(y=>h$[y]).filter(y=>!!y)),super(t,u)}};function y$(o,t="",a){let u=o;a=a||typeof location<"u"&&location,o==null&&(o=a.protocol+"//"+a.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=a.protocol+o:o=a.host+o),/^(https?|wss?):\/\//.test(o)||(typeof a<"u"?o=a.protocol+"//"+o:o="https://"+o),u=zE(o)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/";const T=u.host.indexOf(":")!==-1?"["+u.host+"]":u.host;return u.id=u.protocol+"://"+T+":"+u.port+t,u.href=u.protocol+"://"+T+(a&&a.port===u.port?"":":"+u.port),u}const x$=typeof ArrayBuffer=="function",v$=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,az=Object.prototype.toString,b$=typeof Blob=="function"||typeof Blob<"u"&&az.call(Blob)==="[object BlobConstructor]",w$=typeof File=="function"||typeof File<"u"&&az.call(File)==="[object FileConstructor]";function aA(o){return x$&&(o instanceof ArrayBuffer||v$(o))||b$&&o instanceof Blob||w$&&o instanceof File}function Hb(o,t){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let a=0,u=o.length;a<u;a++)if(Hb(o[a]))return!0;return!1}if(aA(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return Hb(o.toJSON(),!0);for(const a in o)if(Object.prototype.hasOwnProperty.call(o,a)&&Hb(o[a]))return!0;return!1}function T$(o){const t=[],a=o.data,u=o;return u.data=NE(a,t),u.attachments=t.length,{packet:u,buffers:t}}function NE(o,t){if(!o)return o;if(aA(o)){const a={_placeholder:!0,num:t.length};return t.push(o),a}else if(Array.isArray(o)){const a=new Array(o.length);for(let u=0;u<o.length;u++)a[u]=NE(o[u],t);return a}else if(typeof o=="object"&&!(o instanceof Date)){const a={};for(const u in o)Object.prototype.hasOwnProperty.call(o,u)&&(a[u]=NE(o[u],t));return a}return o}function E$(o,t){return o.data=BE(o.data,t),delete o.attachments,o}function BE(o,t){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<t.length)return t[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let a=0;a<o.length;a++)o[a]=BE(o[a],t);else if(typeof o=="object")for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&(o[a]=BE(o[a],t));return o}const S$=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Vr;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(Vr||(Vr={}));class A${constructor(t){this.replacer=t}encode(t){return(t.type===Vr.EVENT||t.type===Vr.ACK)&&Hb(t)?this.encodeAsBinary({type:t.type===Vr.EVENT?Vr.BINARY_EVENT:Vr.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let a=""+t.type;return(t.type===Vr.BINARY_EVENT||t.type===Vr.BINARY_ACK)&&(a+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(a+=t.nsp+","),t.id!=null&&(a+=t.id),t.data!=null&&(a+=JSON.stringify(t.data,this.replacer)),a}encodeAsBinary(t){const a=T$(t),u=this.encodeAsString(a.packet),y=a.buffers;return y.unshift(u),y}}class oA extends to{constructor(t){super(),this.reviver=t}add(t){let a;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(t);const u=a.type===Vr.BINARY_EVENT;u||a.type===Vr.BINARY_ACK?(a.type=u?Vr.EVENT:Vr.ACK,this.reconstructor=new I$(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(aA(t)||t.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(t),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let a=0;const u={type:Number(t.charAt(0))};if(Vr[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===Vr.BINARY_EVENT||u.type===Vr.BINARY_ACK){const T=a+1;for(;t.charAt(++a)!=="-"&&a!=t.length;);const C=t.substring(T,a);if(C!=Number(C)||t.charAt(a)!=="-")throw new Error("Illegal attachments");u.attachments=Number(C)}if(t.charAt(a+1)==="/"){const T=a+1;for(;++a&&!(t.charAt(a)===","||a===t.length););u.nsp=t.substring(T,a)}else u.nsp="/";const y=t.charAt(a+1);if(y!==""&&Number(y)==y){const T=a+1;for(;++a;){const C=t.charAt(a);if(C==null||Number(C)!=C){--a;break}if(a===t.length)break}u.id=Number(t.substring(T,a+1))}if(t.charAt(++a)){const T=this.tryParse(t.substr(a));if(oA.isPayloadValid(u.type,T))u.data=T;else throw new Error("invalid payload")}return u}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,a){switch(t){case Vr.CONNECT:return aD(a);case Vr.DISCONNECT:return a===void 0;case Vr.CONNECT_ERROR:return typeof a=="string"||aD(a);case Vr.EVENT:case Vr.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&S$.indexOf(a[0])===-1);case Vr.ACK:case Vr.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class I${constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const a=E$(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function aD(o){return Object.prototype.toString.call(o)==="[object Object]"}const C$=Object.freeze(Object.defineProperty({__proto__:null,Decoder:oA,Encoder:A$,get PacketType(){return Vr}},Symbol.toStringTag,{value:"Module"}));function Wh(o,t,a){return o.on(t,a),function(){o.off(t,a)}}const R$=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class oz extends to{constructor(t,a,u){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=a,u&&u.auth&&(this.auth=u.auth),this._opts=Object.assign({},u),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Wh(t,"open",this.onopen.bind(this)),Wh(t,"packet",this.onpacket.bind(this)),Wh(t,"error",this.onerror.bind(this)),Wh(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...a){var u,y,T;if(R$.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(a.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const C={type:Vr.EVENT,data:a};if(C.options={},C.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const W=this.ids++,Q=a.pop();this._registerAckCallback(W,Q),C.id=W}const s=(y=(u=this.io.engine)===null||u===void 0?void 0:u.transport)===null||y===void 0?void 0:y.writable,B=this.connected&&!(!((T=this.io.engine)===null||T===void 0)&&T._hasPingExpired());return this.flags.volatile&&!s||(B?(this.notifyOutgoingListeners(C),this.packet(C)):this.sendBuffer.push(C)),this.flags={},this}_registerAckCallback(t,a){var u;const y=(u=this.flags.timeout)!==null&&u!==void 0?u:this._opts.ackTimeout;if(y===void 0){this.acks[t]=a;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===t&&this.sendBuffer.splice(s,1);a.call(this,new Error("operation has timed out"))},y),C=(...s)=>{this.io.clearTimeoutFn(T),a.apply(this,s)};C.withError=!0,this.acks[t]=C}emitWithAck(t,...a){return new Promise((u,y)=>{const T=(C,s)=>C?y(C):u(s);T.withError=!0,a.push(T),this.emit(t,...a)})}_addToQueue(t){let a;typeof t[t.length-1]=="function"&&(a=t.pop());const u={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((y,...T)=>(this._queue[0],y!==null?u.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(y)):(this._queue.shift(),a&&a(null,...T)),u.pending=!1,this._drainQueue())),this._queue.push(u),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!t||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Vr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(u=>String(u.id)===t)){const u=this.acks[t];delete this.acks[t],u.withError&&u.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Vr.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Vr.EVENT:case Vr.BINARY_EVENT:this.onevent(t);break;case Vr.ACK:case Vr.BINARY_ACK:this.onack(t);break;case Vr.DISCONNECT:this.ondisconnect();break;case Vr.CONNECT_ERROR:this.destroy();const u=new Error(t.data.message);u.data=t.data.data,this.emitReserved("connect_error",u);break}}onevent(t){const a=t.data||[];t.id!=null&&a.push(this.ack(t.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const u of a)u.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const a=this;let u=!1;return function(...y){u||(u=!0,a.packet({type:Vr.ACK,id:t,data:y}))}}onack(t){const a=this.acks[t.id];typeof a=="function"&&(delete this.acks[t.id],a.withError&&t.data.unshift(null),a.apply(this,t.data))}onconnect(t,a){this.id=t,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Vr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const a=this._anyListeners;for(let u=0;u<a.length;u++)if(t===a[u])return a.splice(u,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const a=this._anyOutgoingListeners;for(let u=0;u<a.length;u++)if(t===a[u])return a.splice(u,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const u of a)u.apply(this,t.data)}}}function Jy(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}Jy.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),a=Math.floor(t*this.jitter*o);o=(Math.floor(t*10)&1)==0?o-a:o+a}return Math.min(o,this.max)|0};Jy.prototype.reset=function(){this.attempts=0};Jy.prototype.setMin=function(o){this.ms=o};Jy.prototype.setMax=function(o){this.max=o};Jy.prototype.setJitter=function(o){this.jitter=o};class FE extends to{constructor(t,a){var u;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(a=t,t=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,G1(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((u=a.randomizationFactor)!==null&&u!==void 0?u:.5),this.backoff=new Jy({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=t;const y=a.parser||C$;this.encoder=new y.Encoder,this.decoder=new y.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var a;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(a=this.backoff)===null||a===void 0||a.setMin(t),this)}randomizationFactor(t){var a;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(a=this.backoff)===null||a===void 0||a.setJitter(t),this)}reconnectionDelayMax(t){var a;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(a=this.backoff)===null||a===void 0||a.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new _$(this.uri,this.opts);const a=this.engine,u=this;this._readyState="opening",this.skipReconnect=!1;const y=Wh(a,"open",function(){u.onopen(),t&&t()}),T=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),t?t(s):this.maybeReconnectOnOpen()},C=Wh(a,"error",T);if(this._timeout!==!1){const s=this._timeout,B=this.setTimeoutFn(()=>{y(),T(new Error("timeout")),a.close()},s);this.opts.autoUnref&&B.unref(),this.subs.push(()=>{this.clearTimeoutFn(B)})}return this.subs.push(y),this.subs.push(C),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Wh(t,"ping",this.onping.bind(this)),Wh(t,"data",this.ondata.bind(this)),Wh(t,"error",this.onerror.bind(this)),Wh(t,"close",this.onclose.bind(this)),Wh(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(a){this.onclose("parse error",a)}}ondecoded(t){U1(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,a){let u=this.nsps[t];return u?this._autoConnect&&!u.active&&u.connect():(u=new oz(this,t,a),this.nsps[t]=u),u}_destroy(t){const a=Object.keys(this.nsps);for(const u of a)if(this.nsps[u].active)return;this._close()}_packet(t){const a=this.encoder.encode(t);for(let u=0;u<a.length;u++)this.engine.write(a[u],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,a){var u;this.cleanup(),(u=this.engine)===null||u===void 0||u.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const u=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(y=>{y?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",y)):t.onreconnect()}))},a);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const dv={};function $b(o,t){typeof o=="object"&&(t=o,o=void 0),t=t||{};const a=y$(o,t.path||"/socket.io"),u=a.source,y=a.id,T=a.path,C=dv[y]&&T in dv[y].nsps,s=t.forceNew||t["force new connection"]||t.multiplex===!1||C;let B;return s?B=new FE(u,t):(dv[y]||(dv[y]=new FE(u,t)),B=dv[y]),a.query&&!t.query&&(t.query=a.queryKey),B.socket(a.path,t)}Object.assign($b,{Manager:FE,Socket:oz,io:$b,connect:$b});const M$=({onFinalTranscript:o})=>{const[t,a]=He.useState(!1),[u,y]=He.useState(""),T=He.useRef(null),[C,s]=He.useState(new Uint8Array(0)),B=He.useRef(null),V=He.useRef(null),W=He.useRef(null),Q=He.useRef(null),oe=He.useRef(null),he=He.useRef(null);He.useRef(0);const[Je,Ye]=He.useState([]);He.useEffect(()=>{const ze=()=>{if(typeof window<"u"&&window.speechSynthesis){const Ve=window.speechSynthesis.getVoices();Ye(Ve)}};return ze(),window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=ze),()=>{window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=null)}},[]);const Xe=He.useRef(null),st=He.useRef(null),ft=He.useCallback((ze,Ve)=>{if(console.log("[useVoiceInput] Using browser TTS fallback"),typeof window<"u"&&!("speechSynthesis"in window)){console.error("[useVoiceInput] speechSynthesis not supported"),Ve==null||Ve();return}window.speechSynthesis.cancel();const Ke=new SpeechSynthesisUtterance(ze);Xe.current=Ke;const qe=Je.length>0?Je:window.speechSynthesis.getVoices(),et=qe.find(be=>(be.name.includes("Samantha")||be.name.includes("Google US English")||be.name.includes("Neural"))&&be.lang.startsWith("en"))||qe.find(be=>be.lang.startsWith("en"))||qe[0];et&&(Ke.voice=et),Ke.rate=1,Ke.pitch=1,Ke.volume=1,Ke.onend=()=>{Xe.current=null,Ve==null||Ve()},Ke.onerror=be=>{console.error("[useVoiceInput] Browser TTS error:",be)};try{window.speechSynthesis.speak(Ke)}catch(be){console.error("[useVoiceInput] Exception during speak:",be)}},[Je]),ht=He.useCallback((ze,Ve,Ke)=>{if(console.log("[useVoiceInput] speak called, audio provided:",!!Ke),"speechSynthesis"in window&&window.speechSynthesis.cancel(),st.current&&(st.current.pause(),st.current=null),Ke){console.log("[useVoiceInput] Playing ElevenLabs audio");try{const qe=new Audio(`data:audio/mpeg;base64,${Ke}`);st.current=qe,qe.onended=()=>{console.log("[useVoiceInput] ElevenLabs audio finished"),st.current=null,Ve==null||Ve()},qe.onerror=et=>{console.error("[useVoiceInput] Audio playback error:",et),st.current=null,ft(ze,Ve)},qe.play().catch(et=>{console.error("[useVoiceInput] Failed to play audio:",et),ft(ze,Ve)});return}catch(qe){console.error("[useVoiceInput] Error creating audio element:",qe)}}ft(ze,Ve)},[ft]),Ft=()=>{Q.current&&cancelAnimationFrame(Q.current),W.current&&(W.current.disconnect(),W.current=null),oe.current&&(oe.current.getTracks().forEach(ze=>ze.stop()),oe.current=null)},fn=async()=>{try{const ze=await navigator.mediaDevices.getUserMedia({audio:!0});oe.current=ze,B.current||(B.current=new(window.AudioContext||window.webkitAudioContext)),B.current.state==="suspended"&&await B.current.resume();const Ve=B.current;V.current=Ve.createAnalyser(),V.current.fftSize=256,W.current=Ve.createMediaStreamSource(ze),W.current.connect(V.current);const Ke=V.current.frequencyBinCount,qe=new Uint8Array(Ke),et=()=>{V.current&&(V.current.getByteFrequencyData(qe),s(new Uint8Array(qe)),Q.current=requestAnimationFrame(et))};et()}catch(ze){console.error("Error accessing microphone for visualization:",ze)}},St=He.useCallback(()=>{T.current&&T.current.stop(),Ft(),a(!1),he.current&&(clearTimeout(he.current),he.current=null)},[]),je=He.useCallback(()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel();const ze=window.SpeechRecognition||window.webkitSpeechRecognition;if(!ze){alert("Your browser does not support voice recognition. Please use Chrome or Safari.");return}const Ve=new ze;Ve.continuous=!0,Ve.interimResults=!0,Ve.lang="en-US",Ve.onresult=Ke=>{let qe="",et="";for(let Zt=Ke.resultIndex;Zt<Ke.results.length;++Zt)Ke.results[Zt].isFinal?et+=Ke.results[Zt][0].transcript:qe+=Ke.results[Zt][0].transcript;const be=Array.from(Ke.results).map(Zt=>Zt[0].transcript).join("");y(be)},Ve.onerror=Ke=>{console.error("Speech recognition error",Ke.error),Ke.error==="not-allowed"&&(a(!1),Ft())},Ve.onend=()=>{a(!1),Ft()},T.current=Ve,Ve.start(),a(!0),y(""),fn()},[o,St]);return{isListening:t,transcript:u,startListening:je,stopListening:St,audioData:C,speak:ht}},D$=({audioData:o})=>{const t=He.useRef(null);return He.useEffect(()=>{const a=t.current;if(!a)return;const u=a.getContext("2d");if(!u)return;const y=window.devicePixelRatio||1,T=a.getBoundingClientRect();a.width=T.width*y,a.height=T.height*y,u.scale(y,y);const C=T.width,s=T.height,B=s/2;u.clearRect(0,0,C,s);let V=0;for(let ht=0;ht<o.length;ht++)V+=o[ht];const W=o.length>0?V/o.length/255:0,Q=5,oe=4,he=6,Je=Q*oe+(Q-1)*he,Ye=(C-Je)/2,Xe=s*.7,st=4,ft=u.createLinearGradient(0,0,0,s);ft.addColorStop(0,"#4e4235"),ft.addColorStop(.5,"#6b5a47"),ft.addColorStop(1,"#4e4235"),u.fillStyle=ft,u.lineCap="round";for(let ht=0;ht<Q;ht++){const Ft=Math.floor(ht/Q*(o.length*.5)),St=(o[Ft]||0)/255,je=Date.now()/200,ze=Math.sin(je+ht*.8)*.3+.7,Ve=Math.max(St*1.2,W*.5)*ze,Ke=Math.max(st,Ve*Xe),qe=Ye+ht*(oe+he),et=B-Ke/2;u.beginPath(),u.roundRect(qe,et,oe,Ke,oe/2),u.fill()}},[o]),j.jsx("canvas",{ref:t,className:"w-16 h-10",style:{width:"64px",height:"40px"}})},P$=()=>{const{user:o}=B1(),[t,a]=He.useState([{role:"model",text:"Hello! I am your Health.me AI assistant. I have access to your health records and current vitals. How can I help you today?"}]),[u,y]=He.useState(""),[T,C]=He.useState(!1),[s,B]=He.useState(null),[V,W]=He.useState(null),[Q]=XB(),[oe,he]=He.useState(null),[Je,Ye]=He.useState(!1),[Xe,st]=He.useState("none"),[ft,ht]=He.useState(!1);He.useEffect(()=>{if(!o)return;const Hn=Q.get("session"),ur=(async()=>{try{let ui;Hn?(ui=Hn,he(Hn),await f8(o.uid,ui)):(ui=await u8(o.uid),he(null)),W(ui);const Qi=c8(o.uid,ui,_r=>{_r.length>0?a(_r.map(Xs=>({role:Xs.role,text:Xs.text}))):a([{role:"model",text:"Hello! I am your Health.me AI assistant. I have access to your health records and current vitals. How can I help you today?"}])});return Ye(!1),Qi}catch(ui){console.error("Error initializing Firestore chat:",ui)}})();return()=>{ur==null||ur.then(ui=>ui==null?void 0:ui())}},[o,Q]);const Ft=Hn=>{Xi(Hn)},{isListening:fn,transcript:St,startListening:je,stopListening:ze,audioData:Ve,speak:Ke}=M$({onFinalTranscript:Ft}),qe=He.useRef(null),et=ff();He.useEffect(()=>{qe.current&&(qe.current.scrollTop=qe.current.scrollHeight)},[t,T]);const be=He.useRef(null),[Zt,dn]=He.useState([]),[wt,Jt]=He.useState([]),[En,ci]=He.useState(!1),[tt,dt]=He.useState([]),[Kt,Ne]=He.useState(!1),[wn,Kn]=He.useState(""),[Zn,Ci]=He.useState("");He.useEffect(()=>{const Hn=$b("http://35.203.120.186:3001");return be.current=Hn,Hn.on("connect",()=>{console.log("Connected to backend WS")}),Hn.on("show_clinics",Ti=>{dn(Ti),st("location")}),Hn.on("show_calendar",Ti=>{Jt(Ti),st("schedule")}),Hn.on("call_started",()=>{ht(!0)}),Hn.on("emergency_trigger",()=>{ci(!1),ci(!0)}),Hn.on("call_transcript_update",(Ti,ur)=>{console.log("[Frontend] Received transcript update:",ur),dt(ui=>[...ui,ur])}),Hn.on("chat_response",Ti=>{C(!1),a(ur=>[...ur,{role:"model",text:Ti.content}]),Ke(Ti.content,void 0,Ti.audio)}),Hn.on("agent_needs_input",Ti=>{Ne(!0),Kn(Ti.question),Ci(Ti.context||"The receptionist is asking for this information."),st("question")}),Hn.on("agent_input_received",()=>{Ne(!1),Kn(""),Ci("")}),()=>{Hn.disconnect()}},[Ke]);const Xi=async Hn=>{const Ti=Hn||u;if(!Ti.trim()||T)return;Hn||y("");const ur={role:"user",text:Ti};a(ui=>[...ui,ur]),C(!0),o&&V&&aM(o.uid,V,ur);try{const ui=await fetch("http://35.203.120.186:3001/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:Ti,conversation_id:s})});if(!ui.ok)throw new Error(`Server returned ${ui.status} ${ui.statusText}`);const Qi=await ui.json();if(Qi.conversation_id&&B(Qi.conversation_id),Qi.message){const _r={role:"model",text:Qi.message};a(Xs=>[...Xs,_r]),o&&V&&aM(o.uid,V,_r),Ke(Qi.message,void 0,Qi.audio)}C(!1)}catch(ui){console.error("Chat Error:",ui),a(Qi=>[...Qi,{role:"model",text:"Connection error. Please check backend."}]),C(!1)}},Gn=async()=>{ci(!1),ht(!0),a(Hn=>[...Hn,{role:"model",text:"Connecting you to emergency services at 438 520 2457..."}]),await fetch("http://35.203.120.186:3001/call/initiate",{method:"POST",body:JSON.stringify({type:"emergency",phone:"+14385202457",userId:o==null?void 0:o.uid}),headers:{"Content-Type":"application/json"}})},zi=async()=>{if(a([{role:"model",text:"New conversation started. How can I assist you with your health today?"}]),Ye(!1),he(null),B(null),o)try{const Hn=await cL(o.uid);W(Hn);const Ti=p_(cf,"users",o.uid,"activeChat","current");await Qv(Ti,{chatId:Hn}),console.log("[Chat] Created new Firestore chat:",Hn)}catch(Hn){console.error("[Chat] Failed to create new Firestore chat:",Hn)}et("/chat")},jr=async Hn=>{st("none"),ht(!0),a(Ti=>[...Ti,{role:"model",text:`Calling ${Hn.name} to schedule your appointment... Our AI assistant will speak with the receptionist on your behalf.`}]);try{await fetch("http://35.203.120.186:3001/call/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:"+18194755578",clinic_name:Hn.name,userId:o==null?void 0:o.uid})})}catch(Ti){console.error("Failed to initiate call:",Ti),a(ur=>[...ur,{role:"model",text:"Sorry, there was an issue connecting the call. Please try again."}]),ht(!1)}},Va=async Hn=>{st("none");const Ti=`${Hn.day}, the ${Hn.date} at ${Hn.time}`;try{await fetch("http://35.203.120.186:3001/call/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:Ti})}),a(ur=>[...ur,{role:"model",text:`Great! I've told the clinic you'd like the appointment on ${Ti}. The receptionist is confirming now...`}])}catch(ur){console.error("Failed to send appointment selection:",ur),a(ui=>[...ui,{role:"model",text:`Appointment selected: ${Ti}. (Note: Could not update the call)`}])}},cr=async Hn=>{Ne(!1),Kn(""),Ci(""),dt(Ti=>[...Ti,{message:Hn,sender:"bot"}]);try{await fetch("http://35.203.120.186:3001/call/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:Hn})}),st("none")}catch(Ti){console.error("Failed to send user response:",Ti)}},Bs=Xe!=="none"||ft;return j.jsxs("div",{className:"flex h-full bg-soft-cream relative overflow-hidden",children:[j.jsx("div",{className:"flex flex-col h-full flex-1 relative transition-all duration-500",children:j.jsxs("div",{className:"max-w-4xl mx-auto w-full flex flex-col h-full px-6",children:[j.jsxs("div",{className:"py-6 border-b border-black/5 flex justify-between items-center flex-shrink-0",children:[j.jsx("div",{className:"flex items-center gap-4",children:j.jsxs("div",{children:[j.jsx("h1",{className:"serif-font text-3xl text-primary",children:"AI Health Assistant"}),j.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:j.jsxs("div",{className:"px-2 py-0.5 bg-green-50 rounded-full flex items-center space-x-1.5 border border-green-100",children:[j.jsx("span",{className:"size-1 rounded-full bg-green-500"}),j.jsx("span",{className:"text-[9px] font-black text-green-700 uppercase tracking-widest",children:"Secure session"})]})})]})}),j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsxs("button",{onClick:()=>st(Xe==="location"?"none":"location"),className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${Xe==="location"?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),"Locations"]}),j.jsxs("button",{onClick:()=>st(Xe==="schedule"?"none":"schedule"),className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${Xe==="schedule"?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_month"}),"Schedule"]}),j.jsx("button",{onClick:async()=>{ft?(ht(!1),dt([])):ht(!0)},className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${ft?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:ft?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"call_end"}),j.jsx("span",{className:"text-[11px] font-black uppercase tracking-wider",children:"End"})]}):j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined text-sm",children:"phone_in_talk"}),j.jsx("span",{className:"text-[11px] font-black uppercase tracking-wider",children:"Call"})]})})]})]}),j.jsxs("div",{ref:qe,className:"flex-1 overflow-y-auto py-8 space-y-8 custom-scrollbar pr-2 scroll-smooth",children:[t.map((Hn,Ti)=>j.jsx("div",{className:`flex ${Hn.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:j.jsxs("div",{className:`flex gap-4 max-w-[90%] ${Hn.role==="user"?"flex-row-reverse":"flex-row"}`,children:[j.jsx("div",{className:`size-9 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-bold shadow-sm ${Hn.role==="user"?"bg-black text-white":"bg-primary text-white"}`,children:Hn.role==="user"?"AM":j.jsx("span",{className:"material-symbols-outlined text-base",children:"smart_toy"})}),j.jsx("div",{className:`rounded-3xl p-5 shadow-sm border border-black/5 ${Hn.role==="user"?"bg-primary text-white rounded-tr-none":"bg-white text-primary rounded-tl-none"}`,children:Hn.role==="user"?j.jsx("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap",children:Hn.text}):j.jsx("div",{className:"text-[15px] leading-relaxed prose prose-sm max-w-none prose-headings:text-primary prose-strong:text-primary prose-ul:my-2 prose-li:my-0.5",children:j.jsx(BH,{children:Hn.text})})})]})},Ti)),T&&j.jsx("div",{className:"flex justify-start",children:j.jsxs("div",{className:"flex gap-4",children:[j.jsx("div",{className:"size-9 rounded-full bg-primary flex items-center justify-center shadow-sm",children:j.jsx("span",{className:"material-symbols-outlined text-white text-base",children:"smart_toy"})}),j.jsxs("div",{className:"bg-white text-primary rounded-3xl rounded-tl-none p-5 shadow-sm border border-black/5 flex space-x-2 items-center",children:[j.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),j.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),j.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"})]})]})})]}),j.jsxs("div",{className:"py-8 flex-shrink-0",children:[Je?j.jsxs("div",{className:"bg-gray-100 border border-black/5 rounded-[32px] p-4 flex items-center justify-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"lock"}),j.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"This conversation is completed and read-only"}),j.jsx("button",{onClick:zi,className:"ml-4 bg-primary text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-black transition-all",children:"Start New Chat"})]}):j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs("button",{onClick:zi,className:"group flex flex-col items-center justify-center size-14 rounded-3xl bg-white border border-black/5 text-gray-400 hover:text-primary hover:border-primary transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm",title:"New Conversation",children:[j.jsx("span",{className:"material-symbols-outlined text-2xl group-hover:scale-110 transition-transform",children:"add_comment"}),j.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter mt-0.5",children:"New"})]}),fn?j.jsxs("div",{className:"flex-1 bg-white border-2 border-primary/30 shadow-2xl rounded-[32px] p-2 flex items-center gap-2 animate-in fade-in zoom-in duration-300 min-w-0",children:[j.jsxs("div",{className:"flex items-center gap-2 px-3 flex-shrink-0",children:[j.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 animate-pulse"}),j.jsx(D$,{audioData:Ve})]}),j.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:j.jsx("p",{className:"text-[15px] text-gray-800 truncate",children:St||j.jsx("span",{className:"text-gray-400 italic",children:"Listening..."})})}),j.jsx("button",{onClick:()=>{St.trim()&&(ze(),Xi(St.trim()))},disabled:!St.trim(),className:`size-11 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center flex-shrink-0 ${St.trim()?"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10":"bg-gray-100 text-gray-400"}`,title:"Send Message",children:j.jsx("span",{className:"material-symbols-outlined",children:"arrow_upward"})}),j.jsx("button",{onClick:ze,className:"size-11 rounded-2xl bg-red-50 text-red-500 hover:bg-red-100 hover:text-red-600 transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center flex-shrink-0",title:"Cancel",children:j.jsx("span",{className:"material-symbols-outlined text-xl",children:"close"})})]}):j.jsxs("div",{className:"flex-1 bg-white border border-black/5 shadow-2xl rounded-[32px] p-2 flex items-center space-x-2 focus-within:ring-2 focus-within:ring-primary/10 transition-all",children:[j.jsx("button",{onClick:()=>je(),className:"p-3 text-gray-400 hover:text-primary hover:bg-gray-50 rounded-full transition-all group",title:"Voice Input",children:j.jsx("span",{className:"material-symbols-outlined group-hover:scale-110 transition-transform",children:"mic"})}),j.jsx("input",{className:"flex-1 bg-transparent border-none focus:ring-0 text-[15px] placeholder:text-gray-400 py-3",placeholder:"Ask about symptoms or bookings...",type:"text",value:u,onChange:Hn=>y(Hn.target.value),onKeyDown:Hn=>Hn.key==="Enter"&&Xi()}),j.jsx("button",{onClick:()=>Xi(),disabled:T||!u.trim(),className:`size-11 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center ${T||!u.trim()?"bg-gray-100 text-gray-400":"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10"}`,children:j.jsx("span",{className:"material-symbols-outlined",children:"arrow_upward"})})]})]}),!Je&&j.jsxs("div",{className:"mt-4 flex justify-center gap-6 opacity-40",children:[j.jsxs("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[j.jsx("span",{className:"material-symbols-outlined text-[12px] fill-1",children:"verified"}),"HIPAA Compliant"]}),j.jsxs("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[j.jsx("span",{className:"material-symbols-outlined text-[12px] fill-1",children:"lock"}),"Private Session"]})]})]})]})}),j.jsx("div",{className:`bg-white border-l border-black/5 shadow-xl transition-all duration-500 ease-in-out flex flex-col ${Bs?"w-full lg:w-1/2 translate-x-0":"w-0 translate-x-full opacity-0"}`,children:j.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[Xe!=="none"&&j.jsxs("div",{className:`flex-1 flex flex-col min-h-0 ${ft?"h-[60%]":"h-full"}`,children:[Xe==="location"&&j.jsx(L7,{onClose:()=>st("none"),onClinicSelect:jr,clinics:Zt}),Xe==="schedule"&&j.jsx("div",{className:"h-full overflow-y-auto",children:j.jsx(GH,{onClose:()=>st("none"),onConfirm:Va,availableSlots:wt})}),Xe==="question"&&j.jsx(z7,{onClose:()=>{},onSubmit:cr,question:wn})]}),ft&&j.jsx("div",{className:`${Xe!=="none"?"flex-shrink-0":"flex-1 h-full"}`,children:j.jsx(qH,{onClose:()=>{ht(!1),dt([])},minimized:Xe!=="none",transcript:tt})})]})}),En&&j.jsx(N7,{onCancel:()=>ci(!1),onConfirm:Gn})]})},k$=()=>{const[o,t]=He.useState(!0),[a,u]=He.useState(!0),[y,T]=He.useState(!1),[C,s]=He.useState("en"),B=({value:V,onChange:W})=>j.jsx("button",{onClick:()=>W(!V),className:`w-12 h-6 rounded-full relative transition-all ${V?"bg-green-500":"bg-gray-200"}`,children:j.jsx("div",{className:`size-5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm ${V?"left-6":"left-0.5"}`})});return j.jsxs("div",{className:"max-w-3xl mx-auto p-8",children:[j.jsxs("div",{className:"mb-10",children:[j.jsx("h1",{className:"serif-font text-4xl text-primary mb-2",children:"Settings"}),j.jsx("p",{className:"text-gray-500 text-sm",children:"Manage your account preferences and app settings"})]}),j.jsxs("section",{className:"mb-10",children:[j.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Account"}),j.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden",children:[j.jsxs("div",{className:"p-6 flex items-center gap-4 border-b border-black/5",children:[j.jsx("div",{className:"size-16 rounded-full overflow-hidden border-2 border-black/5",children:j.jsx("img",{src:"https://picsum.photos/seed/alex/200/200",alt:"Profile",className:"w-full h-full object-cover"})}),j.jsxs("div",{className:"flex-1",children:[j.jsx("p",{className:"font-bold text-lg text-primary",children:"Alex McGregor"}),j.jsx("p",{className:"text-sm text-gray-400",children:"alex.mcgregor@email.com"})]}),j.jsx("button",{className:"px-4 py-2 bg-gray-50 text-primary text-xs font-bold rounded-xl hover:bg-gray-100 transition-all",children:"Edit Profile"})]}),j.jsxs("div",{className:"divide-y divide-black/5",children:[j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"email"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Email"})]}),j.jsx("span",{className:"text-sm text-gray-400",children:"alex.mcgregor@email.com"})]}),j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"phone"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Phone"})]}),j.jsx("span",{className:"text-sm text-gray-400",children:"+1 (514) 555-0123"})]}),j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"location_on"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Location"})]}),j.jsx("span",{className:"text-sm text-gray-400",children:"Montreal, QC"})]})]})]})]}),j.jsxs("section",{className:"mb-10",children:[j.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Notifications"}),j.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-medium text-primary",children:"Push Notifications"}),j.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Receive alerts on your device"})]}),j.jsx(B,{value:o,onChange:t})]}),j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-medium text-primary",children:"Email Alerts"}),j.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Get updates via email"})]}),j.jsx(B,{value:a,onChange:u})]}),j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-medium text-primary",children:"SMS Notifications"}),j.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Receive text message alerts"})]}),j.jsx(B,{value:y,onChange:T})]})]})]}),j.jsxs("section",{className:"mb-10",children:[j.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Preferences"}),j.jsx("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:j.jsxs("div",{className:"p-5 flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("p",{className:"text-sm font-medium text-primary",children:"Language"}),j.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Select your preferred language"})]}),j.jsxs("select",{value:C,onChange:V=>s(V.target.value),className:"bg-gray-50 border border-black/5 rounded-xl px-6.5 py-2 text-sm text-primary font-medium focus:outline-none focus:ring-2 focus:ring-primary/20",children:[j.jsx("option",{value:"en",children:"English"}),j.jsx("option",{value:"fr",children:"Franais"}),j.jsx("option",{value:"es",children:"Espaol"})]})]})})]}),j.jsxs("section",{className:"mb-10",children:[j.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Privacy & Security"}),j.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[j.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"lock"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Change Password"})]}),j.jsx("span",{className:"material-symbols-outlined text-gray-300",children:"chevron_right"})]}),j.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"security"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Two-Factor Authentication"})]}),j.jsx("span",{className:"material-symbols-outlined text-gray-300",children:"chevron_right"})]}),j.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"description"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Privacy Policy"})]}),j.jsx("span",{className:"material-symbols-outlined text-gray-300",children:"chevron_right"})]}),j.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"gavel"}),j.jsx("span",{className:"text-sm font-medium text-primary",children:"Terms of Service"})]}),j.jsx("span",{className:"material-symbols-outlined text-gray-300",children:"chevron_right"})]})]})]}),j.jsxs("section",{children:[j.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-red-400 mb-4 px-1",children:"Danger Zone"}),j.jsx("div",{className:"bg-white rounded-3xl border border-red-100 shadow-sm overflow-hidden",children:j.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-red-50 transition-all group",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-red-400",children:"delete"}),j.jsx("span",{className:"text-sm font-medium text-red-500",children:"Delete Account"})]}),j.jsx("span",{className:"material-symbols-outlined text-red-300 group-hover:text-red-400",children:"chevron_right"})]})})]}),j.jsx("div",{className:"mt-12 text-center",children:j.jsx("p",{className:"text-xs text-gray-300 font-medium",children:"Health.me v1.0.0"})})]})},L$=({onSignUp:o})=>{const t=ff(),[a,u]=He.useState(!1),[y,T]=He.useState(!1),[C,s]=He.useState(!1),B=async V=>{V.preventDefault(),u(!0),await new Promise(W=>setTimeout(W,500)),u(!1),o(),t("/onboarding")};return j.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[j.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[j.jsx("img",{src:US,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),j.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[j.jsx("div",{className:"flex items-center space-x-2 mb-6",children:j.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),j.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Your health journey starts here."'})]})]}),j.jsx("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:j.jsxs("div",{className:"w-full max-w-[440px]",children:[j.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-[40px] shadow-sm border border-black/5",children:[j.jsxs("div",{className:"text-center mb-10",children:[j.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-soft-cream mb-6",children:j.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"person_add"})}),j.jsx("h1",{className:"serif-font text-4xl text-primary mb-3 leading-tight",children:"Create account"}),j.jsx("p",{className:"text-gray-500 text-[15px]",children:"Start managing your health journey today."})]}),j.jsxs("form",{onSubmit:B,className:"space-y-5",children:[j.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"firstName",children:"First Name"}),j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"firstName",placeholder:"Alex",type:"text",required:!0})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"lastName",children:"Last Name"}),j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"lastName",placeholder:"McGregor",type:"text",required:!0})]})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"email",children:"Email Address"}),j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"email",placeholder:"name@example.com",type:"email",required:!0})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"password",children:"Password"}),j.jsxs("div",{className:"relative",children:[j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"password",placeholder:"Min. 8 characters",type:y?"text":"password",required:!0}),j.jsx("button",{type:"button",onClick:()=>T(!y),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:j.jsx("span",{className:"material-symbols-outlined text-lg",children:y?"visibility_off":"visibility"})})]})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"confirmPassword",children:"Confirm Password"}),j.jsxs("div",{className:"relative",children:[j.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"confirmPassword",placeholder:"",type:C?"text":"password",required:!0}),j.jsx("button",{type:"button",onClick:()=>s(!C),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:j.jsx("span",{className:"material-symbols-outlined text-lg",children:C?"visibility_off":"visibility"})})]})]}),j.jsxs("div",{className:"flex items-start gap-3 py-2",children:[j.jsx("input",{type:"checkbox",id:"terms",className:"mt-1 w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary",required:!0}),j.jsxs("label",{htmlFor:"terms",className:"text-xs text-gray-500 leading-relaxed",children:["I agree to the ",j.jsx("a",{href:"#",className:"text-primary font-bold hover:underline",children:"Terms of Service"})," and ",j.jsx("a",{href:"#",className:"text-primary font-bold hover:underline",children:"Privacy Policy"})]})]}),j.jsx("button",{className:"w-full bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all transform active:scale-[0.99] text-[15px] shadow-lg shadow-black/10 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"submit",disabled:a,children:a?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Creating account..."]}):"Create Account"})]}),j.jsxs("p",{className:"mt-8 text-center text-[13px] text-gray-500",children:["Already have an account? ",j.jsx("a",{href:"#/login",className:"font-bold text-primary hover:underline",children:"Sign in"})]})]}),j.jsx("div",{className:"mt-12 text-center",children:j.jsxs("div",{className:"flex justify-center gap-6 text-gray-300 mb-4",children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"verified_user"}),j.jsx("span",{className:"material-symbols-outlined text-xl",children:"shield"}),j.jsx("span",{className:"material-symbols-outlined text-xl",children:"info"})]})})]})})]})},z$=()=>{const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=new Date().getDay(),u=8,y=20,T=Array.from({length:y-u+1},(ft,ht)=>ht+u),s=(()=>{const ft=new Date,ht=ft.getDate()-ft.getDay();return o.map((Ft,fn)=>new Date(ft.setDate(ht+fn)).getDate())})(),[B,V]=He.useState([{id:"1",title:"Cardiology Follow-up",location:"City Clinic",day:1,startHour:10,endHour:11,type:"medical"},{id:"2",title:"Appt with Dr. Strange",location:"General Hospital",day:2,startHour:14,endHour:15,type:"medical"},{id:"3",title:"Annual Physical",location:"Clinique Mdicale",day:4,startHour:9,endHour:10.5,type:"medical"},{id:"4",title:"Physiotherapy",location:"Physio Extra",day:3,startHour:16.5,endHour:17.5,type:"medical"},{id:"5",title:"Blood Work",location:"CLSC Metro",day:5,startHour:8.5,endHour:9,type:"medical"}]),[W,Q]=He.useState(!1),[oe,he]=He.useState({day:a,startHour:9,endHour:10,type:"medical"}),Je=ft=>({top:`${(ft.startHour-u)*60}px`,height:`${(ft.endHour-ft.startHour)*60}px`}),Ye=()=>{const ft=new Date;return(ft.getHours()+ft.getMinutes()/60-u)*60},Xe={medical:"bg-red-50 border-red-100 text-red-700 hover:bg-red-100"},st=ft=>{if(ft.preventDefault(),!oe.title||oe.day===void 0||oe.startHour===void 0||oe.endHour===void 0)return;const ht={id:Math.random().toString(36).substr(2,9),title:oe.title,location:oe.location||"",day:oe.day,startHour:Number(oe.startHour),endHour:Number(oe.endHour),type:"medical"};V([...B,ht]),Q(!1),he({day:a,startHour:9,endHour:10,type:"medical"})};return j.jsxs("div",{className:"h-full bg-soft-cream flex flex-col relative overflow-hidden font-sans",children:[j.jsxs("div",{className:"p-8 pb-6 flex justify-between items-end",children:[j.jsxs("div",{children:[j.jsx("h1",{className:"serif-font text-4xl text-primary mb-2",children:"Medical Schedule"}),j.jsx("p",{className:"text-gray-500 text-sm",children:"Manage your upcoming doctor's appointments"})]}),j.jsxs("button",{onClick:()=>Q(!0),className:"bg-primary text-white rounded-2xl px-6 py-3 font-bold text-sm shadow-lg hover:bg-black transition-all flex items-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-xl",children:"add"}),"Add Appointment"]})]}),j.jsx("div",{className:"flex-1 overflow-y-auto p-6 pt-0 custom-scrollbar",children:j.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden flex flex-col min-w-[800px]",children:[j.jsxs("div",{className:"grid grid-cols-8 border-b border-black/5 bg-gray-50/50 sticky top-0 z-30 backdrop-blur-sm",children:[j.jsx("div",{className:"p-4 border-r border-black/5 text-center text-xs font-bold text-gray-400 uppercase tracking-widest pt-6",children:"Time"}),o.map((ft,ht)=>j.jsxs("div",{className:`p-4 border-r border-black/5 last:border-r-0 text-center ${ht===a?"bg-primary/5":""}`,children:[j.jsx("p",{className:`text-xs font-bold uppercase tracking-widest mb-1 ${ht===a?"text-primary":"text-gray-400"}`,children:ft}),j.jsx("div",{className:`size-10 mx-auto rounded-full flex items-center justify-center font-bold text-lg transition-colors ${ht===a?"bg-primary text-white shadow-md":"text-gray-700"}`,children:s[ht]})]},ft))]}),j.jsxs("div",{className:"flex relative items-start",children:[j.jsx("div",{className:"w-[12.5%] flex-shrink-0 border-r border-black/5 bg-gray-50/30",children:T.map(ft=>j.jsx("div",{className:"h-[60px] border-b border-black/5 px-4 py-2 text-right",children:j.jsx("span",{className:"text-[11px] font-bold text-gray-400 block -mt-2.5",children:ft===12?"12 PM":ft>12?`${ft-12} PM`:`${ft} AM`})},ft))}),j.jsx("div",{className:"flex-1 grid grid-cols-7 relative",children:o.map((ft,ht)=>j.jsxs("div",{className:`border-r border-black/5 last:border-r-0 relative ${ht===a?"bg-primary/5":""}`,children:[T.map(Ft=>j.jsx("div",{className:"h-[60px] border-b border-black/5"},Ft)),B.filter(Ft=>Ft.day===ht).map(Ft=>j.jsxs("div",{className:`absolute left-1 right-1 rounded-xl p-2 border shadow-sm cursor-pointer transition-all hover:scale-[1.02] hover:z-20 hover:shadow-md flex flex-col overflow-hidden ${Xe[Ft.type]}`,style:Je(Ft),children:[j.jsx("p",{className:"text-[11px] font-black leading-tight mb-0.5 truncate",children:Ft.title}),Ft.location&&j.jsxs("p",{className:"text-[10px] font-medium opacity-90 truncate flex items-center gap-1 mb-1",children:[j.jsx("span",{className:"material-symbols-outlined text-[10px] leading-none",children:"location_on"}),Ft.location]}),j.jsxs("p",{className:"text-[9px] font-bold mt-auto opacity-70",children:[Math.floor(Ft.startHour),":",(Ft.startHour%1*60).toString().padStart(2,"0")," - ",Math.floor(Ft.endHour),":",(Ft.endHour%1*60).toString().padStart(2,"0")]})]},Ft.id)),ht===a&&j.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-red-500 z-10 pointer-events-none",style:{top:`${Ye()}px`,display:new Date().getHours()<u||new Date().getHours()>y?"none":"block"},children:j.jsx("div",{className:"absolute -left-1.5 -top-1.5 size-3 rounded-full bg-red-500 ring-2 ring-white"})})]},ht))})]})]})}),W&&j.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:j.jsxs("div",{className:"bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl border border-black/5 animate-in slide-in-from-bottom-4 duration-300",children:[j.jsx("h2",{className:"serif-font text-2xl text-primary mb-6",children:"Add Appointment"}),j.jsxs("form",{onSubmit:st,children:[j.jsxs("div",{className:"space-y-4 mb-4",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Appointment Title"}),j.jsx("input",{type:"text",value:oe.title||"",onChange:ft=>he({...oe,title:ft.target.value}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all font-medium text-sm",placeholder:"e.g. Cardiology Checkup",required:!0})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Clinic / Location"}),j.jsxs("div",{className:"relative",children:[j.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg",children:"location_on"}),j.jsx("input",{type:"text",value:oe.location||"",onChange:ft=>he({...oe,location:ft.target.value}),className:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all font-medium text-sm",placeholder:"Add location"})]})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Day"}),j.jsx("select",{value:oe.day,onChange:ft=>he({...oe,day:Number(ft.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium appearence-none",children:o.map((ft,ht)=>j.jsx("option",{value:ht,children:ft},ft))})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Type"}),j.jsx("select",{value:oe.type,disabled:!0,className:"w-full px-4 py-3 rounded-xl bg-gray-100 border border-black/5 outline-none text-sm font-medium text-gray-500",children:j.jsx("option",{value:"medical",children:"Medical"})})]})]}),j.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Start Time (24h)"}),j.jsx("input",{type:"number",min:u,max:y,step:"0.5",value:oe.startHour,onChange:ft=>he({...oe,startHour:Number(ft.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"End Time (24h)"}),j.jsx("input",{type:"number",min:u,max:y,step:"0.5",value:oe.endHour,onChange:ft=>he({...oe,endHour:Number(ft.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium"})]})]}),j.jsxs("div",{className:"flex gap-3",children:[j.jsx("button",{type:"button",onClick:()=>Q(!1),className:"flex-1 py-3 rounded-xl font-bold text-gray-500 hover:bg-gray-100 transition-colors text-sm",children:"Cancel"}),j.jsx("button",{type:"submit",className:"flex-1 py-3 rounded-xl font-bold bg-primary text-white shadow-lg hover:bg-black transition-all text-sm",children:"Create Appointment"})]})]})]})})]})},O$={fullName:"Alex Thompson",dateOfBirth:"1992-03-15",gender:"Male"},N$={height:`5'11"`,weight:"165"},B$="A+",F$=["Peanuts","Penicillin","Dust Mites"],V$={conditions:["Asthma","Anxiety"],notes:"Mild seasonal allergies, uses inhaler as needed."},j$={name:"Sarah Thompson",relationship:"Spouse",phone:"(514) 555-0123"},U$={personalInfo:O$,physicalStats:N$,bloodType:B$,allergies:F$,medicalConditions:V$,emergencyContact:j$},G$=["A+","A-","B+","B-","AB+","AB-","O+","O-"],oD=["Peanuts","Tree Nuts","Milk","Eggs","Wheat","Soy","Fish","Shellfish","Penicillin","Sulfa","Latex","Dust Mites","Pollen","Pet Dander"],q$=["Diabetes","Hypertension","Asthma","Heart Disease","Arthritis","Depression","Anxiety","ADHD","Epilepsy","Thyroid Disorder"],H$=({onComplete:o})=>{const t=ff(),{user:a}=B1(),[u,y]=He.useState(0),[T,C]=He.useState("next"),[s,B]=He.useState(!1),[V,W]=He.useState(!1),[Q,oe]=He.useState(!1),[he,Je]=He.useState({personalInfo:{fullName:"",dateOfBirth:"",gender:""},physicalStats:{height:"",weight:""},bloodType:"",allergies:[],medicalConditions:{conditions:[],notes:""},emergencyContact:{name:"",relationship:"",phone:""}}),[Ye,Xe]=He.useState(""),st=6,ft=(u+1)/st*100;He.useEffect(()=>{const be=Zt=>{Zt.shiftKey&&Zt.key.toLowerCase()==="a"&&(Zt.preventDefault(),ht())};return window.addEventListener("keydown",be),()=>window.removeEventListener("keydown",be)},[u]);const ht=()=>{const be=U$;switch(u){case 0:Je(Zt=>({...Zt,personalInfo:be.personalInfo}));break;case 1:Je(Zt=>({...Zt,physicalStats:be.physicalStats}));break;case 2:Je(Zt=>({...Zt,bloodType:be.bloodType}));break;case 3:Je(Zt=>({...Zt,allergies:be.allergies}));break;case 4:Je(Zt=>({...Zt,medicalConditions:be.medicalConditions}));break;case 5:Je(Zt=>({...Zt,emergencyContact:be.emergencyContact}));break}oe(!0),setTimeout(()=>oe(!1),2e3)},Ft=[{icon:"person",title:"Personal Information",subtitle:"Let's start with the basics"},{icon:"straighten",title:"Physical Stats",subtitle:"Help us understand your body"},{icon:"bloodtype",title:"Blood Type",subtitle:"Select your blood type"},{icon:"warning",title:"Allergies",subtitle:"Tell us about any allergies"},{icon:"medical_information",title:"Medical History",subtitle:"Any existing conditions?"},{icon:"emergency",title:"Emergency Contact",subtitle:"Someone we can reach in emergencies"}],fn=()=>{s||u<st-1&&(C("next"),B(!0),setTimeout(()=>{y(be=>be+1),B(!1)},300))},St=()=>{s||u>0&&(C("prev"),B(!0),setTimeout(()=>{y(be=>be-1),B(!1)},300))},je=async()=>{if(W(!0),console.log("[Onboarding] handleComplete called. User:",(a==null?void 0:a.uid)||"NULL"),console.log("[Onboarding] Profile data:",JSON.stringify(he,null,2)),a)try{console.log("[Onboarding] Attempting to save profile for user:",a.uid),await p8(a.uid,{...he,createdAt:new Date().toISOString()}),console.log("[Onboarding]  Profile saved to Firestore successfully!"),console.log("[Onboarding] Check Firestore at: users/"+a.uid+"/profile/data")}catch(be){console.error("[Onboarding]  Failed to save profile to Firestore:",be),alert("Warning: Failed to save your profile. Please try updating it later in settings.")}else console.error("[Onboarding]  Cannot save - user is null! Check AuthProvider."),alert("Warning: Not signed in. Please sign in and complete onboarding again.");setTimeout(()=>{o(),t("/chat")},2e3)},ze=()=>{Ye.trim()&&!he.allergies.includes(Ye.trim())&&(Je(be=>({...be,allergies:[...be.allergies,Ye.trim()]})),Xe(""))},Ve=be=>{Je(Zt=>({...Zt,allergies:Zt.allergies.includes(be)?Zt.allergies.filter(dn=>dn!==be):[...Zt.allergies,be]}))},Ke=be=>{Je(Zt=>({...Zt,medicalConditions:{...Zt.medicalConditions,conditions:Zt.medicalConditions.conditions.includes(be)?Zt.medicalConditions.conditions.filter(dn=>dn!==be):[...Zt.medicalConditions.conditions,be]}}))},qe=()=>s?T==="next"?"animate-slideOutLeft":"animate-slideOutRight":"animate-slideIn",et=()=>{switch(u){case 0:return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Full Name"}),j.jsx("input",{className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"Enter your full name",value:he.personalInfo.fullName,onChange:be=>Je(Zt=>({...Zt,personalInfo:{...Zt.personalInfo,fullName:be.target.value}}))})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Date of Birth"}),j.jsx("input",{type:"date",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary text-[15px]",value:he.personalInfo.dateOfBirth,onChange:be=>Je(Zt=>({...Zt,personalInfo:{...Zt.personalInfo,dateOfBirth:be.target.value}}))})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Gender"}),j.jsx("div",{className:"grid grid-cols-3 gap-3",children:["Male","Female","Other"].map(be=>j.jsx("button",{type:"button",onClick:()=>Je(Zt=>({...Zt,personalInfo:{...Zt.personalInfo,gender:be}})),className:`py-4 rounded-2xl font-bold text-sm transition-all ${he.personalInfo.gender===be?"bg-primary text-white shadow-lg scale-[1.02]":"bg-gray-50 text-gray-500 hover:bg-gray-100"}`,children:be},be))})]})]});case 1:return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Height"}),j.jsx("div",{className:"flex gap-3",children:j.jsx("input",{className:"flex-1 px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"e.g., 5'11",value:he.physicalStats.height,onChange:be=>Je(Zt=>({...Zt,physicalStats:{...Zt.physicalStats,height:be.target.value}}))})})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Weight (lbs)"}),j.jsx("input",{type:"number",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"Enter your weight",value:he.physicalStats.weight,onChange:be=>Je(Zt=>({...Zt,physicalStats:{...Zt.physicalStats,weight:be.target.value}}))})]}),j.jsxs("div",{className:"p-4 bg-blue-50 rounded-2xl flex items-start gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"info"}),j.jsx("p",{className:"text-sm text-blue-700",children:"Your physical stats help us provide more accurate health recommendations."})]})]});case 2:return j.jsxs("div",{className:"space-y-6",children:[j.jsx("div",{className:"grid grid-cols-4 gap-3",children:G$.map(be=>j.jsx("button",{type:"button",onClick:()=>Je(Zt=>({...Zt,bloodType:be})),className:`py-6 rounded-2xl font-black text-xl transition-all transform hover:scale-105 ${he.bloodType===be?"bg-red-500 text-white shadow-lg shadow-red-200 scale-105":"bg-white text-primary border-2 border-gray-100 hover:border-red-200"}`,children:be},be))}),j.jsx("button",{type:"button",onClick:()=>Je(be=>({...be,bloodType:"Unknown"})),className:`w-full py-4 rounded-2xl font-bold text-sm transition-all ${he.bloodType==="Unknown"?"bg-gray-200 text-primary":"bg-gray-50 text-gray-400 hover:bg-gray-100"}`,children:"I don't know my blood type"})]});case 3:return j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{className:"flex gap-2",children:[j.jsx("input",{className:"flex-1 px-4 py-3 rounded-xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-sm",placeholder:"Add custom allergy...",value:Ye,onChange:be=>Xe(be.target.value),onKeyPress:be=>be.key==="Enter"&&ze()}),j.jsx("button",{type:"button",onClick:ze,className:"px-4 py-3 bg-primary text-white rounded-xl font-bold text-sm hover:bg-black transition-all",children:"Add"})]}),j.jsxs("div",{className:"flex flex-wrap gap-2 max-h-[300px] overflow-y-auto custom-scrollbar",children:[oD.map(be=>j.jsxs("button",{type:"button",onClick:()=>Ve(be),className:`px-4 py-2.5 rounded-full font-bold text-xs transition-all ${he.allergies.includes(be)?"bg-red-500 text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:border-red-300"}`,children:[he.allergies.includes(be)&&j.jsx("span",{className:"material-symbols-outlined text-sm mr-1 align-middle",children:"check"}),be]},be)),he.allergies.filter(be=>!oD.includes(be)).map(be=>j.jsxs("button",{type:"button",onClick:()=>Ve(be),className:"px-4 py-2.5 rounded-full font-bold text-xs bg-red-500 text-white shadow-md transition-all",children:[j.jsx("span",{className:"material-symbols-outlined text-sm mr-1 align-middle",children:"check"}),be]},be))]}),he.allergies.length===0&&j.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No allergies selected - tap to add"})]});case 4:return j.jsxs("div",{className:"space-y-4",children:[j.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-[200px] overflow-y-auto custom-scrollbar",children:q$.map(be=>j.jsxs("button",{type:"button",onClick:()=>Ke(be),className:`px-4 py-3 rounded-xl font-bold text-xs text-left transition-all flex items-center gap-2 ${he.medicalConditions.conditions.includes(be)?"bg-primary text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:border-primary"}`,children:[j.jsx("span",{className:`material-symbols-outlined text-sm ${he.medicalConditions.conditions.includes(be)?"opacity-100":"opacity-0"}`,children:"check_circle"}),be]},be))}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Additional Notes"}),j.jsx("textarea",{className:"w-full px-4 py-3 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-sm resize-none",placeholder:"Any other conditions or notes for your doctor...",rows:3,value:he.medicalConditions.notes,onChange:be=>Je(Zt=>({...Zt,medicalConditions:{...Zt.medicalConditions,notes:be.target.value}}))})]})]});case 5:return j.jsxs("div",{className:"space-y-5",children:[j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Contact Name"}),j.jsx("input",{className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"Full name of your emergency contact",value:he.emergencyContact.name,onChange:be=>Je(Zt=>({...Zt,emergencyContact:{...Zt.emergencyContact,name:be.target.value}}))})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Relationship"}),j.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Spouse","Parent","Sibling","Child","Friend","Other"].map(be=>j.jsx("button",{type:"button",onClick:()=>Je(Zt=>({...Zt,emergencyContact:{...Zt.emergencyContact,relationship:be}})),className:`py-3 rounded-xl font-bold text-xs transition-all ${he.emergencyContact.relationship===be?"bg-primary text-white shadow-md":"bg-gray-50 text-gray-500 hover:bg-gray-100"}`,children:be},be))})]}),j.jsxs("div",{className:"space-y-1.5",children:[j.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Phone Number"}),j.jsx("input",{type:"tel",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"(555) 123-4567",value:he.emergencyContact.phone,onChange:be=>Je(Zt=>({...Zt,emergencyContact:{...Zt.emergencyContact,phone:be.target.value}}))})]})]});default:return null}};return j.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[V&&j.jsx("div",{className:"fixed inset-0 pointer-events-none z-50",children:[...Array(50)].map((be,Zt)=>j.jsx("div",{className:"absolute animate-confetti",style:{left:`${Math.random()*100}%`,top:"-20px",animationDelay:`${Math.random()*2}s`,backgroundColor:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD"][Math.floor(Math.random()*6)],width:`${Math.random()*10+5}px`,height:`${Math.random()*10+5}px`,borderRadius:Math.random()>.5?"50%":"0"}},Zt))}),Q&&j.jsx("div",{className:"fixed top-6 right-6 z-50 animate-slideIn",children:j.jsxs("div",{className:"bg-primary text-white px-5 py-3 rounded-2xl shadow-xl flex items-center gap-3",children:[j.jsx("span",{className:"material-symbols-outlined text-green-400",children:"auto_fix_high"}),j.jsx("span",{className:"font-bold text-sm",children:"Demo data autofilled!"}),j.jsx("span",{className:"text-xs text-white/60 ml-2",children:"Shift+A"})]})}),j.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[j.jsx("div",{className:"absolute inset-0 bg-black/30 z-10"}),j.jsx("img",{src:US,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),j.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[j.jsx("div",{className:"flex items-center space-x-2 mb-6",children:j.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),j.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Tell us about yourself so we can better care for you."'})]})]}),j.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:[j.jsxs("div",{className:"absolute top-8 left-8 right-8",children:[j.jsxs("div",{className:"flex items-center justify-between mb-2",children:[j.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:["Step ",u+1," of ",st]}),j.jsxs("span",{className:"text-xs font-bold text-primary",children:[Math.round(ft),"%"]})]}),j.jsx("div",{className:"h-2 bg-white rounded-full overflow-hidden shadow-inner",children:j.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-gray-700 rounded-full transition-all duration-500 ease-out",style:{width:`${ft}%`}})})]}),j.jsxs("div",{className:"w-full max-w-[480px] mt-16",children:[j.jsxs("div",{className:`bg-white p-8 md:p-10 rounded-[40px] shadow-[0_8px_40px_rgba(0,0,0,0.06)] border border-black/5 ${qe()}`,children:[j.jsxs("div",{className:"text-center mb-8",children:[j.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-bg-cream mb-5 animate-bounceIn",children:j.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:Ft[u].icon})}),j.jsx("h1",{className:"serif-font text-3xl text-primary mb-2 leading-tight",children:Ft[u].title}),j.jsx("p",{className:"text-gray-500 text-[15px]",children:Ft[u].subtitle})]}),j.jsx("div",{className:"min-h-[280px]",children:et()}),j.jsxs("div",{className:"flex gap-3 mt-8",children:[u>0&&j.jsxs("button",{onClick:St,className:"flex-1 bg-gray-100 text-primary font-bold py-4 rounded-full hover:bg-gray-200 transition-all text-[15px] flex items-center justify-center gap-2",children:[j.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_back"}),"Back"]}),u<st-1?j.jsxs("button",{onClick:fn,className:"flex-1 bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all text-[15px] shadow-lg shadow-black/10 flex items-center justify-center gap-2",children:["Continue",j.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})]}):j.jsxs("button",{onClick:je,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 rounded-full hover:shadow-xl hover:scale-[1.02] transition-all text-[15px] shadow-lg shadow-green-200 flex items-center justify-center gap-2 animate-pulse-subtle",children:[j.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"}),"Complete Setup"]})]})]}),j.jsx("button",{onClick:()=>{o(),t("/chat")},className:"w-full mt-6 text-center text-gray-400 text-sm hover:text-gray-600 transition-colors",children:"Skip for now"})]})]}),j.jsx("style",{children:`
        @keyframes slideIn {
          from { transform: translateX(60px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutLeft {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(-60px); opacity: 0; }
        }
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(60px); opacity: 0; }
        }
        @keyframes bounceIn {
          0% { transform: scale(0.5); opacity: 0; }
          60% { transform: scale(1.1); }
          100% { transform: scale(1); opacity: 1; }
        }
        @keyframes confetti {
          0% { transform: translateY(0) rotate(0deg); opacity: 1; }
          100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes pulse-subtle {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.85; }
        }
        .animate-slideIn { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slideOutLeft { animation: slideOutLeft 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slideOutRight { animation: slideOutRight 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-bounceIn { animation: bounceIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-confetti { animation: confetti 3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-pulse-subtle { animation: pulse-subtle 2s ease-in-out infinite; }
      `})]})},$$=()=>{const[o,t]=He.useState(!1),[a,u]=He.useState(!1),y=({children:T})=>o?j.jsxs("div",{className:"h-screen flex overflow-hidden bg-bg-cream transition-colors duration-300",children:[j.jsx(m8,{onLogout:()=>t(!1)}),j.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-soft-cream",children:[j.jsx(g8,{}),j.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:T})]})]}):j.jsx(gT,{to:"/login",replace:!0});return j.jsx(l8,{children:j.jsx(tF,{children:j.jsx(HB,{children:j.jsxs(vB,{children:[j.jsx(Zh,{path:"/login",element:j.jsx(v8,{onLogin:()=>t(!0)})}),j.jsx(Zh,{path:"/signup",element:j.jsx(L$,{onSignUp:()=>t(!0)})}),j.jsx(Zh,{path:"/onboarding",element:o?j.jsx(H$,{onComplete:()=>u(!0)}):j.jsx(gT,{to:"/login",replace:!0})}),j.jsx(Zh,{path:"/",element:j.jsx(y,{children:j.jsx(y8,{})})}),j.jsx(Zh,{path:"/chat",element:j.jsx(y,{children:j.jsx(P$,{})})}),j.jsx(Zh,{path:"/emergency",element:j.jsx(y,{children:j.jsx(x8,{})})}),j.jsx(Zh,{path:"/profile",element:j.jsx(y,{children:j.jsx(w8,{})})}),j.jsx(Zh,{path:"/calendar",element:j.jsx(y,{children:j.jsx(z$,{})})}),j.jsx(Zh,{path:"/settings",element:j.jsx(y,{children:j.jsx(k$,{})})}),j.jsx(Zh,{path:"*",element:j.jsx(gT,{to:"/",replace:!0})})]})})})})},lz=document.getElementById("root");if(!lz)throw new Error("Could not find root element to mount to");const Z$=TN.createRoot(lz);Z$.render(j.jsx(gN.StrictMode,{children:j.jsx($$,{})}));
