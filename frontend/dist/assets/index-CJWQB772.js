function gN(o,t){for(var a=0;a<t.length;a++){const u=t[a];if(typeof u!="string"&&!Array.isArray(u)){for(const y in u)if(y!=="default"&&!(y in o)){const T=Object.getOwnPropertyDescriptor(u,y);T&&Object.defineProperty(o,y,T.get?T:{enumerable:!0,get:()=>u[y]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))u(y);new MutationObserver(y=>{for(const T of y)if(T.type==="childList")for(const C of T.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&u(C)}).observe(document,{childList:!0,subtree:!0});function a(y){const T={};return y.integrity&&(T.integrity=y.integrity),y.referrerPolicy&&(T.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?T.credentials="include":y.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function u(y){if(y.ep)return;y.ep=!0;const T=a(y);fetch(y.href,T)}})();function Uv(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var hT={exports:{}},av={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _C;function _N(){if(_C)return av;_C=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(u,y,T){var C=null;if(T!==void 0&&(C=""+T),y.key!==void 0&&(C=""+y.key),"key"in y){T={};for(var s in y)s!=="key"&&(T[s]=y[s])}else T=y;return y=T.ref,{$$typeof:o,type:u,key:C,ref:y!==void 0?y:null,props:T}}return av.Fragment=t,av.jsx=a,av.jsxs=a,av}var yC;function yN(){return yC||(yC=1,hT.exports=_N()),hT.exports}var N=yN(),dT={exports:{}},Xi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xC;function xN(){if(xC)return Xi;xC=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),C=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),B=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),ae=Symbol.iterator;function he(ft){return ft===null||typeof ft!="object"?null:(ft=ae&&ft[ae]||ft["@@iterator"],typeof ft=="function"?ft:null)}var Qe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ye=Object.assign,Ke={};function at(ft,Qt,Be){this.props=ft,this.context=Qt,this.refs=Ke,this.updater=Be||Qe}at.prototype.isReactComponent={},at.prototype.setState=function(ft,Qt){if(typeof ft!="object"&&typeof ft!="function"&&ft!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ft,Qt,"setState")},at.prototype.forceUpdate=function(ft){this.updater.enqueueForceUpdate(this,ft,"forceUpdate")};function nt(){}nt.prototype=at.prototype;function Ge(ft,Qt,Be){this.props=ft,this.context=Qt,this.refs=Ke,this.updater=Be||Qe}var Mt=Ge.prototype=new nt;Mt.constructor=Ge,Ye(Mt,at.prototype),Mt.isPureReactComponent=!0;var cn=Array.isArray;function St(){}var Oe={H:null,A:null,T:null,S:null},Re=Object.prototype.hasOwnProperty;function Ve(ft,Qt,Be){var En=Be.ref;return{$$typeof:o,type:ft,key:Qt,ref:En!==void 0?En:null,props:Be}}function Je(ft,Qt){return Ve(ft.type,Qt,ft.props)}function He(ft){return typeof ft=="object"&&ft!==null&&ft.$$typeof===o}function tt(ft){var Qt={"=":"=0",":":"=2"};return"$"+ft.replace(/[=:]/g,function(Be){return Qt[Be]})}var ve=/\/+/g;function Ht(ft,Qt){return typeof ft=="object"&&ft!==null&&ft.key!=null?tt(""+ft.key):Qt.toString(36)}function dn(ft){switch(ft.status){case"fulfilled":return ft.value;case"rejected":throw ft.reason;default:switch(typeof ft.status=="string"?ft.then(St,St):(ft.status="pending",ft.then(function(Qt){ft.status==="pending"&&(ft.status="fulfilled",ft.value=Qt)},function(Qt){ft.status==="pending"&&(ft.status="rejected",ft.reason=Qt)})),ft.status){case"fulfilled":return ft.value;case"rejected":throw ft.reason}}throw ft}function wt(ft,Qt,Be,En,Qn){var $n=typeof ft;($n==="undefined"||$n==="boolean")&&(ft=null);var ki=!1;if(ft===null)ki=!0;else switch($n){case"bigint":case"string":case"number":ki=!0;break;case"object":switch(ft.$$typeof){case o:case t:ki=!0;break;case W:return ki=ft._init,wt(ki(ft._payload),Qt,Be,En,Qn)}}if(ki)return Qn=Qn(ft),ki=En===""?"."+Ht(ft,0):En,cn(Qn)?(Be="",ki!=null&&(Be=ki.replace(ve,"$&/")+"/"),wt(Qn,Qt,Be,"",function(Ni){return Ni})):Qn!=null&&(He(Qn)&&(Qn=Je(Qn,Be+(Qn.key==null||ft&&ft.key===Qn.key?"":(""+Qn.key).replace(ve,"$&/")+"/")+ki)),Qt.push(Qn)),1;ki=0;var er=En===""?".":En+":";if(cn(ft))for(var qn=0;qn<ft.length;qn++)En=ft[qn],$n=er+Ht(En,qn),ki+=wt(En,Qt,Be,$n,Qn);else if(qn=he(ft),typeof qn=="function")for(ft=qn.call(ft),qn=0;!(En=ft.next()).done;)En=En.value,$n=er+Ht(En,qn++),ki+=wt(En,Qt,Be,$n,Qn);else if($n==="object"){if(typeof ft.then=="function")return wt(dn(ft),Qt,Be,En,Qn);throw Qt=String(ft),Error("Objects are not valid as a React child (found: "+(Qt==="[object Object]"?"object with keys {"+Object.keys(ft).join(", ")+"}":Qt)+"). If you meant to render a collection of children, use an array instead.")}return ki}function Kt(ft,Qt,Be){if(ft==null)return ft;var En=[],Qn=0;return wt(ft,En,"","",function($n){return Qt.call(Be,$n,Qn++)}),En}function wn(ft){if(ft._status===-1){var Qt=ft._result;Qt=Qt(),Qt.then(function(Be){(ft._status===0||ft._status===-1)&&(ft._status=1,ft._result=Be)},function(Be){(ft._status===0||ft._status===-1)&&(ft._status=2,ft._result=Be)}),ft._status===-1&&(ft._status=0,ft._result=Qt)}if(ft._status===1)return ft._result.default;throw ft._result}var Kn=typeof reportError=="function"?reportError:function(ft){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Qt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ft=="object"&&ft!==null&&typeof ft.message=="string"?String(ft.message):String(ft),error:ft});if(!window.dispatchEvent(Qt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ft);return}console.error(ft)},it={map:Kt,forEach:function(ft,Qt,Be){Kt(ft,function(){Qt.apply(this,arguments)},Be)},count:function(ft){var Qt=0;return Kt(ft,function(){Qt++}),Qt},toArray:function(ft){return Kt(ft,function(Qt){return Qt})||[]},only:function(ft){if(!He(ft))throw Error("React.Children.only expected to receive a single React element child.");return ft}};return Xi.Activity=Y,Xi.Children=it,Xi.Component=at,Xi.Fragment=a,Xi.Profiler=y,Xi.PureComponent=Ge,Xi.StrictMode=u,Xi.Suspense=V,Xi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Oe,Xi.__COMPILER_RUNTIME={__proto__:null,c:function(ft){return Oe.H.useMemoCache(ft)}},Xi.cache=function(ft){return function(){return ft.apply(null,arguments)}},Xi.cacheSignal=function(){return null},Xi.cloneElement=function(ft,Qt,Be){if(ft==null)throw Error("The argument must be a React element, but you passed "+ft+".");var En=Ye({},ft.props),Qn=ft.key;if(Qt!=null)for($n in Qt.key!==void 0&&(Qn=""+Qt.key),Qt)!Re.call(Qt,$n)||$n==="key"||$n==="__self"||$n==="__source"||$n==="ref"&&Qt.ref===void 0||(En[$n]=Qt[$n]);var $n=arguments.length-2;if($n===1)En.children=Be;else if(1<$n){for(var ki=Array($n),er=0;er<$n;er++)ki[er]=arguments[er+2];En.children=ki}return Ve(ft.type,Qn,En)},Xi.createContext=function(ft){return ft={$$typeof:C,_currentValue:ft,_currentValue2:ft,_threadCount:0,Provider:null,Consumer:null},ft.Provider=ft,ft.Consumer={$$typeof:T,_context:ft},ft},Xi.createElement=function(ft,Qt,Be){var En,Qn={},$n=null;if(Qt!=null)for(En in Qt.key!==void 0&&($n=""+Qt.key),Qt)Re.call(Qt,En)&&En!=="key"&&En!=="__self"&&En!=="__source"&&(Qn[En]=Qt[En]);var ki=arguments.length-2;if(ki===1)Qn.children=Be;else if(1<ki){for(var er=Array(ki),qn=0;qn<ki;qn++)er[qn]=arguments[qn+2];Qn.children=er}if(ft&&ft.defaultProps)for(En in ki=ft.defaultProps,ki)Qn[En]===void 0&&(Qn[En]=ki[En]);return Ve(ft,$n,Qn)},Xi.createRef=function(){return{current:null}},Xi.forwardRef=function(ft){return{$$typeof:s,render:ft}},Xi.isValidElement=He,Xi.lazy=function(ft){return{$$typeof:W,_payload:{_status:-1,_result:ft},_init:wn}},Xi.memo=function(ft,Qt){return{$$typeof:B,type:ft,compare:Qt===void 0?null:Qt}},Xi.startTransition=function(ft){var Qt=Oe.T,Be={};Oe.T=Be;try{var En=ft(),Qn=Oe.S;Qn!==null&&Qn(Be,En),typeof En=="object"&&En!==null&&typeof En.then=="function"&&En.then(St,Kn)}catch($n){Kn($n)}finally{Qt!==null&&Be.types!==null&&(Qt.types=Be.types),Oe.T=Qt}},Xi.unstable_useCacheRefresh=function(){return Oe.H.useCacheRefresh()},Xi.use=function(ft){return Oe.H.use(ft)},Xi.useActionState=function(ft,Qt,Be){return Oe.H.useActionState(ft,Qt,Be)},Xi.useCallback=function(ft,Qt){return Oe.H.useCallback(ft,Qt)},Xi.useContext=function(ft){return Oe.H.useContext(ft)},Xi.useDebugValue=function(){},Xi.useDeferredValue=function(ft,Qt){return Oe.H.useDeferredValue(ft,Qt)},Xi.useEffect=function(ft,Qt){return Oe.H.useEffect(ft,Qt)},Xi.useEffectEvent=function(ft){return Oe.H.useEffectEvent(ft)},Xi.useId=function(){return Oe.H.useId()},Xi.useImperativeHandle=function(ft,Qt,Be){return Oe.H.useImperativeHandle(ft,Qt,Be)},Xi.useInsertionEffect=function(ft,Qt){return Oe.H.useInsertionEffect(ft,Qt)},Xi.useLayoutEffect=function(ft,Qt){return Oe.H.useLayoutEffect(ft,Qt)},Xi.useMemo=function(ft,Qt){return Oe.H.useMemo(ft,Qt)},Xi.useOptimistic=function(ft,Qt){return Oe.H.useOptimistic(ft,Qt)},Xi.useReducer=function(ft,Qt,Be){return Oe.H.useReducer(ft,Qt,Be)},Xi.useRef=function(ft){return Oe.H.useRef(ft)},Xi.useState=function(ft){return Oe.H.useState(ft)},Xi.useSyncExternalStore=function(ft,Qt,Be){return Oe.H.useSyncExternalStore(ft,Qt,Be)},Xi.useTransition=function(){return Oe.H.useTransition()},Xi.version="19.2.3",Xi}var vC;function jE(){return vC||(vC=1,dT.exports=xN()),dT.exports}var Ue=jE();const vN=Uv(Ue);var fT={exports:{}},ov={},pT={exports:{}},mT={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bC;function bN(){return bC||(bC=1,(function(o){function t(wt,Kt){var wn=wt.length;wt.push(Kt);e:for(;0<wn;){var Kn=wn-1>>>1,it=wt[Kn];if(0<y(it,Kt))wt[Kn]=Kt,wt[wn]=it,wn=Kn;else break e}}function a(wt){return wt.length===0?null:wt[0]}function u(wt){if(wt.length===0)return null;var Kt=wt[0],wn=wt.pop();if(wn!==Kt){wt[0]=wn;e:for(var Kn=0,it=wt.length,ft=it>>>1;Kn<ft;){var Qt=2*(Kn+1)-1,Be=wt[Qt],En=Qt+1,Qn=wt[En];if(0>y(Be,wn))En<it&&0>y(Qn,Be)?(wt[Kn]=Qn,wt[En]=wn,Kn=En):(wt[Kn]=Be,wt[Qt]=wn,Kn=Qt);else if(En<it&&0>y(Qn,wn))wt[Kn]=Qn,wt[En]=wn,Kn=En;else break e}}return Kt}function y(wt,Kt){var wn=wt.sortIndex-Kt.sortIndex;return wn!==0?wn:wt.id-Kt.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var T=performance;o.unstable_now=function(){return T.now()}}else{var C=Date,s=C.now();o.unstable_now=function(){return C.now()-s}}var V=[],B=[],W=1,Y=null,ae=3,he=!1,Qe=!1,Ye=!1,Ke=!1,at=typeof setTimeout=="function"?setTimeout:null,nt=typeof clearTimeout=="function"?clearTimeout:null,Ge=typeof setImmediate<"u"?setImmediate:null;function Mt(wt){for(var Kt=a(B);Kt!==null;){if(Kt.callback===null)u(B);else if(Kt.startTime<=wt)u(B),Kt.sortIndex=Kt.expirationTime,t(V,Kt);else break;Kt=a(B)}}function cn(wt){if(Ye=!1,Mt(wt),!Qe)if(a(V)!==null)Qe=!0,St||(St=!0,tt());else{var Kt=a(B);Kt!==null&&dn(cn,Kt.startTime-wt)}}var St=!1,Oe=-1,Re=5,Ve=-1;function Je(){return Ke?!0:!(o.unstable_now()-Ve<Re)}function He(){if(Ke=!1,St){var wt=o.unstable_now();Ve=wt;var Kt=!0;try{e:{Qe=!1,Ye&&(Ye=!1,nt(Oe),Oe=-1),he=!0;var wn=ae;try{t:{for(Mt(wt),Y=a(V);Y!==null&&!(Y.expirationTime>wt&&Je());){var Kn=Y.callback;if(typeof Kn=="function"){Y.callback=null,ae=Y.priorityLevel;var it=Kn(Y.expirationTime<=wt);if(wt=o.unstable_now(),typeof it=="function"){Y.callback=it,Mt(wt),Kt=!0;break t}Y===a(V)&&u(V),Mt(wt)}else u(V);Y=a(V)}if(Y!==null)Kt=!0;else{var ft=a(B);ft!==null&&dn(cn,ft.startTime-wt),Kt=!1}}break e}finally{Y=null,ae=wn,he=!1}Kt=void 0}}finally{Kt?tt():St=!1}}}var tt;if(typeof Ge=="function")tt=function(){Ge(He)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,Ht=ve.port2;ve.port1.onmessage=He,tt=function(){Ht.postMessage(null)}}else tt=function(){at(He,0)};function dn(wt,Kt){Oe=at(function(){wt(o.unstable_now())},Kt)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(wt){wt.callback=null},o.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Re=0<wt?Math.floor(1e3/wt):5},o.unstable_getCurrentPriorityLevel=function(){return ae},o.unstable_next=function(wt){switch(ae){case 1:case 2:case 3:var Kt=3;break;default:Kt=ae}var wn=ae;ae=Kt;try{return wt()}finally{ae=wn}},o.unstable_requestPaint=function(){Ke=!0},o.unstable_runWithPriority=function(wt,Kt){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var wn=ae;ae=wt;try{return Kt()}finally{ae=wn}},o.unstable_scheduleCallback=function(wt,Kt,wn){var Kn=o.unstable_now();switch(typeof wn=="object"&&wn!==null?(wn=wn.delay,wn=typeof wn=="number"&&0<wn?Kn+wn:Kn):wn=Kn,wt){case 1:var it=-1;break;case 2:it=250;break;case 5:it=1073741823;break;case 4:it=1e4;break;default:it=5e3}return it=wn+it,wt={id:W++,callback:Kt,priorityLevel:wt,startTime:wn,expirationTime:it,sortIndex:-1},wn>Kn?(wt.sortIndex=wn,t(B,wt),a(V)===null&&wt===a(B)&&(Ye?(nt(Oe),Oe=-1):Ye=!0,dn(cn,wn-Kn))):(wt.sortIndex=it,t(V,wt),Qe||he||(Qe=!0,St||(St=!0,tt()))),wt},o.unstable_shouldYield=Je,o.unstable_wrapCallback=function(wt){var Kt=ae;return function(){var wn=ae;ae=Kt;try{return wt.apply(this,arguments)}finally{ae=wn}}}})(mT)),mT}var wC;function wN(){return wC||(wC=1,pT.exports=bN()),pT.exports}var gT={exports:{}},Tl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TC;function TN(){if(TC)return Tl;TC=1;var o=jE();function t(V){var B="https://react.dev/errors/"+V;if(1<arguments.length){B+="?args[]="+encodeURIComponent(arguments[1]);for(var W=2;W<arguments.length;W++)B+="&args[]="+encodeURIComponent(arguments[W])}return"Minified React error #"+V+"; visit "+B+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var u={d:{f:a,r:function(){throw Error(t(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},y=Symbol.for("react.portal");function T(V,B,W){var Y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:y,key:Y==null?null:""+Y,children:V,containerInfo:B,implementation:W}}var C=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(V,B){if(V==="font")return"";if(typeof B=="string")return B==="use-credentials"?B:""}return Tl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,Tl.createPortal=function(V,B){var W=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B||B.nodeType!==1&&B.nodeType!==9&&B.nodeType!==11)throw Error(t(299));return T(V,B,null,W)},Tl.flushSync=function(V){var B=C.T,W=u.p;try{if(C.T=null,u.p=2,V)return V()}finally{C.T=B,u.p=W,u.d.f()}},Tl.preconnect=function(V,B){typeof V=="string"&&(B?(B=B.crossOrigin,B=typeof B=="string"?B==="use-credentials"?B:"":void 0):B=null,u.d.C(V,B))},Tl.prefetchDNS=function(V){typeof V=="string"&&u.d.D(V)},Tl.preinit=function(V,B){if(typeof V=="string"&&B&&typeof B.as=="string"){var W=B.as,Y=s(W,B.crossOrigin),ae=typeof B.integrity=="string"?B.integrity:void 0,he=typeof B.fetchPriority=="string"?B.fetchPriority:void 0;W==="style"?u.d.S(V,typeof B.precedence=="string"?B.precedence:void 0,{crossOrigin:Y,integrity:ae,fetchPriority:he}):W==="script"&&u.d.X(V,{crossOrigin:Y,integrity:ae,fetchPriority:he,nonce:typeof B.nonce=="string"?B.nonce:void 0})}},Tl.preinitModule=function(V,B){if(typeof V=="string")if(typeof B=="object"&&B!==null){if(B.as==null||B.as==="script"){var W=s(B.as,B.crossOrigin);u.d.M(V,{crossOrigin:W,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0})}}else B==null&&u.d.M(V)},Tl.preload=function(V,B){if(typeof V=="string"&&typeof B=="object"&&B!==null&&typeof B.as=="string"){var W=B.as,Y=s(W,B.crossOrigin);u.d.L(V,W,{crossOrigin:Y,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0,type:typeof B.type=="string"?B.type:void 0,fetchPriority:typeof B.fetchPriority=="string"?B.fetchPriority:void 0,referrerPolicy:typeof B.referrerPolicy=="string"?B.referrerPolicy:void 0,imageSrcSet:typeof B.imageSrcSet=="string"?B.imageSrcSet:void 0,imageSizes:typeof B.imageSizes=="string"?B.imageSizes:void 0,media:typeof B.media=="string"?B.media:void 0})}},Tl.preloadModule=function(V,B){if(typeof V=="string")if(B){var W=s(B.as,B.crossOrigin);u.d.m(V,{as:typeof B.as=="string"&&B.as!=="script"?B.as:void 0,crossOrigin:W,integrity:typeof B.integrity=="string"?B.integrity:void 0})}else u.d.m(V)},Tl.requestFormReset=function(V){u.d.r(V)},Tl.unstable_batchedUpdates=function(V,B){return V(B)},Tl.useFormState=function(V,B,W){return C.H.useFormState(V,B,W)},Tl.useFormStatus=function(){return C.H.useHostTransitionStatus()},Tl.version="19.2.3",Tl}var EC;function uD(){if(EC)return gT.exports;EC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),gT.exports=TN(),gT.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SC;function EN(){if(SC)return ov;SC=1;var o=wN(),t=jE(),a=uD();function u(h){var g="https://react.dev/errors/"+h;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function T(h){var g=h,w=h;if(h.alternate)for(;g.return;)g=g.return;else{h=g;do g=h,(g.flags&4098)!==0&&(w=g.return),h=g.return;while(h)}return g.tag===3?w:null}function C(h){if(h.tag===13){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function s(h){if(h.tag===31){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function V(h){if(T(h)!==h)throw Error(u(188))}function B(h){var g=h.alternate;if(!g){if(g=T(h),g===null)throw Error(u(188));return g!==h?null:h}for(var w=h,R=g;;){var j=w.return;if(j===null)break;var q=j.alternate;if(q===null){if(R=j.return,R!==null){w=R;continue}break}if(j.child===q.child){for(q=j.child;q;){if(q===w)return V(j),h;if(q===R)return V(j),g;q=q.sibling}throw Error(u(188))}if(w.return!==R.return)w=j,R=q;else{for(var ce=!1,Me=j.child;Me;){if(Me===w){ce=!0,w=j,R=q;break}if(Me===R){ce=!0,R=j,w=q;break}Me=Me.sibling}if(!ce){for(Me=q.child;Me;){if(Me===w){ce=!0,w=q,R=j;break}if(Me===R){ce=!0,R=q,w=j;break}Me=Me.sibling}if(!ce)throw Error(u(189))}}if(w.alternate!==R)throw Error(u(190))}if(w.tag!==3)throw Error(u(188));return w.stateNode.current===w?h:g}function W(h){var g=h.tag;if(g===5||g===26||g===27||g===6)return h;for(h=h.child;h!==null;){if(g=W(h),g!==null)return g;h=h.sibling}return null}var Y=Object.assign,ae=Symbol.for("react.element"),he=Symbol.for("react.transitional.element"),Qe=Symbol.for("react.portal"),Ye=Symbol.for("react.fragment"),Ke=Symbol.for("react.strict_mode"),at=Symbol.for("react.profiler"),nt=Symbol.for("react.consumer"),Ge=Symbol.for("react.context"),Mt=Symbol.for("react.forward_ref"),cn=Symbol.for("react.suspense"),St=Symbol.for("react.suspense_list"),Oe=Symbol.for("react.memo"),Re=Symbol.for("react.lazy"),Ve=Symbol.for("react.activity"),Je=Symbol.for("react.memo_cache_sentinel"),He=Symbol.iterator;function tt(h){return h===null||typeof h!="object"?null:(h=He&&h[He]||h["@@iterator"],typeof h=="function"?h:null)}var ve=Symbol.for("react.client.reference");function Ht(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===ve?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case Ye:return"Fragment";case at:return"Profiler";case Ke:return"StrictMode";case cn:return"Suspense";case St:return"SuspenseList";case Ve:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case Qe:return"Portal";case Ge:return h.displayName||"Context";case nt:return(h._context.displayName||"Context")+".Consumer";case Mt:var g=h.render;return h=h.displayName,h||(h=g.displayName||g.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case Oe:return g=h.displayName||null,g!==null?g:Ht(h.type)||"Memo";case Re:g=h._payload,h=h._init;try{return Ht(h(g))}catch{}}return null}var dn=Array.isArray,wt=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Kt=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wn={pending:!1,data:null,method:null,action:null},Kn=[],it=-1;function ft(h){return{current:h}}function Qt(h){0>it||(h.current=Kn[it],Kn[it]=null,it--)}function Be(h,g){it++,Kn[it]=h.current,h.current=g}var En=ft(null),Qn=ft(null),$n=ft(null),ki=ft(null);function er(h,g){switch(Be($n,g),Be(Qn,h),Be(En,null),g.nodeType){case 9:case 11:h=(h=g.documentElement)&&(h=h.namespaceURI)?hx(h):0;break;default:if(h=g.tagName,g=g.namespaceURI)g=hx(g),h=j_(g,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}Qt(En),Be(En,h)}function qn(){Qt(En),Qt(Qn),Qt($n)}function Ni(h){h.memoizedState!==null&&Be(ki,h);var g=En.current,w=j_(g,h.type);g!==w&&(Be(Qn,h),Be(En,w))}function Vr(h){Qn.current===h&&(Qt(En),Qt(Qn)),ki.current===h&&(Qt(ki),Rc._currentValue=wn)}var Fa,Cn;function vi(h){if(Fa===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);Fa=g&&g[1]||"",Cn=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Fa+h+Cn}var _r=!1;function Hi(h,g){if(!h||_r)return"";_r=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(g){var hn=function(){throw Error()};if(Object.defineProperty(hn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(hn,[])}catch(Yt){var Ut=Yt}Reflect.construct(h,[],hn)}else{try{hn.call()}catch(Yt){Ut=Yt}h.call(hn.prototype)}}else{try{throw Error()}catch(Yt){Ut=Yt}(hn=h())&&typeof hn.catch=="function"&&hn.catch(function(){})}}catch(Yt){if(Yt&&Ut&&typeof Yt.stack=="string")return[Yt.stack,Ut.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var j=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");j&&j.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=R.DetermineComponentFrameRoot(),ce=q[0],Me=q[1];if(ce&&Me){var ht=ce.split(`
`),Vt=Me.split(`
`);for(j=R=0;R<ht.length&&!ht[R].includes("DetermineComponentFrameRoot");)R++;for(;j<Vt.length&&!Vt[j].includes("DetermineComponentFrameRoot");)j++;if(R===ht.length||j===Vt.length)for(R=ht.length-1,j=Vt.length-1;1<=R&&0<=j&&ht[R]!==Vt[j];)j--;for(;1<=R&&0<=j;R--,j--)if(ht[R]!==Vt[j]){if(R!==1||j!==1)do if(R--,j--,0>j||ht[R]!==Vt[j]){var sn=`
`+ht[R].replace(" at new "," at ");return h.displayName&&sn.includes("<anonymous>")&&(sn=sn.replace("<anonymous>",h.displayName)),sn}while(1<=R&&0<=j);break}}}finally{_r=!1,Error.prepareStackTrace=w}return(w=h?h.displayName||h.name:"")?vi(w):""}function Wr(h,g){switch(h.tag){case 26:case 27:case 5:return vi(h.type);case 16:return vi("Lazy");case 13:return h.child!==g&&g!==null?vi("Suspense Fallback"):vi("Suspense");case 19:return vi("SuspenseList");case 0:case 15:return Hi(h.type,!1);case 11:return Hi(h.type.render,!1);case 1:return Hi(h.type,!0);case 31:return vi("Activity");default:return""}}function tr(h){try{var g="",w=null;do g+=Wr(h,w),w=h,h=h.return;while(h);return g}catch(R){return`
Error generating stack: `+R.message+`
`+R.stack}}var yr=Object.prototype.hasOwnProperty,Xr=o.unstable_scheduleCallback,to=o.unstable_cancelCallback,Rl=o.unstable_shouldYield,rc=o.unstable_requestPaint,jr=o.unstable_now,bs=o.unstable_getCurrentPriorityLevel,en=o.unstable_ImmediatePriority,Tn=o.unstable_UserBlockingPriority,si=o.unstable_NormalPriority,Li=o.unstable_LowPriority,Ii=o.unstable_IdlePriority,Fs=o.log,_s=o.unstable_setDisableYieldValue,ms=null,Pr=null;function mr(h){if(typeof Fs=="function"&&_s(h),Pr&&typeof Pr.setStrictMode=="function")try{Pr.setStrictMode(ms,h)}catch{}}var Fi=Math.clz32?Math.clz32:cl,ia=Math.log,ws=Math.LN2;function cl(h){return h>>>=0,h===0?32:31-(ia(h)/ws|0)|0}var Ia=256,bo=262144,gs=4194304;function Vi(h){var g=h&42;if(g!==0)return g;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return h&261888;case 262144:case 524288:case 1048576:case 2097152:return h&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function Kr(h,g,w){var R=h.pendingLanes;if(R===0)return 0;var j=0,q=h.suspendedLanes,ce=h.pingedLanes;h=h.warmLanes;var Me=R&134217727;return Me!==0?(R=Me&~q,R!==0?j=Vi(R):(ce&=Me,ce!==0?j=Vi(ce):w||(w=Me&~h,w!==0&&(j=Vi(w))))):(Me=R&~q,Me!==0?j=Vi(Me):ce!==0?j=Vi(ce):w||(w=R&~h,w!==0&&(j=Vi(w)))),j===0?0:g!==0&&g!==j&&(g&q)===0&&(q=j&-j,w=g&-g,q>=w||q===32&&(w&4194048)!==0)?g:j}function wo(h,g){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&g)===0}function _u(h,g){switch(h){case 1:case 2:case 4:case 8:case 64:return g+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Va(){var h=gs;return gs<<=1,(gs&62914560)===0&&(gs=4194304),h}function ul(h){for(var g=[],w=0;31>w;w++)g.push(h);return g}function hl(h,g){h.pendingLanes|=g,g!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function Dt(h,g,w,R,j,q){var ce=h.pendingLanes;h.pendingLanes=w,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=w,h.entangledLanes&=w,h.errorRecoveryDisabledLanes&=w,h.shellSuspendCounter=0;var Me=h.entanglements,ht=h.expirationTimes,Vt=h.hiddenUpdates;for(w=ce&~w;0<w;){var sn=31-Fi(w),hn=1<<sn;Me[sn]=0,ht[sn]=-1;var Ut=Vt[sn];if(Ut!==null)for(Vt[sn]=null,sn=0;sn<Ut.length;sn++){var Yt=Ut[sn];Yt!==null&&(Yt.lane&=-536870913)}w&=~hn}R!==0&&no(h,R,0),q!==0&&j===0&&h.tag!==0&&(h.suspendedLanes|=q&~(ce&~g))}function no(h,g,w){h.pendingLanes|=g,h.suspendedLanes&=~g;var R=31-Fi(g);h.entangledLanes|=g,h.entanglements[R]=h.entanglements[R]|1073741824|w&261930}function th(h,g){var w=h.entangledLanes|=g;for(h=h.entanglements;w;){var R=31-Fi(w),j=1<<R;j&g|h[R]&g&&(h[R]|=g),w&=~j}}function Lc(h,g){var w=g&-g;return w=(w&42)!==0?1:oi(w),(w&(h.suspendedLanes|g))!==0?0:w}function oi(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function qe(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function ne(){var h=Kt.p;return h!==0?h:(h=window.event,h===void 0?32:C0(h.type))}function oe(h,g){var w=Kt.p;try{return Kt.p=h,g()}finally{Kt.p=w}}var ye=Math.random().toString(36).slice(2),Pe="__reactFiber$"+ye,xe="__reactProps$"+ye,Fe="__reactContainer$"+ye,st="__reactEvents$"+ye,$e="__reactListeners$"+ye,lt="__reactHandles$"+ye,Pt="__reactResources$"+ye,It="__reactMarker$"+ye;function tn(h){delete h[Pe],delete h[xe],delete h[st],delete h[$e],delete h[lt]}function yn(h){var g=h[Pe];if(g)return g;for(var w=h.parentNode;w;){if(g=w[Fe]||w[Pe]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(h=mx(h);h!==null;){if(w=h[Pe])return w;h=mx(h)}return g}h=w,w=h.parentNode}return null}function bn(h){if(h=h[Pe]||h[Fe]){var g=h.tag;if(g===5||g===6||g===13||g===31||g===26||g===27||g===3)return h}return null}function Ln(h){var g=h.tag;if(g===5||g===26||g===27||g===6)return h.stateNode;throw Error(u(33))}function Vn(h){var g=h[Pt];return g||(g=h[Pt]={hoistableStyles:new Map,hoistableScripts:new Map}),g}function vn(h){h[It]=!0}var kn=new Set,$i={};function xr(h,g){nr(h,g),nr(h+"Capture",g)}function nr(h,g){for($i[h]=g,h=0;h<g.length;h++)kn.add(g[h])}var vr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ir={},ui={};function cr(h){return yr.call(ui,h)?!0:yr.call(ir,h)?!1:vr.test(h)?ui[h]=!0:(ir[h]=!0,!1)}function Oi(h,g,w){if(cr(g))if(w===null)h.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":h.removeAttribute(g);return;case"boolean":var R=g.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){h.removeAttribute(g);return}}h.setAttribute(g,""+w)}}function gi(h,g,w){if(w===null)h.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(g);return}h.setAttribute(g,""+w)}}function Ti(h,g,w,R){if(R===null)h.removeAttribute(w);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(w);return}h.setAttributeNS(g,w,""+R)}}function ur(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function es(h){var g=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function ts(h,g,w){var R=Object.getOwnPropertyDescriptor(h.constructor.prototype,g);if(!h.hasOwnProperty(g)&&typeof R<"u"&&typeof R.get=="function"&&typeof R.set=="function"){var j=R.get,q=R.set;return Object.defineProperty(h,g,{configurable:!0,get:function(){return j.call(this)},set:function(ce){w=""+ce,q.call(this,ce)}}),Object.defineProperty(h,g,{enumerable:R.enumerable}),{getValue:function(){return w},setValue:function(ce){w=""+ce},stopTracking:function(){h._valueTracker=null,delete h[g]}}}}function hr(h){if(!h._valueTracker){var g=es(h)?"checked":"value";h._valueTracker=ts(h,g,""+h[g])}}function Ts(h){if(!h)return!1;var g=h._valueTracker;if(!g)return!0;var w=g.getValue(),R="";return h&&(R=es(h)?h.checked?"true":"false":h.value),h=R,h!==w?(g.setValue(h),!0):!1}function Es(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var pa=/[\n"\\]/g;function ys(h){return h.replace(pa,function(g){return"\\"+g.charCodeAt(0).toString(16)+" "})}function ra(h,g,w,R,j,q,ce,Me){h.name="",ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?h.type=ce:h.removeAttribute("type"),g!=null?ce==="number"?(g===0&&h.value===""||h.value!=g)&&(h.value=""+ur(g)):h.value!==""+ur(g)&&(h.value=""+ur(g)):ce!=="submit"&&ce!=="reset"||h.removeAttribute("value"),g!=null?$o(h,ce,ur(g)):w!=null?$o(h,ce,ur(w)):R!=null&&h.removeAttribute("value"),j==null&&q!=null&&(h.defaultChecked=!!q),j!=null&&(h.checked=j&&typeof j!="function"&&typeof j!="symbol"),Me!=null&&typeof Me!="function"&&typeof Me!="symbol"&&typeof Me!="boolean"?h.name=""+ur(Me):h.removeAttribute("name")}function sa(h,g,w,R,j,q,ce,Me){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(h.type=q),g!=null||w!=null){if(!(q!=="submit"&&q!=="reset"||g!=null)){hr(h);return}w=w!=null?""+ur(w):"",g=g!=null?""+ur(g):w,Me||g===h.value||(h.value=g),h.defaultValue=g}R=R??j,R=typeof R!="function"&&typeof R!="symbol"&&!!R,h.checked=Me?h.checked:!!R,h.defaultChecked=!!R,ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"&&(h.name=ce),hr(h)}function $o(h,g,w){g==="number"&&Es(h.ownerDocument)===h||h.defaultValue===""+w||(h.defaultValue=""+w)}function To(h,g,w,R){if(h=h.options,g){g={};for(var j=0;j<w.length;j++)g["$"+w[j]]=!0;for(w=0;w<h.length;w++)j=g.hasOwnProperty("$"+h[w].value),h[w].selected!==j&&(h[w].selected=j),j&&R&&(h[w].defaultSelected=!0)}else{for(w=""+ur(w),g=null,j=0;j<h.length;j++){if(h[j].value===w){h[j].selected=!0,R&&(h[j].defaultSelected=!0);return}g!==null||h[j].disabled||(g=h[j])}g!==null&&(g.selected=!0)}}function ja(h,g,w){if(g!=null&&(g=""+ur(g),g!==h.value&&(h.value=g),w==null)){h.defaultValue!==g&&(h.defaultValue=g);return}h.defaultValue=w!=null?""+ur(w):""}function dl(h,g,w,R){if(g==null){if(R!=null){if(w!=null)throw Error(u(92));if(dn(R)){if(1<R.length)throw Error(u(93));R=R[0]}w=R}w==null&&(w=""),g=w}w=ur(g),h.defaultValue=w,R=h.textContent,R===w&&R!==""&&R!==null&&(h.value=R),hr(h)}function ma(h,g){if(g){var w=h.firstChild;if(w&&w===h.lastChild&&w.nodeType===3){w.nodeValue=g;return}}h.textContent=g}var pf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function nd(h,g,w){var R=g.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?R?h.setProperty(g,""):g==="float"?h.cssFloat="":h[g]="":R?h.setProperty(g,w):typeof w!="number"||w===0||pf.has(g)?g==="float"?h.cssFloat=w:h[g]=(""+w).trim():h[g]=w+"px"}function nh(h,g,w){if(g!=null&&typeof g!="object")throw Error(u(62));if(h=h.style,w!=null){for(var R in w)!w.hasOwnProperty(R)||g!=null&&g.hasOwnProperty(R)||(R.indexOf("--")===0?h.setProperty(R,""):R==="float"?h.cssFloat="":h[R]="");for(var j in g)R=g[j],g.hasOwnProperty(j)&&w[j]!==R&&nd(h,j,R)}else for(var q in g)g.hasOwnProperty(q)&&nd(h,q,g[q])}function yu(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ss=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Xs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Eo(h){return Xs.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}function As(){}var So=null;function Ca(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Zo=null,Ua=null;function Ao(h){var g=bn(h);if(g&&(h=g.stateNode)){var w=h[xe]||null;e:switch(h=g.stateNode,g.type){case"input":if(ra(h,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),g=w.name,w.type==="radio"&&g!=null){for(w=h;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+ys(""+g)+'"][type="radio"]'),g=0;g<w.length;g++){var R=w[g];if(R!==h&&R.form===h.form){var j=R[xe]||null;if(!j)throw Error(u(90));ra(R,j.value,j.defaultValue,j.defaultValue,j.checked,j.defaultChecked,j.type,j.name)}}for(g=0;g<w.length;g++)R=w[g],R.form===h.form&&Ts(R)}break e;case"textarea":ja(h,w.value,w.defaultValue);break e;case"select":g=w.value,g!=null&&To(h,!!w.multiple,g,!1)}}}var Oc=!1;function zc(h,g,w){if(Oc)return h(g,w);Oc=!0;try{var R=h(g);return R}finally{if(Oc=!1,(Zo!==null||Ua!==null)&&(Qi(),Zo&&(g=Zo,h=Ua,Ua=Zo=null,Ao(g),h)))for(g=0;g<h.length;g++)Ao(h[g])}}function fl(h,g){var w=h.stateNode;if(w===null)return null;var R=w[xe]||null;if(R===null)return null;w=R[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(h=h.type,R=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!R;break e;default:h=!1}if(h)return null;if(w&&typeof w!="function")throw Error(u(231,g,typeof w));return w}var hs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ml=!1;if(hs)try{var Er={};Object.defineProperty(Er,"passive",{get:function(){Ml=!0}}),window.addEventListener("test",Er,Er),window.removeEventListener("test",Er,Er)}catch{Ml=!1}var ga=null,Nc=null,ih=null;function rh(){if(ih)return ih;var h,g=Nc,w=g.length,R,j="value"in ga?ga.value:ga.textContent,q=j.length;for(h=0;h<w&&g[h]===j[h];h++);var ce=w-h;for(R=1;R<=ce&&g[w-R]===j[q-R];R++);return ih=j.slice(h,1<R?1-R:void 0)}function hi(h){var g=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&g===13&&(h=13)):h=g,h===10&&(h=13),32<=h||h===13?h:0}function Io(){return!0}function Co(){return!1}function _a(h){function g(w,R,j,q,ce){this._reactName=w,this._targetInst=j,this.type=R,this.nativeEvent=q,this.target=ce,this.currentTarget=null;for(var Me in h)h.hasOwnProperty(Me)&&(w=h[Me],this[Me]=w?w(q):q[Me]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?Io:Co,this.isPropagationStopped=Co,this}return Y(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Io)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Io)},persist:function(){},isPersistent:Io}),g}var sc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ro=_a(sc),io=Y({},sc,{view:0,detail:0}),Bc=_a(io),Dl,id,ro,Mo=Y({},io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Is,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==ro&&(ro&&h.type==="mousemove"?(Dl=h.screenX-ro.screenX,id=h.screenY-ro.screenY):id=Dl=0,ro=h),Dl)},movementY:function(h){return"movementY"in h?h.movementY:id}}),Fc=_a(Mo),xu=Y({},Mo,{dataTransfer:0}),ac=_a(xu),pl=Y({},io,{relatedTarget:0}),Vs=_a(pl),Ga=Y({},sc,{animationName:0,elapsedTime:0,pseudoElement:0}),sh=_a(Ga),ah=Y({},sc,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Ei=_a(ah),rd=Y({},sc,{data:0}),Pl=_a(rd),mf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oc(h){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(h):(h=sd[h])?!!g[h]:!1}function Is(){return oc}var ya=Y({},io,{key:function(h){if(h.key){var g=mf[h.key]||h.key;if(g!=="Unidentified")return g}return h.type==="keypress"?(h=hi(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Rn[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Is,charCode:function(h){return h.type==="keypress"?hi(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?hi(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),xa=_a(ya),gn=Y({},Mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fi=_a(gn),L=Y({},io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Is}),ie=_a(L),de=Y({},sc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ce=_a(de),Ot=Y({},Mo,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Gt=_a(Ot),Sn=Y({},sc,{newState:0,oldState:0}),li=_a(Sn),Ci=[9,13,27,32],kr=hs&&"CompositionEvent"in window,Qr=null;hs&&"documentMode"in document&&(Qr=document.documentMode);var Do=hs&&"TextEvent"in window&&!Qr,Po=hs&&(!kr||Qr&&8<Qr&&11>=Qr),ko=" ",Wo=!1;function lc(h,g){switch(h){case"keyup":return Ci.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ms(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Ys=!1;function so(h,g){switch(h){case"compositionend":return Ms(g);case"keypress":return g.which!==32?null:(Wo=!0,ko);case"textInput":return h=g.data,h===ko&&Wo?null:h;default:return null}}function Wm(h,g){if(Ys)return h==="compositionend"||!kr&&lc(h,g)?(h=rh(),ih=Nc=ga=null,Ys=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Po&&g.locale!=="ko"?null:g.data;default:return null}}var vu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cs(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g==="input"?!!vu[h.type]:g==="textarea"}function kl(h,g,w,R){Zo?Ua?Ua.push(R):Ua=[R]:Zo=R,g=Dg(g,"onChange"),0<g.length&&(w=new Ro("onChange","change",null,w,R),h.push({event:w,listeners:g}))}var Xo=null,ns=null;function bu(h){Cg(h,0)}function zn(h){var g=Ln(h);if(Ts(g))return h}function mn(h,g){if(h==="change")return g}var oh=!1;if(hs){var On;if(hs){var ad="oninput"in document;if(!ad){var od=document.createElement("div");od.setAttribute("oninput","return;"),ad=typeof od.oninput=="function"}On=ad}else On=!1;oh=On&&(!document.documentMode||9<document.documentMode)}function Mn(){Xo&&(Xo.detachEvent("onpropertychange",Sp),ns=Xo=null)}function Sp(h){if(h.propertyName==="value"&&zn(ns)){var g=[];kl(g,ns,h,Ca(h)),zc(bu,g)}}function Xm(h,g,w){h==="focusin"?(Mn(),Xo=g,ns=w,Xo.attachEvent("onpropertychange",Sp)):h==="focusout"&&Mn()}function cc(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return zn(ns)}function x_(h,g){if(h==="click")return zn(g)}function ld(h,g){if(h==="input"||h==="change")return zn(g)}function ao(h,g){return h===g&&(h!==0||1/h===1/g)||h!==h&&g!==g}var oo=typeof Object.is=="function"?Object.is:ao;function Lo(h,g){if(oo(h,g))return!0;if(typeof h!="object"||h===null||typeof g!="object"||g===null)return!1;var w=Object.keys(h),R=Object.keys(g);if(w.length!==R.length)return!1;for(R=0;R<w.length;R++){var j=w[R];if(!yr.call(g,j)||!oo(h[j],g[j]))return!1}return!0}function gf(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Yo(h,g){var w=gf(h);h=0;for(var R;w;){if(w.nodeType===3){if(R=h+w.textContent.length,h<=g&&R>=g)return{node:w,offset:g-h};h=R}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=gf(w)}}function Vc(h,g){return h&&g?h===g?!0:h&&h.nodeType===3?!1:g&&g.nodeType===3?Vc(h,g.parentNode):"contains"in h?h.contains(g):h.compareDocumentPosition?!!(h.compareDocumentPosition(g)&16):!1:!1}function v_(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var g=Es(h.document);g instanceof h.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)h=g.contentWindow;else break;g=Es(h.document)}return g}function lh(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g&&(g==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||g==="textarea"||h.contentEditable==="true")}var _f=hs&&"documentMode"in document&&11>=document.documentMode,jc=null,Ap=null,qa=null,Ip=!1;function yf(h,g,w){var R=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Ip||jc==null||jc!==Es(R)||(R=jc,"selectionStart"in R&&lh(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),qa&&Lo(qa,R)||(qa=R,R=Dg(Ap,"onSelect"),0<R.length&&(g=new Ro("onSelect","select",null,g,w),h.push({event:g,listeners:R}),g.target=jc)))}function Ll(h,g){var w={};return w[h.toLowerCase()]=g.toLowerCase(),w["Webkit"+h]="webkit"+g,w["Moz"+h]="moz"+g,w}var Ko={animationend:Ll("Animation","AnimationEnd"),animationiteration:Ll("Animation","AnimationIteration"),animationstart:Ll("Animation","AnimationStart"),transitionrun:Ll("Transition","TransitionRun"),transitionstart:Ll("Transition","TransitionStart"),transitioncancel:Ll("Transition","TransitionCancel"),transitionend:Ll("Transition","TransitionEnd")},Ym={},Km={};hs&&(Km=document.createElement("div").style,"AnimationEvent"in window||(delete Ko.animationend.animation,delete Ko.animationiteration.animation,delete Ko.animationstart.animation),"TransitionEvent"in window||delete Ko.transitionend.transition);function ch(h){if(Ym[h])return Ym[h];if(!Ko[h])return h;var g=Ko[h],w;for(w in g)if(g.hasOwnProperty(w)&&w in Km)return Ym[h]=g[w];return h}var Cp=ch("animationend"),b_=ch("animationiteration"),uc=ch("animationstart"),w_=ch("transitionrun"),T_=ch("transitionstart"),Rp=ch("transitioncancel"),Mp=ch("transitionend"),Uc=new Map,Ha="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ha.push("scrollEnd");function Qo(h,g){Uc.set(h,g),xr(g,[h])}var cd=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},Ra=[],Ol=0,xf=0;function uh(){for(var h=Ol,g=xf=Ol=0;g<h;){var w=Ra[g];Ra[g++]=null;var R=Ra[g];Ra[g++]=null;var j=Ra[g];Ra[g++]=null;var q=Ra[g];if(Ra[g++]=null,R!==null&&j!==null){var ce=R.pending;ce===null?j.next=j:(j.next=ce.next,ce.next=j),R.pending=j}q!==0&&Dp(w,j,q)}}function $a(h,g,w,R){Ra[Ol++]=h,Ra[Ol++]=g,Ra[Ol++]=w,Ra[Ol++]=R,xf|=R,h.lanes|=R,h=h.alternate,h!==null&&(h.lanes|=R)}function hh(h,g,w,R){return $a(h,g,w,R),ud(h)}function jt(h,g){return $a(h,null,null,g),ud(h)}function Dp(h,g,w){h.lanes|=w;var R=h.alternate;R!==null&&(R.lanes|=w);for(var j=!1,q=h.return;q!==null;)q.childLanes|=w,R=q.alternate,R!==null&&(R.childLanes|=w),q.tag===22&&(h=q.stateNode,h===null||h._visibility&1||(j=!0)),h=q,q=q.return;return h.tag===3?(q=h.stateNode,j&&g!==null&&(j=31-Fi(w),h=q.hiddenUpdates,R=h[j],R===null?h[j]=[g]:R.push(g),g.lane=w|536870912),q):null}function ud(h){if(50<_i)throw _i=0,pr=null,Error(u(185));for(var g=h.return;g!==null;)h=g,g=h.return;return h.tag===3?h.stateNode:null}var hc={};function dc(h,g,w,R){this.tag=h,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(h,g,w,R){return new dc(h,g,w,R)}function Gc(h){return h=h.prototype,!(!h||!h.isReactComponent)}function co(h,g){var w=h.alternate;return w===null?(w=lo(h.tag,g,h.key,h.mode),w.elementType=h.elementType,w.type=h.type,w.stateNode=h.stateNode,w.alternate=h,h.alternate=w):(w.pendingProps=g,w.type=h.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=h.flags&65011712,w.childLanes=h.childLanes,w.lanes=h.lanes,w.child=h.child,w.memoizedProps=h.memoizedProps,w.memoizedState=h.memoizedState,w.updateQueue=h.updateQueue,g=h.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=h.sibling,w.index=h.index,w.ref=h.ref,w.refCleanup=h.refCleanup,w}function qc(h,g){h.flags&=65011714;var w=h.alternate;return w===null?(h.childLanes=0,h.lanes=g,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=w.childLanes,h.lanes=w.lanes,h.child=w.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=w.memoizedProps,h.memoizedState=w.memoizedState,h.updateQueue=w.updateQueue,h.type=w.type,g=w.dependencies,h.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),h}function dh(h,g,w,R,j,q){var ce=0;if(R=h,typeof h=="function")Gc(h)&&(ce=1);else if(typeof h=="string")ce=w0(h,w,En.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case Ve:return h=lo(31,w,g,j),h.elementType=Ve,h.lanes=q,h;case Ye:return wu(w.children,j,q,g);case Ke:ce=8,j|=24;break;case at:return h=lo(12,w,g,j|2),h.elementType=at,h.lanes=q,h;case cn:return h=lo(13,w,g,j),h.elementType=cn,h.lanes=q,h;case St:return h=lo(19,w,g,j),h.elementType=St,h.lanes=q,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Ge:ce=10;break e;case nt:ce=9;break e;case Mt:ce=11;break e;case Oe:ce=14;break e;case Re:ce=16,R=null;break e}ce=29,w=Error(u(130,h===null?"null":typeof h,"")),R=null}return g=lo(ce,w,g,j),g.elementType=h,g.type=R,g.lanes=q,g}function wu(h,g,w,R){return h=lo(7,h,R,g),h.lanes=w,h}function hd(h,g,w){return h=lo(6,h,null,g),h.lanes=w,h}function E_(h){var g=lo(18,null,null,0);return g.stateNode=h,g}function Pp(h,g,w){return g=lo(4,h.children!==null?h.children:[],h.key,g),g.lanes=w,g.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},g}var kp=new WeakMap;function aa(h,g){if(typeof h=="object"&&h!==null){var w=kp.get(h);return w!==void 0?w:(g={value:h,source:g,stack:tr(g)},kp.set(h,g),g)}return{value:h,source:g,stack:tr(g)}}var ai=[],dd=0,Lp=null,vf=0,Oo=[],ml=0,qi=null,fc=1,zl="";function Nl(h,g){ai[dd++]=vf,ai[dd++]=Lp,Lp=h,vf=g}function bf(h,g,w){Oo[ml++]=fc,Oo[ml++]=zl,Oo[ml++]=qi,qi=h;var R=fc;h=zl;var j=32-Fi(R)-1;R&=~(1<<j),w+=1;var q=32-Fi(g)+j;if(30<q){var ce=j-j%5;q=(R&(1<<ce)-1).toString(32),R>>=ce,j-=ce,fc=1<<32-Fi(g)+j|w<<j|R,zl=q+h}else fc=1<<q|w<<j|R,zl=h}function wf(h){h.return!==null&&(Nl(h,1),bf(h,1,0))}function Hc(h){for(;h===Lp;)Lp=ai[--dd],ai[dd]=null,vf=ai[--dd],ai[dd]=null;for(;h===qi;)qi=Oo[--ml],Oo[ml]=null,zl=Oo[--ml],Oo[ml]=null,fc=Oo[--ml],Oo[ml]=null}function fh(h,g){Oo[ml++]=fc,Oo[ml++]=zl,Oo[ml++]=qi,fc=g.id,zl=g.overflow,qi=h}var js=null,Ur=null,dr=!1,pc=null,Jo=!1,Tu=Error(u(519));function Bl(h){var g=Error(u(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw fd(aa(g,h)),Tu}function Tf(h){var g=h.stateNode,w=h.type,R=h.memoizedProps;switch(g[Pe]=h,g[xe]=R,w){case"dialog":or("cancel",g),or("close",g);break;case"iframe":case"object":case"embed":or("load",g);break;case"video":case"audio":for(w=0;w<qd.length;w++)or(qd[w],g);break;case"source":or("error",g);break;case"img":case"image":case"link":or("error",g),or("load",g);break;case"details":or("toggle",g);break;case"input":or("invalid",g),sa(g,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0);break;case"select":or("invalid",g);break;case"textarea":or("invalid",g),dl(g,R.value,R.defaultValue,R.children)}w=R.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||g.textContent===""+w||R.suppressHydrationWarning===!0||f0(g.textContent,w)?(R.popover!=null&&(or("beforetoggle",g),or("toggle",g)),R.onScroll!=null&&or("scroll",g),R.onScrollEnd!=null&&or("scrollend",g),R.onClick!=null&&(g.onclick=As),g=!0):g=!1,g||Bl(h,!0)}function Op(h){for(js=h.return;js;)switch(js.tag){case 5:case 31:case 13:Jo=!1;return;case 27:case 3:Jo=!0;return;default:js=js.return}}function $c(h){if(h!==js)return!1;if(!dr)return Op(h),dr=!0,!1;var g=h.tag,w;if((w=g!==3&&g!==27)&&((w=g===5)&&(w=h.type,w=!(w!=="form"&&w!=="button")||Gu(h.type,h.memoizedProps)),w=!w),w&&Ur&&Bl(h),Op(h),g===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(317));Ur=x0(h)}else if(g===31){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(317));Ur=x0(h)}else g===27?(g=Ur,Ql(h.type)?(h=kg,kg=null,Ur=h):Ur=g):Ur=js?Ic(h.stateNode.nextSibling):null;return!0}function Fl(){Ur=js=null,dr=!1}function zp(){var h=pc;return h!==null&&(Zt===null?Zt=h:Zt.push.apply(Zt,h),pc=null),h}function fd(h){pc===null?pc=[h]:pc.push(h)}var Np=ft(null),gl=null,mc=null;function Eu(h,g,w){Be(Np,g._currentValue),g._currentValue=w}function Zc(h){h._currentValue=Np.current,Qt(Np)}function Qm(h,g,w){for(;h!==null;){var R=h.alternate;if((h.childLanes&g)!==g?(h.childLanes|=g,R!==null&&(R.childLanes|=g)):R!==null&&(R.childLanes&g)!==g&&(R.childLanes|=g),h===w)break;h=h.return}}function Ef(h,g,w,R){var j=h.child;for(j!==null&&(j.return=h);j!==null;){var q=j.dependencies;if(q!==null){var ce=j.child;q=q.firstContext;e:for(;q!==null;){var Me=q;q=j;for(var ht=0;ht<g.length;ht++)if(Me.context===g[ht]){q.lanes|=w,Me=q.alternate,Me!==null&&(Me.lanes|=w),Qm(q.return,w,h),R||(ce=null);break e}q=Me.next}}else if(j.tag===18){if(ce=j.return,ce===null)throw Error(u(341));ce.lanes|=w,q=ce.alternate,q!==null&&(q.lanes|=w),Qm(ce,w,h),ce=null}else ce=j.child;if(ce!==null)ce.return=j;else for(ce=j;ce!==null;){if(ce===h){ce=null;break}if(j=ce.sibling,j!==null){j.return=ce.return,ce=j;break}ce=ce.return}j=ce}}function Su(h,g,w,R){h=null;for(var j=g,q=!1;j!==null;){if(!q){if((j.flags&524288)!==0)q=!0;else if((j.flags&262144)!==0)break}if(j.tag===10){var ce=j.alternate;if(ce===null)throw Error(u(387));if(ce=ce.memoizedProps,ce!==null){var Me=j.type;oo(j.pendingProps.value,ce.value)||(h!==null?h.push(Me):h=[Me])}}else if(j===ki.current){if(ce=j.alternate,ce===null)throw Error(u(387));ce.memoizedState.memoizedState!==j.memoizedState.memoizedState&&(h!==null?h.push(Rc):h=[Rc])}j=j.return}h!==null&&Ef(g,h,w,R),g.flags|=262144}function pd(h){for(h=h.firstContext;h!==null;){if(!oo(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function Wc(h){gl=h,mc=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function va(h){return Sf(gl,h)}function ph(h,g){return gl===null&&Wc(h),Sf(h,g)}function Sf(h,g){var w=g._currentValue;if(g={context:g,memoizedValue:w,next:null},mc===null){if(h===null)throw Error(u(308));mc=g,h.dependencies={lanes:0,firstContext:g},h.flags|=524288}else mc=mc.next=g;return w}var md=typeof AbortController<"u"?AbortController:function(){var h=[],g=this.signal={aborted:!1,addEventListener:function(w,R){h.push(R)}};this.abort=function(){g.aborted=!0,h.forEach(function(w){return w()})}},Af=o.unstable_scheduleCallback,S_=o.unstable_NormalPriority,Sr={$$typeof:Ge,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function gd(){return{controller:new md,data:new Map,refCount:0}}function Xc(h){h.refCount--,h.refCount===0&&Af(S_,function(){h.controller.abort()})}var el=null,_d=0,Yc=0,Au=null;function yd(h,g){if(el===null){var w=el=[];_d=0,Yc=Ag(),Au={status:"pending",value:void 0,then:function(R){w.push(R)}}}return _d++,g.then(xd,xd),g}function xd(){if(--_d===0&&el!==null){Au!==null&&(Au.status="fulfilled");var h=el;el=null,Yc=0,Au=null;for(var g=0;g<h.length;g++)(0,h[g])()}}function If(h,g){var w=[],R={status:"pending",value:null,reason:null,then:function(j){w.push(j)}};return h.then(function(){R.status="fulfilled",R.value=g;for(var j=0;j<w.length;j++)(0,w[j])(g)},function(j){for(R.status="rejected",R.reason=j,j=0;j<w.length;j++)(0,w[j])(void 0)}),R}var Cf=wt.S;wt.S=function(h,g){Dn=jr(),typeof g=="object"&&g!==null&&typeof g.then=="function"&&yd(h,g),Cf!==null&&Cf(h,g)};var Kc=ft(null);function Rf(){var h=Kc.current;return h!==null?h:je.pooledCache}function vd(h,g){g===null?Be(Kc,Kc.current):Be(Kc,g.pool)}function mh(){var h=Rf();return h===null?null:{parent:Sr._currentValue,pool:h}}var bd=Error(u(460)),Jm=Error(u(474)),Mf=Error(u(542)),Df={then:function(){}};function Pf(h){return h=h.status,h==="fulfilled"||h==="rejected"}function A_(h,g,w){switch(w=h[w],w===void 0?h.push(g):w!==g&&(g.then(As,As),g=w),g.status){case"fulfilled":return g.value;case"rejected":throw h=g.reason,Iu(h),h;default:if(typeof g.status=="string")g.then(As,As);else{if(h=je,h!==null&&100<h.shellSuspendCounter)throw Error(u(482));h=g,h.status="pending",h.then(function(R){if(g.status==="pending"){var j=g;j.status="fulfilled",j.value=R}},function(R){if(g.status==="pending"){var j=g;j.status="rejected",j.reason=R}})}switch(g.status){case"fulfilled":return g.value;case"rejected":throw h=g.reason,Iu(h),h}throw Qc=g,bd}}function gc(h){try{var g=h._init;return g(h._payload)}catch(w){throw w!==null&&typeof w=="object"&&typeof w.then=="function"?(Qc=w,bd):w}}var Qc=null;function eg(){if(Qc===null)throw Error(u(459));var h=Qc;return Qc=null,h}function Iu(h){if(h===bd||h===Mf)throw Error(u(483))}var Cu=null,wd=0;function kf(h){var g=wd;return wd+=1,Cu===null&&(Cu=[]),A_(Cu,h,g)}function gh(h,g){g=g.props.ref,h.ref=g!==void 0?g:null}function Vl(h,g){throw g.$$typeof===ae?Error(u(525)):(h=Object.prototype.toString.call(g),Error(u(31,h==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":h)))}function Ru(h){function g(Rt,gt){if(h){var Bt=Rt.deletions;Bt===null?(Rt.deletions=[gt],Rt.flags|=16):Bt.push(gt)}}function w(Rt,gt){if(!h)return null;for(;gt!==null;)g(Rt,gt),gt=gt.sibling;return null}function R(Rt){for(var gt=new Map;Rt!==null;)Rt.key!==null?gt.set(Rt.key,Rt):gt.set(Rt.index,Rt),Rt=Rt.sibling;return gt}function j(Rt,gt){return Rt=co(Rt,gt),Rt.index=0,Rt.sibling=null,Rt}function q(Rt,gt,Bt){return Rt.index=Bt,h?(Bt=Rt.alternate,Bt!==null?(Bt=Bt.index,Bt<gt?(Rt.flags|=67108866,gt):Bt):(Rt.flags|=67108866,gt)):(Rt.flags|=1048576,gt)}function ce(Rt){return h&&Rt.alternate===null&&(Rt.flags|=67108866),Rt}function Me(Rt,gt,Bt,ln){return gt===null||gt.tag!==6?(gt=hd(Bt,Rt.mode,ln),gt.return=Rt,gt):(gt=j(gt,Bt),gt.return=Rt,gt)}function ht(Rt,gt,Bt,ln){var mi=Bt.type;return mi===Ye?sn(Rt,gt,Bt.props.children,ln,Bt.key):gt!==null&&(gt.elementType===mi||typeof mi=="object"&&mi!==null&&mi.$$typeof===Re&&gc(mi)===gt.type)?(gt=j(gt,Bt.props),gh(gt,Bt),gt.return=Rt,gt):(gt=dh(Bt.type,Bt.key,Bt.props,null,Rt.mode,ln),gh(gt,Bt),gt.return=Rt,gt)}function Vt(Rt,gt,Bt,ln){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==Bt.containerInfo||gt.stateNode.implementation!==Bt.implementation?(gt=Pp(Bt,Rt.mode,ln),gt.return=Rt,gt):(gt=j(gt,Bt.children||[]),gt.return=Rt,gt)}function sn(Rt,gt,Bt,ln,mi){return gt===null||gt.tag!==7?(gt=wu(Bt,Rt.mode,ln,mi),gt.return=Rt,gt):(gt=j(gt,Bt),gt.return=Rt,gt)}function hn(Rt,gt,Bt){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return gt=hd(""+gt,Rt.mode,Bt),gt.return=Rt,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case he:return Bt=dh(gt.type,gt.key,gt.props,null,Rt.mode,Bt),gh(Bt,gt),Bt.return=Rt,Bt;case Qe:return gt=Pp(gt,Rt.mode,Bt),gt.return=Rt,gt;case Re:return gt=gc(gt),hn(Rt,gt,Bt)}if(dn(gt)||tt(gt))return gt=wu(gt,Rt.mode,Bt,null),gt.return=Rt,gt;if(typeof gt.then=="function")return hn(Rt,kf(gt),Bt);if(gt.$$typeof===Ge)return hn(Rt,ph(Rt,gt),Bt);Vl(Rt,gt)}return null}function Ut(Rt,gt,Bt,ln){var mi=gt!==null?gt.key:null;if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number"||typeof Bt=="bigint")return mi!==null?null:Me(Rt,gt,""+Bt,ln);if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case he:return Bt.key===mi?ht(Rt,gt,Bt,ln):null;case Qe:return Bt.key===mi?Vt(Rt,gt,Bt,ln):null;case Re:return Bt=gc(Bt),Ut(Rt,gt,Bt,ln)}if(dn(Bt)||tt(Bt))return mi!==null?null:sn(Rt,gt,Bt,ln,null);if(typeof Bt.then=="function")return Ut(Rt,gt,kf(Bt),ln);if(Bt.$$typeof===Ge)return Ut(Rt,gt,ph(Rt,Bt),ln);Vl(Rt,Bt)}return null}function Yt(Rt,gt,Bt,ln,mi){if(typeof ln=="string"&&ln!==""||typeof ln=="number"||typeof ln=="bigint")return Rt=Rt.get(Bt)||null,Me(gt,Rt,""+ln,mi);if(typeof ln=="object"&&ln!==null){switch(ln.$$typeof){case he:return Rt=Rt.get(ln.key===null?Bt:ln.key)||null,ht(gt,Rt,ln,mi);case Qe:return Rt=Rt.get(ln.key===null?Bt:ln.key)||null,Vt(gt,Rt,ln,mi);case Re:return ln=gc(ln),Yt(Rt,gt,Bt,ln,mi)}if(dn(ln)||tt(ln))return Rt=Rt.get(Bt)||null,sn(gt,Rt,ln,mi,null);if(typeof ln.then=="function")return Yt(Rt,gt,Bt,kf(ln),mi);if(ln.$$typeof===Ge)return Yt(Rt,gt,Bt,ph(gt,ln),mi);Vl(gt,ln)}return null}function Wn(Rt,gt,Bt,ln){for(var mi=null,Or=null,ii=gt,Ji=gt=0,gr=null;ii!==null&&Ji<Bt.length;Ji++){ii.index>Ji?(gr=ii,ii=null):gr=ii.sibling;var Cr=Ut(Rt,ii,Bt[Ji],ln);if(Cr===null){ii===null&&(ii=gr);break}h&&ii&&Cr.alternate===null&&g(Rt,ii),gt=q(Cr,gt,Ji),Or===null?mi=Cr:Or.sibling=Cr,Or=Cr,ii=gr}if(Ji===Bt.length)return w(Rt,ii),dr&&Nl(Rt,Ji),mi;if(ii===null){for(;Ji<Bt.length;Ji++)ii=hn(Rt,Bt[Ji],ln),ii!==null&&(gt=q(ii,gt,Ji),Or===null?mi=ii:Or.sibling=ii,Or=ii);return dr&&Nl(Rt,Ji),mi}for(ii=R(ii);Ji<Bt.length;Ji++)gr=Yt(ii,Rt,Ji,Bt[Ji],ln),gr!==null&&(h&&gr.alternate!==null&&ii.delete(gr.key===null?Ji:gr.key),gt=q(gr,gt,Ji),Or===null?mi=gr:Or.sibling=gr,Or=gr);return h&&ii.forEach(function(cu){return g(Rt,cu)}),dr&&Nl(Rt,Ji),mi}function di(Rt,gt,Bt,ln){if(Bt==null)throw Error(u(151));for(var mi=null,Or=null,ii=gt,Ji=gt=0,gr=null,Cr=Bt.next();ii!==null&&!Cr.done;Ji++,Cr=Bt.next()){ii.index>Ji?(gr=ii,ii=null):gr=ii.sibling;var cu=Ut(Rt,ii,Cr.value,ln);if(cu===null){ii===null&&(ii=gr);break}h&&ii&&cu.alternate===null&&g(Rt,ii),gt=q(cu,gt,Ji),Or===null?mi=cu:Or.sibling=cu,Or=cu,ii=gr}if(Cr.done)return w(Rt,ii),dr&&Nl(Rt,Ji),mi;if(ii===null){for(;!Cr.done;Ji++,Cr=Bt.next())Cr=hn(Rt,Cr.value,ln),Cr!==null&&(gt=q(Cr,gt,Ji),Or===null?mi=Cr:Or.sibling=Cr,Or=Cr);return dr&&Nl(Rt,Ji),mi}for(ii=R(ii);!Cr.done;Ji++,Cr=Bt.next())Cr=Yt(ii,Rt,Ji,Cr.value,ln),Cr!==null&&(h&&Cr.alternate!==null&&ii.delete(Cr.key===null?Ji:Cr.key),gt=q(Cr,gt,Ji),Or===null?mi=Cr:Or.sibling=Cr,Or=Cr);return h&&ii.forEach(function(O0){return g(Rt,O0)}),dr&&Nl(Rt,Ji),mi}function $r(Rt,gt,Bt,ln){if(typeof Bt=="object"&&Bt!==null&&Bt.type===Ye&&Bt.key===null&&(Bt=Bt.props.children),typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case he:e:{for(var mi=Bt.key;gt!==null;){if(gt.key===mi){if(mi=Bt.type,mi===Ye){if(gt.tag===7){w(Rt,gt.sibling),ln=j(gt,Bt.props.children),ln.return=Rt,Rt=ln;break e}}else if(gt.elementType===mi||typeof mi=="object"&&mi!==null&&mi.$$typeof===Re&&gc(mi)===gt.type){w(Rt,gt.sibling),ln=j(gt,Bt.props),gh(ln,Bt),ln.return=Rt,Rt=ln;break e}w(Rt,gt);break}else g(Rt,gt);gt=gt.sibling}Bt.type===Ye?(ln=wu(Bt.props.children,Rt.mode,ln,Bt.key),ln.return=Rt,Rt=ln):(ln=dh(Bt.type,Bt.key,Bt.props,null,Rt.mode,ln),gh(ln,Bt),ln.return=Rt,Rt=ln)}return ce(Rt);case Qe:e:{for(mi=Bt.key;gt!==null;){if(gt.key===mi)if(gt.tag===4&&gt.stateNode.containerInfo===Bt.containerInfo&&gt.stateNode.implementation===Bt.implementation){w(Rt,gt.sibling),ln=j(gt,Bt.children||[]),ln.return=Rt,Rt=ln;break e}else{w(Rt,gt);break}else g(Rt,gt);gt=gt.sibling}ln=Pp(Bt,Rt.mode,ln),ln.return=Rt,Rt=ln}return ce(Rt);case Re:return Bt=gc(Bt),$r(Rt,gt,Bt,ln)}if(dn(Bt))return Wn(Rt,gt,Bt,ln);if(tt(Bt)){if(mi=tt(Bt),typeof mi!="function")throw Error(u(150));return Bt=mi.call(Bt),di(Rt,gt,Bt,ln)}if(typeof Bt.then=="function")return $r(Rt,gt,kf(Bt),ln);if(Bt.$$typeof===Ge)return $r(Rt,gt,ph(Rt,Bt),ln);Vl(Rt,Bt)}return typeof Bt=="string"&&Bt!==""||typeof Bt=="number"||typeof Bt=="bigint"?(Bt=""+Bt,gt!==null&&gt.tag===6?(w(Rt,gt.sibling),ln=j(gt,Bt),ln.return=Rt,Rt=ln):(w(Rt,gt),ln=hd(Bt,Rt.mode,ln),ln.return=Rt,Rt=ln),ce(Rt)):w(Rt,gt)}return function(Rt,gt,Bt,ln){try{wd=0;var mi=$r(Rt,gt,Bt,ln);return Cu=null,mi}catch(ii){if(ii===bd||ii===Mf)throw ii;var Or=lo(29,ii,null,Rt.mode);return Or.lanes=ln,Or.return=Rt,Or}finally{}}}var _c=Ru(!0),tg=Ru(!1),uo=!1;function Lf(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Td(h,g){h=h.updateQueue,g.updateQueue===h&&(g.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function yc(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function Jc(h,g,w){var R=h.updateQueue;if(R===null)return null;if(R=R.shared,(ze&2)!==0){var j=R.pending;return j===null?g.next=g:(g.next=j.next,j.next=g),R.pending=g,g=ud(h),Dp(h,null,w),g}return $a(h,R,g,w),ud(h)}function _h(h,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194048)!==0)){var R=g.lanes;R&=h.pendingLanes,w|=R,g.lanes=w,th(h,w)}}function Ed(h,g){var w=h.updateQueue,R=h.alternate;if(R!==null&&(R=R.updateQueue,w===R)){var j=null,q=null;if(w=w.firstBaseUpdate,w!==null){do{var ce={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};q===null?j=q=ce:q=q.next=ce,w=w.next}while(w!==null);q===null?j=q=g:q=q.next=g}else j=q=g;w={baseState:R.baseState,firstBaseUpdate:j,lastBaseUpdate:q,shared:R.shared,callbacks:R.callbacks},h.updateQueue=w;return}h=w.lastBaseUpdate,h===null?w.firstBaseUpdate=g:h.next=g,w.lastBaseUpdate=g}var Bp=!1;function yh(){if(Bp){var h=Au;if(h!==null)throw h}}function eu(h,g,w,R){Bp=!1;var j=h.updateQueue;uo=!1;var q=j.firstBaseUpdate,ce=j.lastBaseUpdate,Me=j.shared.pending;if(Me!==null){j.shared.pending=null;var ht=Me,Vt=ht.next;ht.next=null,ce===null?q=Vt:ce.next=Vt,ce=ht;var sn=h.alternate;sn!==null&&(sn=sn.updateQueue,Me=sn.lastBaseUpdate,Me!==ce&&(Me===null?sn.firstBaseUpdate=Vt:Me.next=Vt,sn.lastBaseUpdate=ht))}if(q!==null){var hn=j.baseState;ce=0,sn=Vt=ht=null,Me=q;do{var Ut=Me.lane&-536870913,Yt=Ut!==Me.lane;if(Yt?(Ze&Ut)===Ut:(R&Ut)===Ut){Ut!==0&&Ut===Yc&&(Bp=!0),sn!==null&&(sn=sn.next={lane:0,tag:Me.tag,payload:Me.payload,callback:null,next:null});e:{var Wn=h,di=Me;Ut=g;var $r=w;switch(di.tag){case 1:if(Wn=di.payload,typeof Wn=="function"){hn=Wn.call($r,hn,Ut);break e}hn=Wn;break e;case 3:Wn.flags=Wn.flags&-65537|128;case 0:if(Wn=di.payload,Ut=typeof Wn=="function"?Wn.call($r,hn,Ut):Wn,Ut==null)break e;hn=Y({},hn,Ut);break e;case 2:uo=!0}}Ut=Me.callback,Ut!==null&&(h.flags|=64,Yt&&(h.flags|=8192),Yt=j.callbacks,Yt===null?j.callbacks=[Ut]:Yt.push(Ut))}else Yt={lane:Ut,tag:Me.tag,payload:Me.payload,callback:Me.callback,next:null},sn===null?(Vt=sn=Yt,ht=hn):sn=sn.next=Yt,ce|=Ut;if(Me=Me.next,Me===null){if(Me=j.shared.pending,Me===null)break;Yt=Me,Me=Yt.next,Yt.next=null,j.lastBaseUpdate=Yt,j.shared.pending=null}}while(!0);sn===null&&(ht=hn),j.baseState=ht,j.firstBaseUpdate=Vt,j.lastBaseUpdate=sn,q===null&&(j.shared.lanes=0),kt|=ce,h.lanes=ce,h.memoizedState=hn}}function xh(h,g){if(typeof h!="function")throw Error(u(191,h));h.call(g)}function I_(h,g){var w=h.callbacks;if(w!==null)for(h.callbacks=null,h=0;h<w.length;h++)xh(w[h],g)}var vh=ft(null),Fp=ft(0);function Of(h,g){h=rt,Be(Fp,h),Be(vh,g),rt=h|g.baseLanes}function bh(){Be(Fp,rt),Be(vh,vh.current)}function xc(){rt=Fp.current,Qt(vh),Qt(Fp)}var Ma=ft(null),ba=null;function jl(h){var g=h.alternate;Be(Us,Us.current&1),Be(Ma,h),ba===null&&(g===null||vh.current!==null||g.memoizedState!==null)&&(ba=h)}function wh(h){Be(Us,Us.current),Be(Ma,h),ba===null&&(ba=h)}function zf(h){h.tag===22?(Be(Us,Us.current),Be(Ma,h),ba===null&&(ba=h)):Da()}function Da(){Be(Us,Us.current),Be(Ma,Ma.current)}function zo(h){Qt(Ma),ba===h&&(ba=null),Qt(Us)}var Us=ft(0);function vc(h){for(var g=h;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||fx(w)||px(w)))return g}else if(g.tag===19&&(g.memoizedProps.revealOrder==="forwards"||g.memoizedProps.revealOrder==="backwards"||g.memoizedProps.revealOrder==="unstable_legacy-backwards"||g.memoizedProps.revealOrder==="together")){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var _l=0,Ft=null,Gr=null,qr=null,yl=!1,Th=!1,Mu=!1,Eh=0,Du=0,Pu=null,ng=0;function is(){throw Error(u(321))}function ku(h,g){if(g===null)return!1;for(var w=0;w<g.length&&w<h.length;w++)if(!oo(h[w],g[w]))return!1;return!0}function Sh(h,g,w,R,j,q){return _l=q,Ft=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,wt.H=h===null||h.memoizedState===null?Qp:Zf,Mu=!1,q=w(R,j),Mu=!1,Th&&(q=ig(g,w,R,j)),Ul(h),q}function Ul(h){wt.H=ql;var g=Gr!==null&&Gr.next!==null;if(_l=0,qr=Gr=Ft=null,yl=!1,Du=0,Pu=null,g)throw Error(u(300));h===null||Ds||(h=h.dependencies,h!==null&&pd(h)&&(Ds=!0))}function ig(h,g,w,R){Ft=h;var j=0;do{if(Th&&(Pu=null),Du=0,Th=!1,25<=j)throw Error(u(301));if(j+=1,qr=Gr=null,h.updateQueue!=null){var q=h.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}wt.H=mg,q=g(w,R)}while(Th);return q}function C_(){var h=wt.H,g=h.useState()[0];return g=typeof g.then=="function"?Lu(g):g,h=h.useState()[0],(Gr!==null?Gr.memoizedState:null)!==h&&(Ft.flags|=1024),g}function Vp(){var h=Eh!==0;return Eh=0,h}function jp(h,g,w){g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~w}function Nf(h){if(yl){for(h=h.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}yl=!1}_l=0,qr=Gr=Ft=null,Th=!1,Du=Eh=0,Pu=null}function Ks(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qr===null?Ft.memoizedState=qr=h:qr=qr.next=h,qr}function xs(){if(Gr===null){var h=Ft.alternate;h=h!==null?h.memoizedState:null}else h=Gr.next;var g=qr===null?Ft.memoizedState:qr.next;if(g!==null)qr=g,Gr=h;else{if(h===null)throw Ft.alternate===null?Error(u(467)):Error(u(310));Gr=h,h={memoizedState:Gr.memoizedState,baseState:Gr.baseState,baseQueue:Gr.baseQueue,queue:Gr.queue,next:null},qr===null?Ft.memoizedState=qr=h:qr=qr.next=h}return qr}function Sd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Lu(h){var g=Du;return Du+=1,Pu===null&&(Pu=[]),h=A_(Pu,h,g),g=Ft,(qr===null?g.memoizedState:qr.next)===null&&(g=g.alternate,wt.H=g===null||g.memoizedState===null?Qp:Zf),h}function Bf(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return Lu(h);if(h.$$typeof===Ge)return va(h)}throw Error(u(438,String(h)))}function Up(h){var g=null,w=Ft.updateQueue;if(w!==null&&(g=w.memoCache),g==null){var R=Ft.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(g={data:R.data.map(function(j){return j.slice()}),index:0})))}if(g==null&&(g={data:[],index:0}),w===null&&(w=Sd(),Ft.updateQueue=w),w.memoCache=g,w=g.data[g.index],w===void 0)for(w=g.data[g.index]=Array(h),R=0;R<h;R++)w[R]=Je;return g.index++,w}function Gl(h,g){return typeof g=="function"?g(h):g}function Ff(h){var g=xs();return Vf(g,Gr,h)}function Vf(h,g,w){var R=h.queue;if(R===null)throw Error(u(311));R.lastRenderedReducer=w;var j=h.baseQueue,q=R.pending;if(q!==null){if(j!==null){var ce=j.next;j.next=q.next,q.next=ce}g.baseQueue=j=q,R.pending=null}if(q=h.baseState,j===null)h.memoizedState=q;else{g=j.next;var Me=ce=null,ht=null,Vt=g,sn=!1;do{var hn=Vt.lane&-536870913;if(hn!==Vt.lane?(Ze&hn)===hn:(_l&hn)===hn){var Ut=Vt.revertLane;if(Ut===0)ht!==null&&(ht=ht.next={lane:0,revertLane:0,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),hn===Yc&&(sn=!0);else if((_l&Ut)===Ut){Vt=Vt.next,Ut===Yc&&(sn=!0);continue}else hn={lane:0,revertLane:Vt.revertLane,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},ht===null?(Me=ht=hn,ce=q):ht=ht.next=hn,Ft.lanes|=Ut,kt|=Ut;hn=Vt.action,Mu&&w(q,hn),q=Vt.hasEagerState?Vt.eagerState:w(q,hn)}else Ut={lane:hn,revertLane:Vt.revertLane,gesture:Vt.gesture,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},ht===null?(Me=ht=Ut,ce=q):ht=ht.next=Ut,Ft.lanes|=hn,kt|=hn;Vt=Vt.next}while(Vt!==null&&Vt!==g);if(ht===null?ce=q:ht.next=Me,!oo(q,h.memoizedState)&&(Ds=!0,sn&&(w=Au,w!==null)))throw w;h.memoizedState=q,h.baseState=ce,h.baseQueue=ht,R.lastRenderedState=q}return j===null&&(R.lanes=0),[h.memoizedState,R.dispatch]}function Gp(h){var g=xs(),w=g.queue;if(w===null)throw Error(u(311));w.lastRenderedReducer=h;var R=w.dispatch,j=w.pending,q=g.memoizedState;if(j!==null){w.pending=null;var ce=j=j.next;do q=h(q,ce.action),ce=ce.next;while(ce!==j);oo(q,g.memoizedState)||(Ds=!0),g.memoizedState=q,g.baseQueue===null&&(g.baseState=q),w.lastRenderedState=q}return[q,R]}function qp(h,g,w){var R=Ft,j=xs(),q=dr;if(q){if(w===void 0)throw Error(u(407));w=w()}else w=g();var ce=!oo((Gr||j).memoizedState,w);if(ce&&(j.memoizedState=w,Ds=!0),j=j.queue,Ah(R_.bind(null,R,j,h),[h]),j.getSnapshot!==g||ce||qr!==null&&qr.memoizedState.tag&1){if(R.flags|=2048,Ou(9,{destroy:void 0},$p.bind(null,R,j,w,g),null),je===null)throw Error(u(349));q||(_l&127)!==0||Hp(R,g,w)}return w}function Hp(h,g,w){h.flags|=16384,h={getSnapshot:g,value:w},g=Ft.updateQueue,g===null?(g=Sd(),Ft.updateQueue=g,g.stores=[h]):(w=g.stores,w===null?g.stores=[h]:w.push(h))}function $p(h,g,w,R){g.value=w,g.getSnapshot=R,M_(g)&&rg(h)}function R_(h,g,w){return w(function(){M_(g)&&rg(h)})}function M_(h){var g=h.getSnapshot;h=h.value;try{var w=g();return!oo(h,w)}catch{return!0}}function rg(h){var g=jt(h,2);g!==null&&Fn(g,h,2)}function bc(h){var g=Ks();if(typeof h=="function"){var w=h;if(h=w(),Mu){mr(!0);try{w()}finally{mr(!1)}}}return g.memoizedState=g.baseState=h,g.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:h},g}function sg(h,g,w,R){return h.baseState=w,Vf(h,Gr,typeof R=="function"?R:Gl)}function ag(h,g,w,R,j){if(Hf(h))throw Error(u(485));if(h=g.action,h!==null){var q={payload:j,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ce){q.listeners.push(ce)}};wt.T!==null?w(!0):q.isTransition=!1,R(q),w=g.pending,w===null?(q.next=g.pending=q,jf(g,q)):(q.next=w.next,g.pending=w.next=q)}}function jf(h,g){var w=g.action,R=g.payload,j=h.state;if(g.isTransition){var q=wt.T,ce={};wt.T=ce;try{var Me=w(j,R),ht=wt.S;ht!==null&&ht(ce,Me),og(h,g,Me)}catch(Vt){wc(h,g,Vt)}finally{q!==null&&ce.types!==null&&(q.types=ce.types),wt.T=q}}else try{q=w(j,R),og(h,g,q)}catch(Vt){wc(h,g,Vt)}}function og(h,g,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(R){D_(h,g,R)},function(R){return wc(h,g,R)}):D_(h,g,w)}function D_(h,g,w){g.status="fulfilled",g.value=w,Za(g),h.state=w,g=h.pending,g!==null&&(w=g.next,w===g?h.pending=null:(w=w.next,g.next=w,jf(h,w)))}function wc(h,g,w){var R=h.pending;if(h.pending=null,R!==null){R=R.next;do g.status="rejected",g.reason=w,Za(g),g=g.next;while(g!==R)}h.action=null}function Za(h){h=h.listeners;for(var g=0;g<h.length;g++)(0,h[g])()}function tu(h,g){return g}function Pa(h,g){if(dr){var w=je.formState;if(w!==null){e:{var R=Ft;if(dr){if(Ur){t:{for(var j=Ur,q=Jo;j.nodeType!==8;){if(!q){j=null;break t}if(j=Ic(j.nextSibling),j===null){j=null;break t}}q=j.data,j=q==="F!"||q==="F"?j:null}if(j){Ur=Ic(j.nextSibling),R=j.data==="F!";break e}}Bl(R)}R=!1}R&&(g=w[0])}}return w=Ks(),w.memoizedState=w.baseState=g,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tu,lastRenderedState:g},w.queue=R,w=Cd.bind(null,Ft,R),R.dispatch=w,R=bc(!1),q=qf.bind(null,Ft,!1,R.queue),R=Ks(),j={state:g,dispatch:null,action:h,pending:null},R.queue=j,w=ag.bind(null,Ft,j,q,w),j.dispatch=w,R.memoizedState=h,[g,w,!1]}function nu(h){var g=xs();return lg(g,Gr,h)}function lg(h,g,w){if(g=Vf(h,g,tu)[0],h=Ff(Gl)[0],typeof g=="object"&&g!==null&&typeof g.then=="function")try{var R=Lu(g)}catch(ce){throw ce===bd?Mf:ce}else R=g;g=xs();var j=g.queue,q=j.dispatch;return w!==g.memoizedState&&(Ft.flags|=2048,Ou(9,{destroy:void 0},cg.bind(null,j,w),null)),[R,q,h]}function cg(h,g){h.action=g}function Zp(h){var g=xs(),w=Gr;if(w!==null)return lg(g,w,h);xs(),g=g.memoizedState,w=xs();var R=w.queue.dispatch;return w.memoizedState=h,[g,R,!1]}function Ou(h,g,w,R){return h={tag:h,create:w,deps:R,inst:g,next:null},g=Ft.updateQueue,g===null&&(g=Sd(),Ft.updateQueue=g),w=g.lastEffect,w===null?g.lastEffect=h.next=h:(R=w.next,w.next=h,h.next=R,g.lastEffect=h),h}function Wp(){return xs().memoizedState}function No(h,g,w,R){var j=Ks();Ft.flags|=h,j.memoizedState=Ou(1|g,{destroy:void 0},w,R===void 0?null:R)}function Mi(h,g,w,R){var j=xs();R=R===void 0?null:R;var q=j.memoizedState.inst;Gr!==null&&R!==null&&ku(R,Gr.memoizedState.deps)?j.memoizedState=Ou(g,q,w,R):(Ft.flags|=h,j.memoizedState=Ou(1|g,q,w,R))}function Ad(h,g){No(8390656,8,h,g)}function Ah(h,g){Mi(2048,8,h,g)}function Id(h){Ft.flags|=4;var g=Ft.updateQueue;if(g===null)g=Sd(),Ft.updateQueue=g,g.events=[h];else{var w=g.events;w===null?g.events=[h]:w.push(h)}}function ug(h){var g=xs().memoizedState;return Id({ref:g,nextImpl:h}),function(){if((ze&2)!==0)throw Error(u(440));return g.impl.apply(void 0,arguments)}}function hg(h,g){return Mi(4,2,h,g)}function Xp(h,g){return Mi(4,4,h,g)}function zu(h,g){if(typeof g=="function"){h=h();var w=g(h);return function(){typeof w=="function"?w():g(null)}}if(g!=null)return h=h(),g.current=h,function(){g.current=null}}function ka(h,g,w){w=w!=null?w.concat([h]):null,Mi(4,4,zu.bind(null,g,h),w)}function Nt(){}function Xt(h,g){var w=xs();g=g===void 0?null:g;var R=w.memoizedState;return g!==null&&ku(g,R[1])?R[0]:(w.memoizedState=[h,g],h)}function Ih(h,g){var w=xs();g=g===void 0?null:g;var R=w.memoizedState;if(g!==null&&ku(g,R[1]))return R[0];if(R=h(),Mu){mr(!0);try{h()}finally{mr(!1)}}return w.memoizedState=[R,g],R}function br(h,g,w){return w===void 0||(_l&1073741824)!==0&&(Ze&261930)===0?h.memoizedState=g:(h.memoizedState=w,h=Si(),Ft.lanes|=h,kt|=h,w)}function We(h,g,w,R){return oo(w,g)?w:vh.current!==null?(h=br(h,w,R),oo(h,g)||(Ds=!0),h):(_l&42)===0||(_l&1073741824)!==0&&(Ze&261930)===0?(Ds=!0,h.memoizedState=w):(h=Si(),Ft.lanes|=h,kt|=h,g)}function dg(h,g,w,R,j){var q=Kt.p;Kt.p=q!==0&&8>q?q:8;var ce=wt.T,Me={};wt.T=Me,qf(h,!1,g,w);try{var ht=j(),Vt=wt.S;if(Vt!==null&&Vt(Me,ht),ht!==null&&typeof ht=="object"&&typeof ht.then=="function"){var sn=If(ht,R);Bo(h,g,sn,Pi(h))}else Bo(h,g,R,Pi(h))}catch(hn){Bo(h,g,{then:function(){},status:"rejected",reason:hn},Pi())}finally{Kt.p=q,ce!==null&&Me.types!==null&&(ce.types=Me.types),wt.T=ce}}function Yp(){}function Uf(h,g,w,R){if(h.tag!==5)throw Error(u(476));var j=Kp(h).queue;dg(h,j,g,wn,w===null?Yp:function(){return fg(h),w(R)})}function Kp(h){var g=h.memoizedState;if(g!==null)return g;g={memoizedState:wn,baseState:wn,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:wn},next:null};var w={};return g.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:w},next:null},h.memoizedState=g,h=h.alternate,h!==null&&(h.memoizedState=g),g}function fg(h){var g=Kp(h);g.next===null&&(g=h.alternate.memoizedState),Bo(h,g.next.queue,{},Pi())}function Gf(){return va(Rc)}function Ch(){return xs().memoizedState}function P_(){return xs().memoizedState}function nx(h){for(var g=h.return;g!==null;){switch(g.tag){case 24:case 3:var w=Pi();h=yc(w);var R=Jc(g,h,w);R!==null&&(Fn(R,g,w),_h(R,g,w)),g={cache:gd()},h.payload=g;return}g=g.return}}function pg(h,g,w){var R=Pi();w={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Hf(h)?$f(g,w):(w=hh(h,g,w,R),w!==null&&(Fn(w,h,R),Rd(w,g,R)))}function Cd(h,g,w){var R=Pi();Bo(h,g,w,R)}function Bo(h,g,w,R){var j={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null};if(Hf(h))$f(g,j);else{var q=h.alternate;if(h.lanes===0&&(q===null||q.lanes===0)&&(q=g.lastRenderedReducer,q!==null))try{var ce=g.lastRenderedState,Me=q(ce,w);if(j.hasEagerState=!0,j.eagerState=Me,oo(Me,ce))return $a(h,g,j,0),je===null&&uh(),!1}catch{}finally{}if(w=hh(h,g,j,R),w!==null)return Fn(w,h,R),Rd(w,g,R),!0}return!1}function qf(h,g,w,R){if(R={lane:2,revertLane:Ag(),gesture:null,action:R,hasEagerState:!1,eagerState:null,next:null},Hf(h)){if(g)throw Error(u(479))}else g=hh(h,w,R,2),g!==null&&Fn(g,h,2)}function Hf(h){var g=h.alternate;return h===Ft||g!==null&&g===Ft}function $f(h,g){Th=yl=!0;var w=h.pending;w===null?g.next=g:(g.next=w.next,w.next=g),h.pending=g}function Rd(h,g,w){if((w&4194048)!==0){var R=g.lanes;R&=h.pendingLanes,w|=R,g.lanes=w,th(h,w)}}var ql={readContext:va,use:Bf,useCallback:is,useContext:is,useEffect:is,useImperativeHandle:is,useLayoutEffect:is,useInsertionEffect:is,useMemo:is,useReducer:is,useRef:is,useState:is,useDebugValue:is,useDeferredValue:is,useTransition:is,useSyncExternalStore:is,useId:is,useHostTransitionStatus:is,useFormState:is,useActionState:is,useOptimistic:is,useMemoCache:is,useCacheRefresh:is};ql.useEffectEvent=is;var Qp={readContext:va,use:Bf,useCallback:function(h,g){return Ks().memoizedState=[h,g===void 0?null:g],h},useContext:va,useEffect:Ad,useImperativeHandle:function(h,g,w){w=w!=null?w.concat([h]):null,No(4194308,4,zu.bind(null,g,h),w)},useLayoutEffect:function(h,g){return No(4194308,4,h,g)},useInsertionEffect:function(h,g){No(4,2,h,g)},useMemo:function(h,g){var w=Ks();g=g===void 0?null:g;var R=h();if(Mu){mr(!0);try{h()}finally{mr(!1)}}return w.memoizedState=[R,g],R},useReducer:function(h,g,w){var R=Ks();if(w!==void 0){var j=w(g);if(Mu){mr(!0);try{w(g)}finally{mr(!1)}}}else j=g;return R.memoizedState=R.baseState=j,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:j},R.queue=h,h=h.dispatch=pg.bind(null,Ft,h),[R.memoizedState,h]},useRef:function(h){var g=Ks();return h={current:h},g.memoizedState=h},useState:function(h){h=bc(h);var g=h.queue,w=Cd.bind(null,Ft,g);return g.dispatch=w,[h.memoizedState,w]},useDebugValue:Nt,useDeferredValue:function(h,g){var w=Ks();return br(w,h,g)},useTransition:function(){var h=bc(!1);return h=dg.bind(null,Ft,h.queue,!0,!1),Ks().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,g,w){var R=Ft,j=Ks();if(dr){if(w===void 0)throw Error(u(407));w=w()}else{if(w=g(),je===null)throw Error(u(349));(Ze&127)!==0||Hp(R,g,w)}j.memoizedState=w;var q={value:w,getSnapshot:g};return j.queue=q,Ad(R_.bind(null,R,q,h),[h]),R.flags|=2048,Ou(9,{destroy:void 0},$p.bind(null,R,q,w,g),null),w},useId:function(){var h=Ks(),g=je.identifierPrefix;if(dr){var w=zl,R=fc;w=(R&~(1<<32-Fi(R)-1)).toString(32)+w,g="_"+g+"R_"+w,w=Eh++,0<w&&(g+="H"+w.toString(32)),g+="_"}else w=ng++,g="_"+g+"r_"+w.toString(32)+"_";return h.memoizedState=g},useHostTransitionStatus:Gf,useFormState:Pa,useActionState:Pa,useOptimistic:function(h){var g=Ks();g.memoizedState=g.baseState=h;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return g.queue=w,g=qf.bind(null,Ft,!0,w),w.dispatch=g,[h,g]},useMemoCache:Up,useCacheRefresh:function(){return Ks().memoizedState=nx.bind(null,Ft)},useEffectEvent:function(h){var g=Ks(),w={impl:h};return g.memoizedState=w,function(){if((ze&2)!==0)throw Error(u(440));return w.impl.apply(void 0,arguments)}}},Zf={readContext:va,use:Bf,useCallback:Xt,useContext:va,useEffect:Ah,useImperativeHandle:ka,useInsertionEffect:hg,useLayoutEffect:Xp,useMemo:Ih,useReducer:Ff,useRef:Wp,useState:function(){return Ff(Gl)},useDebugValue:Nt,useDeferredValue:function(h,g){var w=xs();return We(w,Gr.memoizedState,h,g)},useTransition:function(){var h=Ff(Gl)[0],g=xs().memoizedState;return[typeof h=="boolean"?h:Lu(h),g]},useSyncExternalStore:qp,useId:Ch,useHostTransitionStatus:Gf,useFormState:nu,useActionState:nu,useOptimistic:function(h,g){var w=xs();return sg(w,Gr,h,g)},useMemoCache:Up,useCacheRefresh:P_};Zf.useEffectEvent=ug;var mg={readContext:va,use:Bf,useCallback:Xt,useContext:va,useEffect:Ah,useImperativeHandle:ka,useInsertionEffect:hg,useLayoutEffect:Xp,useMemo:Ih,useReducer:Gp,useRef:Wp,useState:function(){return Gp(Gl)},useDebugValue:Nt,useDeferredValue:function(h,g){var w=xs();return Gr===null?br(w,h,g):We(w,Gr.memoizedState,h,g)},useTransition:function(){var h=Gp(Gl)[0],g=xs().memoizedState;return[typeof h=="boolean"?h:Lu(h),g]},useSyncExternalStore:qp,useId:Ch,useHostTransitionStatus:Gf,useFormState:Zp,useActionState:Zp,useOptimistic:function(h,g){var w=xs();return Gr!==null?sg(w,Gr,h,g):(w.baseState=h,[h,w.queue.dispatch])},useMemoCache:Up,useCacheRefresh:P_};mg.useEffectEvent=ug;function Jp(h,g,w,R){g=h.memoizedState,w=w(R,g),w=w==null?g:Y({},g,w),h.memoizedState=w,h.lanes===0&&(h.updateQueue.baseState=w)}var em={enqueueSetState:function(h,g,w){h=h._reactInternals;var R=Pi(),j=yc(R);j.payload=g,w!=null&&(j.callback=w),g=Jc(h,j,R),g!==null&&(Fn(g,h,R),_h(g,h,R))},enqueueReplaceState:function(h,g,w){h=h._reactInternals;var R=Pi(),j=yc(R);j.tag=1,j.payload=g,w!=null&&(j.callback=w),g=Jc(h,j,R),g!==null&&(Fn(g,h,R),_h(g,h,R))},enqueueForceUpdate:function(h,g){h=h._reactInternals;var w=Pi(),R=yc(w);R.tag=2,g!=null&&(R.callback=g),g=Jc(h,R,w),g!==null&&(Fn(g,h,w),_h(g,h,w))}};function La(h,g,w,R,j,q,ce){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(R,q,ce):g.prototype&&g.prototype.isPureReactComponent?!Lo(w,R)||!Lo(j,q):!0}function gg(h,g,w,R){h=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,R),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,R),g.state!==h&&em.enqueueReplaceState(g,g.state,null)}function Fo(h,g){var w=g;if("ref"in g){w={};for(var R in g)R!=="ref"&&(w[R]=g[R])}if(h=h.defaultProps){w===g&&(w=Y({},w));for(var j in h)w[j]===void 0&&(w[j]=h[j])}return w}function k_(h){cd(h)}function sr(h){console.error(h)}function ti(h){cd(h)}function Wf(h,g){try{var w=h.onUncaughtError;w(g.value,{componentStack:g.stack})}catch(R){setTimeout(function(){throw R})}}function iu(h,g,w){try{var R=h.onCaughtError;R(w.value,{componentStack:w.stack,errorBoundary:g.tag===1?g.stateNode:null})}catch(j){setTimeout(function(){throw j})}}function Hl(h,g,w){return w=yc(w),w.tag=3,w.payload={element:null},w.callback=function(){Wf(h,g)},w}function Tc(h){return h=yc(h),h.tag=3,h}function Gs(h,g,w,R){var j=w.type.getDerivedStateFromError;if(typeof j=="function"){var q=R.value;h.payload=function(){return j(q)},h.callback=function(){iu(g,w,R)}}var ce=w.stateNode;ce!==null&&typeof ce.componentDidCatch=="function"&&(h.callback=function(){iu(g,w,R),typeof j!="function"&&(Pn===null?Pn=new Set([this]):Pn.add(this));var Me=R.stack;this.componentDidCatch(R.value,{componentStack:Me!==null?Me:""})})}function Md(h,g,w,R,j){if(w.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(g=w.alternate,g!==null&&Su(g,w,j,!0),w=Ma.current,w!==null){switch(w.tag){case 31:case 13:return ba===null?la():w.alternate===null&&yt===0&&(yt=3),w.flags&=-257,w.flags|=65536,w.lanes=j,R===Df?w.flags|=16384:(g=w.updateQueue,g===null?w.updateQueue=new Set([R]):g.add(R),ou(h,R,j)),!1;case 22:return w.flags|=65536,R===Df?w.flags|=16384:(g=w.updateQueue,g===null?(g={transitions:null,markerInstances:null,retryQueue:new Set([R])},w.updateQueue=g):(w=g.retryQueue,w===null?g.retryQueue=new Set([R]):w.add(R)),ou(h,R,j)),!1}throw Error(u(435,w.tag))}return ou(h,R,j),la(),!1}if(dr)return g=Ma.current,g!==null?((g.flags&65536)===0&&(g.flags|=256),g.flags|=65536,g.lanes=j,R!==Tu&&(h=Error(u(422),{cause:R}),fd(aa(h,w)))):(R!==Tu&&(g=Error(u(423),{cause:R}),fd(aa(g,w))),h=h.current.alternate,h.flags|=65536,j&=-j,h.lanes|=j,R=aa(R,w),j=Hl(h.stateNode,R,j),Ed(h,j),yt!==4&&(yt=2)),!1;var q=Error(u(520),{cause:R});if(q=aa(q,w),an===null?an=[q]:an.push(q),yt!==4&&(yt=2),g===null)return!0;R=aa(R,w),w=g;do{switch(w.tag){case 3:return w.flags|=65536,h=j&-j,w.lanes|=h,h=Hl(w.stateNode,R,h),Ed(w,h),!1;case 1:if(g=w.type,q=w.stateNode,(w.flags&128)===0&&(typeof g.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Pn===null||!Pn.has(q))))return w.flags|=65536,j&=-j,w.lanes|=j,j=Tc(j),Gs(j,h,w,R),Ed(w,j),!1}w=w.return}while(w!==null);return!1}var Xf=Error(u(461)),Ds=!1;function oa(h,g,w,R){g.child=h===null?tg(g,null,w,R):_c(g,h.child,w,R)}function tl(h,g,w,R,j){w=w.render;var q=g.ref;if("ref"in R){var ce={};for(var Me in R)Me!=="ref"&&(ce[Me]=R[Me])}else ce=R;return Wc(g),R=Sh(h,g,w,ce,q,j),Me=Vp(),h!==null&&!Ds?(jp(h,g,j),Wl(h,g,j)):(dr&&Me&&wf(g),g.flags|=1,oa(h,g,R,j),g.child)}function $l(h,g,w,R,j){if(h===null){var q=w.type;return typeof q=="function"&&!Gc(q)&&q.defaultProps===void 0&&w.compare===null?(g.tag=15,g.type=q,Rh(h,g,q,R,j)):(h=dh(w.type,null,R,g,g.mode,j),h.ref=g.ref,h.return=g,g.child=h)}if(q=h.child,!Lh(h,j)){var ce=q.memoizedProps;if(w=w.compare,w=w!==null?w:Lo,w(ce,R)&&h.ref===g.ref)return Wl(h,g,j)}return g.flags|=1,h=co(q,R),h.ref=g.ref,h.return=g,g.child=h}function Rh(h,g,w,R,j){if(h!==null){var q=h.memoizedProps;if(Lo(q,R)&&h.ref===g.ref)if(Ds=!1,g.pendingProps=R=q,Lh(h,j))(h.flags&131072)!==0&&(Ds=!0);else return g.lanes=h.lanes,Wl(h,g,j)}return Dd(h,g,w,R,j)}function Mh(h,g,w,R){var j=R.children,q=h!==null?h.memoizedState:null;if(h===null&&g.stateNode===null&&(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),R.mode==="hidden"){if((g.flags&128)!==0){if(q=q!==null?q.baseLanes|w:w,h!==null){for(R=g.child=h.child,j=0;R!==null;)j=j|R.lanes|R.childLanes,R=R.sibling;R=j&~q}else R=0,g.child=null;return tm(h,g,q,w,R)}if((w&536870912)!==0)g.memoizedState={baseLanes:0,cachePool:null},h!==null&&vd(g,q!==null?q.cachePool:null),q!==null?Of(g,q):bh(),zf(g);else return R=g.lanes=536870912,tm(h,g,q!==null?q.baseLanes|w:w,w,R)}else q!==null?(vd(g,q.cachePool),Of(g,q),Da(),g.memoizedState=null):(h!==null&&vd(g,null),bh(),Da());return oa(h,g,j,w),g.child}function Dh(h,g){return h!==null&&h.tag===22||g.stateNode!==null||(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.sibling}function tm(h,g,w,R,j){var q=Rf();return q=q===null?null:{parent:Sr._currentValue,pool:q},g.memoizedState={baseLanes:w,cachePool:q},h!==null&&vd(g,null),bh(),zf(g),h!==null&&Su(h,g,R,!0),g.childLanes=j,null}function Zl(h,g){return g=Ld({mode:g.mode,children:g.children},h.mode),g.ref=h.ref,h.child=g,g.return=h,g}function nm(h,g,w){return _c(g,h.child,null,w),h=Zl(g,g.pendingProps),h.flags|=2,zo(g),g.memoizedState=null,h}function nl(h,g,w){var R=g.pendingProps,j=(g.flags&128)!==0;if(g.flags&=-129,h===null){if(dr){if(R.mode==="hidden")return h=Zl(g,R),g.lanes=536870912,Dh(null,h);if(wh(g),(h=Ur)?(h=y0(h,Jo),h=h!==null&&h.data==="&"?h:null,h!==null&&(g.memoizedState={dehydrated:h,treeContext:qi!==null?{id:fc,overflow:zl}:null,retryLane:536870912,hydrationErrors:null},w=E_(h),w.return=g,g.child=w,js=g,Ur=null)):h=null,h===null)throw Bl(g);return g.lanes=536870912,null}return Zl(g,R)}var q=h.memoizedState;if(q!==null){var ce=q.dehydrated;if(wh(g),j)if(g.flags&256)g.flags&=-257,g=nm(h,g,w);else if(g.memoizedState!==null)g.child=h.child,g.flags|=128,g=null;else throw Error(u(558));else if(Ds||Su(h,g,w,!1),j=(w&h.childLanes)!==0,Ds||j){if(R=je,R!==null&&(ce=Lc(R,w),ce!==0&&ce!==q.retryLane))throw q.retryLane=ce,jt(h,ce),Fn(R,h,ce),Xf;la(),g=nm(h,g,w)}else h=q.treeContext,Ur=Ic(ce.nextSibling),js=g,dr=!0,pc=null,Jo=!1,h!==null&&fh(g,h),g=Zl(g,R),g.flags|=4096;return g}return h=co(h.child,{mode:R.mode,children:R.children}),h.ref=g.ref,g.child=h,h.return=g,h}function Nu(h,g){var w=g.ref;if(w===null)h!==null&&h.ref!==null&&(g.flags|=4194816);else{if(typeof w!="function"&&typeof w!="object")throw Error(u(284));(h===null||h.ref!==w)&&(g.flags|=4194816)}}function Dd(h,g,w,R,j){return Wc(g),w=Sh(h,g,w,R,void 0,j),R=Vp(),h!==null&&!Ds?(jp(h,g,j),Wl(h,g,j)):(dr&&R&&wf(g),g.flags|=1,oa(h,g,w,j),g.child)}function Yf(h,g,w,R,j,q){return Wc(g),g.updateQueue=null,w=ig(g,R,w,j),Ul(h),R=Vp(),h!==null&&!Ds?(jp(h,g,q),Wl(h,g,q)):(dr&&R&&wf(g),g.flags|=1,oa(h,g,w,q),g.child)}function Kf(h,g,w,R,j){if(Wc(g),g.stateNode===null){var q=hc,ce=w.contextType;typeof ce=="object"&&ce!==null&&(q=va(ce)),q=new w(R,q),g.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=em,g.stateNode=q,q._reactInternals=g,q=g.stateNode,q.props=R,q.state=g.memoizedState,q.refs={},Lf(g),ce=w.contextType,q.context=typeof ce=="object"&&ce!==null?va(ce):hc,q.state=g.memoizedState,ce=w.getDerivedStateFromProps,typeof ce=="function"&&(Jp(g,w,ce,R),q.state=g.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(ce=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),ce!==q.state&&em.enqueueReplaceState(q,q.state,null),eu(g,R,q,j),yh(),q.state=g.memoizedState),typeof q.componentDidMount=="function"&&(g.flags|=4194308),R=!0}else if(h===null){q=g.stateNode;var Me=g.memoizedProps,ht=Fo(w,Me);q.props=ht;var Vt=q.context,sn=w.contextType;ce=hc,typeof sn=="object"&&sn!==null&&(ce=va(sn));var hn=w.getDerivedStateFromProps;sn=typeof hn=="function"||typeof q.getSnapshotBeforeUpdate=="function",Me=g.pendingProps!==Me,sn||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Me||Vt!==ce)&&gg(g,q,R,ce),uo=!1;var Ut=g.memoizedState;q.state=Ut,eu(g,R,q,j),yh(),Vt=g.memoizedState,Me||Ut!==Vt||uo?(typeof hn=="function"&&(Jp(g,w,hn,R),Vt=g.memoizedState),(ht=uo||La(g,w,ht,R,Ut,Vt,ce))?(sn||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(g.flags|=4194308)):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=R,g.memoizedState=Vt),q.props=R,q.state=Vt,q.context=ce,R=ht):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),R=!1)}else{q=g.stateNode,Td(h,g),ce=g.memoizedProps,sn=Fo(w,ce),q.props=sn,hn=g.pendingProps,Ut=q.context,Vt=w.contextType,ht=hc,typeof Vt=="object"&&Vt!==null&&(ht=va(Vt)),Me=w.getDerivedStateFromProps,(Vt=typeof Me=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ce!==hn||Ut!==ht)&&gg(g,q,R,ht),uo=!1,Ut=g.memoizedState,q.state=Ut,eu(g,R,q,j),yh();var Yt=g.memoizedState;ce!==hn||Ut!==Yt||uo||h!==null&&h.dependencies!==null&&pd(h.dependencies)?(typeof Me=="function"&&(Jp(g,w,Me,R),Yt=g.memoizedState),(sn=uo||La(g,w,sn,R,Ut,Yt,ht)||h!==null&&h.dependencies!==null&&pd(h.dependencies))?(Vt||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(R,Yt,ht),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(R,Yt,ht)),typeof q.componentDidUpdate=="function"&&(g.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof q.componentDidUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=1024),g.memoizedProps=R,g.memoizedState=Yt),q.props=R,q.state=Yt,q.context=ht,R=sn):(typeof q.componentDidUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===h.memoizedProps&&Ut===h.memoizedState||(g.flags|=1024),R=!1)}return q=R,Nu(h,g),R=(g.flags&128)!==0,q||R?(q=g.stateNode,w=R&&typeof w.getDerivedStateFromError!="function"?null:q.render(),g.flags|=1,h!==null&&R?(g.child=_c(g,h.child,null,j),g.child=_c(g,null,w,j)):oa(h,g,w,j),g.memoizedState=q.state,h=g.child):h=Wl(h,g,j),h}function vs(h,g,w,R){return Fl(),g.flags|=256,oa(h,g,w,R),g.child}var Ph={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bu(h){return{baseLanes:h,cachePool:mh()}}function Pd(h,g,w){return h=h!==null?h.childLanes&~w:0,g&&(h|=Lt),h}function Fu(h,g,w){var R=g.pendingProps,j=!1,q=(g.flags&128)!==0,ce;if((ce=q)||(ce=h!==null&&h.memoizedState===null?!1:(Us.current&2)!==0),ce&&(j=!0,g.flags&=-129),ce=(g.flags&32)!==0,g.flags&=-33,h===null){if(dr){if(j?jl(g):Da(),(h=Ur)?(h=y0(h,Jo),h=h!==null&&h.data!=="&"?h:null,h!==null&&(g.memoizedState={dehydrated:h,treeContext:qi!==null?{id:fc,overflow:zl}:null,retryLane:536870912,hydrationErrors:null},w=E_(h),w.return=g,g.child=w,js=g,Ur=null)):h=null,h===null)throw Bl(g);return px(h)?g.lanes=32:g.lanes=536870912,null}var Me=R.children;return R=R.fallback,j?(Da(),j=g.mode,Me=Ld({mode:"hidden",children:Me},j),R=wu(R,j,w,null),Me.return=g,R.return=g,Me.sibling=R,g.child=Me,R=g.child,R.memoizedState=Bu(w),R.childLanes=Pd(h,ce,w),g.memoizedState=Ph,Dh(null,R)):(jl(g),kd(g,Me))}var ht=h.memoizedState;if(ht!==null&&(Me=ht.dehydrated,Me!==null)){if(q)g.flags&256?(jl(g),g.flags&=-257,g=kh(h,g,w)):g.memoizedState!==null?(Da(),g.child=h.child,g.flags|=128,g=null):(Da(),Me=R.fallback,j=g.mode,R=Ld({mode:"visible",children:R.children},j),Me=wu(Me,j,w,null),Me.flags|=2,R.return=g,Me.return=g,R.sibling=Me,g.child=R,_c(g,h.child,null,w),R=g.child,R.memoizedState=Bu(w),R.childLanes=Pd(h,ce,w),g.memoizedState=Ph,g=Dh(null,R));else if(jl(g),px(Me)){if(ce=Me.nextSibling&&Me.nextSibling.dataset,ce)var Vt=ce.dgst;ce=Vt,R=Error(u(419)),R.stack="",R.digest=ce,fd({value:R,source:null,stack:null}),g=kh(h,g,w)}else if(Ds||Su(h,g,w,!1),ce=(w&h.childLanes)!==0,Ds||ce){if(ce=je,ce!==null&&(R=Lc(ce,w),R!==0&&R!==ht.retryLane))throw ht.retryLane=R,jt(h,R),Fn(ce,h,R),Xf;fx(Me)||la(),g=kh(h,g,w)}else fx(Me)?(g.flags|=192,g.child=h.child,g=null):(h=ht.treeContext,Ur=Ic(Me.nextSibling),js=g,dr=!0,pc=null,Jo=!1,h!==null&&fh(g,h),g=kd(g,R.children),g.flags|=4096);return g}return j?(Da(),Me=R.fallback,j=g.mode,ht=h.child,Vt=ht.sibling,R=co(ht,{mode:"hidden",children:R.children}),R.subtreeFlags=ht.subtreeFlags&65011712,Vt!==null?Me=co(Vt,Me):(Me=wu(Me,j,w,null),Me.flags|=2),Me.return=g,R.return=g,R.sibling=Me,g.child=R,Dh(null,R),R=g.child,Me=h.child.memoizedState,Me===null?Me=Bu(w):(j=Me.cachePool,j!==null?(ht=Sr._currentValue,j=j.parent!==ht?{parent:ht,pool:ht}:j):j=mh(),Me={baseLanes:Me.baseLanes|w,cachePool:j}),R.memoizedState=Me,R.childLanes=Pd(h,ce,w),g.memoizedState=Ph,Dh(h.child,R)):(jl(g),w=h.child,h=w.sibling,w=co(w,{mode:"visible",children:R.children}),w.return=g,w.sibling=null,h!==null&&(ce=g.deletions,ce===null?(g.deletions=[h],g.flags|=16):ce.push(h)),g.child=w,g.memoizedState=null,w)}function kd(h,g){return g=Ld({mode:"visible",children:g},h.mode),g.return=h,h.child=g}function Ld(h,g){return h=lo(22,h,null,g),h.lanes=0,h}function kh(h,g,w){return _c(g,h.child,null,w),h=kd(g,g.pendingProps.children),h.flags|=2,g.memoizedState=null,h}function Vu(h,g,w){h.lanes|=g;var R=h.alternate;R!==null&&(R.lanes|=g),Qm(h.return,g,w)}function Qf(h,g,w,R,j,q){var ce=h.memoizedState;ce===null?h.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:R,tail:w,tailMode:j,treeForkCount:q}:(ce.isBackwards=g,ce.rendering=null,ce.renderingStartTime=0,ce.last=R,ce.tail=w,ce.tailMode=j,ce.treeForkCount=q)}function Od(h,g,w){var R=g.pendingProps,j=R.revealOrder,q=R.tail;R=R.children;var ce=Us.current,Me=(ce&2)!==0;if(Me?(ce=ce&1|2,g.flags|=128):ce&=1,Be(Us,ce),oa(h,g,R,w),R=dr?vf:0,!Me&&h!==null&&(h.flags&128)!==0)e:for(h=g.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&Vu(h,w,g);else if(h.tag===19)Vu(h,w,g);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===g)break e;for(;h.sibling===null;){if(h.return===null||h.return===g)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(j){case"forwards":for(w=g.child,j=null;w!==null;)h=w.alternate,h!==null&&vc(h)===null&&(j=w),w=w.sibling;w=j,w===null?(j=g.child,g.child=null):(j=w.sibling,w.sibling=null),Qf(g,!1,j,w,q,R);break;case"backwards":case"unstable_legacy-backwards":for(w=null,j=g.child,g.child=null;j!==null;){if(h=j.alternate,h!==null&&vc(h)===null){g.child=j;break}h=j.sibling,j.sibling=w,w=j,j=h}Qf(g,!0,w,null,q,R);break;case"together":Qf(g,!1,null,null,void 0,R);break;default:g.memoizedState=null}return g.child}function Wl(h,g,w){if(h!==null&&(g.dependencies=h.dependencies),kt|=g.lanes,(w&g.childLanes)===0)if(h!==null){if(Su(h,g,w,!1),(w&g.childLanes)===0)return null}else return null;if(h!==null&&g.child!==h.child)throw Error(u(153));if(g.child!==null){for(h=g.child,w=co(h,h.pendingProps),g.child=w,w.return=g;h.sibling!==null;)h=h.sibling,w=w.sibling=co(h,h.pendingProps),w.return=g;w.sibling=null}return g.child}function Lh(h,g){return(h.lanes&g)!==0?!0:(h=h.dependencies,!!(h!==null&&pd(h)))}function _g(h,g,w){switch(g.tag){case 3:er(g,g.stateNode.containerInfo),Eu(g,Sr,h.memoizedState.cache),Fl();break;case 27:case 5:Ni(g);break;case 4:er(g,g.stateNode.containerInfo);break;case 10:Eu(g,g.type,g.memoizedProps.value);break;case 31:if(g.memoizedState!==null)return g.flags|=128,wh(g),null;break;case 13:var R=g.memoizedState;if(R!==null)return R.dehydrated!==null?(jl(g),g.flags|=128,null):(w&g.child.childLanes)!==0?Fu(h,g,w):(jl(g),h=Wl(h,g,w),h!==null?h.sibling:null);jl(g);break;case 19:var j=(h.flags&128)!==0;if(R=(w&g.childLanes)!==0,R||(Su(h,g,w,!1),R=(w&g.childLanes)!==0),j){if(R)return Od(h,g,w);g.flags|=128}if(j=g.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),Be(Us,Us.current),R)break;return null;case 22:return g.lanes=0,Mh(h,g,w,g.pendingProps);case 24:Eu(g,Sr,h.memoizedState.cache)}return Wl(h,g,w)}function Jf(h,g,w){if(h!==null)if(h.memoizedProps!==g.pendingProps)Ds=!0;else{if(!Lh(h,w)&&(g.flags&128)===0)return Ds=!1,_g(h,g,w);Ds=(h.flags&131072)!==0}else Ds=!1,dr&&(g.flags&1048576)!==0&&bf(g,vf,g.index);switch(g.lanes=0,g.tag){case 16:e:{var R=g.pendingProps;if(h=gc(g.elementType),g.type=h,typeof h=="function")Gc(h)?(R=Fo(h,R),g.tag=1,g=Kf(null,g,h,R,w)):(g.tag=0,g=Dd(null,g,h,R,w));else{if(h!=null){var j=h.$$typeof;if(j===Mt){g.tag=11,g=tl(null,g,h,R,w);break e}else if(j===Oe){g.tag=14,g=$l(null,g,h,R,w);break e}}throw g=Ht(h)||h,Error(u(306,g,""))}}return g;case 0:return Dd(h,g,g.type,g.pendingProps,w);case 1:return R=g.type,j=Fo(R,g.pendingProps),Kf(h,g,R,j,w);case 3:e:{if(er(g,g.stateNode.containerInfo),h===null)throw Error(u(387));R=g.pendingProps;var q=g.memoizedState;j=q.element,Td(h,g),eu(g,R,null,w);var ce=g.memoizedState;if(R=ce.cache,Eu(g,Sr,R),R!==q.cache&&Ef(g,[Sr],w,!0),yh(),R=ce.element,q.isDehydrated)if(q={element:R,isDehydrated:!1,cache:ce.cache},g.updateQueue.baseState=q,g.memoizedState=q,g.flags&256){g=vs(h,g,R,w);break e}else if(R!==j){j=aa(Error(u(424)),g),fd(j),g=vs(h,g,R,w);break e}else{switch(h=g.stateNode.containerInfo,h.nodeType){case 9:h=h.body;break;default:h=h.nodeName==="HTML"?h.ownerDocument.body:h}for(Ur=Ic(h.firstChild),js=g,dr=!0,pc=null,Jo=!0,w=tg(g,null,R,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling}else{if(Fl(),R===j){g=Wl(h,g,w);break e}oa(h,g,R,w)}g=g.child}return g;case 26:return Nu(h,g),h===null?(w=qu(g.type,null,g.pendingProps,null))?g.memoizedState=w:dr||(w=g.type,h=g.pendingProps,R=Pg($n.current).createElement(w),R[Pe]=g,R[xe]=h,go(R,w,h),vn(R),g.stateNode=R):g.memoizedState=qu(g.type,h.memoizedProps,g.pendingProps,h.memoizedState),null;case 27:return Ni(g),h===null&&dr&&(R=g.stateNode=um(g.type,g.pendingProps,$n.current),js=g,Jo=!0,j=Ur,Ql(g.type)?(kg=j,Ur=Ic(R.firstChild)):Ur=j),oa(h,g,g.pendingProps.children,w),Nu(h,g),h===null&&(g.flags|=4194304),g.child;case 5:return h===null&&dr&&((j=R=Ur)&&(R=ew(R,g.type,g.pendingProps,Jo),R!==null?(g.stateNode=R,js=g,Ur=Ic(R.firstChild),Jo=!1,j=!0):j=!1),j||Bl(g)),Ni(g),j=g.type,q=g.pendingProps,ce=h!==null?h.memoizedProps:null,R=q.children,Gu(j,q)?R=null:ce!==null&&Gu(j,ce)&&(g.flags|=32),g.memoizedState!==null&&(j=Sh(h,g,C_,null,null,w),Rc._currentValue=j),Nu(h,g),oa(h,g,R,w),g.child;case 6:return h===null&&dr&&((h=w=Ur)&&(w=tw(w,g.pendingProps,Jo),w!==null?(g.stateNode=w,js=g,Ur=null,h=!0):h=!1),h||Bl(g)),null;case 13:return Fu(h,g,w);case 4:return er(g,g.stateNode.containerInfo),R=g.pendingProps,h===null?g.child=_c(g,null,R,w):oa(h,g,R,w),g.child;case 11:return tl(h,g,g.type,g.pendingProps,w);case 7:return oa(h,g,g.pendingProps,w),g.child;case 8:return oa(h,g,g.pendingProps.children,w),g.child;case 12:return oa(h,g,g.pendingProps.children,w),g.child;case 10:return R=g.pendingProps,Eu(g,g.type,R.value),oa(h,g,R.children,w),g.child;case 9:return j=g.type._context,R=g.pendingProps.children,Wc(g),j=va(j),R=R(j),g.flags|=1,oa(h,g,R,w),g.child;case 14:return $l(h,g,g.type,g.pendingProps,w);case 15:return Rh(h,g,g.type,g.pendingProps,w);case 19:return Od(h,g,w);case 31:return nl(h,g,w);case 22:return Mh(h,g,w,g.pendingProps);case 24:return Wc(g),R=va(Sr),h===null?(j=Rf(),j===null&&(j=je,q=gd(),j.pooledCache=q,q.refCount++,q!==null&&(j.pooledCacheLanes|=w),j=q),g.memoizedState={parent:R,cache:j},Lf(g),Eu(g,Sr,j)):((h.lanes&w)!==0&&(Td(h,g),eu(g,null,null,w),yh()),j=h.memoizedState,q=g.memoizedState,j.parent!==R?(j={parent:R,cache:R},g.memoizedState=j,g.lanes===0&&(g.memoizedState=g.updateQueue.baseState=j),Eu(g,Sr,R)):(R=q.cache,Eu(g,Sr,R),R!==j.cache&&Ef(g,[Sr],w,!0))),oa(h,g,g.pendingProps.children,w),g.child;case 29:throw g.pendingProps}throw Error(u(156,g.tag))}function Ec(h){h.flags|=4}function im(h,g,w,R,j){if((g=(h.mode&32)!==0)&&(g=!1),g){if(h.flags|=16777216,(j&335544128)===j)if(h.stateNode.complete)h.flags|=8192;else if(Ai())h.flags|=8192;else throw Qc=Df,Jm}else h.flags&=-16777217}function yg(h,g){if(g.type!=="stylesheet"||(g.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!Ex(g))if(Ai())h.flags|=8192;else throw Qc=Df,Jm}function ep(h,g){g!==null&&(h.flags|=4),h.flags&16384&&(g=h.tag!==22?Va():536870912,h.lanes|=g,un|=g)}function zd(h,g){if(!dr)switch(h.tailMode){case"hidden":g=h.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?h.tail=null:w.sibling=null;break;case"collapsed":w=h.tail;for(var R=null;w!==null;)w.alternate!==null&&(R=w),w=w.sibling;R===null?g||h.tail===null?h.tail=null:h.tail.sibling=null:R.sibling=null}}function ds(h){var g=h.alternate!==null&&h.alternate.child===h.child,w=0,R=0;if(g)for(var j=h.child;j!==null;)w|=j.lanes|j.childLanes,R|=j.subtreeFlags&65011712,R|=j.flags&65011712,j.return=h,j=j.sibling;else for(j=h.child;j!==null;)w|=j.lanes|j.childLanes,R|=j.subtreeFlags,R|=j.flags,j.return=h,j=j.sibling;return h.subtreeFlags|=R,h.childLanes=w,g}function tp(h,g,w){var R=g.pendingProps;switch(Hc(g),g.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ds(g),null;case 1:return ds(g),null;case 3:return w=g.stateNode,R=null,h!==null&&(R=h.memoizedState.cache),g.memoizedState.cache!==R&&(g.flags|=2048),Zc(Sr),qn(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(h===null||h.child===null)&&($c(g)?Ec(g):h===null||h.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,zp())),ds(g),null;case 26:var j=g.type,q=g.memoizedState;return h===null?(Ec(g),q!==null?(ds(g),yg(g,q)):(ds(g),im(g,j,null,R,w))):q?q!==h.memoizedState?(Ec(g),ds(g),yg(g,q)):(ds(g),g.flags&=-16777217):(h=h.memoizedProps,h!==R&&Ec(g),ds(g),im(g,j,h,R,w)),null;case 27:if(Vr(g),w=$n.current,j=g.type,h!==null&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(!R){if(g.stateNode===null)throw Error(u(166));return ds(g),null}h=En.current,$c(g)?Tf(g):(h=um(j,R,w),g.stateNode=h,Ec(g))}return ds(g),null;case 5:if(Vr(g),j=g.type,h!==null&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(!R){if(g.stateNode===null)throw Error(u(166));return ds(g),null}if(q=En.current,$c(g))Tf(g);else{var ce=Pg($n.current);switch(q){case 1:q=ce.createElementNS("http://www.w3.org/2000/svg",j);break;case 2:q=ce.createElementNS("http://www.w3.org/1998/Math/MathML",j);break;default:switch(j){case"svg":q=ce.createElementNS("http://www.w3.org/2000/svg",j);break;case"math":q=ce.createElementNS("http://www.w3.org/1998/Math/MathML",j);break;case"script":q=ce.createElement("div"),q.innerHTML="<script><\/script>",q=q.removeChild(q.firstChild);break;case"select":q=typeof R.is=="string"?ce.createElement("select",{is:R.is}):ce.createElement("select"),R.multiple?q.multiple=!0:R.size&&(q.size=R.size);break;default:q=typeof R.is=="string"?ce.createElement(j,{is:R.is}):ce.createElement(j)}}q[Pe]=g,q[xe]=R;e:for(ce=g.child;ce!==null;){if(ce.tag===5||ce.tag===6)q.appendChild(ce.stateNode);else if(ce.tag!==4&&ce.tag!==27&&ce.child!==null){ce.child.return=ce,ce=ce.child;continue}if(ce===g)break e;for(;ce.sibling===null;){if(ce.return===null||ce.return===g)break e;ce=ce.return}ce.sibling.return=ce.return,ce=ce.sibling}g.stateNode=q;e:switch(go(q,j,R),j){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}R&&Ec(g)}}return ds(g),im(g,g.type,h===null?null:h.memoizedProps,g.pendingProps,w),null;case 6:if(h&&g.stateNode!=null)h.memoizedProps!==R&&Ec(g);else{if(typeof R!="string"&&g.stateNode===null)throw Error(u(166));if(h=$n.current,$c(g)){if(h=g.stateNode,w=g.memoizedProps,R=null,j=js,j!==null)switch(j.tag){case 27:case 5:R=j.memoizedProps}h[Pe]=g,h=!!(h.nodeValue===w||R!==null&&R.suppressHydrationWarning===!0||f0(h.nodeValue,w)),h||Bl(g,!0)}else h=Pg(h).createTextNode(R),h[Pe]=g,g.stateNode=h}return ds(g),null;case 31:if(w=g.memoizedState,h===null||h.memoizedState!==null){if(R=$c(g),w!==null){if(h===null){if(!R)throw Error(u(318));if(h=g.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(u(557));h[Pe]=g}else Fl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;ds(g),h=!1}else w=zp(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=w),h=!0;if(!h)return g.flags&256?(zo(g),g):(zo(g),null);if((g.flags&128)!==0)throw Error(u(558))}return ds(g),null;case 13:if(R=g.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(j=$c(g),R!==null&&R.dehydrated!==null){if(h===null){if(!j)throw Error(u(318));if(j=g.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(u(317));j[Pe]=g}else Fl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;ds(g),j=!1}else j=zp(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=j),j=!0;if(!j)return g.flags&256?(zo(g),g):(zo(g),null)}return zo(g),(g.flags&128)!==0?(g.lanes=w,g):(w=R!==null,h=h!==null&&h.memoizedState!==null,w&&(R=g.child,j=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(j=R.alternate.memoizedState.cachePool.pool),q=null,R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(q=R.memoizedState.cachePool.pool),q!==j&&(R.flags|=2048)),w!==h&&w&&(g.child.flags|=8192),ep(g,g.updateQueue),ds(g),null);case 4:return qn(),h===null&&N_(g.stateNode.containerInfo),ds(g),null;case 10:return Zc(g.type),ds(g),null;case 19:if(Qt(Us),R=g.memoizedState,R===null)return ds(g),null;if(j=(g.flags&128)!==0,q=R.rendering,q===null)if(j)zd(R,!1);else{if(yt!==0||h!==null&&(h.flags&128)!==0)for(h=g.child;h!==null;){if(q=vc(h),q!==null){for(g.flags|=128,zd(R,!1),h=q.updateQueue,g.updateQueue=h,ep(g,h),g.subtreeFlags=0,h=w,w=g.child;w!==null;)qc(w,h),w=w.sibling;return Be(Us,Us.current&1|2),dr&&Nl(g,R.treeForkCount),g.child}h=h.sibling}R.tail!==null&&jr()>jn&&(g.flags|=128,j=!0,zd(R,!1),g.lanes=4194304)}else{if(!j)if(h=vc(q),h!==null){if(g.flags|=128,j=!0,h=h.updateQueue,g.updateQueue=h,ep(g,h),zd(R,!0),R.tail===null&&R.tailMode==="hidden"&&!q.alternate&&!dr)return ds(g),null}else 2*jr()-R.renderingStartTime>jn&&w!==536870912&&(g.flags|=128,j=!0,zd(R,!1),g.lanes=4194304);R.isBackwards?(q.sibling=g.child,g.child=q):(h=R.last,h!==null?h.sibling=q:g.child=q,R.last=q)}return R.tail!==null?(h=R.tail,R.rendering=h,R.tail=h.sibling,R.renderingStartTime=jr(),h.sibling=null,w=Us.current,Be(Us,j?w&1|2:w&1),dr&&Nl(g,R.treeForkCount),h):(ds(g),null);case 22:case 23:return zo(g),xc(),R=g.memoizedState!==null,h!==null?h.memoizedState!==null!==R&&(g.flags|=8192):R&&(g.flags|=8192),R?(w&536870912)!==0&&(g.flags&128)===0&&(ds(g),g.subtreeFlags&6&&(g.flags|=8192)):ds(g),w=g.updateQueue,w!==null&&ep(g,w.retryQueue),w=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),R=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(R=g.memoizedState.cachePool.pool),R!==w&&(g.flags|=2048),h!==null&&Qt(Kc),null;case 24:return w=null,h!==null&&(w=h.memoizedState.cache),g.memoizedState.cache!==w&&(g.flags|=2048),Zc(Sr),ds(g),null;case 25:return null;case 30:return null}throw Error(u(156,g.tag))}function L_(h,g){switch(Hc(g),g.tag){case 1:return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 3:return Zc(Sr),qn(),h=g.flags,(h&65536)!==0&&(h&128)===0?(g.flags=h&-65537|128,g):null;case 26:case 27:case 5:return Vr(g),null;case 31:if(g.memoizedState!==null){if(zo(g),g.alternate===null)throw Error(u(340));Fl()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 13:if(zo(g),h=g.memoizedState,h!==null&&h.dehydrated!==null){if(g.alternate===null)throw Error(u(340));Fl()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 19:return Qt(Us),null;case 4:return qn(),null;case 10:return Zc(g.type),null;case 22:case 23:return zo(g),xc(),h!==null&&Qt(Kc),h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 24:return Zc(Sr),null;case 25:return null;default:return null}}function xg(h,g){switch(Hc(g),g.tag){case 3:Zc(Sr),qn();break;case 26:case 27:case 5:Vr(g);break;case 4:qn();break;case 31:g.memoizedState!==null&&zo(g);break;case 13:zo(g);break;case 19:Qt(Us);break;case 10:Zc(g.type);break;case 22:case 23:zo(g),xc(),h!==null&&Qt(Kc);break;case 24:Zc(Sr)}}function ru(h,g){try{var w=g.updateQueue,R=w!==null?w.lastEffect:null;if(R!==null){var j=R.next;w=j;do{if((w.tag&h)===h){R=void 0;var q=w.create,ce=w.inst;R=q(),ce.destroy=R}w=w.next}while(w!==j)}}catch(Me){ar(g,g.return,Me)}}function su(h,g,w){try{var R=g.updateQueue,j=R!==null?R.lastEffect:null;if(j!==null){var q=j.next;R=q;do{if((R.tag&h)===h){var ce=R.inst,Me=ce.destroy;if(Me!==void 0){ce.destroy=void 0,j=g;var ht=w,Vt=Me;try{Vt()}catch(sn){ar(j,ht,sn)}}}R=R.next}while(R!==q)}}catch(sn){ar(g,g.return,sn)}}function rm(h){var g=h.updateQueue;if(g!==null){var w=h.stateNode;try{I_(g,w)}catch(R){ar(h,h.return,R)}}}function vg(h,g,w){w.props=Fo(h.type,h.memoizedProps),w.state=h.memoizedState;try{w.componentWillUnmount()}catch(R){ar(h,g,R)}}function Nd(h,g){try{var w=h.ref;if(w!==null){switch(h.tag){case 26:case 27:case 5:var R=h.stateNode;break;case 30:R=h.stateNode;break;default:R=h.stateNode}typeof w=="function"?h.refCleanup=w(R):w.current=R}}catch(j){ar(h,g,j)}}function Xl(h,g){var w=h.ref,R=h.refCleanup;if(w!==null)if(typeof R=="function")try{R()}catch(j){ar(h,g,j)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(j){ar(h,g,j)}else w.current=null}function bg(h){var g=h.type,w=h.memoizedProps,R=h.stateNode;try{e:switch(g){case"button":case"input":case"select":case"textarea":w.autoFocus&&R.focus();break e;case"img":w.src?R.src=w.src:w.srcSet&&(R.srcset=w.srcSet)}}catch(j){ar(h,h.return,j)}}function fr(h,g,w){try{var R=h.stateNode;p0(R,h.type,w,g),R[xe]=g}catch(j){ar(h,h.return,j)}}function wg(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&Ql(h.type)||h.tag===4}function sm(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||wg(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&Ql(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Tg(h,g,w){var R=h.tag;if(R===5||R===6)h=h.stateNode,g?(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).insertBefore(h,g):(g=w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w,g.appendChild(h),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=As));else if(R!==4&&(R===27&&Ql(h.type)&&(w=h.stateNode,g=null),h=h.child,h!==null))for(Tg(h,g,w),h=h.sibling;h!==null;)Tg(h,g,w),h=h.sibling}function am(h,g,w){var R=h.tag;if(R===5||R===6)h=h.stateNode,g?w.insertBefore(h,g):w.appendChild(h);else if(R!==4&&(R===27&&Ql(h.type)&&(w=h.stateNode),h=h.child,h!==null))for(am(h,g,w),h=h.sibling;h!==null;)am(h,g,w),h=h.sibling}function Bd(h){var g=h.stateNode,w=h.memoizedProps;try{for(var R=h.type,j=g.attributes;j.length;)g.removeAttributeNode(j[0]);go(g,R,w),g[Pe]=h,g[xe]=w}catch(q){ar(h,h.return,q)}}var Sc=!1,Ps=!1,Oh=!1,xl=typeof WeakSet=="function"?WeakSet:Set,Hr=null;function fs(h,g){if(h=h.containerInfo,F_=Vg,h=v_(h),lh(h)){if("selectionStart"in h)var w={start:h.selectionStart,end:h.selectionEnd};else e:{w=(w=h.ownerDocument)&&w.defaultView||window;var R=w.getSelection&&w.getSelection();if(R&&R.rangeCount!==0){w=R.anchorNode;var j=R.anchorOffset,q=R.focusNode;R=R.focusOffset;try{w.nodeType,q.nodeType}catch{w=null;break e}var ce=0,Me=-1,ht=-1,Vt=0,sn=0,hn=h,Ut=null;t:for(;;){for(var Yt;hn!==w||j!==0&&hn.nodeType!==3||(Me=ce+j),hn!==q||R!==0&&hn.nodeType!==3||(ht=ce+R),hn.nodeType===3&&(ce+=hn.nodeValue.length),(Yt=hn.firstChild)!==null;)Ut=hn,hn=Yt;for(;;){if(hn===h)break t;if(Ut===w&&++Vt===j&&(Me=ce),Ut===q&&++sn===R&&(ht=ce),(Yt=hn.nextSibling)!==null)break;hn=Ut,Ut=hn.parentNode}hn=Yt}w=Me===-1||ht===-1?null:{start:Me,end:ht}}else w=null}w=w||{start:0,end:0}}else w=null;for(V_={focusedElem:h,selectionRange:w},Vg=!1,Hr=g;Hr!==null;)if(g=Hr,h=g.child,(g.subtreeFlags&1028)!==0&&h!==null)h.return=g,Hr=h;else for(;Hr!==null;){switch(g=Hr,q=g.alternate,h=g.flags,g.tag){case 0:if((h&4)!==0&&(h=g.updateQueue,h=h!==null?h.events:null,h!==null))for(w=0;w<h.length;w++)j=h[w],j.ref.impl=j.nextImpl;break;case 11:case 15:break;case 1:if((h&1024)!==0&&q!==null){h=void 0,w=g,j=q.memoizedProps,q=q.memoizedState,R=w.stateNode;try{var Wn=Fo(w.type,j);h=R.getSnapshotBeforeUpdate(Wn,q),R.__reactInternalSnapshotBeforeUpdate=h}catch(di){ar(w,w.return,di)}}break;case 3:if((h&1024)!==0){if(h=g.stateNode.containerInfo,w=h.nodeType,w===9)ip(h);else if(w===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":ip(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(u(163))}if(h=g.sibling,h!==null){h.return=g.return,Hr=h;break}Hr=g.return}}function Vo(h,g,w){var R=w.flags;switch(w.tag){case 0:case 11:case 15:M(h,w),R&4&&ru(5,w);break;case 1:if(M(h,w),R&4)if(h=w.stateNode,g===null)try{h.componentDidMount()}catch(ce){ar(w,w.return,ce)}else{var j=Fo(w.type,g.memoizedProps);g=g.memoizedState;try{h.componentDidUpdate(j,g,h.__reactInternalSnapshotBeforeUpdate)}catch(ce){ar(w,w.return,ce)}}R&64&&rm(w),R&512&&Nd(w,w.return);break;case 3:if(M(h,w),R&64&&(h=w.updateQueue,h!==null)){if(g=null,w.child!==null)switch(w.child.tag){case 27:case 5:g=w.child.stateNode;break;case 1:g=w.child.stateNode}try{I_(h,g)}catch(ce){ar(w,w.return,ce)}}break;case 27:g===null&&R&4&&Bd(w);case 26:case 5:M(h,w),g===null&&R&4&&bg(w),R&512&&Nd(w,w.return);break;case 12:M(h,w);break;case 31:M(h,w),R&4&&ix(h,w);break;case 13:M(h,w),R&4&&f(h,w),R&64&&(h=w.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(w=s0.bind(null,w),nw(h,w))));break;case 22:if(R=w.memoizedState!==null||Sc,!R){g=g!==null&&g.memoizedState!==null||Ps,j=Sc;var q=Ps;Sc=R,(Ps=g)&&!q?z(h,w,(w.subtreeFlags&8772)!==0):M(h,w),Sc=j,Ps=q}break;case 30:break;default:M(h,w)}}function Fd(h){var g=h.alternate;g!==null&&(h.alternate=null,Fd(g)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(g=h.stateNode,g!==null&&tn(g)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var rs=null,ho=!1;function au(h,g,w){for(w=w.child;w!==null;)zh(h,g,w),w=w.sibling}function zh(h,g,w){if(Pr&&typeof Pr.onCommitFiberUnmount=="function")try{Pr.onCommitFiberUnmount(ms,w)}catch{}switch(w.tag){case 26:Ps||Xl(w,g),au(h,g,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:Ps||Xl(w,g);var R=rs,j=ho;Ql(w.type)&&(rs=w.stateNode,ho=!1),au(h,g,w),Lg(w.stateNode),rs=R,ho=j;break;case 5:Ps||Xl(w,g);case 6:if(R=rs,j=ho,rs=null,au(h,g,w),rs=R,ho=j,rs!==null)if(ho)try{(rs.nodeType===9?rs.body:rs.nodeName==="HTML"?rs.ownerDocument.body:rs).removeChild(w.stateNode)}catch(q){ar(w,g,q)}else try{rs.removeChild(w.stateNode)}catch(q){ar(w,g,q)}break;case 18:rs!==null&&(ho?(h=rs,dx(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,w.stateNode),gm(h)):dx(rs,w.stateNode));break;case 4:R=rs,j=ho,rs=w.stateNode.containerInfo,ho=!0,au(h,g,w),rs=R,ho=j;break;case 0:case 11:case 14:case 15:su(2,w,g),Ps||su(4,w,g),au(h,g,w);break;case 1:Ps||(Xl(w,g),R=w.stateNode,typeof R.componentWillUnmount=="function"&&vg(w,g,R)),au(h,g,w);break;case 21:au(h,g,w);break;case 22:Ps=(R=Ps)||w.memoizedState!==null,au(h,g,w),Ps=R;break;default:au(h,g,w)}}function ix(h,g){if(g.memoizedState===null&&(h=g.alternate,h!==null&&(h=h.memoizedState,h!==null))){h=h.dehydrated;try{gm(h)}catch(w){ar(g,g.return,w)}}}function f(h,g){if(g.memoizedState===null&&(h=g.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{gm(h)}catch(w){ar(g,g.return,w)}}function n(h){switch(h.tag){case 31:case 13:case 19:var g=h.stateNode;return g===null&&(g=h.stateNode=new xl),g;case 22:return h=h.stateNode,g=h._retryCache,g===null&&(g=h._retryCache=new xl),g;default:throw Error(u(435,h.tag))}}function c(h,g){var w=n(h);g.forEach(function(R){if(!w.has(R)){w.add(R);var j=a0.bind(null,h,R);R.then(j,j)}})}function p(h,g){var w=g.deletions;if(w!==null)for(var R=0;R<w.length;R++){var j=w[R],q=h,ce=g,Me=ce;e:for(;Me!==null;){switch(Me.tag){case 27:if(Ql(Me.type)){rs=Me.stateNode,ho=!1;break e}break;case 5:rs=Me.stateNode,ho=!1;break e;case 3:case 4:rs=Me.stateNode.containerInfo,ho=!0;break e}Me=Me.return}if(rs===null)throw Error(u(160));zh(q,ce,j),rs=null,ho=!1,q=j.alternate,q!==null&&(q.return=null),j.return=null}if(g.subtreeFlags&13886)for(g=g.child;g!==null;)b(g,h),g=g.sibling}var x=null;function b(h,g){var w=h.alternate,R=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:p(g,h),E(h),R&4&&(su(3,h,h.return),ru(3,h),su(5,h,h.return));break;case 1:p(g,h),E(h),R&512&&(Ps||w===null||Xl(w,w.return)),R&64&&Sc&&(h=h.updateQueue,h!==null&&(R=h.callbacks,R!==null&&(w=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=w===null?R:w.concat(R))));break;case 26:var j=x;if(p(g,h),E(h),R&512&&(Ps||w===null||Xl(w,w.return)),R&4){var q=w!==null?w.memoizedState:null;if(R=h.memoizedState,w===null)if(R===null)if(h.stateNode===null){e:{R=h.type,w=h.memoizedProps,j=j.ownerDocument||j;t:switch(R){case"title":q=j.getElementsByTagName("title")[0],(!q||q[It]||q[Pe]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=j.createElement(R),j.head.insertBefore(q,j.querySelector("head > title"))),go(q,R,w),q[Pe]=h,vn(q),R=q;break e;case"link":var ce=op("link","href",j).get(R+(w.href||""));if(ce){for(var Me=0;Me<ce.length;Me++)if(q=ce[Me],q.getAttribute("href")===(w.href==null||w.href===""?null:w.href)&&q.getAttribute("rel")===(w.rel==null?null:w.rel)&&q.getAttribute("title")===(w.title==null?null:w.title)&&q.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){ce.splice(Me,1);break t}}q=j.createElement(R),go(q,R,w),j.head.appendChild(q);break;case"meta":if(ce=op("meta","content",j).get(R+(w.content||""))){for(Me=0;Me<ce.length;Me++)if(q=ce[Me],q.getAttribute("content")===(w.content==null?null:""+w.content)&&q.getAttribute("name")===(w.name==null?null:w.name)&&q.getAttribute("property")===(w.property==null?null:w.property)&&q.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&q.getAttribute("charset")===(w.charSet==null?null:w.charSet)){ce.splice(Me,1);break t}}q=j.createElement(R),go(q,R,w),j.head.appendChild(q);break;default:throw Error(u(468,R))}q[Pe]=h,vn(q),R=q}h.stateNode=R}else Tx(j,h.type,h.stateNode);else h.stateNode=bx(j,R,h.memoizedProps);else q!==R?(q===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):q.count--,R===null?Tx(j,h.type,h.stateNode):bx(j,R,h.memoizedProps)):R===null&&h.stateNode!==null&&fr(h,h.memoizedProps,w.memoizedProps)}break;case 27:p(g,h),E(h),R&512&&(Ps||w===null||Xl(w,w.return)),w!==null&&R&4&&fr(h,h.memoizedProps,w.memoizedProps);break;case 5:if(p(g,h),E(h),R&512&&(Ps||w===null||Xl(w,w.return)),h.flags&32){j=h.stateNode;try{ma(j,"")}catch(Wn){ar(h,h.return,Wn)}}R&4&&h.stateNode!=null&&(j=h.memoizedProps,fr(h,j,w!==null?w.memoizedProps:j)),R&1024&&(Oh=!0);break;case 6:if(p(g,h),E(h),R&4){if(h.stateNode===null)throw Error(u(162));R=h.memoizedProps,w=h.stateNode;try{w.nodeValue=R}catch(Wn){ar(h,h.return,Wn)}}break;case 3:if(Zd=null,j=x,x=Og(g.containerInfo),p(g,h),x=j,E(h),R&4&&w!==null&&w.memoizedState.isDehydrated)try{gm(g.containerInfo)}catch(Wn){ar(h,h.return,Wn)}Oh&&(Oh=!1,I(h));break;case 4:R=x,x=Og(h.stateNode.containerInfo),p(g,h),E(h),x=R;break;case 12:p(g,h),E(h);break;case 31:p(g,h),E(h),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 13:p(g,h),E(h),h.child.flags&8192&&h.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(xn=jr()),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 22:j=h.memoizedState!==null;var ht=w!==null&&w.memoizedState!==null,Vt=Sc,sn=Ps;if(Sc=Vt||j,Ps=sn||ht,p(g,h),Ps=sn,Sc=Vt,E(h),R&8192)e:for(g=h.stateNode,g._visibility=j?g._visibility&-2:g._visibility|1,j&&(w===null||ht||Sc||Ps||O(h)),w=null,g=h;;){if(g.tag===5||g.tag===26){if(w===null){ht=w=g;try{if(q=ht.stateNode,j)ce=q.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none";else{Me=ht.stateNode;var hn=ht.memoizedProps.style,Ut=hn!=null&&hn.hasOwnProperty("display")?hn.display:null;Me.style.display=Ut==null||typeof Ut=="boolean"?"":(""+Ut).trim()}}catch(Wn){ar(ht,ht.return,Wn)}}}else if(g.tag===6){if(w===null){ht=g;try{ht.stateNode.nodeValue=j?"":ht.memoizedProps}catch(Wn){ar(ht,ht.return,Wn)}}}else if(g.tag===18){if(w===null){ht=g;try{var Yt=ht.stateNode;j?Hd(Yt,!0):Hd(ht.stateNode,!1)}catch(Wn){ar(ht,ht.return,Wn)}}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===h)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break e;for(;g.sibling===null;){if(g.return===null||g.return===h)break e;w===g&&(w=null),g=g.return}w===g&&(w=null),g.sibling.return=g.return,g=g.sibling}R&4&&(R=h.updateQueue,R!==null&&(w=R.retryQueue,w!==null&&(R.retryQueue=null,c(h,w))));break;case 19:p(g,h),E(h),R&4&&(R=h.updateQueue,R!==null&&(h.updateQueue=null,c(h,R)));break;case 30:break;case 21:break;default:p(g,h),E(h)}}function E(h){var g=h.flags;if(g&2){try{for(var w,R=h.return;R!==null;){if(wg(R)){w=R;break}R=R.return}if(w==null)throw Error(u(160));switch(w.tag){case 27:var j=w.stateNode,q=sm(h);am(h,q,j);break;case 5:var ce=w.stateNode;w.flags&32&&(ma(ce,""),w.flags&=-33);var Me=sm(h);am(h,Me,ce);break;case 3:case 4:var ht=w.stateNode.containerInfo,Vt=sm(h);Tg(h,Vt,ht);break;default:throw Error(u(161))}}catch(sn){ar(h,h.return,sn)}h.flags&=-3}g&4096&&(h.flags&=-4097)}function I(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var g=h;I(g),g.tag===5&&g.flags&1024&&g.stateNode.reset(),h=h.sibling}}function M(h,g){if(g.subtreeFlags&8772)for(g=g.child;g!==null;)Vo(h,g.alternate,g),g=g.sibling}function O(h){for(h=h.child;h!==null;){var g=h;switch(g.tag){case 0:case 11:case 14:case 15:su(4,g,g.return),O(g);break;case 1:Xl(g,g.return);var w=g.stateNode;typeof w.componentWillUnmount=="function"&&vg(g,g.return,w),O(g);break;case 27:Lg(g.stateNode);case 26:case 5:Xl(g,g.return),O(g);break;case 22:g.memoizedState===null&&O(g);break;case 30:O(g);break;default:O(g)}h=h.sibling}}function z(h,g,w){for(w=w&&(g.subtreeFlags&8772)!==0,g=g.child;g!==null;){var R=g.alternate,j=h,q=g,ce=q.flags;switch(q.tag){case 0:case 11:case 15:z(j,q,w),ru(4,q);break;case 1:if(z(j,q,w),R=q,j=R.stateNode,typeof j.componentDidMount=="function")try{j.componentDidMount()}catch(Vt){ar(R,R.return,Vt)}if(R=q,j=R.updateQueue,j!==null){var Me=R.stateNode;try{var ht=j.shared.hiddenCallbacks;if(ht!==null)for(j.shared.hiddenCallbacks=null,j=0;j<ht.length;j++)xh(ht[j],Me)}catch(Vt){ar(R,R.return,Vt)}}w&&ce&64&&rm(q),Nd(q,q.return);break;case 27:Bd(q);case 26:case 5:z(j,q,w),w&&R===null&&ce&4&&bg(q),Nd(q,q.return);break;case 12:z(j,q,w);break;case 31:z(j,q,w),w&&ce&4&&ix(j,q);break;case 13:z(j,q,w),w&&ce&4&&f(j,q);break;case 22:q.memoizedState===null&&z(j,q,w),Nd(q,q.return);break;case 30:break;default:z(j,q,w)}g=g.sibling}}function H(h,g){var w=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),h=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(h=g.memoizedState.cachePool.pool),h!==w&&(h!=null&&h.refCount++,w!=null&&Xc(w))}function G(h,g){h=null,g.alternate!==null&&(h=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==h&&(g.refCount++,h!=null&&Xc(h))}function $(h,g,w,R){if(g.subtreeFlags&10256)for(g=g.child;g!==null;)J(h,g,w,R),g=g.sibling}function J(h,g,w,R){var j=g.flags;switch(g.tag){case 0:case 11:case 15:$(h,g,w,R),j&2048&&ru(9,g);break;case 1:$(h,g,w,R);break;case 3:$(h,g,w,R),j&2048&&(h=null,g.alternate!==null&&(h=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==h&&(g.refCount++,h!=null&&Xc(h)));break;case 12:if(j&2048){$(h,g,w,R),h=g.stateNode;try{var q=g.memoizedProps,ce=q.id,Me=q.onPostCommit;typeof Me=="function"&&Me(ce,g.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(ht){ar(g,g.return,ht)}}else $(h,g,w,R);break;case 31:$(h,g,w,R);break;case 13:$(h,g,w,R);break;case 23:break;case 22:q=g.stateNode,ce=g.alternate,g.memoizedState!==null?q._visibility&2?$(h,g,w,R):ee(h,g):q._visibility&2?$(h,g,w,R):(q._visibility|=2,K(h,g,w,R,(g.subtreeFlags&10256)!==0||!1)),j&2048&&H(ce,g);break;case 24:$(h,g,w,R),j&2048&&G(g.alternate,g);break;default:$(h,g,w,R)}}function K(h,g,w,R,j){for(j=j&&((g.subtreeFlags&10256)!==0||!1),g=g.child;g!==null;){var q=h,ce=g,Me=w,ht=R,Vt=ce.flags;switch(ce.tag){case 0:case 11:case 15:K(q,ce,Me,ht,j),ru(8,ce);break;case 23:break;case 22:var sn=ce.stateNode;ce.memoizedState!==null?sn._visibility&2?K(q,ce,Me,ht,j):ee(q,ce):(sn._visibility|=2,K(q,ce,Me,ht,j)),j&&Vt&2048&&H(ce.alternate,ce);break;case 24:K(q,ce,Me,ht,j),j&&Vt&2048&&G(ce.alternate,ce);break;default:K(q,ce,Me,ht,j)}g=g.sibling}}function ee(h,g){if(g.subtreeFlags&10256)for(g=g.child;g!==null;){var w=h,R=g,j=R.flags;switch(R.tag){case 22:ee(w,R),j&2048&&H(R.alternate,R);break;case 24:ee(w,R),j&2048&&G(R.alternate,R);break;default:ee(w,R)}g=g.sibling}}var re=8192;function pe(h,g,w){if(h.subtreeFlags&re)for(h=h.child;h!==null;)fe(h,g,w),h=h.sibling}function fe(h,g,w){switch(h.tag){case 26:pe(h,g,w),h.flags&re&&h.memoizedState!==null&&rl(w,x,h.memoizedState,h.memoizedProps);break;case 5:pe(h,g,w);break;case 3:case 4:var R=x;x=Og(h.stateNode.containerInfo),pe(h,g,w),x=R;break;case 22:h.memoizedState===null&&(R=h.alternate,R!==null&&R.memoizedState!==null?(R=re,re=16777216,pe(h,g,w),re=R):pe(h,g,w));break;default:pe(h,g,w)}}function ue(h){var g=h.alternate;if(g!==null&&(h=g.child,h!==null)){g.child=null;do g=h.sibling,h.sibling=null,h=g;while(h!==null)}}function Ie(h){var g=h.deletions;if((h.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var R=g[w];Hr=R,be(R,h)}ue(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Te(h),h=h.sibling}function Te(h){switch(h.tag){case 0:case 11:case 15:Ie(h),h.flags&2048&&su(9,h,h.return);break;case 3:Ie(h);break;case 12:Ie(h);break;case 22:var g=h.stateNode;h.memoizedState!==null&&g._visibility&2&&(h.return===null||h.return.tag!==13)?(g._visibility&=-3,Ae(h)):Ie(h);break;default:Ie(h)}}function Ae(h){var g=h.deletions;if((h.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var R=g[w];Hr=R,be(R,h)}ue(h)}for(h=h.child;h!==null;){switch(g=h,g.tag){case 0:case 11:case 15:su(8,g,g.return),Ae(g);break;case 22:w=g.stateNode,w._visibility&2&&(w._visibility&=-3,Ae(g));break;default:Ae(g)}h=h.sibling}}function be(h,g){for(;Hr!==null;){var w=Hr;switch(w.tag){case 0:case 11:case 15:su(8,w,g);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var R=w.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:Xc(w.memoizedState.cache)}if(R=w.child,R!==null)R.return=w,Hr=R;else e:for(w=h;Hr!==null;){R=Hr;var j=R.sibling,q=R.return;if(Fd(R),R===w){Hr=null;break e}if(j!==null){j.return=q,Hr=j;break e}Hr=q}}}var ge={getCacheForType:function(h){var g=va(Sr),w=g.data.get(h);return w===void 0&&(w=h(),g.data.set(h,w)),w},cacheSignal:function(){return va(Sr).controller.signal}},ke=typeof WeakMap=="function"?WeakMap:Map,ze=0,je=null,Xe=null,Ze=0,ut=0,xt=null,et=!1,Le=!1,mt=!1,rt=0,yt=0,kt=0,qt=0,zt=0,Lt=0,un=0,an=null,Zt=null,on=!1,xn=0,Dn=0,jn=1/0,ni=null,Pn=null,Un=0,Nn=null,bi=null,pi=0,Di=0,ci=null,Gn=null,_i=0,pr=null;function Pi(){return(ze&2)!==0&&Ze!==0?Ze&-Ze:wt.T!==null?Ag():ne()}function Si(){if(Lt===0)if((Ze&536870912)===0||dr){var h=bo;bo<<=1,(bo&3932160)===0&&(bo=262144),Lt=h}else Lt=536870912;return h=Ma.current,h!==null&&(h.flags|=32),Lt}function Fn(h,g,w){(h===je&&(ut===2||ut===9)||h.cancelPendingCommit!==null)&&(Qs(h,0),Bi(h,Ze,Lt,!1)),hl(h,w),((ze&2)===0||h!==je)&&(h===je&&((ze&2)===0&&(qt|=w),yt===4&&Bi(h,Ze,Lt,!1)),ju(h))}function Hn(h,g,w){if((ze&6)!==0)throw Error(u(327));var R=!w&&(g&127)===0&&(g&h.expiredLanes)===0||wo(h,g),j=R?wr(h,g):jo(h,g,!0),q=R;do{if(j===0){Le&&!R&&Bi(h,g,0,!1);break}else{if(w=h.current.alternate,q&&!Lr(w)){j=jo(h,g,!1),q=!1;continue}if(j===2){if(q=g,h.errorRecoveryDisabledLanes&q)var ce=0;else ce=h.pendingLanes&-536870913,ce=ce!==0?ce:ce&536870912?536870912:0;if(ce!==0){g=ce;e:{var Me=h;j=an;var ht=Me.current.memoizedState.isDehydrated;if(ht&&(Qs(Me,ce).flags|=256),ce=jo(Me,ce,!1),ce!==2){if(mt&&!ht){Me.errorRecoveryDisabledLanes|=q,qt|=q,j=4;break e}q=Zt,Zt=j,q!==null&&(Zt===null?Zt=q:Zt.push.apply(Zt,q))}j=ce}if(q=!1,j!==2)continue}}if(j===1){Qs(h,0),Bi(h,g,0,!0);break}e:{switch(R=h,q=j,q){case 0:case 1:throw Error(u(345));case 4:if((g&4194048)!==g)break;case 6:Bi(R,g,Lt,!et);break e;case 2:Zt=null;break;case 3:case 5:break;default:throw Error(u(329))}if((g&62914560)===g&&(j=xn+300-jr(),10<j)){if(Bi(R,g,Lt,!et),Kr(R,0,!0)!==0)break e;pi=g,R.timeoutHandle=cm(Ki.bind(null,R,w,Zt,ni,on,g,Lt,qt,un,et,q,"Throttled",-0,0),j);break e}Ki(R,w,Zt,ni,on,g,Lt,qt,un,et,q,null,-0,0)}}break}while(!0);ju(h)}function Ki(h,g,w,R,j,q,ce,Me,ht,Vt,sn,hn,Ut,Yt){if(h.timeoutHandle=-1,hn=g.subtreeFlags,hn&8192||(hn&16785408)===16785408){hn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:As},fe(g,q,hn);var Wn=(q&62914560)===q?xn-jr():(q&4194048)===q?Dn-jr():0;if(Wn=T0(hn,Wn),Wn!==null){pi=q,h.cancelPendingCommit=Wn(Vd.bind(null,h,g,q,w,R,j,ce,Me,ht,sn,hn,null,Ut,Yt)),Bi(h,q,ce,!Vt);return}}Vd(h,g,q,w,R,j,ce,Me,ht)}function Lr(h){for(var g=h;;){var w=g.tag;if((w===0||w===11||w===15)&&g.flags&16384&&(w=g.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var R=0;R<w.length;R++){var j=w[R],q=j.getSnapshot;j=j.value;try{if(!oo(q(),j))return!1}catch{return!1}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Bi(h,g,w,R){g&=~zt,g&=~qt,h.suspendedLanes|=g,h.pingedLanes&=~g,R&&(h.warmLanes|=g),R=h.expirationTimes;for(var j=g;0<j;){var q=31-Fi(j),ce=1<<q;R[q]=-1,j&=~ce}w!==0&&no(h,w,g)}function Qi(){return(ze&6)===0?(Gd(0),!1):!0}function wa(){if(Xe!==null){if(ut===0)var h=Xe.return;else h=Xe,mc=gl=null,Nf(h),Cu=null,wd=0,h=Xe;for(;h!==null;)xg(h.alternate,h),h=h.return;Xe=null}}function Qs(h,g){var w=h.timeoutHandle;w!==-1&&(h.timeoutHandle=-1,K1(w)),w=h.cancelPendingCommit,w!==null&&(h.cancelPendingCommit=null,w()),pi=0,wa(),je=h,Xe=w=co(h.current,null),Ze=g,ut=0,xt=null,et=!1,Le=wo(h,g),mt=!1,un=Lt=zt=qt=kt=yt=0,Zt=an=null,on=!1,(g&8)!==0&&(g|=g&32);var R=h.entangledLanes;if(R!==0)for(h=h.entanglements,R&=g;0<R;){var j=31-Fi(R),q=1<<j;g|=h[j],R&=~q}return rt=g,uh(),w}function ks(h,g){Ft=null,wt.H=ql,g===bd||g===Mf?(g=eg(),ut=3):g===Jm?(g=eg(),ut=4):ut=g===Xf?8:g!==null&&typeof g=="object"&&typeof g.then=="function"?6:1,xt=g,Xe===null&&(yt=1,Wf(h,aa(g,h.current)))}function Ai(){var h=Ma.current;return h===null?!0:(Ze&4194048)===Ze?ba===null:(Ze&62914560)===Ze||(Ze&536870912)!==0?h===ba:!1}function fo(){var h=wt.H;return wt.H=ql,h===null?ql:h}function Js(){var h=wt.A;return wt.A=ge,h}function la(){yt=4,et||(Ze&4194048)!==Ze&&Ma.current!==null||(Le=!0),(kt&134217727)===0&&(qt&134217727)===0||je===null||Bi(je,Ze,Lt,!1)}function jo(h,g,w){var R=ze;ze|=2;var j=fo(),q=Js();(je!==h||Ze!==g)&&(ni=null,Qs(h,g)),g=!1;var ce=yt;e:do try{if(ut!==0&&Xe!==null){var Me=Xe,ht=xt;switch(ut){case 8:wa(),ce=6;break e;case 3:case 2:case 9:case 6:Ma.current===null&&(g=!0);var Vt=ut;if(ut=0,xt=null,Rs(h,Me,ht,Vt),w&&Le){ce=0;break e}break;default:Vt=ut,ut=0,xt=null,Rs(h,Me,ht,Vt)}}Wa(),ce=yt;break}catch(sn){ks(h,sn)}while(!0);return g&&h.shellSuspendCounter++,mc=gl=null,ze=R,wt.H=j,wt.A=q,Xe===null&&(je=null,Ze=0,uh()),ce}function Wa(){for(;Xe!==null;)rr(Xe)}function wr(h,g){var w=ze;ze|=2;var R=fo(),j=Js();je!==h||Ze!==g?(ni=null,jn=jr()+500,Qs(h,g)):Le=wo(h,g);e:do try{if(ut!==0&&Xe!==null){g=Xe;var q=xt;t:switch(ut){case 1:ut=0,xt=null,Rs(h,g,q,1);break;case 2:case 9:if(Pf(q)){ut=0,xt=null,ss(g);break}g=function(){ut!==2&&ut!==9||je!==h||(ut=7),ju(h)},q.then(g,g);break e;case 3:ut=7;break e;case 4:ut=5;break e;case 7:Pf(q)?(ut=0,xt=null,ss(g)):(ut=0,xt=null,Rs(h,g,q,7));break;case 5:var ce=null;switch(Xe.tag){case 26:ce=Xe.memoizedState;case 5:case 27:var Me=Xe;if(ce?Ex(ce):Me.stateNode.complete){ut=0,xt=null;var ht=Me.sibling;if(ht!==null)Xe=ht;else{var Vt=Me.return;Vt!==null?(Xe=Vt,Ar(Vt)):Xe=null}break t}}ut=0,xt=null,Rs(h,g,q,5);break;case 6:ut=0,xt=null,Rs(h,g,q,6);break;case 8:wa(),yt=6;break e;default:throw Error(u(462))}}Jr();break}catch(sn){ks(h,sn)}while(!0);return mc=gl=null,wt.H=R,wt.A=j,ze=w,Xe!==null?0:(je=null,Ze=0,uh(),yt)}function Jr(){for(;Xe!==null&&!Rl();)rr(Xe)}function rr(h){var g=Jf(h.alternate,h,rt);h.memoizedProps=h.pendingProps,g===null?Ar(h):Xe=g}function ss(h){var g=h,w=g.alternate;switch(g.tag){case 15:case 0:g=Yf(w,g,g.pendingProps,g.type,void 0,Ze);break;case 11:g=Yf(w,g,g.pendingProps,g.type.render,g.ref,Ze);break;case 5:Nf(g);default:xg(w,g),g=Xe=qc(g,rt),g=Jf(w,g,rt)}h.memoizedProps=h.pendingProps,g===null?Ar(h):Xe=g}function Rs(h,g,w,R){mc=gl=null,Nf(g),Cu=null,wd=0;var j=g.return;try{if(Md(h,j,g,w,Ze)){yt=1,Wf(h,aa(w,h.current)),Xe=null;return}}catch(q){if(j!==null)throw Xe=j,q;yt=1,Wf(h,aa(w,h.current)),Xe=null;return}g.flags&32768?(dr||R===1?h=!0:Le||(Ze&536870912)!==0?h=!1:(et=h=!0,(R===2||R===9||R===3||R===6)&&(R=Ma.current,R!==null&&R.tag===13&&(R.flags|=16384))),po(g,h)):Ar(g)}function Ar(h){var g=h;do{if((g.flags&32768)!==0){po(g,et);return}h=g.return;var w=tp(g.alternate,g,rt);if(w!==null){Xe=w;return}if(g=g.sibling,g!==null){Xe=g;return}Xe=g=h}while(g!==null);yt===0&&(yt=5)}function po(h,g){do{var w=L_(h.alternate,h);if(w!==null){w.flags&=32767,Xe=w;return}if(w=h.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!g&&(h=h.sibling,h!==null)){Xe=h;return}Xe=h=w}while(h!==null);yt=6,Xe=null}function Vd(h,g,w,R,j,q,ce,Me,ht){h.cancelPendingCommit=null;do il();while(Un!==0);if((ze&6)!==0)throw Error(u(327));if(g!==null){if(g===h.current)throw Error(u(177));if(q=g.lanes|g.childLanes,q|=xf,Dt(h,w,q,ce,Me,ht),h===je&&(Xe=je=null,Ze=0),bi=g,Nn=h,pi=w,Di=q,ci=j,Gn=R,(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,o0(si,function(){return Kl(),null})):(h.callbackNode=null,h.callbackPriority=0),R=(g.flags&13878)!==0,(g.subtreeFlags&13878)!==0||R){R=wt.T,wt.T=null,j=Kt.p,Kt.p=2,ce=ze,ze|=4;try{fs(h,g,w)}finally{ze=ce,Kt.p=j,wt.T=R}}Un=1,Yl(),Nh(),Bh()}}function Yl(){if(Un===1){Un=0;var h=Nn,g=bi,w=(g.flags&13878)!==0;if((g.subtreeFlags&13878)!==0||w){w=wt.T,wt.T=null;var R=Kt.p;Kt.p=2;var j=ze;ze|=4;try{b(g,h);var q=V_,ce=v_(h.containerInfo),Me=q.focusedElem,ht=q.selectionRange;if(ce!==Me&&Me&&Me.ownerDocument&&Vc(Me.ownerDocument.documentElement,Me)){if(ht!==null&&lh(Me)){var Vt=ht.start,sn=ht.end;if(sn===void 0&&(sn=Vt),"selectionStart"in Me)Me.selectionStart=Vt,Me.selectionEnd=Math.min(sn,Me.value.length);else{var hn=Me.ownerDocument||document,Ut=hn&&hn.defaultView||window;if(Ut.getSelection){var Yt=Ut.getSelection(),Wn=Me.textContent.length,di=Math.min(ht.start,Wn),$r=ht.end===void 0?di:Math.min(ht.end,Wn);!Yt.extend&&di>$r&&(ce=$r,$r=di,di=ce);var Rt=Yo(Me,di),gt=Yo(Me,$r);if(Rt&&gt&&(Yt.rangeCount!==1||Yt.anchorNode!==Rt.node||Yt.anchorOffset!==Rt.offset||Yt.focusNode!==gt.node||Yt.focusOffset!==gt.offset)){var Bt=hn.createRange();Bt.setStart(Rt.node,Rt.offset),Yt.removeAllRanges(),di>$r?(Yt.addRange(Bt),Yt.extend(gt.node,gt.offset)):(Bt.setEnd(gt.node,gt.offset),Yt.addRange(Bt))}}}}for(hn=[],Yt=Me;Yt=Yt.parentNode;)Yt.nodeType===1&&hn.push({element:Yt,left:Yt.scrollLeft,top:Yt.scrollTop});for(typeof Me.focus=="function"&&Me.focus(),Me=0;Me<hn.length;Me++){var ln=hn[Me];ln.element.scrollLeft=ln.left,ln.element.scrollTop=ln.top}}Vg=!!F_,V_=F_=null}finally{ze=j,Kt.p=R,wt.T=w}}h.current=g,Un=2}}function Nh(){if(Un===2){Un=0;var h=Nn,g=bi,w=(g.flags&8772)!==0;if((g.subtreeFlags&8772)!==0||w){w=wt.T,wt.T=null;var R=Kt.p;Kt.p=2;var j=ze;ze|=4;try{Vo(h,g.alternate,g)}finally{ze=j,Kt.p=R,wt.T=w}}Un=3}}function Bh(){if(Un===4||Un===3){Un=0,rc();var h=Nn,g=bi,w=pi,R=Gn;(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?Un=5:(Un=0,bi=Nn=null,mo(h,h.pendingLanes));var j=h.pendingLanes;if(j===0&&(Pn=null),qe(w),g=g.stateNode,Pr&&typeof Pr.onCommitFiberRoot=="function")try{Pr.onCommitFiberRoot(ms,g,void 0,(g.current.flags&128)===128)}catch{}if(R!==null){g=wt.T,j=Kt.p,Kt.p=2,wt.T=null;try{for(var q=h.onRecoverableError,ce=0;ce<R.length;ce++){var Me=R[ce];q(Me.value,{componentStack:Me.stack})}}finally{wt.T=g,Kt.p=j}}(pi&3)!==0&&il(),ju(h),j=h.pendingLanes,(w&261930)!==0&&(j&42)!==0?h===pr?_i++:(_i=0,pr=h):_i=0,Gd(0)}}function mo(h,g){(h.pooledCacheLanes&=g)===0&&(g=h.pooledCache,g!=null&&(h.pooledCache=null,Xc(g)))}function il(){return Yl(),Nh(),Bh(),Kl()}function Kl(){if(Un!==5)return!1;var h=Nn,g=Di;Di=0;var w=qe(pi),R=wt.T,j=Kt.p;try{Kt.p=32>w?32:w,wt.T=null,w=ci,ci=null;var q=Nn,ce=pi;if(Un=0,bi=Nn=null,pi=0,(ze&6)!==0)throw Error(u(331));var Me=ze;if(ze|=4,Te(q.current),J(q,q.current,ce,w),ze=Me,Gd(0,!1),Pr&&typeof Pr.onPostCommitFiberRoot=="function")try{Pr.onPostCommitFiberRoot(ms,q)}catch{}return!0}finally{Kt.p=j,wt.T=R,mo(h,g)}}function Uo(h,g,w){g=aa(w,g),g=Hl(h.stateNode,g,2),h=Jc(h,g,2),h!==null&&(hl(h,2),ju(h))}function ar(h,g,w){if(h.tag===3)Uo(h,h,w);else for(;g!==null;){if(g.tag===3){Uo(g,h,w);break}else if(g.tag===1){var R=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Pn===null||!Pn.has(R))){h=aa(w,h),w=Tc(2),R=Jc(g,w,2),R!==null&&(Gs(w,R,g,h),hl(R,2),ju(R));break}}g=g.return}}function ou(h,g,w){var R=h.pingCache;if(R===null){R=h.pingCache=new ke;var j=new Set;R.set(g,j)}else j=R.get(g),j===void 0&&(j=new Set,R.set(g,j));j.has(w)||(mt=!0,j.add(w),h=om.bind(null,h,g,w),g.then(h,h))}function om(h,g,w){var R=h.pingCache;R!==null&&R.delete(g),h.pingedLanes|=h.suspendedLanes&w,h.warmLanes&=~w,je===h&&(Ze&w)===w&&(yt===4||yt===3&&(Ze&62914560)===Ze&&300>jr()-xn?(ze&2)===0&&Qs(h,0):zt|=w,un===Ze&&(un=0)),ju(h)}function rx(h,g){g===0&&(g=Va()),h=jt(h,g),h!==null&&(hl(h,g),ju(h))}function s0(h){var g=h.memoizedState,w=0;g!==null&&(w=g.retryLane),rx(h,w)}function a0(h,g){var w=0;switch(h.tag){case 31:case 13:var R=h.stateNode,j=h.memoizedState;j!==null&&(w=j.retryLane);break;case 19:R=h.stateNode;break;case 22:R=h.stateNode._retryCache;break;default:throw Error(u(314))}R!==null&&R.delete(g),rx(h,w)}function o0(h,g){return Xr(h,g)}var Eg=null,Ac=null,O_=!1,ca=!1,jd=!1,Ud=0;function ju(h){h!==Ac&&h.next===null&&(Ac===null?Eg=Ac=h:Ac=Ac.next=h),ca=!0,O_||(O_=!0,W1())}function Gd(h,g){if(!jd&&ca){jd=!0;do for(var w=!1,R=Eg;R!==null;){if(h!==0){var j=R.pendingLanes;if(j===0)var q=0;else{var ce=R.suspendedLanes,Me=R.pingedLanes;q=(1<<31-Fi(42|h)+1)-1,q&=j&~(ce&~Me),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(w=!0,ax(R,q))}else q=Ze,q=Kr(R,R===je?q:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(q&3)===0||wo(R,q)||(w=!0,ax(R,q));R=R.next}while(w);jd=!1}}function Z1(){sx()}function sx(){ca=O_=!1;var h=0;Ud!==0&&g0()&&(h=Ud);for(var g=jr(),w=null,R=Eg;R!==null;){var j=R.next,q=Sg(R,g);q===0?(R.next=null,w===null?Eg=j:w.next=j,j===null&&(Ac=w)):(w=R,(h!==0||(q&3)!==0)&&(ca=!0)),R=j}Un!==0&&Un!==5||Gd(h),Ud!==0&&(Ud=0)}function Sg(h,g){for(var w=h.suspendedLanes,R=h.pingedLanes,j=h.expirationTimes,q=h.pendingLanes&-62914561;0<q;){var ce=31-Fi(q),Me=1<<ce,ht=j[ce];ht===-1?((Me&w)===0||(Me&R)!==0)&&(j[ce]=_u(Me,g)):ht<=g&&(h.expiredLanes|=Me),q&=~Me}if(g=je,w=Ze,w=Kr(h,h===g?w:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),R=h.callbackNode,w===0||h===g&&(ut===2||ut===9)||h.cancelPendingCommit!==null)return R!==null&&R!==null&&to(R),h.callbackNode=null,h.callbackPriority=0;if((w&3)===0||wo(h,w)){if(g=w&-w,g===h.callbackPriority)return g;switch(R!==null&&to(R),qe(w)){case 2:case 8:w=Tn;break;case 32:w=si;break;case 268435456:w=Ii;break;default:w=si}return R=l0.bind(null,h),w=Xr(w,R),h.callbackPriority=g,h.callbackNode=w,g}return R!==null&&R!==null&&to(R),h.callbackPriority=2,h.callbackNode=null,2}function l0(h,g){if(Un!==0&&Un!==5)return h.callbackNode=null,h.callbackPriority=0,null;var w=h.callbackNode;if(il()&&h.callbackNode!==w)return null;var R=Ze;return R=Kr(h,h===je?R:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),R===0?null:(Hn(h,R,g),Sg(h,jr()),h.callbackNode!=null&&h.callbackNode===w?l0.bind(null,h):null)}function ax(h,g){if(il())return null;Hn(h,g,!0)}function W1(){Q1(function(){(ze&6)!==0?Xr(en,Z1):sx()})}function Ag(){if(Ud===0){var h=Yc;h===0&&(h=Ia,Ia<<=1,(Ia&261888)===0&&(Ia=256)),Ud=h}return Ud}function lu(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:Eo(""+h)}function Uu(h,g){var w=g.ownerDocument.createElement("input");return w.name=g.name,w.value=g.value,h.id&&w.setAttribute("form",h.id),g.parentNode.insertBefore(w,g),h=new FormData(h),w.parentNode.removeChild(w),h}function c0(h,g,w,R,j){if(g==="submit"&&w&&w.stateNode===j){var q=lu((j[xe]||null).action),ce=R.submitter;ce&&(g=(g=ce[xe]||null)?lu(g.formAction):ce.getAttribute("formAction"),g!==null&&(q=g,ce=null));var Me=new Ro("action","action",null,R,j);h.push({event:Me,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(Ud!==0){var ht=ce?Uu(j,ce):new FormData(j);Uf(w,{pending:!0,data:ht,method:j.method,action:q},null,ht)}}else typeof q=="function"&&(Me.preventDefault(),ht=ce?Uu(j,ce):new FormData(j),Uf(w,{pending:!0,data:ht,method:j.method,action:q},q,ht))},currentTarget:j}]})}}for(var z_=0;z_<Ha.length;z_++){var lm=Ha[z_],ox=lm.toLowerCase(),Ig=lm[0].toUpperCase()+lm.slice(1);Qo(ox,"on"+Ig)}Qo(Cp,"onAnimationEnd"),Qo(b_,"onAnimationIteration"),Qo(uc,"onAnimationStart"),Qo("dblclick","onDoubleClick"),Qo("focusin","onFocus"),Qo("focusout","onBlur"),Qo(w_,"onTransitionRun"),Qo(T_,"onTransitionStart"),Qo(Rp,"onTransitionCancel"),Qo(Mp,"onTransitionEnd"),nr("onMouseEnter",["mouseout","mouseover"]),nr("onMouseLeave",["mouseout","mouseover"]),nr("onPointerEnter",["pointerout","pointerover"]),nr("onPointerLeave",["pointerout","pointerover"]),xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xr("onBeforeInput",["compositionend","keypress","textInput","paste"]),xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),u0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(qd));function Cg(h,g){g=(g&4)!==0;for(var w=0;w<h.length;w++){var R=h[w],j=R.event;R=R.listeners;e:{var q=void 0;if(g)for(var ce=R.length-1;0<=ce;ce--){var Me=R[ce],ht=Me.instance,Vt=Me.currentTarget;if(Me=Me.listener,ht!==q&&j.isPropagationStopped())break e;q=Me,j.currentTarget=Vt;try{q(j)}catch(sn){cd(sn)}j.currentTarget=null,q=ht}else for(ce=0;ce<R.length;ce++){if(Me=R[ce],ht=Me.instance,Vt=Me.currentTarget,Me=Me.listener,ht!==q&&j.isPropagationStopped())break e;q=Me,j.currentTarget=Vt;try{q(j)}catch(sn){cd(sn)}j.currentTarget=null,q=ht}}}}function or(h,g){var w=g[st];w===void 0&&(w=g[st]=new Set);var R=h+"__bubble";w.has(R)||(Fh(g,h,2,!1),w.add(R))}function Rg(h,g,w){var R=0;g&&(R|=4),Fh(w,h,R,g)}var Mg="_reactListening"+Math.random().toString(36).slice(2);function N_(h){if(!h[Mg]){h[Mg]=!0,kn.forEach(function(w){w!=="selectionchange"&&(u0.has(w)||Rg(w,!1,h),Rg(w,!0,h))});var g=h.nodeType===9?h:h.ownerDocument;g===null||g[Mg]||(g[Mg]=!0,Rg("selectionchange",!1,g))}}function Fh(h,g,w,R){switch(C0(g)){case 2:var j=$_;break;case 8:j=I0;break;default:j=fm}w=j.bind(null,g,w,h),j=void 0,!Ml||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(j=!0),R?j!==void 0?h.addEventListener(g,w,{capture:!0,passive:j}):h.addEventListener(g,w,!0):j!==void 0?h.addEventListener(g,w,{passive:j}):h.addEventListener(g,w,!1)}function B_(h,g,w,R,j){var q=R;if((g&1)===0&&(g&2)===0&&R!==null)e:for(;;){if(R===null)return;var ce=R.tag;if(ce===3||ce===4){var Me=R.stateNode.containerInfo;if(Me===j)break;if(ce===4)for(ce=R.return;ce!==null;){var ht=ce.tag;if((ht===3||ht===4)&&ce.stateNode.containerInfo===j)return;ce=ce.return}for(;Me!==null;){if(ce=yn(Me),ce===null)return;if(ht=ce.tag,ht===5||ht===6||ht===26||ht===27){R=q=ce;continue e}Me=Me.parentNode}}R=R.return}zc(function(){var Vt=q,sn=Ca(w),hn=[];e:{var Ut=Uc.get(h);if(Ut!==void 0){var Yt=Ro,Wn=h;switch(h){case"keypress":if(hi(w)===0)break e;case"keydown":case"keyup":Yt=xa;break;case"focusin":Wn="focus",Yt=Vs;break;case"focusout":Wn="blur",Yt=Vs;break;case"beforeblur":case"afterblur":Yt=Vs;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=Fc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=ac;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=ie;break;case Cp:case b_:case uc:Yt=sh;break;case Mp:Yt=Ce;break;case"scroll":case"scrollend":Yt=Bc;break;case"wheel":Yt=Gt;break;case"copy":case"cut":case"paste":Yt=Ei;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=fi;break;case"toggle":case"beforetoggle":Yt=li}var di=(g&4)!==0,$r=!di&&(h==="scroll"||h==="scrollend"),Rt=di?Ut!==null?Ut+"Capture":null:Ut;di=[];for(var gt=Vt,Bt;gt!==null;){var ln=gt;if(Bt=ln.stateNode,ln=ln.tag,ln!==5&&ln!==26&&ln!==27||Bt===null||Rt===null||(ln=fl(gt,Rt),ln!=null&&di.push(np(gt,ln,Bt))),$r)break;gt=gt.return}0<di.length&&(Ut=new Yt(Ut,Wn,null,w,sn),hn.push({event:Ut,listeners:di}))}}if((g&7)===0){e:{if(Ut=h==="mouseover"||h==="pointerover",Yt=h==="mouseout"||h==="pointerout",Ut&&w!==So&&(Wn=w.relatedTarget||w.fromElement)&&(yn(Wn)||Wn[Fe]))break e;if((Yt||Ut)&&(Ut=sn.window===sn?sn:(Ut=sn.ownerDocument)?Ut.defaultView||Ut.parentWindow:window,Yt?(Wn=w.relatedTarget||w.toElement,Yt=Vt,Wn=Wn?yn(Wn):null,Wn!==null&&($r=T(Wn),di=Wn.tag,Wn!==$r||di!==5&&di!==27&&di!==6)&&(Wn=null)):(Yt=null,Wn=Vt),Yt!==Wn)){if(di=Fc,ln="onMouseLeave",Rt="onMouseEnter",gt="mouse",(h==="pointerout"||h==="pointerover")&&(di=fi,ln="onPointerLeave",Rt="onPointerEnter",gt="pointer"),$r=Yt==null?Ut:Ln(Yt),Bt=Wn==null?Ut:Ln(Wn),Ut=new di(ln,gt+"leave",Yt,w,sn),Ut.target=$r,Ut.relatedTarget=Bt,ln=null,yn(sn)===Vt&&(di=new di(Rt,gt+"enter",Wn,w,sn),di.target=Bt,di.relatedTarget=$r,ln=di),$r=ln,Yt&&Wn)t:{for(di=X1,Rt=Yt,gt=Wn,Bt=0,ln=Rt;ln;ln=di(ln))Bt++;ln=0;for(var mi=gt;mi;mi=di(mi))ln++;for(;0<Bt-ln;)Rt=di(Rt),Bt--;for(;0<ln-Bt;)gt=di(gt),ln--;for(;Bt--;){if(Rt===gt||gt!==null&&Rt===gt.alternate){di=Rt;break t}Rt=di(Rt),gt=di(gt)}di=null}else di=null;Yt!==null&&h0(hn,Ut,Yt,di,!1),Wn!==null&&$r!==null&&h0(hn,$r,Wn,di,!0)}}e:{if(Ut=Vt?Ln(Vt):window,Yt=Ut.nodeName&&Ut.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&Ut.type==="file")var Or=mn;else if(Cs(Ut))if(oh)Or=ld;else{Or=cc;var ii=Xm}else Yt=Ut.nodeName,!Yt||Yt.toLowerCase()!=="input"||Ut.type!=="checkbox"&&Ut.type!=="radio"?Vt&&yu(Vt.elementType)&&(Or=mn):Or=x_;if(Or&&(Or=Or(h,Vt))){kl(hn,Or,w,sn);break e}ii&&ii(h,Ut,Vt),h==="focusout"&&Vt&&Ut.type==="number"&&Vt.memoizedProps.value!=null&&$o(Ut,"number",Ut.value)}switch(ii=Vt?Ln(Vt):window,h){case"focusin":(Cs(ii)||ii.contentEditable==="true")&&(jc=ii,Ap=Vt,qa=null);break;case"focusout":qa=Ap=jc=null;break;case"mousedown":Ip=!0;break;case"contextmenu":case"mouseup":case"dragend":Ip=!1,yf(hn,w,sn);break;case"selectionchange":if(_f)break;case"keydown":case"keyup":yf(hn,w,sn)}var Ji;if(kr)e:{switch(h){case"compositionstart":var gr="onCompositionStart";break e;case"compositionend":gr="onCompositionEnd";break e;case"compositionupdate":gr="onCompositionUpdate";break e}gr=void 0}else Ys?lc(h,w)&&(gr="onCompositionEnd"):h==="keydown"&&w.keyCode===229&&(gr="onCompositionStart");gr&&(Po&&w.locale!=="ko"&&(Ys||gr!=="onCompositionStart"?gr==="onCompositionEnd"&&Ys&&(Ji=rh()):(ga=sn,Nc="value"in ga?ga.value:ga.textContent,Ys=!0)),ii=Dg(Vt,gr),0<ii.length&&(gr=new Pl(gr,h,null,w,sn),hn.push({event:gr,listeners:ii}),Ji?gr.data=Ji:(Ji=Ms(w),Ji!==null&&(gr.data=Ji)))),(Ji=Do?so(h,w):Wm(h,w))&&(gr=Dg(Vt,"onBeforeInput"),0<gr.length&&(ii=new Pl("onBeforeInput","beforeinput",null,w,sn),hn.push({event:ii,listeners:gr}),ii.data=Ji)),c0(hn,h,Vt,w,sn)}Cg(hn,g)})}function np(h,g,w){return{instance:h,listener:g,currentTarget:w}}function Dg(h,g){for(var w=g+"Capture",R=[];h!==null;){var j=h,q=j.stateNode;if(j=j.tag,j!==5&&j!==26&&j!==27||q===null||(j=fl(h,w),j!=null&&R.unshift(np(h,j,q)),j=fl(h,g),j!=null&&R.push(np(h,j,q))),h.tag===3)return R;h=h.return}return[]}function X1(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function h0(h,g,w,R,j){for(var q=g._reactName,ce=[];w!==null&&w!==R;){var Me=w,ht=Me.alternate,Vt=Me.stateNode;if(Me=Me.tag,ht!==null&&ht===R)break;Me!==5&&Me!==26&&Me!==27||Vt===null||(ht=Vt,j?(Vt=fl(w,q),Vt!=null&&ce.unshift(np(w,Vt,ht))):j||(Vt=fl(w,q),Vt!=null&&ce.push(np(w,Vt,ht)))),w=w.return}ce.length!==0&&h.push({event:g,listeners:ce})}var Y1=/\r\n?/g,d0=/\u0000|\uFFFD/g;function lx(h){return(typeof h=="string"?h:""+h).replace(Y1,`
`).replace(d0,"")}function f0(h,g){return g=lx(g),lx(h)===g}function as(h,g,w,R,j,q){switch(w){case"children":typeof R=="string"?g==="body"||g==="textarea"&&R===""||ma(h,R):(typeof R=="number"||typeof R=="bigint")&&g!=="body"&&ma(h,""+R);break;case"className":gi(h,"class",R);break;case"tabIndex":gi(h,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":gi(h,w,R);break;case"style":nh(h,R,q);break;case"data":if(g!=="object"){gi(h,"data",R);break}case"src":case"href":if(R===""&&(g!=="a"||w!=="href")){h.removeAttribute(w);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){h.removeAttribute(w);break}R=Eo(""+R),h.setAttribute(w,R);break;case"action":case"formAction":if(typeof R=="function"){h.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(w==="formAction"?(g!=="input"&&as(h,g,"name",j.name,j,null),as(h,g,"formEncType",j.formEncType,j,null),as(h,g,"formMethod",j.formMethod,j,null),as(h,g,"formTarget",j.formTarget,j,null)):(as(h,g,"encType",j.encType,j,null),as(h,g,"method",j.method,j,null),as(h,g,"target",j.target,j,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){h.removeAttribute(w);break}R=Eo(""+R),h.setAttribute(w,R);break;case"onClick":R!=null&&(h.onclick=As);break;case"onScroll":R!=null&&or("scroll",h);break;case"onScrollEnd":R!=null&&or("scrollend",h);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(u(61));if(w=R.__html,w!=null){if(j.children!=null)throw Error(u(60));h.innerHTML=w}}break;case"multiple":h.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":h.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){h.removeAttribute("xlink:href");break}w=Eo(""+R),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,""+R):h.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,""):h.removeAttribute(w);break;case"capture":case"download":R===!0?h.setAttribute(w,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?h.setAttribute(w,R):h.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?h.setAttribute(w,R):h.removeAttribute(w);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?h.removeAttribute(w):h.setAttribute(w,R);break;case"popover":or("beforetoggle",h),or("toggle",h),Oi(h,"popover",R);break;case"xlinkActuate":Ti(h,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":Ti(h,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":Ti(h,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":Ti(h,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":Ti(h,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":Ti(h,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":Ti(h,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":Ti(h,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":Ti(h,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":Oi(h,"is",R);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=Ss.get(w)||w,Oi(h,w,R))}}function cx(h,g,w,R,j,q){switch(w){case"style":nh(h,R,q);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(u(61));if(w=R.__html,w!=null){if(j.children!=null)throw Error(u(60));h.innerHTML=w}}break;case"children":typeof R=="string"?ma(h,R):(typeof R=="number"||typeof R=="bigint")&&ma(h,""+R);break;case"onScroll":R!=null&&or("scroll",h);break;case"onScrollEnd":R!=null&&or("scrollend",h);break;case"onClick":R!=null&&(h.onclick=As);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$i.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(j=w.endsWith("Capture"),g=w.slice(2,j?w.length-7:void 0),q=h[xe]||null,q=q!=null?q[w]:null,typeof q=="function"&&h.removeEventListener(g,q,j),typeof R=="function")){typeof q!="function"&&q!==null&&(w in h?h[w]=null:h.hasAttribute(w)&&h.removeAttribute(w)),h.addEventListener(g,R,j);break e}w in h?h[w]=R:R===!0?h.setAttribute(w,""):Oi(h,w,R)}}}function go(h,g,w){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":or("error",h),or("load",h);var R=!1,j=!1,q;for(q in w)if(w.hasOwnProperty(q)){var ce=w[q];if(ce!=null)switch(q){case"src":R=!0;break;case"srcSet":j=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,g));default:as(h,g,q,ce,w,null)}}j&&as(h,g,"srcSet",w.srcSet,w,null),R&&as(h,g,"src",w.src,w,null);return;case"input":or("invalid",h);var Me=q=ce=j=null,ht=null,Vt=null;for(R in w)if(w.hasOwnProperty(R)){var sn=w[R];if(sn!=null)switch(R){case"name":j=sn;break;case"type":ce=sn;break;case"checked":ht=sn;break;case"defaultChecked":Vt=sn;break;case"value":q=sn;break;case"defaultValue":Me=sn;break;case"children":case"dangerouslySetInnerHTML":if(sn!=null)throw Error(u(137,g));break;default:as(h,g,R,sn,w,null)}}sa(h,q,Me,ht,Vt,ce,j,!1);return;case"select":or("invalid",h),R=ce=q=null;for(j in w)if(w.hasOwnProperty(j)&&(Me=w[j],Me!=null))switch(j){case"value":q=Me;break;case"defaultValue":ce=Me;break;case"multiple":R=Me;default:as(h,g,j,Me,w,null)}g=q,w=ce,h.multiple=!!R,g!=null?To(h,!!R,g,!1):w!=null&&To(h,!!R,w,!0);return;case"textarea":or("invalid",h),q=j=R=null;for(ce in w)if(w.hasOwnProperty(ce)&&(Me=w[ce],Me!=null))switch(ce){case"value":R=Me;break;case"defaultValue":j=Me;break;case"children":q=Me;break;case"dangerouslySetInnerHTML":if(Me!=null)throw Error(u(91));break;default:as(h,g,ce,Me,w,null)}dl(h,R,j,q);return;case"option":for(ht in w)if(w.hasOwnProperty(ht)&&(R=w[ht],R!=null))switch(ht){case"selected":h.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:as(h,g,ht,R,w,null)}return;case"dialog":or("beforetoggle",h),or("toggle",h),or("cancel",h),or("close",h);break;case"iframe":case"object":or("load",h);break;case"video":case"audio":for(R=0;R<qd.length;R++)or(qd[R],h);break;case"image":or("error",h),or("load",h);break;case"details":or("toggle",h);break;case"embed":case"source":case"link":or("error",h),or("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Vt in w)if(w.hasOwnProperty(Vt)&&(R=w[Vt],R!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,g));default:as(h,g,Vt,R,w,null)}return;default:if(yu(g)){for(sn in w)w.hasOwnProperty(sn)&&(R=w[sn],R!==void 0&&cx(h,g,sn,R,w,void 0));return}}for(Me in w)w.hasOwnProperty(Me)&&(R=w[Me],R!=null&&as(h,g,Me,R,w,null))}function p0(h,g,w,R){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var j=null,q=null,ce=null,Me=null,ht=null,Vt=null,sn=null;for(Yt in w){var hn=w[Yt];if(w.hasOwnProperty(Yt)&&hn!=null)switch(Yt){case"checked":break;case"value":break;case"defaultValue":ht=hn;default:R.hasOwnProperty(Yt)||as(h,g,Yt,null,R,hn)}}for(var Ut in R){var Yt=R[Ut];if(hn=w[Ut],R.hasOwnProperty(Ut)&&(Yt!=null||hn!=null))switch(Ut){case"type":q=Yt;break;case"name":j=Yt;break;case"checked":Vt=Yt;break;case"defaultChecked":sn=Yt;break;case"value":ce=Yt;break;case"defaultValue":Me=Yt;break;case"children":case"dangerouslySetInnerHTML":if(Yt!=null)throw Error(u(137,g));break;default:Yt!==hn&&as(h,g,Ut,Yt,R,hn)}}ra(h,ce,Me,ht,Vt,sn,q,j);return;case"select":Yt=ce=Me=Ut=null;for(q in w)if(ht=w[q],w.hasOwnProperty(q)&&ht!=null)switch(q){case"value":break;case"multiple":Yt=ht;default:R.hasOwnProperty(q)||as(h,g,q,null,R,ht)}for(j in R)if(q=R[j],ht=w[j],R.hasOwnProperty(j)&&(q!=null||ht!=null))switch(j){case"value":Ut=q;break;case"defaultValue":Me=q;break;case"multiple":ce=q;default:q!==ht&&as(h,g,j,q,R,ht)}g=Me,w=ce,R=Yt,Ut!=null?To(h,!!w,Ut,!1):!!R!=!!w&&(g!=null?To(h,!!w,g,!0):To(h,!!w,w?[]:"",!1));return;case"textarea":Yt=Ut=null;for(Me in w)if(j=w[Me],w.hasOwnProperty(Me)&&j!=null&&!R.hasOwnProperty(Me))switch(Me){case"value":break;case"children":break;default:as(h,g,Me,null,R,j)}for(ce in R)if(j=R[ce],q=w[ce],R.hasOwnProperty(ce)&&(j!=null||q!=null))switch(ce){case"value":Ut=j;break;case"defaultValue":Yt=j;break;case"children":break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(u(91));break;default:j!==q&&as(h,g,ce,j,R,q)}ja(h,Ut,Yt);return;case"option":for(var Wn in w)if(Ut=w[Wn],w.hasOwnProperty(Wn)&&Ut!=null&&!R.hasOwnProperty(Wn))switch(Wn){case"selected":h.selected=!1;break;default:as(h,g,Wn,null,R,Ut)}for(ht in R)if(Ut=R[ht],Yt=w[ht],R.hasOwnProperty(ht)&&Ut!==Yt&&(Ut!=null||Yt!=null))switch(ht){case"selected":h.selected=Ut&&typeof Ut!="function"&&typeof Ut!="symbol";break;default:as(h,g,ht,Ut,R,Yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var di in w)Ut=w[di],w.hasOwnProperty(di)&&Ut!=null&&!R.hasOwnProperty(di)&&as(h,g,di,null,R,Ut);for(Vt in R)if(Ut=R[Vt],Yt=w[Vt],R.hasOwnProperty(Vt)&&Ut!==Yt&&(Ut!=null||Yt!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":if(Ut!=null)throw Error(u(137,g));break;default:as(h,g,Vt,Ut,R,Yt)}return;default:if(yu(g)){for(var $r in w)Ut=w[$r],w.hasOwnProperty($r)&&Ut!==void 0&&!R.hasOwnProperty($r)&&cx(h,g,$r,void 0,R,Ut);for(sn in R)Ut=R[sn],Yt=w[sn],!R.hasOwnProperty(sn)||Ut===Yt||Ut===void 0&&Yt===void 0||cx(h,g,sn,Ut,R,Yt);return}}for(var Rt in w)Ut=w[Rt],w.hasOwnProperty(Rt)&&Ut!=null&&!R.hasOwnProperty(Rt)&&as(h,g,Rt,null,R,Ut);for(hn in R)Ut=R[hn],Yt=w[hn],!R.hasOwnProperty(hn)||Ut===Yt||Ut==null&&Yt==null||as(h,g,hn,Ut,R,Yt)}function ux(h){switch(h){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function m0(){if(typeof performance.getEntriesByType=="function"){for(var h=0,g=0,w=performance.getEntriesByType("resource"),R=0;R<w.length;R++){var j=w[R],q=j.transferSize,ce=j.initiatorType,Me=j.duration;if(q&&Me&&ux(ce)){for(ce=0,Me=j.responseEnd,R+=1;R<w.length;R++){var ht=w[R],Vt=ht.startTime;if(Vt>Me)break;var sn=ht.transferSize,hn=ht.initiatorType;sn&&ux(hn)&&(ht=ht.responseEnd,ce+=sn*(ht<Me?1:(Me-Vt)/(ht-Vt)))}if(--R,g+=8*(q+ce)/(j.duration/1e3),h++,10<h)break}}if(0<h)return g/h/1e6}return navigator.connection&&(h=navigator.connection.downlink,typeof h=="number")?h:5}var F_=null,V_=null;function Pg(h){return h.nodeType===9?h:h.ownerDocument}function hx(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function j_(h,g){if(h===0)switch(g){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&g==="foreignObject"?0:h}function Gu(h,g){return h==="textarea"||h==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.children=="bigint"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var ea=null;function g0(){var h=window.event;return h&&h.type==="popstate"?h===ea?!1:(ea=h,!0):(ea=null,!1)}var cm=typeof setTimeout=="function"?setTimeout:void 0,K1=typeof clearTimeout=="function"?clearTimeout:void 0,_0=typeof Promise=="function"?Promise:void 0,Q1=typeof queueMicrotask=="function"?queueMicrotask:typeof _0<"u"?function(h){return _0.resolve(null).then(h).catch(J1)}:cm;function J1(h){setTimeout(function(){throw h})}function Ql(h){return h==="head"}function dx(h,g){var w=g,R=0;do{var j=w.nextSibling;if(h.removeChild(w),j&&j.nodeType===8)if(w=j.data,w==="/$"||w==="/&"){if(R===0){h.removeChild(j),gm(g);return}R--}else if(w==="$"||w==="$?"||w==="$~"||w==="$!"||w==="&")R++;else if(w==="html")Lg(h.ownerDocument.documentElement);else if(w==="head"){w=h.ownerDocument.head,Lg(w);for(var q=w.firstChild;q;){var ce=q.nextSibling,Me=q.nodeName;q[It]||Me==="SCRIPT"||Me==="STYLE"||Me==="LINK"&&q.rel.toLowerCase()==="stylesheet"||w.removeChild(q),q=ce}}else w==="body"&&Lg(h.ownerDocument.body);w=j}while(w);gm(g)}function Hd(h,g){var w=h;h=0;do{var R=w.nextSibling;if(w.nodeType===1?g?(w._stashedDisplay=w.style.display,w.style.display="none"):(w.style.display=w._stashedDisplay||"",w.getAttribute("style")===""&&w.removeAttribute("style")):w.nodeType===3&&(g?(w._stashedText=w.nodeValue,w.nodeValue=""):w.nodeValue=w._stashedText||""),R&&R.nodeType===8)if(w=R.data,w==="/$"){if(h===0)break;h--}else w!=="$"&&w!=="$?"&&w!=="$~"&&w!=="$!"||h++;w=R}while(w)}function ip(h){var g=h.firstChild;for(g&&g.nodeType===10&&(g=g.nextSibling);g;){var w=g;switch(g=g.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":ip(w),tn(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}h.removeChild(w)}}function ew(h,g,w,R){for(;h.nodeType===1;){var j=w;if(h.nodeName.toLowerCase()!==g.toLowerCase()){if(!R&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(R){if(!h[It])switch(g){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(q=h.getAttribute("rel"),q==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(q!==j.rel||h.getAttribute("href")!==(j.href==null||j.href===""?null:j.href)||h.getAttribute("crossorigin")!==(j.crossOrigin==null?null:j.crossOrigin)||h.getAttribute("title")!==(j.title==null?null:j.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(q=h.getAttribute("src"),(q!==(j.src==null?null:j.src)||h.getAttribute("type")!==(j.type==null?null:j.type)||h.getAttribute("crossorigin")!==(j.crossOrigin==null?null:j.crossOrigin))&&q&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(g==="input"&&h.type==="hidden"){var q=j.name==null?null:""+j.name;if(j.type==="hidden"&&h.getAttribute("name")===q)return h}else return h;if(h=Ic(h.nextSibling),h===null)break}return null}function tw(h,g,w){if(g==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!w||(h=Ic(h.nextSibling),h===null))return null;return h}function y0(h,g){for(;h.nodeType!==8;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!g||(h=Ic(h.nextSibling),h===null))return null;return h}function fx(h){return h.data==="$?"||h.data==="$~"}function px(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState!=="loading"}function nw(h,g){var w=h.ownerDocument;if(h.data==="$~")h._reactRetry=g;else if(h.data!=="$?"||w.readyState!=="loading")g();else{var R=function(){g(),w.removeEventListener("DOMContentLoaded",R)};w.addEventListener("DOMContentLoaded",R),h._reactRetry=R}}function Ic(h){for(;h!=null;h=h.nextSibling){var g=h.nodeType;if(g===1||g===3)break;if(g===8){if(g=h.data,g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"||g==="F!"||g==="F")break;if(g==="/$"||g==="/&")return null}}return h}var kg=null;function x0(h){h=h.nextSibling;for(var g=0;h;){if(h.nodeType===8){var w=h.data;if(w==="/$"||w==="/&"){if(g===0)return Ic(h.nextSibling);g--}else w!=="$"&&w!=="$!"&&w!=="$?"&&w!=="$~"&&w!=="&"||g++}h=h.nextSibling}return null}function mx(h){h=h.previousSibling;for(var g=0;h;){if(h.nodeType===8){var w=h.data;if(w==="$"||w==="$!"||w==="$?"||w==="$~"||w==="&"){if(g===0)return h;g--}else w!=="/$"&&w!=="/&"||g++}h=h.previousSibling}return null}function um(h,g,w){switch(g=Pg(w),h){case"html":if(h=g.documentElement,!h)throw Error(u(452));return h;case"head":if(h=g.head,!h)throw Error(u(453));return h;case"body":if(h=g.body,!h)throw Error(u(454));return h;default:throw Error(u(451))}}function Lg(h){for(var g=h.attributes;g.length;)h.removeAttributeNode(g[0]);tn(h)}var Ir=new Map,rp=new Set;function Og(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var Cc=Kt.d;Kt.d={f:U_,r:zg,D:Ng,C:_x,L:Bg,m:iw,X:yx,S:v0,M:xx};function U_(){var h=Cc.f(),g=Qi();return h||g}function zg(h){var g=bn(h);g!==null&&g.tag===5&&g.type==="form"?fg(g):Cc.r(h)}var sp=typeof document>"u"?null:document;function gx(h,g,w){var R=sp;if(R&&typeof g=="string"&&g){var j=ys(g);j='link[rel="'+h+'"][href="'+j+'"]',typeof w=="string"&&(j+='[crossorigin="'+w+'"]'),rp.has(j)||(rp.add(j),h={rel:h,crossOrigin:w,href:g},R.querySelector(j)===null&&(g=R.createElement("link"),go(g,"link",h),vn(g),R.head.appendChild(g)))}}function Ng(h){Cc.D(h),gx("dns-prefetch",h,null)}function _x(h,g){Cc.C(h,g),gx("preconnect",h,g)}function Bg(h,g,w){Cc.L(h,g,w);var R=sp;if(R&&h&&g){var j='link[rel="preload"][as="'+ys(g)+'"]';g==="image"&&w&&w.imageSrcSet?(j+='[imagesrcset="'+ys(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(j+='[imagesizes="'+ys(w.imageSizes)+'"]')):j+='[href="'+ys(h)+'"]';var q=j;switch(g){case"style":q=hm(h);break;case"script":q=$d(h)}Ir.has(q)||(h=Y({rel:"preload",href:g==="image"&&w&&w.imageSrcSet?void 0:h,as:g},w),Ir.set(q,h),R.querySelector(j)!==null||g==="style"&&R.querySelector(Oa(q))||g==="script"&&R.querySelector(ap(q))||(g=R.createElement("link"),go(g,"link",h),vn(g),R.head.appendChild(g)))}}function iw(h,g){Cc.m(h,g);var w=sp;if(w&&h){var R=g&&typeof g.as=="string"?g.as:"script",j='link[rel="modulepreload"][as="'+ys(R)+'"][href="'+ys(h)+'"]',q=j;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=$d(h)}if(!Ir.has(q)&&(h=Y({rel:"modulepreload",href:h},g),Ir.set(q,h),w.querySelector(j)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(ap(q)))return}R=w.createElement("link"),go(R,"link",h),vn(R),w.head.appendChild(R)}}}function v0(h,g,w){Cc.S(h,g,w);var R=sp;if(R&&h){var j=Vn(R).hoistableStyles,q=hm(h);g=g||"default";var ce=j.get(q);if(!ce){var Me={loading:0,preload:null};if(ce=R.querySelector(Oa(q)))Me.loading=5;else{h=Y({rel:"stylesheet",href:h,"data-precedence":g},w),(w=Ir.get(q))&&wx(h,w);var ht=ce=R.createElement("link");vn(ht),go(ht,"link",h),ht._p=new Promise(function(Vt,sn){ht.onload=Vt,ht.onerror=sn}),ht.addEventListener("load",function(){Me.loading|=1}),ht.addEventListener("error",function(){Me.loading|=2}),Me.loading|=4,za(ce,g,R)}ce={type:"stylesheet",instance:ce,count:1,state:Me},j.set(q,ce)}}}function yx(h,g){Cc.X(h,g);var w=sp;if(w&&h){var R=Vn(w).hoistableScripts,j=$d(h),q=R.get(j);q||(q=w.querySelector(ap(j)),q||(h=Y({src:h,async:!0},g),(g=Ir.get(j))&&Fg(h,g),q=w.createElement("script"),vn(q),go(q,"link",h),w.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(j,q))}}function xx(h,g){Cc.M(h,g);var w=sp;if(w&&h){var R=Vn(w).hoistableScripts,j=$d(h),q=R.get(j);q||(q=w.querySelector(ap(j)),q||(h=Y({src:h,async:!0,type:"module"},g),(g=Ir.get(j))&&Fg(h,g),q=w.createElement("script"),vn(q),go(q,"link",h),w.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(j,q))}}function qu(h,g,w,R){var j=(j=$n.current)?Og(j):null;if(!j)throw Error(u(446));switch(h){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(g=hm(w.href),w=Vn(j).hoistableStyles,R=w.get(g),R||(R={type:"style",instance:null,count:0,state:null},w.set(g,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){h=hm(w.href);var q=Vn(j).hoistableStyles,ce=q.get(h);if(ce||(j=j.ownerDocument||j,ce={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(h,ce),(q=j.querySelector(Oa(h)))&&!q._p&&(ce.instance=q,ce.state.loading=5),Ir.has(h)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},Ir.set(h,w),q||vx(j,h,w,ce.state))),g&&R===null)throw Error(u(528,""));return ce}if(g&&R!==null)throw Error(u(529,""));return null;case"script":return g=w.async,w=w.src,typeof w=="string"&&g&&typeof g!="function"&&typeof g!="symbol"?(g=$d(w),w=Vn(j).hoistableScripts,R=w.get(g),R||(R={type:"script",instance:null,count:0,state:null},w.set(g,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,h))}}function hm(h){return'href="'+ys(h)+'"'}function Oa(h){return'link[rel="stylesheet"]['+h+"]"}function b0(h){return Y({},h,{"data-precedence":h.precedence,precedence:null})}function vx(h,g,w,R){h.querySelector('link[rel="preload"][as="style"]['+g+"]")?R.loading=1:(g=h.createElement("link"),R.preload=g,g.addEventListener("load",function(){return R.loading|=1}),g.addEventListener("error",function(){return R.loading|=2}),go(g,"link",w),vn(g),h.head.appendChild(g))}function $d(h){return'[src="'+ys(h)+'"]'}function ap(h){return"script[async]"+h}function bx(h,g,w){if(g.count++,g.instance===null)switch(g.type){case"style":var R=h.querySelector('style[data-href~="'+ys(w.href)+'"]');if(R)return g.instance=R,vn(R),R;var j=Y({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return R=(h.ownerDocument||h).createElement("style"),vn(R),go(R,"style",j),za(R,w.precedence,h),g.instance=R;case"stylesheet":j=hm(w.href);var q=h.querySelector(Oa(j));if(q)return g.state.loading|=4,g.instance=q,vn(q),q;R=b0(w),(j=Ir.get(j))&&wx(R,j),q=(h.ownerDocument||h).createElement("link"),vn(q);var ce=q;return ce._p=new Promise(function(Me,ht){ce.onload=Me,ce.onerror=ht}),go(q,"link",R),g.state.loading|=4,za(q,w.precedence,h),g.instance=q;case"script":return q=$d(w.src),(j=h.querySelector(ap(q)))?(g.instance=j,vn(j),j):(R=w,(j=Ir.get(q))&&(R=Y({},w),Fg(R,j)),h=h.ownerDocument||h,j=h.createElement("script"),vn(j),go(j,"link",R),h.head.appendChild(j),g.instance=j);case"void":return null;default:throw Error(u(443,g.type))}else g.type==="stylesheet"&&(g.state.loading&4)===0&&(R=g.instance,g.state.loading|=4,za(R,w.precedence,h));return g.instance}function za(h,g,w){for(var R=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),j=R.length?R[R.length-1]:null,q=j,ce=0;ce<R.length;ce++){var Me=R[ce];if(Me.dataset.precedence===g)q=Me;else if(q!==j)break}q?q.parentNode.insertBefore(h,q.nextSibling):(g=w.nodeType===9?w.head:w,g.insertBefore(h,g.firstChild))}function wx(h,g){h.crossOrigin==null&&(h.crossOrigin=g.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=g.referrerPolicy),h.title==null&&(h.title=g.title)}function Fg(h,g){h.crossOrigin==null&&(h.crossOrigin=g.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=g.referrerPolicy),h.integrity==null&&(h.integrity=g.integrity)}var Zd=null;function op(h,g,w){if(Zd===null){var R=new Map,j=Zd=new Map;j.set(w,R)}else j=Zd,R=j.get(w),R||(R=new Map,j.set(w,R));if(R.has(h))return R;for(R.set(h,null),w=w.getElementsByTagName(h),j=0;j<w.length;j++){var q=w[j];if(!(q[It]||q[Pe]||h==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var ce=q.getAttribute(g)||"";ce=h+ce;var Me=R.get(ce);Me?Me.push(q):R.set(ce,[q])}}return R}function Tx(h,g,w){h=h.ownerDocument||h,h.head.insertBefore(w,g==="title"?h.querySelector("head > title"):null)}function w0(h,g,w){if(w===1||g.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof g.precedence!="string"||typeof g.href!="string"||g.href==="")break;return!0;case"link":if(typeof g.rel!="string"||typeof g.href!="string"||g.href===""||g.onLoad||g.onError)break;switch(g.rel){case"stylesheet":return h=g.disabled,typeof g.precedence=="string"&&h==null;default:return!0}case"script":if(g.async&&typeof g.async!="function"&&typeof g.async!="symbol"&&!g.onLoad&&!g.onError&&g.src&&typeof g.src=="string")return!0}return!1}function Ex(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}function rl(h,g,w,R){if(w.type==="stylesheet"&&(typeof R.media!="string"||matchMedia(R.media).matches!==!1)&&(w.state.loading&4)===0){if(w.instance===null){var j=hm(R.href),q=g.querySelector(Oa(j));if(q){g=q._p,g!==null&&typeof g=="object"&&typeof g.then=="function"&&(h.count++,h=Vh.bind(h),g.then(h,h)),w.state.loading|=4,w.instance=q,vn(q);return}q=g.ownerDocument||g,R=b0(R),(j=Ir.get(j))&&wx(R,j),q=q.createElement("link"),vn(q);var ce=q;ce._p=new Promise(function(Me,ht){ce.onload=Me,ce.onerror=ht}),go(q,"link",R),w.instance=q}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(w,g),(g=w.state.preload)&&(w.state.loading&3)===0&&(h.count++,w=Vh.bind(h),g.addEventListener("load",w),g.addEventListener("error",w))}}var lp=0;function T0(h,g){return h.stylesheets&&h.count===0&&dm(h,h.stylesheets),0<h.count||0<h.imgCount?function(w){var R=setTimeout(function(){if(h.stylesheets&&dm(h,h.stylesheets),h.unsuspend){var q=h.unsuspend;h.unsuspend=null,q()}},6e4+g);0<h.imgBytes&&lp===0&&(lp=62500*m0());var j=setTimeout(function(){if(h.waitingForImages=!1,h.count===0&&(h.stylesheets&&dm(h,h.stylesheets),h.unsuspend)){var q=h.unsuspend;h.unsuspend=null,q()}},(h.imgBytes>lp?50:800)+g);return h.unsuspend=w,function(){h.unsuspend=null,clearTimeout(R),clearTimeout(j)}}:null}function Vh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)dm(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var Jl=null;function dm(h,g){h.stylesheets=null,h.unsuspend!==null&&(h.count++,Jl=new Map,g.forEach(Wd,h),Jl=null,Vh.call(h))}function Wd(h,g){if(!(g.state.loading&4)){var w=Jl.get(h);if(w)var R=w.get(null);else{w=new Map,Jl.set(h,w);for(var j=h.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<j.length;q++){var ce=j[q];(ce.nodeName==="LINK"||ce.getAttribute("media")!=="not all")&&(w.set(ce.dataset.precedence,ce),R=ce)}R&&w.set(null,R)}j=g.instance,ce=j.getAttribute("data-precedence"),q=w.get(ce)||R,q===R&&w.set(null,j),w.set(ce,j),this.count++,R=Vh.bind(this),j.addEventListener("load",R),j.addEventListener("error",R),q?q.parentNode.insertBefore(j,q.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(j,h.firstChild)),g.state.loading|=4}}var Rc={$$typeof:Ge,Provider:null,Consumer:null,_currentValue:wn,_currentValue2:wn,_threadCount:0};function G_(h,g,w,R,j,q,ce,Me,ht){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ul(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ul(0),this.hiddenUpdates=ul(null),this.identifierPrefix=R,this.onUncaughtError=j,this.onCaughtError=q,this.onRecoverableError=ce,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ht,this.incompleteTransitions=new Map}function q_(h,g,w,R,j,q,ce,Me,ht,Vt,sn,hn){return h=new G_(h,g,w,ce,ht,Vt,sn,hn,Me),g=1,q===!0&&(g|=24),q=lo(3,null,null,g),h.current=q,q.stateNode=h,g=gd(),g.refCount++,h.pooledCache=g,g.refCount++,q.memoizedState={element:R,isDehydrated:w,cache:g},Lf(q),h}function H_(h){return h?(h=hc,h):hc}function E0(h,g,w,R,j,q){j=H_(j),R.context===null?R.context=j:R.pendingContext=j,R=yc(g),R.payload={element:w},q=q===void 0?null:q,q!==null&&(R.callback=q),w=Jc(h,R,g),w!==null&&(Fn(w,h,g),_h(w,h,g))}function S0(h,g){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var w=h.retryLane;h.retryLane=w!==0&&w<g?w:g}}function Sx(h,g){S0(h,g),(h=h.alternate)&&S0(h,g)}function A0(h){if(h.tag===13||h.tag===31){var g=jt(h,67108864);g!==null&&Fn(g,h,67108864),Sx(h,67108864)}}function Ax(h){if(h.tag===13||h.tag===31){var g=Pi();g=oi(g);var w=jt(h,g);w!==null&&Fn(w,h,g),Sx(h,g)}}var Vg=!0;function $_(h,g,w,R){var j=wt.T;wt.T=null;var q=Kt.p;try{Kt.p=2,fm(h,g,w,R)}finally{Kt.p=q,wt.T=j}}function I0(h,g,w,R){var j=wt.T;wt.T=null;var q=Kt.p;try{Kt.p=8,fm(h,g,w,R)}finally{Kt.p=q,wt.T=j}}function fm(h,g,w,R){if(Vg){var j=Z_(R);if(j===null)B_(h,g,R,cp,w),Ug(h,R);else if(M0(j,h,g,w,R))R.stopPropagation();else if(Ug(h,R),g&4&&-1<R0.indexOf(h)){for(;j!==null;){var q=bn(j);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var ce=Vi(q.pendingLanes);if(ce!==0){var Me=q;for(Me.pendingLanes|=2,Me.entangledLanes|=2;ce;){var ht=1<<31-Fi(ce);Me.entanglements[1]|=ht,ce&=~ht}ju(q),(ze&6)===0&&(jn=jr()+500,Gd(0))}}break;case 31:case 13:Me=jt(q,2),Me!==null&&Fn(Me,q,2),Qi(),Sx(q,2)}if(q=Z_(R),q===null&&B_(h,g,R,cp,w),q===j)break;j=q}j!==null&&R.stopPropagation()}else B_(h,g,R,null,w)}}function Z_(h){return h=Ca(h),Ix(h)}var cp=null;function Ix(h){if(cp=null,h=yn(h),h!==null){var g=T(h);if(g===null)h=null;else{var w=g.tag;if(w===13){if(h=C(g),h!==null)return h;h=null}else if(w===31){if(h=s(g),h!==null)return h;h=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;h=null}else g!==h&&(h=null)}}return cp=h,null}function C0(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(bs()){case en:return 2;case Tn:return 8;case si:case Li:return 32;case Ii:return 268435456;default:return 32}default:return 32}}var jg=!1,jh=null,Hu=null,$u=null,pm=new Map,mm=new Map,Uh=[],R0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ug(h,g){switch(h){case"focusin":case"focusout":jh=null;break;case"dragenter":case"dragleave":Hu=null;break;case"mouseover":case"mouseout":$u=null;break;case"pointerover":case"pointerout":pm.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":mm.delete(g.pointerId)}}function vl(h,g,w,R,j,q){return h===null||h.nativeEvent!==q?(h={blockedOn:g,domEventName:w,eventSystemFlags:R,nativeEvent:q,targetContainers:[j]},g!==null&&(g=bn(g),g!==null&&A0(g)),h):(h.eventSystemFlags|=R,g=h.targetContainers,j!==null&&g.indexOf(j)===-1&&g.push(j),h)}function M0(h,g,w,R,j){switch(g){case"focusin":return jh=vl(jh,h,g,w,R,j),!0;case"dragenter":return Hu=vl(Hu,h,g,w,R,j),!0;case"mouseover":return $u=vl($u,h,g,w,R,j),!0;case"pointerover":var q=j.pointerId;return pm.set(q,vl(pm.get(q)||null,h,g,w,R,j)),!0;case"gotpointercapture":return q=j.pointerId,mm.set(q,vl(mm.get(q)||null,h,g,w,R,j)),!0}return!1}function D0(h){var g=yn(h.target);if(g!==null){var w=T(g);if(w!==null){if(g=w.tag,g===13){if(g=C(w),g!==null){h.blockedOn=g,oe(h.priority,function(){Ax(w)});return}}else if(g===31){if(g=s(w),g!==null){h.blockedOn=g,oe(h.priority,function(){Ax(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){h.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}h.blockedOn=null}function W_(h){if(h.blockedOn!==null)return!1;for(var g=h.targetContainers;0<g.length;){var w=Z_(h.nativeEvent);if(w===null){w=h.nativeEvent;var R=new w.constructor(w.type,w);So=R,w.target.dispatchEvent(R),So=null}else return g=bn(w),g!==null&&A0(g),h.blockedOn=w,!1;g.shift()}return!0}function P0(h,g,w){W_(h)&&w.delete(g)}function rw(){jg=!1,jh!==null&&W_(jh)&&(jh=null),Hu!==null&&W_(Hu)&&(Hu=null),$u!==null&&W_($u)&&($u=null),pm.forEach(P0),mm.forEach(P0)}function X_(h,g){h.blockedOn===g&&(h.blockedOn=null,jg||(jg=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,rw)))}var Y_=null;function k0(h){Y_!==h&&(Y_=h,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Y_===h&&(Y_=null);for(var g=0;g<h.length;g+=3){var w=h[g],R=h[g+1],j=h[g+2];if(typeof R!="function"){if(Ix(R||w)===null)continue;break}var q=bn(w);q!==null&&(h.splice(g,3),g-=3,Uf(q,{pending:!0,data:j,method:w.method,action:R},R,j))}}))}function gm(h){function g(ht){return X_(ht,h)}jh!==null&&X_(jh,h),Hu!==null&&X_(Hu,h),$u!==null&&X_($u,h),pm.forEach(g),mm.forEach(g);for(var w=0;w<Uh.length;w++){var R=Uh[w];R.blockedOn===h&&(R.blockedOn=null)}for(;0<Uh.length&&(w=Uh[0],w.blockedOn===null);)D0(w),w.blockedOn===null&&Uh.shift();if(w=(h.ownerDocument||h).$$reactFormReplay,w!=null)for(R=0;R<w.length;R+=3){var j=w[R],q=w[R+1],ce=j[xe]||null;if(typeof q=="function")ce||k0(w);else if(ce){var Me=null;if(q&&q.hasAttribute("formAction")){if(j=q,ce=q[xe]||null)Me=ce.formAction;else if(Ix(j)!==null)continue}else Me=ce.action;typeof Me=="function"?w[R+1]=Me:(w.splice(R,3),R-=3),k0(w)}}}function _m(){function h(q){q.canIntercept&&q.info==="react-transition"&&q.intercept({handler:function(){return new Promise(function(ce){return j=ce})},focusReset:"manual",scroll:"manual"})}function g(){j!==null&&(j(),j=null),R||setTimeout(w,20)}function w(){if(!R&&!navigation.transition){var q=navigation.currentEntry;q&&q.url!=null&&navigation.navigate(q.url,{state:q.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var R=!1,j=null;return navigation.addEventListener("navigate",h),navigation.addEventListener("navigatesuccess",g),navigation.addEventListener("navigateerror",g),setTimeout(w,100),function(){R=!0,navigation.removeEventListener("navigate",h),navigation.removeEventListener("navigatesuccess",g),navigation.removeEventListener("navigateerror",g),j!==null&&(j(),j=null)}}}function Cx(h){this._internalRoot=h}Gg.prototype.render=Cx.prototype.render=function(h){var g=this._internalRoot;if(g===null)throw Error(u(409));var w=g.current,R=Pi();E0(w,R,h,g,null,null)},Gg.prototype.unmount=Cx.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var g=h.containerInfo;E0(h.current,2,null,h,null,null),Qi(),g[Fe]=null}};function Gg(h){this._internalRoot=h}Gg.prototype.unstable_scheduleHydration=function(h){if(h){var g=ne();h={blockedOn:null,target:h,priority:g};for(var w=0;w<Uh.length&&g!==0&&g<Uh[w].priority;w++);Uh.splice(w,0,h),w===0&&D0(h)}};var qg=t.version;if(qg!=="19.2.3")throw Error(u(527,qg,"19.2.3"));Kt.findDOMNode=function(h){var g=h._reactInternals;if(g===void 0)throw typeof h.render=="function"?Error(u(188)):(h=Object.keys(h).join(","),Error(u(268,h)));return h=B(g),h=h!==null?W(h):null,h=h===null?null:h.stateNode,h};var L0={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:wt,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ym=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ym.isDisabled&&ym.supportsFiber)try{ms=ym.inject(L0),Pr=ym}catch{}}return ov.createRoot=function(h,g){if(!y(h))throw Error(u(299));var w=!1,R="",j=k_,q=sr,ce=ti;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(R=g.identifierPrefix),g.onUncaughtError!==void 0&&(j=g.onUncaughtError),g.onCaughtError!==void 0&&(q=g.onCaughtError),g.onRecoverableError!==void 0&&(ce=g.onRecoverableError)),g=q_(h,1,!1,null,null,w,R,null,j,q,ce,_m),h[Fe]=g.current,N_(h),new Cx(g)},ov.hydrateRoot=function(h,g,w){if(!y(h))throw Error(u(299));var R=!1,j="",q=k_,ce=sr,Me=ti,ht=null;return w!=null&&(w.unstable_strictMode===!0&&(R=!0),w.identifierPrefix!==void 0&&(j=w.identifierPrefix),w.onUncaughtError!==void 0&&(q=w.onUncaughtError),w.onCaughtError!==void 0&&(ce=w.onCaughtError),w.onRecoverableError!==void 0&&(Me=w.onRecoverableError),w.formState!==void 0&&(ht=w.formState)),g=q_(h,1,!0,g,w??null,R,j,ht,q,ce,Me,_m),g.context=H_(null),w=g.current,R=Pi(),R=oi(R),j=yc(R),j.callback=null,Jc(w,j,R),w=R,g.current.lanes=w,hl(g,w),ju(g),h[Fe]=g.current,N_(h),new Gg(g)},ov.version="19.2.3",ov}var AC;function SN(){if(AC)return fT.exports;AC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),fT.exports=EN(),fT.exports}var AN=SN();const IN=Uv(AN);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var IC="popstate";function CN(o={}){function t(y,T){let{pathname:C="/",search:s="",hash:V=""}=h_(y.location.hash.substring(1));return!C.startsWith("/")&&!C.startsWith(".")&&(C="/"+C),YT("",{pathname:C,search:s,hash:V},T.state&&T.state.usr||null,T.state&&T.state.key||"default")}function a(y,T){let C=y.document.querySelector("base"),s="";if(C&&C.getAttribute("href")){let V=y.location.href,B=V.indexOf("#");s=B===-1?V:V.slice(0,B)}return s+"#"+(typeof T=="string"?T:Rv(T))}function u(y,T){mu(y.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(T)})`)}return MN(t,a,u,o)}function na(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function mu(o,t){if(!o){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function RN(){return Math.random().toString(36).substring(2,10)}function CC(o,t){return{usr:o.state,key:o.key,idx:t}}function YT(o,t,a=null,u){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof t=="string"?h_(t):t,state:a,key:t&&t.key||u||RN()}}function Rv({pathname:o="/",search:t="",hash:a=""}){return t&&t!=="?"&&(o+=t.charAt(0)==="?"?t:"?"+t),a&&a!=="#"&&(o+=a.charAt(0)==="#"?a:"#"+a),o}function h_(o){let t={};if(o){let a=o.indexOf("#");a>=0&&(t.hash=o.substring(a),o=o.substring(0,a));let u=o.indexOf("?");u>=0&&(t.search=o.substring(u),o=o.substring(0,u)),o&&(t.pathname=o)}return t}function MN(o,t,a,u={}){let{window:y=document.defaultView,v5Compat:T=!1}=u,C=y.history,s="POP",V=null,B=W();B==null&&(B=0,C.replaceState({...C.state,idx:B},""));function W(){return(C.state||{idx:null}).idx}function Y(){s="POP";let Ke=W(),at=Ke==null?null:Ke-B;B=Ke,V&&V({action:s,location:Ye.location,delta:at})}function ae(Ke,at){s="PUSH";let nt=YT(Ye.location,Ke,at);a&&a(nt,Ke),B=W()+1;let Ge=CC(nt,B),Mt=Ye.createHref(nt);try{C.pushState(Ge,"",Mt)}catch(cn){if(cn instanceof DOMException&&cn.name==="DataCloneError")throw cn;y.location.assign(Mt)}T&&V&&V({action:s,location:Ye.location,delta:1})}function he(Ke,at){s="REPLACE";let nt=YT(Ye.location,Ke,at);a&&a(nt,Ke),B=W();let Ge=CC(nt,B),Mt=Ye.createHref(nt);C.replaceState(Ge,"",Mt),T&&V&&V({action:s,location:Ye.location,delta:0})}function Qe(Ke){return DN(Ke)}let Ye={get action(){return s},get location(){return o(y,C)},listen(Ke){if(V)throw new Error("A history only accepts one active listener");return y.addEventListener(IC,Y),V=Ke,()=>{y.removeEventListener(IC,Y),V=null}},createHref(Ke){return t(y,Ke)},createURL:Qe,encodeLocation(Ke){let at=Qe(Ke);return{pathname:at.pathname,search:at.search,hash:at.hash}},push:ae,replace:he,go(Ke){return C.go(Ke)}};return Ye}function DN(o,t=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),na(a,"No window.location.(origin|href) available to create URL");let u=typeof o=="string"?o:Rv(o);return u=u.replace(/ $/,"%20"),!t&&u.startsWith("//")&&(u=a+u),new URL(u,a)}function hD(o,t,a="/"){return PN(o,t,a,!1)}function PN(o,t,a,u){let y=typeof t=="string"?h_(t):t,T=yp(y.pathname||"/",a);if(T==null)return null;let C=dD(o);kN(C);let s=null;for(let V=0;s==null&&V<C.length;++V){let B=qN(T);s=UN(C[V],B,u)}return s}function dD(o,t=[],a=[],u="",y=!1){let T=(C,s,V=y,B)=>{let W={relativePath:B===void 0?C.path||"":B,caseSensitive:C.caseSensitive===!0,childrenIndex:s,route:C};if(W.relativePath.startsWith("/")){if(!W.relativePath.startsWith(u)&&V)return;na(W.relativePath.startsWith(u),`Absolute route path "${W.relativePath}" nested under path "${u}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),W.relativePath=W.relativePath.slice(u.length)}let Y=gp([u,W.relativePath]),ae=a.concat(W);C.children&&C.children.length>0&&(na(C.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Y}".`),dD(C.children,t,ae,Y,V)),!(C.path==null&&!C.index)&&t.push({path:Y,score:VN(Y,C.index),routesMeta:ae})};return o.forEach((C,s)=>{var V;if(C.path===""||!((V=C.path)!=null&&V.includes("?")))T(C,s);else for(let B of fD(C.path))T(C,s,!0,B)}),t}function fD(o){let t=o.split("/");if(t.length===0)return[];let[a,...u]=t,y=a.endsWith("?"),T=a.replace(/\?$/,"");if(u.length===0)return y?[T,""]:[T];let C=fD(u.join("/")),s=[];return s.push(...C.map(V=>V===""?T:[T,V].join("/"))),y&&s.push(...C),s.map(V=>o.startsWith("/")&&V===""?"/":V)}function kN(o){o.sort((t,a)=>t.score!==a.score?a.score-t.score:jN(t.routesMeta.map(u=>u.childrenIndex),a.routesMeta.map(u=>u.childrenIndex)))}var LN=/^:[\w-]+$/,ON=3,zN=2,NN=1,BN=10,FN=-2,RC=o=>o==="*";function VN(o,t){let a=o.split("/"),u=a.length;return a.some(RC)&&(u+=FN),t&&(u+=zN),a.filter(y=>!RC(y)).reduce((y,T)=>y+(LN.test(T)?ON:T===""?NN:BN),u)}function jN(o,t){return o.length===t.length&&o.slice(0,-1).every((u,y)=>u===t[y])?o[o.length-1]-t[t.length-1]:0}function UN(o,t,a=!1){let{routesMeta:u}=o,y={},T="/",C=[];for(let s=0;s<u.length;++s){let V=u[s],B=s===u.length-1,W=T==="/"?t:t.slice(T.length)||"/",Y=Yb({path:V.relativePath,caseSensitive:V.caseSensitive,end:B},W),ae=V.route;if(!Y&&B&&a&&!u[u.length-1].route.index&&(Y=Yb({path:V.relativePath,caseSensitive:V.caseSensitive,end:!1},W)),!Y)return null;Object.assign(y,Y.params),C.push({params:y,pathname:gp([T,Y.pathname]),pathnameBase:WN(gp([T,Y.pathnameBase])),route:ae}),Y.pathnameBase!=="/"&&(T=gp([T,Y.pathnameBase]))}return C}function Yb(o,t){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[a,u]=GN(o.path,o.caseSensitive,o.end),y=t.match(a);if(!y)return null;let T=y[0],C=T.replace(/(.)\/+$/,"$1"),s=y.slice(1);return{params:u.reduce((B,{paramName:W,isOptional:Y},ae)=>{if(W==="*"){let Qe=s[ae]||"";C=T.slice(0,T.length-Qe.length).replace(/(.)\/+$/,"$1")}const he=s[ae];return Y&&!he?B[W]=void 0:B[W]=(he||"").replace(/%2F/g,"/"),B},{}),pathname:T,pathnameBase:C,pattern:o}}function GN(o,t=!1,a=!0){mu(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let u=[],y="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,s,V)=>(u.push({paramName:s,isOptional:V!=null}),V?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(u.push({paramName:"*"}),y+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?y+="\\/*$":o!==""&&o!=="/"&&(y+="(?:(?=\\/|$))"),[new RegExp(y,t?void 0:"i"),u]}function qN(o){try{return o.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return mu(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),o}}function yp(o,t){if(t==="/")return o;if(!o.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,u=o.charAt(a);return u&&u!=="/"?null:o.slice(a)||"/"}var HN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function $N(o,t="/"){let{pathname:a,search:u="",hash:y=""}=typeof o=="string"?h_(o):o,T;return a?(a=a.replace(/\/\/+/g,"/"),a.startsWith("/")?T=MC(a.substring(1),"/"):T=MC(a,t)):T=t,{pathname:T,search:XN(u),hash:YN(y)}}function MC(o,t){let a=t.replace(/\/+$/,"").split("/");return o.split("/").forEach(y=>{y===".."?a.length>1&&a.pop():y!=="."&&a.push(y)}),a.length>1?a.join("/"):"/"}function _T(o,t,a,u){return`Cannot include a '${o}' character in a manually specified \`to.${t}\` field [${JSON.stringify(u)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ZN(o){return o.filter((t,a)=>a===0||t.route.path&&t.route.path.length>0)}function UE(o){let t=ZN(o);return t.map((a,u)=>u===t.length-1?a.pathname:a.pathnameBase)}function GE(o,t,a,u=!1){let y;typeof o=="string"?y=h_(o):(y={...o},na(!y.pathname||!y.pathname.includes("?"),_T("?","pathname","search",y)),na(!y.pathname||!y.pathname.includes("#"),_T("#","pathname","hash",y)),na(!y.search||!y.search.includes("#"),_T("#","search","hash",y)));let T=o===""||y.pathname==="",C=T?"/":y.pathname,s;if(C==null)s=a;else{let Y=t.length-1;if(!u&&C.startsWith("..")){let ae=C.split("/");for(;ae[0]==="..";)ae.shift(),Y-=1;y.pathname=ae.join("/")}s=Y>=0?t[Y]:"/"}let V=$N(y,s),B=C&&C!=="/"&&C.endsWith("/"),W=(T||C===".")&&a.endsWith("/");return!V.pathname.endsWith("/")&&(B||W)&&(V.pathname+="/"),V}var gp=o=>o.join("/").replace(/\/\/+/g,"/"),WN=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),XN=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,YN=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,KN=class{constructor(o,t,a,u=!1){this.status=o,this.statusText=t||"",this.internal=u,a instanceof Error?(this.data=a.toString(),this.error=a):this.data=a}};function QN(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function JN(o){return o.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var pD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function mD(o,t){let a=o;if(typeof a!="string"||!HN.test(a))return{absoluteURL:void 0,isExternal:!1,to:a};let u=a,y=!1;if(pD)try{let T=new URL(window.location.href),C=a.startsWith("//")?new URL(T.protocol+a):new URL(a),s=yp(C.pathname,t);C.origin===T.origin&&s!=null?a=s+C.search+C.hash:y=!0}catch{mu(!1,`<Link to="${a}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:u,isExternal:y,to:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var gD=["POST","PUT","PATCH","DELETE"];new Set(gD);var eB=["GET",...gD];new Set(eB);var Uy=Ue.createContext(null);Uy.displayName="DataRouter";var x1=Ue.createContext(null);x1.displayName="DataRouterState";var tB=Ue.createContext(!1),_D=Ue.createContext({isTransitioning:!1});_D.displayName="ViewTransition";var nB=Ue.createContext(new Map);nB.displayName="Fetchers";var iB=Ue.createContext(null);iB.displayName="Await";var gu=Ue.createContext(null);gu.displayName="Navigation";var Gv=Ue.createContext(null);Gv.displayName="Location";var df=Ue.createContext({outlet:null,matches:[],isDataRoute:!1});df.displayName="Route";var qE=Ue.createContext(null);qE.displayName="RouteError";var yD="REACT_ROUTER_ERROR",rB="REDIRECT",sB="ROUTE_ERROR_RESPONSE";function aB(o){if(o.startsWith(`${yD}:${rB}:{`))try{let t=JSON.parse(o.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function oB(o){if(o.startsWith(`${yD}:${sB}:{`))try{let t=JSON.parse(o.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new KN(t.status,t.statusText,t.data)}catch{}}function lB(o,{relative:t}={}){na(Gy(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:u}=Ue.useContext(gu),{hash:y,pathname:T,search:C}=qv(o,{relative:t}),s=T;return a!=="/"&&(s=T==="/"?a:gp([a,T])),u.createHref({pathname:s,search:C,hash:y})}function Gy(){return Ue.useContext(Gv)!=null}function Tp(){return na(Gy(),"useLocation() may be used only in the context of a <Router> component."),Ue.useContext(Gv).location}var xD="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function vD(o){Ue.useContext(gu).static||Ue.useLayoutEffect(o)}function ff(){let{isDataRoute:o}=Ue.useContext(df);return o?bB():cB()}function cB(){na(Gy(),"useNavigate() may be used only in the context of a <Router> component.");let o=Ue.useContext(Uy),{basename:t,navigator:a}=Ue.useContext(gu),{matches:u}=Ue.useContext(df),{pathname:y}=Tp(),T=JSON.stringify(UE(u)),C=Ue.useRef(!1);return vD(()=>{C.current=!0}),Ue.useCallback((V,B={})=>{if(mu(C.current,xD),!C.current)return;if(typeof V=="number"){a.go(V);return}let W=GE(V,JSON.parse(T),y,B.relative==="path");o==null&&t!=="/"&&(W.pathname=W.pathname==="/"?t:gp([t,W.pathname])),(B.replace?a.replace:a.push)(W,B.state,B)},[t,a,T,y,o])}Ue.createContext(null);function qv(o,{relative:t}={}){let{matches:a}=Ue.useContext(df),{pathname:u}=Tp(),y=JSON.stringify(UE(a));return Ue.useMemo(()=>GE(o,JSON.parse(y),u,t==="path"),[o,y,u,t])}function uB(o,t){return bD(o,t)}function bD(o,t,a,u,y){var nt;na(Gy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:T}=Ue.useContext(gu),{matches:C}=Ue.useContext(df),s=C[C.length-1],V=s?s.params:{},B=s?s.pathname:"/",W=s?s.pathnameBase:"/",Y=s&&s.route;{let Ge=Y&&Y.path||"";TD(B,!Y||Ge.endsWith("*")||Ge.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${B}" (under <Route path="${Ge}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ge}"> to <Route path="${Ge==="/"?"*":`${Ge}/*`}">.`)}let ae=Tp(),he;if(t){let Ge=typeof t=="string"?h_(t):t;na(W==="/"||((nt=Ge.pathname)==null?void 0:nt.startsWith(W)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${W}" but pathname "${Ge.pathname}" was given in the \`location\` prop.`),he=Ge}else he=ae;let Qe=he.pathname||"/",Ye=Qe;if(W!=="/"){let Ge=W.replace(/^\//,"").split("/");Ye="/"+Qe.replace(/^\//,"").split("/").slice(Ge.length).join("/")}let Ke=hD(o,{pathname:Ye});mu(Y||Ke!=null,`No routes matched location "${he.pathname}${he.search}${he.hash}" `),mu(Ke==null||Ke[Ke.length-1].route.element!==void 0||Ke[Ke.length-1].route.Component!==void 0||Ke[Ke.length-1].route.lazy!==void 0,`Matched leaf route at location "${he.pathname}${he.search}${he.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let at=mB(Ke&&Ke.map(Ge=>Object.assign({},Ge,{params:Object.assign({},V,Ge.params),pathname:gp([W,T.encodeLocation?T.encodeLocation(Ge.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ge.pathname]),pathnameBase:Ge.pathnameBase==="/"?W:gp([W,T.encodeLocation?T.encodeLocation(Ge.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ge.pathnameBase])})),C,a,u,y);return t&&at?Ue.createElement(Gv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...he},navigationType:"POP"}},at):at}function hB(){let o=vB(),t=QN(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),a=o instanceof Error?o.stack:null,u="rgba(200,200,200, 0.5)",y={padding:"0.5rem",backgroundColor:u},T={padding:"2px 4px",backgroundColor:u},C=null;return console.error("Error handled by React Router default ErrorBoundary:",o),C=Ue.createElement(Ue.Fragment,null,Ue.createElement("p",null," Hey developer "),Ue.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ue.createElement("code",{style:T},"ErrorBoundary")," or"," ",Ue.createElement("code",{style:T},"errorElement")," prop on your route.")),Ue.createElement(Ue.Fragment,null,Ue.createElement("h2",null,"Unexpected Application Error!"),Ue.createElement("h3",{style:{fontStyle:"italic"}},t),a?Ue.createElement("pre",{style:y},a):null,C)}var dB=Ue.createElement(hB,null),wD=class extends Ue.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,t){return t.location!==o.location||t.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:t.error,location:t.location,revalidation:o.revalidation||t.revalidation}}componentDidCatch(o,t){this.props.onError?this.props.onError(o,t):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const a=oB(o.digest);a&&(o=a)}let t=o!==void 0?Ue.createElement(df.Provider,{value:this.props.routeContext},Ue.createElement(qE.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?Ue.createElement(fB,{error:o},t):t}};wD.contextType=tB;var yT=new WeakMap;function fB({children:o,error:t}){let{basename:a}=Ue.useContext(gu);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let u=aB(t.digest);if(u){let y=yT.get(t);if(y)throw y;let T=mD(u.location,a);if(pD&&!yT.get(t))if(T.isExternal||u.reloadDocument)window.location.href=T.absoluteURL||T.to;else{const C=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(T.to,{replace:u.replace}));throw yT.set(t,C),C}return Ue.createElement("meta",{httpEquiv:"refresh",content:`0;url=${T.absoluteURL||T.to}`})}}return o}function pB({routeContext:o,match:t,children:a}){let u=Ue.useContext(Uy);return u&&u.static&&u.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=t.route.id),Ue.createElement(df.Provider,{value:o},a)}function mB(o,t=[],a=null,u=null,y=null){if(o==null){if(!a)return null;if(a.errors)o=a.matches;else if(t.length===0&&!a.initialized&&a.matches.length>0)o=a.matches;else return null}let T=o,C=a==null?void 0:a.errors;if(C!=null){let W=T.findIndex(Y=>Y.route.id&&(C==null?void 0:C[Y.route.id])!==void 0);na(W>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(C).join(",")}`),T=T.slice(0,Math.min(T.length,W+1))}let s=!1,V=-1;if(a)for(let W=0;W<T.length;W++){let Y=T[W];if((Y.route.HydrateFallback||Y.route.hydrateFallbackElement)&&(V=W),Y.route.id){let{loaderData:ae,errors:he}=a,Qe=Y.route.loader&&!ae.hasOwnProperty(Y.route.id)&&(!he||he[Y.route.id]===void 0);if(Y.route.lazy||Qe){s=!0,V>=0?T=T.slice(0,V+1):T=[T[0]];break}}}let B=a&&u?(W,Y)=>{var ae,he;u(W,{location:a.location,params:((he=(ae=a.matches)==null?void 0:ae[0])==null?void 0:he.params)??{},unstable_pattern:JN(a.matches),errorInfo:Y})}:void 0;return T.reduceRight((W,Y,ae)=>{let he,Qe=!1,Ye=null,Ke=null;a&&(he=C&&Y.route.id?C[Y.route.id]:void 0,Ye=Y.route.errorElement||dB,s&&(V<0&&ae===0?(TD("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Qe=!0,Ke=null):V===ae&&(Qe=!0,Ke=Y.route.hydrateFallbackElement||null)));let at=t.concat(T.slice(0,ae+1)),nt=()=>{let Ge;return he?Ge=Ye:Qe?Ge=Ke:Y.route.Component?Ge=Ue.createElement(Y.route.Component,null):Y.route.element?Ge=Y.route.element:Ge=W,Ue.createElement(pB,{match:Y,routeContext:{outlet:W,matches:at,isDataRoute:a!=null},children:Ge})};return a&&(Y.route.ErrorBoundary||Y.route.errorElement||ae===0)?Ue.createElement(wD,{location:a.location,revalidation:a.revalidation,component:Ye,error:he,children:nt(),routeContext:{outlet:null,matches:at,isDataRoute:!0},onError:B}):nt()},null)}function HE(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function gB(o){let t=Ue.useContext(Uy);return na(t,HE(o)),t}function _B(o){let t=Ue.useContext(x1);return na(t,HE(o)),t}function yB(o){let t=Ue.useContext(df);return na(t,HE(o)),t}function $E(o){let t=yB(o),a=t.matches[t.matches.length-1];return na(a.route.id,`${o} can only be used on routes that contain a unique "id"`),a.route.id}function xB(){return $E("useRouteId")}function vB(){var u;let o=Ue.useContext(qE),t=_B("useRouteError"),a=$E("useRouteError");return o!==void 0?o:(u=t.errors)==null?void 0:u[a]}function bB(){let{router:o}=gB("useNavigate"),t=$E("useNavigate"),a=Ue.useRef(!1);return vD(()=>{a.current=!0}),Ue.useCallback(async(y,T={})=>{mu(a.current,xD),a.current&&(typeof y=="number"?await o.navigate(y):await o.navigate(y,{fromRouteId:t,...T}))},[o,t])}var DC={};function TD(o,t,a){!t&&!DC[o]&&(DC[o]=!0,mu(!1,a))}Ue.memo(wB);function wB({routes:o,future:t,state:a,onError:u}){return bD(o,void 0,a,u,t)}function e_({to:o,replace:t,state:a,relative:u}){na(Gy(),"<Navigate> may be used only in the context of a <Router> component.");let{static:y}=Ue.useContext(gu);mu(!y,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:T}=Ue.useContext(df),{pathname:C}=Tp(),s=ff(),V=GE(o,UE(T),C,u==="path"),B=JSON.stringify(V);return Ue.useEffect(()=>{s(JSON.parse(B),{replace:t,state:a,relative:u})},[s,B,u,t,a]),null}function Zh(o){na(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function TB({basename:o="/",children:t=null,location:a,navigationType:u="POP",navigator:y,static:T=!1,unstable_useTransitions:C}){na(!Gy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=o.replace(/^\/*/,"/"),V=Ue.useMemo(()=>({basename:s,navigator:y,static:T,unstable_useTransitions:C,future:{}}),[s,y,T,C]);typeof a=="string"&&(a=h_(a));let{pathname:B="/",search:W="",hash:Y="",state:ae=null,key:he="default"}=a,Qe=Ue.useMemo(()=>{let Ye=yp(B,s);return Ye==null?null:{location:{pathname:Ye,search:W,hash:Y,state:ae,key:he},navigationType:u}},[s,B,W,Y,ae,he,u]);return mu(Qe!=null,`<Router basename="${s}"> is not able to match the URL "${B}${W}${Y}" because it does not start with the basename, so the <Router> won't render anything.`),Qe==null?null:Ue.createElement(gu.Provider,{value:V},Ue.createElement(Gv.Provider,{children:t,value:Qe}))}function EB({children:o,location:t}){return uB(KT(o),t)}function KT(o,t=[]){let a=[];return Ue.Children.forEach(o,(u,y)=>{if(!Ue.isValidElement(u))return;let T=[...t,y];if(u.type===Ue.Fragment){a.push.apply(a,KT(u.props.children,T));return}na(u.type===Zh,`[${typeof u.type=="string"?u.type:u.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),na(!u.props.index||!u.props.children,"An index route cannot have child routes.");let C={id:u.props.id||T.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,middleware:u.props.middleware,loader:u.props.loader,action:u.props.action,hydrateFallbackElement:u.props.hydrateFallbackElement,HydrateFallback:u.props.HydrateFallback,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.hasErrorBoundary===!0||u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(C.children=KT(u.props.children,T)),a.push(C)}),a}var Db="get",Pb="application/x-www-form-urlencoded";function v1(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function SB(o){return v1(o)&&o.tagName.toLowerCase()==="button"}function AB(o){return v1(o)&&o.tagName.toLowerCase()==="form"}function IB(o){return v1(o)&&o.tagName.toLowerCase()==="input"}function CB(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function RB(o,t){return o.button===0&&(!t||t==="_self")&&!CB(o)}function QT(o=""){return new URLSearchParams(typeof o=="string"||Array.isArray(o)||o instanceof URLSearchParams?o:Object.keys(o).reduce((t,a)=>{let u=o[a];return t.concat(Array.isArray(u)?u.map(y=>[a,y]):[[a,u]])},[]))}function MB(o,t){let a=QT(o);return t&&t.forEach((u,y)=>{a.has(y)||t.getAll(y).forEach(T=>{a.append(y,T)})}),a}var xb=null;function DB(){if(xb===null)try{new FormData(document.createElement("form"),0),xb=!1}catch{xb=!0}return xb}var PB=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function xT(o){return o!=null&&!PB.has(o)?(mu(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Pb}"`),null):o}function kB(o,t){let a,u,y,T,C;if(AB(o)){let s=o.getAttribute("action");u=s?yp(s,t):null,a=o.getAttribute("method")||Db,y=xT(o.getAttribute("enctype"))||Pb,T=new FormData(o)}else if(SB(o)||IB(o)&&(o.type==="submit"||o.type==="image")){let s=o.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let V=o.getAttribute("formaction")||s.getAttribute("action");if(u=V?yp(V,t):null,a=o.getAttribute("formmethod")||s.getAttribute("method")||Db,y=xT(o.getAttribute("formenctype"))||xT(s.getAttribute("enctype"))||Pb,T=new FormData(s,o),!DB()){let{name:B,type:W,value:Y}=o;if(W==="image"){let ae=B?`${B}.`:"";T.append(`${ae}x`,"0"),T.append(`${ae}y`,"0")}else B&&T.append(B,Y)}}else{if(v1(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=Db,u=null,y=Pb,C=o}return T&&y==="text/plain"&&(C=T,T=void 0),{action:u,method:a.toLowerCase(),encType:y,formData:T,body:C}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ZE(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function LB(o,t,a,u){let y=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return a?y.pathname.endsWith("/")?y.pathname=`${y.pathname}_.${u}`:y.pathname=`${y.pathname}.${u}`:y.pathname==="/"?y.pathname=`_root.${u}`:t&&yp(y.pathname,t)==="/"?y.pathname=`${t.replace(/\/$/,"")}/_root.${u}`:y.pathname=`${y.pathname.replace(/\/$/,"")}.${u}`,y}async function OB(o,t){if(o.id in t)return t[o.id];try{let a=await import(o.module);return t[o.id]=a,a}catch(a){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function zB(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function NB(o,t,a){let u=await Promise.all(o.map(async y=>{let T=t.routes[y.route.id];if(T){let C=await OB(T,a);return C.links?C.links():[]}return[]}));return jB(u.flat(1).filter(zB).filter(y=>y.rel==="stylesheet"||y.rel==="preload").map(y=>y.rel==="stylesheet"?{...y,rel:"prefetch",as:"style"}:{...y,rel:"prefetch"}))}function PC(o,t,a,u,y,T){let C=(V,B)=>a[B]?V.route.id!==a[B].route.id:!0,s=(V,B)=>{var W;return a[B].pathname!==V.pathname||((W=a[B].route.path)==null?void 0:W.endsWith("*"))&&a[B].params["*"]!==V.params["*"]};return T==="assets"?t.filter((V,B)=>C(V,B)||s(V,B)):T==="data"?t.filter((V,B)=>{var Y;let W=u.routes[V.route.id];if(!W||!W.hasLoader)return!1;if(C(V,B)||s(V,B))return!0;if(V.route.shouldRevalidate){let ae=V.route.shouldRevalidate({currentUrl:new URL(y.pathname+y.search+y.hash,window.origin),currentParams:((Y=a[0])==null?void 0:Y.params)||{},nextUrl:new URL(o,window.origin),nextParams:V.params,defaultShouldRevalidate:!0});if(typeof ae=="boolean")return ae}return!0}):[]}function BB(o,t,{includeHydrateFallback:a}={}){return FB(o.map(u=>{let y=t.routes[u.route.id];if(!y)return[];let T=[y.module];return y.clientActionModule&&(T=T.concat(y.clientActionModule)),y.clientLoaderModule&&(T=T.concat(y.clientLoaderModule)),a&&y.hydrateFallbackModule&&(T=T.concat(y.hydrateFallbackModule)),y.imports&&(T=T.concat(y.imports)),T}).flat(1))}function FB(o){return[...new Set(o)]}function VB(o){let t={},a=Object.keys(o).sort();for(let u of a)t[u]=o[u];return t}function jB(o,t){let a=new Set;return new Set(t),o.reduce((u,y)=>{let T=JSON.stringify(VB(y));return a.has(T)||(a.add(T),u.push({key:T,link:y})),u},[])}function ED(){let o=Ue.useContext(Uy);return ZE(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function UB(){let o=Ue.useContext(x1);return ZE(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var WE=Ue.createContext(void 0);WE.displayName="FrameworkContext";function SD(){let o=Ue.useContext(WE);return ZE(o,"You must render this element inside a <HydratedRouter> element"),o}function GB(o,t){let a=Ue.useContext(WE),[u,y]=Ue.useState(!1),[T,C]=Ue.useState(!1),{onFocus:s,onBlur:V,onMouseEnter:B,onMouseLeave:W,onTouchStart:Y}=t,ae=Ue.useRef(null);Ue.useEffect(()=>{if(o==="render"&&C(!0),o==="viewport"){let Ye=at=>{at.forEach(nt=>{C(nt.isIntersecting)})},Ke=new IntersectionObserver(Ye,{threshold:.5});return ae.current&&Ke.observe(ae.current),()=>{Ke.disconnect()}}},[o]),Ue.useEffect(()=>{if(u){let Ye=setTimeout(()=>{C(!0)},100);return()=>{clearTimeout(Ye)}}},[u]);let he=()=>{y(!0)},Qe=()=>{y(!1),C(!1)};return a?o!=="intent"?[T,ae,{}]:[T,ae,{onFocus:lv(s,he),onBlur:lv(V,Qe),onMouseEnter:lv(B,he),onMouseLeave:lv(W,Qe),onTouchStart:lv(Y,he)}]:[!1,ae,{}]}function lv(o,t){return a=>{o&&o(a),a.defaultPrevented||t(a)}}function qB({page:o,...t}){let{router:a}=ED(),u=Ue.useMemo(()=>hD(a.routes,o,a.basename),[a.routes,o,a.basename]);return u?Ue.createElement($B,{page:o,matches:u,...t}):null}function HB(o){let{manifest:t,routeModules:a}=SD(),[u,y]=Ue.useState([]);return Ue.useEffect(()=>{let T=!1;return NB(o,t,a).then(C=>{T||y(C)}),()=>{T=!0}},[o,t,a]),u}function $B({page:o,matches:t,...a}){let u=Tp(),{future:y,manifest:T,routeModules:C}=SD(),{basename:s}=ED(),{loaderData:V,matches:B}=UB(),W=Ue.useMemo(()=>PC(o,t,B,T,u,"data"),[o,t,B,T,u]),Y=Ue.useMemo(()=>PC(o,t,B,T,u,"assets"),[o,t,B,T,u]),ae=Ue.useMemo(()=>{if(o===u.pathname+u.search+u.hash)return[];let Ye=new Set,Ke=!1;if(t.forEach(nt=>{var Mt;let Ge=T.routes[nt.route.id];!Ge||!Ge.hasLoader||(!W.some(cn=>cn.route.id===nt.route.id)&&nt.route.id in V&&((Mt=C[nt.route.id])!=null&&Mt.shouldRevalidate)||Ge.hasClientLoader?Ke=!0:Ye.add(nt.route.id))}),Ye.size===0)return[];let at=LB(o,s,y.unstable_trailingSlashAwareDataRequests,"data");return Ke&&Ye.size>0&&at.searchParams.set("_routes",t.filter(nt=>Ye.has(nt.route.id)).map(nt=>nt.route.id).join(",")),[at.pathname+at.search]},[s,y.unstable_trailingSlashAwareDataRequests,V,u,T,W,t,o,C]),he=Ue.useMemo(()=>BB(Y,T),[Y,T]),Qe=HB(Y);return Ue.createElement(Ue.Fragment,null,ae.map(Ye=>Ue.createElement("link",{key:Ye,rel:"prefetch",as:"fetch",href:Ye,...a})),he.map(Ye=>Ue.createElement("link",{key:Ye,rel:"modulepreload",href:Ye,...a})),Qe.map(({key:Ye,link:Ke})=>Ue.createElement("link",{key:Ye,nonce:a.nonce,...Ke,crossOrigin:Ke.crossOrigin??a.crossOrigin})))}function ZB(...o){return t=>{o.forEach(a=>{typeof a=="function"?a(t):a!=null&&(a.current=t)})}}var WB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{WB&&(window.__reactRouterVersion="7.13.0")}catch{}function XB({basename:o,children:t,unstable_useTransitions:a,window:u}){let y=Ue.useRef();y.current==null&&(y.current=CN({window:u,v5Compat:!0}));let T=y.current,[C,s]=Ue.useState({action:T.action,location:T.location}),V=Ue.useCallback(B=>{a===!1?s(B):Ue.startTransition(()=>s(B))},[a]);return Ue.useLayoutEffect(()=>T.listen(V),[T,V]),Ue.createElement(TB,{basename:o,children:t,location:C.location,navigationType:C.action,navigator:T,unstable_useTransitions:a})}var AD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ID=Ue.forwardRef(function({onClick:t,discover:a="render",prefetch:u="none",relative:y,reloadDocument:T,replace:C,state:s,target:V,to:B,preventScrollReset:W,viewTransition:Y,unstable_defaultShouldRevalidate:ae,...he},Qe){let{basename:Ye,unstable_useTransitions:Ke}=Ue.useContext(gu),at=typeof B=="string"&&AD.test(B),nt=mD(B,Ye);B=nt.to;let Ge=lB(B,{relative:y}),[Mt,cn,St]=GB(u,he),Oe=QB(B,{replace:C,state:s,target:V,preventScrollReset:W,relative:y,viewTransition:Y,unstable_defaultShouldRevalidate:ae,unstable_useTransitions:Ke});function Re(Je){t&&t(Je),Je.defaultPrevented||Oe(Je)}let Ve=Ue.createElement("a",{...he,...St,href:nt.absoluteURL||Ge,onClick:nt.isExternal||T?t:Re,ref:ZB(Qe,cn),target:V,"data-discover":!at&&a==="render"?"true":void 0});return Mt&&!at?Ue.createElement(Ue.Fragment,null,Ve,Ue.createElement(qB,{page:Ge})):Ve});ID.displayName="Link";var Im=Ue.forwardRef(function({"aria-current":t="page",caseSensitive:a=!1,className:u="",end:y=!1,style:T,to:C,viewTransition:s,children:V,...B},W){let Y=qv(C,{relative:B.relative}),ae=Tp(),he=Ue.useContext(x1),{navigator:Qe,basename:Ye}=Ue.useContext(gu),Ke=he!=null&&rF(Y)&&s===!0,at=Qe.encodeLocation?Qe.encodeLocation(Y).pathname:Y.pathname,nt=ae.pathname,Ge=he&&he.navigation&&he.navigation.location?he.navigation.location.pathname:null;a||(nt=nt.toLowerCase(),Ge=Ge?Ge.toLowerCase():null,at=at.toLowerCase()),Ge&&Ye&&(Ge=yp(Ge,Ye)||Ge);const Mt=at!=="/"&&at.endsWith("/")?at.length-1:at.length;let cn=nt===at||!y&&nt.startsWith(at)&&nt.charAt(Mt)==="/",St=Ge!=null&&(Ge===at||!y&&Ge.startsWith(at)&&Ge.charAt(at.length)==="/"),Oe={isActive:cn,isPending:St,isTransitioning:Ke},Re=cn?t:void 0,Ve;typeof u=="function"?Ve=u(Oe):Ve=[u,cn?"active":null,St?"pending":null,Ke?"transitioning":null].filter(Boolean).join(" ");let Je=typeof T=="function"?T(Oe):T;return Ue.createElement(ID,{...B,"aria-current":Re,className:Ve,ref:W,style:Je,to:C,viewTransition:s},typeof V=="function"?V(Oe):V)});Im.displayName="NavLink";var YB=Ue.forwardRef(({discover:o="render",fetcherKey:t,navigate:a,reloadDocument:u,replace:y,state:T,method:C=Db,action:s,onSubmit:V,relative:B,preventScrollReset:W,viewTransition:Y,unstable_defaultShouldRevalidate:ae,...he},Qe)=>{let{unstable_useTransitions:Ye}=Ue.useContext(gu),Ke=nF(),at=iF(s,{relative:B}),nt=C.toLowerCase()==="get"?"get":"post",Ge=typeof s=="string"&&AD.test(s),Mt=cn=>{if(V&&V(cn),cn.defaultPrevented)return;cn.preventDefault();let St=cn.nativeEvent.submitter,Oe=(St==null?void 0:St.getAttribute("formmethod"))||C,Re=()=>Ke(St||cn.currentTarget,{fetcherKey:t,method:Oe,navigate:a,replace:y,state:T,relative:B,preventScrollReset:W,viewTransition:Y,unstable_defaultShouldRevalidate:ae});Ye&&a!==!1?Ue.startTransition(()=>Re()):Re()};return Ue.createElement("form",{ref:Qe,method:nt,action:at,onSubmit:u?V:Mt,...he,"data-discover":!Ge&&o==="render"?"true":void 0})});YB.displayName="Form";function KB(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function CD(o){let t=Ue.useContext(Uy);return na(t,KB(o)),t}function QB(o,{target:t,replace:a,state:u,preventScrollReset:y,relative:T,viewTransition:C,unstable_defaultShouldRevalidate:s,unstable_useTransitions:V}={}){let B=ff(),W=Tp(),Y=qv(o,{relative:T});return Ue.useCallback(ae=>{if(RB(ae,t)){ae.preventDefault();let he=a!==void 0?a:Rv(W)===Rv(Y),Qe=()=>B(o,{replace:he,state:u,preventScrollReset:y,relative:T,viewTransition:C,unstable_defaultShouldRevalidate:s});V?Ue.startTransition(()=>Qe()):Qe()}},[W,B,Y,a,u,t,o,y,T,C,s,V])}function JB(o){mu(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=Ue.useRef(QT(o)),a=Ue.useRef(!1),u=Tp(),y=Ue.useMemo(()=>MB(u.search,a.current?null:t.current),[u.search]),T=ff(),C=Ue.useCallback((s,V)=>{const B=QT(typeof s=="function"?s(new URLSearchParams(y)):s);a.current=!0,T("?"+B,V)},[T,y]);return[y,C]}var eF=0,tF=()=>`__${String(++eF)}__`;function nF(){let{router:o}=CD("useSubmit"),{basename:t}=Ue.useContext(gu),a=xB(),u=o.fetch,y=o.navigate;return Ue.useCallback(async(T,C={})=>{let{action:s,method:V,encType:B,formData:W,body:Y}=kB(T,t);if(C.navigate===!1){let ae=C.fetcherKey||tF();await u(ae,a,C.action||s,{unstable_defaultShouldRevalidate:C.unstable_defaultShouldRevalidate,preventScrollReset:C.preventScrollReset,formData:W,body:Y,formMethod:C.method||V,formEncType:C.encType||B,flushSync:C.flushSync})}else await y(C.action||s,{unstable_defaultShouldRevalidate:C.unstable_defaultShouldRevalidate,preventScrollReset:C.preventScrollReset,formData:W,body:Y,formMethod:C.method||V,formEncType:C.encType||B,replace:C.replace,state:C.state,fromRouteId:a,flushSync:C.flushSync,viewTransition:C.viewTransition})},[u,y,t,a])}function iF(o,{relative:t}={}){let{basename:a}=Ue.useContext(gu),u=Ue.useContext(df);na(u,"useFormAction must be used inside a RouteContext");let[y]=u.matches.slice(-1),T={...qv(o||".",{relative:t})},C=Tp();if(o==null){T.search=C.search;let s=new URLSearchParams(T.search),V=s.getAll("index");if(V.some(W=>W==="")){s.delete("index"),V.filter(Y=>Y).forEach(Y=>s.append("index",Y));let W=s.toString();T.search=W?`?${W}`:""}}return(!o||o===".")&&y.route.index&&(T.search=T.search?T.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(T.pathname=T.pathname==="/"?a:gp([a,T.pathname])),Rv(T)}function rF(o,{relative:t}={}){let a=Ue.useContext(_D);na(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:u}=CD("useViewTransitionState"),y=qv(o,{relative:t});if(!a.isTransitioning)return!1;let T=yp(a.currentLocation.pathname,u)||a.currentLocation.pathname,C=yp(a.nextLocation.pathname,u)||a.nextLocation.pathname;return Yb(y.pathname,C)!=null||Yb(y.pathname,T)!=null}var RD=uD();const MD=Ue.createContext(void 0),sF=({children:o})=>{const[t,a]=Ue.useState(null),[u,y]=Ue.useState(!1),[T,C]=Ue.useState(null),s=async()=>(y(!0),C(null),new Promise(V=>{if(!navigator.geolocation){C("Geolocation is not supported by your browser"),y(!1),V(null);return}navigator.geolocation.getCurrentPosition(B=>{const W={latitude:B.coords.latitude,longitude:B.coords.longitude};a(W),y(!1),V(W)},B=>{C(B.message),y(!1),V(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}));return N.jsx(MD.Provider,{value:{userLocation:t,setUserLocation:a,requestLocation:s,isLoading:u,error:T},children:o})},DD=()=>{const o=Ue.useContext(MD);if(o===void 0)throw new Error("useLocation must be used within a LocationProvider");return o},aF=()=>{};var kC={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PD=function(o){const t=[];let a=0;for(let u=0;u<o.length;u++){let y=o.charCodeAt(u);y<128?t[a++]=y:y<2048?(t[a++]=y>>6|192,t[a++]=y&63|128):(y&64512)===55296&&u+1<o.length&&(o.charCodeAt(u+1)&64512)===56320?(y=65536+((y&1023)<<10)+(o.charCodeAt(++u)&1023),t[a++]=y>>18|240,t[a++]=y>>12&63|128,t[a++]=y>>6&63|128,t[a++]=y&63|128):(t[a++]=y>>12|224,t[a++]=y>>6&63|128,t[a++]=y&63|128)}return t},oF=function(o){const t=[];let a=0,u=0;for(;a<o.length;){const y=o[a++];if(y<128)t[u++]=String.fromCharCode(y);else if(y>191&&y<224){const T=o[a++];t[u++]=String.fromCharCode((y&31)<<6|T&63)}else if(y>239&&y<365){const T=o[a++],C=o[a++],s=o[a++],V=((y&7)<<18|(T&63)<<12|(C&63)<<6|s&63)-65536;t[u++]=String.fromCharCode(55296+(V>>10)),t[u++]=String.fromCharCode(56320+(V&1023))}else{const T=o[a++],C=o[a++];t[u++]=String.fromCharCode((y&15)<<12|(T&63)<<6|C&63)}}return t.join("")},kD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(o,t){if(!Array.isArray(o))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,u=[];for(let y=0;y<o.length;y+=3){const T=o[y],C=y+1<o.length,s=C?o[y+1]:0,V=y+2<o.length,B=V?o[y+2]:0,W=T>>2,Y=(T&3)<<4|s>>4;let ae=(s&15)<<2|B>>6,he=B&63;V||(he=64,C||(ae=64)),u.push(a[W],a[Y],a[ae],a[he])}return u.join("")},encodeString(o,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(o):this.encodeByteArray(PD(o),t)},decodeString(o,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(o):oF(this.decodeStringToByteArray(o,t))},decodeStringToByteArray(o,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,u=[];for(let y=0;y<o.length;){const T=a[o.charAt(y++)],s=y<o.length?a[o.charAt(y)]:0;++y;const B=y<o.length?a[o.charAt(y)]:64;++y;const Y=y<o.length?a[o.charAt(y)]:64;if(++y,T==null||s==null||B==null||Y==null)throw new lF;const ae=T<<2|s>>4;if(u.push(ae),B!==64){const he=s<<4&240|B>>2;if(u.push(he),Y!==64){const Qe=B<<6&192|Y;u.push(Qe)}}}return u},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let o=0;o<this.ENCODED_VALS.length;o++)this.byteToCharMap_[o]=this.ENCODED_VALS.charAt(o),this.charToByteMap_[this.byteToCharMap_[o]]=o,this.byteToCharMapWebSafe_[o]=this.ENCODED_VALS_WEBSAFE.charAt(o),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[o]]=o,o>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(o)]=o,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(o)]=o)}}};class lF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cF=function(o){const t=PD(o);return kD.encodeByteArray(t,!0)},Kb=function(o){return cF(o).replace(/\./g,"")},LD=function(o){try{return kD.decodeString(o,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hF=()=>uF().__FIREBASE_DEFAULTS__,dF=()=>{if(typeof process>"u"||typeof kC>"u")return;const o=kC.__FIREBASE_DEFAULTS__;if(o)return JSON.parse(o)},fF=()=>{if(typeof document>"u")return;let o;try{o=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=o&&LD(o[1]);return t&&JSON.parse(t)},b1=()=>{try{return aF()||hF()||dF()||fF()}catch(o){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${o}`);return}},OD=o=>{var t,a;return(a=(t=b1())==null?void 0:t.emulatorHosts)==null?void 0:a[o]},pF=o=>{const t=OD(o);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const u=parseInt(t.substring(a+1),10);return t[0]==="["?[t.substring(1,a-1),u]:[t.substring(0,a),u]},zD=()=>{var o;return(o=b1())==null?void 0:o.config},ND=o=>{var t;return(t=b1())==null?void 0:t[`_${o}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,a)=>{this.resolve=t,this.reject=a})}wrapCallback(t){return(a,u)=>{a?this.reject(a):this.resolve(u),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(a):t(a,u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qy(o){try{return(o.startsWith("http://")||o.startsWith("https://")?new URL(o).hostname:o).endsWith(".cloudworkstations.dev")}catch{return!1}}async function BD(o){return(await fetch(o,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gF(o,t){if(o.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a={alg:"none",type:"JWT"},u=t||"demo-project",y=o.iat||0,T=o.sub||o.user_id;if(!T)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const C={iss:`https://securetoken.google.com/${u}`,aud:u,iat:y,exp:y+3600,auth_time:y,sub:T,user_id:T,firebase:{sign_in_provider:"custom",identities:{}},...o};return[Kb(JSON.stringify(a)),Kb(JSON.stringify(C)),""].join(".")}const vv={};function _F(){const o={prod:[],emulator:[]};for(const t of Object.keys(vv))vv[t]?o.emulator.push(t):o.prod.push(t);return o}function yF(o){let t=document.getElementById(o),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",o),a=!0),{created:a,element:t}}let LC=!1;function FD(o,t){if(typeof window>"u"||typeof document>"u"||!qy(window.location.host)||vv[o]===t||vv[o]||LC)return;vv[o]=t;function a(ae){return`__firebase__banner__${ae}`}const u="__firebase__banner",T=_F().prod.length>0;function C(){const ae=document.getElementById(u);ae&&ae.remove()}function s(ae){ae.style.display="flex",ae.style.background="#7faaf0",ae.style.position="fixed",ae.style.bottom="5px",ae.style.left="5px",ae.style.padding=".5em",ae.style.borderRadius="5px",ae.style.alignItems="center"}function V(ae,he){ae.setAttribute("width","24"),ae.setAttribute("id",he),ae.setAttribute("height","24"),ae.setAttribute("viewBox","0 0 24 24"),ae.setAttribute("fill","none"),ae.style.marginLeft="-6px"}function B(){const ae=document.createElement("span");return ae.style.cursor="pointer",ae.style.marginLeft="16px",ae.style.fontSize="24px",ae.innerHTML=" &times;",ae.onclick=()=>{LC=!0,C()},ae}function W(ae,he){ae.setAttribute("id",he),ae.innerText="Learn more",ae.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ae.setAttribute("target","__blank"),ae.style.paddingLeft="5px",ae.style.textDecoration="underline"}function Y(){const ae=yF(u),he=a("text"),Qe=document.getElementById(he)||document.createElement("span"),Ye=a("learnmore"),Ke=document.getElementById(Ye)||document.createElement("a"),at=a("preprendIcon"),nt=document.getElementById(at)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ae.created){const Ge=ae.element;s(Ge),W(Ke,Ye);const Mt=B();V(nt,at),Ge.append(nt,Qe,Ke,Mt),document.body.appendChild(Ge)}T?(Qe.innerText="Preview backend disconnected.",nt.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(nt.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Qe.innerText="Preview backend running in this workspace."),Qe.setAttribute("id",he)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Y):Y()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xF(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Il())}function vF(){var t;const o=(t=b1())==null?void 0:t.forceEnvironment;if(o==="node")return!0;if(o==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bF(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function wF(){const o=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof o=="object"&&o.id!==void 0}function TF(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function EF(){const o=Il();return o.indexOf("MSIE ")>=0||o.indexOf("Trident/")>=0}function SF(){return!vF()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function AF(){try{return typeof indexedDB=="object"}catch{return!1}}function IF(){return new Promise((o,t)=>{try{let a=!0;const u="validate-browser-context-for-indexeddb-analytics-module",y=self.indexedDB.open(u);y.onsuccess=()=>{y.result.close(),a||self.indexedDB.deleteDatabase(u),o(!0)},y.onupgradeneeded=()=>{a=!1},y.onerror=()=>{var T;t(((T=y.error)==null?void 0:T.message)||"")}}catch(a){t(a)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CF="FirebaseError";class Ep extends Error{constructor(t,a,u){super(a),this.code=t,this.customData=u,this.name=CF,Object.setPrototypeOf(this,Ep.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hv.prototype.create)}}class Hv{constructor(t,a,u){this.service=t,this.serviceName=a,this.errors=u}create(t,...a){const u=a[0]||{},y=`${this.service}/${t}`,T=this.errors[t],C=T?RF(T,u):"Error",s=`${this.serviceName}: ${C} (${y}).`;return new Ep(y,s,u)}}function RF(o,t){return o.replace(MF,(a,u)=>{const y=t[u];return y!=null?String(y):`<${u}?>`})}const MF=/\{\$([^}]+)}/g;function DF(o){for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t))return!1;return!0}function a_(o,t){if(o===t)return!0;const a=Object.keys(o),u=Object.keys(t);for(const y of a){if(!u.includes(y))return!1;const T=o[y],C=t[y];if(OC(T)&&OC(C)){if(!a_(T,C))return!1}else if(T!==C)return!1}for(const y of u)if(!a.includes(y))return!1;return!0}function OC(o){return o!==null&&typeof o=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(o){const t=[];for(const[a,u]of Object.entries(o))Array.isArray(u)?u.forEach(y=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(y))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(u));return t.length?"&"+t.join("&"):""}function PF(o,t){const a=new kF(o,t);return a.subscribe.bind(a)}class kF{constructor(t,a){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=a,this.task.then(()=>{t(this)}).catch(u=>{this.error(u)})}next(t){this.forEachObserver(a=>{a.next(t)})}error(t){this.forEachObserver(a=>{a.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,a,u){let y;if(t===void 0&&a===void 0&&u===void 0)throw new Error("Missing Observer.");LF(t,["next","error","complete"])?y=t:y={next:t,error:a,complete:u},y.next===void 0&&(y.next=vT),y.error===void 0&&(y.error=vT),y.complete===void 0&&(y.complete=vT);const T=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?y.error(this.finalError):y.complete()}catch{}}),this.observers.push(y),T}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let a=0;a<this.observers.length;a++)this.sendOne(a,t)}sendOne(t,a){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{a(this.observers[t])}catch(u){typeof console<"u"&&console.error&&console.error(u)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function LF(o,t){if(typeof o!="object"||o===null)return!1;for(const a of t)if(a in o&&typeof o[a]=="function")return!0;return!1}function vT(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ic(o){return o&&o._delegate?o._delegate:o}class o_{constructor(t,a,u){this.name=t,this.instanceFactory=a,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(t,a){this.name=t,this.container=a,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const a=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(a)){const u=new mF;if(this.instancesDeferred.set(a,u),this.isInitialized(a)||this.shouldAutoInitialize())try{const y=this.getOrInitializeService({instanceIdentifier:a});y&&u.resolve(y)}catch{}}return this.instancesDeferred.get(a).promise}getImmediate(t){const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),u=(t==null?void 0:t.optional)??!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(y){if(u)return null;throw y}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(NF(t))try{this.getOrInitializeService({instanceIdentifier:t_})}catch{}for(const[a,u]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(a);try{const T=this.getOrInitializeService({instanceIdentifier:y});u.resolve(T)}catch{}}}}clearInstance(t=t_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...t.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=t_){return this.instances.has(t)}getOptions(t=t_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:a={}}=t,u=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(u))throw Error(`${this.name}(${u}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const y=this.getOrInitializeService({instanceIdentifier:u,options:a});for(const[T,C]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(T);u===s&&C.resolve(y)}return y}onInit(t,a){const u=this.normalizeInstanceIdentifier(a),y=this.onInitCallbacks.get(u)??new Set;y.add(t),this.onInitCallbacks.set(u,y);const T=this.instances.get(u);return T&&t(T,u),()=>{y.delete(t)}}invokeOnInitCallbacks(t,a){const u=this.onInitCallbacks.get(a);if(u)for(const y of u)try{y(t,a)}catch{}}getOrInitializeService({instanceIdentifier:t,options:a={}}){let u=this.instances.get(t);if(!u&&this.component&&(u=this.component.instanceFactory(this.container,{instanceIdentifier:zF(t),options:a}),this.instances.set(t,u),this.instancesOptions.set(t,a),this.invokeOnInitCallbacks(u,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,u)}catch{}return u||null}normalizeInstanceIdentifier(t=t_){return this.component?this.component.multipleInstances?t:t_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zF(o){return o===t_?void 0:o}function NF(o){return o.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const a=this.getProvider(t.name);if(a.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);a.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const a=new OF(t,this);return this.providers.set(t,a),a}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rr;(function(o){o[o.DEBUG=0]="DEBUG",o[o.VERBOSE=1]="VERBOSE",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.SILENT=5]="SILENT"})(Rr||(Rr={}));const FF={debug:Rr.DEBUG,verbose:Rr.VERBOSE,info:Rr.INFO,warn:Rr.WARN,error:Rr.ERROR,silent:Rr.SILENT},VF=Rr.INFO,jF={[Rr.DEBUG]:"log",[Rr.VERBOSE]:"log",[Rr.INFO]:"info",[Rr.WARN]:"warn",[Rr.ERROR]:"error"},UF=(o,t,...a)=>{if(t<o.logLevel)return;const u=new Date().toISOString(),y=jF[t];if(y)console[y](`[${u}]  ${o.name}:`,...a);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class XE{constructor(t){this.name=t,this._logLevel=VF,this._logHandler=UF,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Rr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?FF[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Rr.DEBUG,...t),this._logHandler(this,Rr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Rr.VERBOSE,...t),this._logHandler(this,Rr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Rr.INFO,...t),this._logHandler(this,Rr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Rr.WARN,...t),this._logHandler(this,Rr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Rr.ERROR,...t),this._logHandler(this,Rr.ERROR,...t)}}const GF=(o,t)=>t.some(a=>o instanceof a);let zC,NC;function qF(){return zC||(zC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function HF(){return NC||(NC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const VD=new WeakMap,JT=new WeakMap,jD=new WeakMap,bT=new WeakMap,YE=new WeakMap;function $F(o){const t=new Promise((a,u)=>{const y=()=>{o.removeEventListener("success",T),o.removeEventListener("error",C)},T=()=>{a(Pm(o.result)),y()},C=()=>{u(o.error),y()};o.addEventListener("success",T),o.addEventListener("error",C)});return t.then(a=>{a instanceof IDBCursor&&VD.set(a,o)}).catch(()=>{}),YE.set(t,o),t}function ZF(o){if(JT.has(o))return;const t=new Promise((a,u)=>{const y=()=>{o.removeEventListener("complete",T),o.removeEventListener("error",C),o.removeEventListener("abort",C)},T=()=>{a(),y()},C=()=>{u(o.error||new DOMException("AbortError","AbortError")),y()};o.addEventListener("complete",T),o.addEventListener("error",C),o.addEventListener("abort",C)});JT.set(o,t)}let eE={get(o,t,a){if(o instanceof IDBTransaction){if(t==="done")return JT.get(o);if(t==="objectStoreNames")return o.objectStoreNames||jD.get(o);if(t==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return Pm(o[t])},set(o,t,a){return o[t]=a,!0},has(o,t){return o instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in o}};function WF(o){eE=o(eE)}function XF(o){return o===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...a){const u=o.call(wT(this),t,...a);return jD.set(u,t.sort?t.sort():[t]),Pm(u)}:HF().includes(o)?function(...t){return o.apply(wT(this),t),Pm(VD.get(this))}:function(...t){return Pm(o.apply(wT(this),t))}}function YF(o){return typeof o=="function"?XF(o):(o instanceof IDBTransaction&&ZF(o),GF(o,qF())?new Proxy(o,eE):o)}function Pm(o){if(o instanceof IDBRequest)return $F(o);if(bT.has(o))return bT.get(o);const t=YF(o);return t!==o&&(bT.set(o,t),YE.set(t,o)),t}const wT=o=>YE.get(o);function KF(o,t,{blocked:a,upgrade:u,blocking:y,terminated:T}={}){const C=indexedDB.open(o,t),s=Pm(C);return u&&C.addEventListener("upgradeneeded",V=>{u(Pm(C.result),V.oldVersion,V.newVersion,Pm(C.transaction),V)}),a&&C.addEventListener("blocked",V=>a(V.oldVersion,V.newVersion,V)),s.then(V=>{T&&V.addEventListener("close",()=>T()),y&&V.addEventListener("versionchange",B=>y(B.oldVersion,B.newVersion,B))}).catch(()=>{}),s}const QF=["get","getKey","getAll","getAllKeys","count"],JF=["put","add","delete","clear"],TT=new Map;function BC(o,t){if(!(o instanceof IDBDatabase&&!(t in o)&&typeof t=="string"))return;if(TT.get(t))return TT.get(t);const a=t.replace(/FromIndex$/,""),u=t!==a,y=JF.includes(a);if(!(a in(u?IDBIndex:IDBObjectStore).prototype)||!(y||QF.includes(a)))return;const T=async function(C,...s){const V=this.transaction(C,y?"readwrite":"readonly");let B=V.store;return u&&(B=B.index(s.shift())),(await Promise.all([B[a](...s),y&&V.done]))[0]};return TT.set(t,T),T}WF(o=>({...o,get:(t,a,u)=>BC(t,a)||o.get(t,a,u),has:(t,a)=>!!BC(t,a)||o.has(t,a)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(t5(a)){const u=a.getImmediate();return`${u.library}/${u.version}`}else return null}).filter(a=>a).join(" ")}}function t5(o){const t=o.getComponent();return(t==null?void 0:t.type)==="VERSION"}const tE="@firebase/app",FC="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp=new XE("@firebase/app"),n5="@firebase/app-compat",i5="@firebase/analytics-compat",r5="@firebase/analytics",s5="@firebase/app-check-compat",a5="@firebase/app-check",o5="@firebase/auth",l5="@firebase/auth-compat",c5="@firebase/database",u5="@firebase/data-connect",h5="@firebase/database-compat",d5="@firebase/functions",f5="@firebase/functions-compat",p5="@firebase/installations",m5="@firebase/installations-compat",g5="@firebase/messaging",_5="@firebase/messaging-compat",y5="@firebase/performance",x5="@firebase/performance-compat",v5="@firebase/remote-config",b5="@firebase/remote-config-compat",w5="@firebase/storage",T5="@firebase/storage-compat",E5="@firebase/firestore",S5="@firebase/ai",A5="@firebase/firestore-compat",I5="firebase",C5="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nE="[DEFAULT]",R5={[tE]:"fire-core",[n5]:"fire-core-compat",[r5]:"fire-analytics",[i5]:"fire-analytics-compat",[a5]:"fire-app-check",[s5]:"fire-app-check-compat",[o5]:"fire-auth",[l5]:"fire-auth-compat",[c5]:"fire-rtdb",[u5]:"fire-data-connect",[h5]:"fire-rtdb-compat",[d5]:"fire-fn",[f5]:"fire-fn-compat",[p5]:"fire-iid",[m5]:"fire-iid-compat",[g5]:"fire-fcm",[_5]:"fire-fcm-compat",[y5]:"fire-perf",[x5]:"fire-perf-compat",[v5]:"fire-rc",[b5]:"fire-rc-compat",[w5]:"fire-gcs",[T5]:"fire-gcs-compat",[E5]:"fire-fst",[A5]:"fire-fst-compat",[S5]:"fire-vertex","fire-js":"fire-js",[I5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb=new Map,M5=new Map,iE=new Map;function VC(o,t){try{o.container.addComponent(t)}catch(a){xp.debug(`Component ${t.name} failed to register with FirebaseApp ${o.name}`,a)}}function Py(o){const t=o.name;if(iE.has(t))return xp.debug(`There were multiple attempts to register component ${t}.`),!1;iE.set(t,o);for(const a of Qb.values())VC(a,o);for(const a of M5.values())VC(a,o);return!0}function KE(o,t){const a=o.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),o.container.getProvider(t)}function Xh(o){return o==null?!1:o.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},km=new Hv("app","Firebase",D5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(t,a,u){this._isDeleted=!1,this._options={...t},this._config={...a},this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=u,this.container.addComponent(new o_("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw km.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hy=C5;function UD(o,t={}){let a=o;typeof t!="object"&&(t={name:t});const u={name:nE,automaticDataCollectionEnabled:!0,...t},y=u.name;if(typeof y!="string"||!y)throw km.create("bad-app-name",{appName:String(y)});if(a||(a=zD()),!a)throw km.create("no-options");const T=Qb.get(y);if(T){if(a_(a,T.options)&&a_(u,T.config))return T;throw km.create("duplicate-app",{appName:y})}const C=new BF(y);for(const V of iE.values())C.addComponent(V);const s=new P5(a,u,C);return Qb.set(y,s),s}function GD(o=nE){const t=Qb.get(o);if(!t&&o===nE&&zD())return UD();if(!t)throw km.create("no-app",{appName:o});return t}function Lm(o,t,a){let u=R5[o]??o;a&&(u+=`-${a}`);const y=u.match(/\s|\//),T=t.match(/\s|\//);if(y||T){const C=[`Unable to register library "${u}" with version "${t}":`];y&&C.push(`library name "${u}" contains illegal characters (whitespace or "/")`),y&&T&&C.push("and"),T&&C.push(`version name "${t}" contains illegal characters (whitespace or "/")`),xp.warn(C.join(" "));return}Py(new o_(`${u}-version`,()=>({library:u,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5="firebase-heartbeat-database",L5=1,Mv="firebase-heartbeat-store";let ET=null;function qD(){return ET||(ET=KF(k5,L5,{upgrade:(o,t)=>{switch(t){case 0:try{o.createObjectStore(Mv)}catch(a){console.warn(a)}}}}).catch(o=>{throw km.create("idb-open",{originalErrorMessage:o.message})})),ET}async function O5(o){try{const a=(await qD()).transaction(Mv),u=await a.objectStore(Mv).get(HD(o));return await a.done,u}catch(t){if(t instanceof Ep)xp.warn(t.message);else{const a=km.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});xp.warn(a.message)}}}async function jC(o,t){try{const u=(await qD()).transaction(Mv,"readwrite");await u.objectStore(Mv).put(t,HD(o)),await u.done}catch(a){if(a instanceof Ep)xp.warn(a.message);else{const u=km.create("idb-set",{originalErrorMessage:a==null?void 0:a.message});xp.warn(u.message)}}}function HD(o){return`${o.name}!${o.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z5=1024,N5=30;class B5{constructor(t){this.container=t,this._heartbeatsCache=null;const a=this.container.getProvider("app").getImmediate();this._storage=new V5(a),this._heartbeatsCachePromise=this._storage.read().then(u=>(this._heartbeatsCache=u,u))}async triggerHeartbeat(){var t,a;try{const y=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),T=UC();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((a=this._heartbeatsCache)==null?void 0:a.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===T||this._heartbeatsCache.heartbeats.some(C=>C.date===T))return;if(this._heartbeatsCache.heartbeats.push({date:T,agent:y}),this._heartbeatsCache.heartbeats.length>N5){const C=j5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(C,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(u){xp.warn(u)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const a=UC(),{heartbeatsToSend:u,unsentEntries:y}=F5(this._heartbeatsCache.heartbeats),T=Kb(JSON.stringify({version:2,heartbeats:u}));return this._heartbeatsCache.lastSentHeartbeatDate=a,y.length>0?(this._heartbeatsCache.heartbeats=y,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),T}catch(a){return xp.warn(a),""}}}function UC(){return new Date().toISOString().substring(0,10)}function F5(o,t=z5){const a=[];let u=o.slice();for(const y of o){const T=a.find(C=>C.agent===y.agent);if(T){if(T.dates.push(y.date),GC(a)>t){T.dates.pop();break}}else if(a.push({agent:y.agent,dates:[y.date]}),GC(a)>t){a.pop();break}u=u.slice(1)}return{heartbeatsToSend:a,unsentEntries:u}}class V5{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return AF()?IF().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const a=await O5(this.app);return a!=null&&a.heartbeats?a:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const u=await this.read();return jC(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??u.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const u=await this.read();return jC(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...t.heartbeats]})}else return}}function GC(o){return Kb(JSON.stringify({version:2,heartbeats:o})).length}function j5(o){if(o.length===0)return-1;let t=0,a=o[0].date;for(let u=1;u<o.length;u++)o[u].date<a&&(a=o[u].date,t=u);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U5(o){Py(new o_("platform-logger",t=>new e5(t),"PRIVATE")),Py(new o_("heartbeat",t=>new B5(t),"PRIVATE")),Lm(tE,FC,o),Lm(tE,FC,"esm2020"),Lm("fire-js","")}U5("");function $D(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const G5=$D,ZD=new Hv("auth","Firebase",$D());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jb=new XE("@firebase/auth");function q5(o,...t){Jb.logLevel<=Rr.WARN&&Jb.warn(`Auth (${Hy}): ${o}`,...t)}function kb(o,...t){Jb.logLevel<=Rr.ERROR&&Jb.error(`Auth (${Hy}): ${o}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(o,...t){throw JE(o,...t)}function Qh(o,...t){return JE(o,...t)}function QE(o,t,a){const u={...G5(),[t]:a};return new Hv("auth","Firebase",u).create(t,{appName:o.name})}function r_(o){return QE(o,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function H5(o,t,a){const u=a;if(!(t instanceof u))throw u.name!==t.constructor.name&&lf(o,"argument-error"),QE(o,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function JE(o,...t){if(typeof o!="string"){const a=t[0],u=[...t.slice(1)];return u[0]&&(u[0].appName=o.name),o._errorFactory.create(a,...u)}return ZD.create(o,...t)}function Gi(o,t,...a){if(!o)throw JE(t,...a)}function pp(o){const t="INTERNAL ASSERTION FAILED: "+o;throw kb(t),new Error(t)}function vp(o,t){o||pp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rE(){var o;return typeof self<"u"&&((o=self.location)==null?void 0:o.href)||""}function $5(){return qC()==="http:"||qC()==="https:"}function qC(){var o;return typeof self<"u"&&((o=self.location)==null?void 0:o.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($5()||wF()||"connection"in navigator)?navigator.onLine:!0}function W5(){if(typeof navigator>"u")return null;const o=navigator;return o.languages&&o.languages[0]||o.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(t,a){this.shortDelay=t,this.longDelay=a,vp(a>t,"Short delay should be less than long delay!"),this.isMobile=xF()||TF()}get(){return Z5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(o,t){vp(o.emulator,"Emulator should always be set here");const{url:a}=o.emulator;return t?`${a}${t.startsWith("/")?t.slice(1):t}`:a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{static initialize(t,a,u){this.fetchImpl=t,a&&(this.headersImpl=a),u&&(this.responseImpl=u)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y5=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],K5=new Zv(3e4,6e4);function tS(o,t){return o.tenantId&&!t.tenantId?{...t,tenantId:o.tenantId}:t}async function $y(o,t,a,u,y={}){return XD(o,y,async()=>{let T={},C={};u&&(t==="GET"?C=u:T={body:JSON.stringify(u)});const s=$v({key:o.config.apiKey,...C}).slice(1),V=await o._getAdditionalHeaders();V["Content-Type"]="application/json",o.languageCode&&(V["X-Firebase-Locale"]=o.languageCode);const B={method:t,headers:V,...T};return bF()||(B.referrerPolicy="no-referrer"),o.emulatorConfig&&qy(o.emulatorConfig.host)&&(B.credentials="include"),WD.fetch()(await YD(o,o.config.apiHost,a,s),B)})}async function XD(o,t,a){o._canInitEmulator=!1;const u={...X5,...t};try{const y=new J5(o),T=await Promise.race([a(),y.promise]);y.clearNetworkTimeout();const C=await T.json();if("needConfirmation"in C)throw vb(o,"account-exists-with-different-credential",C);if(T.ok&&!("errorMessage"in C))return C;{const s=T.ok?C.errorMessage:C.error.message,[V,B]=s.split(" : ");if(V==="FEDERATED_USER_ID_ALREADY_LINKED")throw vb(o,"credential-already-in-use",C);if(V==="EMAIL_EXISTS")throw vb(o,"email-already-in-use",C);if(V==="USER_DISABLED")throw vb(o,"user-disabled",C);const W=u[V]||V.toLowerCase().replace(/[_\s]+/g,"-");if(B)throw QE(o,W,B);lf(o,W)}}catch(y){if(y instanceof Ep)throw y;lf(o,"network-request-failed",{message:String(y)})}}async function Q5(o,t,a,u,y={}){const T=await $y(o,t,a,u,y);return"mfaPendingCredential"in T&&lf(o,"multi-factor-auth-required",{_serverResponse:T}),T}async function YD(o,t,a,u){const y=`${t}${a}?${u}`,T=o,C=T.config.emulator?eS(o.config,y):`${o.config.apiScheme}://${y}`;return Y5.includes(a)&&(await T._persistenceManagerAvailable,T._getPersistenceType()==="COOKIE")?T._getPersistence()._getFinalTarget(C).toString():C}class J5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((a,u)=>{this.timer=setTimeout(()=>u(Qh(this.auth,"network-request-failed")),K5.get())})}}function vb(o,t,a){const u={appName:o.name};a.email&&(u.email=a.email),a.phoneNumber&&(u.phoneNumber=a.phoneNumber);const y=Qh(o,t,u);return y.customData._tokenResponse=a,y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e4(o,t){return $y(o,"POST","/v1/accounts:delete",t)}async function e1(o,t){return $y(o,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bv(o){if(o)try{const t=new Date(Number(o));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function t4(o,t=!1){const a=ic(o),u=await a.getIdToken(t),y=nS(u);Gi(y&&y.exp&&y.auth_time&&y.iat,a.auth,"internal-error");const T=typeof y.firebase=="object"?y.firebase:void 0,C=T==null?void 0:T.sign_in_provider;return{claims:y,token:u,authTime:bv(ST(y.auth_time)),issuedAtTime:bv(ST(y.iat)),expirationTime:bv(ST(y.exp)),signInProvider:C||null,signInSecondFactor:(T==null?void 0:T.sign_in_second_factor)||null}}function ST(o){return Number(o)*1e3}function nS(o){const[t,a,u]=o.split(".");if(t===void 0||a===void 0||u===void 0)return kb("JWT malformed, contained fewer than 3 sections"),null;try{const y=LD(a);return y?JSON.parse(y):(kb("Failed to decode base64 JWT payload"),null)}catch(y){return kb("Caught error parsing JWT payload as JSON",y==null?void 0:y.toString()),null}}function HC(o){const t=nS(o);return Gi(t,"internal-error"),Gi(typeof t.exp<"u","internal-error"),Gi(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dv(o,t,a=!1){if(a)return t;try{return await t}catch(u){throw u instanceof Ep&&n4(u)&&o.auth.currentUser===o&&await o.auth.signOut(),u}}function n4({code:o}){return o==="auth/user-disabled"||o==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const u=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,u)}}schedule(t=!1){if(!this.isRunning)return;const a=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},a)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(t,a){this.createdAt=t,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=bv(this.lastLoginAt),this.creationTime=bv(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t1(o){var Y;const t=o.auth,a=await o.getIdToken(),u=await Dv(o,e1(t,{idToken:a}));Gi(u==null?void 0:u.users.length,t,"internal-error");const y=u.users[0];o._notifyReloadListener(y);const T=(Y=y.providerUserInfo)!=null&&Y.length?KD(y.providerUserInfo):[],C=s4(o.providerData,T),s=o.isAnonymous,V=!(o.email&&y.passwordHash)&&!(C!=null&&C.length),B=s?V:!1,W={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:C,metadata:new sE(y.createdAt,y.lastLoginAt),isAnonymous:B};Object.assign(o,W)}async function r4(o){const t=ic(o);await t1(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function s4(o,t){return[...o.filter(u=>!t.some(y=>y.providerId===u.providerId)),...t]}function KD(o){return o.map(({providerId:t,...a})=>({providerId:t,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a4(o,t){const a=await XD(o,{},async()=>{const u=$v({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:y,apiKey:T}=o.config,C=await YD(o,y,"/v1/token",`key=${T}`),s=await o._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";const V={method:"POST",headers:s,body:u};return o.emulatorConfig&&qy(o.emulatorConfig.host)&&(V.credentials="include"),WD.fetch()(C,V)});return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}}async function o4(o,t){return $y(o,"POST","/v2/accounts:revokeToken",tS(o,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Gi(t.idToken,"internal-error"),Gi(typeof t.idToken<"u","internal-error"),Gi(typeof t.refreshToken<"u","internal-error");const a="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):HC(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,a)}updateFromIdToken(t){Gi(t.length!==0,"internal-error");const a=HC(t);this.updateTokensAndExpiration(t,null,a)}async getToken(t,a=!1){return!a&&this.accessToken&&!this.isExpired?this.accessToken:(Gi(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,a){const{accessToken:u,refreshToken:y,expiresIn:T}=await a4(t,a);this.updateTokensAndExpiration(u,y,Number(T))}updateTokensAndExpiration(t,a,u){this.refreshToken=a||null,this.accessToken=t||null,this.expirationTime=Date.now()+u*1e3}static fromJSON(t,a){const{refreshToken:u,accessToken:y,expirationTime:T}=a,C=new Ty;return u&&(Gi(typeof u=="string","internal-error",{appName:t}),C.refreshToken=u),y&&(Gi(typeof y=="string","internal-error",{appName:t}),C.accessToken=y),T&&(Gi(typeof T=="number","internal-error",{appName:t}),C.expirationTime=T),C}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Ty,this.toJSON())}_performRefresh(){return pp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sm(o,t){Gi(typeof o=="string"||typeof o>"u","internal-error",{appName:t})}class Yh{constructor({uid:t,auth:a,stsTokenManager:u,...y}){this.providerId="firebase",this.proactiveRefresh=new i4(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=a,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new sE(y.createdAt||void 0,y.lastLoginAt||void 0)}async getIdToken(t){const a=await Dv(this,this.stsTokenManager.getToken(this.auth,t));return Gi(a,this.auth,"internal-error"),this.accessToken!==a&&(this.accessToken=a,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),a}getIdTokenResult(t){return t4(this,t)}reload(){return r4(this)}_assign(t){this!==t&&(Gi(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(a=>({...a})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const a=new Yh({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return a.metadata._copy(this.metadata),a}_onReload(t){Gi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,a=!1){let u=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),u=!0),a&&await t1(this),await this.auth._persistUserIfCurrent(this),u&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xh(this.auth.app))return Promise.reject(r_(this.auth));const t=await this.getIdToken();return await Dv(this,e4(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,a){const u=a.displayName??void 0,y=a.email??void 0,T=a.phoneNumber??void 0,C=a.photoURL??void 0,s=a.tenantId??void 0,V=a._redirectEventId??void 0,B=a.createdAt??void 0,W=a.lastLoginAt??void 0,{uid:Y,emailVerified:ae,isAnonymous:he,providerData:Qe,stsTokenManager:Ye}=a;Gi(Y&&Ye,t,"internal-error");const Ke=Ty.fromJSON(this.name,Ye);Gi(typeof Y=="string",t,"internal-error"),Sm(u,t.name),Sm(y,t.name),Gi(typeof ae=="boolean",t,"internal-error"),Gi(typeof he=="boolean",t,"internal-error"),Sm(T,t.name),Sm(C,t.name),Sm(s,t.name),Sm(V,t.name),Sm(B,t.name),Sm(W,t.name);const at=new Yh({uid:Y,auth:t,email:y,emailVerified:ae,displayName:u,isAnonymous:he,photoURL:C,phoneNumber:T,tenantId:s,stsTokenManager:Ke,createdAt:B,lastLoginAt:W});return Qe&&Array.isArray(Qe)&&(at.providerData=Qe.map(nt=>({...nt}))),V&&(at._redirectEventId=V),at}static async _fromIdTokenResponse(t,a,u=!1){const y=new Ty;y.updateFromServerResponse(a);const T=new Yh({uid:a.localId,auth:t,stsTokenManager:y,isAnonymous:u});return await t1(T),T}static async _fromGetAccountInfoResponse(t,a,u){const y=a.users[0];Gi(y.localId!==void 0,"internal-error");const T=y.providerUserInfo!==void 0?KD(y.providerUserInfo):[],C=!(y.email&&y.passwordHash)&&!(T!=null&&T.length),s=new Ty;s.updateFromIdToken(u);const V=new Yh({uid:y.localId,auth:t,stsTokenManager:s,isAnonymous:C}),B={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:T,metadata:new sE(y.createdAt,y.lastLoginAt),isAnonymous:!(y.email&&y.passwordHash)&&!(T!=null&&T.length)};return Object.assign(V,B),V}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=new Map;function mp(o){vp(o instanceof Function,"Expected a class definition");let t=$C.get(o);return t?(vp(t instanceof o,"Instance stored in cache mismatched with class"),t):(t=new o,$C.set(o,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,a){this.storage[t]=a}async _get(t){const a=this.storage[t];return a===void 0?null:a}async _remove(t){delete this.storage[t]}_addListener(t,a){}_removeListener(t,a){}}QD.type="NONE";const ZC=QD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lb(o,t,a){return`firebase:${o}:${t}:${a}`}class Ey{constructor(t,a,u){this.persistence=t,this.auth=a,this.userKey=u;const{config:y,name:T}=this.auth;this.fullUserKey=Lb(this.userKey,y.apiKey,T),this.fullPersistenceKey=Lb("persistence",y.apiKey,T),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const a=await e1(this.auth,{idToken:t}).catch(()=>{});return a?Yh._fromGetAccountInfoResponse(this.auth,a,t):null}return Yh._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const a=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,a)return this.setCurrentUser(a)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,a,u="authUser"){if(!a.length)return new Ey(mp(ZC),t,u);const y=(await Promise.all(a.map(async B=>{if(await B._isAvailable())return B}))).filter(B=>B);let T=y[0]||mp(ZC);const C=Lb(u,t.config.apiKey,t.name);let s=null;for(const B of a)try{const W=await B._get(C);if(W){let Y;if(typeof W=="string"){const ae=await e1(t,{idToken:W}).catch(()=>{});if(!ae)break;Y=await Yh._fromGetAccountInfoResponse(t,ae,W)}else Y=Yh._fromJSON(t,W);B!==T&&(s=Y),T=B;break}}catch{}const V=y.filter(B=>B._shouldAllowMigration);return!T._shouldAllowMigration||!V.length?new Ey(T,t,u):(T=V[0],s&&await T._set(C,s.toJSON()),await Promise.all(a.map(async B=>{if(B!==T)try{await B._remove(C)}catch{}})),new Ey(T,t,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WC(o){const t=o.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(nP(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(JD(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(rP(t))return"Blackberry";if(sP(t))return"Webos";if(eP(t))return"Safari";if((t.includes("chrome/")||tP(t))&&!t.includes("edge/"))return"Chrome";if(iP(t))return"Android";{const a=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,u=o.match(a);if((u==null?void 0:u.length)===2)return u[1]}return"Other"}function JD(o=Il()){return/firefox\//i.test(o)}function eP(o=Il()){const t=o.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tP(o=Il()){return/crios\//i.test(o)}function nP(o=Il()){return/iemobile/i.test(o)}function iP(o=Il()){return/android/i.test(o)}function rP(o=Il()){return/blackberry/i.test(o)}function sP(o=Il()){return/webos/i.test(o)}function iS(o=Il()){return/iphone|ipad|ipod/i.test(o)||/macintosh/i.test(o)&&/mobile/i.test(o)}function l4(o=Il()){var t;return iS(o)&&!!((t=window.navigator)!=null&&t.standalone)}function c4(){return EF()&&document.documentMode===10}function aP(o=Il()){return iS(o)||iP(o)||sP(o)||rP(o)||/windows phone/i.test(o)||nP(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oP(o,t=[]){let a;switch(o){case"Browser":a=WC(Il());break;case"Worker":a=`${WC(Il())}-${o}`;break;default:a=o}const u=t.length?t.join(","):"FirebaseCore-web";return`${a}/JsCore/${Hy}/${u}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,a){const u=T=>new Promise((C,s)=>{try{const V=t(T);C(V)}catch(V){s(V)}});u.onAbort=a,this.queue.push(u);const y=this.queue.length-1;return()=>{this.queue[y]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const a=[];try{for(const u of this.queue)await u(t),u.onAbort&&a.push(u.onAbort)}catch(u){a.reverse();for(const y of a)try{y()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:u==null?void 0:u.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h4(o,t={}){return $y(o,"GET","/v2/passwordPolicy",tS(o,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d4=6;class f4{constructor(t){var u;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=a.minPasswordLength??d4,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((u=t.allowedNonAlphanumericCharacters)==null?void 0:u.join(""))??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=a.meetsMinPasswordLength??!0),a.isValid&&(a.isValid=a.meetsMaxPasswordLength??!0),a.isValid&&(a.isValid=a.containsLowercaseLetter??!0),a.isValid&&(a.isValid=a.containsUppercaseLetter??!0),a.isValid&&(a.isValid=a.containsNumericCharacter??!0),a.isValid&&(a.isValid=a.containsNonAlphanumericCharacter??!0),a}validatePasswordLengthOptions(t,a){const u=this.customStrengthOptions.minPasswordLength,y=this.customStrengthOptions.maxPasswordLength;u&&(a.meetsMinPasswordLength=t.length>=u),y&&(a.meetsMaxPasswordLength=t.length<=y)}validatePasswordCharacterOptions(t,a){this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);let u;for(let y=0;y<t.length;y++)u=t.charAt(y),this.updatePasswordCharacterOptionsStatuses(a,u>="a"&&u<="z",u>="A"&&u<="Z",u>="0"&&u<="9",this.allowedNonAlphanumericCharacters.includes(u))}updatePasswordCharacterOptionsStatuses(t,a,u,y,T){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=u)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=y)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=T))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4{constructor(t,a,u,y){this.app=t,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=u,this.config=y,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new XC(this),this.idTokenSubscription=new XC(this),this.beforeStateQueue=new u4(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ZD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=y.sdkClientVersion,this._persistenceManagerAvailable=new Promise(T=>this._resolvePersistenceManagerAvailable=T)}_initializeWithPersistence(t,a){return a&&(this._popupRedirectResolver=mp(a)),this._initializationPromise=this.queue(async()=>{var u,y,T;if(!this._deleted&&(this.persistenceManager=await Ey.create(this,t),(u=this._resolvePersistenceManagerAvailable)==null||u.call(this),!this._deleted)){if((y=this._popupRedirectResolver)!=null&&y._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(a),this.lastNotifiedUid=((T=this.currentUser)==null?void 0:T.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const a=await e1(this,{idToken:t}),u=await Yh._fromGetAccountInfoResponse(this,a,t);await this.directlySetCurrentUser(u)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var T;if(Xh(this.app)){const C=this.app.settings.authIdToken;return C?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(C).then(s,s))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let u=a,y=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const C=(T=this.redirectUser)==null?void 0:T._redirectEventId,s=u==null?void 0:u._redirectEventId,V=await this.tryRedirectSignIn(t);(!C||C===s)&&(V!=null&&V.user)&&(u=V.user,y=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(y)try{await this.beforeStateQueue.runMiddleware(u)}catch(C){u=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(C))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return Gi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(t){let a=null;try{a=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return a}async reloadAndSetCurrentUserOrClear(t){try{await t1(t)}catch(a){if((a==null?void 0:a.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=W5()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Xh(this.app))return Promise.reject(r_(this));const a=t?ic(t):null;return a&&Gi(a.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(a&&a._clone(this))}async _updateCurrentUser(t,a=!1){if(!this._deleted)return t&&Gi(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),a||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Xh(this.app)?Promise.reject(r_(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Xh(this.app)?Promise.reject(r_(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mp(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const a=this._getPasswordPolicyInternal();return a.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):a.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await h4(this),a=new f4(t);this.tenantId===null?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Hv("auth","Firebase",t())}onAuthStateChanged(t,a,u){return this.registerStateListener(this.authStateSubscription,t,a,u)}beforeAuthStateChanged(t,a){return this.beforeStateQueue.pushCallback(t,a)}onIdTokenChanged(t,a,u){return this.registerStateListener(this.idTokenSubscription,t,a,u)}authStateReady(){return new Promise((t,a)=>{if(this.currentUser)t();else{const u=this.onAuthStateChanged(()=>{u(),t()},a)}})}async revokeAccessToken(t){if(this.currentUser){const a=await this.currentUser.getIdToken(),u={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:a};this.tenantId!=null&&(u.tenantId=this.tenantId),await o4(this,u)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)==null?void 0:t.toJSON()}}async _setRedirectUser(t,a){const u=await this.getOrInitRedirectPersistenceManager(a);return t===null?u.removeCurrentUser():u.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const a=t&&mp(t)||this._popupRedirectResolver;Gi(a,this,"argument-error"),this.redirectPersistenceManager=await Ey.create(this,[mp(a._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var a,u;return this._isInitialized&&await this.queue(async()=>{}),((a=this._currentUser)==null?void 0:a._redirectEventId)===t?this._currentUser:((u=this.redirectUser)==null?void 0:u._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=((a=this.currentUser)==null?void 0:a.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,a,u,y){if(this._deleted)return()=>{};const T=typeof a=="function"?a:a.next.bind(a);let C=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gi(s,this,"internal-error"),s.then(()=>{C||T(this.currentUser)}),typeof a=="function"){const V=t.addObserver(a,u,y);return()=>{C=!0,V()}}else{const V=t.addObserver(a);return()=>{C=!0,V()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Gi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=oP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var y;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const a=await((y=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:y.getHeartbeatsHeader());a&&(t["X-Firebase-Client"]=a);const u=await this._getAppCheckToken();return u&&(t["X-Firebase-AppCheck"]=u),t}async _getAppCheckToken(){var a;if(Xh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((a=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:a.getToken());return t!=null&&t.error&&q5(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function w1(o){return ic(o)}class XC{constructor(t){this.auth=t,this.observer=null,this.addObserver=PF(a=>this.observer=a)}get next(){return Gi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rS={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function m4(o){rS=o}function g4(o){return rS.loadJS(o)}function _4(){return rS.gapiScript}function y4(o){return`__${o}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x4(o,t){const a=KE(o,"auth");if(a.isInitialized()){const y=a.getImmediate(),T=a.getOptions();if(a_(T,t??{}))return y;lf(y,"already-initialized")}return a.initialize({options:t})}function v4(o,t){const a=(t==null?void 0:t.persistence)||[],u=(Array.isArray(a)?a:[a]).map(mp);t!=null&&t.errorMap&&o._updateErrorMap(t.errorMap),o._initializeWithPersistence(u,t==null?void 0:t.popupRedirectResolver)}function b4(o,t,a){const u=w1(o);Gi(/^https?:\/\//.test(t),u,"invalid-emulator-scheme");const y=!1,T=lP(t),{host:C,port:s}=w4(t),V=s===null?"":`:${s}`,B={url:`${T}//${C}${V}/`},W=Object.freeze({host:C,port:s,protocol:T.replace(":",""),options:Object.freeze({disableWarnings:y})});if(!u._canInitEmulator){Gi(u.config.emulator&&u.emulatorConfig,u,"emulator-config-failed"),Gi(a_(B,u.config.emulator)&&a_(W,u.emulatorConfig),u,"emulator-config-failed");return}u.config.emulator=B,u.emulatorConfig=W,u.settings.appVerificationDisabledForTesting=!0,qy(C)?(BD(`${T}//${C}${V}`),FD("Auth",!0)):T4()}function lP(o){const t=o.indexOf(":");return t<0?"":o.substr(0,t+1)}function w4(o){const t=lP(o),a=/(\/\/)?([^?#/]+)/.exec(o.substr(t.length));if(!a)return{host:"",port:null};const u=a[2].split("@").pop()||"",y=/^(\[[^\]]+\])(:|$)/.exec(u);if(y){const T=y[1];return{host:T,port:YC(u.substr(T.length+1))}}else{const[T,C]=u.split(":");return{host:T,port:YC(C)}}}function YC(o){if(!o)return null;const t=Number(o);return isNaN(t)?null:t}function T4(){function o(){const t=document.createElement("p"),a=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",o):o())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(t,a){this.providerId=t,this.signInMethod=a}toJSON(){return pp("not implemented")}_getIdTokenResponse(t){return pp("not implemented")}_linkToIdToken(t,a){return pp("not implemented")}_getReauthenticationResolver(t){return pp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sy(o,t){return Q5(o,"POST","/v1/accounts:signInWithIdp",tS(o,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="http://localhost";class l_ extends cP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const a=new l_(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(a.idToken=t.idToken),t.accessToken&&(a.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(a.nonce=t.nonce),t.pendingToken&&(a.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(a.accessToken=t.oauthToken,a.secret=t.oauthTokenSecret):lf("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const a=typeof t=="string"?JSON.parse(t):t,{providerId:u,signInMethod:y,...T}=a;if(!u||!y)return null;const C=new l_(u,y);return C.idToken=T.idToken||void 0,C.accessToken=T.accessToken||void 0,C.secret=T.secret,C.nonce=T.nonce,C.pendingToken=T.pendingToken||null,C}_getIdTokenResponse(t){const a=this.buildRequest();return Sy(t,a)}_linkToIdToken(t,a){const u=this.buildRequest();return u.idToken=a,Sy(t,u)}_getReauthenticationResolver(t){const a=this.buildRequest();return a.autoCreate=!1,Sy(t,a)}buildRequest(){const t={requestUri:E4,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),t.postBody=$v(a)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv extends sS{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm extends Wv{constructor(){super("facebook.com")}static credential(t){return l_._fromParams({providerId:Cm.PROVIDER_ID,signInMethod:Cm.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Cm.credentialFromTaggedObject(t)}static credentialFromError(t){return Cm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Cm.credential(t.oauthAccessToken)}catch{return null}}}Cm.FACEBOOK_SIGN_IN_METHOD="facebook.com";Cm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp extends Wv{constructor(){super("google.com"),this.addScope("profile")}static credential(t,a){return l_._fromParams({providerId:fp.PROVIDER_ID,signInMethod:fp.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:a})}static credentialFromResult(t){return fp.credentialFromTaggedObject(t)}static credentialFromError(t){return fp.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:a,oauthAccessToken:u}=t;if(!a&&!u)return null;try{return fp.credential(a,u)}catch{return null}}}fp.GOOGLE_SIGN_IN_METHOD="google.com";fp.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm extends Wv{constructor(){super("github.com")}static credential(t){return l_._fromParams({providerId:Rm.PROVIDER_ID,signInMethod:Rm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Rm.credentialFromTaggedObject(t)}static credentialFromError(t){return Rm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Rm.credential(t.oauthAccessToken)}catch{return null}}}Rm.GITHUB_SIGN_IN_METHOD="github.com";Rm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm extends Wv{constructor(){super("twitter.com")}static credential(t,a){return l_._fromParams({providerId:Mm.PROVIDER_ID,signInMethod:Mm.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:a})}static credentialFromResult(t){return Mm.credentialFromTaggedObject(t)}static credentialFromError(t){return Mm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:a,oauthTokenSecret:u}=t;if(!a||!u)return null;try{return Mm.credential(a,u)}catch{return null}}}Mm.TWITTER_SIGN_IN_METHOD="twitter.com";Mm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,a,u,y=!1){const T=await Yh._fromIdTokenResponse(t,u,y),C=KC(u);return new ky({user:T,providerId:C,_tokenResponse:u,operationType:a})}static async _forOperation(t,a,u){await t._updateTokensIfNecessary(u,!0);const y=KC(u);return new ky({user:t,providerId:y,_tokenResponse:u,operationType:a})}}function KC(o){return o.providerId?o.providerId:"phoneNumber"in o?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1 extends Ep{constructor(t,a,u,y){super(a.code,a.message),this.operationType=u,this.user=y,Object.setPrototypeOf(this,n1.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:a.customData._serverResponse,operationType:u}}static _fromErrorAndOperation(t,a,u,y){return new n1(t,a,u,y)}}function uP(o,t,a,u){return(t==="reauthenticate"?a._getReauthenticationResolver(o):a._getIdTokenResponse(o)).catch(T=>{throw T.code==="auth/multi-factor-auth-required"?n1._fromErrorAndOperation(o,T,t,u):T})}async function S4(o,t,a=!1){const u=await Dv(o,t._linkToIdToken(o.auth,await o.getIdToken()),a);return ky._forOperation(o,"link",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A4(o,t,a=!1){const{auth:u}=o;if(Xh(u.app))return Promise.reject(r_(u));const y="reauthenticate";try{const T=await Dv(o,uP(u,y,t,o),a);Gi(T.idToken,u,"internal-error");const C=nS(T.idToken);Gi(C,u,"internal-error");const{sub:s}=C;return Gi(o.uid===s,u,"user-mismatch"),ky._forOperation(o,y,T)}catch(T){throw(T==null?void 0:T.code)==="auth/user-not-found"&&lf(u,"user-mismatch"),T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I4(o,t,a=!1){if(Xh(o.app))return Promise.reject(r_(o));const u="signIn",y=await uP(o,u,t),T=await ky._fromIdTokenResponse(o,u,y);return a||await o._updateCurrentUser(T.user),T}function C4(o,t,a,u){return ic(o).onIdTokenChanged(t,a,u)}function R4(o,t,a){return ic(o).beforeAuthStateChanged(t,a)}function M4(o,t,a,u){return ic(o).onAuthStateChanged(t,a,u)}function D4(o){return ic(o).signOut()}const i1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(t,a){this.storageRetriever=t,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(i1,"1"),this.storage.removeItem(i1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,a){return this.storage.setItem(t,JSON.stringify(a)),Promise.resolve()}_get(t){const a=this.storage.getItem(t);return Promise.resolve(a?JSON.parse(a):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4=1e3,k4=10;class dP extends hP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,a)=>this.onStorageEvent(t,a),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=aP(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const a of Object.keys(this.listeners)){const u=this.storage.getItem(a),y=this.localCache[a];u!==y&&t(a,y,u)}}onStorageEvent(t,a=!1){if(!t.key){this.forAllChangedKeys((C,s,V)=>{this.notifyListeners(C,V)});return}const u=t.key;a?this.detachListener():this.stopPolling();const y=()=>{const C=this.storage.getItem(u);!a&&this.localCache[u]===C||this.notifyListeners(u,C)},T=this.storage.getItem(u);c4()&&T!==t.newValue&&t.newValue!==t.oldValue?setTimeout(y,k4):y()}notifyListeners(t,a){this.localCache[t]=a;const u=this.listeners[t];if(u)for(const y of Array.from(u))y(a&&JSON.parse(a))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,a,u)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:a,newValue:u}),!0)})},P4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,a){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(a)}_removeListener(t,a){this.listeners[t]&&(this.listeners[t].delete(a),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,a){await super._set(t,a),this.localCache[t]=JSON.stringify(a)}async _get(t){const a=await super._get(t);return this.localCache[t]=JSON.stringify(a),a}async _remove(t){await super._remove(t),delete this.localCache[t]}}dP.type="LOCAL";const L4=dP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP extends hP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,a){}_removeListener(t,a){}}fP.type="SESSION";const pP=fP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O4(o){return Promise.all(o.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(a){return{fulfilled:!1,reason:a}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const a=this.receivers.find(y=>y.isListeningto(t));if(a)return a;const u=new T1(t);return this.receivers.push(u),u}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const a=t,{eventId:u,eventType:y,data:T}=a.data,C=this.handlersMap[y];if(!(C!=null&&C.size))return;a.ports[0].postMessage({status:"ack",eventId:u,eventType:y});const s=Array.from(C).map(async B=>B(a.origin,T)),V=await O4(s);a.ports[0].postMessage({status:"done",eventId:u,eventType:y,response:V})}_subscribe(t,a){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(a)}_unsubscribe(t,a){this.handlersMap[t]&&a&&this.handlersMap[t].delete(a),(!a||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}T1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aS(o="",t=10){let a="";for(let u=0;u<t;u++)a+=Math.floor(Math.random()*10);return o+a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,a,u=50){const y=typeof MessageChannel<"u"?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let T,C;return new Promise((s,V)=>{const B=aS("",20);y.port1.start();const W=setTimeout(()=>{V(new Error("unsupported_event"))},u);C={messageChannel:y,onMessage(Y){const ae=Y;if(ae.data.eventId===B)switch(ae.data.status){case"ack":clearTimeout(W),T=setTimeout(()=>{V(new Error("timeout"))},3e3);break;case"done":clearTimeout(T),s(ae.data.response);break;default:clearTimeout(W),clearTimeout(T),V(new Error("invalid_response"));break}}},this.handlers.add(C),y.port1.addEventListener("message",C.onMessage),this.target.postMessage({eventType:t,eventId:B,data:a},[y.port2])}).finally(()=>{C&&this.removeMessageHandler(C)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(){return window}function N4(o){nf().location.href=o}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mP(){return typeof nf().WorkerGlobalScope<"u"&&typeof nf().importScripts=="function"}async function B4(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function F4(){var o;return((o=navigator==null?void 0:navigator.serviceWorker)==null?void 0:o.controller)||null}function V4(){return mP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gP="firebaseLocalStorageDb",j4=1,r1="firebaseLocalStorage",_P="fbase_key";class Xv{constructor(t){this.request=t}toPromise(){return new Promise((t,a)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function E1(o,t){return o.transaction([r1],t?"readwrite":"readonly").objectStore(r1)}function U4(){const o=indexedDB.deleteDatabase(gP);return new Xv(o).toPromise()}function aE(){const o=indexedDB.open(gP,j4);return new Promise((t,a)=>{o.addEventListener("error",()=>{a(o.error)}),o.addEventListener("upgradeneeded",()=>{const u=o.result;try{u.createObjectStore(r1,{keyPath:_P})}catch(y){a(y)}}),o.addEventListener("success",async()=>{const u=o.result;u.objectStoreNames.contains(r1)?t(u):(u.close(),await U4(),t(await aE()))})})}async function QC(o,t,a){const u=E1(o,!0).put({[_P]:t,value:a});return new Xv(u).toPromise()}async function G4(o,t){const a=E1(o,!1).get(t),u=await new Xv(a).toPromise();return u===void 0?null:u.value}function JC(o,t){const a=E1(o,!0).delete(t);return new Xv(a).toPromise()}const q4=800,H4=3;class yP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await aE(),this.db)}async _withRetries(t){let a=0;for(;;)try{const u=await this._openDb();return await t(u)}catch(u){if(a++>H4)throw u;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=T1._getInstance(V4()),this.receiver._subscribe("keyChanged",async(t,a)=>({keyProcessed:(await this._poll()).includes(a.key)})),this.receiver._subscribe("ping",async(t,a)=>["keyChanged"])}async initializeSender(){var a,u;if(this.activeServiceWorker=await B4(),!this.activeServiceWorker)return;this.sender=new z4(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&(a=t[0])!=null&&a.fulfilled&&(u=t[0])!=null&&u.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||F4()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await aE();return await QC(t,i1,"1"),await JC(t,i1),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,a){return this._withPendingWrite(async()=>(await this._withRetries(u=>QC(u,t,a)),this.localCache[t]=a,this.notifyServiceWorker(t)))}async _get(t){const a=await this._withRetries(u=>G4(u,t));return this.localCache[t]=a,a}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(a=>JC(a,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(y=>{const T=E1(y,!1).getAll();return new Xv(T).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const a=[],u=new Set;if(t.length!==0)for(const{fbase_key:y,value:T}of t)u.add(y),JSON.stringify(this.localCache[y])!==JSON.stringify(T)&&(this.notifyListeners(y,T),a.push(y));for(const y of Object.keys(this.localCache))this.localCache[y]&&!u.has(y)&&(this.notifyListeners(y,null),a.push(y));return a}notifyListeners(t,a){this.localCache[t]=a;const u=this.listeners[t];if(u)for(const y of Array.from(u))y(a)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),q4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,a){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(a)}_removeListener(t,a){this.listeners[t]&&(this.listeners[t].delete(a),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}yP.type="LOCAL";const $4=yP;new Zv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(o,t){return t?mp(t):(Gi(o._popupRedirectResolver,o,"argument-error"),o._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS extends cP{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Sy(t,this._buildIdpRequest())}_linkToIdToken(t,a){return Sy(t,this._buildIdpRequest(a))}_getReauthenticationResolver(t){return Sy(t,this._buildIdpRequest())}_buildIdpRequest(t){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(a.idToken=t),a}}function Z4(o){return I4(o.auth,new oS(o),o.bypassAuthState)}function W4(o){const{auth:t,user:a}=o;return Gi(a,t,"internal-error"),A4(a,new oS(o),o.bypassAuthState)}async function X4(o){const{auth:t,user:a}=o;return Gi(a,t,"internal-error"),S4(a,new oS(o),o.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(t,a,u,y,T=!1){this.auth=t,this.resolver=u,this.user=y,this.bypassAuthState=T,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){return new Promise(async(t,a)=>{this.pendingPromise={resolve:t,reject:a};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(u){this.reject(u)}})}async onAuthEvent(t){const{urlResponse:a,sessionId:u,postBody:y,tenantId:T,error:C,type:s}=t;if(C){this.reject(C);return}const V={auth:this.auth,requestUri:a,sessionId:u,tenantId:T||void 0,postBody:y||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(V))}catch(B){this.reject(B)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Z4;case"linkViaPopup":case"linkViaRedirect":return X4;case"reauthViaPopup":case"reauthViaRedirect":return W4;default:lf(this.auth,"internal-error")}}resolve(t){vp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){vp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y4=new Zv(2e3,1e4);async function K4(o,t,a){if(Xh(o.app))return Promise.reject(Qh(o,"operation-not-supported-in-this-environment"));const u=w1(o);H5(o,t,sS);const y=xP(u,a);return new n_(u,"signInViaPopup",t,y).executeNotNull()}class n_ extends vP{constructor(t,a,u,y,T){super(t,a,y,T),this.provider=u,this.authWindow=null,this.pollId=null,n_.currentPopupAction&&n_.currentPopupAction.cancel(),n_.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Gi(t,this.auth,"internal-error"),t}async onExecution(){vp(this.filter.length===1,"Popup operations only handle one event");const t=aS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(a=>{this.reject(a)}),this.resolver._isIframeWebStorageSupported(this.auth,a=>{a||this.reject(Qh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)==null?void 0:t.associatedEvent)||null}cancel(){this.reject(Qh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n_.currentPopupAction=null}pollUserCancellation(){const t=()=>{var a,u;if((u=(a=this.authWindow)==null?void 0:a.window)!=null&&u.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Y4.get())};t()}}n_.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q4="pendingRedirect",Ob=new Map;class J4 extends vP{constructor(t,a,u=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,u),this.eventId=null}async execute(){let t=Ob.get(this.auth._key());if(!t){try{const u=await eV(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(u)}catch(a){t=()=>Promise.reject(a)}Ob.set(this.auth._key(),t)}return this.bypassAuthState||Ob.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const a=await this.auth._redirectUserForId(t.eventId);if(a)return this.user=a,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eV(o,t){const a=iV(t),u=nV(o);if(!await u._isAvailable())return!1;const y=await u._get(a)==="true";return await u._remove(a),y}function tV(o,t){Ob.set(o._key(),t)}function nV(o){return mp(o._redirectPersistence)}function iV(o){return Lb(Q4,o.config.apiKey,o.name)}async function rV(o,t,a=!1){if(Xh(o.app))return Promise.reject(r_(o));const u=w1(o),y=xP(u,t),C=await new J4(u,y,a).execute();return C&&!a&&(delete C.user._redirectEventId,await u._persistUserIfCurrent(C.user),await u._setRedirectUser(null,t)),C}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sV=600*1e3;class aV{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let a=!1;return this.consumers.forEach(u=>{this.isEventForConsumer(t,u)&&(a=!0,this.sendToConsumer(t,u),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!oV(t)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=t,a=!0)),a}sendToConsumer(t,a){var u;if(t.error&&!bP(t)){const y=((u=t.error.code)==null?void 0:u.split("auth/")[1])||"internal-error";a.onError(Qh(this.auth,y))}else a.onAuthEvent(t)}isEventForConsumer(t,a){const u=a.eventId===null||!!t.eventId&&t.eventId===a.eventId;return a.filter.includes(t.type)&&u}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=sV&&this.cachedEventUids.clear(),this.cachedEventUids.has(eR(t))}saveEventToCache(t){this.cachedEventUids.add(eR(t)),this.lastProcessedEventTime=Date.now()}}function eR(o){return[o.type,o.eventId,o.sessionId,o.tenantId].filter(t=>t).join("-")}function bP({type:o,error:t}){return o==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function oV(o){switch(o.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bP(o);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lV(o,t={}){return $y(o,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uV=/^https?/;async function hV(o){if(o.config.emulator)return;const{authorizedDomains:t}=await lV(o);for(const a of t)try{if(dV(a))return}catch{}lf(o,"unauthorized-domain")}function dV(o){const t=rE(),{protocol:a,hostname:u}=new URL(t);if(o.startsWith("chrome-extension://")){const C=new URL(o);return C.hostname===""&&u===""?a==="chrome-extension:"&&o.replace("chrome-extension://","")===t.replace("chrome-extension://",""):a==="chrome-extension:"&&C.hostname===u}if(!uV.test(a))return!1;if(cV.test(o))return u===o;const y=o.replace(/\./g,"\\.");return new RegExp("^(.+\\."+y+"|"+y+")$","i").test(u)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fV=new Zv(3e4,6e4);function tR(){const o=nf().___jsl;if(o!=null&&o.H){for(const t of Object.keys(o.H))if(o.H[t].r=o.H[t].r||[],o.H[t].L=o.H[t].L||[],o.H[t].r=[...o.H[t].L],o.CP)for(let a=0;a<o.CP.length;a++)o.CP[a]=null}}function pV(o){return new Promise((t,a)=>{var y,T,C;function u(){tR(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{tR(),a(Qh(o,"network-request-failed"))},timeout:fV.get()})}if((T=(y=nf().gapi)==null?void 0:y.iframes)!=null&&T.Iframe)t(gapi.iframes.getContext());else if((C=nf().gapi)!=null&&C.load)u();else{const s=y4("iframefcb");return nf()[s]=()=>{gapi.load?u():a(Qh(o,"network-request-failed"))},g4(`${_4()}?onload=${s}`).catch(V=>a(V))}}).catch(t=>{throw zb=null,t})}let zb=null;function mV(o){return zb=zb||pV(o),zb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=new Zv(5e3,15e3),_V="__/auth/iframe",yV="emulator/auth/iframe",xV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bV(o){const t=o.config;Gi(t.authDomain,o,"auth-domain-config-required");const a=t.emulator?eS(t,yV):`https://${o.config.authDomain}/${_V}`,u={apiKey:t.apiKey,appName:o.name,v:Hy},y=vV.get(o.config.apiHost);y&&(u.eid=y);const T=o._getFrameworks();return T.length&&(u.fw=T.join(",")),`${a}?${$v(u).slice(1)}`}async function wV(o){const t=await mV(o),a=nf().gapi;return Gi(a,o,"internal-error"),t.open({where:document.body,url:bV(o),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xV,dontclear:!0},u=>new Promise(async(y,T)=>{await u.restyle({setHideOnLeave:!1});const C=Qh(o,"network-request-failed"),s=nf().setTimeout(()=>{T(C)},gV.get());function V(){nf().clearTimeout(s),y(u)}u.ping(V).then(V,()=>{T(C)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},EV=500,SV=600,AV="_blank",IV="http://localhost";class nR{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function CV(o,t,a,u=EV,y=SV){const T=Math.max((window.screen.availHeight-y)/2,0).toString(),C=Math.max((window.screen.availWidth-u)/2,0).toString();let s="";const V={...TV,width:u.toString(),height:y.toString(),top:T,left:C},B=Il().toLowerCase();a&&(s=tP(B)?AV:a),JD(B)&&(t=t||IV,V.scrollbars="yes");const W=Object.entries(V).reduce((ae,[he,Qe])=>`${ae}${he}=${Qe},`,"");if(l4(B)&&s!=="_self")return RV(t||"",s),new nR(null);const Y=window.open(t||"",s,W);Gi(Y,o,"popup-blocked");try{Y.focus()}catch{}return new nR(Y)}function RV(o,t){const a=document.createElement("a");a.href=o,a.target=t;const u=document.createEvent("MouseEvent");u.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MV="__/auth/handler",DV="emulator/auth/handler",PV=encodeURIComponent("fac");async function iR(o,t,a,u,y,T){Gi(o.config.authDomain,o,"auth-domain-config-required"),Gi(o.config.apiKey,o,"invalid-api-key");const C={apiKey:o.config.apiKey,appName:o.name,authType:a,redirectUrl:u,v:Hy,eventId:y};if(t instanceof sS){t.setDefaultLanguage(o.languageCode),C.providerId=t.providerId||"",DF(t.getCustomParameters())||(C.customParameters=JSON.stringify(t.getCustomParameters()));for(const[W,Y]of Object.entries({}))C[W]=Y}if(t instanceof Wv){const W=t.getScopes().filter(Y=>Y!=="");W.length>0&&(C.scopes=W.join(","))}o.tenantId&&(C.tid=o.tenantId);const s=C;for(const W of Object.keys(s))s[W]===void 0&&delete s[W];const V=await o._getAppCheckToken(),B=V?`#${PV}=${encodeURIComponent(V)}`:"";return`${kV(o)}?${$v(s).slice(1)}${B}`}function kV({config:o}){return o.emulator?eS(o,DV):`https://${o.authDomain}/${MV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="webStorageSupport";class LV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pP,this._completeRedirectFn=rV,this._overrideRedirectResult=tV}async _openPopup(t,a,u,y){var C;vp((C=this.eventManagers[t._key()])==null?void 0:C.manager,"_initialize() not called before _openPopup()");const T=await iR(t,a,u,rE(),y);return CV(t,T,aS())}async _openRedirect(t,a,u,y){await this._originValidation(t);const T=await iR(t,a,u,rE(),y);return N4(T),new Promise(()=>{})}_initialize(t){const a=t._key();if(this.eventManagers[a]){const{manager:y,promise:T}=this.eventManagers[a];return y?Promise.resolve(y):(vp(T,"If manager is not set, promise should be"),T)}const u=this.initAndGetManager(t);return this.eventManagers[a]={promise:u},u.catch(()=>{delete this.eventManagers[a]}),u}async initAndGetManager(t){const a=await wV(t),u=new aV(t);return a.register("authEvent",y=>(Gi(y==null?void 0:y.authEvent,t,"invalid-auth-event"),{status:u.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:u},this.iframes[t._key()]=a,u}_isIframeWebStorageSupported(t,a){this.iframes[t._key()].send(AT,{type:AT},y=>{var C;const T=(C=y==null?void 0:y[0])==null?void 0:C[AT];T!==void 0&&a(!!T),lf(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const a=t._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=hV(t)),this.originValidationPromises[a]}get _shouldInitProactively(){return aP()||eP()||iS()}}const OV=LV;var rR="@firebase/auth",sR="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)==null?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const a=this.auth.onIdTokenChanged(u=>{t((u==null?void 0:u.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,a),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const a=this.internalListeners.get(t);a&&(this.internalListeners.delete(t),a(),this.updateProactiveRefresh())}assertAuthConfigured(){Gi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NV(o){switch(o){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function BV(o){Py(new o_("auth",(t,{options:a})=>{const u=t.getProvider("app").getImmediate(),y=t.getProvider("heartbeat"),T=t.getProvider("app-check-internal"),{apiKey:C,authDomain:s}=u.options;Gi(C&&!C.includes(":"),"invalid-api-key",{appName:u.name});const V={apiKey:C,authDomain:s,clientPlatform:o,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oP(o)},B=new p4(u,y,T,V);return v4(B,a),B},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,a,u)=>{t.getProvider("auth-internal").initialize()})),Py(new o_("auth-internal",t=>{const a=w1(t.getProvider("auth").getImmediate());return(u=>new zV(u))(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),Lm(rR,sR,NV(o)),Lm(rR,sR,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FV=300,VV=ND("authIdTokenMaxAge")||FV;let aR=null;const jV=o=>async t=>{const a=t&&await t.getIdTokenResult(),u=a&&(new Date().getTime()-Date.parse(a.issuedAtTime))/1e3;if(u&&u>VV)return;const y=a==null?void 0:a.token;aR!==y&&(aR=y,await fetch(o,{method:y?"POST":"DELETE",headers:y?{Authorization:`Bearer ${y}`}:{}}))};function UV(o=GD()){const t=KE(o,"auth");if(t.isInitialized())return t.getImmediate();const a=x4(o,{popupRedirectResolver:OV,persistence:[$4,L4,pP]}),u=ND("authTokenSyncURL");if(u&&typeof isSecureContext=="boolean"&&isSecureContext){const T=new URL(u,location.origin);if(location.origin===T.origin){const C=jV(T.toString());R4(a,C,()=>C(a.currentUser)),C4(a,s=>C(s))}}const y=OD("auth");return y&&b4(a,`http://${y}`),a}function GV(){var o;return((o=document.getElementsByTagName("head"))==null?void 0:o[0])??document}m4({loadJS(o){return new Promise((t,a)=>{const u=document.createElement("script");u.setAttribute("src",o),u.onload=t,u.onerror=y=>{const T=Qh("internal-error");T.customData=y,a(T)},u.type="text/javascript",u.charset="UTF-8",GV().appendChild(u)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});BV("Browser");var qV="firebase",HV="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lm(qV,HV,"app");var oR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Om,wP;(function(){var o;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Oe,Re){function Ve(){}Ve.prototype=Re.prototype,Oe.F=Re.prototype,Oe.prototype=new Ve,Oe.prototype.constructor=Oe,Oe.D=function(Je,He,tt){for(var ve=Array(arguments.length-2),Ht=2;Ht<arguments.length;Ht++)ve[Ht-2]=arguments[Ht];return Re.prototype[He].apply(Je,ve)}}function a(){this.blockSize=-1}function u(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(u,a),u.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function y(Oe,Re,Ve){Ve||(Ve=0);const Je=Array(16);if(typeof Re=="string")for(var He=0;He<16;++He)Je[He]=Re.charCodeAt(Ve++)|Re.charCodeAt(Ve++)<<8|Re.charCodeAt(Ve++)<<16|Re.charCodeAt(Ve++)<<24;else for(He=0;He<16;++He)Je[He]=Re[Ve++]|Re[Ve++]<<8|Re[Ve++]<<16|Re[Ve++]<<24;Re=Oe.g[0],Ve=Oe.g[1],He=Oe.g[2];let tt=Oe.g[3],ve;ve=Re+(tt^Ve&(He^tt))+Je[0]+3614090360&4294967295,Re=Ve+(ve<<7&4294967295|ve>>>25),ve=tt+(He^Re&(Ve^He))+Je[1]+3905402710&4294967295,tt=Re+(ve<<12&4294967295|ve>>>20),ve=He+(Ve^tt&(Re^Ve))+Je[2]+606105819&4294967295,He=tt+(ve<<17&4294967295|ve>>>15),ve=Ve+(Re^He&(tt^Re))+Je[3]+3250441966&4294967295,Ve=He+(ve<<22&4294967295|ve>>>10),ve=Re+(tt^Ve&(He^tt))+Je[4]+4118548399&4294967295,Re=Ve+(ve<<7&4294967295|ve>>>25),ve=tt+(He^Re&(Ve^He))+Je[5]+1200080426&4294967295,tt=Re+(ve<<12&4294967295|ve>>>20),ve=He+(Ve^tt&(Re^Ve))+Je[6]+2821735955&4294967295,He=tt+(ve<<17&4294967295|ve>>>15),ve=Ve+(Re^He&(tt^Re))+Je[7]+4249261313&4294967295,Ve=He+(ve<<22&4294967295|ve>>>10),ve=Re+(tt^Ve&(He^tt))+Je[8]+1770035416&4294967295,Re=Ve+(ve<<7&4294967295|ve>>>25),ve=tt+(He^Re&(Ve^He))+Je[9]+2336552879&4294967295,tt=Re+(ve<<12&4294967295|ve>>>20),ve=He+(Ve^tt&(Re^Ve))+Je[10]+4294925233&4294967295,He=tt+(ve<<17&4294967295|ve>>>15),ve=Ve+(Re^He&(tt^Re))+Je[11]+2304563134&4294967295,Ve=He+(ve<<22&4294967295|ve>>>10),ve=Re+(tt^Ve&(He^tt))+Je[12]+1804603682&4294967295,Re=Ve+(ve<<7&4294967295|ve>>>25),ve=tt+(He^Re&(Ve^He))+Je[13]+4254626195&4294967295,tt=Re+(ve<<12&4294967295|ve>>>20),ve=He+(Ve^tt&(Re^Ve))+Je[14]+2792965006&4294967295,He=tt+(ve<<17&4294967295|ve>>>15),ve=Ve+(Re^He&(tt^Re))+Je[15]+1236535329&4294967295,Ve=He+(ve<<22&4294967295|ve>>>10),ve=Re+(He^tt&(Ve^He))+Je[1]+4129170786&4294967295,Re=Ve+(ve<<5&4294967295|ve>>>27),ve=tt+(Ve^He&(Re^Ve))+Je[6]+3225465664&4294967295,tt=Re+(ve<<9&4294967295|ve>>>23),ve=He+(Re^Ve&(tt^Re))+Je[11]+643717713&4294967295,He=tt+(ve<<14&4294967295|ve>>>18),ve=Ve+(tt^Re&(He^tt))+Je[0]+3921069994&4294967295,Ve=He+(ve<<20&4294967295|ve>>>12),ve=Re+(He^tt&(Ve^He))+Je[5]+3593408605&4294967295,Re=Ve+(ve<<5&4294967295|ve>>>27),ve=tt+(Ve^He&(Re^Ve))+Je[10]+38016083&4294967295,tt=Re+(ve<<9&4294967295|ve>>>23),ve=He+(Re^Ve&(tt^Re))+Je[15]+3634488961&4294967295,He=tt+(ve<<14&4294967295|ve>>>18),ve=Ve+(tt^Re&(He^tt))+Je[4]+3889429448&4294967295,Ve=He+(ve<<20&4294967295|ve>>>12),ve=Re+(He^tt&(Ve^He))+Je[9]+568446438&4294967295,Re=Ve+(ve<<5&4294967295|ve>>>27),ve=tt+(Ve^He&(Re^Ve))+Je[14]+3275163606&4294967295,tt=Re+(ve<<9&4294967295|ve>>>23),ve=He+(Re^Ve&(tt^Re))+Je[3]+4107603335&4294967295,He=tt+(ve<<14&4294967295|ve>>>18),ve=Ve+(tt^Re&(He^tt))+Je[8]+1163531501&4294967295,Ve=He+(ve<<20&4294967295|ve>>>12),ve=Re+(He^tt&(Ve^He))+Je[13]+2850285829&4294967295,Re=Ve+(ve<<5&4294967295|ve>>>27),ve=tt+(Ve^He&(Re^Ve))+Je[2]+4243563512&4294967295,tt=Re+(ve<<9&4294967295|ve>>>23),ve=He+(Re^Ve&(tt^Re))+Je[7]+1735328473&4294967295,He=tt+(ve<<14&4294967295|ve>>>18),ve=Ve+(tt^Re&(He^tt))+Je[12]+2368359562&4294967295,Ve=He+(ve<<20&4294967295|ve>>>12),ve=Re+(Ve^He^tt)+Je[5]+4294588738&4294967295,Re=Ve+(ve<<4&4294967295|ve>>>28),ve=tt+(Re^Ve^He)+Je[8]+2272392833&4294967295,tt=Re+(ve<<11&4294967295|ve>>>21),ve=He+(tt^Re^Ve)+Je[11]+1839030562&4294967295,He=tt+(ve<<16&4294967295|ve>>>16),ve=Ve+(He^tt^Re)+Je[14]+4259657740&4294967295,Ve=He+(ve<<23&4294967295|ve>>>9),ve=Re+(Ve^He^tt)+Je[1]+2763975236&4294967295,Re=Ve+(ve<<4&4294967295|ve>>>28),ve=tt+(Re^Ve^He)+Je[4]+1272893353&4294967295,tt=Re+(ve<<11&4294967295|ve>>>21),ve=He+(tt^Re^Ve)+Je[7]+4139469664&4294967295,He=tt+(ve<<16&4294967295|ve>>>16),ve=Ve+(He^tt^Re)+Je[10]+3200236656&4294967295,Ve=He+(ve<<23&4294967295|ve>>>9),ve=Re+(Ve^He^tt)+Je[13]+681279174&4294967295,Re=Ve+(ve<<4&4294967295|ve>>>28),ve=tt+(Re^Ve^He)+Je[0]+3936430074&4294967295,tt=Re+(ve<<11&4294967295|ve>>>21),ve=He+(tt^Re^Ve)+Je[3]+3572445317&4294967295,He=tt+(ve<<16&4294967295|ve>>>16),ve=Ve+(He^tt^Re)+Je[6]+76029189&4294967295,Ve=He+(ve<<23&4294967295|ve>>>9),ve=Re+(Ve^He^tt)+Je[9]+3654602809&4294967295,Re=Ve+(ve<<4&4294967295|ve>>>28),ve=tt+(Re^Ve^He)+Je[12]+3873151461&4294967295,tt=Re+(ve<<11&4294967295|ve>>>21),ve=He+(tt^Re^Ve)+Je[15]+530742520&4294967295,He=tt+(ve<<16&4294967295|ve>>>16),ve=Ve+(He^tt^Re)+Je[2]+3299628645&4294967295,Ve=He+(ve<<23&4294967295|ve>>>9),ve=Re+(He^(Ve|~tt))+Je[0]+4096336452&4294967295,Re=Ve+(ve<<6&4294967295|ve>>>26),ve=tt+(Ve^(Re|~He))+Je[7]+1126891415&4294967295,tt=Re+(ve<<10&4294967295|ve>>>22),ve=He+(Re^(tt|~Ve))+Je[14]+2878612391&4294967295,He=tt+(ve<<15&4294967295|ve>>>17),ve=Ve+(tt^(He|~Re))+Je[5]+4237533241&4294967295,Ve=He+(ve<<21&4294967295|ve>>>11),ve=Re+(He^(Ve|~tt))+Je[12]+1700485571&4294967295,Re=Ve+(ve<<6&4294967295|ve>>>26),ve=tt+(Ve^(Re|~He))+Je[3]+2399980690&4294967295,tt=Re+(ve<<10&4294967295|ve>>>22),ve=He+(Re^(tt|~Ve))+Je[10]+4293915773&4294967295,He=tt+(ve<<15&4294967295|ve>>>17),ve=Ve+(tt^(He|~Re))+Je[1]+2240044497&4294967295,Ve=He+(ve<<21&4294967295|ve>>>11),ve=Re+(He^(Ve|~tt))+Je[8]+1873313359&4294967295,Re=Ve+(ve<<6&4294967295|ve>>>26),ve=tt+(Ve^(Re|~He))+Je[15]+4264355552&4294967295,tt=Re+(ve<<10&4294967295|ve>>>22),ve=He+(Re^(tt|~Ve))+Je[6]+2734768916&4294967295,He=tt+(ve<<15&4294967295|ve>>>17),ve=Ve+(tt^(He|~Re))+Je[13]+1309151649&4294967295,Ve=He+(ve<<21&4294967295|ve>>>11),ve=Re+(He^(Ve|~tt))+Je[4]+4149444226&4294967295,Re=Ve+(ve<<6&4294967295|ve>>>26),ve=tt+(Ve^(Re|~He))+Je[11]+3174756917&4294967295,tt=Re+(ve<<10&4294967295|ve>>>22),ve=He+(Re^(tt|~Ve))+Je[2]+718787259&4294967295,He=tt+(ve<<15&4294967295|ve>>>17),ve=Ve+(tt^(He|~Re))+Je[9]+3951481745&4294967295,Oe.g[0]=Oe.g[0]+Re&4294967295,Oe.g[1]=Oe.g[1]+(He+(ve<<21&4294967295|ve>>>11))&4294967295,Oe.g[2]=Oe.g[2]+He&4294967295,Oe.g[3]=Oe.g[3]+tt&4294967295}u.prototype.v=function(Oe,Re){Re===void 0&&(Re=Oe.length);const Ve=Re-this.blockSize,Je=this.C;let He=this.h,tt=0;for(;tt<Re;){if(He==0)for(;tt<=Ve;)y(this,Oe,tt),tt+=this.blockSize;if(typeof Oe=="string"){for(;tt<Re;)if(Je[He++]=Oe.charCodeAt(tt++),He==this.blockSize){y(this,Je),He=0;break}}else for(;tt<Re;)if(Je[He++]=Oe[tt++],He==this.blockSize){y(this,Je),He=0;break}}this.h=He,this.o+=Re},u.prototype.A=function(){var Oe=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);Oe[0]=128;for(var Re=1;Re<Oe.length-8;++Re)Oe[Re]=0;Re=this.o*8;for(var Ve=Oe.length-8;Ve<Oe.length;++Ve)Oe[Ve]=Re&255,Re/=256;for(this.v(Oe),Oe=Array(16),Re=0,Ve=0;Ve<4;++Ve)for(let Je=0;Je<32;Je+=8)Oe[Re++]=this.g[Ve]>>>Je&255;return Oe};function T(Oe,Re){var Ve=s;return Object.prototype.hasOwnProperty.call(Ve,Oe)?Ve[Oe]:Ve[Oe]=Re(Oe)}function C(Oe,Re){this.h=Re;const Ve=[];let Je=!0;for(let He=Oe.length-1;He>=0;He--){const tt=Oe[He]|0;Je&&tt==Re||(Ve[He]=tt,Je=!1)}this.g=Ve}var s={};function V(Oe){return-128<=Oe&&Oe<128?T(Oe,function(Re){return new C([Re|0],Re<0?-1:0)}):new C([Oe|0],Oe<0?-1:0)}function B(Oe){if(isNaN(Oe)||!isFinite(Oe))return Y;if(Oe<0)return Ke(B(-Oe));const Re=[];let Ve=1;for(let Je=0;Oe>=Ve;Je++)Re[Je]=Oe/Ve|0,Ve*=4294967296;return new C(Re,0)}function W(Oe,Re){if(Oe.length==0)throw Error("number format error: empty string");if(Re=Re||10,Re<2||36<Re)throw Error("radix out of range: "+Re);if(Oe.charAt(0)=="-")return Ke(W(Oe.substring(1),Re));if(Oe.indexOf("-")>=0)throw Error('number format error: interior "-" character');const Ve=B(Math.pow(Re,8));let Je=Y;for(let tt=0;tt<Oe.length;tt+=8){var He=Math.min(8,Oe.length-tt);const ve=parseInt(Oe.substring(tt,tt+He),Re);He<8?(He=B(Math.pow(Re,He)),Je=Je.j(He).add(B(ve))):(Je=Je.j(Ve),Je=Je.add(B(ve)))}return Je}var Y=V(0),ae=V(1),he=V(16777216);o=C.prototype,o.m=function(){if(Ye(this))return-Ke(this).m();let Oe=0,Re=1;for(let Ve=0;Ve<this.g.length;Ve++){const Je=this.i(Ve);Oe+=(Je>=0?Je:4294967296+Je)*Re,Re*=4294967296}return Oe},o.toString=function(Oe){if(Oe=Oe||10,Oe<2||36<Oe)throw Error("radix out of range: "+Oe);if(Qe(this))return"0";if(Ye(this))return"-"+Ke(this).toString(Oe);const Re=B(Math.pow(Oe,6));var Ve=this;let Je="";for(;;){const He=Mt(Ve,Re).g;Ve=at(Ve,He.j(Re));let tt=((Ve.g.length>0?Ve.g[0]:Ve.h)>>>0).toString(Oe);if(Ve=He,Qe(Ve))return tt+Je;for(;tt.length<6;)tt="0"+tt;Je=tt+Je}},o.i=function(Oe){return Oe<0?0:Oe<this.g.length?this.g[Oe]:this.h};function Qe(Oe){if(Oe.h!=0)return!1;for(let Re=0;Re<Oe.g.length;Re++)if(Oe.g[Re]!=0)return!1;return!0}function Ye(Oe){return Oe.h==-1}o.l=function(Oe){return Oe=at(this,Oe),Ye(Oe)?-1:Qe(Oe)?0:1};function Ke(Oe){const Re=Oe.g.length,Ve=[];for(let Je=0;Je<Re;Je++)Ve[Je]=~Oe.g[Je];return new C(Ve,~Oe.h).add(ae)}o.abs=function(){return Ye(this)?Ke(this):this},o.add=function(Oe){const Re=Math.max(this.g.length,Oe.g.length),Ve=[];let Je=0;for(let He=0;He<=Re;He++){let tt=Je+(this.i(He)&65535)+(Oe.i(He)&65535),ve=(tt>>>16)+(this.i(He)>>>16)+(Oe.i(He)>>>16);Je=ve>>>16,tt&=65535,ve&=65535,Ve[He]=ve<<16|tt}return new C(Ve,Ve[Ve.length-1]&-2147483648?-1:0)};function at(Oe,Re){return Oe.add(Ke(Re))}o.j=function(Oe){if(Qe(this)||Qe(Oe))return Y;if(Ye(this))return Ye(Oe)?Ke(this).j(Ke(Oe)):Ke(Ke(this).j(Oe));if(Ye(Oe))return Ke(this.j(Ke(Oe)));if(this.l(he)<0&&Oe.l(he)<0)return B(this.m()*Oe.m());const Re=this.g.length+Oe.g.length,Ve=[];for(var Je=0;Je<2*Re;Je++)Ve[Je]=0;for(Je=0;Je<this.g.length;Je++)for(let He=0;He<Oe.g.length;He++){const tt=this.i(Je)>>>16,ve=this.i(Je)&65535,Ht=Oe.i(He)>>>16,dn=Oe.i(He)&65535;Ve[2*Je+2*He]+=ve*dn,nt(Ve,2*Je+2*He),Ve[2*Je+2*He+1]+=tt*dn,nt(Ve,2*Je+2*He+1),Ve[2*Je+2*He+1]+=ve*Ht,nt(Ve,2*Je+2*He+1),Ve[2*Je+2*He+2]+=tt*Ht,nt(Ve,2*Je+2*He+2)}for(Oe=0;Oe<Re;Oe++)Ve[Oe]=Ve[2*Oe+1]<<16|Ve[2*Oe];for(Oe=Re;Oe<2*Re;Oe++)Ve[Oe]=0;return new C(Ve,0)};function nt(Oe,Re){for(;(Oe[Re]&65535)!=Oe[Re];)Oe[Re+1]+=Oe[Re]>>>16,Oe[Re]&=65535,Re++}function Ge(Oe,Re){this.g=Oe,this.h=Re}function Mt(Oe,Re){if(Qe(Re))throw Error("division by zero");if(Qe(Oe))return new Ge(Y,Y);if(Ye(Oe))return Re=Mt(Ke(Oe),Re),new Ge(Ke(Re.g),Ke(Re.h));if(Ye(Re))return Re=Mt(Oe,Ke(Re)),new Ge(Ke(Re.g),Re.h);if(Oe.g.length>30){if(Ye(Oe)||Ye(Re))throw Error("slowDivide_ only works with positive integers.");for(var Ve=ae,Je=Re;Je.l(Oe)<=0;)Ve=cn(Ve),Je=cn(Je);var He=St(Ve,1),tt=St(Je,1);for(Je=St(Je,2),Ve=St(Ve,2);!Qe(Je);){var ve=tt.add(Je);ve.l(Oe)<=0&&(He=He.add(Ve),tt=ve),Je=St(Je,1),Ve=St(Ve,1)}return Re=at(Oe,He.j(Re)),new Ge(He,Re)}for(He=Y;Oe.l(Re)>=0;){for(Ve=Math.max(1,Math.floor(Oe.m()/Re.m())),Je=Math.ceil(Math.log(Ve)/Math.LN2),Je=Je<=48?1:Math.pow(2,Je-48),tt=B(Ve),ve=tt.j(Re);Ye(ve)||ve.l(Oe)>0;)Ve-=Je,tt=B(Ve),ve=tt.j(Re);Qe(tt)&&(tt=ae),He=He.add(tt),Oe=at(Oe,ve)}return new Ge(He,Oe)}o.B=function(Oe){return Mt(this,Oe).h},o.and=function(Oe){const Re=Math.max(this.g.length,Oe.g.length),Ve=[];for(let Je=0;Je<Re;Je++)Ve[Je]=this.i(Je)&Oe.i(Je);return new C(Ve,this.h&Oe.h)},o.or=function(Oe){const Re=Math.max(this.g.length,Oe.g.length),Ve=[];for(let Je=0;Je<Re;Je++)Ve[Je]=this.i(Je)|Oe.i(Je);return new C(Ve,this.h|Oe.h)},o.xor=function(Oe){const Re=Math.max(this.g.length,Oe.g.length),Ve=[];for(let Je=0;Je<Re;Je++)Ve[Je]=this.i(Je)^Oe.i(Je);return new C(Ve,this.h^Oe.h)};function cn(Oe){const Re=Oe.g.length+1,Ve=[];for(let Je=0;Je<Re;Je++)Ve[Je]=Oe.i(Je)<<1|Oe.i(Je-1)>>>31;return new C(Ve,Oe.h)}function St(Oe,Re){const Ve=Re>>5;Re%=32;const Je=Oe.g.length-Ve,He=[];for(let tt=0;tt<Je;tt++)He[tt]=Re>0?Oe.i(tt+Ve)>>>Re|Oe.i(tt+Ve+1)<<32-Re:Oe.i(tt+Ve);return new C(He,Oe.h)}u.prototype.digest=u.prototype.A,u.prototype.reset=u.prototype.u,u.prototype.update=u.prototype.v,wP=u,C.prototype.add=C.prototype.add,C.prototype.multiply=C.prototype.j,C.prototype.modulo=C.prototype.B,C.prototype.compare=C.prototype.l,C.prototype.toNumber=C.prototype.m,C.prototype.toString=C.prototype.toString,C.prototype.getBits=C.prototype.i,C.fromNumber=B,C.fromString=W,Om=C}).apply(typeof oR<"u"?oR:typeof self<"u"?self:typeof window<"u"?window:{});var bb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var TP,mv,EP,Nb,oE,SP,AP,IP;(function(){var o,t=Object.defineProperty;function a(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof bb=="object"&&bb];for(var ie=0;ie<L.length;++ie){var de=L[ie];if(de&&de.Math==Math)return de}throw Error("Cannot find global object")}var u=a(this);function y(L,ie){if(ie)e:{var de=u;L=L.split(".");for(var Ce=0;Ce<L.length-1;Ce++){var Ot=L[Ce];if(!(Ot in de))break e;de=de[Ot]}L=L[L.length-1],Ce=de[L],ie=ie(Ce),ie!=Ce&&ie!=null&&t(de,L,{configurable:!0,writable:!0,value:ie})}}y("Symbol.dispose",function(L){return L||Symbol("Symbol.dispose")}),y("Array.prototype.values",function(L){return L||function(){return this[Symbol.iterator]()}}),y("Object.entries",function(L){return L||function(ie){var de=[],Ce;for(Ce in ie)Object.prototype.hasOwnProperty.call(ie,Ce)&&de.push([Ce,ie[Ce]]);return de}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var T=T||{},C=this||self;function s(L){var ie=typeof L;return ie=="object"&&L!=null||ie=="function"}function V(L,ie,de){return L.call.apply(L.bind,arguments)}function B(L,ie,de){return B=V,B.apply(null,arguments)}function W(L,ie){var de=Array.prototype.slice.call(arguments,1);return function(){var Ce=de.slice();return Ce.push.apply(Ce,arguments),L.apply(this,Ce)}}function Y(L,ie){function de(){}de.prototype=ie.prototype,L.Z=ie.prototype,L.prototype=new de,L.prototype.constructor=L,L.Ob=function(Ce,Ot,Gt){for(var Sn=Array(arguments.length-2),li=2;li<arguments.length;li++)Sn[li-2]=arguments[li];return ie.prototype[Ot].apply(Ce,Sn)}}var ae=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?L=>L&&AsyncContext.Snapshot.wrap(L):L=>L;function he(L){const ie=L.length;if(ie>0){const de=Array(ie);for(let Ce=0;Ce<ie;Ce++)de[Ce]=L[Ce];return de}return[]}function Qe(L,ie){for(let Ce=1;Ce<arguments.length;Ce++){const Ot=arguments[Ce];var de=typeof Ot;if(de=de!="object"?de:Ot?Array.isArray(Ot)?"array":de:"null",de=="array"||de=="object"&&typeof Ot.length=="number"){de=L.length||0;const Gt=Ot.length||0;L.length=de+Gt;for(let Sn=0;Sn<Gt;Sn++)L[de+Sn]=Ot[Sn]}else L.push(Ot)}}class Ye{constructor(ie,de){this.i=ie,this.j=de,this.h=0,this.g=null}get(){let ie;return this.h>0?(this.h--,ie=this.g,this.g=ie.next,ie.next=null):ie=this.i(),ie}}function Ke(L){C.setTimeout(()=>{throw L},0)}function at(){var L=Oe;let ie=null;return L.g&&(ie=L.g,L.g=L.g.next,L.g||(L.h=null),ie.next=null),ie}class nt{constructor(){this.h=this.g=null}add(ie,de){const Ce=Ge.get();Ce.set(ie,de),this.h?this.h.next=Ce:this.g=Ce,this.h=Ce}}var Ge=new Ye(()=>new Mt,L=>L.reset());class Mt{constructor(){this.next=this.g=this.h=null}set(ie,de){this.h=ie,this.g=de,this.next=null}reset(){this.next=this.g=this.h=null}}let cn,St=!1,Oe=new nt,Re=()=>{const L=Promise.resolve(void 0);cn=()=>{L.then(Ve)}};function Ve(){for(var L;L=at();){try{L.h.call(L.g)}catch(de){Ke(de)}var ie=Ge;ie.j(L),ie.h<100&&(ie.h++,L.next=ie.g,ie.g=L)}St=!1}function Je(){this.u=this.u,this.C=this.C}Je.prototype.u=!1,Je.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Je.prototype[Symbol.dispose]=function(){this.dispose()},Je.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function He(L,ie){this.type=L,this.g=this.target=ie,this.defaultPrevented=!1}He.prototype.h=function(){this.defaultPrevented=!0};var tt=(function(){if(!C.addEventListener||!Object.defineProperty)return!1;var L=!1,ie=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const de=()=>{};C.addEventListener("test",de,ie),C.removeEventListener("test",de,ie)}catch{}return L})();function ve(L){return/^[\s\xa0]*$/.test(L)}function Ht(L,ie){He.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L&&this.init(L,ie)}Y(Ht,He),Ht.prototype.init=function(L,ie){const de=this.type=L.type,Ce=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;this.target=L.target||L.srcElement,this.g=ie,ie=L.relatedTarget,ie||(de=="mouseover"?ie=L.fromElement:de=="mouseout"&&(ie=L.toElement)),this.relatedTarget=ie,Ce?(this.clientX=Ce.clientX!==void 0?Ce.clientX:Ce.pageX,this.clientY=Ce.clientY!==void 0?Ce.clientY:Ce.pageY,this.screenX=Ce.screenX||0,this.screenY=Ce.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=L.pointerType,this.state=L.state,this.i=L,L.defaultPrevented&&Ht.Z.h.call(this)},Ht.prototype.h=function(){Ht.Z.h.call(this);const L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var dn="closure_listenable_"+(Math.random()*1e6|0),wt=0;function Kt(L,ie,de,Ce,Ot){this.listener=L,this.proxy=null,this.src=ie,this.type=de,this.capture=!!Ce,this.ha=Ot,this.key=++wt,this.da=this.fa=!1}function wn(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function Kn(L,ie,de){for(const Ce in L)ie.call(de,L[Ce],Ce,L)}function it(L,ie){for(const de in L)ie.call(void 0,L[de],de,L)}function ft(L){const ie={};for(const de in L)ie[de]=L[de];return ie}const Qt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Be(L,ie){let de,Ce;for(let Ot=1;Ot<arguments.length;Ot++){Ce=arguments[Ot];for(de in Ce)L[de]=Ce[de];for(let Gt=0;Gt<Qt.length;Gt++)de=Qt[Gt],Object.prototype.hasOwnProperty.call(Ce,de)&&(L[de]=Ce[de])}}function En(L){this.src=L,this.g={},this.h=0}En.prototype.add=function(L,ie,de,Ce,Ot){const Gt=L.toString();L=this.g[Gt],L||(L=this.g[Gt]=[],this.h++);const Sn=$n(L,ie,Ce,Ot);return Sn>-1?(ie=L[Sn],de||(ie.fa=!1)):(ie=new Kt(ie,this.src,Gt,!!Ce,Ot),ie.fa=de,L.push(ie)),ie};function Qn(L,ie){const de=ie.type;if(de in L.g){var Ce=L.g[de],Ot=Array.prototype.indexOf.call(Ce,ie,void 0),Gt;(Gt=Ot>=0)&&Array.prototype.splice.call(Ce,Ot,1),Gt&&(wn(ie),L.g[de].length==0&&(delete L.g[de],L.h--))}}function $n(L,ie,de,Ce){for(let Ot=0;Ot<L.length;++Ot){const Gt=L[Ot];if(!Gt.da&&Gt.listener==ie&&Gt.capture==!!de&&Gt.ha==Ce)return Ot}return-1}var ki="closure_lm_"+(Math.random()*1e6|0),er={};function qn(L,ie,de,Ce,Ot){if(Array.isArray(ie)){for(let Gt=0;Gt<ie.length;Gt++)qn(L,ie[Gt],de,Ce,Ot);return null}return de=tr(de),L&&L[dn]?L.J(ie,de,s(Ce)?!!Ce.capture:!1,Ot):Ni(L,ie,de,!1,Ce,Ot)}function Ni(L,ie,de,Ce,Ot,Gt){if(!ie)throw Error("Invalid event type");const Sn=s(Ot)?!!Ot.capture:!!Ot;let li=Hi(L);if(li||(L[ki]=li=new En(L)),de=li.add(ie,de,Ce,Sn,Gt),de.proxy)return de;if(Ce=Vr(),de.proxy=Ce,Ce.src=L,Ce.listener=de,L.addEventListener)tt||(Ot=Sn),Ot===void 0&&(Ot=!1),L.addEventListener(ie.toString(),Ce,Ot);else if(L.attachEvent)L.attachEvent(vi(ie.toString()),Ce);else if(L.addListener&&L.removeListener)L.addListener(Ce);else throw Error("addEventListener and attachEvent are unavailable.");return de}function Vr(){function L(de){return ie.call(L.src,L.listener,de)}const ie=_r;return L}function Fa(L,ie,de,Ce,Ot){if(Array.isArray(ie))for(var Gt=0;Gt<ie.length;Gt++)Fa(L,ie[Gt],de,Ce,Ot);else Ce=s(Ce)?!!Ce.capture:!!Ce,de=tr(de),L&&L[dn]?(L=L.i,Gt=String(ie).toString(),Gt in L.g&&(ie=L.g[Gt],de=$n(ie,de,Ce,Ot),de>-1&&(wn(ie[de]),Array.prototype.splice.call(ie,de,1),ie.length==0&&(delete L.g[Gt],L.h--)))):L&&(L=Hi(L))&&(ie=L.g[ie.toString()],L=-1,ie&&(L=$n(ie,de,Ce,Ot)),(de=L>-1?ie[L]:null)&&Cn(de))}function Cn(L){if(typeof L!="number"&&L&&!L.da){var ie=L.src;if(ie&&ie[dn])Qn(ie.i,L);else{var de=L.type,Ce=L.proxy;ie.removeEventListener?ie.removeEventListener(de,Ce,L.capture):ie.detachEvent?ie.detachEvent(vi(de),Ce):ie.addListener&&ie.removeListener&&ie.removeListener(Ce),(de=Hi(ie))?(Qn(de,L),de.h==0&&(de.src=null,ie[ki]=null)):wn(L)}}}function vi(L){return L in er?er[L]:er[L]="on"+L}function _r(L,ie){if(L.da)L=!0;else{ie=new Ht(ie,this);const de=L.listener,Ce=L.ha||L.src;L.fa&&Cn(L),L=de.call(Ce,ie)}return L}function Hi(L){return L=L[ki],L instanceof En?L:null}var Wr="__closure_events_fn_"+(Math.random()*1e9>>>0);function tr(L){return typeof L=="function"?L:(L[Wr]||(L[Wr]=function(ie){return L.handleEvent(ie)}),L[Wr])}function yr(){Je.call(this),this.i=new En(this),this.M=this,this.G=null}Y(yr,Je),yr.prototype[dn]=!0,yr.prototype.removeEventListener=function(L,ie,de,Ce){Fa(this,L,ie,de,Ce)};function Xr(L,ie){var de,Ce=L.G;if(Ce)for(de=[];Ce;Ce=Ce.G)de.push(Ce);if(L=L.M,Ce=ie.type||ie,typeof ie=="string")ie=new He(ie,L);else if(ie instanceof He)ie.target=ie.target||L;else{var Ot=ie;ie=new He(Ce,L),Be(ie,Ot)}Ot=!0;let Gt,Sn;if(de)for(Sn=de.length-1;Sn>=0;Sn--)Gt=ie.g=de[Sn],Ot=to(Gt,Ce,!0,ie)&&Ot;if(Gt=ie.g=L,Ot=to(Gt,Ce,!0,ie)&&Ot,Ot=to(Gt,Ce,!1,ie)&&Ot,de)for(Sn=0;Sn<de.length;Sn++)Gt=ie.g=de[Sn],Ot=to(Gt,Ce,!1,ie)&&Ot}yr.prototype.N=function(){if(yr.Z.N.call(this),this.i){var L=this.i;for(const ie in L.g){const de=L.g[ie];for(let Ce=0;Ce<de.length;Ce++)wn(de[Ce]);delete L.g[ie],L.h--}}this.G=null},yr.prototype.J=function(L,ie,de,Ce){return this.i.add(String(L),ie,!1,de,Ce)},yr.prototype.K=function(L,ie,de,Ce){return this.i.add(String(L),ie,!0,de,Ce)};function to(L,ie,de,Ce){if(ie=L.i.g[String(ie)],!ie)return!0;ie=ie.concat();let Ot=!0;for(let Gt=0;Gt<ie.length;++Gt){const Sn=ie[Gt];if(Sn&&!Sn.da&&Sn.capture==de){const li=Sn.listener,Ci=Sn.ha||Sn.src;Sn.fa&&Qn(L.i,Sn),Ot=li.call(Ci,Ce)!==!1&&Ot}}return Ot&&!Ce.defaultPrevented}function Rl(L,ie){if(typeof L!="function")if(L&&typeof L.handleEvent=="function")L=B(L.handleEvent,L);else throw Error("Invalid listener argument");return Number(ie)>2147483647?-1:C.setTimeout(L,ie||0)}function rc(L){L.g=Rl(()=>{L.g=null,L.i&&(L.i=!1,rc(L))},L.l);const ie=L.h;L.h=null,L.m.apply(null,ie)}class jr extends Je{constructor(ie,de){super(),this.m=ie,this.l=de,this.h=null,this.i=!1,this.g=null}j(ie){this.h=arguments,this.g?this.i=!0:rc(this)}N(){super.N(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bs(L){Je.call(this),this.h=L,this.g={}}Y(bs,Je);var en=[];function Tn(L){Kn(L.g,function(ie,de){this.g.hasOwnProperty(de)&&Cn(ie)},L),L.g={}}bs.prototype.N=function(){bs.Z.N.call(this),Tn(this)},bs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var si=C.JSON.stringify,Li=C.JSON.parse,Ii=class{stringify(L){return C.JSON.stringify(L,void 0)}parse(L){return C.JSON.parse(L,void 0)}};function Fs(){}function _s(){}var ms={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Pr(){He.call(this,"d")}Y(Pr,He);function mr(){He.call(this,"c")}Y(mr,He);var Fi={},ia=null;function ws(){return ia=ia||new yr}Fi.Ia="serverreachability";function cl(L){He.call(this,Fi.Ia,L)}Y(cl,He);function Ia(L){const ie=ws();Xr(ie,new cl(ie))}Fi.STAT_EVENT="statevent";function bo(L,ie){He.call(this,Fi.STAT_EVENT,L),this.stat=ie}Y(bo,He);function gs(L){const ie=ws();Xr(ie,new bo(ie,L))}Fi.Ja="timingevent";function Vi(L,ie){He.call(this,Fi.Ja,L),this.size=ie}Y(Vi,He);function Kr(L,ie){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){L()},ie)}function wo(){this.g=!0}wo.prototype.ua=function(){this.g=!1};function _u(L,ie,de,Ce,Ot,Gt){L.info(function(){if(L.g)if(Gt){var Sn="",li=Gt.split("&");for(let kr=0;kr<li.length;kr++){var Ci=li[kr].split("=");if(Ci.length>1){const Qr=Ci[0];Ci=Ci[1];const Do=Qr.split("_");Sn=Do.length>=2&&Do[1]=="type"?Sn+(Qr+"="+Ci+"&"):Sn+(Qr+"=redacted&")}}}else Sn=null;else Sn=Gt;return"XMLHTTP REQ ("+Ce+") [attempt "+Ot+"]: "+ie+`
`+de+`
`+Sn})}function Va(L,ie,de,Ce,Ot,Gt,Sn){L.info(function(){return"XMLHTTP RESP ("+Ce+") [ attempt "+Ot+"]: "+ie+`
`+de+`
`+Gt+" "+Sn})}function ul(L,ie,de,Ce){L.info(function(){return"XMLHTTP TEXT ("+ie+"): "+Dt(L,de)+(Ce?" "+Ce:"")})}function hl(L,ie){L.info(function(){return"TIMEOUT: "+ie})}wo.prototype.info=function(){};function Dt(L,ie){if(!L.g)return ie;if(!ie)return null;try{const Gt=JSON.parse(ie);if(Gt){for(L=0;L<Gt.length;L++)if(Array.isArray(Gt[L])){var de=Gt[L];if(!(de.length<2)){var Ce=de[1];if(Array.isArray(Ce)&&!(Ce.length<1)){var Ot=Ce[0];if(Ot!="noop"&&Ot!="stop"&&Ot!="close")for(let Sn=1;Sn<Ce.length;Sn++)Ce[Sn]=""}}}}return si(Gt)}catch{return ie}}var no={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},th={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Lc;function oi(){}Y(oi,Fs),oi.prototype.g=function(){return new XMLHttpRequest},Lc=new oi;function qe(L){return encodeURIComponent(String(L))}function ne(L){var ie=1;L=L.split(":");const de=[];for(;ie>0&&L.length;)de.push(L.shift()),ie--;return L.length&&de.push(L.join(":")),de}function oe(L,ie,de,Ce){this.j=L,this.i=ie,this.l=de,this.S=Ce||1,this.V=new bs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ye}function ye(){this.i=null,this.g="",this.h=!1}var Pe={},xe={};function Fe(L,ie,de){L.M=1,L.A=Ts(Ti(ie)),L.u=de,L.R=!0,st(L,null)}function st(L,ie){L.F=Date.now(),It(L),L.B=Ti(L.A);var de=L.B,Ce=L.S;Array.isArray(Ce)||(Ce=[String(Ce)]),yu(de.i,"t",Ce),L.C=0,de=L.j.L,L.h=new ye,L.g=sd(L.j,de?ie:null,!L.u),L.P>0&&(L.O=new jr(B(L.Y,L,L.g),L.P)),ie=L.V,de=L.g,Ce=L.ba;var Ot="readystatechange";Array.isArray(Ot)||(Ot&&(en[0]=Ot.toString()),Ot=en);for(let Gt=0;Gt<Ot.length;Gt++){const Sn=qn(de,Ot[Gt],Ce||ie.handleEvent,!1,ie.h||ie);if(!Sn)break;ie.g[Sn.key]=Sn}ie=L.J?ft(L.J):{},L.u?(L.v||(L.v="POST"),ie["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.B,L.v,L.u,ie)):(L.v="GET",L.g.ea(L.B,L.v,null,ie)),Ia(),_u(L.i,L.v,L.B,L.l,L.S,L.u)}oe.prototype.ba=function(L){L=L.target;const ie=this.O;ie&&Co(L)==3?ie.j():this.Y(L)},oe.prototype.Y=function(L){try{if(L==this.g)e:{const li=Co(this.g),Ci=this.g.ya(),kr=this.g.ca();if(!(li<3)&&(li!=3||this.g&&(this.h.h||this.g.la()||_a(this.g)))){this.K||li!=4||Ci==7||(Ci==8||kr<=0?Ia(3):Ia(2)),yn(this);var ie=this.g.ca();this.X=ie;var de=$e(this);if(this.o=ie==200,Va(this.i,this.v,this.B,this.l,this.S,li,ie),this.o){if(this.U&&!this.L){t:{if(this.g){var Ce,Ot=this.g;if((Ce=Ot.g?Ot.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ve(Ce)){var Gt=Ce;break t}}Gt=null}if(L=Gt)ul(this.i,this.l,L,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vn(this,L);else{this.o=!1,this.m=3,gs(12),Ln(this),bn(this);break e}}if(this.R){L=!0;let Qr;for(;!this.K&&this.C<de.length;)if(Qr=Pt(this,de),Qr==xe){li==4&&(this.m=4,gs(14),L=!1),ul(this.i,this.l,null,"[Incomplete Response]");break}else if(Qr==Pe){this.m=4,gs(15),ul(this.i,this.l,de,"[Invalid Chunk]"),L=!1;break}else ul(this.i,this.l,Qr,null),Vn(this,Qr);if(lt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),li!=4||de.length!=0||this.h.h||(this.m=1,gs(16),L=!1),this.o=this.o&&L,!L)ul(this.i,this.l,de,"[Invalid Chunked Response]"),Ln(this),bn(this);else if(de.length>0&&!this.W){this.W=!0;var Sn=this.j;Sn.g==this&&Sn.aa&&!Sn.P&&(Sn.j.info("Great, no buffering proxy detected. Bytes received: "+de.length),Ga(Sn),Sn.P=!0,gs(11))}}else ul(this.i,this.l,de,null),Vn(this,de);li==4&&Ln(this),this.o&&!this.K&&(li==4?Ei(this.j,this):(this.o=!1,It(this)))}else sc(this.g),ie==400&&de.indexOf("Unknown SID")>0?(this.m=3,gs(12)):(this.m=0,gs(13)),Ln(this),bn(this)}}}catch{}finally{}};function $e(L){if(!lt(L))return L.g.la();const ie=_a(L.g);if(ie==="")return"";let de="";const Ce=ie.length,Ot=Co(L.g)==4;if(!L.h.i){if(typeof TextDecoder>"u")return Ln(L),bn(L),"";L.h.i=new C.TextDecoder}for(let Gt=0;Gt<Ce;Gt++)L.h.h=!0,de+=L.h.i.decode(ie[Gt],{stream:!(Ot&&Gt==Ce-1)});return ie.length=0,L.h.g+=de,L.C=0,L.h.g}function lt(L){return L.g?L.v=="GET"&&L.M!=2&&L.j.Aa:!1}function Pt(L,ie){var de=L.C,Ce=ie.indexOf(`
`,de);return Ce==-1?xe:(de=Number(ie.substring(de,Ce)),isNaN(de)?Pe:(Ce+=1,Ce+de>ie.length?xe:(ie=ie.slice(Ce,Ce+de),L.C=Ce+de,ie)))}oe.prototype.cancel=function(){this.K=!0,Ln(this)};function It(L){L.T=Date.now()+L.H,tn(L,L.H)}function tn(L,ie){if(L.D!=null)throw Error("WatchDog timer not null");L.D=Kr(B(L.aa,L),ie)}function yn(L){L.D&&(C.clearTimeout(L.D),L.D=null)}oe.prototype.aa=function(){this.D=null;const L=Date.now();L-this.T>=0?(hl(this.i,this.B),this.M!=2&&(Ia(),gs(17)),Ln(this),this.m=2,bn(this)):tn(this,this.T-L)};function bn(L){L.j.I==0||L.K||Ei(L.j,L)}function Ln(L){yn(L);var ie=L.O;ie&&typeof ie.dispose=="function"&&ie.dispose(),L.O=null,Tn(L.V),L.g&&(ie=L.g,L.g=null,ie.abort(),ie.dispose())}function Vn(L,ie){try{var de=L.j;if(de.I!=0&&(de.g==L||nr(de.h,L))){if(!L.L&&nr(de.h,L)&&de.I==3){try{var Ce=de.Ba.g.parse(ie)}catch{Ce=null}if(Array.isArray(Ce)&&Ce.length==3){var Ot=Ce;if(Ot[0]==0){e:if(!de.v){if(de.g)if(de.g.F+3e3<L.F)ah(de),Dl(de);else break e;Vs(de),gs(18)}}else de.xa=Ot[1],0<de.xa-de.K&&Ot[2]<37500&&de.F&&de.A==0&&!de.C&&(de.C=Kr(B(de.Va,de),6e3));xr(de.h)<=1&&de.ta&&(de.ta=void 0)}else Pl(de,11)}else if((L.L||de.g==L)&&ah(de),!ve(ie))for(Ot=de.Ba.g.parse(ie),ie=0;ie<Ot.length;ie++){let kr=Ot[ie];const Qr=kr[0];if(!(Qr<=de.K))if(de.K=Qr,kr=kr[1],de.I==2)if(kr[0]=="c"){de.M=kr[1],de.ba=kr[2];const Do=kr[3];Do!=null&&(de.ka=Do,de.j.info("VER="+de.ka));const Po=kr[4];Po!=null&&(de.za=Po,de.j.info("SVER="+de.za));const ko=kr[5];ko!=null&&typeof ko=="number"&&ko>0&&(Ce=1.5*ko,de.O=Ce,de.j.info("backChannelRequestTimeoutMs_="+Ce)),Ce=de;const Wo=L.g;if(Wo){const lc=Wo.g?Wo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lc){var Gt=Ce.h;Gt.g||lc.indexOf("spdy")==-1&&lc.indexOf("quic")==-1&&lc.indexOf("h2")==-1||(Gt.j=Gt.l,Gt.g=new Set,Gt.h&&(vr(Gt,Gt.h),Gt.h=null))}if(Ce.G){const Ms=Wo.g?Wo.g.getResponseHeader("X-HTTP-Session-Id"):null;Ms&&(Ce.wa=Ms,hr(Ce.J,Ce.G,Ms))}}de.I=3,de.l&&de.l.ra(),de.aa&&(de.T=Date.now()-L.F,de.j.info("Handshake RTT: "+de.T+"ms")),Ce=de;var Sn=L;if(Ce.na=Rn(Ce,Ce.L?Ce.ba:null,Ce.W),Sn.L){ir(Ce.h,Sn);var li=Sn,Ci=Ce.O;Ci&&(li.H=Ci),li.D&&(yn(li),It(li)),Ce.g=Sn}else pl(Ce);de.i.length>0&&ro(de)}else kr[0]!="stop"&&kr[0]!="close"||Pl(de,7);else de.I==3&&(kr[0]=="stop"||kr[0]=="close"?kr[0]=="stop"?Pl(de,7):Bc(de):kr[0]!="noop"&&de.l&&de.l.qa(kr),de.A=0)}}Ia(4)}catch{}}var vn=class{constructor(L,ie){this.g=L,this.map=ie}};function kn(L){this.l=L||10,C.PerformanceNavigationTiming?(L=C.performance.getEntriesByType("navigation"),L=L.length>0&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(C.chrome&&C.chrome.loadTimes&&C.chrome.loadTimes()&&C.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $i(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function xr(L){return L.h?1:L.g?L.g.size:0}function nr(L,ie){return L.h?L.h==ie:L.g?L.g.has(ie):!1}function vr(L,ie){L.g?L.g.add(ie):L.h=ie}function ir(L,ie){L.h&&L.h==ie?L.h=null:L.g&&L.g.has(ie)&&L.g.delete(ie)}kn.prototype.cancel=function(){if(this.i=ui(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function ui(L){if(L.h!=null)return L.i.concat(L.h.G);if(L.g!=null&&L.g.size!==0){let ie=L.i;for(const de of L.g.values())ie=ie.concat(de.G);return ie}return he(L.i)}var cr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Oi(L,ie){if(L){L=L.split("&");for(let de=0;de<L.length;de++){const Ce=L[de].indexOf("=");let Ot,Gt=null;Ce>=0?(Ot=L[de].substring(0,Ce),Gt=L[de].substring(Ce+1)):Ot=L[de],ie(Ot,Gt?decodeURIComponent(Gt.replace(/\+/g," ")):"")}}}function gi(L){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let ie;L instanceof gi?(this.l=L.l,ur(this,L.j),this.o=L.o,this.g=L.g,es(this,L.u),this.h=L.h,ts(this,Ss(L.i)),this.m=L.m):L&&(ie=String(L).match(cr))?(this.l=!1,ur(this,ie[1]||"",!0),this.o=Es(ie[2]||""),this.g=Es(ie[3]||"",!0),es(this,ie[4]),this.h=Es(ie[5]||"",!0),ts(this,ie[6]||"",!0),this.m=Es(ie[7]||"")):(this.l=!1,this.i=new dl(null,this.l))}gi.prototype.toString=function(){const L=[];var ie=this.j;ie&&L.push(pa(ie,ra,!0),":");var de=this.g;return(de||ie=="file")&&(L.push("//"),(ie=this.o)&&L.push(pa(ie,ra,!0),"@"),L.push(qe(de).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),de=this.u,de!=null&&L.push(":",String(de))),(de=this.h)&&(this.g&&de.charAt(0)!="/"&&L.push("/"),L.push(pa(de,de.charAt(0)=="/"?$o:sa,!0))),(de=this.i.toString())&&L.push("?",de),(de=this.m)&&L.push("#",pa(de,ja)),L.join("")},gi.prototype.resolve=function(L){const ie=Ti(this);let de=!!L.j;de?ur(ie,L.j):de=!!L.o,de?ie.o=L.o:de=!!L.g,de?ie.g=L.g:de=L.u!=null;var Ce=L.h;if(de)es(ie,L.u);else if(de=!!L.h){if(Ce.charAt(0)!="/")if(this.g&&!this.h)Ce="/"+Ce;else{var Ot=ie.h.lastIndexOf("/");Ot!=-1&&(Ce=ie.h.slice(0,Ot+1)+Ce)}if(Ot=Ce,Ot==".."||Ot==".")Ce="";else if(Ot.indexOf("./")!=-1||Ot.indexOf("/.")!=-1){Ce=Ot.lastIndexOf("/",0)==0,Ot=Ot.split("/");const Gt=[];for(let Sn=0;Sn<Ot.length;){const li=Ot[Sn++];li=="."?Ce&&Sn==Ot.length&&Gt.push(""):li==".."?((Gt.length>1||Gt.length==1&&Gt[0]!="")&&Gt.pop(),Ce&&Sn==Ot.length&&Gt.push("")):(Gt.push(li),Ce=!0)}Ce=Gt.join("/")}else Ce=Ot}return de?ie.h=Ce:de=L.i.toString()!=="",de?ts(ie,Ss(L.i)):de=!!L.m,de&&(ie.m=L.m),ie};function Ti(L){return new gi(L)}function ur(L,ie,de){L.j=de?Es(ie,!0):ie,L.j&&(L.j=L.j.replace(/:$/,""))}function es(L,ie){if(ie){if(ie=Number(ie),isNaN(ie)||ie<0)throw Error("Bad port number "+ie);L.u=ie}else L.u=null}function ts(L,ie,de){ie instanceof dl?(L.i=ie,Eo(L.i,L.l)):(de||(ie=pa(ie,To)),L.i=new dl(ie,L.l))}function hr(L,ie,de){L.i.set(ie,de)}function Ts(L){return hr(L,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),L}function Es(L,ie){return L?ie?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function pa(L,ie,de){return typeof L=="string"?(L=encodeURI(L).replace(ie,ys),de&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function ys(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var ra=/[#\/\?@]/g,sa=/[#\?:]/g,$o=/[#\?]/g,To=/[#\?@]/g,ja=/#/g;function dl(L,ie){this.h=this.g=null,this.i=L||null,this.j=!!ie}function ma(L){L.g||(L.g=new Map,L.h=0,L.i&&Oi(L.i,function(ie,de){L.add(decodeURIComponent(ie.replace(/\+/g," ")),de)}))}o=dl.prototype,o.add=function(L,ie){ma(this),this.i=null,L=Xs(this,L);let de=this.g.get(L);return de||this.g.set(L,de=[]),de.push(ie),this.h+=1,this};function pf(L,ie){ma(L),ie=Xs(L,ie),L.g.has(ie)&&(L.i=null,L.h-=L.g.get(ie).length,L.g.delete(ie))}function nd(L,ie){return ma(L),ie=Xs(L,ie),L.g.has(ie)}o.forEach=function(L,ie){ma(this),this.g.forEach(function(de,Ce){de.forEach(function(Ot){L.call(ie,Ot,Ce,this)},this)},this)};function nh(L,ie){ma(L);let de=[];if(typeof ie=="string")nd(L,ie)&&(de=de.concat(L.g.get(Xs(L,ie))));else for(L=Array.from(L.g.values()),ie=0;ie<L.length;ie++)de=de.concat(L[ie]);return de}o.set=function(L,ie){return ma(this),this.i=null,L=Xs(this,L),nd(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[ie]),this.h+=1,this},o.get=function(L,ie){return L?(L=nh(this,L),L.length>0?String(L[0]):ie):ie};function yu(L,ie,de){pf(L,ie),de.length>0&&(L.i=null,L.g.set(Xs(L,ie),he(de)),L.h+=de.length)}o.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],ie=Array.from(this.g.keys());for(let Ce=0;Ce<ie.length;Ce++){var de=ie[Ce];const Ot=qe(de);de=nh(this,de);for(let Gt=0;Gt<de.length;Gt++){let Sn=Ot;de[Gt]!==""&&(Sn+="="+qe(de[Gt])),L.push(Sn)}}return this.i=L.join("&")};function Ss(L){const ie=new dl;return ie.i=L.i,L.g&&(ie.g=new Map(L.g),ie.h=L.h),ie}function Xs(L,ie){return ie=String(ie),L.j&&(ie=ie.toLowerCase()),ie}function Eo(L,ie){ie&&!L.j&&(ma(L),L.i=null,L.g.forEach(function(de,Ce){const Ot=Ce.toLowerCase();Ce!=Ot&&(pf(this,Ce),yu(this,Ot,de))},L)),L.j=ie}function As(L,ie){const de=new wo;if(C.Image){const Ce=new Image;Ce.onload=W(Ca,de,"TestLoadImage: loaded",!0,ie,Ce),Ce.onerror=W(Ca,de,"TestLoadImage: error",!1,ie,Ce),Ce.onabort=W(Ca,de,"TestLoadImage: abort",!1,ie,Ce),Ce.ontimeout=W(Ca,de,"TestLoadImage: timeout",!1,ie,Ce),C.setTimeout(function(){Ce.ontimeout&&Ce.ontimeout()},1e4),Ce.src=L}else ie(!1)}function So(L,ie){const de=new wo,Ce=new AbortController,Ot=setTimeout(()=>{Ce.abort(),Ca(de,"TestPingServer: timeout",!1,ie)},1e4);fetch(L,{signal:Ce.signal}).then(Gt=>{clearTimeout(Ot),Gt.ok?Ca(de,"TestPingServer: ok",!0,ie):Ca(de,"TestPingServer: server error",!1,ie)}).catch(()=>{clearTimeout(Ot),Ca(de,"TestPingServer: error",!1,ie)})}function Ca(L,ie,de,Ce,Ot){try{Ot&&(Ot.onload=null,Ot.onerror=null,Ot.onabort=null,Ot.ontimeout=null),Ce(de)}catch{}}function Zo(){this.g=new Ii}function Ua(L){this.i=L.Sb||null,this.h=L.ab||!1}Y(Ua,Fs),Ua.prototype.g=function(){return new Ao(this.i,this.h)};function Ao(L,ie){yr.call(this),this.H=L,this.o=ie,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}Y(Ao,yr),o=Ao.prototype,o.open=function(L,ie){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=L,this.D=ie,this.readyState=1,fl(this)},o.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const ie={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};L&&(ie.body=L),(this.H||C).fetch(new Request(this.D,ie)).then(this.Pa.bind(this),this.ga.bind(this))},o.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,zc(this)),this.readyState=0},o.Pa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,fl(this)),this.g&&(this.readyState=3,fl(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof C.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Oc(this)}else L.text().then(this.Oa.bind(this),this.ga.bind(this))};function Oc(L){L.j.read().then(L.Ma.bind(L)).catch(L.ga.bind(L))}o.Ma=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var ie=L.value?L.value:new Uint8Array(0);(ie=this.B.decode(ie,{stream:!L.done}))&&(this.response=this.responseText+=ie)}L.done?zc(this):fl(this),this.readyState==3&&Oc(this)}},o.Oa=function(L){this.g&&(this.response=this.responseText=L,zc(this))},o.Na=function(L){this.g&&(this.response=L,zc(this))},o.ga=function(){this.g&&zc(this)};function zc(L){L.readyState=4,L.l=null,L.j=null,L.B=null,fl(L)}o.setRequestHeader=function(L,ie){this.A.append(L,ie)},o.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},o.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],ie=this.h.entries();for(var de=ie.next();!de.done;)de=de.value,L.push(de[0]+": "+de[1]),de=ie.next();return L.join(`\r
`)};function fl(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(Ao.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function hs(L){let ie="";return Kn(L,function(de,Ce){ie+=Ce,ie+=":",ie+=de,ie+=`\r
`}),ie}function Ml(L,ie,de){e:{for(Ce in de){var Ce=!1;break e}Ce=!0}Ce||(de=hs(de),typeof L=="string"?de!=null&&qe(de):hr(L,ie,de))}function Er(L){yr.call(this),this.headers=new Map,this.L=L||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}Y(Er,yr);var ga=/^https?$/i,Nc=["POST","PUT"];o=Er.prototype,o.Fa=function(L){this.H=L},o.ea=function(L,ie,de,Ce){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);ie=ie?ie.toUpperCase():"GET",this.D=L,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Lc.g(),this.g.onreadystatechange=ae(B(this.Ca,this));try{this.B=!0,this.g.open(ie,String(L),!0),this.B=!1}catch(Gt){ih(this,Gt);return}if(L=de||"",de=new Map(this.headers),Ce)if(Object.getPrototypeOf(Ce)===Object.prototype)for(var Ot in Ce)de.set(Ot,Ce[Ot]);else if(typeof Ce.keys=="function"&&typeof Ce.get=="function")for(const Gt of Ce.keys())de.set(Gt,Ce.get(Gt));else throw Error("Unknown input type for opt_headers: "+String(Ce));Ce=Array.from(de.keys()).find(Gt=>Gt.toLowerCase()=="content-type"),Ot=C.FormData&&L instanceof C.FormData,!(Array.prototype.indexOf.call(Nc,ie,void 0)>=0)||Ce||Ot||de.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Gt,Sn]of de)this.g.setRequestHeader(Gt,Sn);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(L),this.v=!1}catch(Gt){ih(this,Gt)}};function ih(L,ie){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=ie,L.o=5,rh(L),Io(L)}function rh(L){L.A||(L.A=!0,Xr(L,"complete"),Xr(L,"error"))}o.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=L||7,Xr(this,"complete"),Xr(this,"abort"),Io(this))},o.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Io(this,!0)),Er.Z.N.call(this)},o.Ca=function(){this.u||(this.B||this.v||this.j?hi(this):this.Xa())},o.Xa=function(){hi(this)};function hi(L){if(L.h&&typeof T<"u"){if(L.v&&Co(L)==4)setTimeout(L.Ca.bind(L),0);else if(Xr(L,"readystatechange"),Co(L)==4){L.h=!1;try{const Gt=L.ca();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ie=!0;break e;default:ie=!1}var de;if(!(de=ie)){var Ce;if(Ce=Gt===0){let Sn=String(L.D).match(cr)[1]||null;!Sn&&C.self&&C.self.location&&(Sn=C.self.location.protocol.slice(0,-1)),Ce=!ga.test(Sn?Sn.toLowerCase():"")}de=Ce}if(de)Xr(L,"complete"),Xr(L,"success");else{L.o=6;try{var Ot=Co(L)>2?L.g.statusText:""}catch{Ot=""}L.l=Ot+" ["+L.ca()+"]",rh(L)}}finally{Io(L)}}}}function Io(L,ie){if(L.g){L.m&&(clearTimeout(L.m),L.m=null);const de=L.g;L.g=null,ie||Xr(L,"ready");try{de.onreadystatechange=null}catch{}}}o.isActive=function(){return!!this.g};function Co(L){return L.g?L.g.readyState:0}o.ca=function(){try{return Co(this)>2?this.g.status:-1}catch{return-1}},o.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},o.La=function(L){if(this.g){var ie=this.g.responseText;return L&&ie.indexOf(L)==0&&(ie=ie.substring(L.length)),Li(ie)}};function _a(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.F){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function sc(L){const ie={};L=(L.g&&Co(L)>=2&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ce=0;Ce<L.length;Ce++){if(ve(L[Ce]))continue;var de=ne(L[Ce]);const Ot=de[0];if(de=de[1],typeof de!="string")continue;de=de.trim();const Gt=ie[Ot]||[];ie[Ot]=Gt,Gt.push(de)}it(ie,function(Ce){return Ce.join(", ")})}o.ya=function(){return this.o},o.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ro(L,ie,de){return de&&de.internalChannelParams&&de.internalChannelParams[L]||ie}function io(L){this.za=0,this.i=[],this.j=new wo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ro("failFast",!1,L),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ro("baseRetryDelayMs",5e3,L),this.Za=Ro("retryDelaySeedMs",1e4,L),this.Ta=Ro("forwardChannelMaxRetries",2,L),this.va=Ro("forwardChannelRequestTimeoutMs",2e4,L),this.ma=L&&L.xmlHttpFactory||void 0,this.Ua=L&&L.Rb||void 0,this.Aa=L&&L.useFetchStreams||!1,this.O=void 0,this.L=L&&L.supportsCrossDomainXhr||!1,this.M="",this.h=new kn(L&&L.concurrentRequestLimit),this.Ba=new Zo,this.S=L&&L.fastHandshake||!1,this.R=L&&L.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=L&&L.Pb||!1,L&&L.ua&&this.j.ua(),L&&L.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&L&&L.detectBufferingProxy||!1,this.ia=void 0,L&&L.longPollingTimeout&&L.longPollingTimeout>0&&(this.ia=L.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}o=io.prototype,o.ka=8,o.I=1,o.connect=function(L,ie,de,Ce){gs(0),this.W=L,this.H=ie||{},de&&Ce!==void 0&&(this.H.OSID=de,this.H.OAID=Ce),this.F=this.X,this.J=Rn(this,null,this.W),ro(this)};function Bc(L){if(id(L),L.I==3){var ie=L.V++,de=Ti(L.J);if(hr(de,"SID",L.M),hr(de,"RID",ie),hr(de,"TYPE","terminate"),xu(L,de),ie=new oe(L,L.j,ie),ie.M=2,ie.A=Ts(Ti(de)),de=!1,C.navigator&&C.navigator.sendBeacon)try{de=C.navigator.sendBeacon(ie.A.toString(),"")}catch{}!de&&C.Image&&(new Image().src=ie.A,de=!0),de||(ie.g=sd(ie.j,null),ie.g.ea(ie.A)),ie.F=Date.now(),It(ie)}mf(L)}function Dl(L){L.g&&(Ga(L),L.g.cancel(),L.g=null)}function id(L){Dl(L),L.v&&(C.clearTimeout(L.v),L.v=null),ah(L),L.h.cancel(),L.m&&(typeof L.m=="number"&&C.clearTimeout(L.m),L.m=null)}function ro(L){if(!$i(L.h)&&!L.m){L.m=!0;var ie=L.Ea;cn||Re(),St||(cn(),St=!0),Oe.add(ie,L),L.D=0}}function Mo(L,ie){return xr(L.h)>=L.h.j-(L.m?1:0)?!1:L.m?(L.i=ie.G.concat(L.i),!0):L.I==1||L.I==2||L.D>=(L.Sa?0:L.Ta)?!1:(L.m=Kr(B(L.Ea,L,ie),rd(L,L.D)),L.D++,!0)}o.Ea=function(L){if(this.m)if(this.m=null,this.I==1){if(!L){this.V=Math.floor(Math.random()*1e5),L=this.V++;const Ot=new oe(this,this.j,L);let Gt=this.o;if(this.U&&(Gt?(Gt=ft(Gt),Be(Gt,this.U)):Gt=this.U),this.u!==null||this.R||(Ot.J=Gt,Gt=null),this.S)e:{for(var ie=0,de=0;de<this.i.length;de++){t:{var Ce=this.i[de];if("__data__"in Ce.map&&(Ce=Ce.map.__data__,typeof Ce=="string")){Ce=Ce.length;break t}Ce=void 0}if(Ce===void 0)break;if(ie+=Ce,ie>4096){ie=de;break e}if(ie===4096||de===this.i.length-1){ie=de+1;break e}}ie=1e3}else ie=1e3;ie=ac(this,Ot,ie),de=Ti(this.J),hr(de,"RID",L),hr(de,"CVER",22),this.G&&hr(de,"X-HTTP-Session-Id",this.G),xu(this,de),Gt&&(this.R?ie="headers="+qe(hs(Gt))+"&"+ie:this.u&&Ml(de,this.u,Gt)),vr(this.h,Ot),this.Ra&&hr(de,"TYPE","init"),this.S?(hr(de,"$req",ie),hr(de,"SID","null"),Ot.U=!0,Fe(Ot,de,null)):Fe(Ot,de,ie),this.I=2}}else this.I==3&&(L?Fc(this,L):this.i.length==0||$i(this.h)||Fc(this))};function Fc(L,ie){var de;ie?de=ie.l:de=L.V++;const Ce=Ti(L.J);hr(Ce,"SID",L.M),hr(Ce,"RID",de),hr(Ce,"AID",L.K),xu(L,Ce),L.u&&L.o&&Ml(Ce,L.u,L.o),de=new oe(L,L.j,de,L.D+1),L.u===null&&(de.J=L.o),ie&&(L.i=ie.G.concat(L.i)),ie=ac(L,de,1e3),de.H=Math.round(L.va*.5)+Math.round(L.va*.5*Math.random()),vr(L.h,de),Fe(de,Ce,ie)}function xu(L,ie){L.H&&Kn(L.H,function(de,Ce){hr(ie,Ce,de)}),L.l&&Kn({},function(de,Ce){hr(ie,Ce,de)})}function ac(L,ie,de){de=Math.min(L.i.length,de);const Ce=L.l?B(L.l.Ka,L.l,L):null;e:{var Ot=L.i;let li=-1;for(;;){const Ci=["count="+de];li==-1?de>0?(li=Ot[0].g,Ci.push("ofs="+li)):li=0:Ci.push("ofs="+li);let kr=!0;for(let Qr=0;Qr<de;Qr++){var Gt=Ot[Qr].g;const Do=Ot[Qr].map;if(Gt-=li,Gt<0)li=Math.max(0,Ot[Qr].g-100),kr=!1;else try{Gt="req"+Gt+"_"||"";try{var Sn=Do instanceof Map?Do:Object.entries(Do);for(const[Po,ko]of Sn){let Wo=ko;s(ko)&&(Wo=si(ko)),Ci.push(Gt+Po+"="+encodeURIComponent(Wo))}}catch(Po){throw Ci.push(Gt+"type="+encodeURIComponent("_badmap")),Po}}catch{Ce&&Ce(Do)}}if(kr){Sn=Ci.join("&");break e}}Sn=void 0}return L=L.i.splice(0,de),ie.G=L,Sn}function pl(L){if(!L.g&&!L.v){L.Y=1;var ie=L.Da;cn||Re(),St||(cn(),St=!0),Oe.add(ie,L),L.A=0}}function Vs(L){return L.g||L.v||L.A>=3?!1:(L.Y++,L.v=Kr(B(L.Da,L),rd(L,L.A)),L.A++,!0)}o.Da=function(){if(this.v=null,sh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var L=4*this.T;this.j.info("BP detection timer enabled: "+L),this.B=Kr(B(this.Wa,this),L)}},o.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,gs(10),Dl(this),sh(this))};function Ga(L){L.B!=null&&(C.clearTimeout(L.B),L.B=null)}function sh(L){L.g=new oe(L,L.j,"rpc",L.Y),L.u===null&&(L.g.J=L.o),L.g.P=0;var ie=Ti(L.na);hr(ie,"RID","rpc"),hr(ie,"SID",L.M),hr(ie,"AID",L.K),hr(ie,"CI",L.F?"0":"1"),!L.F&&L.ia&&hr(ie,"TO",L.ia),hr(ie,"TYPE","xmlhttp"),xu(L,ie),L.u&&L.o&&Ml(ie,L.u,L.o),L.O&&(L.g.H=L.O);var de=L.g;L=L.ba,de.M=1,de.A=Ts(Ti(ie)),de.u=null,de.R=!0,st(de,L)}o.Va=function(){this.C!=null&&(this.C=null,Dl(this),Vs(this),gs(19))};function ah(L){L.C!=null&&(C.clearTimeout(L.C),L.C=null)}function Ei(L,ie){var de=null;if(L.g==ie){ah(L),Ga(L),L.g=null;var Ce=2}else if(nr(L.h,ie))de=ie.G,ir(L.h,ie),Ce=1;else return;if(L.I!=0){if(ie.o)if(Ce==1){de=ie.u?ie.u.length:0,ie=Date.now()-ie.F;var Ot=L.D;Ce=ws(),Xr(Ce,new Vi(Ce,de)),ro(L)}else pl(L);else if(Ot=ie.m,Ot==3||Ot==0&&ie.X>0||!(Ce==1&&Mo(L,ie)||Ce==2&&Vs(L)))switch(de&&de.length>0&&(ie=L.h,ie.i=ie.i.concat(de)),Ot){case 1:Pl(L,5);break;case 4:Pl(L,10);break;case 3:Pl(L,6);break;default:Pl(L,2)}}}function rd(L,ie){let de=L.Qa+Math.floor(Math.random()*L.Za);return L.isActive()||(de*=2),de*ie}function Pl(L,ie){if(L.j.info("Error code "+ie),ie==2){var de=B(L.bb,L),Ce=L.Ua;const Ot=!Ce;Ce=new gi(Ce||"//www.google.com/images/cleardot.gif"),C.location&&C.location.protocol=="http"||ur(Ce,"https"),Ts(Ce),Ot?As(Ce.toString(),de):So(Ce.toString(),de)}else gs(2);L.I=0,L.l&&L.l.pa(ie),mf(L),id(L)}o.bb=function(L){L?(this.j.info("Successfully pinged google.com"),gs(2)):(this.j.info("Failed to ping google.com"),gs(1))};function mf(L){if(L.I=0,L.ja=[],L.l){const ie=ui(L.h);(ie.length!=0||L.i.length!=0)&&(Qe(L.ja,ie),Qe(L.ja,L.i),L.h.i.length=0,he(L.i),L.i.length=0),L.l.oa()}}function Rn(L,ie,de){var Ce=de instanceof gi?Ti(de):new gi(de);if(Ce.g!="")ie&&(Ce.g=ie+"."+Ce.g),es(Ce,Ce.u);else{var Ot=C.location;Ce=Ot.protocol,ie=ie?ie+"."+Ot.hostname:Ot.hostname,Ot=+Ot.port;const Gt=new gi(null);Ce&&ur(Gt,Ce),ie&&(Gt.g=ie),Ot&&es(Gt,Ot),de&&(Gt.h=de),Ce=Gt}return de=L.G,ie=L.wa,de&&ie&&hr(Ce,de,ie),hr(Ce,"VER",L.ka),xu(L,Ce),Ce}function sd(L,ie,de){if(ie&&!L.L)throw Error("Can't create secondary domain capable XhrIo object.");return ie=L.Aa&&!L.ma?new Er(new Ua({ab:de})):new Er(L.ma),ie.Fa(L.L),ie}o.isActive=function(){return!!this.l&&this.l.isActive(this)};function oc(){}o=oc.prototype,o.ra=function(){},o.qa=function(){},o.pa=function(){},o.oa=function(){},o.isActive=function(){return!0},o.Ka=function(){};function Is(){}Is.prototype.g=function(L,ie){return new ya(L,ie)};function ya(L,ie){yr.call(this),this.g=new io(ie),this.l=L,this.h=ie&&ie.messageUrlParams||null,L=ie&&ie.messageHeaders||null,ie&&ie.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=ie&&ie.initMessageHeaders||null,ie&&ie.messageContentType&&(L?L["X-WebChannel-Content-Type"]=ie.messageContentType:L={"X-WebChannel-Content-Type":ie.messageContentType}),ie&&ie.sa&&(L?L["X-WebChannel-Client-Profile"]=ie.sa:L={"X-WebChannel-Client-Profile":ie.sa}),this.g.U=L,(L=ie&&ie.Qb)&&!ve(L)&&(this.g.u=L),this.A=ie&&ie.supportsCrossDomainXhr||!1,this.v=ie&&ie.sendRawJson||!1,(ie=ie&&ie.httpSessionIdParam)&&!ve(ie)&&(this.g.G=ie,L=this.h,L!==null&&ie in L&&(L=this.h,ie in L&&delete L[ie])),this.j=new fi(this)}Y(ya,yr),ya.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ya.prototype.close=function(){Bc(this.g)},ya.prototype.o=function(L){var ie=this.g;if(typeof L=="string"){var de={};de.__data__=L,L=de}else this.v&&(de={},de.__data__=si(L),L=de);ie.i.push(new vn(ie.Ya++,L)),ie.I==3&&ro(ie)},ya.prototype.N=function(){this.g.l=null,delete this.j,Bc(this.g),delete this.g,ya.Z.N.call(this)};function xa(L){Pr.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var ie=L.__sm__;if(ie){e:{for(const de in ie){L=de;break e}L=void 0}(this.i=L)&&(L=this.i,ie=ie!==null&&L in ie?ie[L]:void 0),this.data=ie}else this.data=L}Y(xa,Pr);function gn(){mr.call(this),this.status=1}Y(gn,mr);function fi(L){this.g=L}Y(fi,oc),fi.prototype.ra=function(){Xr(this.g,"a")},fi.prototype.qa=function(L){Xr(this.g,new xa(L))},fi.prototype.pa=function(L){Xr(this.g,new gn)},fi.prototype.oa=function(){Xr(this.g,"b")},Is.prototype.createWebChannel=Is.prototype.g,ya.prototype.send=ya.prototype.o,ya.prototype.open=ya.prototype.m,ya.prototype.close=ya.prototype.close,IP=function(){return new Is},AP=function(){return ws()},SP=Fi,oE={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},no.NO_ERROR=0,no.TIMEOUT=8,no.HTTP_ERROR=6,Nb=no,th.COMPLETE="complete",EP=th,_s.EventType=ms,ms.OPEN="a",ms.CLOSE="b",ms.ERROR="c",ms.MESSAGE="d",yr.prototype.listen=yr.prototype.J,mv=_s,Er.prototype.listenOnce=Er.prototype.K,Er.prototype.getLastError=Er.prototype.Ha,Er.prototype.getLastErrorCode=Er.prototype.ya,Er.prototype.getStatus=Er.prototype.ca,Er.prototype.getResponseJson=Er.prototype.La,Er.prototype.getResponseText=Er.prototype.la,Er.prototype.send=Er.prototype.ea,Er.prototype.setWithCredentials=Er.prototype.Fa,TP=Er}).apply(typeof bb<"u"?bb:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Sl.UNAUTHENTICATED=new Sl(null),Sl.GOOGLE_CREDENTIALS=new Sl("google-credentials-uid"),Sl.FIRST_PARTY=new Sl("first-party-uid"),Sl.MOCK_USER=new Sl("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zy="12.8.0";function $V(o){Zy=o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_=new XE("@firebase/firestore");function xy(){return c_.logLevel}function Xn(o,...t){if(c_.logLevel<=Rr.DEBUG){const a=t.map(lS);c_.debug(`Firestore (${Zy}): ${o}`,...a)}}function bp(o,...t){if(c_.logLevel<=Rr.ERROR){const a=t.map(lS);c_.error(`Firestore (${Zy}): ${o}`,...a)}}function Ly(o,...t){if(c_.logLevel<=Rr.WARN){const a=t.map(lS);c_.warn(`Firestore (${Zy}): ${o}`,...a)}}function lS(o){if(typeof o=="string")return o;try{return(function(a){return JSON.stringify(a)})(o)}catch{return o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(o,t,a){let u="Unexpected state";typeof t=="string"?u=t:a=t,CP(o,u,a)}function CP(o,t,a){let u=`FIRESTORE (${Zy}) INTERNAL ASSERTION FAILED: ${t} (ID: ${o.toString(16)})`;if(a!==void 0)try{u+=" CONTEXT: "+JSON.stringify(a)}catch{u+=" CONTEXT: "+a}throw bp(u),new Error(u)}function ps(o,t,a,u){let y="Unexpected state";typeof a=="string"?y=a:u=a,o||CP(t,y,u)}function Yi(o,t){return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Zn extends Ep{constructor(t,a){super(t,a),this.code=t,this.message=a,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(){this.promise=new Promise(((t,a)=>{this.resolve=t,this.reject=a}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(t,a){this.user=a,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ZV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,a){t.enqueueRetryable((()=>a(Sl.UNAUTHENTICATED)))}shutdown(){}}class WV{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,a){this.changeListener=a,t.enqueueRetryable((()=>a(this.token.user)))}shutdown(){this.changeListener=null}}class XV{constructor(t){this.t=t,this.currentUser=Sl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,a){ps(this.o===void 0,42304);let u=this.i;const y=V=>this.i!==u?(u=this.i,a(V)):Promise.resolve();let T=new zm;this.o=()=>{this.i++,this.currentUser=this.u(),T.resolve(),T=new zm,t.enqueueRetryable((()=>y(this.currentUser)))};const C=()=>{const V=T;t.enqueueRetryable((async()=>{await V.promise,await y(this.currentUser)}))},s=V=>{Xn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=V,this.o&&(this.auth.addAuthTokenListener(this.o),C())};this.t.onInit((V=>s(V))),setTimeout((()=>{if(!this.auth){const V=this.t.getImmediate({optional:!0});V?s(V):(Xn("FirebaseAuthCredentialsProvider","Auth not yet detected"),T.resolve(),T=new zm)}}),0),C()}getToken(){const t=this.i,a=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(a).then((u=>this.i!==t?(Xn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):u?(ps(typeof u.accessToken=="string",31837,{l:u}),new RP(u.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ps(t===null||typeof t=="string",2055,{h:t}),new Sl(t)}}class YV{constructor(t,a,u){this.P=t,this.T=a,this.I=u,this.type="FirstParty",this.user=Sl.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class KV{constructor(t,a,u){this.P=t,this.T=a,this.I=u}getToken(){return Promise.resolve(new YV(this.P,this.T,this.I))}start(t,a){t.enqueueRetryable((()=>a(Sl.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class lR{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class QV{constructor(t,a){this.V=a,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Xh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,a){ps(this.o===void 0,3512);const u=T=>{T.error!=null&&Xn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${T.error.message}`);const C=T.token!==this.m;return this.m=T.token,Xn("FirebaseAppCheckTokenProvider",`Received ${C?"new":"existing"} token.`),C?a(T.token):Promise.resolve()};this.o=T=>{t.enqueueRetryable((()=>u(T)))};const y=T=>{Xn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=T,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((T=>y(T))),setTimeout((()=>{if(!this.appCheck){const T=this.V.getImmediate({optional:!0});T?y(T):Xn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new lR(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((a=>a?(ps(typeof a.token=="string",44558,{tokenResult:a}),this.m=a.token,new lR(a.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JV(o){const t=typeof self<"u"&&(self.crypto||self.msCrypto),a=new Uint8Array(o);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(a);else for(let u=0;u<o;u++)a[u]=Math.floor(256*Math.random());return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=62*Math.floor(4.129032258064516);let u="";for(;u.length<20;){const y=JV(40);for(let T=0;T<y.length;++T)u.length<20&&y[T]<a&&(u+=t.charAt(y[T]%62))}return u}}function Mr(o,t){return o<t?-1:o>t?1:0}function lE(o,t){const a=Math.min(o.length,t.length);for(let u=0;u<a;u++){const y=o.charAt(u),T=t.charAt(u);if(y!==T)return IT(y)===IT(T)?Mr(y,T):IT(y)?1:-1}return Mr(o.length,t.length)}const ej=55296,tj=57343;function IT(o){const t=o.charCodeAt(0);return t>=ej&&t<=tj}function Oy(o,t,a){return o.length===t.length&&o.every(((u,y)=>a(u,t[y])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cR="__name__";class ef{constructor(t,a,u){a===void 0?a=0:a>t.length&&zi(637,{offset:a,range:t.length}),u===void 0?u=t.length-a:u>t.length-a&&zi(1746,{length:u,range:t.length-a}),this.segments=t,this.offset=a,this.len=u}get length(){return this.len}isEqual(t){return ef.comparator(this,t)===0}child(t){const a=this.segments.slice(this.offset,this.limit());return t instanceof ef?t.forEach((u=>{a.push(u)})):a.push(t),this.construct(a)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==t.get(a))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==t.get(a))return!1;return!0}forEach(t){for(let a=this.offset,u=this.limit();a<u;a++)t(this.segments[a])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,a){const u=Math.min(t.length,a.length);for(let y=0;y<u;y++){const T=ef.compareSegments(t.get(y),a.get(y));if(T!==0)return T}return Mr(t.length,a.length)}static compareSegments(t,a){const u=ef.isNumericId(t),y=ef.isNumericId(a);return u&&!y?-1:!u&&y?1:u&&y?ef.extractNumericId(t).compare(ef.extractNumericId(a)):lE(t,a)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Om.fromString(t.substring(4,t.length-2))}}class Ns extends ef{construct(t,a,u){return new Ns(t,a,u)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const a=[];for(const u of t){if(u.indexOf("//")>=0)throw new Zn(fn.INVALID_ARGUMENT,`Invalid segment (${u}). Paths must not contain // in them.`);a.push(...u.split("/").filter((y=>y.length>0)))}return new Ns(a)}static emptyPath(){return new Ns([])}}const nj=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ol extends ef{construct(t,a,u){return new ol(t,a,u)}static isValidIdentifier(t){return nj.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ol.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===cR}static keyField(){return new ol([cR])}static fromServerFormat(t){const a=[];let u="",y=0;const T=()=>{if(u.length===0)throw new Zn(fn.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);a.push(u),u=""};let C=!1;for(;y<t.length;){const s=t[y];if(s==="\\"){if(y+1===t.length)throw new Zn(fn.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const V=t[y+1];if(V!=="\\"&&V!=="."&&V!=="`")throw new Zn(fn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);u+=V,y+=2}else s==="`"?(C=!C,y++):s!=="."||C?(u+=s,y++):(T(),y++)}if(T(),C)throw new Zn(fn.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ol(a)}static emptyPath(){return new ol([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(t){this.path=t}static fromPath(t){return new xi(Ns.fromString(t))}static fromName(t){return new xi(Ns.fromString(t).popFirst(5))}static empty(){return new xi(Ns.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ns.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,a){return Ns.comparator(t.path,a.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new xi(new Ns(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP(o,t,a){if(!a)throw new Zn(fn.INVALID_ARGUMENT,`Function ${o}() cannot be called with an empty ${t}.`)}function ij(o,t,a,u){if(t===!0&&u===!0)throw new Zn(fn.INVALID_ARGUMENT,`${o} and ${a} cannot be used together.`)}function uR(o){if(!xi.isDocumentKey(o))throw new Zn(fn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${o} has ${o.length}.`)}function hR(o){if(xi.isDocumentKey(o))throw new Zn(fn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${o} has ${o.length}.`)}function DP(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}function S1(o){if(o===void 0)return"undefined";if(o===null)return"null";if(typeof o=="string")return o.length>20&&(o=`${o.substring(0,20)}...`),JSON.stringify(o);if(typeof o=="number"||typeof o=="boolean")return""+o;if(typeof o=="object"){if(o instanceof Array)return"an array";{const t=(function(u){return u.constructor?u.constructor.name:null})(o);return t?`a custom ${t} object`:"an object"}}return typeof o=="function"?"a function":zi(12329,{type:typeof o})}function _p(o,t){if("_delegate"in o&&(o=o._delegate),!(o instanceof t)){if(t.name===o.constructor.name)throw new Zn(fn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const a=S1(o);throw new Zn(fn.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${a}`)}}return o}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(o,t){const a={typeString:o};return t&&(a.value=t),a}function Yv(o,t){if(!DP(o))throw new Zn(fn.INVALID_ARGUMENT,"JSON must be an object");let a;for(const u in t)if(t[u]){const y=t[u].typeString,T="value"in t[u]?{value:t[u].value}:void 0;if(!(u in o)){a=`JSON missing required field: '${u}'`;break}const C=o[u];if(y&&typeof C!==y){a=`JSON field '${u}' must be a ${y}.`;break}if(T!==void 0&&C!==T.value){a=`Expected '${u}' field to equal '${T.value}'`;break}}if(a)throw new Zn(fn.INVALID_ARGUMENT,a);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR=-62135596800,fR=1e6;class Ws{static now(){return Ws.fromMillis(Date.now())}static fromDate(t){return Ws.fromMillis(t.getTime())}static fromMillis(t){const a=Math.floor(t/1e3),u=Math.floor((t-1e3*a)*fR);return new Ws(a,u)}constructor(t,a){if(this.seconds=t,this.nanoseconds=a,a<0)throw new Zn(fn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(a>=1e9)throw new Zn(fn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(t<dR)throw new Zn(fn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Zn(fn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/fR}_compareTo(t){return this.seconds===t.seconds?Mr(this.nanoseconds,t.nanoseconds):Mr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ws._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Yv(t,Ws._jsonSchema))return new Ws(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-dR;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ws._jsonSchemaVersion="firestore/timestamp/1.0",Ws._jsonSchema={type:Ja("string",Ws._jsonSchemaVersion),seconds:Ja("number"),nanoseconds:Ja("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{static fromTimestamp(t){return new Wi(t)}static min(){return new Wi(new Ws(0,0))}static max(){return new Wi(new Ws(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pv=-1;function rj(o,t){const a=o.toTimestamp().seconds,u=o.toTimestamp().nanoseconds+1,y=Wi.fromTimestamp(u===1e9?new Ws(a+1,0):new Ws(a,u));return new Fm(y,xi.empty(),t)}function sj(o){return new Fm(o.readTime,o.key,Pv)}class Fm{constructor(t,a,u){this.readTime=t,this.documentKey=a,this.largestBatchId=u}static min(){return new Fm(Wi.min(),xi.empty(),Pv)}static max(){return new Fm(Wi.max(),xi.empty(),Pv)}}function aj(o,t){let a=o.readTime.compareTo(t.readTime);return a!==0?a:(a=xi.comparator(o.documentKey,t.documentKey),a!==0?a:Mr(o.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class lj{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wy(o){if(o.code!==fn.FAILED_PRECONDITION||o.message!==oj)throw o;Xn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)}),(a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)}))}catch(t){return this.next(void 0,t)}next(t,a){return this.callbackAttached&&zi(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(a,this.error):this.wrapSuccess(t,this.result):new pn(((u,y)=>{this.nextCallback=T=>{this.wrapSuccess(t,T).next(u,y)},this.catchCallback=T=>{this.wrapFailure(a,T).next(u,y)}}))}toPromise(){return new Promise(((t,a)=>{this.next(t,a)}))}wrapUserFunction(t){try{const a=t();return a instanceof pn?a:pn.resolve(a)}catch(a){return pn.reject(a)}}wrapSuccess(t,a){return t?this.wrapUserFunction((()=>t(a))):pn.resolve(a)}wrapFailure(t,a){return t?this.wrapUserFunction((()=>t(a))):pn.reject(a)}static resolve(t){return new pn(((a,u)=>{a(t)}))}static reject(t){return new pn(((a,u)=>{u(t)}))}static waitFor(t){return new pn(((a,u)=>{let y=0,T=0,C=!1;t.forEach((s=>{++y,s.next((()=>{++T,C&&T===y&&a()}),(V=>u(V)))})),C=!0,T===y&&a()}))}static or(t){let a=pn.resolve(!1);for(const u of t)a=a.next((y=>y?pn.resolve(y):u()));return a}static forEach(t,a){const u=[];return t.forEach(((y,T)=>{u.push(a.call(this,y,T))})),this.waitFor(u)}static mapArray(t,a){return new pn(((u,y)=>{const T=t.length,C=new Array(T);let s=0;for(let V=0;V<T;V++){const B=V;a(t[B]).next((W=>{C[B]=W,++s,s===T&&u(C)}),(W=>y(W)))}}))}static doWhile(t,a){return new pn(((u,y)=>{const T=()=>{t()===!0?a().next((()=>{T()}),y):u()};T()}))}}function cj(o){const t=o.match(/Android ([\d.]+)/i),a=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(a)}function Xy(o){return o.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(t,a){this.previousValue=t,a&&(a.sequenceNumberHandler=u=>this.ae(u),this.ue=u=>a.writeSequenceNumber(u))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}A1.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uS=-1;function I1(o){return o==null}function s1(o){return o===0&&1/o==-1/0}function uj(o){return typeof o=="number"&&Number.isInteger(o)&&!s1(o)&&o<=Number.MAX_SAFE_INTEGER&&o>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="";function hj(o){let t="";for(let a=0;a<o.length;a++)t.length>0&&(t=pR(t)),t=dj(o.get(a),t);return pR(t)}function dj(o,t){let a=t;const u=o.length;for(let y=0;y<u;y++){const T=o.charAt(y);switch(T){case"\0":a+="";break;case PP:a+="";break;default:a+=T}}return a}function pR(o){return o+PP+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mR(o){let t=0;for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&t++;return t}function d_(o,t){for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&t(a,o[a])}function kP(o){for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(t,a){this.comparator=t,this.root=a||al.EMPTY}insert(t,a){return new fa(this.comparator,this.root.insert(t,a,this.comparator).copy(null,null,al.BLACK,null,null))}remove(t){return new fa(this.comparator,this.root.remove(t,this.comparator).copy(null,null,al.BLACK,null,null))}get(t){let a=this.root;for(;!a.isEmpty();){const u=this.comparator(t,a.key);if(u===0)return a.value;u<0?a=a.left:u>0&&(a=a.right)}return null}indexOf(t){let a=0,u=this.root;for(;!u.isEmpty();){const y=this.comparator(t,u.key);if(y===0)return a+u.left.size;y<0?u=u.left:(a+=u.left.size+1,u=u.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((a,u)=>(t(a,u),!1)))}toString(){const t=[];return this.inorderTraversal(((a,u)=>(t.push(`${a}:${u}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wb(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wb(this.root,t,this.comparator,!1)}getReverseIterator(){return new wb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wb(this.root,t,this.comparator,!0)}}class wb{constructor(t,a,u,y){this.isReverse=y,this.nodeStack=[];let T=1;for(;!t.isEmpty();)if(T=a?u(t.key,a):1,a&&y&&(T*=-1),T<0)t=this.isReverse?t.left:t.right;else{if(T===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const a={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return a}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class al{constructor(t,a,u,y,T){this.key=t,this.value=a,this.color=u??al.RED,this.left=y??al.EMPTY,this.right=T??al.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,a,u,y,T){return new al(t??this.key,a??this.value,u??this.color,y??this.left,T??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,a,u){let y=this;const T=u(t,y.key);return y=T<0?y.copy(null,null,null,y.left.insert(t,a,u),null):T===0?y.copy(null,a,null,null,null):y.copy(null,null,null,null,y.right.insert(t,a,u)),y.fixUp()}removeMin(){if(this.left.isEmpty())return al.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,a){let u,y=this;if(a(t,y.key)<0)y.left.isEmpty()||y.left.isRed()||y.left.left.isRed()||(y=y.moveRedLeft()),y=y.copy(null,null,null,y.left.remove(t,a),null);else{if(y.left.isRed()&&(y=y.rotateRight()),y.right.isEmpty()||y.right.isRed()||y.right.left.isRed()||(y=y.moveRedRight()),a(t,y.key)===0){if(y.right.isEmpty())return al.EMPTY;u=y.right.min(),y=y.copy(u.key,u.value,null,null,y.right.removeMin())}y=y.copy(null,null,null,null,y.right.remove(t,a))}return y.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,al.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,al.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),a=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,a)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zi(43730,{key:this.key,value:this.value});if(this.right.isRed())throw zi(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw zi(27949);return t+(this.isRed()?0:1)}}al.EMPTY=null,al.RED=!0,al.BLACK=!1;al.EMPTY=new class{constructor(){this.size=0}get key(){throw zi(57766)}get value(){throw zi(16141)}get color(){throw zi(16727)}get left(){throw zi(29726)}get right(){throw zi(36894)}copy(t,a,u,y,T){return this}insert(t,a,u){return new al(t,a)}remove(t,a){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(t){this.comparator=t,this.data=new fa(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((a,u)=>(t(a),!1)))}forEachInRange(t,a){const u=this.data.getIteratorFrom(t[0]);for(;u.hasNext();){const y=u.getNext();if(this.comparator(y.key,t[1])>=0)return;a(y.key)}}forEachWhile(t,a){let u;for(u=a!==void 0?this.data.getIteratorFrom(a):this.data.getIterator();u.hasNext();)if(!t(u.getNext().key))return}firstAfterOrEqual(t){const a=this.data.getIteratorFrom(t);return a.hasNext()?a.getNext().key:null}getIterator(){return new gR(this.data.getIterator())}getIteratorFrom(t){return new gR(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let a=this;return a.size<t.size&&(a=t,t=this),t.forEach((u=>{a=a.add(u)})),a}isEqual(t){if(!(t instanceof vo)||this.size!==t.size)return!1;const a=this.data.getIterator(),u=t.data.getIterator();for(;a.hasNext();){const y=a.getNext().key,T=u.getNext().key;if(this.comparator(y,T)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((a=>{t.push(a)})),t}toString(){const t=[];return this.forEach((a=>t.push(a))),"SortedSet("+t.toString()+")"}copy(t){const a=new vo(this.comparator);return a.data=t,a}}class gR{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(t){this.fields=t,t.sort(ol.comparator)}static empty(){return new Kh([])}unionWith(t){let a=new vo(ol.comparator);for(const u of this.fields)a=a.add(u);for(const u of t)a=a.add(u);return new Kh(a.toArray())}covers(t){for(const a of this.fields)if(a.isPrefixOf(t))return!0;return!1}isEqual(t){return Oy(this.fields,t.fields,((a,u)=>a.isEqual(u)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(t){this.binaryString=t}static fromBase64String(t){const a=(function(y){try{return atob(y)}catch(T){throw typeof DOMException<"u"&&T instanceof DOMException?new LP("Invalid base64 string: "+T):T}})(t);return new ll(a)}static fromUint8Array(t){const a=(function(y){let T="";for(let C=0;C<y.length;++C)T+=String.fromCharCode(y[C]);return T})(t);return new ll(a)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(a){return btoa(a)})(this.binaryString)}toUint8Array(){return(function(a){const u=new Uint8Array(a.length);for(let y=0;y<a.length;y++)u[y]=a.charCodeAt(y);return u})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Mr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ll.EMPTY_BYTE_STRING=new ll("");const fj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vm(o){if(ps(!!o,39018),typeof o=="string"){let t=0;const a=fj.exec(o);if(ps(!!a,46558,{timestamp:o}),a[1]){let y=a[1];y=(y+"000000000").substr(0,9),t=Number(y)}const u=new Date(o);return{seconds:Math.floor(u.getTime()/1e3),nanos:t}}return{seconds:Na(o.seconds),nanos:Na(o.nanos)}}function Na(o){return typeof o=="number"?o:typeof o=="string"?Number(o):0}function jm(o){return typeof o=="string"?ll.fromBase64String(o):ll.fromUint8Array(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OP="server_timestamp",zP="__type__",NP="__previous_value__",BP="__local_write_time__";function hS(o){var a,u;return((u=(((a=o==null?void 0:o.mapValue)==null?void 0:a.fields)||{})[zP])==null?void 0:u.stringValue)===OP}function C1(o){const t=o.mapValue.fields[NP];return hS(t)?C1(t):t}function kv(o){const t=Vm(o.mapValue.fields[BP].timestampValue);return new Ws(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pj{constructor(t,a,u,y,T,C,s,V,B,W,Y){this.databaseId=t,this.appId=a,this.persistenceKey=u,this.host=y,this.ssl=T,this.forceLongPolling=C,this.autoDetectLongPolling=s,this.longPollingOptions=V,this.useFetchStreams=B,this.isUsingEmulator=W,this.apiKey=Y}}const a1="(default)";class Lv{constructor(t,a){this.projectId=t,this.database=a||a1}static empty(){return new Lv("","")}get isDefaultDatabase(){return this.database===a1}isEqual(t){return t instanceof Lv&&t.projectId===this.projectId&&t.database===this.database}}function mj(o,t){if(!Object.prototype.hasOwnProperty.apply(o.options,["projectId"]))throw new Zn(fn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Lv(o.options.projectId,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP="__type__",gj="__max__",Tb={mapValue:{}},VP="__vector__",o1="value";function Um(o){return"nullValue"in o?0:"booleanValue"in o?1:"integerValue"in o||"doubleValue"in o?2:"timestampValue"in o?3:"stringValue"in o?5:"bytesValue"in o?6:"referenceValue"in o?7:"geoPointValue"in o?8:"arrayValue"in o?9:"mapValue"in o?hS(o)?4:yj(o)?9007199254740991:_j(o)?10:11:zi(28295,{value:o})}function cf(o,t){if(o===t)return!0;const a=Um(o);if(a!==Um(t))return!1;switch(a){case 0:case 9007199254740991:return!0;case 1:return o.booleanValue===t.booleanValue;case 4:return kv(o).isEqual(kv(t));case 3:return(function(y,T){if(typeof y.timestampValue=="string"&&typeof T.timestampValue=="string"&&y.timestampValue.length===T.timestampValue.length)return y.timestampValue===T.timestampValue;const C=Vm(y.timestampValue),s=Vm(T.timestampValue);return C.seconds===s.seconds&&C.nanos===s.nanos})(o,t);case 5:return o.stringValue===t.stringValue;case 6:return(function(y,T){return jm(y.bytesValue).isEqual(jm(T.bytesValue))})(o,t);case 7:return o.referenceValue===t.referenceValue;case 8:return(function(y,T){return Na(y.geoPointValue.latitude)===Na(T.geoPointValue.latitude)&&Na(y.geoPointValue.longitude)===Na(T.geoPointValue.longitude)})(o,t);case 2:return(function(y,T){if("integerValue"in y&&"integerValue"in T)return Na(y.integerValue)===Na(T.integerValue);if("doubleValue"in y&&"doubleValue"in T){const C=Na(y.doubleValue),s=Na(T.doubleValue);return C===s?s1(C)===s1(s):isNaN(C)&&isNaN(s)}return!1})(o,t);case 9:return Oy(o.arrayValue.values||[],t.arrayValue.values||[],cf);case 10:case 11:return(function(y,T){const C=y.mapValue.fields||{},s=T.mapValue.fields||{};if(mR(C)!==mR(s))return!1;for(const V in C)if(C.hasOwnProperty(V)&&(s[V]===void 0||!cf(C[V],s[V])))return!1;return!0})(o,t);default:return zi(52216,{left:o})}}function Ov(o,t){return(o.values||[]).find((a=>cf(a,t)))!==void 0}function zy(o,t){if(o===t)return 0;const a=Um(o),u=Um(t);if(a!==u)return Mr(a,u);switch(a){case 0:case 9007199254740991:return 0;case 1:return Mr(o.booleanValue,t.booleanValue);case 2:return(function(T,C){const s=Na(T.integerValue||T.doubleValue),V=Na(C.integerValue||C.doubleValue);return s<V?-1:s>V?1:s===V?0:isNaN(s)?isNaN(V)?0:-1:1})(o,t);case 3:return _R(o.timestampValue,t.timestampValue);case 4:return _R(kv(o),kv(t));case 5:return lE(o.stringValue,t.stringValue);case 6:return(function(T,C){const s=jm(T),V=jm(C);return s.compareTo(V)})(o.bytesValue,t.bytesValue);case 7:return(function(T,C){const s=T.split("/"),V=C.split("/");for(let B=0;B<s.length&&B<V.length;B++){const W=Mr(s[B],V[B]);if(W!==0)return W}return Mr(s.length,V.length)})(o.referenceValue,t.referenceValue);case 8:return(function(T,C){const s=Mr(Na(T.latitude),Na(C.latitude));return s!==0?s:Mr(Na(T.longitude),Na(C.longitude))})(o.geoPointValue,t.geoPointValue);case 9:return yR(o.arrayValue,t.arrayValue);case 10:return(function(T,C){var ae,he,Qe,Ye;const s=T.fields||{},V=C.fields||{},B=(ae=s[o1])==null?void 0:ae.arrayValue,W=(he=V[o1])==null?void 0:he.arrayValue,Y=Mr(((Qe=B==null?void 0:B.values)==null?void 0:Qe.length)||0,((Ye=W==null?void 0:W.values)==null?void 0:Ye.length)||0);return Y!==0?Y:yR(B,W)})(o.mapValue,t.mapValue);case 11:return(function(T,C){if(T===Tb.mapValue&&C===Tb.mapValue)return 0;if(T===Tb.mapValue)return 1;if(C===Tb.mapValue)return-1;const s=T.fields||{},V=Object.keys(s),B=C.fields||{},W=Object.keys(B);V.sort(),W.sort();for(let Y=0;Y<V.length&&Y<W.length;++Y){const ae=lE(V[Y],W[Y]);if(ae!==0)return ae;const he=zy(s[V[Y]],B[W[Y]]);if(he!==0)return he}return Mr(V.length,W.length)})(o.mapValue,t.mapValue);default:throw zi(23264,{he:a})}}function _R(o,t){if(typeof o=="string"&&typeof t=="string"&&o.length===t.length)return Mr(o,t);const a=Vm(o),u=Vm(t),y=Mr(a.seconds,u.seconds);return y!==0?y:Mr(a.nanos,u.nanos)}function yR(o,t){const a=o.values||[],u=t.values||[];for(let y=0;y<a.length&&y<u.length;++y){const T=zy(a[y],u[y]);if(T)return T}return Mr(a.length,u.length)}function Ny(o){return cE(o)}function cE(o){return"nullValue"in o?"null":"booleanValue"in o?""+o.booleanValue:"integerValue"in o?""+o.integerValue:"doubleValue"in o?""+o.doubleValue:"timestampValue"in o?(function(a){const u=Vm(a);return`time(${u.seconds},${u.nanos})`})(o.timestampValue):"stringValue"in o?o.stringValue:"bytesValue"in o?(function(a){return jm(a).toBase64()})(o.bytesValue):"referenceValue"in o?(function(a){return xi.fromName(a).toString()})(o.referenceValue):"geoPointValue"in o?(function(a){return`geo(${a.latitude},${a.longitude})`})(o.geoPointValue):"arrayValue"in o?(function(a){let u="[",y=!0;for(const T of a.values||[])y?y=!1:u+=",",u+=cE(T);return u+"]"})(o.arrayValue):"mapValue"in o?(function(a){const u=Object.keys(a.fields||{}).sort();let y="{",T=!0;for(const C of u)T?T=!1:y+=",",y+=`${C}:${cE(a.fields[C])}`;return y+"}"})(o.mapValue):zi(61005,{value:o})}function Bb(o){switch(Um(o)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=C1(o);return t?16+Bb(t):16;case 5:return 2*o.stringValue.length;case 6:return jm(o.bytesValue).approximateByteSize();case 7:return o.referenceValue.length;case 9:return(function(u){return(u.values||[]).reduce(((y,T)=>y+Bb(T)),0)})(o.arrayValue);case 10:case 11:return(function(u){let y=0;return d_(u.fields,((T,C)=>{y+=T.length+Bb(C)})),y})(o.mapValue);default:throw zi(13486,{value:o})}}function xR(o,t){return{referenceValue:`projects/${o.projectId}/databases/${o.database}/documents/${t.path.canonicalString()}`}}function uE(o){return!!o&&"integerValue"in o}function dS(o){return!!o&&"arrayValue"in o}function vR(o){return!!o&&"nullValue"in o}function bR(o){return!!o&&"doubleValue"in o&&isNaN(Number(o.doubleValue))}function Fb(o){return!!o&&"mapValue"in o}function _j(o){var a,u;return((u=(((a=o==null?void 0:o.mapValue)==null?void 0:a.fields)||{})[FP])==null?void 0:u.stringValue)===VP}function wv(o){if(o.geoPointValue)return{geoPointValue:{...o.geoPointValue}};if(o.timestampValue&&typeof o.timestampValue=="object")return{timestampValue:{...o.timestampValue}};if(o.mapValue){const t={mapValue:{fields:{}}};return d_(o.mapValue.fields,((a,u)=>t.mapValue.fields[a]=wv(u))),t}if(o.arrayValue){const t={arrayValue:{values:[]}};for(let a=0;a<(o.arrayValue.values||[]).length;++a)t.arrayValue.values[a]=wv(o.arrayValue.values[a]);return t}return{...o}}function yj(o){return(((o.mapValue||{}).fields||{}).__type__||{}).stringValue===gj}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(t){this.value=t}static empty(){return new Qu({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let a=this.value;for(let u=0;u<t.length-1;++u)if(a=(a.mapValue.fields||{})[t.get(u)],!Fb(a))return null;return a=(a.mapValue.fields||{})[t.lastSegment()],a||null}}set(t,a){this.getFieldsMap(t.popLast())[t.lastSegment()]=wv(a)}setAll(t){let a=ol.emptyPath(),u={},y=[];t.forEach(((C,s)=>{if(!a.isImmediateParentOf(s)){const V=this.getFieldsMap(a);this.applyChanges(V,u,y),u={},y=[],a=s.popLast()}C?u[s.lastSegment()]=wv(C):y.push(s.lastSegment())}));const T=this.getFieldsMap(a);this.applyChanges(T,u,y)}delete(t){const a=this.field(t.popLast());Fb(a)&&a.mapValue.fields&&delete a.mapValue.fields[t.lastSegment()]}isEqual(t){return cf(this.value,t.value)}getFieldsMap(t){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let u=0;u<t.length;++u){let y=a.mapValue.fields[t.get(u)];Fb(y)&&y.mapValue.fields||(y={mapValue:{fields:{}}},a.mapValue.fields[t.get(u)]=y),a=y}return a.mapValue.fields}applyChanges(t,a,u){d_(a,((y,T)=>t[y]=T));for(const y of u)delete t[y]}clone(){return new Qu(wv(this.value))}}function jP(o){const t=[];return d_(o.fields,((a,u)=>{const y=new ol([a]);if(Fb(u)){const T=jP(u.mapValue).fields;if(T.length===0)t.push(y);else for(const C of T)t.push(y.child(C))}else t.push(y)})),new Kh(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(t,a,u,y,T,C,s){this.key=t,this.documentType=a,this.version=u,this.readTime=y,this.createTime=T,this.data=C,this.documentState=s}static newInvalidDocument(t){return new Al(t,0,Wi.min(),Wi.min(),Wi.min(),Qu.empty(),0)}static newFoundDocument(t,a,u,y){return new Al(t,1,a,Wi.min(),u,y,0)}static newNoDocument(t,a){return new Al(t,2,a,Wi.min(),Wi.min(),Qu.empty(),0)}static newUnknownDocument(t,a){return new Al(t,3,a,Wi.min(),Wi.min(),Qu.empty(),2)}convertToFoundDocument(t,a){return!this.createTime.isEqual(Wi.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=a,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Qu.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Qu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Wi.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Al&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Al(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(t,a){this.position=t,this.inclusive=a}}function wR(o,t,a){let u=0;for(let y=0;y<o.position.length;y++){const T=t[y],C=o.position[y];if(T.field.isKeyField()?u=xi.comparator(xi.fromName(C.referenceValue),a.key):u=zy(C,a.data.field(T.field)),T.dir==="desc"&&(u*=-1),u!==0)break}return u}function TR(o,t){if(o===null)return t===null;if(t===null||o.inclusive!==t.inclusive||o.position.length!==t.position.length)return!1;for(let a=0;a<o.position.length;a++)if(!cf(o.position[a],t.position[a]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(t,a="asc"){this.field=t,this.dir=a}}function xj(o,t){return o.dir===t.dir&&o.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{}class Qa extends UP{constructor(t,a,u){super(),this.field=t,this.op=a,this.value=u}static create(t,a,u){return t.isKeyField()?a==="in"||a==="not-in"?this.createKeyFieldInFilter(t,a,u):new bj(t,a,u):a==="array-contains"?new Ej(t,u):a==="in"?new Sj(t,u):a==="not-in"?new Aj(t,u):a==="array-contains-any"?new Ij(t,u):new Qa(t,a,u)}static createKeyFieldInFilter(t,a,u){return a==="in"?new wj(t,u):new Tj(t,u)}matches(t){const a=t.data.field(this.field);return this.op==="!="?a!==null&&a.nullValue===void 0&&this.matchesComparison(zy(a,this.value)):a!==null&&Um(this.value)===Um(a)&&this.matchesComparison(zy(a,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return zi(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ed extends UP{constructor(t,a){super(),this.filters=t,this.op=a,this.Pe=null}static create(t,a){return new ed(t,a)}matches(t){return GP(this)?this.filters.find((a=>!a.matches(t)))===void 0:this.filters.find((a=>a.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,a)=>t.concat(a.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function GP(o){return o.op==="and"}function qP(o){return vj(o)&&GP(o)}function vj(o){for(const t of o.filters)if(t instanceof ed)return!1;return!0}function hE(o){if(o instanceof Qa)return o.field.canonicalString()+o.op.toString()+Ny(o.value);if(qP(o))return o.filters.map((t=>hE(t))).join(",");{const t=o.filters.map((a=>hE(a))).join(",");return`${o.op}(${t})`}}function HP(o,t){return o instanceof Qa?(function(u,y){return y instanceof Qa&&u.op===y.op&&u.field.isEqual(y.field)&&cf(u.value,y.value)})(o,t):o instanceof ed?(function(u,y){return y instanceof ed&&u.op===y.op&&u.filters.length===y.filters.length?u.filters.reduce(((T,C,s)=>T&&HP(C,y.filters[s])),!0):!1})(o,t):void zi(19439)}function $P(o){return o instanceof Qa?(function(a){return`${a.field.canonicalString()} ${a.op} ${Ny(a.value)}`})(o):o instanceof ed?(function(a){return a.op.toString()+" {"+a.getFilters().map($P).join(" ,")+"}"})(o):"Filter"}class bj extends Qa{constructor(t,a,u){super(t,a,u),this.key=xi.fromName(u.referenceValue)}matches(t){const a=xi.comparator(t.key,this.key);return this.matchesComparison(a)}}class wj extends Qa{constructor(t,a){super(t,"in",a),this.keys=ZP("in",a)}matches(t){return this.keys.some((a=>a.isEqual(t.key)))}}class Tj extends Qa{constructor(t,a){super(t,"not-in",a),this.keys=ZP("not-in",a)}matches(t){return!this.keys.some((a=>a.isEqual(t.key)))}}function ZP(o,t){var a;return(((a=t.arrayValue)==null?void 0:a.values)||[]).map((u=>xi.fromName(u.referenceValue)))}class Ej extends Qa{constructor(t,a){super(t,"array-contains",a)}matches(t){const a=t.data.field(this.field);return dS(a)&&Ov(a.arrayValue,this.value)}}class Sj extends Qa{constructor(t,a){super(t,"in",a)}matches(t){const a=t.data.field(this.field);return a!==null&&Ov(this.value.arrayValue,a)}}class Aj extends Qa{constructor(t,a){super(t,"not-in",a)}matches(t){if(Ov(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=t.data.field(this.field);return a!==null&&a.nullValue===void 0&&!Ov(this.value.arrayValue,a)}}class Ij extends Qa{constructor(t,a){super(t,"array-contains-any",a)}matches(t){const a=t.data.field(this.field);return!(!dS(a)||!a.arrayValue.values)&&a.arrayValue.values.some((u=>Ov(this.value.arrayValue,u)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(t,a=null,u=[],y=[],T=null,C=null,s=null){this.path=t,this.collectionGroup=a,this.orderBy=u,this.filters=y,this.limit=T,this.startAt=C,this.endAt=s,this.Te=null}}function ER(o,t=null,a=[],u=[],y=null,T=null,C=null){return new Cj(o,t,a,u,y,T,C)}function fS(o){const t=Yi(o);if(t.Te===null){let a=t.path.canonicalString();t.collectionGroup!==null&&(a+="|cg:"+t.collectionGroup),a+="|f:",a+=t.filters.map((u=>hE(u))).join(","),a+="|ob:",a+=t.orderBy.map((u=>(function(T){return T.field.canonicalString()+T.dir})(u))).join(","),I1(t.limit)||(a+="|l:",a+=t.limit),t.startAt&&(a+="|lb:",a+=t.startAt.inclusive?"b:":"a:",a+=t.startAt.position.map((u=>Ny(u))).join(",")),t.endAt&&(a+="|ub:",a+=t.endAt.inclusive?"a:":"b:",a+=t.endAt.position.map((u=>Ny(u))).join(",")),t.Te=a}return t.Te}function pS(o,t){if(o.limit!==t.limit||o.orderBy.length!==t.orderBy.length)return!1;for(let a=0;a<o.orderBy.length;a++)if(!xj(o.orderBy[a],t.orderBy[a]))return!1;if(o.filters.length!==t.filters.length)return!1;for(let a=0;a<o.filters.length;a++)if(!HP(o.filters[a],t.filters[a]))return!1;return o.collectionGroup===t.collectionGroup&&!!o.path.isEqual(t.path)&&!!TR(o.startAt,t.startAt)&&TR(o.endAt,t.endAt)}function dE(o){return xi.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(t,a=null,u=[],y=[],T=null,C="F",s=null,V=null){this.path=t,this.collectionGroup=a,this.explicitOrderBy=u,this.filters=y,this.limit=T,this.limitType=C,this.startAt=s,this.endAt=V,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Rj(o,t,a,u,y,T,C,s){return new Yy(o,t,a,u,y,T,C,s)}function R1(o){return new Yy(o)}function SR(o){return o.filters.length===0&&o.limit===null&&o.startAt==null&&o.endAt==null&&(o.explicitOrderBy.length===0||o.explicitOrderBy.length===1&&o.explicitOrderBy[0].field.isKeyField())}function Mj(o){return xi.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}function WP(o){return o.collectionGroup!==null}function Tv(o){const t=Yi(o);if(t.Ie===null){t.Ie=[];const a=new Set;for(const T of t.explicitOrderBy)t.Ie.push(T),a.add(T.field.canonicalString());const u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(C){let s=new vo(ol.comparator);return C.filters.forEach((V=>{V.getFlattenedFilters().forEach((B=>{B.isInequality()&&(s=s.add(B.field))}))})),s})(t).forEach((T=>{a.has(T.canonicalString())||T.isKeyField()||t.Ie.push(new zv(T,u))})),a.has(ol.keyField().canonicalString())||t.Ie.push(new zv(ol.keyField(),u))}return t.Ie}function rf(o){const t=Yi(o);return t.Ee||(t.Ee=Dj(t,Tv(o))),t.Ee}function Dj(o,t){if(o.limitType==="F")return ER(o.path,o.collectionGroup,t,o.filters,o.limit,o.startAt,o.endAt);{t=t.map((y=>{const T=y.dir==="desc"?"asc":"desc";return new zv(y.field,T)}));const a=o.endAt?new l1(o.endAt.position,o.endAt.inclusive):null,u=o.startAt?new l1(o.startAt.position,o.startAt.inclusive):null;return ER(o.path,o.collectionGroup,t,o.filters,o.limit,a,u)}}function fE(o,t){const a=o.filters.concat([t]);return new Yy(o.path,o.collectionGroup,o.explicitOrderBy.slice(),a,o.limit,o.limitType,o.startAt,o.endAt)}function Pj(o,t){const a=o.explicitOrderBy.concat([t]);return new Yy(o.path,o.collectionGroup,a,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)}function pE(o,t,a){return new Yy(o.path,o.collectionGroup,o.explicitOrderBy.slice(),o.filters.slice(),t,a,o.startAt,o.endAt)}function M1(o,t){return pS(rf(o),rf(t))&&o.limitType===t.limitType}function XP(o){return`${fS(rf(o))}|lt:${o.limitType}`}function vy(o){return`Query(target=${(function(a){let u=a.path.canonicalString();return a.collectionGroup!==null&&(u+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(u+=`, filters: [${a.filters.map((y=>$P(y))).join(", ")}]`),I1(a.limit)||(u+=", limit: "+a.limit),a.orderBy.length>0&&(u+=`, orderBy: [${a.orderBy.map((y=>(function(C){return`${C.field.canonicalString()} (${C.dir})`})(y))).join(", ")}]`),a.startAt&&(u+=", startAt: ",u+=a.startAt.inclusive?"b:":"a:",u+=a.startAt.position.map((y=>Ny(y))).join(",")),a.endAt&&(u+=", endAt: ",u+=a.endAt.inclusive?"a:":"b:",u+=a.endAt.position.map((y=>Ny(y))).join(",")),`Target(${u})`})(rf(o))}; limitType=${o.limitType})`}function D1(o,t){return t.isFoundDocument()&&(function(u,y){const T=y.key.path;return u.collectionGroup!==null?y.key.hasCollectionId(u.collectionGroup)&&u.path.isPrefixOf(T):xi.isDocumentKey(u.path)?u.path.isEqual(T):u.path.isImmediateParentOf(T)})(o,t)&&(function(u,y){for(const T of Tv(u))if(!T.field.isKeyField()&&y.data.field(T.field)===null)return!1;return!0})(o,t)&&(function(u,y){for(const T of u.filters)if(!T.matches(y))return!1;return!0})(o,t)&&(function(u,y){return!(u.startAt&&!(function(C,s,V){const B=wR(C,s,V);return C.inclusive?B<=0:B<0})(u.startAt,Tv(u),y)||u.endAt&&!(function(C,s,V){const B=wR(C,s,V);return C.inclusive?B>=0:B>0})(u.endAt,Tv(u),y))})(o,t)}function kj(o){return o.collectionGroup||(o.path.length%2==1?o.path.lastSegment():o.path.get(o.path.length-2))}function YP(o){return(t,a)=>{let u=!1;for(const y of Tv(o)){const T=Lj(y,t,a);if(T!==0)return T;u=u||y.field.isKeyField()}return 0}}function Lj(o,t,a){const u=o.field.isKeyField()?xi.comparator(t.key,a.key):(function(T,C,s){const V=C.data.field(T),B=s.data.field(T);return V!==null&&B!==null?zy(V,B):zi(42886)})(o.field,t,a);switch(o.dir){case"asc":return u;case"desc":return-1*u;default:return zi(19790,{direction:o.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(t,a){this.mapKeyFn=t,this.equalsFn=a,this.inner={},this.innerSize=0}get(t){const a=this.mapKeyFn(t),u=this.inner[a];if(u!==void 0){for(const[y,T]of u)if(this.equalsFn(y,t))return T}}has(t){return this.get(t)!==void 0}set(t,a){const u=this.mapKeyFn(t),y=this.inner[u];if(y===void 0)return this.inner[u]=[[t,a]],void this.innerSize++;for(let T=0;T<y.length;T++)if(this.equalsFn(y[T][0],t))return void(y[T]=[t,a]);y.push([t,a]),this.innerSize++}delete(t){const a=this.mapKeyFn(t),u=this.inner[a];if(u===void 0)return!1;for(let y=0;y<u.length;y++)if(this.equalsFn(u[y][0],t))return u.length===1?delete this.inner[a]:u.splice(y,1),this.innerSize--,!0;return!1}forEach(t){d_(this.inner,((a,u)=>{for(const[y,T]of u)t(y,T)}))}isEmpty(){return kP(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oj=new fa(xi.comparator);function wp(){return Oj}const KP=new fa(xi.comparator);function gv(...o){let t=KP;for(const a of o)t=t.insert(a.key,a);return t}function QP(o){let t=KP;return o.forEach(((a,u)=>t=t.insert(a,u.overlayedDocument))),t}function i_(){return Ev()}function JP(){return Ev()}function Ev(){return new f_((o=>o.toString()),((o,t)=>o.isEqual(t)))}const zj=new fa(xi.comparator),Nj=new vo(xi.comparator);function Dr(...o){let t=Nj;for(const a of o)t=t.add(a);return t}const Bj=new vo(Mr);function Fj(){return Bj}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mS(o,t){if(o.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:s1(t)?"-0":t}}function ek(o){return{integerValue:""+o}}function Vj(o,t){return uj(t)?ek(t):mS(o,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(){this._=void 0}}function jj(o,t,a){return o instanceof Nv?(function(y,T){const C={fields:{[zP]:{stringValue:OP},[BP]:{timestampValue:{seconds:y.seconds,nanos:y.nanoseconds}}}};return T&&hS(T)&&(T=C1(T)),T&&(C.fields[NP]=T),{mapValue:C}})(a,t):o instanceof Bv?nk(o,t):o instanceof Fv?ik(o,t):(function(y,T){const C=tk(y,T),s=AR(C)+AR(y.Ae);return uE(C)&&uE(y.Ae)?ek(s):mS(y.serializer,s)})(o,t)}function Uj(o,t,a){return o instanceof Bv?nk(o,t):o instanceof Fv?ik(o,t):a}function tk(o,t){return o instanceof c1?(function(u){return uE(u)||(function(T){return!!T&&"doubleValue"in T})(u)})(t)?t:{integerValue:0}:null}class Nv extends P1{}class Bv extends P1{constructor(t){super(),this.elements=t}}function nk(o,t){const a=rk(t);for(const u of o.elements)a.some((y=>cf(y,u)))||a.push(u);return{arrayValue:{values:a}}}class Fv extends P1{constructor(t){super(),this.elements=t}}function ik(o,t){let a=rk(t);for(const u of o.elements)a=a.filter((y=>!cf(y,u)));return{arrayValue:{values:a}}}class c1 extends P1{constructor(t,a){super(),this.serializer=t,this.Ae=a}}function AR(o){return Na(o.integerValue||o.doubleValue)}function rk(o){return dS(o)&&o.arrayValue.values?o.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(t,a){this.field=t,this.transform=a}}function qj(o,t){return o.field.isEqual(t.field)&&(function(u,y){return u instanceof Bv&&y instanceof Bv||u instanceof Fv&&y instanceof Fv?Oy(u.elements,y.elements,cf):u instanceof c1&&y instanceof c1?cf(u.Ae,y.Ae):u instanceof Nv&&y instanceof Nv})(o.transform,t.transform)}class Hj{constructor(t,a){this.version=t,this.transformResults=a}}class sf{constructor(t,a){this.updateTime=t,this.exists=a}static none(){return new sf}static exists(t){return new sf(void 0,t)}static updateTime(t){return new sf(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Vb(o,t){return o.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(o.updateTime):o.exists===void 0||o.exists===t.isFoundDocument()}class k1{}function sk(o,t){if(!o.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return o.isNoDocument()?new ok(o.key,sf.none()):new Kv(o.key,o.data,sf.none());{const a=o.data,u=Qu.empty();let y=new vo(ol.comparator);for(let T of t.fields)if(!y.has(T)){let C=a.field(T);C===null&&T.length>1&&(T=T.popLast(),C=a.field(T)),C===null?u.delete(T):u.set(T,C),y=y.add(T)}return new p_(o.key,u,new Kh(y.toArray()),sf.none())}}function $j(o,t,a){o instanceof Kv?(function(y,T,C){const s=y.value.clone(),V=CR(y.fieldTransforms,T,C.transformResults);s.setAll(V),T.convertToFoundDocument(C.version,s).setHasCommittedMutations()})(o,t,a):o instanceof p_?(function(y,T,C){if(!Vb(y.precondition,T))return void T.convertToUnknownDocument(C.version);const s=CR(y.fieldTransforms,T,C.transformResults),V=T.data;V.setAll(ak(y)),V.setAll(s),T.convertToFoundDocument(C.version,V).setHasCommittedMutations()})(o,t,a):(function(y,T,C){T.convertToNoDocument(C.version).setHasCommittedMutations()})(0,t,a)}function Sv(o,t,a,u){return o instanceof Kv?(function(T,C,s,V){if(!Vb(T.precondition,C))return s;const B=T.value.clone(),W=RR(T.fieldTransforms,V,C);return B.setAll(W),C.convertToFoundDocument(C.version,B).setHasLocalMutations(),null})(o,t,a,u):o instanceof p_?(function(T,C,s,V){if(!Vb(T.precondition,C))return s;const B=RR(T.fieldTransforms,V,C),W=C.data;return W.setAll(ak(T)),W.setAll(B),C.convertToFoundDocument(C.version,W).setHasLocalMutations(),s===null?null:s.unionWith(T.fieldMask.fields).unionWith(T.fieldTransforms.map((Y=>Y.field)))})(o,t,a,u):(function(T,C,s){return Vb(T.precondition,C)?(C.convertToNoDocument(C.version).setHasLocalMutations(),null):s})(o,t,a)}function Zj(o,t){let a=null;for(const u of o.fieldTransforms){const y=t.data.field(u.field),T=tk(u.transform,y||null);T!=null&&(a===null&&(a=Qu.empty()),a.set(u.field,T))}return a||null}function IR(o,t){return o.type===t.type&&!!o.key.isEqual(t.key)&&!!o.precondition.isEqual(t.precondition)&&!!(function(u,y){return u===void 0&&y===void 0||!(!u||!y)&&Oy(u,y,((T,C)=>qj(T,C)))})(o.fieldTransforms,t.fieldTransforms)&&(o.type===0?o.value.isEqual(t.value):o.type!==1||o.data.isEqual(t.data)&&o.fieldMask.isEqual(t.fieldMask))}class Kv extends k1{constructor(t,a,u,y=[]){super(),this.key=t,this.value=a,this.precondition=u,this.fieldTransforms=y,this.type=0}getFieldMask(){return null}}class p_ extends k1{constructor(t,a,u,y,T=[]){super(),this.key=t,this.data=a,this.fieldMask=u,this.precondition=y,this.fieldTransforms=T,this.type=1}getFieldMask(){return this.fieldMask}}function ak(o){const t=new Map;return o.fieldMask.fields.forEach((a=>{if(!a.isEmpty()){const u=o.data.field(a);t.set(a,u)}})),t}function CR(o,t,a){const u=new Map;ps(o.length===a.length,32656,{Ve:a.length,de:o.length});for(let y=0;y<a.length;y++){const T=o[y],C=T.transform,s=t.data.field(T.field);u.set(T.field,Uj(C,s,a[y]))}return u}function RR(o,t,a){const u=new Map;for(const y of o){const T=y.transform,C=a.data.field(y.field);u.set(y.field,jj(T,C,t))}return u}class ok extends k1{constructor(t,a){super(),this.key=t,this.precondition=a,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wj extends k1{constructor(t,a){super(),this.key=t,this.precondition=a,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xj{constructor(t,a,u,y){this.batchId=t,this.localWriteTime=a,this.baseMutations=u,this.mutations=y}applyToRemoteDocument(t,a){const u=a.mutationResults;for(let y=0;y<this.mutations.length;y++){const T=this.mutations[y];T.key.isEqual(t.key)&&$j(T,t,u[y])}}applyToLocalView(t,a){for(const u of this.baseMutations)u.key.isEqual(t.key)&&(a=Sv(u,t,a,this.localWriteTime));for(const u of this.mutations)u.key.isEqual(t.key)&&(a=Sv(u,t,a,this.localWriteTime));return a}applyToLocalDocumentSet(t,a){const u=JP();return this.mutations.forEach((y=>{const T=t.get(y.key),C=T.overlayedDocument;let s=this.applyToLocalView(C,T.mutatedFields);s=a.has(y.key)?null:s;const V=sk(C,s);V!==null&&u.set(y.key,V),C.isValidDocument()||C.convertToNoDocument(Wi.min())})),u}keys(){return this.mutations.reduce(((t,a)=>t.add(a.key)),Dr())}isEqual(t){return this.batchId===t.batchId&&Oy(this.mutations,t.mutations,((a,u)=>IR(a,u)))&&Oy(this.baseMutations,t.baseMutations,((a,u)=>IR(a,u)))}}class gS{constructor(t,a,u,y){this.batch=t,this.commitVersion=a,this.mutationResults=u,this.docVersions=y}static from(t,a,u){ps(t.mutations.length===u.length,58842,{me:t.mutations.length,fe:u.length});let y=(function(){return zj})();const T=t.mutations;for(let C=0;C<T.length;C++)y=y.insert(T[C].key,u[C].version);return new gS(t,a,u,y)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yj{constructor(t,a){this.largestBatchId=t,this.mutation=a}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj{constructor(t,a){this.count=t,this.unchangedNames=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ya,Zr;function Qj(o){switch(o){case fn.OK:return zi(64938);case fn.CANCELLED:case fn.UNKNOWN:case fn.DEADLINE_EXCEEDED:case fn.RESOURCE_EXHAUSTED:case fn.INTERNAL:case fn.UNAVAILABLE:case fn.UNAUTHENTICATED:return!1;case fn.INVALID_ARGUMENT:case fn.NOT_FOUND:case fn.ALREADY_EXISTS:case fn.PERMISSION_DENIED:case fn.FAILED_PRECONDITION:case fn.ABORTED:case fn.OUT_OF_RANGE:case fn.UNIMPLEMENTED:case fn.DATA_LOSS:return!0;default:return zi(15467,{code:o})}}function lk(o){if(o===void 0)return bp("GRPC error has no .code"),fn.UNKNOWN;switch(o){case Ya.OK:return fn.OK;case Ya.CANCELLED:return fn.CANCELLED;case Ya.UNKNOWN:return fn.UNKNOWN;case Ya.DEADLINE_EXCEEDED:return fn.DEADLINE_EXCEEDED;case Ya.RESOURCE_EXHAUSTED:return fn.RESOURCE_EXHAUSTED;case Ya.INTERNAL:return fn.INTERNAL;case Ya.UNAVAILABLE:return fn.UNAVAILABLE;case Ya.UNAUTHENTICATED:return fn.UNAUTHENTICATED;case Ya.INVALID_ARGUMENT:return fn.INVALID_ARGUMENT;case Ya.NOT_FOUND:return fn.NOT_FOUND;case Ya.ALREADY_EXISTS:return fn.ALREADY_EXISTS;case Ya.PERMISSION_DENIED:return fn.PERMISSION_DENIED;case Ya.FAILED_PRECONDITION:return fn.FAILED_PRECONDITION;case Ya.ABORTED:return fn.ABORTED;case Ya.OUT_OF_RANGE:return fn.OUT_OF_RANGE;case Ya.UNIMPLEMENTED:return fn.UNIMPLEMENTED;case Ya.DATA_LOSS:return fn.DATA_LOSS;default:return zi(39323,{code:o})}}(Zr=Ya||(Ya={}))[Zr.OK=0]="OK",Zr[Zr.CANCELLED=1]="CANCELLED",Zr[Zr.UNKNOWN=2]="UNKNOWN",Zr[Zr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zr[Zr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zr[Zr.NOT_FOUND=5]="NOT_FOUND",Zr[Zr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zr[Zr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zr[Zr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zr[Zr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zr[Zr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zr[Zr.ABORTED=10]="ABORTED",Zr[Zr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zr[Zr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zr[Zr.INTERNAL=13]="INTERNAL",Zr[Zr.UNAVAILABLE=14]="UNAVAILABLE",Zr[Zr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eU=new Om([4294967295,4294967295],0);function MR(o){const t=Jj().encode(o),a=new wP;return a.update(t),new Uint8Array(a.digest())}function DR(o){const t=new DataView(o.buffer),a=t.getUint32(0,!0),u=t.getUint32(4,!0),y=t.getUint32(8,!0),T=t.getUint32(12,!0);return[new Om([a,u],0),new Om([y,T],0)]}class _S{constructor(t,a,u){if(this.bitmap=t,this.padding=a,this.hashCount=u,a<0||a>=8)throw new _v(`Invalid padding: ${a}`);if(u<0)throw new _v(`Invalid hash count: ${u}`);if(t.length>0&&this.hashCount===0)throw new _v(`Invalid hash count: ${u}`);if(t.length===0&&a!==0)throw new _v(`Invalid padding when bitmap length is 0: ${a}`);this.ge=8*t.length-a,this.pe=Om.fromNumber(this.ge)}ye(t,a,u){let y=t.add(a.multiply(Om.fromNumber(u)));return y.compare(eU)===1&&(y=new Om([y.getBits(0),y.getBits(1)],0)),y.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const a=MR(t),[u,y]=DR(a);for(let T=0;T<this.hashCount;T++){const C=this.ye(u,y,T);if(!this.we(C))return!1}return!0}static create(t,a,u){const y=t%8==0?0:8-t%8,T=new Uint8Array(Math.ceil(t/8)),C=new _S(T,y,a);return u.forEach((s=>C.insert(s))),C}insert(t){if(this.ge===0)return;const a=MR(t),[u,y]=DR(a);for(let T=0;T<this.hashCount;T++){const C=this.ye(u,y,T);this.be(C)}}be(t){const a=Math.floor(t/8),u=t%8;this.bitmap[a]|=1<<u}}class _v extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(t,a,u,y,T){this.snapshotVersion=t,this.targetChanges=a,this.targetMismatches=u,this.documentUpdates=y,this.resolvedLimboDocuments=T}static createSynthesizedRemoteEventForCurrentChange(t,a,u){const y=new Map;return y.set(t,Qv.createSynthesizedTargetChangeForCurrentChange(t,a,u)),new L1(Wi.min(),y,new fa(Mr),wp(),Dr())}}class Qv{constructor(t,a,u,y,T){this.resumeToken=t,this.current=a,this.addedDocuments=u,this.modifiedDocuments=y,this.removedDocuments=T}static createSynthesizedTargetChangeForCurrentChange(t,a,u){return new Qv(u,a,Dr(),Dr(),Dr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(t,a,u,y){this.Se=t,this.removedTargetIds=a,this.key=u,this.De=y}}class ck{constructor(t,a){this.targetId=t,this.Ce=a}}class uk{constructor(t,a,u=ll.EMPTY_BYTE_STRING,y=null){this.state=t,this.targetIds=a,this.resumeToken=u,this.cause=y}}class PR{constructor(){this.ve=0,this.Fe=kR(),this.Me=ll.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=Dr(),a=Dr(),u=Dr();return this.Fe.forEach(((y,T)=>{switch(T){case 0:t=t.add(y);break;case 2:a=a.add(y);break;case 1:u=u.add(y);break;default:zi(38017,{changeType:T})}})),new Qv(this.Me,this.xe,t,a,u)}Ke(){this.Oe=!1,this.Fe=kR()}qe(t,a){this.Oe=!0,this.Fe=this.Fe.insert(t,a)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,ps(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class tU{constructor(t){this.Ge=t,this.ze=new Map,this.je=wp(),this.He=Eb(),this.Je=Eb(),this.Ze=new fa(Mr)}Xe(t){for(const a of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(a,t.De):this.et(a,t.key,t.De);for(const a of t.removedTargetIds)this.et(a,t.key,t.De)}tt(t){this.forEachTarget(t,(a=>{const u=this.nt(a);switch(t.state){case 0:this.rt(a)&&u.Le(t.resumeToken);break;case 1:u.We(),u.Ne||u.Ke(),u.Le(t.resumeToken);break;case 2:u.We(),u.Ne||this.removeTarget(a);break;case 3:this.rt(a)&&(u.Qe(),u.Le(t.resumeToken));break;case 4:this.rt(a)&&(this.it(a),u.Le(t.resumeToken));break;default:zi(56790,{state:t.state})}}))}forEachTarget(t,a){t.targetIds.length>0?t.targetIds.forEach(a):this.ze.forEach(((u,y)=>{this.rt(y)&&a(y)}))}st(t){const a=t.targetId,u=t.Ce.count,y=this.ot(a);if(y){const T=y.target;if(dE(T))if(u===0){const C=new xi(T.path);this.et(a,C,Al.newNoDocument(C,Wi.min()))}else ps(u===1,20013,{expectedCount:u});else{const C=this._t(a);if(C!==u){const s=this.ut(t),V=s?this.ct(s,t,C):1;if(V!==0){this.it(a);const B=V===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(a,B)}}}}}ut(t){const a=t.Ce.unchangedNames;if(!a||!a.bits)return null;const{bits:{bitmap:u="",padding:y=0},hashCount:T=0}=a;let C,s;try{C=jm(u).toUint8Array()}catch(V){if(V instanceof LP)return Ly("Decoding the base64 bloom filter in existence filter failed ("+V.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw V}try{s=new _S(C,y,T)}catch(V){return Ly(V instanceof _v?"BloomFilter error: ":"Applying bloom filter failed: ",V),null}return s.ge===0?null:s}ct(t,a,u){return a.Ce.count===u-this.Pt(t,a.targetId)?0:2}Pt(t,a){const u=this.Ge.getRemoteKeysForTarget(a);let y=0;return u.forEach((T=>{const C=this.Ge.ht(),s=`projects/${C.projectId}/databases/${C.database}/documents/${T.path.canonicalString()}`;t.mightContain(s)||(this.et(a,T,null),y++)})),y}Tt(t){const a=new Map;this.ze.forEach(((T,C)=>{const s=this.ot(C);if(s){if(T.current&&dE(s.target)){const V=new xi(s.target.path);this.It(V).has(C)||this.Et(C,V)||this.et(C,V,Al.newNoDocument(V,t))}T.Be&&(a.set(C,T.ke()),T.Ke())}}));let u=Dr();this.Je.forEach(((T,C)=>{let s=!0;C.forEachWhile((V=>{const B=this.ot(V);return!B||B.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)})),s&&(u=u.add(T))})),this.je.forEach(((T,C)=>C.setReadTime(t)));const y=new L1(t,a,this.Ze,this.je,u);return this.je=wp(),this.He=Eb(),this.Je=Eb(),this.Ze=new fa(Mr),y}Ye(t,a){if(!this.rt(t))return;const u=this.Et(t,a.key)?2:0;this.nt(t).qe(a.key,u),this.je=this.je.insert(a.key,a),this.He=this.He.insert(a.key,this.It(a.key).add(t)),this.Je=this.Je.insert(a.key,this.Rt(a.key).add(t))}et(t,a,u){if(!this.rt(t))return;const y=this.nt(t);this.Et(t,a)?y.qe(a,1):y.Ue(a),this.Je=this.Je.insert(a,this.Rt(a).delete(t)),this.Je=this.Je.insert(a,this.Rt(a).add(t)),u&&(this.je=this.je.insert(a,u))}removeTarget(t){this.ze.delete(t)}_t(t){const a=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+a.addedDocuments.size-a.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let a=this.ze.get(t);return a||(a=new PR,this.ze.set(t,a)),a}Rt(t){let a=this.Je.get(t);return a||(a=new vo(Mr),this.Je=this.Je.insert(t,a)),a}It(t){let a=this.He.get(t);return a||(a=new vo(Mr),this.He=this.He.insert(t,a)),a}rt(t){const a=this.ot(t)!==null;return a||Xn("WatchChangeAggregator","Detected inactive target",t),a}ot(t){const a=this.ze.get(t);return a&&a.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new PR),this.Ge.getRemoteKeysForTarget(t).forEach((a=>{this.et(t,a,null)}))}Et(t,a){return this.Ge.getRemoteKeysForTarget(t).has(a)}}function Eb(){return new fa(xi.comparator)}function kR(){return new fa(xi.comparator)}const nU={asc:"ASCENDING",desc:"DESCENDING"},iU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rU={and:"AND",or:"OR"};class sU{constructor(t,a){this.databaseId=t,this.useProto3Json=a}}function mE(o,t){return o.useProto3Json||I1(t)?t:{value:t}}function u1(o,t){return o.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function hk(o,t){return o.useProto3Json?t.toBase64():t.toUint8Array()}function aU(o,t){return u1(o,t.toTimestamp())}function af(o){return ps(!!o,49232),Wi.fromTimestamp((function(a){const u=Vm(a);return new Ws(u.seconds,u.nanos)})(o))}function yS(o,t){return gE(o,t).canonicalString()}function gE(o,t){const a=(function(y){return new Ns(["projects",y.projectId,"databases",y.database])})(o).child("documents");return t===void 0?a:a.child(t)}function dk(o){const t=Ns.fromString(o);return ps(_k(t),10190,{key:t.toString()}),t}function _E(o,t){return yS(o.databaseId,t.path)}function CT(o,t){const a=dk(t);if(a.get(1)!==o.databaseId.projectId)throw new Zn(fn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+a.get(1)+" vs "+o.databaseId.projectId);if(a.get(3)!==o.databaseId.database)throw new Zn(fn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+a.get(3)+" vs "+o.databaseId.database);return new xi(pk(a))}function fk(o,t){return yS(o.databaseId,t)}function oU(o){const t=dk(o);return t.length===4?Ns.emptyPath():pk(t)}function yE(o){return new Ns(["projects",o.databaseId.projectId,"databases",o.databaseId.database]).canonicalString()}function pk(o){return ps(o.length>4&&o.get(4)==="documents",29091,{key:o.toString()}),o.popFirst(5)}function LR(o,t,a){return{name:_E(o,t),fields:a.value.mapValue.fields}}function lU(o,t){let a;if("targetChange"in t){t.targetChange;const u=(function(B){return B==="NO_CHANGE"?0:B==="ADD"?1:B==="REMOVE"?2:B==="CURRENT"?3:B==="RESET"?4:zi(39313,{state:B})})(t.targetChange.targetChangeType||"NO_CHANGE"),y=t.targetChange.targetIds||[],T=(function(B,W){return B.useProto3Json?(ps(W===void 0||typeof W=="string",58123),ll.fromBase64String(W||"")):(ps(W===void 0||W instanceof Buffer||W instanceof Uint8Array,16193),ll.fromUint8Array(W||new Uint8Array))})(o,t.targetChange.resumeToken),C=t.targetChange.cause,s=C&&(function(B){const W=B.code===void 0?fn.UNKNOWN:lk(B.code);return new Zn(W,B.message||"")})(C);a=new uk(u,y,T,s||null)}else if("documentChange"in t){t.documentChange;const u=t.documentChange;u.document,u.document.name,u.document.updateTime;const y=CT(o,u.document.name),T=af(u.document.updateTime),C=u.document.createTime?af(u.document.createTime):Wi.min(),s=new Qu({mapValue:{fields:u.document.fields}}),V=Al.newFoundDocument(y,T,C,s),B=u.targetIds||[],W=u.removedTargetIds||[];a=new jb(B,W,V.key,V)}else if("documentDelete"in t){t.documentDelete;const u=t.documentDelete;u.document;const y=CT(o,u.document),T=u.readTime?af(u.readTime):Wi.min(),C=Al.newNoDocument(y,T),s=u.removedTargetIds||[];a=new jb([],s,C.key,C)}else if("documentRemove"in t){t.documentRemove;const u=t.documentRemove;u.document;const y=CT(o,u.document),T=u.removedTargetIds||[];a=new jb([],T,y,null)}else{if(!("filter"in t))return zi(11601,{Vt:t});{t.filter;const u=t.filter;u.targetId;const{count:y=0,unchangedNames:T}=u,C=new Kj(y,T),s=u.targetId;a=new ck(s,C)}}return a}function cU(o,t){let a;if(t instanceof Kv)a={update:LR(o,t.key,t.value)};else if(t instanceof ok)a={delete:_E(o,t.key)};else if(t instanceof p_)a={update:LR(o,t.key,t.data),updateMask:yU(t.fieldMask)};else{if(!(t instanceof Wj))return zi(16599,{dt:t.type});a={verify:_E(o,t.key)}}return t.fieldTransforms.length>0&&(a.updateTransforms=t.fieldTransforms.map((u=>(function(T,C){const s=C.transform;if(s instanceof Nv)return{fieldPath:C.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Bv)return{fieldPath:C.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Fv)return{fieldPath:C.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof c1)return{fieldPath:C.field.canonicalString(),increment:s.Ae};throw zi(20930,{transform:C.transform})})(0,u)))),t.precondition.isNone||(a.currentDocument=(function(y,T){return T.updateTime!==void 0?{updateTime:aU(y,T.updateTime)}:T.exists!==void 0?{exists:T.exists}:zi(27497)})(o,t.precondition)),a}function uU(o,t){return o&&o.length>0?(ps(t!==void 0,14353),o.map((a=>(function(y,T){let C=y.updateTime?af(y.updateTime):af(T);return C.isEqual(Wi.min())&&(C=af(T)),new Hj(C,y.transformResults||[])})(a,t)))):[]}function hU(o,t){return{documents:[fk(o,t.path)]}}function dU(o,t){const a={structuredQuery:{}},u=t.path;let y;t.collectionGroup!==null?(y=u,a.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(y=u.popLast(),a.structuredQuery.from=[{collectionId:u.lastSegment()}]),a.parent=fk(o,y);const T=(function(B){if(B.length!==0)return gk(ed.create(B,"and"))})(t.filters);T&&(a.structuredQuery.where=T);const C=(function(B){if(B.length!==0)return B.map((W=>(function(ae){return{field:by(ae.field),direction:mU(ae.dir)}})(W)))})(t.orderBy);C&&(a.structuredQuery.orderBy=C);const s=mE(o,t.limit);return s!==null&&(a.structuredQuery.limit=s),t.startAt&&(a.structuredQuery.startAt=(function(B){return{before:B.inclusive,values:B.position}})(t.startAt)),t.endAt&&(a.structuredQuery.endAt=(function(B){return{before:!B.inclusive,values:B.position}})(t.endAt)),{ft:a,parent:y}}function fU(o){let t=oU(o.parent);const a=o.structuredQuery,u=a.from?a.from.length:0;let y=null;if(u>0){ps(u===1,65062);const W=a.from[0];W.allDescendants?y=W.collectionId:t=t.child(W.collectionId)}let T=[];a.where&&(T=(function(Y){const ae=mk(Y);return ae instanceof ed&&qP(ae)?ae.getFilters():[ae]})(a.where));let C=[];a.orderBy&&(C=(function(Y){return Y.map((ae=>(function(Qe){return new zv(wy(Qe.field),(function(Ke){switch(Ke){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(Qe.direction))})(ae)))})(a.orderBy));let s=null;a.limit&&(s=(function(Y){let ae;return ae=typeof Y=="object"?Y.value:Y,I1(ae)?null:ae})(a.limit));let V=null;a.startAt&&(V=(function(Y){const ae=!!Y.before,he=Y.values||[];return new l1(he,ae)})(a.startAt));let B=null;return a.endAt&&(B=(function(Y){const ae=!Y.before,he=Y.values||[];return new l1(he,ae)})(a.endAt)),Rj(t,y,C,T,s,"F",V,B)}function pU(o,t){const a=(function(y){switch(y){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return zi(28987,{purpose:y})}})(t.purpose);return a==null?null:{"goog-listen-tags":a}}function mk(o){return o.unaryFilter!==void 0?(function(a){switch(a.unaryFilter.op){case"IS_NAN":const u=wy(a.unaryFilter.field);return Qa.create(u,"==",{doubleValue:NaN});case"IS_NULL":const y=wy(a.unaryFilter.field);return Qa.create(y,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const T=wy(a.unaryFilter.field);return Qa.create(T,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const C=wy(a.unaryFilter.field);return Qa.create(C,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return zi(61313);default:return zi(60726)}})(o):o.fieldFilter!==void 0?(function(a){return Qa.create(wy(a.fieldFilter.field),(function(y){switch(y){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return zi(58110);default:return zi(50506)}})(a.fieldFilter.op),a.fieldFilter.value)})(o):o.compositeFilter!==void 0?(function(a){return ed.create(a.compositeFilter.filters.map((u=>mk(u))),(function(y){switch(y){case"AND":return"and";case"OR":return"or";default:return zi(1026)}})(a.compositeFilter.op))})(o):zi(30097,{filter:o})}function mU(o){return nU[o]}function gU(o){return iU[o]}function _U(o){return rU[o]}function by(o){return{fieldPath:o.canonicalString()}}function wy(o){return ol.fromServerFormat(o.fieldPath)}function gk(o){return o instanceof Qa?(function(a){if(a.op==="=="){if(bR(a.value))return{unaryFilter:{field:by(a.field),op:"IS_NAN"}};if(vR(a.value))return{unaryFilter:{field:by(a.field),op:"IS_NULL"}}}else if(a.op==="!="){if(bR(a.value))return{unaryFilter:{field:by(a.field),op:"IS_NOT_NAN"}};if(vR(a.value))return{unaryFilter:{field:by(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:by(a.field),op:gU(a.op),value:a.value}}})(o):o instanceof ed?(function(a){const u=a.getFilters().map((y=>gk(y)));return u.length===1?u[0]:{compositeFilter:{op:_U(a.op),filters:u}}})(o):zi(54877,{filter:o})}function yU(o){const t=[];return o.fields.forEach((a=>t.push(a.canonicalString()))),{fieldPaths:t}}function _k(o){return o.length>=4&&o.get(0)==="projects"&&o.get(2)==="databases"}function yk(o){return!!o&&typeof o._toProto=="function"&&o._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(t,a,u,y,T=Wi.min(),C=Wi.min(),s=ll.EMPTY_BYTE_STRING,V=null){this.target=t,this.targetId=a,this.purpose=u,this.sequenceNumber=y,this.snapshotVersion=T,this.lastLimboFreeSnapshotVersion=C,this.resumeToken=s,this.expectedCount=V}withSequenceNumber(t){return new Dm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,a){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,a,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xU{constructor(t){this.yt=t}}function vU(o){const t=fU({parent:o.parent,structuredQuery:o.structuredQuery});return o.limitType==="LAST"?pE(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(){this.Sn=new wU}addToCollectionParentIndex(t,a){return this.Sn.add(a),pn.resolve()}getCollectionParents(t,a){return pn.resolve(this.Sn.getEntries(a))}addFieldIndex(t,a){return pn.resolve()}deleteFieldIndex(t,a){return pn.resolve()}deleteAllFieldIndexes(t){return pn.resolve()}createTargetIndexes(t,a){return pn.resolve()}getDocumentsMatchingTarget(t,a){return pn.resolve(null)}getIndexType(t,a){return pn.resolve(0)}getFieldIndexes(t,a){return pn.resolve([])}getNextCollectionGroupToUpdate(t){return pn.resolve(null)}getMinOffset(t,a){return pn.resolve(Fm.min())}getMinOffsetFromCollectionGroup(t,a){return pn.resolve(Fm.min())}updateCollectionGroup(t,a,u){return pn.resolve()}updateIndexEntries(t,a){return pn.resolve()}}class wU{constructor(){this.index={}}add(t){const a=t.lastSegment(),u=t.popLast(),y=this.index[a]||new vo(Ns.comparator),T=!y.has(u);return this.index[a]=y.add(u),T}has(t){const a=t.lastSegment(),u=t.popLast(),y=this.index[a];return y&&y.has(u)}getEntries(t){return(this.index[t]||new vo(Ns.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},xk=41943040;class Dc{static withCacheSize(t){return new Dc(t,Dc.DEFAULT_COLLECTION_PERCENTILE,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,a,u){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=a,this.maximumSequenceNumbersToCollect=u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Dc.DEFAULT_COLLECTION_PERCENTILE=10,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Dc.DEFAULT=new Dc(xk,Dc.DEFAULT_COLLECTION_PERCENTILE,Dc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Dc.DISABLED=new Dc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new By(0)}static ar(){return new By(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR="LruGarbageCollector",TU=1048576;function NR([o,t],[a,u]){const y=Mr(o,a);return y===0?Mr(t,u):y}class EU{constructor(t){this.Pr=t,this.buffer=new vo(NR),this.Tr=0}Ir(){return++this.Tr}Er(t){const a=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(a);else{const u=this.buffer.last();NR(a,u)<0&&(this.buffer=this.buffer.delete(u).add(a))}}get maxValue(){return this.buffer.last()[0]}}class SU{constructor(t,a,u){this.garbageCollector=t,this.asyncQueue=a,this.localStore=u,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){Xn(zR,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){Xy(a)?Xn(zR,"Ignoring IndexedDB error during garbage collection: ",a):await Wy(a)}await this.Ar(3e5)}))}}class AU{constructor(t,a){this.Vr=t,this.params=a}calculateTargetCount(t,a){return this.Vr.dr(t).next((u=>Math.floor(a/100*u)))}nthSequenceNumber(t,a){if(a===0)return pn.resolve(A1.ce);const u=new EU(a);return this.Vr.forEachTarget(t,(y=>u.Er(y.sequenceNumber))).next((()=>this.Vr.mr(t,(y=>u.Er(y))))).next((()=>u.maxValue))}removeTargets(t,a,u){return this.Vr.removeTargets(t,a,u)}removeOrphanedDocuments(t,a){return this.Vr.removeOrphanedDocuments(t,a)}collect(t,a){return this.params.cacheSizeCollectionThreshold===-1?(Xn("LruGarbageCollector","Garbage collection skipped; disabled"),pn.resolve(OR)):this.getCacheSize(t).next((u=>u<this.params.cacheSizeCollectionThreshold?(Xn("LruGarbageCollector",`Garbage collection skipped; Cache size ${u} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),OR):this.gr(t,a)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,a){let u,y,T,C,s,V,B;const W=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((Y=>(Y>this.params.maximumSequenceNumbersToCollect?(Xn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${Y}`),y=this.params.maximumSequenceNumbersToCollect):y=Y,C=Date.now(),this.nthSequenceNumber(t,y)))).next((Y=>(u=Y,s=Date.now(),this.removeTargets(t,u,a)))).next((Y=>(T=Y,V=Date.now(),this.removeOrphanedDocuments(t,u)))).next((Y=>(B=Date.now(),xy()<=Rr.DEBUG&&Xn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${C-W}ms
	Determined least recently used ${y} in `+(s-C)+`ms
	Removed ${T} targets in `+(V-s)+`ms
	Removed ${Y} documents in `+(B-V)+`ms
Total Duration: ${B-W}ms`),pn.resolve({didRun:!0,sequenceNumbersCollected:y,targetsRemoved:T,documentsRemoved:Y}))))}}function IU(o,t){return new AU(o,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(){this.changes=new f_((t=>t.toString()),((t,a)=>t.isEqual(a))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,a){this.assertNotApplied(),this.changes.set(t,Al.newInvalidDocument(t).setReadTime(a))}getEntry(t,a){this.assertNotApplied();const u=this.changes.get(a);return u!==void 0?pn.resolve(u):this.getFromCache(t,a)}getEntries(t,a){return this.getAllFromCache(t,a)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(t,a){this.overlayedDocument=t,this.mutatedFields=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(t,a,u,y){this.remoteDocumentCache=t,this.mutationQueue=a,this.documentOverlayCache=u,this.indexManager=y}getDocument(t,a){let u=null;return this.documentOverlayCache.getOverlay(t,a).next((y=>(u=y,this.remoteDocumentCache.getEntry(t,a)))).next((y=>(u!==null&&Sv(u.mutation,y,Kh.empty(),Ws.now()),y)))}getDocuments(t,a){return this.remoteDocumentCache.getEntries(t,a).next((u=>this.getLocalViewOfDocuments(t,u,Dr()).next((()=>u))))}getLocalViewOfDocuments(t,a,u=Dr()){const y=i_();return this.populateOverlays(t,y,a).next((()=>this.computeViews(t,a,y,u).next((T=>{let C=gv();return T.forEach(((s,V)=>{C=C.insert(s,V.overlayedDocument)})),C}))))}getOverlayedDocuments(t,a){const u=i_();return this.populateOverlays(t,u,a).next((()=>this.computeViews(t,a,u,Dr())))}populateOverlays(t,a,u){const y=[];return u.forEach((T=>{a.has(T)||y.push(T)})),this.documentOverlayCache.getOverlays(t,y).next((T=>{T.forEach(((C,s)=>{a.set(C,s)}))}))}computeViews(t,a,u,y){let T=wp();const C=Ev(),s=(function(){return Ev()})();return a.forEach(((V,B)=>{const W=u.get(B.key);y.has(B.key)&&(W===void 0||W.mutation instanceof p_)?T=T.insert(B.key,B):W!==void 0?(C.set(B.key,W.mutation.getFieldMask()),Sv(W.mutation,B,W.mutation.getFieldMask(),Ws.now())):C.set(B.key,Kh.empty())})),this.recalculateAndSaveOverlays(t,T).next((V=>(V.forEach(((B,W)=>C.set(B,W))),a.forEach(((B,W)=>s.set(B,new RU(W,C.get(B)??null)))),s)))}recalculateAndSaveOverlays(t,a){const u=Ev();let y=new fa(((C,s)=>C-s)),T=Dr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,a).next((C=>{for(const s of C)s.keys().forEach((V=>{const B=a.get(V);if(B===null)return;let W=u.get(V)||Kh.empty();W=s.applyToLocalView(B,W),u.set(V,W);const Y=(y.get(s.batchId)||Dr()).add(V);y=y.insert(s.batchId,Y)}))})).next((()=>{const C=[],s=y.getReverseIterator();for(;s.hasNext();){const V=s.getNext(),B=V.key,W=V.value,Y=JP();W.forEach((ae=>{if(!T.has(ae)){const he=sk(a.get(ae),u.get(ae));he!==null&&Y.set(ae,he),T=T.add(ae)}})),C.push(this.documentOverlayCache.saveOverlays(t,B,Y))}return pn.waitFor(C)})).next((()=>u))}recalculateAndSaveOverlaysForDocumentKeys(t,a){return this.remoteDocumentCache.getEntries(t,a).next((u=>this.recalculateAndSaveOverlays(t,u)))}getDocumentsMatchingQuery(t,a,u,y){return Mj(a)?this.getDocumentsMatchingDocumentQuery(t,a.path):WP(a)?this.getDocumentsMatchingCollectionGroupQuery(t,a,u,y):this.getDocumentsMatchingCollectionQuery(t,a,u,y)}getNextDocuments(t,a,u,y){return this.remoteDocumentCache.getAllFromCollectionGroup(t,a,u,y).next((T=>{const C=y-T.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,a,u.largestBatchId,y-T.size):pn.resolve(i_());let s=Pv,V=T;return C.next((B=>pn.forEach(B,((W,Y)=>(s<Y.largestBatchId&&(s=Y.largestBatchId),T.get(W)?pn.resolve():this.remoteDocumentCache.getEntry(t,W).next((ae=>{V=V.insert(W,ae)}))))).next((()=>this.populateOverlays(t,B,T))).next((()=>this.computeViews(t,V,B,Dr()))).next((W=>({batchId:s,changes:QP(W)})))))}))}getDocumentsMatchingDocumentQuery(t,a){return this.getDocument(t,new xi(a)).next((u=>{let y=gv();return u.isFoundDocument()&&(y=y.insert(u.key,u)),y}))}getDocumentsMatchingCollectionGroupQuery(t,a,u,y){const T=a.collectionGroup;let C=gv();return this.indexManager.getCollectionParents(t,T).next((s=>pn.forEach(s,(V=>{const B=(function(Y,ae){return new Yy(ae,null,Y.explicitOrderBy.slice(),Y.filters.slice(),Y.limit,Y.limitType,Y.startAt,Y.endAt)})(a,V.child(T));return this.getDocumentsMatchingCollectionQuery(t,B,u,y).next((W=>{W.forEach(((Y,ae)=>{C=C.insert(Y,ae)}))}))})).next((()=>C))))}getDocumentsMatchingCollectionQuery(t,a,u,y){let T;return this.documentOverlayCache.getOverlaysForCollection(t,a.path,u.largestBatchId).next((C=>(T=C,this.remoteDocumentCache.getDocumentsMatchingQuery(t,a,u,T,y)))).next((C=>{T.forEach(((V,B)=>{const W=B.getKey();C.get(W)===null&&(C=C.insert(W,Al.newInvalidDocument(W)))}));let s=gv();return C.forEach(((V,B)=>{const W=T.get(V);W!==void 0&&Sv(W.mutation,B,Kh.empty(),Ws.now()),D1(a,B)&&(s=s.insert(V,B))})),s}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,a){return pn.resolve(this.Nr.get(a))}saveBundleMetadata(t,a){return this.Nr.set(a.id,(function(y){return{id:y.id,version:y.version,createTime:af(y.createTime)}})(a)),pn.resolve()}getNamedQuery(t,a){return pn.resolve(this.Br.get(a))}saveNamedQuery(t,a){return this.Br.set(a.name,(function(y){return{name:y.name,query:vU(y.bundledQuery),readTime:af(y.readTime)}})(a)),pn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU{constructor(){this.overlays=new fa(xi.comparator),this.Lr=new Map}getOverlay(t,a){return pn.resolve(this.overlays.get(a))}getOverlays(t,a){const u=i_();return pn.forEach(a,(y=>this.getOverlay(t,y).next((T=>{T!==null&&u.set(y,T)})))).next((()=>u))}saveOverlays(t,a,u){return u.forEach(((y,T)=>{this.bt(t,a,T)})),pn.resolve()}removeOverlaysForBatchId(t,a,u){const y=this.Lr.get(u);return y!==void 0&&(y.forEach((T=>this.overlays=this.overlays.remove(T))),this.Lr.delete(u)),pn.resolve()}getOverlaysForCollection(t,a,u){const y=i_(),T=a.length+1,C=new xi(a.child("")),s=this.overlays.getIteratorFrom(C);for(;s.hasNext();){const V=s.getNext().value,B=V.getKey();if(!a.isPrefixOf(B.path))break;B.path.length===T&&V.largestBatchId>u&&y.set(V.getKey(),V)}return pn.resolve(y)}getOverlaysForCollectionGroup(t,a,u,y){let T=new fa(((B,W)=>B-W));const C=this.overlays.getIterator();for(;C.hasNext();){const B=C.getNext().value;if(B.getKey().getCollectionGroup()===a&&B.largestBatchId>u){let W=T.get(B.largestBatchId);W===null&&(W=i_(),T=T.insert(B.largestBatchId,W)),W.set(B.getKey(),B)}}const s=i_(),V=T.getIterator();for(;V.hasNext()&&(V.getNext().value.forEach(((B,W)=>s.set(B,W))),!(s.size()>=y)););return pn.resolve(s)}bt(t,a,u){const y=this.overlays.get(u.key);if(y!==null){const C=this.Lr.get(y.largestBatchId).delete(u.key);this.Lr.set(y.largestBatchId,C)}this.overlays=this.overlays.insert(u.key,new Yj(a,u));let T=this.Lr.get(a);T===void 0&&(T=Dr(),this.Lr.set(a,T)),this.Lr.set(a,T.add(u.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(){this.sessionToken=ll.EMPTY_BYTE_STRING}getSessionToken(t){return pn.resolve(this.sessionToken)}setSessionToken(t,a){return this.sessionToken=a,pn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(){this.kr=new vo(Ho.Kr),this.qr=new vo(Ho.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,a){const u=new Ho(t,a);this.kr=this.kr.add(u),this.qr=this.qr.add(u)}$r(t,a){t.forEach((u=>this.addReference(u,a)))}removeReference(t,a){this.Wr(new Ho(t,a))}Qr(t,a){t.forEach((u=>this.removeReference(u,a)))}Gr(t){const a=new xi(new Ns([])),u=new Ho(a,t),y=new Ho(a,t+1),T=[];return this.qr.forEachInRange([u,y],(C=>{this.Wr(C),T.push(C.key)})),T}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const a=new xi(new Ns([])),u=new Ho(a,t),y=new Ho(a,t+1);let T=Dr();return this.qr.forEachInRange([u,y],(C=>{T=T.add(C.key)})),T}containsKey(t){const a=new Ho(t,0),u=this.kr.firstAfterOrEqual(a);return u!==null&&t.isEqual(u.key)}}class Ho{constructor(t,a){this.key=t,this.Hr=a}static Kr(t,a){return xi.comparator(t.key,a.key)||Mr(t.Hr,a.Hr)}static Ur(t,a){return Mr(t.Hr,a.Hr)||xi.comparator(t.key,a.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{constructor(t,a){this.indexManager=t,this.referenceDelegate=a,this.mutationQueue=[],this.Yn=1,this.Jr=new vo(Ho.Kr)}checkEmpty(t){return pn.resolve(this.mutationQueue.length===0)}addMutationBatch(t,a,u,y){const T=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const C=new Xj(T,a,u,y);this.mutationQueue.push(C);for(const s of y)this.Jr=this.Jr.add(new Ho(s.key,T)),this.indexManager.addToCollectionParentIndex(t,s.key.path.popLast());return pn.resolve(C)}lookupMutationBatch(t,a){return pn.resolve(this.Zr(a))}getNextMutationBatchAfterBatchId(t,a){const u=a+1,y=this.Xr(u),T=y<0?0:y;return pn.resolve(this.mutationQueue.length>T?this.mutationQueue[T]:null)}getHighestUnacknowledgedBatchId(){return pn.resolve(this.mutationQueue.length===0?uS:this.Yn-1)}getAllMutationBatches(t){return pn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,a){const u=new Ho(a,0),y=new Ho(a,Number.POSITIVE_INFINITY),T=[];return this.Jr.forEachInRange([u,y],(C=>{const s=this.Zr(C.Hr);T.push(s)})),pn.resolve(T)}getAllMutationBatchesAffectingDocumentKeys(t,a){let u=new vo(Mr);return a.forEach((y=>{const T=new Ho(y,0),C=new Ho(y,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([T,C],(s=>{u=u.add(s.Hr)}))})),pn.resolve(this.Yr(u))}getAllMutationBatchesAffectingQuery(t,a){const u=a.path,y=u.length+1;let T=u;xi.isDocumentKey(T)||(T=T.child(""));const C=new Ho(new xi(T),0);let s=new vo(Mr);return this.Jr.forEachWhile((V=>{const B=V.key.path;return!!u.isPrefixOf(B)&&(B.length===y&&(s=s.add(V.Hr)),!0)}),C),pn.resolve(this.Yr(s))}Yr(t){const a=[];return t.forEach((u=>{const y=this.Zr(u);y!==null&&a.push(y)})),a}removeMutationBatch(t,a){ps(this.ei(a.batchId,"removed")===0,55003),this.mutationQueue.shift();let u=this.Jr;return pn.forEach(a.mutations,(y=>{const T=new Ho(y.key,a.batchId);return u=u.delete(T),this.referenceDelegate.markPotentiallyOrphaned(t,y.key)})).next((()=>{this.Jr=u}))}nr(t){}containsKey(t,a){const u=new Ho(a,0),y=this.Jr.firstAfterOrEqual(u);return pn.resolve(a.isEqual(y&&y.key))}performConsistencyCheck(t){return this.mutationQueue.length,pn.resolve()}ei(t,a){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const a=this.Xr(t);return a<0||a>=this.mutationQueue.length?null:this.mutationQueue[a]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OU{constructor(t){this.ti=t,this.docs=(function(){return new fa(xi.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,a){const u=a.key,y=this.docs.get(u),T=y?y.size:0,C=this.ti(a);return this.docs=this.docs.insert(u,{document:a.mutableCopy(),size:C}),this.size+=C-T,this.indexManager.addToCollectionParentIndex(t,u.path.popLast())}removeEntry(t){const a=this.docs.get(t);a&&(this.docs=this.docs.remove(t),this.size-=a.size)}getEntry(t,a){const u=this.docs.get(a);return pn.resolve(u?u.document.mutableCopy():Al.newInvalidDocument(a))}getEntries(t,a){let u=wp();return a.forEach((y=>{const T=this.docs.get(y);u=u.insert(y,T?T.document.mutableCopy():Al.newInvalidDocument(y))})),pn.resolve(u)}getDocumentsMatchingQuery(t,a,u,y){let T=wp();const C=a.path,s=new xi(C.child("__id-9223372036854775808__")),V=this.docs.getIteratorFrom(s);for(;V.hasNext();){const{key:B,value:{document:W}}=V.getNext();if(!C.isPrefixOf(B.path))break;B.path.length>C.length+1||aj(sj(W),u)<=0||(y.has(W.key)||D1(a,W))&&(T=T.insert(W.key,W.mutableCopy()))}return pn.resolve(T)}getAllFromCollectionGroup(t,a,u,y){zi(9500)}ni(t,a){return pn.forEach(this.docs,(u=>a(u)))}newChangeBuffer(t){return new zU(this)}getSize(t){return pn.resolve(this.size)}}class zU extends CU{constructor(t){super(),this.Mr=t}applyChanges(t){const a=[];return this.changes.forEach(((u,y)=>{y.isValidDocument()?a.push(this.Mr.addEntry(t,y)):this.Mr.removeEntry(u)})),pn.waitFor(a)}getFromCache(t,a){return this.Mr.getEntry(t,a)}getAllFromCache(t,a){return this.Mr.getEntries(t,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(t){this.persistence=t,this.ri=new f_((a=>fS(a)),pS),this.lastRemoteSnapshotVersion=Wi.min(),this.highestTargetId=0,this.ii=0,this.si=new xS,this.targetCount=0,this.oi=By._r()}forEachTarget(t,a){return this.ri.forEach(((u,y)=>a(y))),pn.resolve()}getLastRemoteSnapshotVersion(t){return pn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return pn.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),pn.resolve(this.highestTargetId)}setTargetsMetadata(t,a,u){return u&&(this.lastRemoteSnapshotVersion=u),a>this.ii&&(this.ii=a),pn.resolve()}lr(t){this.ri.set(t.target,t);const a=t.targetId;a>this.highestTargetId&&(this.oi=new By(a),this.highestTargetId=a),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,a){return this.lr(a),this.targetCount+=1,pn.resolve()}updateTargetData(t,a){return this.lr(a),pn.resolve()}removeTargetData(t,a){return this.ri.delete(a.target),this.si.Gr(a.targetId),this.targetCount-=1,pn.resolve()}removeTargets(t,a,u){let y=0;const T=[];return this.ri.forEach(((C,s)=>{s.sequenceNumber<=a&&u.get(s.targetId)===null&&(this.ri.delete(C),T.push(this.removeMatchingKeysForTargetId(t,s.targetId)),y++)})),pn.waitFor(T).next((()=>y))}getTargetCount(t){return pn.resolve(this.targetCount)}getTargetData(t,a){const u=this.ri.get(a)||null;return pn.resolve(u)}addMatchingKeys(t,a,u){return this.si.$r(a,u),pn.resolve()}removeMatchingKeys(t,a,u){this.si.Qr(a,u);const y=this.persistence.referenceDelegate,T=[];return y&&a.forEach((C=>{T.push(y.markPotentiallyOrphaned(t,C))})),pn.waitFor(T)}removeMatchingKeysForTargetId(t,a){return this.si.Gr(a),pn.resolve()}getMatchingKeysForTargetId(t,a){const u=this.si.jr(a);return pn.resolve(u)}containsKey(t,a){return pn.resolve(this.si.containsKey(a))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(t,a){this._i={},this.overlays={},this.ai=new A1(0),this.ui=!1,this.ui=!0,this.ci=new kU,this.referenceDelegate=t(this),this.li=new NU(this),this.indexManager=new bU,this.remoteDocumentCache=(function(y){return new OU(y)})((u=>this.referenceDelegate.hi(u))),this.serializer=new xU(a),this.Pi=new DU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let a=this.overlays[t.toKey()];return a||(a=new PU,this.overlays[t.toKey()]=a),a}getMutationQueue(t,a){let u=this._i[t.toKey()];return u||(u=new LU(a,this.referenceDelegate),this._i[t.toKey()]=u),u}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,a,u){Xn("MemoryPersistence","Starting transaction:",t);const y=new BU(this.ai.next());return this.referenceDelegate.Ti(),u(y).next((T=>this.referenceDelegate.Ii(y).next((()=>T)))).toPromise().then((T=>(y.raiseOnCommittedEvent(),T)))}Ei(t,a){return pn.or(Object.values(this._i).map((u=>()=>u.containsKey(t,a))))}}class BU extends lj{constructor(t){super(),this.currentSequenceNumber=t}}class vS{constructor(t){this.persistence=t,this.Ri=new xS,this.Ai=null}static Vi(t){return new vS(t)}get di(){if(this.Ai)return this.Ai;throw zi(60996)}addReference(t,a,u){return this.Ri.addReference(u,a),this.di.delete(u.toString()),pn.resolve()}removeReference(t,a,u){return this.Ri.removeReference(u,a),this.di.add(u.toString()),pn.resolve()}markPotentiallyOrphaned(t,a){return this.di.add(a.toString()),pn.resolve()}removeTarget(t,a){this.Ri.Gr(a.targetId).forEach((y=>this.di.add(y.toString())));const u=this.persistence.getTargetCache();return u.getMatchingKeysForTargetId(t,a.targetId).next((y=>{y.forEach((T=>this.di.add(T.toString())))})).next((()=>u.removeTargetData(t,a)))}Ti(){this.Ai=new Set}Ii(t){const a=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pn.forEach(this.di,(u=>{const y=xi.fromPath(u);return this.mi(t,y).next((T=>{T||a.removeEntry(y,Wi.min())}))})).next((()=>(this.Ai=null,a.apply(t))))}updateLimboDocument(t,a){return this.mi(t,a).next((u=>{u?this.di.delete(a.toString()):this.di.add(a.toString())}))}hi(t){return 0}mi(t,a){return pn.or([()=>pn.resolve(this.Ri.containsKey(a)),()=>this.persistence.getTargetCache().containsKey(t,a),()=>this.persistence.Ei(t,a)])}}class h1{constructor(t,a){this.persistence=t,this.fi=new f_((u=>hj(u.path)),((u,y)=>u.isEqual(y))),this.garbageCollector=IU(this,a)}static Vi(t,a){return new h1(t,a)}Ti(){}Ii(t){return pn.resolve()}forEachTarget(t,a){return this.persistence.getTargetCache().forEachTarget(t,a)}dr(t){const a=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((u=>a.next((y=>u+y))))}pr(t){let a=0;return this.mr(t,(u=>{a++})).next((()=>a))}mr(t,a){return pn.forEach(this.fi,((u,y)=>this.wr(t,u,y).next((T=>T?pn.resolve():a(y)))))}removeTargets(t,a,u){return this.persistence.getTargetCache().removeTargets(t,a,u)}removeOrphanedDocuments(t,a){let u=0;const y=this.persistence.getRemoteDocumentCache(),T=y.newChangeBuffer();return y.ni(t,(C=>this.wr(t,C,a).next((s=>{s||(u++,T.removeEntry(C,Wi.min()))})))).next((()=>T.apply(t))).next((()=>u))}markPotentiallyOrphaned(t,a){return this.fi.set(a,t.currentSequenceNumber),pn.resolve()}removeTarget(t,a){const u=a.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,u)}addReference(t,a,u){return this.fi.set(u,t.currentSequenceNumber),pn.resolve()}removeReference(t,a,u){return this.fi.set(u,t.currentSequenceNumber),pn.resolve()}updateLimboDocument(t,a){return this.fi.set(a,t.currentSequenceNumber),pn.resolve()}hi(t){let a=t.key.toString().length;return t.isFoundDocument()&&(a+=Bb(t.data.value)),a}wr(t,a,u){return pn.or([()=>this.persistence.Ei(t,a),()=>this.persistence.getTargetCache().containsKey(t,a),()=>{const y=this.fi.get(a);return pn.resolve(y!==void 0&&y>u)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(t,a,u,y){this.targetId=t,this.fromCache=a,this.Ts=u,this.Is=y}static Es(t,a){let u=Dr(),y=Dr();for(const T of a.docChanges)switch(T.type){case 0:u=u.add(T.doc.key);break;case 1:y=y.add(T.doc.key)}return new bS(t,a.fromCache,u,y)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return SF()?8:cj(Il())>0?6:4})()}initialize(t,a){this.fs=t,this.indexManager=a,this.Rs=!0}getDocumentsMatchingQuery(t,a,u,y){const T={result:null};return this.gs(t,a).next((C=>{T.result=C})).next((()=>{if(!T.result)return this.ps(t,a,y,u).next((C=>{T.result=C}))})).next((()=>{if(T.result)return;const C=new FU;return this.ys(t,a,C).next((s=>{if(T.result=s,this.As)return this.ws(t,a,C,s.size)}))})).next((()=>T.result))}ws(t,a,u,y){return u.documentReadCount<this.Vs?(xy()<=Rr.DEBUG&&Xn("QueryEngine","SDK will not create cache indexes for query:",vy(a),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),pn.resolve()):(xy()<=Rr.DEBUG&&Xn("QueryEngine","Query:",vy(a),"scans",u.documentReadCount,"local documents and returns",y,"documents as results."),u.documentReadCount>this.ds*y?(xy()<=Rr.DEBUG&&Xn("QueryEngine","The SDK decides to create cache indexes for query:",vy(a),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,rf(a))):pn.resolve())}gs(t,a){if(SR(a))return pn.resolve(null);let u=rf(a);return this.indexManager.getIndexType(t,u).next((y=>y===0?null:(a.limit!==null&&y===1&&(a=pE(a,null,"F"),u=rf(a)),this.indexManager.getDocumentsMatchingTarget(t,u).next((T=>{const C=Dr(...T);return this.fs.getDocuments(t,C).next((s=>this.indexManager.getMinOffset(t,u).next((V=>{const B=this.bs(a,s);return this.Ss(a,B,C,V.readTime)?this.gs(t,pE(a,null,"F")):this.Ds(t,B,a,V)}))))})))))}ps(t,a,u,y){return SR(a)||y.isEqual(Wi.min())?pn.resolve(null):this.fs.getDocuments(t,u).next((T=>{const C=this.bs(a,T);return this.Ss(a,C,u,y)?pn.resolve(null):(xy()<=Rr.DEBUG&&Xn("QueryEngine","Re-using previous result from %s to execute query: %s",y.toString(),vy(a)),this.Ds(t,C,a,rj(y,Pv)).next((s=>s)))}))}bs(t,a){let u=new vo(YP(t));return a.forEach(((y,T)=>{D1(t,T)&&(u=u.add(T))})),u}Ss(t,a,u,y){if(t.limit===null)return!1;if(u.size!==a.size)return!0;const T=t.limitType==="F"?a.last():a.first();return!!T&&(T.hasPendingWrites||T.version.compareTo(y)>0)}ys(t,a,u){return xy()<=Rr.DEBUG&&Xn("QueryEngine","Using full collection scan to execute query:",vy(a)),this.fs.getDocumentsMatchingQuery(t,a,Fm.min(),u)}Ds(t,a,u,y){return this.fs.getDocumentsMatchingQuery(t,u,y).next((T=>(a.forEach((C=>{T=T.insert(C.key,C)})),T)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wS="LocalStore",jU=3e8;class UU{constructor(t,a,u,y){this.persistence=t,this.Cs=a,this.serializer=y,this.vs=new fa(Mr),this.Fs=new f_((T=>fS(T)),pS),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(u)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new MU(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(a=>t.collect(a,this.vs)))}}function GU(o,t,a,u){return new UU(o,t,a,u)}async function bk(o,t){const a=Yi(o);return await a.persistence.runTransaction("Handle user change","readonly",(u=>{let y;return a.mutationQueue.getAllMutationBatches(u).next((T=>(y=T,a.Os(t),a.mutationQueue.getAllMutationBatches(u)))).next((T=>{const C=[],s=[];let V=Dr();for(const B of y){C.push(B.batchId);for(const W of B.mutations)V=V.add(W.key)}for(const B of T){s.push(B.batchId);for(const W of B.mutations)V=V.add(W.key)}return a.localDocuments.getDocuments(u,V).next((B=>({Ns:B,removedBatchIds:C,addedBatchIds:s})))}))}))}function qU(o,t){const a=Yi(o);return a.persistence.runTransaction("Acknowledge batch","readwrite-primary",(u=>{const y=t.batch.keys(),T=a.xs.newChangeBuffer({trackRemovals:!0});return(function(s,V,B,W){const Y=B.batch,ae=Y.keys();let he=pn.resolve();return ae.forEach((Qe=>{he=he.next((()=>W.getEntry(V,Qe))).next((Ye=>{const Ke=B.docVersions.get(Qe);ps(Ke!==null,48541),Ye.version.compareTo(Ke)<0&&(Y.applyToRemoteDocument(Ye,B),Ye.isValidDocument()&&(Ye.setReadTime(B.commitVersion),W.addEntry(Ye)))}))})),he.next((()=>s.mutationQueue.removeMutationBatch(V,Y)))})(a,u,t,T).next((()=>T.apply(u))).next((()=>a.mutationQueue.performConsistencyCheck(u))).next((()=>a.documentOverlayCache.removeOverlaysForBatchId(u,y,t.batch.batchId))).next((()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,(function(s){let V=Dr();for(let B=0;B<s.mutationResults.length;++B)s.mutationResults[B].transformResults.length>0&&(V=V.add(s.batch.mutations[B].key));return V})(t)))).next((()=>a.localDocuments.getDocuments(u,y)))}))}function wk(o){const t=Yi(o);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(a=>t.li.getLastRemoteSnapshotVersion(a)))}function HU(o,t){const a=Yi(o),u=t.snapshotVersion;let y=a.vs;return a.persistence.runTransaction("Apply remote event","readwrite-primary",(T=>{const C=a.xs.newChangeBuffer({trackRemovals:!0});y=a.vs;const s=[];t.targetChanges.forEach(((W,Y)=>{const ae=y.get(Y);if(!ae)return;s.push(a.li.removeMatchingKeys(T,W.removedDocuments,Y).next((()=>a.li.addMatchingKeys(T,W.addedDocuments,Y))));let he=ae.withSequenceNumber(T.currentSequenceNumber);t.targetMismatches.get(Y)!==null?he=he.withResumeToken(ll.EMPTY_BYTE_STRING,Wi.min()).withLastLimboFreeSnapshotVersion(Wi.min()):W.resumeToken.approximateByteSize()>0&&(he=he.withResumeToken(W.resumeToken,u)),y=y.insert(Y,he),(function(Ye,Ke,at){return Ye.resumeToken.approximateByteSize()===0||Ke.snapshotVersion.toMicroseconds()-Ye.snapshotVersion.toMicroseconds()>=jU?!0:at.addedDocuments.size+at.modifiedDocuments.size+at.removedDocuments.size>0})(ae,he,W)&&s.push(a.li.updateTargetData(T,he))}));let V=wp(),B=Dr();if(t.documentUpdates.forEach((W=>{t.resolvedLimboDocuments.has(W)&&s.push(a.persistence.referenceDelegate.updateLimboDocument(T,W))})),s.push($U(T,C,t.documentUpdates).next((W=>{V=W.Bs,B=W.Ls}))),!u.isEqual(Wi.min())){const W=a.li.getLastRemoteSnapshotVersion(T).next((Y=>a.li.setTargetsMetadata(T,T.currentSequenceNumber,u)));s.push(W)}return pn.waitFor(s).next((()=>C.apply(T))).next((()=>a.localDocuments.getLocalViewOfDocuments(T,V,B))).next((()=>V))})).then((T=>(a.vs=y,T)))}function $U(o,t,a){let u=Dr(),y=Dr();return a.forEach((T=>u=u.add(T))),t.getEntries(o,u).next((T=>{let C=wp();return a.forEach(((s,V)=>{const B=T.get(s);V.isFoundDocument()!==B.isFoundDocument()&&(y=y.add(s)),V.isNoDocument()&&V.version.isEqual(Wi.min())?(t.removeEntry(s,V.readTime),C=C.insert(s,V)):!B.isValidDocument()||V.version.compareTo(B.version)>0||V.version.compareTo(B.version)===0&&B.hasPendingWrites?(t.addEntry(V),C=C.insert(s,V)):Xn(wS,"Ignoring outdated watch update for ",s,". Current version:",B.version," Watch version:",V.version)})),{Bs:C,Ls:y}}))}function ZU(o,t){const a=Yi(o);return a.persistence.runTransaction("Get next mutation batch","readonly",(u=>(t===void 0&&(t=uS),a.mutationQueue.getNextMutationBatchAfterBatchId(u,t))))}function WU(o,t){const a=Yi(o);return a.persistence.runTransaction("Allocate target","readwrite",(u=>{let y;return a.li.getTargetData(u,t).next((T=>T?(y=T,pn.resolve(y)):a.li.allocateTargetId(u).next((C=>(y=new Dm(t,C,"TargetPurposeListen",u.currentSequenceNumber),a.li.addTargetData(u,y).next((()=>y)))))))})).then((u=>{const y=a.vs.get(u.targetId);return(y===null||u.snapshotVersion.compareTo(y.snapshotVersion)>0)&&(a.vs=a.vs.insert(u.targetId,u),a.Fs.set(t,u.targetId)),u}))}async function xE(o,t,a){const u=Yi(o),y=u.vs.get(t),T=a?"readwrite":"readwrite-primary";try{a||await u.persistence.runTransaction("Release target",T,(C=>u.persistence.referenceDelegate.removeTarget(C,y)))}catch(C){if(!Xy(C))throw C;Xn(wS,`Failed to update sequence numbers for target ${t}: ${C}`)}u.vs=u.vs.remove(t),u.Fs.delete(y.target)}function BR(o,t,a){const u=Yi(o);let y=Wi.min(),T=Dr();return u.persistence.runTransaction("Execute query","readwrite",(C=>(function(V,B,W){const Y=Yi(V),ae=Y.Fs.get(W);return ae!==void 0?pn.resolve(Y.vs.get(ae)):Y.li.getTargetData(B,W)})(u,C,rf(t)).next((s=>{if(s)return y=s.lastLimboFreeSnapshotVersion,u.li.getMatchingKeysForTargetId(C,s.targetId).next((V=>{T=V}))})).next((()=>u.Cs.getDocumentsMatchingQuery(C,t,a?y:Wi.min(),a?T:Dr()))).next((s=>(XU(u,kj(t),s),{documents:s,ks:T})))))}function XU(o,t,a){let u=o.Ms.get(t)||Wi.min();a.forEach(((y,T)=>{T.readTime.compareTo(u)>0&&(u=T.readTime)})),o.Ms.set(t,u)}class FR{constructor(){this.activeTargetIds=Fj()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class YU{constructor(){this.vo=new FR,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,a,u){}addLocalQueryTarget(t,a=!0){return a&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,a,u){this.Fo[t]=a}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new FR,Promise.resolve()}handleUserChange(t,a,u){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{Mo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR="ConnectivityMonitor";class jR{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Xn(VR,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){Xn(VR,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sb=null;function vE(){return Sb===null?Sb=(function(){return 268435456+Math.round(2147483648*Math.random())})():Sb++,"0x"+Sb.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RT="RestConnection",QU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class JU{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const a=t.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),y=encodeURIComponent(this.databaseId.database);this.qo=a+"://"+t.host,this.Uo=`projects/${u}/databases/${y}`,this.$o=this.databaseId.database===a1?`project_id=${u}`:`project_id=${u}&database_id=${y}`}Wo(t,a,u,y,T){const C=vE(),s=this.Qo(t,a.toUriEncodedString());Xn(RT,`Sending RPC '${t}' ${C}:`,s,u);const V={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(V,y,T);const{host:B}=new URL(s),W=qy(B);return this.zo(t,s,V,u,W).then((Y=>(Xn(RT,`Received RPC '${t}' ${C}: `,Y),Y)),(Y=>{throw Ly(RT,`RPC '${t}' ${C} failed with error: `,Y,"url: ",s,"request:",u),Y}))}jo(t,a,u,y,T,C){return this.Wo(t,a,u,y,T)}Go(t,a,u){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Zy})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach(((y,T)=>t[T]=y)),u&&u.headers.forEach(((y,T)=>t[T]=y))}Qo(t,a){const u=QU[t];let y=`${this.qo}/v1/${a}:${u}`;return this.databaseInfo.apiKey&&(y=`${y}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),y}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El="WebChannelConnection",cv=(o,t,a)=>{o.listen(t,(u=>{try{a(u)}catch(y){setTimeout((()=>{throw y}),0)}}))};class Ay extends JU{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!Ay.c_){const t=AP();cv(t,SP.STAT_EVENT,(a=>{a.stat===oE.PROXY?Xn(El,"STAT_EVENT: detected buffering proxy"):a.stat===oE.NOPROXY&&Xn(El,"STAT_EVENT: detected no buffering proxy")})),Ay.c_=!0}}zo(t,a,u,y,T){const C=vE();return new Promise(((s,V)=>{const B=new TP;B.setWithCredentials(!0),B.listenOnce(EP.COMPLETE,(()=>{try{switch(B.getLastErrorCode()){case Nb.NO_ERROR:const Y=B.getResponseJson();Xn(El,`XHR for RPC '${t}' ${C} received:`,JSON.stringify(Y)),s(Y);break;case Nb.TIMEOUT:Xn(El,`RPC '${t}' ${C} timed out`),V(new Zn(fn.DEADLINE_EXCEEDED,"Request time out"));break;case Nb.HTTP_ERROR:const ae=B.getStatus();if(Xn(El,`RPC '${t}' ${C} failed with status:`,ae,"response text:",B.getResponseText()),ae>0){let he=B.getResponseJson();Array.isArray(he)&&(he=he[0]);const Qe=he==null?void 0:he.error;if(Qe&&Qe.status&&Qe.message){const Ye=(function(at){const nt=at.toLowerCase().replace(/_/g,"-");return Object.values(fn).indexOf(nt)>=0?nt:fn.UNKNOWN})(Qe.status);V(new Zn(Ye,Qe.message))}else V(new Zn(fn.UNKNOWN,"Server responded with status "+B.getStatus()))}else V(new Zn(fn.UNAVAILABLE,"Connection failed."));break;default:zi(9055,{l_:t,streamId:C,h_:B.getLastErrorCode(),P_:B.getLastError()})}}finally{Xn(El,`RPC '${t}' ${C} completed.`)}}));const W=JSON.stringify(y);Xn(El,`RPC '${t}' ${C} sending request:`,y),B.send(a,"POST",W,u,15)}))}T_(t,a,u){const y=vE(),T=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],C=this.createWebChannelTransport(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},V=this.longPollingOptions.timeoutSeconds;V!==void 0&&(s.longPollingTimeout=Math.round(1e3*V)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Go(s.initMessageHeaders,a,u),s.encodeInitMessageHeaders=!0;const B=T.join("");Xn(El,`Creating RPC '${t}' stream ${y}: ${B}`,s);const W=C.createWebChannel(B,s);this.I_(W);let Y=!1,ae=!1;const he=new e6({Ho:Qe=>{ae?Xn(El,`Not sending because RPC '${t}' stream ${y} is closed:`,Qe):(Y||(Xn(El,`Opening RPC '${t}' stream ${y} transport.`),W.open(),Y=!0),Xn(El,`RPC '${t}' stream ${y} sending:`,Qe),W.send(Qe))},Jo:()=>W.close()});return cv(W,mv.EventType.OPEN,(()=>{ae||(Xn(El,`RPC '${t}' stream ${y} transport opened.`),he.i_())})),cv(W,mv.EventType.CLOSE,(()=>{ae||(ae=!0,Xn(El,`RPC '${t}' stream ${y} transport closed`),he.o_(),this.E_(W))})),cv(W,mv.EventType.ERROR,(Qe=>{ae||(ae=!0,Ly(El,`RPC '${t}' stream ${y} transport errored. Name:`,Qe.name,"Message:",Qe.message),he.o_(new Zn(fn.UNAVAILABLE,"The operation could not be completed")))})),cv(W,mv.EventType.MESSAGE,(Qe=>{var Ye;if(!ae){const Ke=Qe.data[0];ps(!!Ke,16349);const at=Ke,nt=(at==null?void 0:at.error)||((Ye=at[0])==null?void 0:Ye.error);if(nt){Xn(El,`RPC '${t}' stream ${y} received error:`,nt);const Ge=nt.status;let Mt=(function(Oe){const Re=Ya[Oe];if(Re!==void 0)return lk(Re)})(Ge),cn=nt.message;Mt===void 0&&(Mt=fn.INTERNAL,cn="Unknown error status: "+Ge+" with message "+nt.message),ae=!0,he.o_(new Zn(Mt,cn)),W.close()}else Xn(El,`RPC '${t}' stream ${y} received:`,Ke),he.__(Ke)}})),Ay.u_(),setTimeout((()=>{he.s_()}),0),he}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((a=>a===t))}Go(t,a,u){super.Go(t,a,u),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return IP()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t6(o){return new Ay(o)}function MT(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(o){return new sU(o,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ay.c_=!1;class Tk{constructor(t,a,u=1e3,y=1.5,T=6e4){this.Ci=t,this.timerId=a,this.R_=u,this.A_=y,this.V_=T,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const a=Math.floor(this.d_+this.y_()),u=Math.max(0,Date.now()-this.f_),y=Math.max(0,a-u);y>0&&Xn("ExponentialBackoff",`Backing off for ${y} ms (base delay: ${this.d_} ms, delay with jitter: ${a} ms, last attempt: ${u} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,y,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UR="PersistentStream";class Ek{constructor(t,a,u,y,T,C,s,V){this.Ci=t,this.b_=u,this.S_=y,this.connection=T,this.authCredentialsProvider=C,this.appCheckCredentialsProvider=s,this.listener=V,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Tk(t,a)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,a){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():a&&a.code===fn.RESOURCE_EXHAUSTED?(bp(a.toString()),bp("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):a&&a.code===fn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(a)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),a=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([u,y])=>{this.D_===a&&this.G_(u,y)}),(u=>{t((()=>{const y=new Zn(fn.UNKNOWN,"Fetching auth token failed: "+u.message);return this.z_(y)}))}))}G_(t,a){const u=this.Q_(this.D_);this.stream=this.j_(t,a),this.stream.Zo((()=>{u((()=>this.listener.Zo()))})),this.stream.Yo((()=>{u((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((y=>{u((()=>this.z_(y)))})),this.stream.onMessage((y=>{u((()=>++this.F_==1?this.H_(y):this.onNext(y)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return Xn(UR,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return a=>{this.Ci.enqueueAndForget((()=>this.D_===t?a():(Xn(UR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class n6 extends Ek{constructor(t,a,u,y,T,C){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",a,u,y,C),this.serializer=T}j_(t,a){return this.connection.T_("Listen",t,a)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const a=lU(this.serializer,t),u=(function(T){if(!("targetChange"in T))return Wi.min();const C=T.targetChange;return C.targetIds&&C.targetIds.length?Wi.min():C.readTime?af(C.readTime):Wi.min()})(t);return this.listener.J_(a,u)}Z_(t){const a={};a.database=yE(this.serializer),a.addTarget=(function(T,C){let s;const V=C.target;if(s=dE(V)?{documents:hU(T,V)}:{query:dU(T,V).ft},s.targetId=C.targetId,C.resumeToken.approximateByteSize()>0){s.resumeToken=hk(T,C.resumeToken);const B=mE(T,C.expectedCount);B!==null&&(s.expectedCount=B)}else if(C.snapshotVersion.compareTo(Wi.min())>0){s.readTime=u1(T,C.snapshotVersion.toTimestamp());const B=mE(T,C.expectedCount);B!==null&&(s.expectedCount=B)}return s})(this.serializer,t);const u=pU(this.serializer,t);u&&(a.labels=u),this.K_(a)}X_(t){const a={};a.database=yE(this.serializer),a.removeTarget=t,this.K_(a)}}class i6 extends Ek{constructor(t,a,u,y,T,C){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",a,u,y,C),this.serializer=T}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,a){return this.connection.T_("Write",t,a)}H_(t){return ps(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,ps(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){ps(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const a=uU(t.writeResults,t.commitTime),u=af(t.commitTime);return this.listener.na(u,a)}ra(){const t={};t.database=yE(this.serializer),this.K_(t)}ea(t){const a={streamToken:this.lastStreamToken,writes:t.map((u=>cU(this.serializer,u)))};this.K_(a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6{}class s6 extends r6{constructor(t,a,u,y){super(),this.authCredentials=t,this.appCheckCredentials=a,this.connection=u,this.serializer=y,this.ia=!1}sa(){if(this.ia)throw new Zn(fn.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,a,u,y){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([T,C])=>this.connection.Wo(t,gE(a,u),y,T,C))).catch((T=>{throw T.name==="FirebaseError"?(T.code===fn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),T):new Zn(fn.UNKNOWN,T.toString())}))}jo(t,a,u,y,T){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([C,s])=>this.connection.jo(t,gE(a,u),y,C,s,T))).catch((C=>{throw C.name==="FirebaseError"?(C.code===fn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),C):new Zn(fn.UNKNOWN,C.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function a6(o,t,a,u){return new s6(o,t,a,u)}class o6{constructor(t,a){this.asyncQueue=t,this.onlineStateHandler=a,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const a=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(bp(a),this.aa=!1):Xn("OnlineStateTracker",a)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u_="RemoteStore";class l6{constructor(t,a,u,y,T){this.localStore=t,this.datastore=a,this.asyncQueue=u,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=T,this.Aa.Mo((C=>{u.enqueueAndForget((async()=>{m_(this)&&(Xn(u_,"Restarting streams for network reachability change."),await(async function(V){const B=Yi(V);B.Ea.add(4),await Jv(B),B.Va.set("Unknown"),B.Ea.delete(4),await z1(B)})(this))}))})),this.Va=new o6(u,y)}}async function z1(o){if(m_(o))for(const t of o.Ra)await t(!0)}async function Jv(o){for(const t of o.Ra)await t(!1)}function Sk(o,t){const a=Yi(o);a.Ia.has(t.targetId)||(a.Ia.set(t.targetId,t),AS(a)?SS(a):Ky(a).O_()&&ES(a,t))}function TS(o,t){const a=Yi(o),u=Ky(a);a.Ia.delete(t),u.O_()&&Ak(a,t),a.Ia.size===0&&(u.O_()?u.L_():m_(a)&&a.Va.set("Unknown"))}function ES(o,t){if(o.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Wi.min())>0){const a=o.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(a)}Ky(o).Z_(t)}function Ak(o,t){o.da.$e(t),Ky(o).X_(t)}function SS(o){o.da=new tU({getRemoteKeysForTarget:t=>o.remoteSyncer.getRemoteKeysForTarget(t),At:t=>o.Ia.get(t)||null,ht:()=>o.datastore.serializer.databaseId}),Ky(o).start(),o.Va.ua()}function AS(o){return m_(o)&&!Ky(o).x_()&&o.Ia.size>0}function m_(o){return Yi(o).Ea.size===0}function Ik(o){o.da=void 0}async function c6(o){o.Va.set("Online")}async function u6(o){o.Ia.forEach(((t,a)=>{ES(o,t)}))}async function h6(o,t){Ik(o),AS(o)?(o.Va.ha(t),SS(o)):o.Va.set("Unknown")}async function d6(o,t,a){if(o.Va.set("Online"),t instanceof uk&&t.state===2&&t.cause)try{await(async function(y,T){const C=T.cause;for(const s of T.targetIds)y.Ia.has(s)&&(await y.remoteSyncer.rejectListen(s,C),y.Ia.delete(s),y.da.removeTarget(s))})(o,t)}catch(u){Xn(u_,"Failed to remove targets %s: %s ",t.targetIds.join(","),u),await d1(o,u)}else if(t instanceof jb?o.da.Xe(t):t instanceof ck?o.da.st(t):o.da.tt(t),!a.isEqual(Wi.min()))try{const u=await wk(o.localStore);a.compareTo(u)>=0&&await(function(T,C){const s=T.da.Tt(C);return s.targetChanges.forEach(((V,B)=>{if(V.resumeToken.approximateByteSize()>0){const W=T.Ia.get(B);W&&T.Ia.set(B,W.withResumeToken(V.resumeToken,C))}})),s.targetMismatches.forEach(((V,B)=>{const W=T.Ia.get(V);if(!W)return;T.Ia.set(V,W.withResumeToken(ll.EMPTY_BYTE_STRING,W.snapshotVersion)),Ak(T,V);const Y=new Dm(W.target,V,B,W.sequenceNumber);ES(T,Y)})),T.remoteSyncer.applyRemoteEvent(s)})(o,a)}catch(u){Xn(u_,"Failed to raise snapshot:",u),await d1(o,u)}}async function d1(o,t,a){if(!Xy(t))throw t;o.Ea.add(1),await Jv(o),o.Va.set("Offline"),a||(a=()=>wk(o.localStore)),o.asyncQueue.enqueueRetryable((async()=>{Xn(u_,"Retrying IndexedDB access"),await a(),o.Ea.delete(1),await z1(o)}))}function Ck(o,t){return t().catch((a=>d1(o,a,t)))}async function N1(o){const t=Yi(o),a=Gm(t);let u=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:uS;for(;f6(t);)try{const y=await ZU(t.localStore,u);if(y===null){t.Ta.length===0&&a.L_();break}u=y.batchId,p6(t,y)}catch(y){await d1(t,y)}Rk(t)&&Mk(t)}function f6(o){return m_(o)&&o.Ta.length<10}function p6(o,t){o.Ta.push(t);const a=Gm(o);a.O_()&&a.Y_&&a.ea(t.mutations)}function Rk(o){return m_(o)&&!Gm(o).x_()&&o.Ta.length>0}function Mk(o){Gm(o).start()}async function m6(o){Gm(o).ra()}async function g6(o){const t=Gm(o);for(const a of o.Ta)t.ea(a.mutations)}async function _6(o,t,a){const u=o.Ta.shift(),y=gS.from(u,t,a);await Ck(o,(()=>o.remoteSyncer.applySuccessfulWrite(y))),await N1(o)}async function y6(o,t){t&&Gm(o).Y_&&await(async function(u,y){if((function(C){return Qj(C)&&C!==fn.ABORTED})(y.code)){const T=u.Ta.shift();Gm(u).B_(),await Ck(u,(()=>u.remoteSyncer.rejectFailedWrite(T.batchId,y))),await N1(u)}})(o,t),Rk(o)&&Mk(o)}async function GR(o,t){const a=Yi(o);a.asyncQueue.verifyOperationInProgress(),Xn(u_,"RemoteStore received new credentials");const u=m_(a);a.Ea.add(3),await Jv(a),u&&a.Va.set("Unknown"),await a.remoteSyncer.handleCredentialChange(t),a.Ea.delete(3),await z1(a)}async function x6(o,t){const a=Yi(o);t?(a.Ea.delete(2),await z1(a)):t||(a.Ea.add(2),await Jv(a),a.Va.set("Unknown"))}function Ky(o){return o.ma||(o.ma=(function(a,u,y){const T=Yi(a);return T.sa(),new n6(u,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,y)})(o.datastore,o.asyncQueue,{Zo:c6.bind(null,o),Yo:u6.bind(null,o),t_:h6.bind(null,o),J_:d6.bind(null,o)}),o.Ra.push((async t=>{t?(o.ma.B_(),AS(o)?SS(o):o.Va.set("Unknown")):(await o.ma.stop(),Ik(o))}))),o.ma}function Gm(o){return o.fa||(o.fa=(function(a,u,y){const T=Yi(a);return T.sa(),new i6(u,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,y)})(o.datastore,o.asyncQueue,{Zo:()=>Promise.resolve(),Yo:m6.bind(null,o),t_:y6.bind(null,o),ta:g6.bind(null,o),na:_6.bind(null,o)}),o.Ra.push((async t=>{t?(o.fa.B_(),await N1(o)):(await o.fa.stop(),o.Ta.length>0&&(Xn(u_,`Stopping write stream with ${o.Ta.length} pending writes`),o.Ta=[]))}))),o.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(t,a,u,y,T){this.asyncQueue=t,this.timerId=a,this.targetTimeMs=u,this.op=y,this.removalCallback=T,this.deferred=new zm,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((C=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,a,u,y,T){const C=Date.now()+u,s=new IS(t,a,C,y,T);return s.start(u),s}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Zn(fn.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function CS(o,t){if(bp("AsyncQueue",`${t}: ${o}`),Xy(o))return new Zn(fn.UNAVAILABLE,`${t}: ${o}`);throw o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{static emptySet(t){return new Iy(t.comparator)}constructor(t){this.comparator=t?(a,u)=>t(a,u)||xi.comparator(a.key,u.key):(a,u)=>xi.comparator(a.key,u.key),this.keyedMap=gv(),this.sortedSet=new fa(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const a=this.keyedMap.get(t);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((a,u)=>(t(a),!1)))}add(t){const a=this.delete(t.key);return a.copy(a.keyedMap.insert(t.key,t),a.sortedSet.insert(t,null))}delete(t){const a=this.get(t);return a?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(a)):this}isEqual(t){if(!(t instanceof Iy)||this.size!==t.size)return!1;const a=this.sortedSet.getIterator(),u=t.sortedSet.getIterator();for(;a.hasNext();){const y=a.getNext().key,T=u.getNext().key;if(!y.isEqual(T))return!1}return!0}toString(){const t=[];return this.forEach((a=>{t.push(a.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,a){const u=new Iy;return u.comparator=this.comparator,u.keyedMap=t,u.sortedSet=a,u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(){this.ga=new fa(xi.comparator)}track(t){const a=t.doc.key,u=this.ga.get(a);u?t.type!==0&&u.type===3?this.ga=this.ga.insert(a,t):t.type===3&&u.type!==1?this.ga=this.ga.insert(a,{type:u.type,doc:t.doc}):t.type===2&&u.type===2?this.ga=this.ga.insert(a,{type:2,doc:t.doc}):t.type===2&&u.type===0?this.ga=this.ga.insert(a,{type:0,doc:t.doc}):t.type===1&&u.type===0?this.ga=this.ga.remove(a):t.type===1&&u.type===2?this.ga=this.ga.insert(a,{type:1,doc:u.doc}):t.type===0&&u.type===1?this.ga=this.ga.insert(a,{type:2,doc:t.doc}):zi(63341,{Vt:t,pa:u}):this.ga=this.ga.insert(a,t)}ya(){const t=[];return this.ga.inorderTraversal(((a,u)=>{t.push(u)})),t}}class Fy{constructor(t,a,u,y,T,C,s,V,B){this.query=t,this.docs=a,this.oldDocs=u,this.docChanges=y,this.mutatedKeys=T,this.fromCache=C,this.syncStateChanged=s,this.excludesMetadataChanges=V,this.hasCachedResults=B}static fromInitialDocuments(t,a,u,y,T){const C=[];return a.forEach((s=>{C.push({type:0,doc:s})})),new Fy(t,a,Iy.emptySet(a),C,u,y,!0,!1,T)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&M1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const a=this.docChanges,u=t.docChanges;if(a.length!==u.length)return!1;for(let y=0;y<a.length;y++)if(a[y].type!==u[y].type||!a[y].doc.isEqual(u[y].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((t=>t.Da()))}}class b6{constructor(){this.queries=HR(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(a,u){const y=Yi(a),T=y.queries;y.queries=HR(),T.forEach(((C,s)=>{for(const V of s.ba)V.onError(u)}))})(this,new Zn(fn.ABORTED,"Firestore shutting down"))}}function HR(){return new f_((o=>XP(o)),M1)}async function Dk(o,t){const a=Yi(o);let u=3;const y=t.query;let T=a.queries.get(y);T?!T.Sa()&&t.Da()&&(u=2):(T=new v6,u=t.Da()?0:1);try{switch(u){case 0:T.wa=await a.onListen(y,!0);break;case 1:T.wa=await a.onListen(y,!1);break;case 2:await a.onFirstRemoteStoreListen(y)}}catch(C){const s=CS(C,`Initialization of query '${vy(t.query)}' failed`);return void t.onError(s)}a.queries.set(y,T),T.ba.push(t),t.va(a.onlineState),T.wa&&t.Fa(T.wa)&&RS(a)}async function Pk(o,t){const a=Yi(o),u=t.query;let y=3;const T=a.queries.get(u);if(T){const C=T.ba.indexOf(t);C>=0&&(T.ba.splice(C,1),T.ba.length===0?y=t.Da()?0:1:!T.Sa()&&t.Da()&&(y=2))}switch(y){case 0:return a.queries.delete(u),a.onUnlisten(u,!0);case 1:return a.queries.delete(u),a.onUnlisten(u,!1);case 2:return a.onLastRemoteStoreUnlisten(u);default:return}}function w6(o,t){const a=Yi(o);let u=!1;for(const y of t){const T=y.query,C=a.queries.get(T);if(C){for(const s of C.ba)s.Fa(y)&&(u=!0);C.wa=y}}u&&RS(a)}function T6(o,t,a){const u=Yi(o),y=u.queries.get(t);if(y)for(const T of y.ba)T.onError(a);u.queries.delete(t)}function RS(o){o.Ca.forEach((t=>{t.next()}))}var bE,$R;($R=bE||(bE={})).Ma="default",$R.Cache="cache";class kk{constructor(t,a,u){this.query=t,this.xa=a,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=u||{}}Fa(t){if(!this.options.includeMetadataChanges){const u=[];for(const y of t.docChanges)y.type!==3&&u.push(y);t=new Fy(t.query,t.docs,t.oldDocs,u,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let a=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),a=!0):this.La(t,this.onlineState)&&(this.ka(t),a=!0),this.Na=t,a}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let a=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),a=!0),a}La(t,a){if(!t.fromCache||!this.Da())return!0;const u=a!=="Offline";return(!this.options.Ka||!u)&&(!t.docs.isEmpty()||t.hasCachedResults||a==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const a=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!a)&&this.options.includeMetadataChanges===!0}ka(t){t=Fy.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==bE.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(t){this.key=t}}class Ok{constructor(t){this.key=t}}class E6{constructor(t,a){this.query=t,this.Za=a,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Dr(),this.mutatedKeys=Dr(),this.eu=YP(t),this.tu=new Iy(this.eu)}get nu(){return this.Za}ru(t,a){const u=a?a.iu:new qR,y=a?a.tu:this.tu;let T=a?a.mutatedKeys:this.mutatedKeys,C=y,s=!1;const V=this.query.limitType==="F"&&y.size===this.query.limit?y.last():null,B=this.query.limitType==="L"&&y.size===this.query.limit?y.first():null;if(t.inorderTraversal(((W,Y)=>{const ae=y.get(W),he=D1(this.query,Y)?Y:null,Qe=!!ae&&this.mutatedKeys.has(ae.key),Ye=!!he&&(he.hasLocalMutations||this.mutatedKeys.has(he.key)&&he.hasCommittedMutations);let Ke=!1;ae&&he?ae.data.isEqual(he.data)?Qe!==Ye&&(u.track({type:3,doc:he}),Ke=!0):this.su(ae,he)||(u.track({type:2,doc:he}),Ke=!0,(V&&this.eu(he,V)>0||B&&this.eu(he,B)<0)&&(s=!0)):!ae&&he?(u.track({type:0,doc:he}),Ke=!0):ae&&!he&&(u.track({type:1,doc:ae}),Ke=!0,(V||B)&&(s=!0)),Ke&&(he?(C=C.add(he),T=Ye?T.add(W):T.delete(W)):(C=C.delete(W),T=T.delete(W)))})),this.query.limit!==null)for(;C.size>this.query.limit;){const W=this.query.limitType==="F"?C.last():C.first();C=C.delete(W.key),T=T.delete(W.key),u.track({type:1,doc:W})}return{tu:C,iu:u,Ss:s,mutatedKeys:T}}su(t,a){return t.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(t,a,u,y){const T=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const C=t.iu.ya();C.sort(((W,Y)=>(function(he,Qe){const Ye=Ke=>{switch(Ke){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zi(20277,{Vt:Ke})}};return Ye(he)-Ye(Qe)})(W.type,Y.type)||this.eu(W.doc,Y.doc))),this.ou(u),y=y??!1;const s=a&&!y?this._u():[],V=this.Ya.size===0&&this.current&&!y?1:0,B=V!==this.Xa;return this.Xa=V,C.length!==0||B?{snapshot:new Fy(this.query,t.tu,T,C,t.mutatedKeys,V===0,B,!1,!!u&&u.resumeToken.approximateByteSize()>0),au:s}:{au:s}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new qR,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((a=>this.Za=this.Za.add(a))),t.modifiedDocuments.forEach((a=>{})),t.removedDocuments.forEach((a=>this.Za=this.Za.delete(a))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=Dr(),this.tu.forEach((u=>{this.uu(u.key)&&(this.Ya=this.Ya.add(u.key))}));const a=[];return t.forEach((u=>{this.Ya.has(u)||a.push(new Ok(u))})),this.Ya.forEach((u=>{t.has(u)||a.push(new Lk(u))})),a}cu(t){this.Za=t.ks,this.Ya=Dr();const a=this.ru(t.documents);return this.applyChanges(a,!0)}lu(){return Fy.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const MS="SyncEngine";class S6{constructor(t,a,u){this.query=t,this.targetId=a,this.view=u}}class A6{constructor(t){this.key=t,this.hu=!1}}class I6{constructor(t,a,u,y,T,C){this.localStore=t,this.remoteStore=a,this.eventManager=u,this.sharedClientState=y,this.currentUser=T,this.maxConcurrentLimboResolutions=C,this.Pu={},this.Tu=new f_((s=>XP(s)),M1),this.Iu=new Map,this.Eu=new Set,this.Ru=new fa(xi.comparator),this.Au=new Map,this.Vu=new xS,this.du={},this.mu=new Map,this.fu=By.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function C6(o,t,a=!0){const u=jk(o);let y;const T=u.Tu.get(t);return T?(u.sharedClientState.addLocalQueryTarget(T.targetId),y=T.view.lu()):y=await zk(u,t,a,!0),y}async function R6(o,t){const a=jk(o);await zk(a,t,!0,!1)}async function zk(o,t,a,u){const y=await WU(o.localStore,rf(t)),T=y.targetId,C=o.sharedClientState.addLocalQueryTarget(T,a);let s;return u&&(s=await M6(o,t,T,C==="current",y.resumeToken)),o.isPrimaryClient&&a&&Sk(o.remoteStore,y),s}async function M6(o,t,a,u,y){o.pu=(Y,ae,he)=>(async function(Ye,Ke,at,nt){let Ge=Ke.view.ru(at);Ge.Ss&&(Ge=await BR(Ye.localStore,Ke.query,!1).then((({documents:Oe})=>Ke.view.ru(Oe,Ge))));const Mt=nt&&nt.targetChanges.get(Ke.targetId),cn=nt&&nt.targetMismatches.get(Ke.targetId)!=null,St=Ke.view.applyChanges(Ge,Ye.isPrimaryClient,Mt,cn);return WR(Ye,Ke.targetId,St.au),St.snapshot})(o,Y,ae,he);const T=await BR(o.localStore,t,!0),C=new E6(t,T.ks),s=C.ru(T.documents),V=Qv.createSynthesizedTargetChangeForCurrentChange(a,u&&o.onlineState!=="Offline",y),B=C.applyChanges(s,o.isPrimaryClient,V);WR(o,a,B.au);const W=new S6(t,a,C);return o.Tu.set(t,W),o.Iu.has(a)?o.Iu.get(a).push(t):o.Iu.set(a,[t]),B.snapshot}async function D6(o,t,a){const u=Yi(o),y=u.Tu.get(t),T=u.Iu.get(y.targetId);if(T.length>1)return u.Iu.set(y.targetId,T.filter((C=>!M1(C,t)))),void u.Tu.delete(t);u.isPrimaryClient?(u.sharedClientState.removeLocalQueryTarget(y.targetId),u.sharedClientState.isActiveQueryTarget(y.targetId)||await xE(u.localStore,y.targetId,!1).then((()=>{u.sharedClientState.clearQueryState(y.targetId),a&&TS(u.remoteStore,y.targetId),wE(u,y.targetId)})).catch(Wy)):(wE(u,y.targetId),await xE(u.localStore,y.targetId,!0))}async function P6(o,t){const a=Yi(o),u=a.Tu.get(t),y=a.Iu.get(u.targetId);a.isPrimaryClient&&y.length===1&&(a.sharedClientState.removeLocalQueryTarget(u.targetId),TS(a.remoteStore,u.targetId))}async function k6(o,t,a){const u=V6(o);try{const y=await(function(C,s){const V=Yi(C),B=Ws.now(),W=s.reduce(((he,Qe)=>he.add(Qe.key)),Dr());let Y,ae;return V.persistence.runTransaction("Locally write mutations","readwrite",(he=>{let Qe=wp(),Ye=Dr();return V.xs.getEntries(he,W).next((Ke=>{Qe=Ke,Qe.forEach(((at,nt)=>{nt.isValidDocument()||(Ye=Ye.add(at))}))})).next((()=>V.localDocuments.getOverlayedDocuments(he,Qe))).next((Ke=>{Y=Ke;const at=[];for(const nt of s){const Ge=Zj(nt,Y.get(nt.key).overlayedDocument);Ge!=null&&at.push(new p_(nt.key,Ge,jP(Ge.value.mapValue),sf.exists(!0)))}return V.mutationQueue.addMutationBatch(he,B,at,s)})).next((Ke=>{ae=Ke;const at=Ke.applyToLocalDocumentSet(Y,Ye);return V.documentOverlayCache.saveOverlays(he,Ke.batchId,at)}))})).then((()=>({batchId:ae.batchId,changes:QP(Y)})))})(u.localStore,t);u.sharedClientState.addPendingMutation(y.batchId),(function(C,s,V){let B=C.du[C.currentUser.toKey()];B||(B=new fa(Mr)),B=B.insert(s,V),C.du[C.currentUser.toKey()]=B})(u,y.batchId,a),await e0(u,y.changes),await N1(u.remoteStore)}catch(y){const T=CS(y,"Failed to persist write");a.reject(T)}}async function Nk(o,t){const a=Yi(o);try{const u=await HU(a.localStore,t);t.targetChanges.forEach(((y,T)=>{const C=a.Au.get(T);C&&(ps(y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size<=1,22616),y.addedDocuments.size>0?C.hu=!0:y.modifiedDocuments.size>0?ps(C.hu,14607):y.removedDocuments.size>0&&(ps(C.hu,42227),C.hu=!1))})),await e0(a,u,t)}catch(u){await Wy(u)}}function ZR(o,t,a){const u=Yi(o);if(u.isPrimaryClient&&a===0||!u.isPrimaryClient&&a===1){const y=[];u.Tu.forEach(((T,C)=>{const s=C.view.va(t);s.snapshot&&y.push(s.snapshot)})),(function(C,s){const V=Yi(C);V.onlineState=s;let B=!1;V.queries.forEach(((W,Y)=>{for(const ae of Y.ba)ae.va(s)&&(B=!0)})),B&&RS(V)})(u.eventManager,t),y.length&&u.Pu.J_(y),u.onlineState=t,u.isPrimaryClient&&u.sharedClientState.setOnlineState(t)}}async function L6(o,t,a){const u=Yi(o);u.sharedClientState.updateQueryState(t,"rejected",a);const y=u.Au.get(t),T=y&&y.key;if(T){let C=new fa(xi.comparator);C=C.insert(T,Al.newNoDocument(T,Wi.min()));const s=Dr().add(T),V=new L1(Wi.min(),new Map,new fa(Mr),C,s);await Nk(u,V),u.Ru=u.Ru.remove(T),u.Au.delete(t),DS(u)}else await xE(u.localStore,t,!1).then((()=>wE(u,t,a))).catch(Wy)}async function O6(o,t){const a=Yi(o),u=t.batch.batchId;try{const y=await qU(a.localStore,t);Fk(a,u,null),Bk(a,u),a.sharedClientState.updateMutationState(u,"acknowledged"),await e0(a,y)}catch(y){await Wy(y)}}async function z6(o,t,a){const u=Yi(o);try{const y=await(function(C,s){const V=Yi(C);return V.persistence.runTransaction("Reject batch","readwrite-primary",(B=>{let W;return V.mutationQueue.lookupMutationBatch(B,s).next((Y=>(ps(Y!==null,37113),W=Y.keys(),V.mutationQueue.removeMutationBatch(B,Y)))).next((()=>V.mutationQueue.performConsistencyCheck(B))).next((()=>V.documentOverlayCache.removeOverlaysForBatchId(B,W,s))).next((()=>V.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(B,W))).next((()=>V.localDocuments.getDocuments(B,W)))}))})(u.localStore,t);Fk(u,t,a),Bk(u,t),u.sharedClientState.updateMutationState(t,"rejected",a),await e0(u,y)}catch(y){await Wy(y)}}function Bk(o,t){(o.mu.get(t)||[]).forEach((a=>{a.resolve()})),o.mu.delete(t)}function Fk(o,t,a){const u=Yi(o);let y=u.du[u.currentUser.toKey()];if(y){const T=y.get(t);T&&(a?T.reject(a):T.resolve(),y=y.remove(t)),u.du[u.currentUser.toKey()]=y}}function wE(o,t,a=null){o.sharedClientState.removeLocalQueryTarget(t);for(const u of o.Iu.get(t))o.Tu.delete(u),a&&o.Pu.yu(u,a);o.Iu.delete(t),o.isPrimaryClient&&o.Vu.Gr(t).forEach((u=>{o.Vu.containsKey(u)||Vk(o,u)}))}function Vk(o,t){o.Eu.delete(t.path.canonicalString());const a=o.Ru.get(t);a!==null&&(TS(o.remoteStore,a),o.Ru=o.Ru.remove(t),o.Au.delete(a),DS(o))}function WR(o,t,a){for(const u of a)u instanceof Lk?(o.Vu.addReference(u.key,t),N6(o,u)):u instanceof Ok?(Xn(MS,"Document no longer in limbo: "+u.key),o.Vu.removeReference(u.key,t),o.Vu.containsKey(u.key)||Vk(o,u.key)):zi(19791,{wu:u})}function N6(o,t){const a=t.key,u=a.path.canonicalString();o.Ru.get(a)||o.Eu.has(u)||(Xn(MS,"New document in limbo: "+a),o.Eu.add(u),DS(o))}function DS(o){for(;o.Eu.size>0&&o.Ru.size<o.maxConcurrentLimboResolutions;){const t=o.Eu.values().next().value;o.Eu.delete(t);const a=new xi(Ns.fromString(t)),u=o.fu.next();o.Au.set(u,new A6(a)),o.Ru=o.Ru.insert(a,u),Sk(o.remoteStore,new Dm(rf(R1(a.path)),u,"TargetPurposeLimboResolution",A1.ce))}}async function e0(o,t,a){const u=Yi(o),y=[],T=[],C=[];u.Tu.isEmpty()||(u.Tu.forEach(((s,V)=>{C.push(u.pu(V,t,a).then((B=>{var W;if((B||a)&&u.isPrimaryClient){const Y=B?!B.fromCache:(W=a==null?void 0:a.targetChanges.get(V.targetId))==null?void 0:W.current;u.sharedClientState.updateQueryState(V.targetId,Y?"current":"not-current")}if(B){y.push(B);const Y=bS.Es(V.targetId,B);T.push(Y)}})))})),await Promise.all(C),u.Pu.J_(y),await(async function(V,B){const W=Yi(V);try{await W.persistence.runTransaction("notifyLocalViewChanges","readwrite",(Y=>pn.forEach(B,(ae=>pn.forEach(ae.Ts,(he=>W.persistence.referenceDelegate.addReference(Y,ae.targetId,he))).next((()=>pn.forEach(ae.Is,(he=>W.persistence.referenceDelegate.removeReference(Y,ae.targetId,he)))))))))}catch(Y){if(!Xy(Y))throw Y;Xn(wS,"Failed to update sequence numbers: "+Y)}for(const Y of B){const ae=Y.targetId;if(!Y.fromCache){const he=W.vs.get(ae),Qe=he.snapshotVersion,Ye=he.withLastLimboFreeSnapshotVersion(Qe);W.vs=W.vs.insert(ae,Ye)}}})(u.localStore,T))}async function B6(o,t){const a=Yi(o);if(!a.currentUser.isEqual(t)){Xn(MS,"User change. New user:",t.toKey());const u=await bk(a.localStore,t);a.currentUser=t,(function(T,C){T.mu.forEach((s=>{s.forEach((V=>{V.reject(new Zn(fn.CANCELLED,C))}))})),T.mu.clear()})(a,"'waitForPendingWrites' promise is rejected due to a user change."),a.sharedClientState.handleUserChange(t,u.removedBatchIds,u.addedBatchIds),await e0(a,u.Ns)}}function F6(o,t){const a=Yi(o),u=a.Au.get(t);if(u&&u.hu)return Dr().add(u.key);{let y=Dr();const T=a.Iu.get(t);if(!T)return y;for(const C of T){const s=a.Tu.get(C);y=y.unionWith(s.view.nu)}return y}}function jk(o){const t=Yi(o);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nk.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=F6.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=L6.bind(null,t),t.Pu.J_=w6.bind(null,t.eventManager),t.Pu.yu=T6.bind(null,t.eventManager),t}function V6(o){const t=Yi(o);return t.remoteStore.remoteSyncer.applySuccessfulWrite=O6.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=z6.bind(null,t),t}class f1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=O1(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,a){return null}Mu(t,a){return null}vu(t){return GU(this.persistence,new VU,t.initialUser,this.serializer)}Cu(t){return new vk(vS.Vi,this.serializer)}Du(t){return new YU}async terminate(){var t,a;(t=this.gcScheduler)==null||t.stop(),(a=this.indexBackfillerScheduler)==null||a.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}f1.provider={build:()=>new f1};class j6 extends f1{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,a){ps(this.persistence.referenceDelegate instanceof h1,46915);const u=this.persistence.referenceDelegate.garbageCollector;return new SU(u,t.asyncQueue,a)}Cu(t){const a=this.cacheSizeBytes!==void 0?Dc.withCacheSize(this.cacheSizeBytes):Dc.DEFAULT;return new vk((u=>h1.Vi(u,a)),this.serializer)}}class TE{async initialize(t,a){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=u=>ZR(this.syncEngine,u,1),this.remoteStore.remoteSyncer.handleCredentialChange=B6.bind(null,this.syncEngine),await x6(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new b6})()}createDatastore(t){const a=O1(t.databaseInfo.databaseId),u=t6(t.databaseInfo);return a6(t.authCredentials,t.appCheckCredentials,u,a)}createRemoteStore(t){return(function(u,y,T,C,s){return new l6(u,y,T,C,s)})(this.localStore,this.datastore,t.asyncQueue,(a=>ZR(this.syncEngine,a,0)),(function(){return jR.v()?new jR:new KU})())}createSyncEngine(t,a){return(function(y,T,C,s,V,B,W){const Y=new I6(y,T,C,s,V,B);return W&&(Y.gu=!0),Y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,a)}async terminate(){var t,a;await(async function(y){const T=Yi(y);Xn(u_,"RemoteStore shutting down."),T.Ea.add(5),await Jv(T),T.Aa.shutdown(),T.Va.set("Unknown")})(this.remoteStore),(t=this.datastore)==null||t.terminate(),(a=this.eventManager)==null||a.terminate()}}TE.provider={build:()=>new TE};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):bp("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,a){setTimeout((()=>{this.muted||t(a)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm="FirestoreClient";class U6{constructor(t,a,u,y,T){this.authCredentials=t,this.appCheckCredentials=a,this.asyncQueue=u,this._databaseInfo=y,this.user=Sl.UNAUTHENTICATED,this.clientId=cS.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=T,this.authCredentials.start(u,(async C=>{Xn(qm,"Received user=",C.uid),await this.authCredentialListener(C),this.user=C})),this.appCheckCredentials.start(u,(C=>(Xn(qm,"Received new app check token=",C),this.appCheckCredentialListener(C,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new zm;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(a){const u=CS(a,"Failed to shutdown persistence");t.reject(u)}})),t.promise}}async function DT(o,t){o.asyncQueue.verifyOperationInProgress(),Xn(qm,"Initializing OfflineComponentProvider");const a=o.configuration;await t.initialize(a);let u=a.initialUser;o.setCredentialChangeListener((async y=>{u.isEqual(y)||(await bk(t.localStore,y),u=y)})),t.persistence.setDatabaseDeletedListener((()=>o.terminate())),o._offlineComponents=t}async function XR(o,t){o.asyncQueue.verifyOperationInProgress();const a=await G6(o);Xn(qm,"Initializing OnlineComponentProvider"),await t.initialize(a,o.configuration),o.setCredentialChangeListener((u=>GR(t.remoteStore,u))),o.setAppCheckTokenChangeListener(((u,y)=>GR(t.remoteStore,y))),o._onlineComponents=t}async function G6(o){if(!o._offlineComponents)if(o._uninitializedComponentsProvider){Xn(qm,"Using user provided OfflineComponentProvider");try{await DT(o,o._uninitializedComponentsProvider._offline)}catch(t){const a=t;if(!(function(y){return y.name==="FirebaseError"?y.code===fn.FAILED_PRECONDITION||y.code===fn.UNIMPLEMENTED:!(typeof DOMException<"u"&&y instanceof DOMException)||y.code===22||y.code===20||y.code===11})(a))throw a;Ly("Error using user provided cache. Falling back to memory cache: "+a),await DT(o,new f1)}}else Xn(qm,"Using default OfflineComponentProvider"),await DT(o,new j6(void 0));return o._offlineComponents}async function Gk(o){return o._onlineComponents||(o._uninitializedComponentsProvider?(Xn(qm,"Using user provided OnlineComponentProvider"),await XR(o,o._uninitializedComponentsProvider._online)):(Xn(qm,"Using default OnlineComponentProvider"),await XR(o,new TE))),o._onlineComponents}function q6(o){return Gk(o).then((t=>t.syncEngine))}async function EE(o){const t=await Gk(o),a=t.eventManager;return a.onListen=C6.bind(null,t.syncEngine),a.onUnlisten=D6.bind(null,t.syncEngine),a.onFirstRemoteStoreListen=R6.bind(null,t.syncEngine),a.onLastRemoteStoreUnlisten=P6.bind(null,t.syncEngine),a}function H6(o,t,a,u){const y=new Uk(u),T=new kk(t,y,a);return o.asyncQueue.enqueueAndForget((async()=>Dk(await EE(o),T))),()=>{y.Nu(),o.asyncQueue.enqueueAndForget((async()=>Pk(await EE(o),T)))}}function $6(o,t,a={}){const u=new zm;return o.asyncQueue.enqueueAndForget((async()=>(function(T,C,s,V,B){const W=new Uk({next:ae=>{W.Nu(),C.enqueueAndForget((()=>Pk(T,Y)));const he=ae.docs.has(s);!he&&ae.fromCache?B.reject(new Zn(fn.UNAVAILABLE,"Failed to get document because the client is offline.")):he&&ae.fromCache&&V&&V.source==="server"?B.reject(new Zn(fn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):B.resolve(ae)},error:ae=>B.reject(ae)}),Y=new kk(R1(s.path),W,{includeMetadataChanges:!0,Ka:!0});return Dk(T,Y)})(await EE(o),o.asyncQueue,t,a,u))),u.promise}function Z6(o,t){const a=new zm;return o.asyncQueue.enqueueAndForget((async()=>k6(await q6(o),t,a))),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(o){const t={};return o.timeoutSeconds!==void 0&&(t.timeoutSeconds=o.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W6="ComponentProvider",YR=new Map;function X6(o,t,a,u,y){return new pj(o,t,a,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,qk(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator,u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk="firestore.googleapis.com",KR=!0;class QR{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new Zn(fn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Hk,this.ssl=KR}else this.host=t.host,this.ssl=t.ssl??KR;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=xk;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<TU)throw new Zn(fn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}ij("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qk(t.experimentalLongPollingOptions??{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Zn(fn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Zn(fn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Zn(fn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(u,y){return u.timeoutSeconds===y.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class B1{constructor(t,a,u,y){this._authCredentials=t,this._appCheckCredentials=a,this._databaseId=u,this._app=y,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new QR({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Zn(fn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Zn(fn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new QR(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(u){if(!u)return new ZV;switch(u.type){case"firstParty":return new KV(u.sessionIndex||"0",u.iamToken||null,u.authTokenFactory||null);case"provider":return u.client;default:throw new Zn(fn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(a){const u=YR.get(a);u&&(Xn(W6,"Removing Datastore"),YR.delete(a),u.terminate())})(this),Promise.resolve()}}function Y6(o,t,a,u={}){var B;o=_p(o,B1);const y=qy(t),T=o._getSettings(),C={...T,emulatorOptions:o._getEmulatorOptions()},s=`${t}:${a}`;y&&(BD(`https://${s}`),FD("Firestore",!0)),T.host!==Hk&&T.host!==s&&Ly("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const V={...T,host:s,ssl:y,emulatorOptions:u};if(!a_(V,C)&&(o._setSettings(V),u.mockUserToken)){let W,Y;if(typeof u.mockUserToken=="string")W=u.mockUserToken,Y=Sl.MOCK_USER;else{W=gF(u.mockUserToken,(B=o._app)==null?void 0:B.options.projectId);const ae=u.mockUserToken.sub||u.mockUserToken.user_id;if(!ae)throw new Zn(fn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");Y=new Sl(ae)}o._authCredentials=new WV(new RP(W,Y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(t,a,u){this.converter=a,this._query=u,this.type="query",this.firestore=t}withConverter(t){return new g_(this.firestore,t,this._query)}}class Ba{constructor(t,a,u){this.converter=a,this._key=u,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nm(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ba(this.firestore,t,this._key)}toJSON(){return{type:Ba._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,a,u){if(Yv(a,Ba._jsonSchema))return new Ba(t,u||null,new xi(Ns.fromString(a.referencePath)))}}Ba._jsonSchemaVersion="firestore/documentReference/1.0",Ba._jsonSchema={type:Ja("string",Ba._jsonSchemaVersion),referencePath:Ja("string")};class Nm extends g_{constructor(t,a,u){super(t,a,R1(u)),this._path=u,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ba(this.firestore,null,new xi(t))}withConverter(t){return new Nm(this.firestore,t,this._path)}}function F1(o,t,...a){if(o=ic(o),MP("collection","path",t),o instanceof B1){const u=Ns.fromString(t,...a);return hR(u),new Nm(o,null,u)}{if(!(o instanceof Ba||o instanceof Nm))throw new Zn(fn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=o._path.child(Ns.fromString(t,...a));return hR(u),new Nm(o.firestore,null,u)}}function Hm(o,t,...a){if(o=ic(o),arguments.length===1&&(t=cS.newId()),MP("doc","path",t),o instanceof B1){const u=Ns.fromString(t,...a);return uR(u),new Ba(o,null,new xi(u))}{if(!(o instanceof Ba||o instanceof Nm))throw new Zn(fn.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=o._path.child(Ns.fromString(t,...a));return uR(u),new Ba(o.firestore,o instanceof Nm?o.converter:null,new xi(u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="AsyncQueue";class eM{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Tk(this,"async_queue_retry"),this._c=()=>{const u=MT();u&&Xn(JR,"Visibility state changed to "+u.visibilityState),this.M_.w_()},this.ac=t;const a=MT();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const a=MT();a&&typeof a.removeEventListener=="function"&&a.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const a=new zm;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(a.resolve,a.reject),a.promise))).then((()=>a.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!Xy(t))throw t;Xn(JR,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const a=this.ac.then((()=>(this.rc=!0,t().catch((u=>{throw this.nc=u,this.rc=!1,bp("INTERNAL UNHANDLED ERROR: ",tM(u)),u})).then((u=>(this.rc=!1,u))))));return this.ac=a,a}enqueueAfterDelay(t,a,u){this.uc(),this.oc.indexOf(t)>-1&&(a=0);const y=IS.createAndSchedule(this,t,a,u,(T=>this.hc(T)));return this.tc.push(y),y}uc(){this.nc&&zi(47125,{Pc:tM(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const a of this.tc)if(a.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((a,u)=>a.targetTimeMs-u.targetTimeMs));for(const a of this.tc)if(a.skipDelay(),t!=="all"&&a.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const a=this.tc.indexOf(t);this.tc.splice(a,1)}}function tM(o){let t=o.message||"";return o.stack&&(t=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),t}class Vy extends B1{constructor(t,a,u,y){super(t,a,u,y),this.type="firestore",this._queue=new eM,this._persistenceKey=(y==null?void 0:y.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new eM(t),this._firestoreClient=void 0,await t}}}function K6(o,t){const a=typeof o=="object"?o:GD(),u=typeof o=="string"?o:a1,y=KE(a,"firestore").getImmediate({identifier:u});if(!y._initialized){const T=pF("firestore");T&&Y6(y,...T)}return y}function PS(o){if(o._terminated)throw new Zn(fn.FAILED_PRECONDITION,"The client has already been terminated.");return o._firestoreClient||Q6(o),o._firestoreClient}function Q6(o){var u,y,T,C;const t=o._freezeSettings(),a=X6(o._databaseId,((u=o._app)==null?void 0:u.options.appId)||"",o._persistenceKey,(y=o._app)==null?void 0:y.options.apiKey,t);o._componentsProvider||(T=t.localCache)!=null&&T._offlineComponentProvider&&((C=t.localCache)!=null&&C._onlineComponentProvider)&&(o._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),o._firestoreClient=new U6(o._authCredentials,o._appCheckCredentials,o._queue,a,o._componentsProvider&&(function(V){const B=V==null?void 0:V._online.build();return{_offline:V==null?void 0:V._offline.build(B),_online:B}})(o._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ju(ll.fromBase64String(t))}catch(a){throw new Zn(fn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(t){return new Ju(ll.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ju._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Yv(t,Ju._jsonSchema))return Ju.fromBase64String(t.bytes)}}Ju._jsonSchemaVersion="firestore/bytes/1.0",Ju._jsonSchema={type:Ja("string",Ju._jsonSchemaVersion),bytes:Ja("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(...t){for(let a=0;a<t.length;++a)if(t[a].length===0)throw new Zn(fn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ol(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(t,a){if(!isFinite(t)||t<-90||t>90)throw new Zn(fn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(a)||a<-180||a>180)throw new Zn(fn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+a);this._lat=t,this._long=a}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Mr(this._lat,t._lat)||Mr(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:of._jsonSchemaVersion}}static fromJSON(t){if(Yv(t,of._jsonSchema))return new of(t.latitude,t.longitude)}}of._jsonSchemaVersion="firestore/geoPoint/1.0",of._jsonSchema={type:Ja("string",of._jsonSchemaVersion),latitude:Ja("number"),longitude:Ja("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(t){this._values=(t||[]).map((a=>a))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(u,y){if(u.length!==y.length)return!1;for(let T=0;T<u.length;++T)if(u[T]!==y[T])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Jh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Yv(t,Jh._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((a=>typeof a=="number")))return new Jh(t.vectorValues);throw new Zn(fn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Jh._jsonSchemaVersion="firestore/vectorValue/1.0",Jh._jsonSchema={type:Ja("string",Jh._jsonSchemaVersion),vectorValues:Ja("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J6=/^__.*__$/;class e8{constructor(t,a,u){this.data=t,this.fieldMask=a,this.fieldTransforms=u}toMutation(t,a){return this.fieldMask!==null?new p_(t,this.data,this.fieldMask,a,this.fieldTransforms):new Kv(t,this.data,a,this.fieldTransforms)}}function Zk(o){switch(o){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zi(40011,{dataSource:o})}}class LS{constructor(t,a,u,y,T,C){this.settings=t,this.databaseId=a,this.serializer=u,this.ignoreUndefinedProperties=y,T===void 0&&this.validatePath(),this.fieldTransforms=T||[],this.fieldMask=C||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new LS({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){var y;const a=(y=this.path)==null?void 0:y.child(t),u=this.contextWith({path:a,arrayElement:!1});return u.validatePathSegment(t),u}childContextForFieldPath(t){var y;const a=(y=this.path)==null?void 0:y.child(t),u=this.contextWith({path:a,arrayElement:!1});return u.validatePath(),u}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return p1(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((a=>t.isPrefixOf(a)))!==void 0||this.fieldTransforms.find((a=>t.isPrefixOf(a.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(Zk(this.dataSource)&&J6.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class t8{constructor(t,a,u){this.databaseId=t,this.ignoreUndefinedProperties=a,this.serializer=u||O1(t)}createContext(t,a,u,y=!1){return new LS({dataSource:t,methodName:a,targetDoc:u,path:ol.emptyPath(),arrayElement:!1,hasConverter:y},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function OS(o){const t=o._freezeSettings(),a=O1(o._databaseId);return new t8(o._databaseId,!!t.ignoreUndefinedProperties,a)}function Wk(o,t,a,u,y,T={}){const C=o.createContext(T.merge||T.mergeFields?2:0,t,a,y);Kk("Data must be an object, but it was:",C,u);const s=Xk(u,C);let V,B;if(T.merge)V=new Kh(C.fieldMask),B=C.fieldTransforms;else if(T.mergeFields){const W=[];for(const Y of T.mergeFields){const ae=V1(t,Y,a);if(!C.contains(ae))throw new Zn(fn.INVALID_ARGUMENT,`Field '${ae}' is specified in your field mask but missing from your input data.`);s8(W,ae)||W.push(ae)}V=new Kh(W),B=C.fieldTransforms.filter((Y=>V.covers(Y.field)))}else V=null,B=C.fieldTransforms;return new e8(new Qu(s),V,B)}class zS extends kS{_toFieldTransform(t){return new Gj(t.path,new Nv)}isEqual(t){return t instanceof zS}}function n8(o,t,a,u=!1){return NS(a,o.createContext(u?4:3,t))}function NS(o,t){if(Yk(o=ic(o)))return Kk("Unsupported field value:",t,o),Xk(o,t);if(o instanceof kS)return(function(u,y){if(!Zk(y.dataSource))throw y.createError(`${u._methodName}() can only be used with update() and set()`);if(!y.path)throw y.createError(`${u._methodName}() is not currently supported inside arrays`);const T=u._toFieldTransform(y);T&&y.fieldTransforms.push(T)})(o,t),null;if(o===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),o instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(u,y){const T=[];let C=0;for(const s of u){let V=NS(s,y.childContextForArray(C));V==null&&(V={nullValue:"NULL_VALUE"}),T.push(V),C++}return{arrayValue:{values:T}}})(o,t)}return(function(u,y){if((u=ic(u))===null)return{nullValue:"NULL_VALUE"};if(typeof u=="number")return Vj(y.serializer,u);if(typeof u=="boolean")return{booleanValue:u};if(typeof u=="string")return{stringValue:u};if(u instanceof Date){const T=Ws.fromDate(u);return{timestampValue:u1(y.serializer,T)}}if(u instanceof Ws){const T=new Ws(u.seconds,1e3*Math.floor(u.nanoseconds/1e3));return{timestampValue:u1(y.serializer,T)}}if(u instanceof of)return{geoPointValue:{latitude:u.latitude,longitude:u.longitude}};if(u instanceof Ju)return{bytesValue:hk(y.serializer,u._byteString)};if(u instanceof Ba){const T=y.databaseId,C=u.firestore._databaseId;if(!C.isEqual(T))throw y.createError(`Document reference is for database ${C.projectId}/${C.database} but should be for database ${T.projectId}/${T.database}`);return{referenceValue:yS(u.firestore._databaseId||y.databaseId,u._key.path)}}if(u instanceof Jh)return(function(C,s){const V=C instanceof Jh?C.toArray():C;return{mapValue:{fields:{[FP]:{stringValue:VP},[o1]:{arrayValue:{values:V.map((W=>{if(typeof W!="number")throw s.createError("VectorValues must only contain numeric values.");return mS(s.serializer,W)}))}}}}}})(u,y);if(yk(u))return u._toProto(y.serializer);throw y.createError(`Unsupported field value: ${S1(u)}`)})(o,t)}function Xk(o,t){const a={};return kP(o)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):d_(o,((u,y)=>{const T=NS(y,t.childContextForField(u));T!=null&&(a[u]=T)})),{mapValue:{fields:a}}}function Yk(o){return!(typeof o!="object"||o===null||o instanceof Array||o instanceof Date||o instanceof Ws||o instanceof of||o instanceof Ju||o instanceof Ba||o instanceof kS||o instanceof Jh||yk(o))}function Kk(o,t,a){if(!Yk(a)||!DP(a)){const u=S1(a);throw u==="an object"?t.createError(o+" a custom object"):t.createError(o+" "+u)}}function V1(o,t,a){if((t=ic(t))instanceof $k)return t._internalPath;if(typeof t=="string")return r8(o,t);throw p1("Field path arguments must be of type string or ",o,!1,void 0,a)}const i8=new RegExp("[~\\*/\\[\\]]");function r8(o,t,a){if(t.search(i8)>=0)throw p1(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,o,!1,void 0,a);try{return new $k(...t.split("."))._internalPath}catch{throw p1(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,o,!1,void 0,a)}}function p1(o,t,a,u,y){const T=u&&!u.isEmpty(),C=y!==void 0;let s=`Function ${t}() called with invalid data`;a&&(s+=" (via `toFirestore()`)"),s+=". ";let V="";return(T||C)&&(V+=" (found",T&&(V+=` in field ${u}`),C&&(V+=` in document ${y}`),V+=")"),new Zn(fn.INVALID_ARGUMENT,s+o+V)}function s8(o,t){return o.some((a=>a.isEqual(t)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a8{convertValue(t,a="none"){switch(Um(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Na(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,a);case 5:return t.stringValue;case 6:return this.convertBytes(jm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,a);case 11:return this.convertObject(t.mapValue,a);case 10:return this.convertVectorValue(t.mapValue);default:throw zi(62114,{value:t})}}convertObject(t,a){return this.convertObjectMap(t.fields,a)}convertObjectMap(t,a="none"){const u={};return d_(t,((y,T)=>{u[y]=this.convertValue(T,a)})),u}convertVectorValue(t){var u,y,T;const a=(T=(y=(u=t.fields)==null?void 0:u[o1].arrayValue)==null?void 0:y.values)==null?void 0:T.map((C=>Na(C.doubleValue)));return new Jh(a)}convertGeoPoint(t){return new of(Na(t.latitude),Na(t.longitude))}convertArray(t,a){return(t.values||[]).map((u=>this.convertValue(u,a)))}convertServerTimestamp(t,a){switch(a){case"previous":const u=C1(t);return u==null?null:this.convertValue(u,a);case"estimate":return this.convertTimestamp(kv(t));default:return null}}convertTimestamp(t){const a=Vm(t);return new Ws(a.seconds,a.nanos)}convertDocumentKey(t,a){const u=Ns.fromString(t);ps(_k(u),9688,{name:t});const y=new Lv(u.get(1),u.get(3)),T=new xi(u.popFirst(5));return y.isEqual(a)||bp(`Document ${T} contains a document reference within a different database (${y.projectId}/${y.database}) which is not supported. It will be treated as a reference in the current database (${a.projectId}/${a.database}) instead.`),T}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk extends a8{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ju(t)}convertReference(t){const a=this.convertDocumentKey(t,this.firestore._databaseId);return new Ba(this.firestore,null,a)}}function m1(){return new zS("serverTimestamp")}const nM="@firebase/firestore",iM="4.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rM(o){return(function(a,u){if(typeof a!="object"||a===null)return!1;const y=a;for(const T of u)if(T in y&&typeof y[T]=="function")return!0;return!1})(o,["next","error","complete"])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(t,a,u,y,T){this._firestore=t,this._userDataWriter=a,this._key=u,this._document=y,this._converter=T}get id(){return this._key.path.lastSegment()}get ref(){return new Ba(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new o8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var t;return((t=this._document)==null?void 0:t.data.clone().value.mapValue.fields)??void 0}get(t){if(this._document){const a=this._document.data.field(V1("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a)}}}class o8 extends Jk{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l8(o){if(o.limitType==="L"&&o.explicitOrderBy.length===0)throw new Zn(fn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class BS{}class eL extends BS{}function tL(o,t,...a){let u=[];t instanceof BS&&u.push(t),u=u.concat(a),(function(T){const C=T.filter((V=>V instanceof VS)).length,s=T.filter((V=>V instanceof FS)).length;if(C>1||C>0&&s>0)throw new Zn(fn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(u);for(const y of u)o=y._apply(o);return o}class FS extends eL{constructor(t,a,u){super(),this._field=t,this._op=a,this._value=u,this.type="where"}static _create(t,a,u){return new FS(t,a,u)}_apply(t){const a=this._parse(t);return iL(t._query,a),new g_(t.firestore,t.converter,fE(t._query,a))}_parse(t){const a=OS(t.firestore);return(function(T,C,s,V,B,W,Y){let ae;if(B.isKeyField()){if(W==="array-contains"||W==="array-contains-any")throw new Zn(fn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${W}' queries on documentId().`);if(W==="in"||W==="not-in"){aM(Y,W);const Qe=[];for(const Ye of Y)Qe.push(sM(V,T,Ye));ae={arrayValue:{values:Qe}}}else ae=sM(V,T,Y)}else W!=="in"&&W!=="not-in"&&W!=="array-contains-any"||aM(Y,W),ae=n8(s,C,Y,W==="in"||W==="not-in");return Qa.create(B,W,ae)})(t._query,"where",a,t.firestore._databaseId,this._field,this._op,this._value)}}class VS extends BS{constructor(t,a){super(),this.type=t,this._queryConstraints=a}static _create(t,a){return new VS(t,a)}_parse(t){const a=this._queryConstraints.map((u=>u._parse(t))).filter((u=>u.getFilters().length>0));return a.length===1?a[0]:ed.create(a,this._getOperator())}_apply(t){const a=this._parse(t);return a.getFilters().length===0?t:((function(y,T){let C=y;const s=T.getFlattenedFilters();for(const V of s)iL(C,V),C=fE(C,V)})(t._query,a),new g_(t.firestore,t.converter,fE(t._query,a)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class jS extends eL{constructor(t,a){super(),this._field=t,this._direction=a,this.type="orderBy"}static _create(t,a){return new jS(t,a)}_apply(t){const a=(function(y,T,C){if(y.startAt!==null)throw new Zn(fn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(y.endAt!==null)throw new Zn(fn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zv(T,C)})(t._query,this._field,this._direction);return new g_(t.firestore,t.converter,Pj(t._query,a))}}function nL(o,t="asc"){const a=t,u=V1("orderBy",o);return jS._create(u,a)}function sM(o,t,a){if(typeof(a=ic(a))=="string"){if(a==="")throw new Zn(fn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!WP(t)&&a.indexOf("/")!==-1)throw new Zn(fn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${a}' contains a '/' character.`);const u=t.path.child(Ns.fromString(a));if(!xi.isDocumentKey(u))throw new Zn(fn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${u}' is not because it has an odd number of segments (${u.length}).`);return xR(o,new xi(u))}if(a instanceof Ba)return xR(o,a._key);throw new Zn(fn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${S1(a)}.`)}function aM(o,t){if(!Array.isArray(o)||o.length===0)throw new Zn(fn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function iL(o,t){const a=(function(y,T){for(const C of y)for(const s of C.getFlattenedFilters())if(T.indexOf(s.op)>=0)return s.op;return null})(o.filters,(function(y){switch(y){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(a!==null)throw a===t.op?new Zn(fn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Zn(fn.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${a.toString()}' filters.`)}function rL(o,t,a){let u;return u=o?a&&(a.merge||a.mergeFields)?o.toFirestore(t,a):o.toFirestore(t):t,u}class yv{constructor(t,a){this.hasPendingWrites=t,this.fromCache=a}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class s_ extends Jk{constructor(t,a,u,y,T,C){super(t,a,u,y,C),this._firestore=t,this._firestoreImpl=t,this.metadata=T}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const a=new Ub(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(a,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,a={}){if(this._document){const u=this._document.data.field(V1("DocumentSnapshot.get",t));if(u!==null)return this._userDataWriter.convertValue(u,a.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Zn(fn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,a={};return a.type=s_._jsonSchemaVersion,a.bundle="",a.bundleSource="DocumentSnapshot",a.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?a:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),a.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),a)}}s_._jsonSchemaVersion="firestore/documentSnapshot/1.0",s_._jsonSchema={type:Ja("string",s_._jsonSchemaVersion),bundleSource:Ja("string","DocumentSnapshot"),bundleName:Ja("string"),bundle:Ja("string")};class Ub extends s_{data(t={}){return super.data(t)}}class Cy{constructor(t,a,u,y){this._firestore=t,this._userDataWriter=a,this._snapshot=y,this.metadata=new yv(y.hasPendingWrites,y.fromCache),this.query=u}get docs(){const t=[];return this.forEach((a=>t.push(a))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,a){this._snapshot.docs.forEach((u=>{t.call(a,new Ub(this._firestore,this._userDataWriter,u.key,u,new yv(this._snapshot.mutatedKeys.has(u.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const a=!!t.includeMetadataChanges;if(a&&this._snapshot.excludesMetadataChanges)throw new Zn(fn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===a||(this._cachedChanges=(function(y,T){if(y._snapshot.oldDocs.isEmpty()){let C=0;return y._snapshot.docChanges.map((s=>{const V=new Ub(y._firestore,y._userDataWriter,s.doc.key,s.doc,new yv(y._snapshot.mutatedKeys.has(s.doc.key),y._snapshot.fromCache),y.query.converter);return s.doc,{type:"added",doc:V,oldIndex:-1,newIndex:C++}}))}{let C=y._snapshot.oldDocs;return y._snapshot.docChanges.filter((s=>T||s.type!==3)).map((s=>{const V=new Ub(y._firestore,y._userDataWriter,s.doc.key,s.doc,new yv(y._snapshot.mutatedKeys.has(s.doc.key),y._snapshot.fromCache),y.query.converter);let B=-1,W=-1;return s.type!==0&&(B=C.indexOf(s.doc.key),C=C.delete(s.doc.key)),s.type!==1&&(C=C.add(s.doc),W=C.indexOf(s.doc.key)),{type:c8(s.type),doc:V,oldIndex:B,newIndex:W}}))}})(this,a),this._cachedChangesIncludeMetadataChanges=a),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Zn(fn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Cy._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=cS.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const a=[],u=[],y=[];return this.docs.forEach((T=>{T._document!==null&&(a.push(T._document),u.push(this._userDataWriter.convertObjectMap(T._document.data.value.mapValue.fields,"previous")),y.push(T.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function c8(o){switch(o){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zi(61501,{type:o})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cy._jsonSchemaVersion="firestore/querySnapshot/1.0",Cy._jsonSchema={type:Ja("string",Cy._jsonSchemaVersion),bundleSource:Ja("string","QuerySnapshot"),bundleName:Ja("string"),bundle:Ja("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(o){o=_p(o,Ba);const t=_p(o.firestore,Vy),a=PS(t);return $6(a,o._key).then((u=>lL(t,o,u)))}function t0(o,t,a){o=_p(o,Ba);const u=_p(o.firestore,Vy),y=rL(o.converter,t,a),T=OS(u);return oL(u,[Wk(T,"setDoc",o._key,y,o.converter!==null,a).toMutation(o._key,sf.none())])}function sL(o,t){const a=_p(o.firestore,Vy),u=Hm(o),y=rL(o.converter,t),T=OS(o.firestore);return oL(a,[Wk(T,"addDoc",u._key,y,o.converter!==null,{}).toMutation(u._key,sf.exists(!1))]).then((()=>u))}function aL(o,...t){var B,W,Y;o=ic(o);let a={includeMetadataChanges:!1,source:"default"},u=0;typeof t[u]!="object"||rM(t[u])||(a=t[u++]);const y={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(rM(t[u])){const ae=t[u];t[u]=(B=ae.next)==null?void 0:B.bind(ae),t[u+1]=(W=ae.error)==null?void 0:W.bind(ae),t[u+2]=(Y=ae.complete)==null?void 0:Y.bind(ae)}let T,C,s;if(o instanceof Ba)C=_p(o.firestore,Vy),s=R1(o._key.path),T={next:ae=>{t[u]&&t[u](lL(C,o,ae))},error:t[u+1],complete:t[u+2]};else{const ae=_p(o,g_);C=_p(ae.firestore,Vy),s=ae._query;const he=new Qk(C);T={next:Qe=>{t[u]&&t[u](new Cy(C,he,ae,Qe))},error:t[u+1],complete:t[u+2]},l8(o._query)}const V=PS(C);return H6(V,s,y,T)}function oL(o,t){const a=PS(o);return Z6(a,t)}function lL(o,t,a){const u=a.docs.get(t._key),y=new Qk(o);return new s_(o,y,t._key,u,new yv(a.hasPendingWrites,a.fromCache),t.converter)}(function(t,a=!0){$V(Hy),Py(new o_("firestore",((u,{instanceIdentifier:y,options:T})=>{const C=u.getProvider("app").getImmediate(),s=new Vy(new XV(u.getProvider("auth-internal")),new QV(C,u.getProvider("app-check-internal")),mj(C,y),C);return T={useFetchStreams:a,...T},s._setSettings(T),s}),"PUBLIC").setMultipleInstances(!0)),Lm(nM,iM,t),Lm(nM,iM,"esm2020")})();const u8={apiKey:"AIzaSyDOeNml2sN_l5BNsDdSKtNx-yws0dWud0I",authDomain:"healthme-cd5cf.firebaseapp.com",projectId:"healthme-cd5cf",storageBucket:"healthme-cd5cf.firebasestorage.app",messagingSenderId:"583698626394",appId:"1:583698626394:web:7d2d10d1e62c25fc1ee563"},cL=UD(u8),PT=UV(cL),h8=new fp,td=K6(cL),uL=Ue.createContext(void 0),$m=()=>{const o=Ue.useContext(uL);if(o===void 0)throw new Error("useAuth must be used within an AuthProvider");return o},d8=({children:o})=>{const[t,a]=Ue.useState(null),[u,y]=Ue.useState(!0);Ue.useEffect(()=>{const V=M4(PT,B=>{a(B),y(!1)});return()=>V()},[]);const s={user:t,loading:u,signInWithGoogle:async()=>{try{return await K4(PT,h8)}catch(V){throw console.error("Error signing in with Google:",V),V}},signOut:async()=>{try{await D4(PT)}catch(V){throw console.error("Error signing out:",V),V}}};return N.jsx(uL.Provider,{value:s,children:o})},oM=async(o,t,a)=>{try{const u=F1(td,"users",o,"chats",t,"messages");await sL(u,{...a,timestamp:m1()});const y=Hm(td,"users",o,"chats",t);await t0(y,{updatedAt:m1(),title:a.role==="user"?a.text.slice(0,50):void 0},{merge:!0})}catch(u){console.error("Error saving message to Firestore:",u)}},hL=async o=>{const t=F1(td,"users",o,"chats");return(await sL(t,{title:"New Conversation",createdAt:m1(),updatedAt:m1()})).id},f8=(o,t,a)=>{const u=F1(td,"users",o,"chats",t,"messages"),y=tL(u,nL("timestamp","asc"));return aL(y,T=>{const C=[];T.forEach(s=>{C.push(s.data())}),a(C)})},p8=async o=>{const t=Hm(td,"users",o,"activeChat","current"),a=await j1(t);if(a.exists()&&a.data().chatId)return a.data().chatId;const u=await hL(o);return await t0(t,{chatId:u}),u},dL=(o,t)=>{const a=F1(td,"users",o,"chats"),u=tL(a,nL("updatedAt","desc"));return aL(u,y=>{const T=[];y.forEach(C=>{const s=C.data();T.push({id:C.id,title:s.title||"New Conversation",createdAt:s.createdAt,updatedAt:s.updatedAt})}),t(T)})},m8=async o=>{const t=Hm(td,"users",o,"activeChat","current"),a=await j1(t);return a.exists()&&a.data().chatId?a.data().chatId:null},g8=async(o,t)=>{const a=Hm(td,"users",o,"activeChat","current");await t0(a,{chatId:t})},Vv=async o=>{try{const t=Hm(td,"users",o,"profile","data"),a=await j1(t);return a.exists()?a.data():null}catch(t){return console.error("Error getting user profile:",t),null}},US=async(o,t)=>{try{const a=Hm(td,"users",o,"profile","data"),u={...t,onboardingCompleted:!0,updatedAt:new Date().toISOString()};console.log("[Firestore] About to write to:",a.path),console.log("[Firestore] Data to save:",JSON.stringify(u,null,2)),await t0(a,u,{merge:!0}),console.log("[Firestore] setDoc completed. Verifying write...");const y=await j1(a);if(y.exists())console.log("[Firestore]  Verification successful! Data exists in Firestore"),console.log("[Firestore] Saved data:",y.data());else throw console.error("[Firestore]  Verification FAILED! Document does not exist after write"),new Error("Profile write failed - document not found after save")}catch(a){throw console.error("[Firestore] Error saving user profile:",a),console.error("[Firestore] Error details:",JSON.stringify(a,null,2)),a}},fL=async o=>{const t=await Vv(o);return(t==null?void 0:t.onboardingCompleted)===!0},_8=({onLogout:o})=>{var V;const{user:t,signOut:a}=$m(),[u,y]=Ue.useState([]),[T,C]=Ue.useState(null);Ue.useEffect(()=>{if(!t)return;const B=dL(t.uid,W=>{y(W)});return m8(t.uid).then(C),()=>B()},[t]);const s=B=>{if(!B)return"";const W=B.toDate?B.toDate():new Date(B),ae=Math.floor((new Date().getTime()-W.getTime())/(1e3*60*60*24));return ae===0?"Today":ae===1?"Yesterday":ae<7?`${ae} days ago`:W.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return N.jsxs("aside",{className:"w-64 flex-shrink-0 border-r border-black/5 flex flex-col bg-bg-cream",children:[N.jsxs("div",{className:"p-6",children:[N.jsx("div",{className:"flex items-center space-x-2 mb-8",children:N.jsx("span",{className:"serif-font text-2xl font-semibold text-primary",children:"Health.me"})}),N.jsxs(Im,{to:"/settings",className:"flex items-center space-x-3 p-2 mb-8 rounded-xl hover:bg-black/5 transition-all cursor-pointer",children:[N.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-800 font-bold overflow-hidden border border-black/5 shadow-sm",children:t!=null&&t.photoURL?N.jsx("img",{alt:t.displayName||"User",className:"w-full h-full object-cover",src:t.photoURL}):N.jsx("span",{children:((V=t==null?void 0:t.displayName)==null?void 0:V.charAt(0))||"U"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-semibold text-primary",children:(t==null?void 0:t.displayName)||"User"}),N.jsx("p",{className:"text-[11px] text-gray-500 uppercase tracking-wider font-bold",children:"Pro Member"})]})]}),N.jsxs("nav",{className:"space-y-1",children:[N.jsxs(Im,{to:"/chat",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"chat_bubble"}),N.jsx("span",{className:"text-sm",children:"AI Chat"})]}),N.jsxs(Im,{to:"/",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"home"}),N.jsx("span",{className:"text-sm",children:"Home"})]}),N.jsxs(Im,{to:"/calendar",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"calendar_month"}),N.jsx("span",{className:"text-sm",children:"Schedule"})]}),N.jsxs(Im,{to:"/profile",className:({isActive:B})=>`flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"bg-white shadow-sm text-primary font-medium border border-black/5":"text-gray-600 hover:bg-black/5"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"person"}),N.jsx("span",{className:"text-sm",children:"Health Profile"})]})]})]}),N.jsxs("div",{className:"mt-4 px-6 flex-1 overflow-y-auto custom-scrollbar",children:[N.jsx("p",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-[0.15em] mb-4 px-2",children:"Recent Sessions"}),N.jsx("div",{className:"space-y-1",children:u.length===0?N.jsx("p",{className:"text-xs text-gray-400 px-2",children:"No conversations yet"}):u.map(B=>N.jsxs(Im,{to:`/chat?session=${B.id}`,className:"block cursor-pointer group p-2 rounded-xl hover:bg-white hover:shadow-sm transition-all duration-200 hover:scale-[1.02] active:scale-95",children:[N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsx("p",{className:"text-sm text-gray-600 group-hover:text-primary transition-colors truncate font-medium",children:B.title}),N.jsx("span",{className:`size-2 rounded-full flex-shrink-0 ${B.id===T?"bg-blue-500":"bg-green-500"}`})]}),N.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5",children:s(B.updatedAt)})]},B.id))})]}),N.jsxs("div",{className:"p-6 border-t border-black/5 space-y-4",children:[N.jsxs(Im,{to:"/settings",className:({isActive:B})=>`w-full flex items-center space-x-3 px-2 py-2 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 ${B?"text-primary font-medium":"text-gray-500 hover:text-primary"}`,children:[N.jsx("span",{className:"material-symbols-outlined",children:"settings"}),N.jsx("span",{className:"text-sm font-medium",children:"Settings"})]}),N.jsxs("button",{onClick:()=>{a(),o==null||o()},className:"w-full flex items-center justify-center space-x-3 bg-white border border-black/5 text-gray-600 hover:bg-red-50 hover:text-red-600 hover:border-red-100 py-3 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm font-bold text-sm",children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"logout"}),N.jsx("span",{children:"Sign Out"})]})]})]})},y8=()=>{ff();const[o,t]=Ue.useState(!1),a=[{id:1,icon:"event",title:"Appointment Reminder",message:"Your appointment with Dr. Aris is tomorrow at 10:00 AM",time:"2h ago",unread:!0},{id:2,icon:"medication",title:"Medication Due",message:"Time to take your daily vitamin D supplement",time:"4h ago",unread:!0},{id:3,icon:"favorite",title:"Health Insight",message:"Your resting heart rate has improved by 5% this week",time:"1d ago",unread:!1},{id:4,icon:"check_circle",title:"Lab Results Ready",message:"Your blood test results are now available",time:"2d ago",unread:!1}];return N.jsxs("header",{className:"p-8 pb-0 flex justify-between items-center bg-transparent relative",children:[N.jsx("div",{className:"flex items-center space-x-4"}),N.jsx("div",{className:"flex items-center space-x-3",children:N.jsxs("div",{className:"relative",children:[N.jsxs("button",{onClick:()=>t(!o),className:"size-10 flex items-center justify-center rounded-full hover:bg-black/5 transition-colors text-gray-400 hover:text-primary relative",children:[N.jsx("span",{className:"material-symbols-outlined",children:"notifications"}),N.jsx("span",{className:"absolute top-1 right-1 size-2.5 bg-red-500 rounded-full border-2 border-soft-cream"})]}),o&&N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)}),N.jsxs("div",{className:"absolute right-0 top-12 w-80 bg-soft-cream rounded-3xl shadow-2xl border border-black/5 z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[N.jsxs("div",{className:"p-5 border-b border-black/5 flex justify-between items-center bg-white/50",children:[N.jsx("h3",{className:"serif-font text-xl text-primary",children:"Notifications"}),N.jsx("span",{className:"text-[9px] font-black text-primary bg-primary/10 px-2 py-1 rounded-full uppercase tracking-wider",children:"2 New"})]}),N.jsx("div",{className:"max-h-80 overflow-y-auto custom-scrollbar p-3 space-y-2",children:a.map(u=>N.jsx("div",{className:`p-4 rounded-2xl cursor-pointer transition-all border ${u.unread?"bg-white border-primary/20 shadow-sm":"bg-white/50 border-black/5 hover:bg-white"}`,children:N.jsxs("div",{className:"flex gap-3",children:[N.jsx("div",{className:`size-10 rounded-xl flex items-center justify-center flex-shrink-0 ${u.unread?"bg-primary text-white":"bg-gray-100 text-gray-400"}`,children:N.jsx("span",{className:"material-symbols-outlined text-lg",children:u.icon})}),N.jsxs("div",{className:"flex-1 min-w-0",children:[N.jsxs("div",{className:"flex justify-between items-start gap-2",children:[N.jsx("p",{className:"font-bold text-sm text-primary truncate",children:u.title}),N.jsx("span",{className:"text-[9px] text-gray-400 whitespace-nowrap font-medium",children:u.time})]}),N.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2 leading-relaxed",children:u.message})]})]})},u.id))})]})]})]})})]})},x8="/assets/cycling-BA_CT514.jpg",v8=()=>{var C;const o=ff(),{user:t}=$m(),[a,u]=Ue.useState([]);Ue.useEffect(()=>{if(!t)return;const s=dL(t.uid,V=>{u(V.slice(0,3))});return()=>s()},[t]);const y=s=>{if(!s)return"";const V=s.toDate?s.toDate():new Date(s),W=Math.floor((new Date().getTime()-V.getTime())/(1e3*60*60*24));return W===0?"Today":W===1?"Yesterday":W<7?`${W} days ago`:V.toLocaleDateString("en-US",{month:"short",day:"numeric"})},T=((C=t==null?void 0:t.displayName)==null?void 0:C.split(" ")[0])||"there";return N.jsx("div",{className:"px-8 pb-32",children:N.jsxs("div",{className:"max-w-6xl mx-auto",children:[N.jsxs("div",{className:"mb-8",children:[N.jsxs("h1",{className:"serif-font text-5xl text-primary mb-4 leading-tight",children:["Welcome, ",T,"!"]}),N.jsx("p",{className:"text-xl text-gray-500 max-w-2xl leading-relaxed",children:"Your personal AI health assistant is ready to help. How are you feeling today?"})]}),N.jsxs("div",{className:"relative w-full min-h-[500px] rounded-[40px] overflow-hidden mb-12 shadow-lg group flex flex-col justify-end",children:[N.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-all duration-500 z-10"}),N.jsx("img",{src:x8,alt:"Active Lifestyle",className:"absolute inset-0 w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"}),N.jsx("div",{className:"relative z-30 p-6 md:p-8 pb-4 md:pb-6",children:N.jsxs("div",{className:"bg-card-beige/90 backdrop-blur-md p-8 rounded-3xl border border-black/5 shadow-xl",children:[N.jsxs("h3",{className:"font-bold text-lg mb-6 flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-primary",children:"monitoring"}),"Daily Health Summary"]}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-blue-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"water_drop"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Hydration"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"1.2L / 2.5L"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-green-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-green-50 rounded-xl flex items-center justify-center text-green-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"directions_walk"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Activity"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"4,582 steps"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-red-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"favorite"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Heart Rate"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"72 bpm"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-purple-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-purple-50 rounded-xl flex items-center justify-center text-purple-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"bedtime"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Sleep"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"7h 23m"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-orange-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-orange-50 rounded-xl flex items-center justify-center text-orange-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"local_fire_department"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Calories"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"1,847 kcal"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-teal-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-teal-50 rounded-xl flex items-center justify-center text-teal-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"speed"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Blood Pressure"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"120/80"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-yellow-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-yellow-50 rounded-xl flex items-center justify-center text-yellow-600",children:N.jsx("span",{className:"material-symbols-outlined",children:"glucose"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Blood Sugar"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"95 mg/dL"})]}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/80 rounded-2xl shadow-sm border border-black/5 hover:border-indigo-200 hover:-translate-y-1 hover:shadow-lg transition-all duration-300",children:[N.jsxs("div",{className:"flex items-center space-x-4",children:[N.jsx("div",{className:"size-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-500",children:N.jsx("span",{className:"material-symbols-outlined",children:"thermostat"})}),N.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Temperature"})]}),N.jsx("span",{className:"text-sm font-black text-slate-800",children:"98.6F"})]})]})]})})]}),N.jsxs("div",{className:"mb-12",children:[N.jsx("div",{className:"flex items-center justify-between mb-6",children:N.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-primary",children:"forum"}),"Recent Sessions"]})}),a.length===0?N.jsxs("div",{className:"bg-white p-8 rounded-2xl border border-black/5 shadow-sm text-center",children:[N.jsx("span",{className:"material-symbols-outlined text-4xl text-gray-300 mb-3",children:"chat_bubble_outline"}),N.jsx("p",{className:"text-gray-400",children:"No conversations yet. Start a new chat!"}),N.jsx("button",{onClick:()=>o("/chat"),className:"mt-4 bg-primary text-white px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-black transition-all",children:"Start Chat"})]}):N.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.map((s,V)=>N.jsxs("div",{onClick:()=>o(`/chat?session=${s.id}`),className:"bg-white p-5 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:border-primary/20 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[N.jsxs("div",{className:"flex items-center justify-between mb-3",children:[N.jsx("span",{className:"text-xs font-bold text-gray-400",children:y(s.updatedAt)}),N.jsx("span",{className:`size-2 rounded-full ${V===0?"bg-blue-500":"bg-green-500"}`})]}),N.jsx("h4",{className:"font-bold text-primary mb-2 line-clamp-1",children:s.title}),N.jsx("div",{className:"mt-3 flex items-center gap-2",children:N.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider text-white px-2 py-1 rounded-lg ${V===0?"bg-blue-500":"bg-green-600"}`,children:V===0?"Recent":"Previous"})})]},s.id))})]}),N.jsxs("div",{className:"bg-primary text-white p-10 rounded-[40px] shadow-2xl relative overflow-hidden",children:[N.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl"}),N.jsxs("div",{className:"relative z-10",children:[N.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[N.jsx("span",{className:"material-symbols-outlined text-white/70",children:"analytics"}),N.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/60",children:"Weekly Health Summary"})]}),N.jsx("h2",{className:"serif-font text-3xl mb-6 leading-relaxed",children:"This week you've been 12% more active than last week, averaging 4,582 steps per day. Your resting heart rate is steady at 68 bpm, which is within a healthy range."}),N.jsx("p",{className:"text-white/70 text-lg leading-relaxed mb-6",children:"You're getting an average of 7.2 hours of sleep per night, and your blood pressure readings have remained stable at 120/80 mmHg. Your hydration could improve  you're only hitting about 48% of your daily water intake goal."}),N.jsx("p",{className:"text-white/50 text-sm italic",children:"Tip: Try setting hourly reminders to drink water throughout the day to reach your 2.5L goal."})]})]})]})})},b8=()=>{const[o,t]=Ue.useState(10),[a,u]=Ue.useState(!0),y=ff();return Ue.useEffect(()=>{const T=setInterval(()=>{t(C=>C>0?C-1:0)},1e3);return()=>clearInterval(T)},[]),N.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[100] flex items-center justify-center p-6",children:N.jsxs("div",{className:"w-full max-w-md bg-soft-cream rounded-3xl shadow-2xl overflow-hidden border border-black/5",children:[N.jsxs("div",{className:"bg-white p-6 flex flex-col items-center border-b border-black/5",children:[N.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[N.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[N.jsx("span",{className:"pulse-red absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),N.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"})]}),N.jsx("span",{className:"text-red-500 font-black text-[10px] uppercase tracking-widest",children:"Emergency Call Active"})]}),N.jsxs("div",{className:"text-4xl font-black tabular-nums text-primary",children:[o,"s"]}),N.jsx("p",{className:"text-[10px] font-medium text-gray-400 mt-1 uppercase tracking-wider",children:"Montreal Emergency Dispatch"})]}),N.jsxs("div",{className:"p-6 space-y-5",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-center text-[9px] font-black text-gray-400 uppercase tracking-widest mb-3",children:"Communication Mode"}),N.jsxs("div",{className:"bg-white p-1 rounded-xl flex gap-1 border border-black/5",children:[N.jsxs("button",{onClick:()=>u(!1),className:`flex-1 flex items-center justify-center gap-2 py-2.5 px-3 rounded-lg text-xs font-bold transition-all ${a?"text-gray-400 hover:text-primary":"bg-primary text-white shadow-sm"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"record_voice_over"}),"Talk Myself"]}),N.jsxs("button",{onClick:()=>u(!0),className:`flex-1 flex items-center justify-center gap-2 py-2.5 px-3 rounded-lg text-xs font-bold transition-all ${a?"bg-primary text-white shadow-sm":"text-gray-400 hover:text-primary"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-sm fill-1",children:"smart_toy"}),"AI Relay"]})]})]}),N.jsxs("div",{className:"bg-white rounded-2xl border border-black/5 overflow-hidden",children:[N.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-b border-black/5 flex justify-between items-center",children:[N.jsx("span",{className:"text-[9px] font-black text-gray-400 uppercase tracking-wider",children:"AI Transcript"}),N.jsxs("span",{className:"flex items-center gap-1",children:[N.jsx("span",{className:"size-1.5 rounded-full bg-green-500 pulse-green"}),N.jsx("span",{className:"text-[9px] font-black text-green-600 uppercase",children:"Active"})]})]}),N.jsxs("div",{className:"p-4 space-y-3 max-h-[140px] overflow-y-auto custom-scrollbar",children:[N.jsxs("div",{className:"flex gap-2",children:[N.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:N.jsx("span",{className:"material-symbols-outlined text-xs",children:"emergency"})}),N.jsx("p",{className:"text-xs text-gray-600 italic leading-relaxed",children:'"This is an automated emergency relay from Health.me. Assisting Sam Smith with respiratory distress."'})]}),N.jsxs("div",{className:"flex gap-2",children:[N.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:N.jsx("span",{className:"material-symbols-outlined text-xs",children:"info"})}),N.jsx("p",{className:"text-xs text-gray-600 italic leading-relaxed",children:'"Type 1 Diabetic, allergic to penicillin. Location: 1450 Guy St, Montreal."'})]}),N.jsxs("div",{className:"flex gap-2 items-center",children:[N.jsx("div",{className:"size-6 shrink-0 bg-red-50 rounded-lg flex items-center justify-center text-red-500",children:N.jsx("span",{className:"material-symbols-outlined text-xs",children:"sensors"})}),N.jsx("p",{className:"text-xs font-bold text-red-500",children:"Relaying vitals..."})]})]})]}),N.jsxs("button",{onClick:()=>y("/"),className:"w-full py-4 bg-red-500 hover:bg-red-600 text-white rounded-2xl font-black text-sm transition-all flex items-center justify-center gap-2 shadow-lg",children:[N.jsx("span",{className:"material-symbols-outlined rotate-[135deg]",children:"call"}),"End Emergency"]}),N.jsxs("div",{className:"flex justify-center gap-6",children:[N.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[N.jsx("span",{className:"material-symbols-outlined text-xs",children:"mic"}),N.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Mic Active"})]}),N.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[N.jsx("span",{className:"material-symbols-outlined text-xs",children:"location_on"}),N.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"GPS On"})]})]})]}),N.jsx("div",{className:"bg-white py-3 px-6 flex items-center justify-center border-t border-black/5",children:N.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[N.jsx("span",{className:"material-symbols-outlined text-xs",children:"verified_user"}),N.jsx("span",{className:"text-[9px] font-bold uppercase tracking-widest",children:"438 520 2457  Health.me"})]})})]})})},GS="/assets/health-C5bU5zeQ.jpg",w8=({onLogin:o})=>{const t=ff(),{requestLocation:a,isLoading:u}=DD(),{signInWithGoogle:y,user:T}=$m(),[C,s]=Ue.useState(!1),[V,B]=Ue.useState(!1),[W,Y]=Ue.useState(!1),ae=async Qe=>{Qe.preventDefault(),s(!0),await a(),s(!1),o(),t("/chat")},he=async()=>{B(!0);try{const Qe=await y();await a(),o();const Ye=Qe==null?void 0:Qe.user;if(Ye){const Ke=await fL(Ye.uid);t(Ke?"/chat":"/onboarding")}else t("/onboarding")}catch(Qe){console.error("Google sign-in failed:",Qe)}finally{B(!1)}};return N.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[N.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[N.jsx("div",{className:"absolute inset-0 bg-black/20 z-10"}),N.jsx("img",{src:GS,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),N.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[N.jsx("div",{className:"flex items-center space-x-2 mb-6",children:N.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),N.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Your health journey encompasses mind, body, and spirit."'})]})]}),N.jsx("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:N.jsxs("div",{className:"w-full max-w-[440px]",children:[N.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-[40px] shadow-[0_8px_40px_rgba(0,0,0,0.03)] border border-black/5",children:[N.jsxs("div",{className:"text-center mb-10",children:[N.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-bg-cream mb-6",children:N.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"medical_services"})}),N.jsx("h1",{className:"serif-font text-4xl text-primary mb-3 leading-tight",children:"Welcome back"}),N.jsx("p",{className:"text-gray-500 text-[15px]",children:"Sign in to manage your health and appointments."})]}),N.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"email",children:"Email Address"}),N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"email",placeholder:"name@example.com",type:"email",defaultValue:"demo@health.me",required:!0})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsxs("div",{className:"flex justify-between items-center ml-1",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400",htmlFor:"password",children:"Password"}),N.jsx("a",{href:"#",className:"text-[11px] font-bold text-gray-500 hover:text-primary",children:"Forgot?"})]}),N.jsxs("div",{className:"relative",children:[N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"password",placeholder:"",type:W?"text":"password",defaultValue:"password",required:!0}),N.jsx("button",{type:"button",onClick:()=>Y(!W),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:N.jsx("span",{className:"material-symbols-outlined text-lg",children:W?"visibility_off":"visibility"})})]})]}),N.jsx("button",{className:"w-full bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all transform active:scale-[0.99] mt-2 text-[15px] shadow-lg shadow-black/10 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"submit",disabled:C,children:C?N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Getting your location..."]}):"Sign In"})]}),N.jsxs("div",{className:"flex items-center gap-4 my-6",children:[N.jsx("div",{className:"flex-1 h-px bg-gray-200"}),N.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"or"}),N.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),N.jsx("button",{onClick:he,disabled:V,className:"w-full flex items-center justify-center gap-3 bg-white border-2 border-black/10 rounded-full py-3.5 px-6 text-primary font-bold hover:bg-gray-50 hover:border-primary/30 transition-all shadow-sm disabled:opacity-70 disabled:cursor-not-allowed",children:V?N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Signing in..."]}):N.jsxs(N.Fragment,{children:[N.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[N.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),N.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),N.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),N.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),N.jsxs("p",{className:"mt-8 text-center text-[13px] text-gray-500",children:["Don't have an account? ",N.jsx("a",{href:"#/signup",className:"font-bold text-primary hover:underline",children:"Sign up"})]})]}),N.jsxs("footer",{className:"py-8 text-center w-full space-y-6",children:[N.jsx("p",{className:"serif-font text-gray-400 italic text-lg px-4 opacity-80",children:`"Health is everything. Don't settle."`}),N.jsxs("div",{className:"flex justify-center gap-6 text-gray-300",children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"verified_user"}),N.jsx("span",{className:"material-symbols-outlined text-xl",children:"shield"}),N.jsx("span",{className:"material-symbols-outlined text-xl",children:"info"})]})]})]})})]})},T8="/assets/cycling2-DDaqHTRt.jpg",E8=["A+","A-","B+","B-","AB+","AB-","O+","O-","Unknown"],S8=["Peanuts","Tree Nuts","Milk","Eggs","Wheat","Soy","Fish","Shellfish","Penicillin","Sulfa","Latex","Dust Mites","Pollen","Pet Dander"],A8=["Diabetes","Hypertension","Asthma","Heart Disease","Arthritis","Depression","Anxiety","ADHD","Epilepsy","Thyroid Disorder"],I8=()=>{const{user:o}=$m(),[t,a]=Ue.useState("profile"),[u,y]=Ue.useState(!0),[T,C]=Ue.useState(!1),[s,V]=Ue.useState(!1),[B,W]=Ue.useState(null),[Y,ae]=Ue.useState(null);Ue.useEffect(()=>{(async()=>{if(o){y(!0);try{const Mt=await Vv(o.uid);Mt&&ae(Mt)}catch(Mt){console.error("Error loading profile:",Mt)}finally{y(!1)}}})()},[o]);const he=async()=>{if(!(!o||!Y)){V(!0),W(null);try{await US(o.uid,Y),W({type:"success",text:"Profile updated!"}),C(!1),setTimeout(()=>W(null),3e3)}catch(Ge){console.error("Error saving profile:",Ge),W({type:"error",text:"Failed to save."})}finally{V(!1)}}},Qe=()=>{C(!1),o&&Vv(o.uid).then(Ge=>Ge&&ae(Ge))},Ye=Ge=>{Y&&ae(Mt=>Mt?{...Mt,allergies:Mt.allergies.includes(Ge)?Mt.allergies.filter(cn=>cn!==Ge):[...Mt.allergies,Ge]}:null)},Ke=Ge=>{Y&&ae(Mt=>Mt?{...Mt,medicalConditions:{...Mt.medicalConditions,conditions:Mt.medicalConditions.conditions.includes(Ge)?Mt.medicalConditions.conditions.filter(cn=>cn!==Ge):[...Mt.medicalConditions.conditions,Ge]}}:null)},at=Ge=>{if(!Ge)return 0;const Mt=new Date,cn=new Date(Ge);let St=Mt.getFullYear()-cn.getFullYear();const Oe=Mt.getMonth()-cn.getMonth();return(Oe<0||Oe===0&&Mt.getDate()<cn.getDate())&&St--,St},nt=[{name:"Blood Panel - Annual Checkup",date:"Jan 12, 2024",clinic:"Clinique Mdicale Prive UnionMD",type:"Lab Result",icon:"biotech",color:"bg-blue-50 text-blue-500"},{name:"Radiology Report - Lower Back",date:"Dec 05, 2023",clinic:"CuraMed",type:"Imaging",icon:"visibility",color:"bg-purple-50 text-purple-500"},{name:"Prescription: Lisinopril 10mg",date:"Nov 20, 2023",clinic:"Clinique Sant MD",type:"Prescription",icon:"medication",color:"bg-orange-50 text-orange-500"},{name:"Discharge Summary - Appendectomy",date:"Aug 14, 2023",clinic:"Centre Mdical Westmount",type:"Hospital Record",icon:"description",color:"bg-gray-50 text-gray-500"},{name:"Immunization Record - 2023",date:"Feb 10, 2023",clinic:"Westmount Square Health Group",type:"Vaccination",icon:"vaccines",color:"bg-green-50 text-green-500"}];return N.jsxs("div",{className:"px-8 pb-32",children:[N.jsxs("div",{className:"w-full relative rounded-[24px] p-6 mb-8 overflow-hidden shadow-lg text-white min-h-[250px] flex flex-col justify-end",children:[N.jsxs("div",{className:"absolute inset-0",children:[N.jsx("img",{src:T8,alt:"Cycling Hero",className:"w-full h-full object-cover"}),N.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 to-black/20"})]}),N.jsxs("div",{className:"max-w-6xl mx-auto relative z-10 flex flex-col md:flex-row justify-between items-end gap-4 flex-1 w-full",children:[N.jsxs("div",{children:[N.jsx("h1",{className:"serif-font text-3xl mb-2 font-medium tracking-tight",children:"Health Profile"}),N.jsx("p",{className:"text-white/80 text-sm max-w-xl font-light leading-relaxed",children:"Your centralized biological data and real-time insights."})]}),N.jsx("div",{className:"flex items-center gap-3",children:N.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 p-1 rounded-xl flex gap-1",children:[N.jsx("button",{onClick:()=>a("profile"),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${t==="profile"?"bg-white text-primary shadow-md":"text-white/70 hover:text-white hover:bg-white/10"}`,children:"Overview"}),N.jsx("button",{onClick:()=>a("records"),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${t==="records"?"bg-white text-primary shadow-md":"text-white/70 hover:text-white hover:bg-white/10"}`,children:"Records"})]})})]})]}),B&&N.jsxs("div",{className:`max-w-6xl mx-auto mb-6 p-4 rounded-2xl flex items-center gap-3 animate-in slide-in-from-top duration-300 ${B.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[N.jsx("span",{className:"material-symbols-outlined",children:B.type==="success"?"check_circle":"error"}),N.jsx("span",{className:"text-sm font-medium",children:B.text})]}),N.jsx("div",{className:"max-w-6xl mx-auto",children:u?N.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:N.jsx("span",{className:"material-symbols-outlined animate-spin text-4xl text-gray-400",children:"progress_activity"})}):t==="profile"?N.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6",children:[Y&&N.jsx("div",{className:"flex justify-end",children:T?N.jsxs("div",{className:"flex gap-2",children:[N.jsx("button",{onClick:Qe,className:"px-5 py-2.5 rounded-2xl text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition-all",children:"Cancel"}),N.jsxs("button",{onClick:he,disabled:s,className:"flex items-center gap-2 bg-green-500 text-white px-5 py-2.5 rounded-2xl text-sm font-bold hover:bg-green-600 transition-all shadow-lg shadow-green-500/20",children:[s&&N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Save Changes"]})]}):N.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 bg-primary text-white px-5 py-2.5 rounded-2xl text-sm font-bold hover:bg-black transition-all shadow-lg shadow-black/10",children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"}),"Edit Health Data"]})}),N.jsxs("div",{className:"bg-[#F5F2EA] rounded-[32px] p-8 shadow-sm border border-black/5",children:[N.jsxs("h2",{className:"font-bold text-lg mb-6 flex items-center gap-2 text-primary opacity-80",children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"bar_chart"}),"Health Summary"]}),N.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"bloodtype"})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Blood Type"}),T?N.jsxs("select",{className:"w-full mt-1 px-2 py-1 rounded-lg bg-gray-50 border border-black/10 text-sm font-bold text-primary",value:(Y==null?void 0:Y.bloodType)||"",onChange:Ge=>ae(Mt=>Mt?{...Mt,bloodType:Ge.target.value}:null),children:[N.jsx("option",{value:"",children:"Select"}),E8.map(Ge=>N.jsx("option",{value:Ge,children:Ge},Ge))]}):N.jsx("p",{className:"text-lg font-black text-primary",children:(Y==null?void 0:Y.bloodType)||""})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"scale"})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Weight"}),T?N.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[N.jsx("input",{type:"text",className:"w-16 px-2 py-1 rounded-lg bg-gray-50 border border-black/10 text-sm font-bold text-primary",value:(Y==null?void 0:Y.physicalStats.weight)||"",onChange:Ge=>ae(Mt=>Mt?{...Mt,physicalStats:{...Mt.physicalStats,weight:Ge.target.value}}:null),placeholder:"165"}),N.jsx("span",{className:"text-xs text-gray-400",children:"lbs"})]}):N.jsx("p",{className:"text-lg font-black text-primary",children:Y!=null&&Y.physicalStats.weight?`${Y.physicalStats.weight} lbs`:""})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-green-50 rounded-xl flex items-center justify-center text-green-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"straighten"})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Height"}),T?N.jsx("input",{type:"text",className:"w-full mt-1 px-2 py-1 rounded-lg bg-gray-50 border border-black/10 text-sm font-bold text-primary",value:(Y==null?void 0:Y.physicalStats.height)||"",onChange:Ge=>ae(Mt=>Mt?{...Mt,physicalStats:{...Mt.physicalStats,height:Ge.target.value}}:null),placeholder:`5'11"`}):N.jsx("p",{className:"text-lg font-black text-primary",children:(Y==null?void 0:Y.physicalStats.height)||""})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-orange-50 rounded-xl flex items-center justify-center text-orange-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"event"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Age"}),N.jsx("p",{className:"text-lg font-black text-primary",children:Y!=null&&Y.personalInfo.dateOfBirth?`${at(Y.personalInfo.dateOfBirth)} yrs`:""})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"favorite"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Heart Rate"}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsxs("p",{className:"text-lg font-black text-primary",children:["72 ",N.jsx("span",{className:"text-xs text-gray-400/80 font-normal",children:"bpm"})]}),N.jsx("span",{className:"size-1.5 bg-red-500 rounded-full animate-pulse"})]})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"air"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"SpO2"}),N.jsxs("p",{className:"text-lg font-black text-primary",children:["98 ",N.jsx("span",{className:"text-xs text-gray-400/80 font-normal",children:"%"})]})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-purple-50 rounded-xl flex items-center justify-center text-purple-500 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"speed"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Blood Pressure"}),N.jsx("p",{className:"text-lg font-black text-primary",children:"120/80"})]})]}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-black/5 flex items-center gap-4 hover:shadow-md transition-all",children:[N.jsx("div",{className:"size-10 bg-yellow-50 rounded-xl flex items-center justify-center text-yellow-600 shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"thermostat"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Temp"}),N.jsx("p",{className:"text-lg font-black text-primary",children:"98.6F"})]})]})]})]}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[N.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-6 rounded-[24px] border border-black/5 shadow-sm",children:[N.jsxs("h3",{className:"text-xs font-black text-primary mb-4 flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-red-500 text-sm bg-red-50 p-1 rounded-md",children:"warning"}),"Known Allergies"]}),T?N.jsx("div",{className:"flex flex-wrap gap-2",children:S8.map(Ge=>N.jsx("button",{onClick:()=>Ye(Ge),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${Y!=null&&Y.allergies.includes(Ge)?"bg-red-500 text-white shadow-md":"bg-gray-100 text-gray-500 hover:bg-gray-200 border border-black/5"}`,children:Ge},Ge))}):N.jsx("div",{className:"flex flex-wrap gap-2",children:Y!=null&&Y.allergies&&Y.allergies.length>0?Y.allergies.map(Ge=>N.jsx("span",{className:"px-3 py-1.5 bg-white text-red-700 text-xs font-bold rounded-lg border border-red-100 shadow-sm",children:Ge},Ge)):N.jsx("span",{className:"text-sm text-gray-400",children:"No allergies recorded"})})]}),N.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-6 rounded-[24px] border border-black/5 shadow-sm",children:[N.jsxs("h3",{className:"text-xs font-black text-primary mb-4 flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-primary text-sm bg-primary/10 p-1 rounded-md",children:"medical_information"}),"Medical Conditions"]}),T?N.jsxs("div",{className:"space-y-3",children:[N.jsx("div",{className:"flex flex-wrap gap-2",children:A8.map(Ge=>N.jsx("button",{onClick:()=>Ke(Ge),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${Y!=null&&Y.medicalConditions.conditions.includes(Ge)?"bg-primary text-white shadow-md":"bg-gray-100 text-gray-500 hover:bg-gray-200 border border-black/5"}`,children:Ge},Ge))}),N.jsx("textarea",{className:"w-full px-3 py-2 rounded-xl bg-white border border-black/10 text-sm text-primary resize-none",rows:2,value:(Y==null?void 0:Y.medicalConditions.notes)||"",onChange:Ge=>ae(Mt=>Mt?{...Mt,medicalConditions:{...Mt.medicalConditions,notes:Ge.target.value}}:null),placeholder:"Additional notes..."})]}):N.jsxs("div",{className:"space-y-2",children:[N.jsx("div",{className:"flex flex-wrap gap-2",children:Y!=null&&Y.medicalConditions.conditions&&Y.medicalConditions.conditions.length>0?Y.medicalConditions.conditions.map(Ge=>N.jsx("span",{className:"px-3 py-1.5 bg-white text-primary text-xs font-bold rounded-lg border border-primary/20 shadow-sm",children:Ge},Ge)):N.jsx("span",{className:"text-sm text-gray-400",children:"No conditions recorded"})}),(Y==null?void 0:Y.medicalConditions.notes)&&N.jsx("p",{className:"text-xs text-gray-500 italic bg-white/50 rounded-lg p-2",children:Y.medicalConditions.notes})]})]})]}),N.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-6 rounded-[24px] border border-black/5 shadow-sm",children:[N.jsxs("h3",{className:"text-xs font-black text-primary mb-4 flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-gray-500 text-sm bg-gray-50 p-1 rounded-md",children:"watch"}),"Connected Devices"]}),N.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-black/5 shadow-sm",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("img",{className:"size-5 object-contain",src:"https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",alt:"Apple Health"}),N.jsx("span",{className:"text-xs font-bold text-primary",children:"Apple Watch Ultra"})]}),N.jsx("span",{className:"size-1.5 rounded-full bg-green-500 pulse-green"})]})]}),N.jsxs("div",{children:[N.jsx("h2",{className:"serif-font text-3xl text-primary mb-8 px-2",children:"Clinical Timeline"}),N.jsx("div",{className:"relative pl-8 border-l-2 border-gray-100 space-y-12",children:[{year:"2023",event:"Appendectomy",clinic:"Centre Mdical Westmount",icon:"content_cut",type:"Surgery"},{year:"2021",event:"Type 2 Diabetes Diagnosis",clinic:"Clinique Mdicale Prive UnionMD",icon:"medical_information",type:"Diagnosis"},{year:"2018",event:"Left Wrist Fracture",clinic:"Clinique Mdicale Mtro",icon:"orthopedics",type:"Injury"}].map((Ge,Mt)=>N.jsxs("div",{className:"relative",children:[N.jsx("div",{className:"absolute -left-[41px] top-6 size-5 rounded-full border-[4px] border-white bg-primary shadow-sm"}),N.jsxs("div",{className:"bg-white p-8 rounded-[32px] border border-black/5 flex items-center gap-6 hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer group shadow-sm",children:[N.jsx("div",{className:"flex flex-col items-center gap-2 mr-4",children:N.jsx("span",{className:"text-2xl font-black serif-font text-primary/30 group-hover:text-primary transition-colors",children:Ge.year})}),N.jsx("div",{className:"size-14 bg-bg-cream rounded-2xl flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-all shadow-sm flex-shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-2xl",children:Ge.icon})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("span",{className:"inline-block px-3 py-1 rounded-lg bg-gray-50 text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2",children:Ge.type}),N.jsx("p",{className:"font-black text-primary text-xl mb-1",children:Ge.event}),N.jsx("p",{className:"text-sm text-gray-400 font-medium",children:Ge.clinic})]}),N.jsx("div",{className:"size-10 rounded-full border border-black/5 flex items-center justify-center text-gray-300 group-hover:border-primary group-hover:text-primary transition-all",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"arrow_forward"})})]})]},Mt))})]})]}):N.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[N.jsxs("div",{className:"lg:col-span-3 bg-primary text-white p-12 rounded-[48px] shadow-2xl relative overflow-hidden mb-6",children:[N.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl"}),N.jsxs("div",{className:"relative z-10 max-w-3xl",children:[N.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[N.jsx("span",{className:"material-symbols-outlined text-white/70 bg-white/10 p-2 rounded-xl",children:"auto_awesome"}),N.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.25em] text-white/50",children:"AI Health Insights"})]}),N.jsx("h2",{className:"serif-font text-4xl mb-8 leading-tight",children:'"All clinical indicators are within nominal ranges. Your recent blood panel shows optimal LDL levels. Suggested next screening: April 2024."'}),N.jsx("button",{className:"bg-white text-primary py-4 px-10 rounded-2xl font-black text-sm hover:scale-105 transition-all shadow-2xl active:scale-95",children:"Generate Detailed Report"})]})]}),nt.map((Ge,Mt)=>N.jsxs("div",{className:"bg-white p-8 rounded-[40px] border border-black/5 shadow-sm hover:shadow-2xl transition-all group flex flex-col h-full",children:[N.jsx("div",{className:`size-14 ${Ge.color} rounded-2xl flex items-center justify-center mb-8 shadow-sm group-hover:scale-110 transition-transform`,children:N.jsx("span",{className:"material-symbols-outlined text-2xl",children:Ge.icon})}),N.jsxs("div",{className:"flex-1 mb-10",children:[N.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-3 leading-none",children:Ge.type}),N.jsx("h3",{className:"font-black text-2xl text-primary mb-4 leading-tight group-hover:text-primary transition-colors pr-6",children:Ge.name}),N.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500 font-bold mb-2",children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_today"}),N.jsx("span",{children:Ge.date})]}),N.jsx("p",{className:"text-xs text-gray-400 font-medium",children:Ge.clinic})]}),N.jsxs("div",{className:"flex gap-4 mt-auto",children:[N.jsx("button",{className:"flex-1 bg-gray-50 text-primary py-4 rounded-2xl text-xs font-black border border-black/5 hover:bg-black hover:text-white transition-all shadow-sm",children:"Open Record"}),N.jsx("button",{className:"size-14 rounded-2xl border border-black/5 text-gray-400 hover:text-primary hover:bg-gray-50 transition-all flex items-center justify-center shadow-sm",children:N.jsx("span",{className:"material-symbols-outlined text-2xl",children:"download"})})]})]},Mt)),N.jsxs("button",{className:"bg-transparent border-2 border-dashed border-black/10 p-10 rounded-[40px] flex flex-col items-center justify-center gap-6 hover:border-primary/40 hover:bg-white transition-all group min-h-[320px]",children:[N.jsx("div",{className:"size-20 rounded-full bg-black/5 flex items-center justify-center text-gray-400 group-hover:bg-primary group-hover:text-white transition-all shadow-sm",children:N.jsx("span",{className:"material-symbols-outlined text-5xl",children:"add"})}),N.jsxs("div",{className:"text-center",children:[N.jsx("p",{className:"font-black text-gray-400 group-hover:text-primary transition-all text-sm uppercase tracking-widest mb-1",children:"Upload Result"}),N.jsx("p",{className:"text-[10px] text-gray-300 uppercase tracking-widest font-bold",children:"PDF, JPEG, or HEIC"})]})]})]})})})]})};function C8(o,t){const a={};return(o[o.length-1]===""?[...o,""]:o).join((a.padRight?" ":"")+","+(a.padLeft===!1?"":" ")).trim()}const R8=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,M8=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,D8={};function lM(o,t){return(D8.jsx?M8:R8).test(o)}const P8=/[ \t\n\f\r]/g;function k8(o){return typeof o=="object"?o.type==="text"?cM(o.value):!1:cM(o)}function cM(o){return o.replace(P8,"")===""}class n0{constructor(t,a,u){this.normal=a,this.property=t,u&&(this.space=u)}}n0.prototype.normal={};n0.prototype.property={};n0.prototype.space=void 0;function pL(o,t){const a={},u={};for(const y of o)Object.assign(a,y.property),Object.assign(u,y.normal);return new n0(a,u,t)}function SE(o){return o.toLowerCase()}class kc{constructor(t,a){this.attribute=a,this.property=t}}kc.prototype.attribute="";kc.prototype.booleanish=!1;kc.prototype.boolean=!1;kc.prototype.commaOrSpaceSeparated=!1;kc.prototype.commaSeparated=!1;kc.prototype.defined=!1;kc.prototype.mustUseProperty=!1;kc.prototype.number=!1;kc.prototype.overloadedBoolean=!1;kc.prototype.property="";kc.prototype.spaceSeparated=!1;kc.prototype.space=void 0;let L8=0;const lr=__(),Ka=__(),AE=__(),In=__(),zs=__(),Ry=__(),fu=__();function __(){return 2**++L8}const IE=Object.freeze(Object.defineProperty({__proto__:null,boolean:lr,booleanish:Ka,commaOrSpaceSeparated:fu,commaSeparated:Ry,number:In,overloadedBoolean:AE,spaceSeparated:zs},Symbol.toStringTag,{value:"Module"})),kT=Object.keys(IE);class qS extends kc{constructor(t,a,u,y){let T=-1;if(super(t,a),uM(this,"space",y),typeof u=="number")for(;++T<kT.length;){const C=kT[T];uM(this,kT[T],(u&IE[C])===IE[C])}}}qS.prototype.defined=!0;function uM(o,t,a){a&&(o[t]=a)}function Qy(o){const t={},a={};for(const[u,y]of Object.entries(o.properties)){const T=new qS(u,o.transform(o.attributes||{},u),y,o.space);o.mustUseProperty&&o.mustUseProperty.includes(u)&&(T.mustUseProperty=!0),t[u]=T,a[SE(u)]=u,a[SE(T.attribute)]=u}return new n0(t,a,o.space)}const mL=Qy({properties:{ariaActiveDescendant:null,ariaAtomic:Ka,ariaAutoComplete:null,ariaBusy:Ka,ariaChecked:Ka,ariaColCount:In,ariaColIndex:In,ariaColSpan:In,ariaControls:zs,ariaCurrent:null,ariaDescribedBy:zs,ariaDetails:null,ariaDisabled:Ka,ariaDropEffect:zs,ariaErrorMessage:null,ariaExpanded:Ka,ariaFlowTo:zs,ariaGrabbed:Ka,ariaHasPopup:null,ariaHidden:Ka,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:zs,ariaLevel:In,ariaLive:null,ariaModal:Ka,ariaMultiLine:Ka,ariaMultiSelectable:Ka,ariaOrientation:null,ariaOwns:zs,ariaPlaceholder:null,ariaPosInSet:In,ariaPressed:Ka,ariaReadOnly:Ka,ariaRelevant:null,ariaRequired:Ka,ariaRoleDescription:zs,ariaRowCount:In,ariaRowIndex:In,ariaRowSpan:In,ariaSelected:Ka,ariaSetSize:In,ariaSort:null,ariaValueMax:In,ariaValueMin:In,ariaValueNow:In,ariaValueText:null,role:null},transform(o,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function gL(o,t){return t in o?o[t]:t}function _L(o,t){return gL(o,t.toLowerCase())}const O8=Qy({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ry,acceptCharset:zs,accessKey:zs,action:null,allow:null,allowFullScreen:lr,allowPaymentRequest:lr,allowUserMedia:lr,alt:null,as:null,async:lr,autoCapitalize:null,autoComplete:zs,autoFocus:lr,autoPlay:lr,blocking:zs,capture:null,charSet:null,checked:lr,cite:null,className:zs,cols:In,colSpan:null,content:null,contentEditable:Ka,controls:lr,controlsList:zs,coords:In|Ry,crossOrigin:null,data:null,dateTime:null,decoding:null,default:lr,defer:lr,dir:null,dirName:null,disabled:lr,download:AE,draggable:Ka,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:lr,formTarget:null,headers:zs,height:In,hidden:AE,high:In,href:null,hrefLang:null,htmlFor:zs,httpEquiv:zs,id:null,imageSizes:null,imageSrcSet:null,inert:lr,inputMode:null,integrity:null,is:null,isMap:lr,itemId:null,itemProp:zs,itemRef:zs,itemScope:lr,itemType:zs,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:lr,low:In,manifest:null,max:null,maxLength:In,media:null,method:null,min:null,minLength:In,multiple:lr,muted:lr,name:null,nonce:null,noModule:lr,noValidate:lr,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:lr,optimum:In,pattern:null,ping:zs,placeholder:null,playsInline:lr,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:lr,referrerPolicy:null,rel:zs,required:lr,reversed:lr,rows:In,rowSpan:In,sandbox:zs,scope:null,scoped:lr,seamless:lr,selected:lr,shadowRootClonable:lr,shadowRootDelegatesFocus:lr,shadowRootMode:null,shape:null,size:In,sizes:null,slot:null,span:In,spellCheck:Ka,src:null,srcDoc:null,srcLang:null,srcSet:null,start:In,step:null,style:null,tabIndex:In,target:null,title:null,translate:null,type:null,typeMustMatch:lr,useMap:null,value:Ka,width:In,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:zs,axis:null,background:null,bgColor:null,border:In,borderColor:null,bottomMargin:In,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:lr,declare:lr,event:null,face:null,frame:null,frameBorder:null,hSpace:In,leftMargin:In,link:null,longDesc:null,lowSrc:null,marginHeight:In,marginWidth:In,noResize:lr,noHref:lr,noShade:lr,noWrap:lr,object:null,profile:null,prompt:null,rev:null,rightMargin:In,rules:null,scheme:null,scrolling:Ka,standby:null,summary:null,text:null,topMargin:In,valueType:null,version:null,vAlign:null,vLink:null,vSpace:In,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:lr,disableRemotePlayback:lr,prefix:null,property:null,results:In,security:null,unselectable:null},space:"html",transform:_L}),z8=Qy({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:fu,accentHeight:In,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:In,amplitude:In,arabicForm:null,ascent:In,attributeName:null,attributeType:null,azimuth:In,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:In,by:null,calcMode:null,capHeight:In,className:zs,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:In,diffuseConstant:In,direction:null,display:null,dur:null,divisor:In,dominantBaseline:null,download:lr,dx:null,dy:null,edgeMode:null,editable:null,elevation:In,enableBackground:null,end:null,event:null,exponent:In,externalResourcesRequired:null,fill:null,fillOpacity:In,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ry,g2:Ry,glyphName:Ry,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:In,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:In,horizOriginX:In,horizOriginY:In,id:null,ideographic:In,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:In,k:In,k1:In,k2:In,k3:In,k4:In,kernelMatrix:fu,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:In,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:In,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:In,overlineThickness:In,paintOrder:null,panose1:null,path:null,pathLength:In,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:zs,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:In,pointsAtY:In,pointsAtZ:In,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:fu,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:fu,rev:fu,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:fu,requiredFeatures:fu,requiredFonts:fu,requiredFormats:fu,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:In,specularExponent:In,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:In,strikethroughThickness:In,string:null,stroke:null,strokeDashArray:fu,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:In,strokeOpacity:In,strokeWidth:null,style:null,surfaceScale:In,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:fu,tabIndex:In,tableValues:null,target:null,targetX:In,targetY:In,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:fu,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:In,underlineThickness:In,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:In,values:null,vAlphabetic:In,vMathematical:In,vectorEffect:null,vHanging:In,vIdeographic:In,version:null,vertAdvY:In,vertOriginX:In,vertOriginY:In,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:In,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:gL}),yL=Qy({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(o,t){return"xlink:"+t.slice(5).toLowerCase()}}),xL=Qy({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:_L}),vL=Qy({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(o,t){return"xml:"+t.slice(3).toLowerCase()}}),N8={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},B8=/[A-Z]/g,hM=/-[a-z]/g,F8=/^data[-\w.:]+$/i;function V8(o,t){const a=SE(t);let u=t,y=kc;if(a in o.normal)return o.property[o.normal[a]];if(a.length>4&&a.slice(0,4)==="data"&&F8.test(t)){if(t.charAt(4)==="-"){const T=t.slice(5).replace(hM,U8);u="data"+T.charAt(0).toUpperCase()+T.slice(1)}else{const T=t.slice(4);if(!hM.test(T)){let C=T.replace(B8,j8);C.charAt(0)!=="-"&&(C="-"+C),t="data"+C}}y=qS}return new y(u,t)}function j8(o){return"-"+o.toLowerCase()}function U8(o){return o.charAt(1).toUpperCase()}const G8=pL([mL,O8,yL,xL,vL],"html"),HS=pL([mL,z8,yL,xL,vL],"svg");function q8(o){return o.join(" ").trim()}var _y={},LT,dM;function H8(){if(dM)return LT;dM=1;var o=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,t=/\n/g,a=/^\s*/,u=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,y=/^:\s*/,T=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,C=/^[;\s]*/,s=/^\s+|\s+$/g,V=`
`,B="/",W="*",Y="",ae="comment",he="declaration";function Qe(Ke,at){if(typeof Ke!="string")throw new TypeError("First argument must be a string");if(!Ke)return[];at=at||{};var nt=1,Ge=1;function Mt(Ht){var dn=Ht.match(t);dn&&(nt+=dn.length);var wt=Ht.lastIndexOf(V);Ge=~wt?Ht.length-wt:Ge+Ht.length}function cn(){var Ht={line:nt,column:Ge};return function(dn){return dn.position=new St(Ht),Ve(),dn}}function St(Ht){this.start=Ht,this.end={line:nt,column:Ge},this.source=at.source}St.prototype.content=Ke;function Oe(Ht){var dn=new Error(at.source+":"+nt+":"+Ge+": "+Ht);if(dn.reason=Ht,dn.filename=at.source,dn.line=nt,dn.column=Ge,dn.source=Ke,!at.silent)throw dn}function Re(Ht){var dn=Ht.exec(Ke);if(dn){var wt=dn[0];return Mt(wt),Ke=Ke.slice(wt.length),dn}}function Ve(){Re(a)}function Je(Ht){var dn;for(Ht=Ht||[];dn=He();)dn!==!1&&Ht.push(dn);return Ht}function He(){var Ht=cn();if(!(B!=Ke.charAt(0)||W!=Ke.charAt(1))){for(var dn=2;Y!=Ke.charAt(dn)&&(W!=Ke.charAt(dn)||B!=Ke.charAt(dn+1));)++dn;if(dn+=2,Y===Ke.charAt(dn-1))return Oe("End of comment missing");var wt=Ke.slice(2,dn-2);return Ge+=2,Mt(wt),Ke=Ke.slice(dn),Ge+=2,Ht({type:ae,comment:wt})}}function tt(){var Ht=cn(),dn=Re(u);if(dn){if(He(),!Re(y))return Oe("property missing ':'");var wt=Re(T),Kt=Ht({type:he,property:Ye(dn[0].replace(o,Y)),value:wt?Ye(wt[0].replace(o,Y)):Y});return Re(C),Kt}}function ve(){var Ht=[];Je(Ht);for(var dn;dn=tt();)dn!==!1&&(Ht.push(dn),Je(Ht));return Ht}return Ve(),ve()}function Ye(Ke){return Ke?Ke.replace(s,Y):Y}return LT=Qe,LT}var fM;function $8(){if(fM)return _y;fM=1;var o=_y&&_y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(_y,"__esModule",{value:!0}),_y.default=a;const t=o(H8());function a(u,y){let T=null;if(!u||typeof u!="string")return T;const C=(0,t.default)(u),s=typeof y=="function";return C.forEach(V=>{if(V.type!=="declaration")return;const{property:B,value:W}=V;s?y(B,W,V):W&&(T=T||{},T[B]=W)}),T}return _y}var uv={},pM;function Z8(){if(pM)return uv;pM=1,Object.defineProperty(uv,"__esModule",{value:!0}),uv.camelCase=void 0;var o=/^--[a-zA-Z0-9_-]+$/,t=/-([a-z])/g,a=/^[^-]+$/,u=/^-(webkit|moz|ms|o|khtml)-/,y=/^-(ms)-/,T=function(B){return!B||a.test(B)||o.test(B)},C=function(B,W){return W.toUpperCase()},s=function(B,W){return"".concat(W,"-")},V=function(B,W){return W===void 0&&(W={}),T(B)?B:(B=B.toLowerCase(),W.reactCompat?B=B.replace(y,s):B=B.replace(u,s),B.replace(t,C))};return uv.camelCase=V,uv}var hv,mM;function W8(){if(mM)return hv;mM=1;var o=hv&&hv.__importDefault||function(y){return y&&y.__esModule?y:{default:y}},t=o($8()),a=Z8();function u(y,T){var C={};return!y||typeof y!="string"||(0,t.default)(y,function(s,V){s&&V&&(C[(0,a.camelCase)(s,T)]=V)}),C}return u.default=u,hv=u,hv}var X8=W8();const Y8=Uv(X8),bL=wL("end"),$S=wL("start");function wL(o){return t;function t(a){const u=a&&a.position&&a.position[o]||{};if(typeof u.line=="number"&&u.line>0&&typeof u.column=="number"&&u.column>0)return{line:u.line,column:u.column,offset:typeof u.offset=="number"&&u.offset>-1?u.offset:void 0}}}function K8(o){const t=$S(o),a=bL(o);if(t&&a)return{start:t,end:a}}function Av(o){return!o||typeof o!="object"?"":"position"in o||"type"in o?gM(o.position):"start"in o||"end"in o?gM(o):"line"in o||"column"in o?CE(o):""}function CE(o){return _M(o&&o.line)+":"+_M(o&&o.column)}function gM(o){return CE(o&&o.start)+"-"+CE(o&&o.end)}function _M(o){return o&&typeof o=="number"?o:1}class Cl extends Error{constructor(t,a,u){super(),typeof a=="string"&&(u=a,a=void 0);let y="",T={},C=!1;if(a&&("line"in a&&"column"in a?T={place:a}:"start"in a&&"end"in a?T={place:a}:"type"in a?T={ancestors:[a],place:a.position}:T={...a}),typeof t=="string"?y=t:!T.cause&&t&&(C=!0,y=t.message,T.cause=t),!T.ruleId&&!T.source&&typeof u=="string"){const V=u.indexOf(":");V===-1?T.ruleId=u:(T.source=u.slice(0,V),T.ruleId=u.slice(V+1))}if(!T.place&&T.ancestors&&T.ancestors){const V=T.ancestors[T.ancestors.length-1];V&&(T.place=V.position)}const s=T.place&&"start"in T.place?T.place.start:T.place;this.ancestors=T.ancestors||void 0,this.cause=T.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file="",this.message=y,this.line=s?s.line:void 0,this.name=Av(T.place)||"1:1",this.place=T.place||void 0,this.reason=this.message,this.ruleId=T.ruleId||void 0,this.source=T.source||void 0,this.stack=C&&T.cause&&typeof T.cause.stack=="string"?T.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Cl.prototype.file="";Cl.prototype.name="";Cl.prototype.reason="";Cl.prototype.message="";Cl.prototype.stack="";Cl.prototype.column=void 0;Cl.prototype.line=void 0;Cl.prototype.ancestors=void 0;Cl.prototype.cause=void 0;Cl.prototype.fatal=void 0;Cl.prototype.place=void 0;Cl.prototype.ruleId=void 0;Cl.prototype.source=void 0;const ZS={}.hasOwnProperty,Q8=new Map,J8=/[A-Z]/g,e9=new Set(["table","tbody","thead","tfoot","tr"]),t9=new Set(["td","th"]),TL="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function n9(o,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const a=t.filePath||void 0;let u;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");u=u9(a,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");u=c9(a,t.jsx,t.jsxs)}const y={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:u,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:a,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?HS:G8,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},T=EL(y,o,void 0);return T&&typeof T!="string"?T:y.create(o,y.Fragment,{children:T||void 0},void 0)}function EL(o,t,a){if(t.type==="element")return i9(o,t,a);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return r9(o,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return a9(o,t,a);if(t.type==="mdxjsEsm")return s9(o,t);if(t.type==="root")return o9(o,t,a);if(t.type==="text")return l9(o,t)}function i9(o,t,a){const u=o.schema;let y=u;t.tagName.toLowerCase()==="svg"&&u.space==="html"&&(y=HS,o.schema=y),o.ancestors.push(t);const T=AL(o,t.tagName,!1),C=h9(o,t);let s=XS(o,t);return e9.has(t.tagName)&&(s=s.filter(function(V){return typeof V=="string"?!k8(V):!0})),SL(o,C,T,t),WS(C,s),o.ancestors.pop(),o.schema=u,o.create(t,T,C,a)}function r9(o,t){if(t.data&&t.data.estree&&o.evaluater){const u=t.data.estree.body[0];return u.type,o.evaluater.evaluateExpression(u.expression)}jv(o,t.position)}function s9(o,t){if(t.data&&t.data.estree&&o.evaluater)return o.evaluater.evaluateProgram(t.data.estree);jv(o,t.position)}function a9(o,t,a){const u=o.schema;let y=u;t.name==="svg"&&u.space==="html"&&(y=HS,o.schema=y),o.ancestors.push(t);const T=t.name===null?o.Fragment:AL(o,t.name,!0),C=d9(o,t),s=XS(o,t);return SL(o,C,T,t),WS(C,s),o.ancestors.pop(),o.schema=u,o.create(t,T,C,a)}function o9(o,t,a){const u={};return WS(u,XS(o,t)),o.create(t,o.Fragment,u,a)}function l9(o,t){return t.value}function SL(o,t,a,u){typeof a!="string"&&a!==o.Fragment&&o.passNode&&(t.node=u)}function WS(o,t){if(t.length>0){const a=t.length>1?t:t[0];a&&(o.children=a)}}function c9(o,t,a){return u;function u(y,T,C,s){const B=Array.isArray(C.children)?a:t;return s?B(T,C,s):B(T,C)}}function u9(o,t){return a;function a(u,y,T,C){const s=Array.isArray(T.children),V=$S(u);return t(y,T,C,s,{columnNumber:V?V.column-1:void 0,fileName:o,lineNumber:V?V.line:void 0},void 0)}}function h9(o,t){const a={};let u,y;for(y in t.properties)if(y!=="children"&&ZS.call(t.properties,y)){const T=f9(o,y,t.properties[y]);if(T){const[C,s]=T;o.tableCellAlignToStyle&&C==="align"&&typeof s=="string"&&t9.has(t.tagName)?u=s:a[C]=s}}if(u){const T=a.style||(a.style={});T[o.stylePropertyNameCase==="css"?"text-align":"textAlign"]=u}return a}function d9(o,t){const a={};for(const u of t.attributes)if(u.type==="mdxJsxExpressionAttribute")if(u.data&&u.data.estree&&o.evaluater){const T=u.data.estree.body[0];T.type;const C=T.expression;C.type;const s=C.properties[0];s.type,Object.assign(a,o.evaluater.evaluateExpression(s.argument))}else jv(o,t.position);else{const y=u.name;let T;if(u.value&&typeof u.value=="object")if(u.value.data&&u.value.data.estree&&o.evaluater){const s=u.value.data.estree.body[0];s.type,T=o.evaluater.evaluateExpression(s.expression)}else jv(o,t.position);else T=u.value===null?!0:u.value;a[y]=T}return a}function XS(o,t){const a=[];let u=-1;const y=o.passKeys?new Map:Q8;for(;++u<t.children.length;){const T=t.children[u];let C;if(o.passKeys){const V=T.type==="element"?T.tagName:T.type==="mdxJsxFlowElement"||T.type==="mdxJsxTextElement"?T.name:void 0;if(V){const B=y.get(V)||0;C=V+"-"+B,y.set(V,B+1)}}const s=EL(o,T,C);s!==void 0&&a.push(s)}return a}function f9(o,t,a){const u=V8(o.schema,t);if(!(a==null||typeof a=="number"&&Number.isNaN(a))){if(Array.isArray(a)&&(a=u.commaSeparated?C8(a):q8(a)),u.property==="style"){let y=typeof a=="object"?a:p9(o,String(a));return o.stylePropertyNameCase==="css"&&(y=m9(y)),["style",y]}return[o.elementAttributeNameCase==="react"&&u.space?N8[u.property]||u.property:u.attribute,a]}}function p9(o,t){try{return Y8(t,{reactCompat:!0})}catch(a){if(o.ignoreInvalidStyle)return{};const u=a,y=new Cl("Cannot parse `style` attribute",{ancestors:o.ancestors,cause:u,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw y.file=o.filePath||void 0,y.url=TL+"#cannot-parse-style-attribute",y}}function AL(o,t,a){let u;if(!a)u={type:"Literal",value:t};else if(t.includes(".")){const y=t.split(".");let T=-1,C;for(;++T<y.length;){const s=lM(y[T])?{type:"Identifier",name:y[T]}:{type:"Literal",value:y[T]};C=C?{type:"MemberExpression",object:C,property:s,computed:!!(T&&s.type==="Literal"),optional:!1}:s}u=C}else u=lM(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(u.type==="Literal"){const y=u.value;return ZS.call(o.components,y)?o.components[y]:y}if(o.evaluater)return o.evaluater.evaluateExpression(u);jv(o)}function jv(o,t){const a=new Cl("Cannot handle MDX estrees without `createEvaluater`",{ancestors:o.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw a.file=o.filePath||void 0,a.url=TL+"#cannot-handle-mdx-estrees-without-createevaluater",a}function m9(o){const t={};let a;for(a in o)ZS.call(o,a)&&(t[g9(a)]=o[a]);return t}function g9(o){let t=o.replace(J8,_9);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function _9(o){return"-"+o.toLowerCase()}const OT={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},y9={};function x9(o,t){const a=y9,u=typeof a.includeImageAlt=="boolean"?a.includeImageAlt:!0,y=typeof a.includeHtml=="boolean"?a.includeHtml:!0;return IL(o,u,y)}function IL(o,t,a){if(v9(o)){if("value"in o)return o.type==="html"&&!a?"":o.value;if(t&&"alt"in o&&o.alt)return o.alt;if("children"in o)return yM(o.children,t,a)}return Array.isArray(o)?yM(o,t,a):""}function yM(o,t,a){const u=[];let y=-1;for(;++y<o.length;)u[y]=IL(o[y],t,a);return u.join("")}function v9(o){return!!(o&&typeof o=="object")}const xM=document.createElement("i");function YS(o){const t="&"+o+";";xM.innerHTML=t;const a=xM.textContent;return a.charCodeAt(a.length-1)===59&&o!=="semi"||a===t?!1:a}function uf(o,t,a,u){const y=o.length;let T=0,C;if(t<0?t=-t>y?0:y+t:t=t>y?y:t,a=a>0?a:0,u.length<1e4)C=Array.from(u),C.unshift(t,a),o.splice(...C);else for(a&&o.splice(t,a);T<u.length;)C=u.slice(T,T+1e4),C.unshift(t,0),o.splice(...C),T+=1e4,t+=1e4}function Yu(o,t){return o.length>0?(uf(o,o.length,0,t),o):t}const vM={}.hasOwnProperty;function b9(o){const t={};let a=-1;for(;++a<o.length;)w9(t,o[a]);return t}function w9(o,t){let a;for(a in t){const y=(vM.call(o,a)?o[a]:void 0)||(o[a]={}),T=t[a];let C;if(T)for(C in T){vM.call(y,C)||(y[C]=[]);const s=T[C];T9(y[C],Array.isArray(s)?s:s?[s]:[])}}}function T9(o,t){let a=-1;const u=[];for(;++a<t.length;)(t[a].add==="after"?o:u).push(t[a]);uf(o,0,0,u)}function CL(o,t){const a=Number.parseInt(o,t);return a<9||a===11||a>13&&a<32||a>126&&a<160||a>55295&&a<57344||a>64975&&a<65008||(a&65535)===65535||(a&65535)===65534||a>1114111?"":String.fromCodePoint(a)}function My(o){return o.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const tf=Zm(/[A-Za-z]/),pu=Zm(/[\dA-Za-z]/),E9=Zm(/[#-'*+\--9=?A-Z^-~]/);function RE(o){return o!==null&&(o<32||o===127)}const ME=Zm(/\d/),S9=Zm(/[\dA-Fa-f]/),A9=Zm(/[!-/:-@[-`{-~]/);function Ui(o){return o!==null&&o<-2}function Pc(o){return o!==null&&(o<0||o===32)}function us(o){return o===-2||o===-1||o===32}const I9=Zm(new RegExp("\\p{P}|\\p{S}","u")),C9=Zm(/\s/);function Zm(o){return t;function t(a){return a!==null&&a>-1&&o.test(String.fromCharCode(a))}}function Jy(o){const t=[];let a=-1,u=0,y=0;for(;++a<o.length;){const T=o.charCodeAt(a);let C="";if(T===37&&pu(o.charCodeAt(a+1))&&pu(o.charCodeAt(a+2)))y=2;else if(T<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(T))||(C=String.fromCharCode(T));else if(T>55295&&T<57344){const s=o.charCodeAt(a+1);T<56320&&s>56319&&s<57344?(C=String.fromCharCode(T,s),y=1):C=""}else C=String.fromCharCode(T);C&&(t.push(o.slice(u,a),encodeURIComponent(C)),u=a+y+1,C=""),y&&(a+=y,y=0)}return t.join("")+o.slice(u)}function Bs(o,t,a,u){const y=u?u-1:Number.POSITIVE_INFINITY;let T=0;return C;function C(V){return us(V)?(o.enter(a),s(V)):t(V)}function s(V){return us(V)&&T++<y?(o.consume(V),s):(o.exit(a),t(V))}}const R9={tokenize:M9};function M9(o){const t=o.attempt(this.parser.constructs.contentInitial,u,y);let a;return t;function u(s){if(s===null){o.consume(s);return}return o.enter("lineEnding"),o.consume(s),o.exit("lineEnding"),Bs(o,t,"linePrefix")}function y(s){return o.enter("paragraph"),T(s)}function T(s){const V=o.enter("chunkText",{contentType:"text",previous:a});return a&&(a.next=V),a=V,C(s)}function C(s){if(s===null){o.exit("chunkText"),o.exit("paragraph"),o.consume(s);return}return Ui(s)?(o.consume(s),o.exit("chunkText"),T):(o.consume(s),C)}}const D9={tokenize:P9},bM={tokenize:k9};function P9(o){const t=this,a=[];let u=0,y,T,C;return s;function s(Ge){if(u<a.length){const Mt=a[u];return t.containerState=Mt[1],o.attempt(Mt[0].continuation,V,B)(Ge)}return B(Ge)}function V(Ge){if(u++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,y&&nt();const Mt=t.events.length;let cn=Mt,St;for(;cn--;)if(t.events[cn][0]==="exit"&&t.events[cn][1].type==="chunkFlow"){St=t.events[cn][1].end;break}at(u);let Oe=Mt;for(;Oe<t.events.length;)t.events[Oe][1].end={...St},Oe++;return uf(t.events,cn+1,0,t.events.slice(Mt)),t.events.length=Oe,B(Ge)}return s(Ge)}function B(Ge){if(u===a.length){if(!y)return ae(Ge);if(y.currentConstruct&&y.currentConstruct.concrete)return Qe(Ge);t.interrupt=!!(y.currentConstruct&&!y._gfmTableDynamicInterruptHack)}return t.containerState={},o.check(bM,W,Y)(Ge)}function W(Ge){return y&&nt(),at(u),ae(Ge)}function Y(Ge){return t.parser.lazy[t.now().line]=u!==a.length,C=t.now().offset,Qe(Ge)}function ae(Ge){return t.containerState={},o.attempt(bM,he,Qe)(Ge)}function he(Ge){return u++,a.push([t.currentConstruct,t.containerState]),ae(Ge)}function Qe(Ge){if(Ge===null){y&&nt(),at(0),o.consume(Ge);return}return y=y||t.parser.flow(t.now()),o.enter("chunkFlow",{_tokenizer:y,contentType:"flow",previous:T}),Ye(Ge)}function Ye(Ge){if(Ge===null){Ke(o.exit("chunkFlow"),!0),at(0),o.consume(Ge);return}return Ui(Ge)?(o.consume(Ge),Ke(o.exit("chunkFlow")),u=0,t.interrupt=void 0,s):(o.consume(Ge),Ye)}function Ke(Ge,Mt){const cn=t.sliceStream(Ge);if(Mt&&cn.push(null),Ge.previous=T,T&&(T.next=Ge),T=Ge,y.defineSkip(Ge.start),y.write(cn),t.parser.lazy[Ge.start.line]){let St=y.events.length;for(;St--;)if(y.events[St][1].start.offset<C&&(!y.events[St][1].end||y.events[St][1].end.offset>C))return;const Oe=t.events.length;let Re=Oe,Ve,Je;for(;Re--;)if(t.events[Re][0]==="exit"&&t.events[Re][1].type==="chunkFlow"){if(Ve){Je=t.events[Re][1].end;break}Ve=!0}for(at(u),St=Oe;St<t.events.length;)t.events[St][1].end={...Je},St++;uf(t.events,Re+1,0,t.events.slice(Oe)),t.events.length=St}}function at(Ge){let Mt=a.length;for(;Mt-- >Ge;){const cn=a[Mt];t.containerState=cn[1],cn[0].exit.call(t,o)}a.length=Ge}function nt(){y.write([null]),T=void 0,y=void 0,t.containerState._closeFlow=void 0}}function k9(o,t,a){return Bs(o,o.attempt(this.parser.constructs.document,t,a),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function wM(o){if(o===null||Pc(o)||C9(o))return 1;if(I9(o))return 2}function KS(o,t,a){const u=[];let y=-1;for(;++y<o.length;){const T=o[y].resolveAll;T&&!u.includes(T)&&(t=T(t,a),u.push(T))}return t}const DE={name:"attention",resolveAll:L9,tokenize:O9};function L9(o,t){let a=-1,u,y,T,C,s,V,B,W;for(;++a<o.length;)if(o[a][0]==="enter"&&o[a][1].type==="attentionSequence"&&o[a][1]._close){for(u=a;u--;)if(o[u][0]==="exit"&&o[u][1].type==="attentionSequence"&&o[u][1]._open&&t.sliceSerialize(o[u][1]).charCodeAt(0)===t.sliceSerialize(o[a][1]).charCodeAt(0)){if((o[u][1]._close||o[a][1]._open)&&(o[a][1].end.offset-o[a][1].start.offset)%3&&!((o[u][1].end.offset-o[u][1].start.offset+o[a][1].end.offset-o[a][1].start.offset)%3))continue;V=o[u][1].end.offset-o[u][1].start.offset>1&&o[a][1].end.offset-o[a][1].start.offset>1?2:1;const Y={...o[u][1].end},ae={...o[a][1].start};TM(Y,-V),TM(ae,V),C={type:V>1?"strongSequence":"emphasisSequence",start:Y,end:{...o[u][1].end}},s={type:V>1?"strongSequence":"emphasisSequence",start:{...o[a][1].start},end:ae},T={type:V>1?"strongText":"emphasisText",start:{...o[u][1].end},end:{...o[a][1].start}},y={type:V>1?"strong":"emphasis",start:{...C.start},end:{...s.end}},o[u][1].end={...C.start},o[a][1].start={...s.end},B=[],o[u][1].end.offset-o[u][1].start.offset&&(B=Yu(B,[["enter",o[u][1],t],["exit",o[u][1],t]])),B=Yu(B,[["enter",y,t],["enter",C,t],["exit",C,t],["enter",T,t]]),B=Yu(B,KS(t.parser.constructs.insideSpan.null,o.slice(u+1,a),t)),B=Yu(B,[["exit",T,t],["enter",s,t],["exit",s,t],["exit",y,t]]),o[a][1].end.offset-o[a][1].start.offset?(W=2,B=Yu(B,[["enter",o[a][1],t],["exit",o[a][1],t]])):W=0,uf(o,u-1,a-u+3,B),a=u+B.length-W-2;break}}for(a=-1;++a<o.length;)o[a][1].type==="attentionSequence"&&(o[a][1].type="data");return o}function O9(o,t){const a=this.parser.constructs.attentionMarkers.null,u=this.previous,y=wM(u);let T;return C;function C(V){return T=V,o.enter("attentionSequence"),s(V)}function s(V){if(V===T)return o.consume(V),s;const B=o.exit("attentionSequence"),W=wM(V),Y=!W||W===2&&y||a.includes(V),ae=!y||y===2&&W||a.includes(u);return B._open=!!(T===42?Y:Y&&(y||!ae)),B._close=!!(T===42?ae:ae&&(W||!Y)),t(V)}}function TM(o,t){o.column+=t,o.offset+=t,o._bufferIndex+=t}const z9={name:"autolink",tokenize:N9};function N9(o,t,a){let u=0;return y;function y(he){return o.enter("autolink"),o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.enter("autolinkProtocol"),T}function T(he){return tf(he)?(o.consume(he),C):he===64?a(he):B(he)}function C(he){return he===43||he===45||he===46||pu(he)?(u=1,s(he)):B(he)}function s(he){return he===58?(o.consume(he),u=0,V):(he===43||he===45||he===46||pu(he))&&u++<32?(o.consume(he),s):(u=0,B(he))}function V(he){return he===62?(o.exit("autolinkProtocol"),o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.exit("autolink"),t):he===null||he===32||he===60||RE(he)?a(he):(o.consume(he),V)}function B(he){return he===64?(o.consume(he),W):E9(he)?(o.consume(he),B):a(he)}function W(he){return pu(he)?Y(he):a(he)}function Y(he){return he===46?(o.consume(he),u=0,W):he===62?(o.exit("autolinkProtocol").type="autolinkEmail",o.enter("autolinkMarker"),o.consume(he),o.exit("autolinkMarker"),o.exit("autolink"),t):ae(he)}function ae(he){if((he===45||pu(he))&&u++<63){const Qe=he===45?ae:Y;return o.consume(he),Qe}return a(he)}}const U1={partial:!0,tokenize:B9};function B9(o,t,a){return u;function u(T){return us(T)?Bs(o,y,"linePrefix")(T):y(T)}function y(T){return T===null||Ui(T)?t(T):a(T)}}const RL={continuation:{tokenize:V9},exit:j9,name:"blockQuote",tokenize:F9};function F9(o,t,a){const u=this;return y;function y(C){if(C===62){const s=u.containerState;return s.open||(o.enter("blockQuote",{_container:!0}),s.open=!0),o.enter("blockQuotePrefix"),o.enter("blockQuoteMarker"),o.consume(C),o.exit("blockQuoteMarker"),T}return a(C)}function T(C){return us(C)?(o.enter("blockQuotePrefixWhitespace"),o.consume(C),o.exit("blockQuotePrefixWhitespace"),o.exit("blockQuotePrefix"),t):(o.exit("blockQuotePrefix"),t(C))}}function V9(o,t,a){const u=this;return y;function y(C){return us(C)?Bs(o,T,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):T(C)}function T(C){return o.attempt(RL,t,a)(C)}}function j9(o){o.exit("blockQuote")}const ML={name:"characterEscape",tokenize:U9};function U9(o,t,a){return u;function u(T){return o.enter("characterEscape"),o.enter("escapeMarker"),o.consume(T),o.exit("escapeMarker"),y}function y(T){return A9(T)?(o.enter("characterEscapeValue"),o.consume(T),o.exit("characterEscapeValue"),o.exit("characterEscape"),t):a(T)}}const DL={name:"characterReference",tokenize:G9};function G9(o,t,a){const u=this;let y=0,T,C;return s;function s(Y){return o.enter("characterReference"),o.enter("characterReferenceMarker"),o.consume(Y),o.exit("characterReferenceMarker"),V}function V(Y){return Y===35?(o.enter("characterReferenceMarkerNumeric"),o.consume(Y),o.exit("characterReferenceMarkerNumeric"),B):(o.enter("characterReferenceValue"),T=31,C=pu,W(Y))}function B(Y){return Y===88||Y===120?(o.enter("characterReferenceMarkerHexadecimal"),o.consume(Y),o.exit("characterReferenceMarkerHexadecimal"),o.enter("characterReferenceValue"),T=6,C=S9,W):(o.enter("characterReferenceValue"),T=7,C=ME,W(Y))}function W(Y){if(Y===59&&y){const ae=o.exit("characterReferenceValue");return C===pu&&!YS(u.sliceSerialize(ae))?a(Y):(o.enter("characterReferenceMarker"),o.consume(Y),o.exit("characterReferenceMarker"),o.exit("characterReference"),t)}return C(Y)&&y++<T?(o.consume(Y),W):a(Y)}}const EM={partial:!0,tokenize:H9},SM={concrete:!0,name:"codeFenced",tokenize:q9};function q9(o,t,a){const u=this,y={partial:!0,tokenize:cn};let T=0,C=0,s;return V;function V(St){return B(St)}function B(St){const Oe=u.events[u.events.length-1];return T=Oe&&Oe[1].type==="linePrefix"?Oe[2].sliceSerialize(Oe[1],!0).length:0,s=St,o.enter("codeFenced"),o.enter("codeFencedFence"),o.enter("codeFencedFenceSequence"),W(St)}function W(St){return St===s?(C++,o.consume(St),W):C<3?a(St):(o.exit("codeFencedFenceSequence"),us(St)?Bs(o,Y,"whitespace")(St):Y(St))}function Y(St){return St===null||Ui(St)?(o.exit("codeFencedFence"),u.interrupt?t(St):o.check(EM,Ye,Mt)(St)):(o.enter("codeFencedFenceInfo"),o.enter("chunkString",{contentType:"string"}),ae(St))}function ae(St){return St===null||Ui(St)?(o.exit("chunkString"),o.exit("codeFencedFenceInfo"),Y(St)):us(St)?(o.exit("chunkString"),o.exit("codeFencedFenceInfo"),Bs(o,he,"whitespace")(St)):St===96&&St===s?a(St):(o.consume(St),ae)}function he(St){return St===null||Ui(St)?Y(St):(o.enter("codeFencedFenceMeta"),o.enter("chunkString",{contentType:"string"}),Qe(St))}function Qe(St){return St===null||Ui(St)?(o.exit("chunkString"),o.exit("codeFencedFenceMeta"),Y(St)):St===96&&St===s?a(St):(o.consume(St),Qe)}function Ye(St){return o.attempt(y,Mt,Ke)(St)}function Ke(St){return o.enter("lineEnding"),o.consume(St),o.exit("lineEnding"),at}function at(St){return T>0&&us(St)?Bs(o,nt,"linePrefix",T+1)(St):nt(St)}function nt(St){return St===null||Ui(St)?o.check(EM,Ye,Mt)(St):(o.enter("codeFlowValue"),Ge(St))}function Ge(St){return St===null||Ui(St)?(o.exit("codeFlowValue"),nt(St)):(o.consume(St),Ge)}function Mt(St){return o.exit("codeFenced"),t(St)}function cn(St,Oe,Re){let Ve=0;return Je;function Je(dn){return St.enter("lineEnding"),St.consume(dn),St.exit("lineEnding"),He}function He(dn){return St.enter("codeFencedFence"),us(dn)?Bs(St,tt,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(dn):tt(dn)}function tt(dn){return dn===s?(St.enter("codeFencedFenceSequence"),ve(dn)):Re(dn)}function ve(dn){return dn===s?(Ve++,St.consume(dn),ve):Ve>=C?(St.exit("codeFencedFenceSequence"),us(dn)?Bs(St,Ht,"whitespace")(dn):Ht(dn)):Re(dn)}function Ht(dn){return dn===null||Ui(dn)?(St.exit("codeFencedFence"),Oe(dn)):Re(dn)}}}function H9(o,t,a){const u=this;return y;function y(C){return C===null?a(C):(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),T)}function T(C){return u.parser.lazy[u.now().line]?a(C):t(C)}}const zT={name:"codeIndented",tokenize:Z9},$9={partial:!0,tokenize:W9};function Z9(o,t,a){const u=this;return y;function y(B){return o.enter("codeIndented"),Bs(o,T,"linePrefix",5)(B)}function T(B){const W=u.events[u.events.length-1];return W&&W[1].type==="linePrefix"&&W[2].sliceSerialize(W[1],!0).length>=4?C(B):a(B)}function C(B){return B===null?V(B):Ui(B)?o.attempt($9,C,V)(B):(o.enter("codeFlowValue"),s(B))}function s(B){return B===null||Ui(B)?(o.exit("codeFlowValue"),C(B)):(o.consume(B),s)}function V(B){return o.exit("codeIndented"),t(B)}}function W9(o,t,a){const u=this;return y;function y(C){return u.parser.lazy[u.now().line]?a(C):Ui(C)?(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),y):Bs(o,T,"linePrefix",5)(C)}function T(C){const s=u.events[u.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(C):Ui(C)?y(C):a(C)}}const X9={name:"codeText",previous:K9,resolve:Y9,tokenize:Q9};function Y9(o){let t=o.length-4,a=3,u,y;if((o[a][1].type==="lineEnding"||o[a][1].type==="space")&&(o[t][1].type==="lineEnding"||o[t][1].type==="space")){for(u=a;++u<t;)if(o[u][1].type==="codeTextData"){o[a][1].type="codeTextPadding",o[t][1].type="codeTextPadding",a+=2,t-=2;break}}for(u=a-1,t++;++u<=t;)y===void 0?u!==t&&o[u][1].type!=="lineEnding"&&(y=u):(u===t||o[u][1].type==="lineEnding")&&(o[y][1].type="codeTextData",u!==y+2&&(o[y][1].end=o[u-1][1].end,o.splice(y+2,u-y-2),t-=u-y-2,u=y+2),y=void 0);return o}function K9(o){return o!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Q9(o,t,a){let u=0,y,T;return C;function C(Y){return o.enter("codeText"),o.enter("codeTextSequence"),s(Y)}function s(Y){return Y===96?(o.consume(Y),u++,s):(o.exit("codeTextSequence"),V(Y))}function V(Y){return Y===null?a(Y):Y===32?(o.enter("space"),o.consume(Y),o.exit("space"),V):Y===96?(T=o.enter("codeTextSequence"),y=0,W(Y)):Ui(Y)?(o.enter("lineEnding"),o.consume(Y),o.exit("lineEnding"),V):(o.enter("codeTextData"),B(Y))}function B(Y){return Y===null||Y===32||Y===96||Ui(Y)?(o.exit("codeTextData"),V(Y)):(o.consume(Y),B)}function W(Y){return Y===96?(o.consume(Y),y++,W):y===u?(o.exit("codeTextSequence"),o.exit("codeText"),t(Y)):(T.type="codeTextData",B(Y))}}class J9{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,a){const u=a??Number.POSITIVE_INFINITY;return u<this.left.length?this.left.slice(t,u):t>this.left.length?this.right.slice(this.right.length-u+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-u+this.left.length).reverse())}splice(t,a,u){const y=a||0;this.setCursor(Math.trunc(t));const T=this.right.splice(this.right.length-y,Number.POSITIVE_INFINITY);return u&&dv(this.left,u),T.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),dv(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),dv(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const a=this.left.splice(t,Number.POSITIVE_INFINITY);dv(this.right,a.reverse())}else{const a=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);dv(this.left,a.reverse())}}}function dv(o,t){let a=0;if(t.length<1e4)o.push(...t);else for(;a<t.length;)o.push(...t.slice(a,a+1e4)),a+=1e4}function PL(o){const t={};let a=-1,u,y,T,C,s,V,B;const W=new J9(o);for(;++a<W.length;){for(;a in t;)a=t[a];if(u=W.get(a),a&&u[1].type==="chunkFlow"&&W.get(a-1)[1].type==="listItemPrefix"&&(V=u[1]._tokenizer.events,T=0,T<V.length&&V[T][1].type==="lineEndingBlank"&&(T+=2),T<V.length&&V[T][1].type==="content"))for(;++T<V.length&&V[T][1].type!=="content";)V[T][1].type==="chunkText"&&(V[T][1]._isInFirstContentOfListItem=!0,T++);if(u[0]==="enter")u[1].contentType&&(Object.assign(t,eG(W,a)),a=t[a],B=!0);else if(u[1]._container){for(T=a,y=void 0;T--;)if(C=W.get(T),C[1].type==="lineEnding"||C[1].type==="lineEndingBlank")C[0]==="enter"&&(y&&(W.get(y)[1].type="lineEndingBlank"),C[1].type="lineEnding",y=T);else if(!(C[1].type==="linePrefix"||C[1].type==="listItemIndent"))break;y&&(u[1].end={...W.get(y)[1].start},s=W.slice(y,a),s.unshift(u),W.splice(y,a-y+1,s))}}return uf(o,0,Number.POSITIVE_INFINITY,W.slice(0)),!B}function eG(o,t){const a=o.get(t)[1],u=o.get(t)[2];let y=t-1;const T=[];let C=a._tokenizer;C||(C=u.parser[a.contentType](a.start),a._contentTypeTextTrailing&&(C._contentTypeTextTrailing=!0));const s=C.events,V=[],B={};let W,Y,ae=-1,he=a,Qe=0,Ye=0;const Ke=[Ye];for(;he;){for(;o.get(++y)[1]!==he;);T.push(y),he._tokenizer||(W=u.sliceStream(he),he.next||W.push(null),Y&&C.defineSkip(he.start),he._isInFirstContentOfListItem&&(C._gfmTasklistFirstContentOfListItem=!0),C.write(W),he._isInFirstContentOfListItem&&(C._gfmTasklistFirstContentOfListItem=void 0)),Y=he,he=he.next}for(he=a;++ae<s.length;)s[ae][0]==="exit"&&s[ae-1][0]==="enter"&&s[ae][1].type===s[ae-1][1].type&&s[ae][1].start.line!==s[ae][1].end.line&&(Ye=ae+1,Ke.push(Ye),he._tokenizer=void 0,he.previous=void 0,he=he.next);for(C.events=[],he?(he._tokenizer=void 0,he.previous=void 0):Ke.pop(),ae=Ke.length;ae--;){const at=s.slice(Ke[ae],Ke[ae+1]),nt=T.pop();V.push([nt,nt+at.length-1]),o.splice(nt,2,at)}for(V.reverse(),ae=-1;++ae<V.length;)B[Qe+V[ae][0]]=Qe+V[ae][1],Qe+=V[ae][1]-V[ae][0]-1;return B}const tG={resolve:iG,tokenize:rG},nG={partial:!0,tokenize:sG};function iG(o){return PL(o),o}function rG(o,t){let a;return u;function u(s){return o.enter("content"),a=o.enter("chunkContent",{contentType:"content"}),y(s)}function y(s){return s===null?T(s):Ui(s)?o.check(nG,C,T)(s):(o.consume(s),y)}function T(s){return o.exit("chunkContent"),o.exit("content"),t(s)}function C(s){return o.consume(s),o.exit("chunkContent"),a.next=o.enter("chunkContent",{contentType:"content",previous:a}),a=a.next,y}}function sG(o,t,a){const u=this;return y;function y(C){return o.exit("chunkContent"),o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),Bs(o,T,"linePrefix")}function T(C){if(C===null||Ui(C))return a(C);const s=u.events[u.events.length-1];return!u.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(C):o.interrupt(u.parser.constructs.flow,a,t)(C)}}function kL(o,t,a,u,y,T,C,s,V){const B=V||Number.POSITIVE_INFINITY;let W=0;return Y;function Y(at){return at===60?(o.enter(u),o.enter(y),o.enter(T),o.consume(at),o.exit(T),ae):at===null||at===32||at===41||RE(at)?a(at):(o.enter(u),o.enter(C),o.enter(s),o.enter("chunkString",{contentType:"string"}),Ye(at))}function ae(at){return at===62?(o.enter(T),o.consume(at),o.exit(T),o.exit(y),o.exit(u),t):(o.enter(s),o.enter("chunkString",{contentType:"string"}),he(at))}function he(at){return at===62?(o.exit("chunkString"),o.exit(s),ae(at)):at===null||at===60||Ui(at)?a(at):(o.consume(at),at===92?Qe:he)}function Qe(at){return at===60||at===62||at===92?(o.consume(at),he):he(at)}function Ye(at){return!W&&(at===null||at===41||Pc(at))?(o.exit("chunkString"),o.exit(s),o.exit(C),o.exit(u),t(at)):W<B&&at===40?(o.consume(at),W++,Ye):at===41?(o.consume(at),W--,Ye):at===null||at===32||at===40||RE(at)?a(at):(o.consume(at),at===92?Ke:Ye)}function Ke(at){return at===40||at===41||at===92?(o.consume(at),Ye):Ye(at)}}function LL(o,t,a,u,y,T){const C=this;let s=0,V;return B;function B(he){return o.enter(u),o.enter(y),o.consume(he),o.exit(y),o.enter(T),W}function W(he){return s>999||he===null||he===91||he===93&&!V||he===94&&!s&&"_hiddenFootnoteSupport"in C.parser.constructs?a(he):he===93?(o.exit(T),o.enter(y),o.consume(he),o.exit(y),o.exit(u),t):Ui(he)?(o.enter("lineEnding"),o.consume(he),o.exit("lineEnding"),W):(o.enter("chunkString",{contentType:"string"}),Y(he))}function Y(he){return he===null||he===91||he===93||Ui(he)||s++>999?(o.exit("chunkString"),W(he)):(o.consume(he),V||(V=!us(he)),he===92?ae:Y)}function ae(he){return he===91||he===92||he===93?(o.consume(he),s++,Y):Y(he)}}function OL(o,t,a,u,y,T){let C;return s;function s(ae){return ae===34||ae===39||ae===40?(o.enter(u),o.enter(y),o.consume(ae),o.exit(y),C=ae===40?41:ae,V):a(ae)}function V(ae){return ae===C?(o.enter(y),o.consume(ae),o.exit(y),o.exit(u),t):(o.enter(T),B(ae))}function B(ae){return ae===C?(o.exit(T),V(C)):ae===null?a(ae):Ui(ae)?(o.enter("lineEnding"),o.consume(ae),o.exit("lineEnding"),Bs(o,B,"linePrefix")):(o.enter("chunkString",{contentType:"string"}),W(ae))}function W(ae){return ae===C||ae===null||Ui(ae)?(o.exit("chunkString"),B(ae)):(o.consume(ae),ae===92?Y:W)}function Y(ae){return ae===C||ae===92?(o.consume(ae),W):W(ae)}}function Iv(o,t){let a;return u;function u(y){return Ui(y)?(o.enter("lineEnding"),o.consume(y),o.exit("lineEnding"),a=!0,u):us(y)?Bs(o,u,a?"linePrefix":"lineSuffix")(y):t(y)}}const aG={name:"definition",tokenize:lG},oG={partial:!0,tokenize:cG};function lG(o,t,a){const u=this;let y;return T;function T(he){return o.enter("definition"),C(he)}function C(he){return LL.call(u,o,s,a,"definitionLabel","definitionLabelMarker","definitionLabelString")(he)}function s(he){return y=My(u.sliceSerialize(u.events[u.events.length-1][1]).slice(1,-1)),he===58?(o.enter("definitionMarker"),o.consume(he),o.exit("definitionMarker"),V):a(he)}function V(he){return Pc(he)?Iv(o,B)(he):B(he)}function B(he){return kL(o,W,a,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(he)}function W(he){return o.attempt(oG,Y,Y)(he)}function Y(he){return us(he)?Bs(o,ae,"whitespace")(he):ae(he)}function ae(he){return he===null||Ui(he)?(o.exit("definition"),u.parser.defined.push(y),t(he)):a(he)}}function cG(o,t,a){return u;function u(s){return Pc(s)?Iv(o,y)(s):a(s)}function y(s){return OL(o,T,a,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function T(s){return us(s)?Bs(o,C,"whitespace")(s):C(s)}function C(s){return s===null||Ui(s)?t(s):a(s)}}const uG={name:"hardBreakEscape",tokenize:hG};function hG(o,t,a){return u;function u(T){return o.enter("hardBreakEscape"),o.consume(T),y}function y(T){return Ui(T)?(o.exit("hardBreakEscape"),t(T)):a(T)}}const dG={name:"headingAtx",resolve:fG,tokenize:pG};function fG(o,t){let a=o.length-2,u=3,y,T;return o[u][1].type==="whitespace"&&(u+=2),a-2>u&&o[a][1].type==="whitespace"&&(a-=2),o[a][1].type==="atxHeadingSequence"&&(u===a-1||a-4>u&&o[a-2][1].type==="whitespace")&&(a-=u+1===a?2:4),a>u&&(y={type:"atxHeadingText",start:o[u][1].start,end:o[a][1].end},T={type:"chunkText",start:o[u][1].start,end:o[a][1].end,contentType:"text"},uf(o,u,a-u+1,[["enter",y,t],["enter",T,t],["exit",T,t],["exit",y,t]])),o}function pG(o,t,a){let u=0;return y;function y(W){return o.enter("atxHeading"),T(W)}function T(W){return o.enter("atxHeadingSequence"),C(W)}function C(W){return W===35&&u++<6?(o.consume(W),C):W===null||Pc(W)?(o.exit("atxHeadingSequence"),s(W)):a(W)}function s(W){return W===35?(o.enter("atxHeadingSequence"),V(W)):W===null||Ui(W)?(o.exit("atxHeading"),t(W)):us(W)?Bs(o,s,"whitespace")(W):(o.enter("atxHeadingText"),B(W))}function V(W){return W===35?(o.consume(W),V):(o.exit("atxHeadingSequence"),s(W))}function B(W){return W===null||W===35||Pc(W)?(o.exit("atxHeadingText"),s(W)):(o.consume(W),B)}}const mG=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],AM=["pre","script","style","textarea"],gG={concrete:!0,name:"htmlFlow",resolveTo:xG,tokenize:vG},_G={partial:!0,tokenize:wG},yG={partial:!0,tokenize:bG};function xG(o){let t=o.length;for(;t--&&!(o[t][0]==="enter"&&o[t][1].type==="htmlFlow"););return t>1&&o[t-2][1].type==="linePrefix"&&(o[t][1].start=o[t-2][1].start,o[t+1][1].start=o[t-2][1].start,o.splice(t-2,2)),o}function vG(o,t,a){const u=this;let y,T,C,s,V;return B;function B(Be){return W(Be)}function W(Be){return o.enter("htmlFlow"),o.enter("htmlFlowData"),o.consume(Be),Y}function Y(Be){return Be===33?(o.consume(Be),ae):Be===47?(o.consume(Be),T=!0,Ye):Be===63?(o.consume(Be),y=3,u.interrupt?t:it):tf(Be)?(o.consume(Be),C=String.fromCharCode(Be),Ke):a(Be)}function ae(Be){return Be===45?(o.consume(Be),y=2,he):Be===91?(o.consume(Be),y=5,s=0,Qe):tf(Be)?(o.consume(Be),y=4,u.interrupt?t:it):a(Be)}function he(Be){return Be===45?(o.consume(Be),u.interrupt?t:it):a(Be)}function Qe(Be){const En="CDATA[";return Be===En.charCodeAt(s++)?(o.consume(Be),s===En.length?u.interrupt?t:tt:Qe):a(Be)}function Ye(Be){return tf(Be)?(o.consume(Be),C=String.fromCharCode(Be),Ke):a(Be)}function Ke(Be){if(Be===null||Be===47||Be===62||Pc(Be)){const En=Be===47,Qn=C.toLowerCase();return!En&&!T&&AM.includes(Qn)?(y=1,u.interrupt?t(Be):tt(Be)):mG.includes(C.toLowerCase())?(y=6,En?(o.consume(Be),at):u.interrupt?t(Be):tt(Be)):(y=7,u.interrupt&&!u.parser.lazy[u.now().line]?a(Be):T?nt(Be):Ge(Be))}return Be===45||pu(Be)?(o.consume(Be),C+=String.fromCharCode(Be),Ke):a(Be)}function at(Be){return Be===62?(o.consume(Be),u.interrupt?t:tt):a(Be)}function nt(Be){return us(Be)?(o.consume(Be),nt):Je(Be)}function Ge(Be){return Be===47?(o.consume(Be),Je):Be===58||Be===95||tf(Be)?(o.consume(Be),Mt):us(Be)?(o.consume(Be),Ge):Je(Be)}function Mt(Be){return Be===45||Be===46||Be===58||Be===95||pu(Be)?(o.consume(Be),Mt):cn(Be)}function cn(Be){return Be===61?(o.consume(Be),St):us(Be)?(o.consume(Be),cn):Ge(Be)}function St(Be){return Be===null||Be===60||Be===61||Be===62||Be===96?a(Be):Be===34||Be===39?(o.consume(Be),V=Be,Oe):us(Be)?(o.consume(Be),St):Re(Be)}function Oe(Be){return Be===V?(o.consume(Be),V=null,Ve):Be===null||Ui(Be)?a(Be):(o.consume(Be),Oe)}function Re(Be){return Be===null||Be===34||Be===39||Be===47||Be===60||Be===61||Be===62||Be===96||Pc(Be)?cn(Be):(o.consume(Be),Re)}function Ve(Be){return Be===47||Be===62||us(Be)?Ge(Be):a(Be)}function Je(Be){return Be===62?(o.consume(Be),He):a(Be)}function He(Be){return Be===null||Ui(Be)?tt(Be):us(Be)?(o.consume(Be),He):a(Be)}function tt(Be){return Be===45&&y===2?(o.consume(Be),wt):Be===60&&y===1?(o.consume(Be),Kt):Be===62&&y===4?(o.consume(Be),ft):Be===63&&y===3?(o.consume(Be),it):Be===93&&y===5?(o.consume(Be),Kn):Ui(Be)&&(y===6||y===7)?(o.exit("htmlFlowData"),o.check(_G,Qt,ve)(Be)):Be===null||Ui(Be)?(o.exit("htmlFlowData"),ve(Be)):(o.consume(Be),tt)}function ve(Be){return o.check(yG,Ht,Qt)(Be)}function Ht(Be){return o.enter("lineEnding"),o.consume(Be),o.exit("lineEnding"),dn}function dn(Be){return Be===null||Ui(Be)?ve(Be):(o.enter("htmlFlowData"),tt(Be))}function wt(Be){return Be===45?(o.consume(Be),it):tt(Be)}function Kt(Be){return Be===47?(o.consume(Be),C="",wn):tt(Be)}function wn(Be){if(Be===62){const En=C.toLowerCase();return AM.includes(En)?(o.consume(Be),ft):tt(Be)}return tf(Be)&&C.length<8?(o.consume(Be),C+=String.fromCharCode(Be),wn):tt(Be)}function Kn(Be){return Be===93?(o.consume(Be),it):tt(Be)}function it(Be){return Be===62?(o.consume(Be),ft):Be===45&&y===2?(o.consume(Be),it):tt(Be)}function ft(Be){return Be===null||Ui(Be)?(o.exit("htmlFlowData"),Qt(Be)):(o.consume(Be),ft)}function Qt(Be){return o.exit("htmlFlow"),t(Be)}}function bG(o,t,a){const u=this;return y;function y(C){return Ui(C)?(o.enter("lineEnding"),o.consume(C),o.exit("lineEnding"),T):a(C)}function T(C){return u.parser.lazy[u.now().line]?a(C):t(C)}}function wG(o,t,a){return u;function u(y){return o.enter("lineEnding"),o.consume(y),o.exit("lineEnding"),o.attempt(U1,t,a)}}const TG={name:"htmlText",tokenize:EG};function EG(o,t,a){const u=this;let y,T,C;return s;function s(it){return o.enter("htmlText"),o.enter("htmlTextData"),o.consume(it),V}function V(it){return it===33?(o.consume(it),B):it===47?(o.consume(it),cn):it===63?(o.consume(it),Ge):tf(it)?(o.consume(it),Re):a(it)}function B(it){return it===45?(o.consume(it),W):it===91?(o.consume(it),T=0,Qe):tf(it)?(o.consume(it),nt):a(it)}function W(it){return it===45?(o.consume(it),he):a(it)}function Y(it){return it===null?a(it):it===45?(o.consume(it),ae):Ui(it)?(C=Y,Kt(it)):(o.consume(it),Y)}function ae(it){return it===45?(o.consume(it),he):Y(it)}function he(it){return it===62?wt(it):it===45?ae(it):Y(it)}function Qe(it){const ft="CDATA[";return it===ft.charCodeAt(T++)?(o.consume(it),T===ft.length?Ye:Qe):a(it)}function Ye(it){return it===null?a(it):it===93?(o.consume(it),Ke):Ui(it)?(C=Ye,Kt(it)):(o.consume(it),Ye)}function Ke(it){return it===93?(o.consume(it),at):Ye(it)}function at(it){return it===62?wt(it):it===93?(o.consume(it),at):Ye(it)}function nt(it){return it===null||it===62?wt(it):Ui(it)?(C=nt,Kt(it)):(o.consume(it),nt)}function Ge(it){return it===null?a(it):it===63?(o.consume(it),Mt):Ui(it)?(C=Ge,Kt(it)):(o.consume(it),Ge)}function Mt(it){return it===62?wt(it):Ge(it)}function cn(it){return tf(it)?(o.consume(it),St):a(it)}function St(it){return it===45||pu(it)?(o.consume(it),St):Oe(it)}function Oe(it){return Ui(it)?(C=Oe,Kt(it)):us(it)?(o.consume(it),Oe):wt(it)}function Re(it){return it===45||pu(it)?(o.consume(it),Re):it===47||it===62||Pc(it)?Ve(it):a(it)}function Ve(it){return it===47?(o.consume(it),wt):it===58||it===95||tf(it)?(o.consume(it),Je):Ui(it)?(C=Ve,Kt(it)):us(it)?(o.consume(it),Ve):wt(it)}function Je(it){return it===45||it===46||it===58||it===95||pu(it)?(o.consume(it),Je):He(it)}function He(it){return it===61?(o.consume(it),tt):Ui(it)?(C=He,Kt(it)):us(it)?(o.consume(it),He):Ve(it)}function tt(it){return it===null||it===60||it===61||it===62||it===96?a(it):it===34||it===39?(o.consume(it),y=it,ve):Ui(it)?(C=tt,Kt(it)):us(it)?(o.consume(it),tt):(o.consume(it),Ht)}function ve(it){return it===y?(o.consume(it),y=void 0,dn):it===null?a(it):Ui(it)?(C=ve,Kt(it)):(o.consume(it),ve)}function Ht(it){return it===null||it===34||it===39||it===60||it===61||it===96?a(it):it===47||it===62||Pc(it)?Ve(it):(o.consume(it),Ht)}function dn(it){return it===47||it===62||Pc(it)?Ve(it):a(it)}function wt(it){return it===62?(o.consume(it),o.exit("htmlTextData"),o.exit("htmlText"),t):a(it)}function Kt(it){return o.exit("htmlTextData"),o.enter("lineEnding"),o.consume(it),o.exit("lineEnding"),wn}function wn(it){return us(it)?Bs(o,Kn,"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(it):Kn(it)}function Kn(it){return o.enter("htmlTextData"),C(it)}}const QS={name:"labelEnd",resolveAll:CG,resolveTo:RG,tokenize:MG},SG={tokenize:DG},AG={tokenize:PG},IG={tokenize:kG};function CG(o){let t=-1;const a=[];for(;++t<o.length;){const u=o[t][1];if(a.push(o[t]),u.type==="labelImage"||u.type==="labelLink"||u.type==="labelEnd"){const y=u.type==="labelImage"?4:2;u.type="data",t+=y}}return o.length!==a.length&&uf(o,0,o.length,a),o}function RG(o,t){let a=o.length,u=0,y,T,C,s;for(;a--;)if(y=o[a][1],T){if(y.type==="link"||y.type==="labelLink"&&y._inactive)break;o[a][0]==="enter"&&y.type==="labelLink"&&(y._inactive=!0)}else if(C){if(o[a][0]==="enter"&&(y.type==="labelImage"||y.type==="labelLink")&&!y._balanced&&(T=a,y.type!=="labelLink")){u=2;break}}else y.type==="labelEnd"&&(C=a);const V={type:o[T][1].type==="labelLink"?"link":"image",start:{...o[T][1].start},end:{...o[o.length-1][1].end}},B={type:"label",start:{...o[T][1].start},end:{...o[C][1].end}},W={type:"labelText",start:{...o[T+u+2][1].end},end:{...o[C-2][1].start}};return s=[["enter",V,t],["enter",B,t]],s=Yu(s,o.slice(T+1,T+u+3)),s=Yu(s,[["enter",W,t]]),s=Yu(s,KS(t.parser.constructs.insideSpan.null,o.slice(T+u+4,C-3),t)),s=Yu(s,[["exit",W,t],o[C-2],o[C-1],["exit",B,t]]),s=Yu(s,o.slice(C+1)),s=Yu(s,[["exit",V,t]]),uf(o,T,o.length,s),o}function MG(o,t,a){const u=this;let y=u.events.length,T,C;for(;y--;)if((u.events[y][1].type==="labelImage"||u.events[y][1].type==="labelLink")&&!u.events[y][1]._balanced){T=u.events[y][1];break}return s;function s(ae){return T?T._inactive?Y(ae):(C=u.parser.defined.includes(My(u.sliceSerialize({start:T.end,end:u.now()}))),o.enter("labelEnd"),o.enter("labelMarker"),o.consume(ae),o.exit("labelMarker"),o.exit("labelEnd"),V):a(ae)}function V(ae){return ae===40?o.attempt(SG,W,C?W:Y)(ae):ae===91?o.attempt(AG,W,C?B:Y)(ae):C?W(ae):Y(ae)}function B(ae){return o.attempt(IG,W,Y)(ae)}function W(ae){return t(ae)}function Y(ae){return T._balanced=!0,a(ae)}}function DG(o,t,a){return u;function u(Y){return o.enter("resource"),o.enter("resourceMarker"),o.consume(Y),o.exit("resourceMarker"),y}function y(Y){return Pc(Y)?Iv(o,T)(Y):T(Y)}function T(Y){return Y===41?W(Y):kL(o,C,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(Y)}function C(Y){return Pc(Y)?Iv(o,V)(Y):W(Y)}function s(Y){return a(Y)}function V(Y){return Y===34||Y===39||Y===40?OL(o,B,a,"resourceTitle","resourceTitleMarker","resourceTitleString")(Y):W(Y)}function B(Y){return Pc(Y)?Iv(o,W)(Y):W(Y)}function W(Y){return Y===41?(o.enter("resourceMarker"),o.consume(Y),o.exit("resourceMarker"),o.exit("resource"),t):a(Y)}}function PG(o,t,a){const u=this;return y;function y(s){return LL.call(u,o,T,C,"reference","referenceMarker","referenceString")(s)}function T(s){return u.parser.defined.includes(My(u.sliceSerialize(u.events[u.events.length-1][1]).slice(1,-1)))?t(s):a(s)}function C(s){return a(s)}}function kG(o,t,a){return u;function u(T){return o.enter("reference"),o.enter("referenceMarker"),o.consume(T),o.exit("referenceMarker"),y}function y(T){return T===93?(o.enter("referenceMarker"),o.consume(T),o.exit("referenceMarker"),o.exit("reference"),t):a(T)}}const LG={name:"labelStartImage",resolveAll:QS.resolveAll,tokenize:OG};function OG(o,t,a){const u=this;return y;function y(s){return o.enter("labelImage"),o.enter("labelImageMarker"),o.consume(s),o.exit("labelImageMarker"),T}function T(s){return s===91?(o.enter("labelMarker"),o.consume(s),o.exit("labelMarker"),o.exit("labelImage"),C):a(s)}function C(s){return s===94&&"_hiddenFootnoteSupport"in u.parser.constructs?a(s):t(s)}}const zG={name:"labelStartLink",resolveAll:QS.resolveAll,tokenize:NG};function NG(o,t,a){const u=this;return y;function y(C){return o.enter("labelLink"),o.enter("labelMarker"),o.consume(C),o.exit("labelMarker"),o.exit("labelLink"),T}function T(C){return C===94&&"_hiddenFootnoteSupport"in u.parser.constructs?a(C):t(C)}}const NT={name:"lineEnding",tokenize:BG};function BG(o,t){return a;function a(u){return o.enter("lineEnding"),o.consume(u),o.exit("lineEnding"),Bs(o,t,"linePrefix")}}const Gb={name:"thematicBreak",tokenize:FG};function FG(o,t,a){let u=0,y;return T;function T(B){return o.enter("thematicBreak"),C(B)}function C(B){return y=B,s(B)}function s(B){return B===y?(o.enter("thematicBreakSequence"),V(B)):u>=3&&(B===null||Ui(B))?(o.exit("thematicBreak"),t(B)):a(B)}function V(B){return B===y?(o.consume(B),u++,V):(o.exit("thematicBreakSequence"),us(B)?Bs(o,s,"whitespace")(B):s(B))}}const Mc={continuation:{tokenize:GG},exit:HG,name:"list",tokenize:UG},VG={partial:!0,tokenize:$G},jG={partial:!0,tokenize:qG};function UG(o,t,a){const u=this,y=u.events[u.events.length-1];let T=y&&y[1].type==="linePrefix"?y[2].sliceSerialize(y[1],!0).length:0,C=0;return s;function s(he){const Qe=u.containerState.type||(he===42||he===43||he===45?"listUnordered":"listOrdered");if(Qe==="listUnordered"?!u.containerState.marker||he===u.containerState.marker:ME(he)){if(u.containerState.type||(u.containerState.type=Qe,o.enter(Qe,{_container:!0})),Qe==="listUnordered")return o.enter("listItemPrefix"),he===42||he===45?o.check(Gb,a,B)(he):B(he);if(!u.interrupt||he===49)return o.enter("listItemPrefix"),o.enter("listItemValue"),V(he)}return a(he)}function V(he){return ME(he)&&++C<10?(o.consume(he),V):(!u.interrupt||C<2)&&(u.containerState.marker?he===u.containerState.marker:he===41||he===46)?(o.exit("listItemValue"),B(he)):a(he)}function B(he){return o.enter("listItemMarker"),o.consume(he),o.exit("listItemMarker"),u.containerState.marker=u.containerState.marker||he,o.check(U1,u.interrupt?a:W,o.attempt(VG,ae,Y))}function W(he){return u.containerState.initialBlankLine=!0,T++,ae(he)}function Y(he){return us(he)?(o.enter("listItemPrefixWhitespace"),o.consume(he),o.exit("listItemPrefixWhitespace"),ae):a(he)}function ae(he){return u.containerState.size=T+u.sliceSerialize(o.exit("listItemPrefix"),!0).length,t(he)}}function GG(o,t,a){const u=this;return u.containerState._closeFlow=void 0,o.check(U1,y,T);function y(s){return u.containerState.furtherBlankLines=u.containerState.furtherBlankLines||u.containerState.initialBlankLine,Bs(o,t,"listItemIndent",u.containerState.size+1)(s)}function T(s){return u.containerState.furtherBlankLines||!us(s)?(u.containerState.furtherBlankLines=void 0,u.containerState.initialBlankLine=void 0,C(s)):(u.containerState.furtherBlankLines=void 0,u.containerState.initialBlankLine=void 0,o.attempt(jG,t,C)(s))}function C(s){return u.containerState._closeFlow=!0,u.interrupt=void 0,Bs(o,o.attempt(Mc,t,a),"linePrefix",u.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function qG(o,t,a){const u=this;return Bs(o,y,"listItemIndent",u.containerState.size+1);function y(T){const C=u.events[u.events.length-1];return C&&C[1].type==="listItemIndent"&&C[2].sliceSerialize(C[1],!0).length===u.containerState.size?t(T):a(T)}}function HG(o){o.exit(this.containerState.type)}function $G(o,t,a){const u=this;return Bs(o,y,"listItemPrefixWhitespace",u.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function y(T){const C=u.events[u.events.length-1];return!us(T)&&C&&C[1].type==="listItemPrefixWhitespace"?t(T):a(T)}}const IM={name:"setextUnderline",resolveTo:ZG,tokenize:WG};function ZG(o,t){let a=o.length,u,y,T;for(;a--;)if(o[a][0]==="enter"){if(o[a][1].type==="content"){u=a;break}o[a][1].type==="paragraph"&&(y=a)}else o[a][1].type==="content"&&o.splice(a,1),!T&&o[a][1].type==="definition"&&(T=a);const C={type:"setextHeading",start:{...o[u][1].start},end:{...o[o.length-1][1].end}};return o[y][1].type="setextHeadingText",T?(o.splice(y,0,["enter",C,t]),o.splice(T+1,0,["exit",o[u][1],t]),o[u][1].end={...o[T][1].end}):o[u][1]=C,o.push(["exit",C,t]),o}function WG(o,t,a){const u=this;let y;return T;function T(B){let W=u.events.length,Y;for(;W--;)if(u.events[W][1].type!=="lineEnding"&&u.events[W][1].type!=="linePrefix"&&u.events[W][1].type!=="content"){Y=u.events[W][1].type==="paragraph";break}return!u.parser.lazy[u.now().line]&&(u.interrupt||Y)?(o.enter("setextHeadingLine"),y=B,C(B)):a(B)}function C(B){return o.enter("setextHeadingLineSequence"),s(B)}function s(B){return B===y?(o.consume(B),s):(o.exit("setextHeadingLineSequence"),us(B)?Bs(o,V,"lineSuffix")(B):V(B))}function V(B){return B===null||Ui(B)?(o.exit("setextHeadingLine"),t(B)):a(B)}}const XG={tokenize:YG};function YG(o){const t=this,a=o.attempt(U1,u,o.attempt(this.parser.constructs.flowInitial,y,Bs(o,o.attempt(this.parser.constructs.flow,y,o.attempt(tG,y)),"linePrefix")));return a;function u(T){if(T===null){o.consume(T);return}return o.enter("lineEndingBlank"),o.consume(T),o.exit("lineEndingBlank"),t.currentConstruct=void 0,a}function y(T){if(T===null){o.consume(T);return}return o.enter("lineEnding"),o.consume(T),o.exit("lineEnding"),t.currentConstruct=void 0,a}}const KG={resolveAll:NL()},QG=zL("string"),JG=zL("text");function zL(o){return{resolveAll:NL(o==="text"?eq:void 0),tokenize:t};function t(a){const u=this,y=this.parser.constructs[o],T=a.attempt(y,C,s);return C;function C(W){return B(W)?T(W):s(W)}function s(W){if(W===null){a.consume(W);return}return a.enter("data"),a.consume(W),V}function V(W){return B(W)?(a.exit("data"),T(W)):(a.consume(W),V)}function B(W){if(W===null)return!0;const Y=y[W];let ae=-1;if(Y)for(;++ae<Y.length;){const he=Y[ae];if(!he.previous||he.previous.call(u,u.previous))return!0}return!1}}}function NL(o){return t;function t(a,u){let y=-1,T;for(;++y<=a.length;)T===void 0?a[y]&&a[y][1].type==="data"&&(T=y,y++):(!a[y]||a[y][1].type!=="data")&&(y!==T+2&&(a[T][1].end=a[y-1][1].end,a.splice(T+2,y-T-2),y=T+2),T=void 0);return o?o(a,u):a}}function eq(o,t){let a=0;for(;++a<=o.length;)if((a===o.length||o[a][1].type==="lineEnding")&&o[a-1][1].type==="data"){const u=o[a-1][1],y=t.sliceStream(u);let T=y.length,C=-1,s=0,V;for(;T--;){const B=y[T];if(typeof B=="string"){for(C=B.length;B.charCodeAt(C-1)===32;)s++,C--;if(C)break;C=-1}else if(B===-2)V=!0,s++;else if(B!==-1){T++;break}}if(t._contentTypeTextTrailing&&a===o.length&&(s=0),s){const B={type:a===o.length||V||s<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:T?C:u.start._bufferIndex+C,_index:u.start._index+T,line:u.end.line,column:u.end.column-s,offset:u.end.offset-s},end:{...u.end}};u.end={...B.start},u.start.offset===u.end.offset?Object.assign(u,B):(o.splice(a,0,["enter",B,t],["exit",B,t]),a+=2)}a++}return o}const tq={42:Mc,43:Mc,45:Mc,48:Mc,49:Mc,50:Mc,51:Mc,52:Mc,53:Mc,54:Mc,55:Mc,56:Mc,57:Mc,62:RL},nq={91:aG},iq={[-2]:zT,[-1]:zT,32:zT},rq={35:dG,42:Gb,45:[IM,Gb],60:gG,61:IM,95:Gb,96:SM,126:SM},sq={38:DL,92:ML},aq={[-5]:NT,[-4]:NT,[-3]:NT,33:LG,38:DL,42:DE,60:[z9,TG],91:zG,92:[uG,ML],93:QS,95:DE,96:X9},oq={null:[DE,KG]},lq={null:[42,95]},cq={null:[]},uq=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:lq,contentInitial:nq,disable:cq,document:tq,flow:rq,flowInitial:iq,insideSpan:oq,string:sq,text:aq},Symbol.toStringTag,{value:"Module"}));function hq(o,t,a){let u={_bufferIndex:-1,_index:0,line:a&&a.line||1,column:a&&a.column||1,offset:a&&a.offset||0};const y={},T=[];let C=[],s=[];const V={attempt:Oe(cn),check:Oe(St),consume:nt,enter:Ge,exit:Mt,interrupt:Oe(St,{interrupt:!0})},B={code:null,containerState:{},defineSkip:Ye,events:[],now:Qe,parser:o,previous:null,sliceSerialize:ae,sliceStream:he,write:Y};let W=t.tokenize.call(B,V);return t.resolveAll&&T.push(t),B;function Y(He){return C=Yu(C,He),Ke(),C[C.length-1]!==null?[]:(Re(t,0),B.events=KS(T,B.events,B),B.events)}function ae(He,tt){return fq(he(He),tt)}function he(He){return dq(C,He)}function Qe(){const{_bufferIndex:He,_index:tt,line:ve,column:Ht,offset:dn}=u;return{_bufferIndex:He,_index:tt,line:ve,column:Ht,offset:dn}}function Ye(He){y[He.line]=He.column,Je()}function Ke(){let He;for(;u._index<C.length;){const tt=C[u._index];if(typeof tt=="string")for(He=u._index,u._bufferIndex<0&&(u._bufferIndex=0);u._index===He&&u._bufferIndex<tt.length;)at(tt.charCodeAt(u._bufferIndex));else at(tt)}}function at(He){W=W(He)}function nt(He){Ui(He)?(u.line++,u.column=1,u.offset+=He===-3?2:1,Je()):He!==-1&&(u.column++,u.offset++),u._bufferIndex<0?u._index++:(u._bufferIndex++,u._bufferIndex===C[u._index].length&&(u._bufferIndex=-1,u._index++)),B.previous=He}function Ge(He,tt){const ve=tt||{};return ve.type=He,ve.start=Qe(),B.events.push(["enter",ve,B]),s.push(ve),ve}function Mt(He){const tt=s.pop();return tt.end=Qe(),B.events.push(["exit",tt,B]),tt}function cn(He,tt){Re(He,tt.from)}function St(He,tt){tt.restore()}function Oe(He,tt){return ve;function ve(Ht,dn,wt){let Kt,wn,Kn,it;return Array.isArray(Ht)?Qt(Ht):"tokenize"in Ht?Qt([Ht]):ft(Ht);function ft($n){return ki;function ki(er){const qn=er!==null&&$n[er],Ni=er!==null&&$n.null,Vr=[...Array.isArray(qn)?qn:qn?[qn]:[],...Array.isArray(Ni)?Ni:Ni?[Ni]:[]];return Qt(Vr)(er)}}function Qt($n){return Kt=$n,wn=0,$n.length===0?wt:Be($n[wn])}function Be($n){return ki;function ki(er){return it=Ve(),Kn=$n,$n.partial||(B.currentConstruct=$n),$n.name&&B.parser.constructs.disable.null.includes($n.name)?Qn():$n.tokenize.call(tt?Object.assign(Object.create(B),tt):B,V,En,Qn)(er)}}function En($n){return He(Kn,it),dn}function Qn($n){return it.restore(),++wn<Kt.length?Be(Kt[wn]):wt}}}function Re(He,tt){He.resolveAll&&!T.includes(He)&&T.push(He),He.resolve&&uf(B.events,tt,B.events.length-tt,He.resolve(B.events.slice(tt),B)),He.resolveTo&&(B.events=He.resolveTo(B.events,B))}function Ve(){const He=Qe(),tt=B.previous,ve=B.currentConstruct,Ht=B.events.length,dn=Array.from(s);return{from:Ht,restore:wt};function wt(){u=He,B.previous=tt,B.currentConstruct=ve,B.events.length=Ht,s=dn,Je()}}function Je(){u.line in y&&u.column<2&&(u.column=y[u.line],u.offset+=y[u.line]-1)}}function dq(o,t){const a=t.start._index,u=t.start._bufferIndex,y=t.end._index,T=t.end._bufferIndex;let C;if(a===y)C=[o[a].slice(u,T)];else{if(C=o.slice(a,y),u>-1){const s=C[0];typeof s=="string"?C[0]=s.slice(u):C.shift()}T>0&&C.push(o[y].slice(0,T))}return C}function fq(o,t){let a=-1;const u=[];let y;for(;++a<o.length;){const T=o[a];let C;if(typeof T=="string")C=T;else switch(T){case-5:{C="\r";break}case-4:{C=`
`;break}case-3:{C=`\r
`;break}case-2:{C=t?" ":"	";break}case-1:{if(!t&&y)continue;C=" ";break}default:C=String.fromCharCode(T)}y=T===-2,u.push(C)}return u.join("")}function pq(o){const u={constructs:b9([uq,...(o||{}).extensions||[]]),content:y(R9),defined:[],document:y(D9),flow:y(XG),lazy:{},string:y(QG),text:y(JG)};return u;function y(T){return C;function C(s){return hq(u,T,s)}}}function mq(o){for(;!PL(o););return o}const CM=/[\0\t\n\r]/g;function gq(){let o=1,t="",a=!0,u;return y;function y(T,C,s){const V=[];let B,W,Y,ae,he;for(T=t+(typeof T=="string"?T.toString():new TextDecoder(C||void 0).decode(T)),Y=0,t="",a&&(T.charCodeAt(0)===65279&&Y++,a=void 0);Y<T.length;){if(CM.lastIndex=Y,B=CM.exec(T),ae=B&&B.index!==void 0?B.index:T.length,he=T.charCodeAt(ae),!B){t=T.slice(Y);break}if(he===10&&Y===ae&&u)V.push(-3),u=void 0;else switch(u&&(V.push(-5),u=void 0),Y<ae&&(V.push(T.slice(Y,ae)),o+=ae-Y),he){case 0:{V.push(65533),o++;break}case 9:{for(W=Math.ceil(o/4)*4,V.push(-2);o++<W;)V.push(-1);break}case 10:{V.push(-4),o=1;break}default:u=!0,o=1}Y=ae+1}return s&&(u&&V.push(-5),t&&V.push(t),V.push(null)),V}}const _q=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function yq(o){return o.replace(_q,xq)}function xq(o,t,a){if(t)return t;if(a.charCodeAt(0)===35){const y=a.charCodeAt(1),T=y===120||y===88;return CL(a.slice(T?2:1),T?16:10)}return YS(a)||o}const BL={}.hasOwnProperty;function vq(o,t,a){return typeof t!="string"&&(a=t,t=void 0),bq(a)(mq(pq(a).document().write(gq()(o,t,!0))))}function bq(o){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:T(yr),autolinkProtocol:Ve,autolinkEmail:Ve,atxHeading:T(_r),blockQuote:T(Ni),characterEscape:Ve,characterReference:Ve,codeFenced:T(Vr),codeFencedFenceInfo:C,codeFencedFenceMeta:C,codeIndented:T(Vr,C),codeText:T(Fa,C),codeTextData:Ve,data:Ve,codeFlowValue:Ve,definition:T(Cn),definitionDestinationString:C,definitionLabelString:C,definitionTitleString:C,emphasis:T(vi),hardBreakEscape:T(Hi),hardBreakTrailing:T(Hi),htmlFlow:T(Wr,C),htmlFlowData:Ve,htmlText:T(Wr,C),htmlTextData:Ve,image:T(tr),label:C,link:T(yr),listItem:T(to),listItemValue:ae,listOrdered:T(Xr,Y),listUnordered:T(Xr),paragraph:T(Rl),reference:Be,referenceString:C,resourceDestinationString:C,resourceTitleString:C,setextHeading:T(_r),strong:T(rc),thematicBreak:T(bs)},exit:{atxHeading:V(),atxHeadingSequence:cn,autolink:V(),autolinkEmail:qn,autolinkProtocol:er,blockQuote:V(),characterEscapeValue:Je,characterReferenceMarkerHexadecimal:Qn,characterReferenceMarkerNumeric:Qn,characterReferenceValue:$n,characterReference:ki,codeFenced:V(Ke),codeFencedFence:Ye,codeFencedFenceInfo:he,codeFencedFenceMeta:Qe,codeFlowValue:Je,codeIndented:V(at),codeText:V(dn),codeTextData:Je,data:Je,definition:V(),definitionDestinationString:Mt,definitionLabelString:nt,definitionTitleString:Ge,emphasis:V(),hardBreakEscape:V(tt),hardBreakTrailing:V(tt),htmlFlow:V(ve),htmlFlowData:Je,htmlText:V(Ht),htmlTextData:Je,image:V(Kt),label:Kn,labelText:wn,lineEnding:He,link:V(wt),listItem:V(),listOrdered:V(),listUnordered:V(),paragraph:V(),referenceString:En,resourceDestinationString:it,resourceTitleString:ft,resource:Qt,setextHeading:V(Re),setextHeadingLineSequence:Oe,setextHeadingText:St,strong:V(),thematicBreak:V()}};FL(t,(o||{}).mdastExtensions||[]);const a={};return u;function u(en){let Tn={type:"root",children:[]};const si={stack:[Tn],tokenStack:[],config:t,enter:s,exit:B,buffer:C,resume:W,data:a},Li=[];let Ii=-1;for(;++Ii<en.length;)if(en[Ii][1].type==="listOrdered"||en[Ii][1].type==="listUnordered")if(en[Ii][0]==="enter")Li.push(Ii);else{const Fs=Li.pop();Ii=y(en,Fs,Ii)}for(Ii=-1;++Ii<en.length;){const Fs=t[en[Ii][0]];BL.call(Fs,en[Ii][1].type)&&Fs[en[Ii][1].type].call(Object.assign({sliceSerialize:en[Ii][2].sliceSerialize},si),en[Ii][1])}if(si.tokenStack.length>0){const Fs=si.tokenStack[si.tokenStack.length-1];(Fs[1]||RM).call(si,void 0,Fs[0])}for(Tn.position={start:Am(en.length>0?en[0][1].start:{line:1,column:1,offset:0}),end:Am(en.length>0?en[en.length-2][1].end:{line:1,column:1,offset:0})},Ii=-1;++Ii<t.transforms.length;)Tn=t.transforms[Ii](Tn)||Tn;return Tn}function y(en,Tn,si){let Li=Tn-1,Ii=-1,Fs=!1,_s,ms,Pr,mr;for(;++Li<=si;){const Fi=en[Li];switch(Fi[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Fi[0]==="enter"?Ii++:Ii--,mr=void 0;break}case"lineEndingBlank":{Fi[0]==="enter"&&(_s&&!mr&&!Ii&&!Pr&&(Pr=Li),mr=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:mr=void 0}if(!Ii&&Fi[0]==="enter"&&Fi[1].type==="listItemPrefix"||Ii===-1&&Fi[0]==="exit"&&(Fi[1].type==="listUnordered"||Fi[1].type==="listOrdered")){if(_s){let ia=Li;for(ms=void 0;ia--;){const ws=en[ia];if(ws[1].type==="lineEnding"||ws[1].type==="lineEndingBlank"){if(ws[0]==="exit")continue;ms&&(en[ms][1].type="lineEndingBlank",Fs=!0),ws[1].type="lineEnding",ms=ia}else if(!(ws[1].type==="linePrefix"||ws[1].type==="blockQuotePrefix"||ws[1].type==="blockQuotePrefixWhitespace"||ws[1].type==="blockQuoteMarker"||ws[1].type==="listItemIndent"))break}Pr&&(!ms||Pr<ms)&&(_s._spread=!0),_s.end=Object.assign({},ms?en[ms][1].start:Fi[1].end),en.splice(ms||Li,0,["exit",_s,Fi[2]]),Li++,si++}if(Fi[1].type==="listItemPrefix"){const ia={type:"listItem",_spread:!1,start:Object.assign({},Fi[1].start),end:void 0};_s=ia,en.splice(Li,0,["enter",ia,Fi[2]]),Li++,si++,Pr=void 0,mr=!0}}}return en[Tn][1]._spread=Fs,si}function T(en,Tn){return si;function si(Li){s.call(this,en(Li),Li),Tn&&Tn.call(this,Li)}}function C(){this.stack.push({type:"fragment",children:[]})}function s(en,Tn,si){this.stack[this.stack.length-1].children.push(en),this.stack.push(en),this.tokenStack.push([Tn,si||void 0]),en.position={start:Am(Tn.start),end:void 0}}function V(en){return Tn;function Tn(si){en&&en.call(this,si),B.call(this,si)}}function B(en,Tn){const si=this.stack.pop(),Li=this.tokenStack.pop();if(Li)Li[0].type!==en.type&&(Tn?Tn.call(this,en,Li[0]):(Li[1]||RM).call(this,en,Li[0]));else throw new Error("Cannot close `"+en.type+"` ("+Av({start:en.start,end:en.end})+"): its not open");si.position.end=Am(en.end)}function W(){return x9(this.stack.pop())}function Y(){this.data.expectingFirstListItemValue=!0}function ae(en){if(this.data.expectingFirstListItemValue){const Tn=this.stack[this.stack.length-2];Tn.start=Number.parseInt(this.sliceSerialize(en),10),this.data.expectingFirstListItemValue=void 0}}function he(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.lang=en}function Qe(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.meta=en}function Ye(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function Ke(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function at(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en.replace(/(\r?\n|\r)$/g,"")}function nt(en){const Tn=this.resume(),si=this.stack[this.stack.length-1];si.label=Tn,si.identifier=My(this.sliceSerialize(en)).toLowerCase()}function Ge(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.title=en}function Mt(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.url=en}function cn(en){const Tn=this.stack[this.stack.length-1];if(!Tn.depth){const si=this.sliceSerialize(en).length;Tn.depth=si}}function St(){this.data.setextHeadingSlurpLineEnding=!0}function Oe(en){const Tn=this.stack[this.stack.length-1];Tn.depth=this.sliceSerialize(en).codePointAt(0)===61?1:2}function Re(){this.data.setextHeadingSlurpLineEnding=void 0}function Ve(en){const si=this.stack[this.stack.length-1].children;let Li=si[si.length-1];(!Li||Li.type!=="text")&&(Li=jr(),Li.position={start:Am(en.start),end:void 0},si.push(Li)),this.stack.push(Li)}function Je(en){const Tn=this.stack.pop();Tn.value+=this.sliceSerialize(en),Tn.position.end=Am(en.end)}function He(en){const Tn=this.stack[this.stack.length-1];if(this.data.atHardBreak){const si=Tn.children[Tn.children.length-1];si.position.end=Am(en.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Tn.type)&&(Ve.call(this,en),Je.call(this,en))}function tt(){this.data.atHardBreak=!0}function ve(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function Ht(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function dn(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.value=en}function wt(){const en=this.stack[this.stack.length-1];if(this.data.inReference){const Tn=this.data.referenceType||"shortcut";en.type+="Reference",en.referenceType=Tn,delete en.url,delete en.title}else delete en.identifier,delete en.label;this.data.referenceType=void 0}function Kt(){const en=this.stack[this.stack.length-1];if(this.data.inReference){const Tn=this.data.referenceType||"shortcut";en.type+="Reference",en.referenceType=Tn,delete en.url,delete en.title}else delete en.identifier,delete en.label;this.data.referenceType=void 0}function wn(en){const Tn=this.sliceSerialize(en),si=this.stack[this.stack.length-2];si.label=yq(Tn),si.identifier=My(Tn).toLowerCase()}function Kn(){const en=this.stack[this.stack.length-1],Tn=this.resume(),si=this.stack[this.stack.length-1];if(this.data.inReference=!0,si.type==="link"){const Li=en.children;si.children=Li}else si.alt=Tn}function it(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.url=en}function ft(){const en=this.resume(),Tn=this.stack[this.stack.length-1];Tn.title=en}function Qt(){this.data.inReference=void 0}function Be(){this.data.referenceType="collapsed"}function En(en){const Tn=this.resume(),si=this.stack[this.stack.length-1];si.label=Tn,si.identifier=My(this.sliceSerialize(en)).toLowerCase(),this.data.referenceType="full"}function Qn(en){this.data.characterReferenceType=en.type}function $n(en){const Tn=this.sliceSerialize(en),si=this.data.characterReferenceType;let Li;si?(Li=CL(Tn,si==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Li=YS(Tn);const Ii=this.stack[this.stack.length-1];Ii.value+=Li}function ki(en){const Tn=this.stack.pop();Tn.position.end=Am(en.end)}function er(en){Je.call(this,en);const Tn=this.stack[this.stack.length-1];Tn.url=this.sliceSerialize(en)}function qn(en){Je.call(this,en);const Tn=this.stack[this.stack.length-1];Tn.url="mailto:"+this.sliceSerialize(en)}function Ni(){return{type:"blockquote",children:[]}}function Vr(){return{type:"code",lang:null,meta:null,value:""}}function Fa(){return{type:"inlineCode",value:""}}function Cn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function vi(){return{type:"emphasis",children:[]}}function _r(){return{type:"heading",depth:0,children:[]}}function Hi(){return{type:"break"}}function Wr(){return{type:"html",value:""}}function tr(){return{type:"image",title:null,url:"",alt:null}}function yr(){return{type:"link",title:null,url:"",children:[]}}function Xr(en){return{type:"list",ordered:en.type==="listOrdered",start:null,spread:en._spread,children:[]}}function to(en){return{type:"listItem",spread:en._spread,checked:null,children:[]}}function Rl(){return{type:"paragraph",children:[]}}function rc(){return{type:"strong",children:[]}}function jr(){return{type:"text",value:""}}function bs(){return{type:"thematicBreak"}}}function Am(o){return{line:o.line,column:o.column,offset:o.offset}}function FL(o,t){let a=-1;for(;++a<t.length;){const u=t[a];Array.isArray(u)?FL(o,u):wq(o,u)}}function wq(o,t){let a;for(a in t)if(BL.call(t,a))switch(a){case"canContainEols":{const u=t[a];u&&o[a].push(...u);break}case"transforms":{const u=t[a];u&&o[a].push(...u);break}case"enter":case"exit":{const u=t[a];u&&Object.assign(o[a],u);break}}}function RM(o,t){throw o?new Error("Cannot close `"+o.type+"` ("+Av({start:o.start,end:o.end})+"): a different token (`"+t.type+"`, "+Av({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Av({start:t.start,end:t.end})+") is still open")}function Tq(o){const t=this;t.parser=a;function a(u){return vq(u,{...t.data("settings"),...o,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function Eq(o,t){const a={type:"element",tagName:"blockquote",properties:{},children:o.wrap(o.all(t),!0)};return o.patch(t,a),o.applyData(t,a)}function Sq(o,t){const a={type:"element",tagName:"br",properties:{},children:[]};return o.patch(t,a),[o.applyData(t,a),{type:"text",value:`
`}]}function Aq(o,t){const a=t.value?t.value+`
`:"",u={},y=t.lang?t.lang.split(/\s+/):[];y.length>0&&(u.className=["language-"+y[0]]);let T={type:"element",tagName:"code",properties:u,children:[{type:"text",value:a}]};return t.meta&&(T.data={meta:t.meta}),o.patch(t,T),T=o.applyData(t,T),T={type:"element",tagName:"pre",properties:{},children:[T]},o.patch(t,T),T}function Iq(o,t){const a={type:"element",tagName:"del",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Cq(o,t){const a={type:"element",tagName:"em",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Rq(o,t){const a=typeof o.options.clobberPrefix=="string"?o.options.clobberPrefix:"user-content-",u=String(t.identifier).toUpperCase(),y=Jy(u.toLowerCase()),T=o.footnoteOrder.indexOf(u);let C,s=o.footnoteCounts.get(u);s===void 0?(s=0,o.footnoteOrder.push(u),C=o.footnoteOrder.length):C=T+1,s+=1,o.footnoteCounts.set(u,s);const V={type:"element",tagName:"a",properties:{href:"#"+a+"fn-"+y,id:a+"fnref-"+y+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(C)}]};o.patch(t,V);const B={type:"element",tagName:"sup",properties:{},children:[V]};return o.patch(t,B),o.applyData(t,B)}function Mq(o,t){const a={type:"element",tagName:"h"+t.depth,properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Dq(o,t){if(o.options.allowDangerousHtml){const a={type:"raw",value:t.value};return o.patch(t,a),o.applyData(t,a)}}function VL(o,t){const a=t.referenceType;let u="]";if(a==="collapsed"?u+="[]":a==="full"&&(u+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+u}];const y=o.all(t),T=y[0];T&&T.type==="text"?T.value="["+T.value:y.unshift({type:"text",value:"["});const C=y[y.length-1];return C&&C.type==="text"?C.value+=u:y.push({type:"text",value:u}),y}function Pq(o,t){const a=String(t.identifier).toUpperCase(),u=o.definitionById.get(a);if(!u)return VL(o,t);const y={src:Jy(u.url||""),alt:t.alt};u.title!==null&&u.title!==void 0&&(y.title=u.title);const T={type:"element",tagName:"img",properties:y,children:[]};return o.patch(t,T),o.applyData(t,T)}function kq(o,t){const a={src:Jy(t.url)};t.alt!==null&&t.alt!==void 0&&(a.alt=t.alt),t.title!==null&&t.title!==void 0&&(a.title=t.title);const u={type:"element",tagName:"img",properties:a,children:[]};return o.patch(t,u),o.applyData(t,u)}function Lq(o,t){const a={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};o.patch(t,a);const u={type:"element",tagName:"code",properties:{},children:[a]};return o.patch(t,u),o.applyData(t,u)}function Oq(o,t){const a=String(t.identifier).toUpperCase(),u=o.definitionById.get(a);if(!u)return VL(o,t);const y={href:Jy(u.url||"")};u.title!==null&&u.title!==void 0&&(y.title=u.title);const T={type:"element",tagName:"a",properties:y,children:o.all(t)};return o.patch(t,T),o.applyData(t,T)}function zq(o,t){const a={href:Jy(t.url)};t.title!==null&&t.title!==void 0&&(a.title=t.title);const u={type:"element",tagName:"a",properties:a,children:o.all(t)};return o.patch(t,u),o.applyData(t,u)}function Nq(o,t,a){const u=o.all(t),y=a?Bq(a):jL(t),T={},C=[];if(typeof t.checked=="boolean"){const W=u[0];let Y;W&&W.type==="element"&&W.tagName==="p"?Y=W:(Y={type:"element",tagName:"p",properties:{},children:[]},u.unshift(Y)),Y.children.length>0&&Y.children.unshift({type:"text",value:" "}),Y.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),T.className=["task-list-item"]}let s=-1;for(;++s<u.length;){const W=u[s];(y||s!==0||W.type!=="element"||W.tagName!=="p")&&C.push({type:"text",value:`
`}),W.type==="element"&&W.tagName==="p"&&!y?C.push(...W.children):C.push(W)}const V=u[u.length-1];V&&(y||V.type!=="element"||V.tagName!=="p")&&C.push({type:"text",value:`
`});const B={type:"element",tagName:"li",properties:T,children:C};return o.patch(t,B),o.applyData(t,B)}function Bq(o){let t=!1;if(o.type==="list"){t=o.spread||!1;const a=o.children;let u=-1;for(;!t&&++u<a.length;)t=jL(a[u])}return t}function jL(o){const t=o.spread;return t??o.children.length>1}function Fq(o,t){const a={},u=o.all(t);let y=-1;for(typeof t.start=="number"&&t.start!==1&&(a.start=t.start);++y<u.length;){const C=u[y];if(C.type==="element"&&C.tagName==="li"&&C.properties&&Array.isArray(C.properties.className)&&C.properties.className.includes("task-list-item")){a.className=["contains-task-list"];break}}const T={type:"element",tagName:t.ordered?"ol":"ul",properties:a,children:o.wrap(u,!0)};return o.patch(t,T),o.applyData(t,T)}function Vq(o,t){const a={type:"element",tagName:"p",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function jq(o,t){const a={type:"root",children:o.wrap(o.all(t))};return o.patch(t,a),o.applyData(t,a)}function Uq(o,t){const a={type:"element",tagName:"strong",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}function Gq(o,t){const a=o.all(t),u=a.shift(),y=[];if(u){const C={type:"element",tagName:"thead",properties:{},children:o.wrap([u],!0)};o.patch(t.children[0],C),y.push(C)}if(a.length>0){const C={type:"element",tagName:"tbody",properties:{},children:o.wrap(a,!0)},s=$S(t.children[1]),V=bL(t.children[t.children.length-1]);s&&V&&(C.position={start:s,end:V}),y.push(C)}const T={type:"element",tagName:"table",properties:{},children:o.wrap(y,!0)};return o.patch(t,T),o.applyData(t,T)}function qq(o,t,a){const u=a?a.children:void 0,T=(u?u.indexOf(t):1)===0?"th":"td",C=a&&a.type==="table"?a.align:void 0,s=C?C.length:t.children.length;let V=-1;const B=[];for(;++V<s;){const Y=t.children[V],ae={},he=C?C[V]:void 0;he&&(ae.align=he);let Qe={type:"element",tagName:T,properties:ae,children:[]};Y&&(Qe.children=o.all(Y),o.patch(Y,Qe),Qe=o.applyData(Y,Qe)),B.push(Qe)}const W={type:"element",tagName:"tr",properties:{},children:o.wrap(B,!0)};return o.patch(t,W),o.applyData(t,W)}function Hq(o,t){const a={type:"element",tagName:"td",properties:{},children:o.all(t)};return o.patch(t,a),o.applyData(t,a)}const MM=9,DM=32;function $q(o){const t=String(o),a=/\r?\n|\r/g;let u=a.exec(t),y=0;const T=[];for(;u;)T.push(PM(t.slice(y,u.index),y>0,!0),u[0]),y=u.index+u[0].length,u=a.exec(t);return T.push(PM(t.slice(y),y>0,!1)),T.join("")}function PM(o,t,a){let u=0,y=o.length;if(t){let T=o.codePointAt(u);for(;T===MM||T===DM;)u++,T=o.codePointAt(u)}if(a){let T=o.codePointAt(y-1);for(;T===MM||T===DM;)y--,T=o.codePointAt(y-1)}return y>u?o.slice(u,y):""}function Zq(o,t){const a={type:"text",value:$q(String(t.value))};return o.patch(t,a),o.applyData(t,a)}function Wq(o,t){const a={type:"element",tagName:"hr",properties:{},children:[]};return o.patch(t,a),o.applyData(t,a)}const Xq={blockquote:Eq,break:Sq,code:Aq,delete:Iq,emphasis:Cq,footnoteReference:Rq,heading:Mq,html:Dq,imageReference:Pq,image:kq,inlineCode:Lq,linkReference:Oq,link:zq,listItem:Nq,list:Fq,paragraph:Vq,root:jq,strong:Uq,table:Gq,tableCell:Hq,tableRow:qq,text:Zq,thematicBreak:Wq,toml:Ab,yaml:Ab,definition:Ab,footnoteDefinition:Ab};function Ab(){}const UL=-1,G1=0,Cv=1,g1=2,JS=3,eA=4,tA=5,nA=6,GL=7,qL=8,kM=typeof self=="object"?self:globalThis,Yq=(o,t)=>{const a=(y,T)=>(o.set(T,y),y),u=y=>{if(o.has(y))return o.get(y);const[T,C]=t[y];switch(T){case G1:case UL:return a(C,y);case Cv:{const s=a([],y);for(const V of C)s.push(u(V));return s}case g1:{const s=a({},y);for(const[V,B]of C)s[u(V)]=u(B);return s}case JS:return a(new Date(C),y);case eA:{const{source:s,flags:V}=C;return a(new RegExp(s,V),y)}case tA:{const s=a(new Map,y);for(const[V,B]of C)s.set(u(V),u(B));return s}case nA:{const s=a(new Set,y);for(const V of C)s.add(u(V));return s}case GL:{const{name:s,message:V}=C;return a(new kM[s](V),y)}case qL:return a(BigInt(C),y);case"BigInt":return a(Object(BigInt(C)),y);case"ArrayBuffer":return a(new Uint8Array(C).buffer,C);case"DataView":{const{buffer:s}=new Uint8Array(C);return a(new DataView(s),C)}}return a(new kM[T](C),y)};return u},LM=o=>Yq(new Map,o)(0),yy="",{toString:Kq}={},{keys:Qq}=Object,fv=o=>{const t=typeof o;if(t!=="object"||!o)return[G1,t];const a=Kq.call(o).slice(8,-1);switch(a){case"Array":return[Cv,yy];case"Object":return[g1,yy];case"Date":return[JS,yy];case"RegExp":return[eA,yy];case"Map":return[tA,yy];case"Set":return[nA,yy];case"DataView":return[Cv,a]}return a.includes("Array")?[Cv,a]:a.includes("Error")?[GL,a]:[g1,a]},Ib=([o,t])=>o===G1&&(t==="function"||t==="symbol"),Jq=(o,t,a,u)=>{const y=(C,s)=>{const V=u.push(C)-1;return a.set(s,V),V},T=C=>{if(a.has(C))return a.get(C);let[s,V]=fv(C);switch(s){case G1:{let W=C;switch(V){case"bigint":s=qL,W=C.toString();break;case"function":case"symbol":if(o)throw new TypeError("unable to serialize "+V);W=null;break;case"undefined":return y([UL],C)}return y([s,W],C)}case Cv:{if(V){let ae=C;return V==="DataView"?ae=new Uint8Array(C.buffer):V==="ArrayBuffer"&&(ae=new Uint8Array(C)),y([V,[...ae]],C)}const W=[],Y=y([s,W],C);for(const ae of C)W.push(T(ae));return Y}case g1:{if(V)switch(V){case"BigInt":return y([V,C.toString()],C);case"Boolean":case"Number":case"String":return y([V,C.valueOf()],C)}if(t&&"toJSON"in C)return T(C.toJSON());const W=[],Y=y([s,W],C);for(const ae of Qq(C))(o||!Ib(fv(C[ae])))&&W.push([T(ae),T(C[ae])]);return Y}case JS:return y([s,C.toISOString()],C);case eA:{const{source:W,flags:Y}=C;return y([s,{source:W,flags:Y}],C)}case tA:{const W=[],Y=y([s,W],C);for(const[ae,he]of C)(o||!(Ib(fv(ae))||Ib(fv(he))))&&W.push([T(ae),T(he)]);return Y}case nA:{const W=[],Y=y([s,W],C);for(const ae of C)(o||!Ib(fv(ae)))&&W.push(T(ae));return Y}}const{message:B}=C;return y([s,{name:V,message:B}],C)};return T},OM=(o,{json:t,lossy:a}={})=>{const u=[];return Jq(!(t||a),!!t,new Map,u)(o),u},_1=typeof structuredClone=="function"?(o,t)=>t&&("json"in t||"lossy"in t)?LM(OM(o,t)):structuredClone(o):(o,t)=>LM(OM(o,t));function eH(o,t){const a=[{type:"text",value:""}];return t>1&&a.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),a}function tH(o,t){return"Back to reference "+(o+1)+(t>1?"-"+t:"")}function nH(o){const t=typeof o.options.clobberPrefix=="string"?o.options.clobberPrefix:"user-content-",a=o.options.footnoteBackContent||eH,u=o.options.footnoteBackLabel||tH,y=o.options.footnoteLabel||"Footnotes",T=o.options.footnoteLabelTagName||"h2",C=o.options.footnoteLabelProperties||{className:["sr-only"]},s=[];let V=-1;for(;++V<o.footnoteOrder.length;){const B=o.footnoteById.get(o.footnoteOrder[V]);if(!B)continue;const W=o.all(B),Y=String(B.identifier).toUpperCase(),ae=Jy(Y.toLowerCase());let he=0;const Qe=[],Ye=o.footnoteCounts.get(Y);for(;Ye!==void 0&&++he<=Ye;){Qe.length>0&&Qe.push({type:"text",value:" "});let nt=typeof a=="string"?a:a(V,he);typeof nt=="string"&&(nt={type:"text",value:nt}),Qe.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+ae+(he>1?"-"+he:""),dataFootnoteBackref:"",ariaLabel:typeof u=="string"?u:u(V,he),className:["data-footnote-backref"]},children:Array.isArray(nt)?nt:[nt]})}const Ke=W[W.length-1];if(Ke&&Ke.type==="element"&&Ke.tagName==="p"){const nt=Ke.children[Ke.children.length-1];nt&&nt.type==="text"?nt.value+=" ":Ke.children.push({type:"text",value:" "}),Ke.children.push(...Qe)}else W.push(...Qe);const at={type:"element",tagName:"li",properties:{id:t+"fn-"+ae},children:o.wrap(W,!0)};o.patch(B,at),s.push(at)}if(s.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:T,properties:{..._1(C),id:"footnote-label"},children:[{type:"text",value:y}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:o.wrap(s,!0)},{type:"text",value:`
`}]}}const HL=(function(o){if(o==null)return aH;if(typeof o=="function")return q1(o);if(typeof o=="object")return Array.isArray(o)?iH(o):rH(o);if(typeof o=="string")return sH(o);throw new Error("Expected function, string, or object as test")});function iH(o){const t=[];let a=-1;for(;++a<o.length;)t[a]=HL(o[a]);return q1(u);function u(...y){let T=-1;for(;++T<t.length;)if(t[T].apply(this,y))return!0;return!1}}function rH(o){const t=o;return q1(a);function a(u){const y=u;let T;for(T in o)if(y[T]!==t[T])return!1;return!0}}function sH(o){return q1(t);function t(a){return a&&a.type===o}}function q1(o){return t;function t(a,u,y){return!!(oH(a)&&o.call(this,a,typeof u=="number"?u:void 0,y||void 0))}}function aH(){return!0}function oH(o){return o!==null&&typeof o=="object"&&"type"in o}const $L=[],lH=!0,zM=!1,cH="skip";function uH(o,t,a,u){let y;typeof t=="function"&&typeof a!="function"?(u=a,a=t):y=t;const T=HL(y),C=u?-1:1;s(o,void 0,[])();function s(V,B,W){const Y=V&&typeof V=="object"?V:{};if(typeof Y.type=="string"){const he=typeof Y.tagName=="string"?Y.tagName:typeof Y.name=="string"?Y.name:void 0;Object.defineProperty(ae,"name",{value:"node ("+(V.type+(he?"<"+he+">":""))+")"})}return ae;function ae(){let he=$L,Qe,Ye,Ke;if((!t||T(V,B,W[W.length-1]||void 0))&&(he=hH(a(V,W)),he[0]===zM))return he;if("children"in V&&V.children){const at=V;if(at.children&&he[0]!==cH)for(Ye=(u?at.children.length:-1)+C,Ke=W.concat(at);Ye>-1&&Ye<at.children.length;){const nt=at.children[Ye];if(Qe=s(nt,Ye,Ke)(),Qe[0]===zM)return Qe;Ye=typeof Qe[1]=="number"?Qe[1]:Ye+C}}return he}}}function hH(o){return Array.isArray(o)?o:typeof o=="number"?[lH,o]:o==null?$L:[o]}function ZL(o,t,a,u){let y,T,C;typeof t=="function"&&typeof a!="function"?(T=void 0,C=t,y=a):(T=t,C=a,y=u),uH(o,T,s,y);function s(V,B){const W=B[B.length-1],Y=W?W.children.indexOf(V):void 0;return C(V,Y,W)}}const PE={}.hasOwnProperty,dH={};function fH(o,t){const a=t||dH,u=new Map,y=new Map,T=new Map,C={...Xq,...a.handlers},s={all:B,applyData:mH,definitionById:u,footnoteById:y,footnoteCounts:T,footnoteOrder:[],handlers:C,one:V,options:a,patch:pH,wrap:_H};return ZL(o,function(W){if(W.type==="definition"||W.type==="footnoteDefinition"){const Y=W.type==="definition"?u:y,ae=String(W.identifier).toUpperCase();Y.has(ae)||Y.set(ae,W)}}),s;function V(W,Y){const ae=W.type,he=s.handlers[ae];if(PE.call(s.handlers,ae)&&he)return he(s,W,Y);if(s.options.passThrough&&s.options.passThrough.includes(ae)){if("children"in W){const{children:Ye,...Ke}=W,at=_1(Ke);return at.children=s.all(W),at}return _1(W)}return(s.options.unknownHandler||gH)(s,W,Y)}function B(W){const Y=[];if("children"in W){const ae=W.children;let he=-1;for(;++he<ae.length;){const Qe=s.one(ae[he],W);if(Qe){if(he&&ae[he-1].type==="break"&&(!Array.isArray(Qe)&&Qe.type==="text"&&(Qe.value=NM(Qe.value)),!Array.isArray(Qe)&&Qe.type==="element")){const Ye=Qe.children[0];Ye&&Ye.type==="text"&&(Ye.value=NM(Ye.value))}Array.isArray(Qe)?Y.push(...Qe):Y.push(Qe)}}}return Y}}function pH(o,t){o.position&&(t.position=K8(o))}function mH(o,t){let a=t;if(o&&o.data){const u=o.data.hName,y=o.data.hChildren,T=o.data.hProperties;if(typeof u=="string")if(a.type==="element")a.tagName=u;else{const C="children"in a?a.children:[a];a={type:"element",tagName:u,properties:{},children:C}}a.type==="element"&&T&&Object.assign(a.properties,_1(T)),"children"in a&&a.children&&y!==null&&y!==void 0&&(a.children=y)}return a}function gH(o,t){const a=t.data||{},u="value"in t&&!(PE.call(a,"hProperties")||PE.call(a,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:o.all(t)};return o.patch(t,u),o.applyData(t,u)}function _H(o,t){const a=[];let u=-1;for(t&&a.push({type:"text",value:`
`});++u<o.length;)u&&a.push({type:"text",value:`
`}),a.push(o[u]);return t&&o.length>0&&a.push({type:"text",value:`
`}),a}function NM(o){let t=0,a=o.charCodeAt(t);for(;a===9||a===32;)t++,a=o.charCodeAt(t);return o.slice(t)}function BM(o,t){const a=fH(o,t),u=a.one(o,void 0),y=nH(a),T=Array.isArray(u)?{type:"root",children:u}:u||{type:"root",children:[]};return y&&T.children.push({type:"text",value:`
`},y),T}function yH(o,t){return o&&"run"in o?async function(a,u){const y=BM(a,{file:u,...t});await o.run(y,u)}:function(a,u){return BM(a,{file:u,...o||t})}}function FM(o){if(o)throw o}var BT,VM;function xH(){if(VM)return BT;VM=1;var o=Object.prototype.hasOwnProperty,t=Object.prototype.toString,a=Object.defineProperty,u=Object.getOwnPropertyDescriptor,y=function(B){return typeof Array.isArray=="function"?Array.isArray(B):t.call(B)==="[object Array]"},T=function(B){if(!B||t.call(B)!=="[object Object]")return!1;var W=o.call(B,"constructor"),Y=B.constructor&&B.constructor.prototype&&o.call(B.constructor.prototype,"isPrototypeOf");if(B.constructor&&!W&&!Y)return!1;var ae;for(ae in B);return typeof ae>"u"||o.call(B,ae)},C=function(B,W){a&&W.name==="__proto__"?a(B,W.name,{enumerable:!0,configurable:!0,value:W.newValue,writable:!0}):B[W.name]=W.newValue},s=function(B,W){if(W==="__proto__")if(o.call(B,W)){if(u)return u(B,W).value}else return;return B[W]};return BT=function V(){var B,W,Y,ae,he,Qe,Ye=arguments[0],Ke=1,at=arguments.length,nt=!1;for(typeof Ye=="boolean"&&(nt=Ye,Ye=arguments[1]||{},Ke=2),(Ye==null||typeof Ye!="object"&&typeof Ye!="function")&&(Ye={});Ke<at;++Ke)if(B=arguments[Ke],B!=null)for(W in B)Y=s(Ye,W),ae=s(B,W),Ye!==ae&&(nt&&ae&&(T(ae)||(he=y(ae)))?(he?(he=!1,Qe=Y&&y(Y)?Y:[]):Qe=Y&&T(Y)?Y:{},C(Ye,{name:W,newValue:V(nt,Qe,ae)})):typeof ae<"u"&&C(Ye,{name:W,newValue:ae}));return Ye},BT}var vH=xH();const FT=Uv(vH);function kE(o){if(typeof o!="object"||o===null)return!1;const t=Object.getPrototypeOf(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)}function bH(){const o=[],t={run:a,use:u};return t;function a(...y){let T=-1;const C=y.pop();if(typeof C!="function")throw new TypeError("Expected function as last argument, not "+C);s(null,...y);function s(V,...B){const W=o[++T];let Y=-1;if(V){C(V);return}for(;++Y<y.length;)(B[Y]===null||B[Y]===void 0)&&(B[Y]=y[Y]);y=B,W?wH(W,s)(...B):C(null,...B)}}function u(y){if(typeof y!="function")throw new TypeError("Expected `middelware` to be a function, not "+y);return o.push(y),t}}function wH(o,t){let a;return u;function u(...C){const s=o.length>C.length;let V;s&&C.push(y);try{V=o.apply(this,C)}catch(B){const W=B;if(s&&a)throw W;return y(W)}s||(V&&V.then&&typeof V.then=="function"?V.then(T,y):V instanceof Error?y(V):T(V))}function y(C,...s){a||(a=!0,t(C,...s))}function T(C){y(null,C)}}const Jd={basename:TH,dirname:EH,extname:SH,join:AH,sep:"/"};function TH(o,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');i0(o);let a=0,u=-1,y=o.length,T;if(t===void 0||t.length===0||t.length>o.length){for(;y--;)if(o.codePointAt(y)===47){if(T){a=y+1;break}}else u<0&&(T=!0,u=y+1);return u<0?"":o.slice(a,u)}if(t===o)return"";let C=-1,s=t.length-1;for(;y--;)if(o.codePointAt(y)===47){if(T){a=y+1;break}}else C<0&&(T=!0,C=y+1),s>-1&&(o.codePointAt(y)===t.codePointAt(s--)?s<0&&(u=y):(s=-1,u=C));return a===u?u=C:u<0&&(u=o.length),o.slice(a,u)}function EH(o){if(i0(o),o.length===0)return".";let t=-1,a=o.length,u;for(;--a;)if(o.codePointAt(a)===47){if(u){t=a;break}}else u||(u=!0);return t<0?o.codePointAt(0)===47?"/":".":t===1&&o.codePointAt(0)===47?"//":o.slice(0,t)}function SH(o){i0(o);let t=o.length,a=-1,u=0,y=-1,T=0,C;for(;t--;){const s=o.codePointAt(t);if(s===47){if(C){u=t+1;break}continue}a<0&&(C=!0,a=t+1),s===46?y<0?y=t:T!==1&&(T=1):y>-1&&(T=-1)}return y<0||a<0||T===0||T===1&&y===a-1&&y===u+1?"":o.slice(y,a)}function AH(...o){let t=-1,a;for(;++t<o.length;)i0(o[t]),o[t]&&(a=a===void 0?o[t]:a+"/"+o[t]);return a===void 0?".":IH(a)}function IH(o){i0(o);const t=o.codePointAt(0)===47;let a=CH(o,!t);return a.length===0&&!t&&(a="."),a.length>0&&o.codePointAt(o.length-1)===47&&(a+="/"),t?"/"+a:a}function CH(o,t){let a="",u=0,y=-1,T=0,C=-1,s,V;for(;++C<=o.length;){if(C<o.length)s=o.codePointAt(C);else{if(s===47)break;s=47}if(s===47){if(!(y===C-1||T===1))if(y!==C-1&&T===2){if(a.length<2||u!==2||a.codePointAt(a.length-1)!==46||a.codePointAt(a.length-2)!==46){if(a.length>2){if(V=a.lastIndexOf("/"),V!==a.length-1){V<0?(a="",u=0):(a=a.slice(0,V),u=a.length-1-a.lastIndexOf("/")),y=C,T=0;continue}}else if(a.length>0){a="",u=0,y=C,T=0;continue}}t&&(a=a.length>0?a+"/..":"..",u=2)}else a.length>0?a+="/"+o.slice(y+1,C):a=o.slice(y+1,C),u=C-y-1;y=C,T=0}else s===46&&T>-1?T++:T=-1}return a}function i0(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}const RH={cwd:MH};function MH(){return"/"}function LE(o){return!!(o!==null&&typeof o=="object"&&"href"in o&&o.href&&"protocol"in o&&o.protocol&&o.auth===void 0)}function DH(o){if(typeof o=="string")o=new URL(o);else if(!LE(o)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+o+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(o.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return PH(o)}function PH(o){if(o.hostname!==""){const u=new TypeError('File URL host must be "localhost" or empty on darwin');throw u.code="ERR_INVALID_FILE_URL_HOST",u}const t=o.pathname;let a=-1;for(;++a<t.length;)if(t.codePointAt(a)===37&&t.codePointAt(a+1)===50){const u=t.codePointAt(a+2);if(u===70||u===102){const y=new TypeError("File URL path must not include encoded / characters");throw y.code="ERR_INVALID_FILE_URL_PATH",y}}return decodeURIComponent(t)}const VT=["history","path","basename","stem","extname","dirname"];class WL{constructor(t){let a;t?LE(t)?a={path:t}:typeof t=="string"||kH(t)?a={value:t}:a=t:a={},this.cwd="cwd"in a?"":RH.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let u=-1;for(;++u<VT.length;){const T=VT[u];T in a&&a[T]!==void 0&&a[T]!==null&&(this[T]=T==="history"?[...a[T]]:a[T])}let y;for(y in a)VT.includes(y)||(this[y]=a[y])}get basename(){return typeof this.path=="string"?Jd.basename(this.path):void 0}set basename(t){UT(t,"basename"),jT(t,"basename"),this.path=Jd.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Jd.dirname(this.path):void 0}set dirname(t){jM(this.basename,"dirname"),this.path=Jd.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Jd.extname(this.path):void 0}set extname(t){if(jT(t,"extname"),jM(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Jd.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){LE(t)&&(t=DH(t)),UT(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Jd.basename(this.path,this.extname):void 0}set stem(t){UT(t,"stem"),jT(t,"stem"),this.path=Jd.join(this.dirname||"",t+(this.extname||""))}fail(t,a,u){const y=this.message(t,a,u);throw y.fatal=!0,y}info(t,a,u){const y=this.message(t,a,u);return y.fatal=void 0,y}message(t,a,u){const y=new Cl(t,a,u);return this.path&&(y.name=this.path+":"+y.name,y.file=this.path),y.fatal=!1,this.messages.push(y),y}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function jT(o,t){if(o&&o.includes(Jd.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Jd.sep+"`")}function UT(o,t){if(!o)throw new Error("`"+t+"` cannot be empty")}function jM(o,t){if(!o)throw new Error("Setting `"+t+"` requires `path` to be set too")}function kH(o){return!!(o&&typeof o=="object"&&"byteLength"in o&&"byteOffset"in o)}const LH=(function(o){const u=this.constructor.prototype,y=u[o],T=function(){return y.apply(T,arguments)};return Object.setPrototypeOf(T,u),T}),OH={}.hasOwnProperty;class iA extends LH{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=bH()}copy(){const t=new iA;let a=-1;for(;++a<this.attachers.length;){const u=this.attachers[a];t.use(...u)}return t.data(FT(!0,{},this.namespace)),t}data(t,a){return typeof t=="string"?arguments.length===2?(HT("data",this.frozen),this.namespace[t]=a,this):OH.call(this.namespace,t)&&this.namespace[t]||void 0:t?(HT("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[a,...u]=this.attachers[this.freezeIndex];if(u[0]===!1)continue;u[0]===!0&&(u[0]=void 0);const y=a.call(t,...u);typeof y=="function"&&this.transformers.use(y)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const a=Cb(t),u=this.parser||this.Parser;return GT("parse",u),u(String(a),a)}process(t,a){const u=this;return this.freeze(),GT("process",this.parser||this.Parser),qT("process",this.compiler||this.Compiler),a?y(void 0,a):new Promise(y);function y(T,C){const s=Cb(t),V=u.parse(s);u.run(V,s,function(W,Y,ae){if(W||!Y||!ae)return B(W);const he=Y,Qe=u.stringify(he,ae);BH(Qe)?ae.value=Qe:ae.result=Qe,B(W,ae)});function B(W,Y){W||!Y?C(W):T?T(Y):a(void 0,Y)}}}processSync(t){let a=!1,u;return this.freeze(),GT("processSync",this.parser||this.Parser),qT("processSync",this.compiler||this.Compiler),this.process(t,y),GM("processSync","process",a),u;function y(T,C){a=!0,FM(T),u=C}}run(t,a,u){UM(t),this.freeze();const y=this.transformers;return!u&&typeof a=="function"&&(u=a,a=void 0),u?T(void 0,u):new Promise(T);function T(C,s){const V=Cb(a);y.run(t,V,B);function B(W,Y,ae){const he=Y||t;W?s(W):C?C(he):u(void 0,he,ae)}}}runSync(t,a){let u=!1,y;return this.run(t,a,T),GM("runSync","run",u),y;function T(C,s){FM(C),y=s,u=!0}}stringify(t,a){this.freeze();const u=Cb(a),y=this.compiler||this.Compiler;return qT("stringify",y),UM(t),y(t,u)}use(t,...a){const u=this.attachers,y=this.namespace;if(HT("use",this.frozen),t!=null)if(typeof t=="function")V(t,a);else if(typeof t=="object")Array.isArray(t)?s(t):C(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function T(B){if(typeof B=="function")V(B,[]);else if(typeof B=="object")if(Array.isArray(B)){const[W,...Y]=B;V(W,Y)}else C(B);else throw new TypeError("Expected usable value, not `"+B+"`")}function C(B){if(!("plugins"in B)&&!("settings"in B))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");s(B.plugins),B.settings&&(y.settings=FT(!0,y.settings,B.settings))}function s(B){let W=-1;if(B!=null)if(Array.isArray(B))for(;++W<B.length;){const Y=B[W];T(Y)}else throw new TypeError("Expected a list of plugins, not `"+B+"`")}function V(B,W){let Y=-1,ae=-1;for(;++Y<u.length;)if(u[Y][0]===B){ae=Y;break}if(ae===-1)u.push([B,...W]);else if(W.length>0){let[he,...Qe]=W;const Ye=u[ae][1];kE(Ye)&&kE(he)&&(he=FT(!0,Ye,he)),u[ae]=[B,he,...Qe]}}}}const zH=new iA().freeze();function GT(o,t){if(typeof t!="function")throw new TypeError("Cannot `"+o+"` without `parser`")}function qT(o,t){if(typeof t!="function")throw new TypeError("Cannot `"+o+"` without `compiler`")}function HT(o,t){if(t)throw new Error("Cannot call `"+o+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function UM(o){if(!kE(o)||typeof o.type!="string")throw new TypeError("Expected node, got `"+o+"`")}function GM(o,t,a){if(!a)throw new Error("`"+o+"` finished async. Use `"+t+"` instead")}function Cb(o){return NH(o)?o:new WL(o)}function NH(o){return!!(o&&typeof o=="object"&&"message"in o&&"messages"in o)}function BH(o){return typeof o=="string"||FH(o)}function FH(o){return!!(o&&typeof o=="object"&&"byteLength"in o&&"byteOffset"in o)}const VH="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",qM=[],HM={allowDangerousHtml:!0},jH=/^(https?|ircs?|mailto|xmpp)$/i,UH=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function GH(o){const t=qH(o),a=HH(o);return $H(t.runSync(t.parse(a),a),o)}function qH(o){const t=o.rehypePlugins||qM,a=o.remarkPlugins||qM,u=o.remarkRehypeOptions?{...o.remarkRehypeOptions,...HM}:HM;return zH().use(Tq).use(a).use(yH,u).use(t)}function HH(o){const t=o.children||"",a=new WL;return typeof t=="string"&&(a.value=t),a}function $H(o,t){const a=t.allowedElements,u=t.allowElement,y=t.components,T=t.disallowedElements,C=t.skipHtml,s=t.unwrapDisallowed,V=t.urlTransform||ZH;for(const W of UH)Object.hasOwn(t,W.from)&&(""+W.from+(W.to?"use `"+W.to+"` instead":"remove it")+VH+W.id,void 0);return ZL(o,B),n9(o,{Fragment:N.Fragment,components:y,ignoreInvalidStyle:!0,jsx:N.jsx,jsxs:N.jsxs,passKeys:!0,passNode:!0});function B(W,Y,ae){if(W.type==="raw"&&ae&&typeof Y=="number")return C?ae.children.splice(Y,1):ae.children[Y]={type:"text",value:W.value},Y;if(W.type==="element"){let he;for(he in OT)if(Object.hasOwn(OT,he)&&Object.hasOwn(W.properties,he)){const Qe=W.properties[he],Ye=OT[he];(Ye===null||Ye.includes(W.tagName))&&(W.properties[he]=V(String(Qe||""),he,W))}}if(W.type==="element"){let he=a?!a.includes(W.tagName):T?T.includes(W.tagName):!1;if(!he&&u&&typeof Y=="number"&&(he=!u(W,Y,ae)),he&&ae&&typeof Y=="number")return s&&W.children?ae.children.splice(Y,1,...W.children):ae.children.splice(Y,1),Y}}}function ZH(o){const t=o.indexOf(":"),a=o.indexOf("?"),u=o.indexOf("#"),y=o.indexOf("/");return t===-1||y!==-1&&t>y||a!==-1&&t>a||u!==-1&&t>u||jH.test(o.slice(0,t))?o:""}const WH=({onClose:o,onConfirm:t,availableSlots:a=[]})=>{const[u,y]=Ue.useState(null),T=a&&a.length>0,C={},s=new Set,V=[];if(T){a.forEach(Ke=>{C[Ke.day]||(C[Ke.day]=[],s.has(Ke.day)||(s.add(Ke.day),V.push({day:Ke.day,date:Ke.date}))),C[Ke.day].includes(Ke.time)||C[Ke.day].push(Ke.time)});const Ye=["SUN","MON","TUE","WED","THU","FRI","SAT"];V.sort((Ke,at)=>Ye.indexOf(Ke.day)-Ye.indexOf(at.day))}const B=[{day:"SAT",date:"25"},{day:"SUN",date:"26"},{day:"MON",date:"27"},{day:"TUE",date:"28"},{day:"WED",date:"29"},{day:"THU",date:"30"},{day:"FRI",date:"31"}],W={SAT:["10:00 AM","11:30 AM"],SUN:["09:00 AM","01:00 PM"],MON:["09:00 AM","10:30 AM","02:00 PM"],TUE:["08:00 AM","11:00 AM","03:30 PM"],WED:["02:00 PM","04:30 PM"],THU:["09:00 AM","11:00 AM","02:30 PM","04:00 PM"],FRI:["09:15 AM","03:00 PM","05:00 PM"]},Y=T?V:B,ae=T?C:W,he=(Ye,Ke,at)=>{y({day:Ye,date:Ke,time:at})},Qe=()=>{u&&t&&t(u)};return N.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[N.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Schedule Appointment"}),N.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:"January 2025  Select an available time"})]}),o&&N.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:N.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),N.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:N.jsx("div",{className:"grid grid-cols-7 gap-2",children:Y.map(Ye=>{var Ke;return N.jsxs("div",{className:"flex flex-col",children:[N.jsxs("div",{className:"text-center pb-2 border-b border-black/5 mb-2",children:[N.jsx("div",{className:"text-[9px] font-black uppercase tracking-wider text-gray-400",children:Ye.day}),N.jsx("div",{className:"text-lg font-black text-primary",children:Ye.date})]}),N.jsx("div",{className:"space-y-2",children:(Ke=ae[Ye.day])==null?void 0:Ke.map(at=>{const nt=(u==null?void 0:u.day)===Ye.day&&(u==null?void 0:u.time)===at;return N.jsx("button",{onClick:()=>he(Ye.day,Ye.date,at),className:`w-full py-2 px-1 rounded-xl text-[10px] font-bold transition-all ${nt?"bg-primary text-white shadow-lg scale-105":"bg-white border border-black/5 text-primary hover:border-primary hover:scale-102"}`,children:at},at)})})]},Ye.day)})})}),N.jsxs("div",{className:"p-4 border-t border-black/5 bg-white/50 backdrop-blur-sm flex-shrink-0 space-y-3",children:[u?N.jsxs("div",{className:"bg-white rounded-xl p-4 border border-black/5 flex items-center gap-3",children:[N.jsx("span",{className:"size-10 rounded-full bg-primary/10 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-primary",children:"event"})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-[10px] text-gray-400 font-medium uppercase tracking-wider",children:"Selected"}),N.jsxs("p",{className:"font-bold text-primary text-sm",children:[u.day,", Jan ",u.date," at ",u.time]})]})]}):N.jsx("div",{className:"text-center py-2 text-gray-400 text-xs",children:"Select a time slot above"}),N.jsx("button",{onClick:Qe,disabled:!u,className:`w-full py-4 rounded-2xl text-sm font-black transition-all ${u?"bg-primary text-white shadow-lg shadow-black/5 hover:bg-black active:scale-[0.98]":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:"Confirm Appointment"})]})]})},XH=({onClose:o,minimized:t=!1,transcript:a=[],agentNeedsInput:u=!1,agentQuestion:y="",agentContext:T="",onUserResponse:C})=>{const s=Ue.useRef(null),[V,B]=Ue.useState(""),[W,Y]=Ue.useState(!1);Ue.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[a,u]);const ae=()=>{!V.trim()||!C||(Y(!0),C(V.trim()),B(""),setTimeout(()=>Y(!1),1e3))},he=Qe=>Qe==="bot"?"ai":"other";return N.jsxs("div",{className:`w-full shadow-xl z-20 flex flex-col ${t?"bg-green-600":"h-full bg-soft-cream"}`,children:[!t&&N.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[N.jsxs("div",{ref:s,className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-6",children:[a.length===0?N.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 opacity-60",children:[N.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"graphic_eq"}),N.jsx("p",{className:"text-sm font-medium",children:"Waiting for conversation..."})]}):a.map((Qe,Ye)=>he(Qe.sender)==="ai"?N.jsxs("div",{className:"flex flex-row-reverse gap-3",children:[N.jsx("div",{className:"size-8 bg-green-600 rounded-full flex items-center justify-center shadow-md flex-shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-white text-sm fill-1",children:"smart_toy"})}),N.jsxs("div",{className:"bg-green-600 p-4 rounded-2xl rounded-tr-none shadow-xl text-white max-w-[85%]",children:[N.jsx("div",{className:"flex items-center gap-2 mb-1",children:N.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider opacity-80",children:"AI Assistant"})}),N.jsx("p",{className:"text-xs md:text-sm leading-relaxed",children:Qe.message})]})]},Ye):N.jsxs("div",{className:"flex gap-3",children:[N.jsx("div",{className:"size-8 rounded-full overflow-hidden border border-black/5 flex-shrink-0 bg-white flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-gray-500 text-sm",children:"support_agent"})}),N.jsxs("div",{className:"bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-black/5 max-w-[85%]",children:[N.jsx("div",{className:"flex items-center gap-2 mb-1",children:N.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider text-gray-500",children:"Receptionist"})}),N.jsx("p",{className:"text-xs md:text-sm text-primary leading-relaxed",children:Qe.message})]})]},Ye)),u&&N.jsx("div",{children:N.jsxs("div",{className:"bg-card-beige border-2 border-primary/20 rounded-[32px] p-6 shadow-lg",children:[N.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[N.jsx("div",{className:"size-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0 shadow-md",children:N.jsx("span",{className:"material-symbols-outlined text-white",children:"help"})}),N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-primary/60",children:"Input Needed"}),N.jsx("span",{className:"size-2 bg-primary rounded-full"})]}),N.jsx("p",{className:"text-primary font-bold text-lg",children:y||"The agent needs information from you"}),T&&N.jsx("p",{className:"text-sm text-gray-500 mt-1",children:T})]})]}),N.jsxs("div",{className:"flex gap-3",children:[N.jsx("input",{type:"text",value:V,onChange:Qe=>B(Qe.target.value),onKeyDown:Qe=>Qe.key==="Enter"&&ae(),placeholder:"Type your response...",className:"flex-1 bg-white border border-black/5 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:border-primary/30 focus:ring-2 focus:ring-primary/10 transition-all shadow-sm",autoFocus:!0,disabled:W}),N.jsx("button",{onClick:ae,disabled:!V.trim()||W,className:`px-6 py-3 rounded-2xl font-black text-sm transition-all flex items-center gap-2 ${!V.trim()||W?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10"}`,children:W?N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Sending"]}):N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"send"}),"Send"]})})]}),N.jsx("p",{className:"text-[10px] text-gray-400 font-medium mt-3 text-center",children:"The receptionist is waiting. Your response will be relayed by the AI agent."})]})})]}),N.jsx("div",{className:"flex justify-center items-center gap-1 py-6 bg-soft-cream/95 backdrop-blur-sm border-t border-black/5 shrink-0 z-10",children:[.1,.4,.2,.6,.3,.5,.2].map((Qe,Ye)=>N.jsx("div",{className:"waveform-bar w-1 bg-green-500 rounded-full h-6",style:{height:`${12+Ye%3*8}px`}},Ye))})]}),N.jsxs("div",{className:"bg-green-600 p-4 flex items-center justify-between gap-4 flex-shrink-0",children:[N.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[N.jsx("div",{className:"size-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm flex-shrink-0",children:N.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"phone_in_talk"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-black text-white",children:"Relay Call Active"}),N.jsx("p",{className:"text-[11px] text-white/80 font-mono mt-0.5",children:"Recording  Live"})]})]}),N.jsxs("button",{onClick:o,className:"bg-white text-green-600 rounded-2xl font-black text-xs px-5 py-3 flex items-center justify-center gap-2 hover:bg-gray-100 transition-all active:scale-95",children:[N.jsx("span",{className:"material-symbols-outlined text-lg rotate-[135deg]",children:"call"}),"End"]})]})]})},YH="modulepreload",KH=function(o){return"/"+o},$M={},QH=function(t,a,u){let y=Promise.resolve();if(a&&a.length>0){let C=function(B){return Promise.all(B.map(W=>Promise.resolve(W).then(Y=>({status:"fulfilled",value:Y}),Y=>({status:"rejected",reason:Y}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),V=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));y=C(a.map(B=>{if(B=KH(B),B in $M)return;$M[B]=!0;const W=B.endsWith(".css"),Y=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${B}"]${Y}`))return;const ae=document.createElement("link");if(ae.rel=W?"stylesheet":YH,W||(ae.as="script"),ae.crossOrigin="",ae.href=B,V&&ae.setAttribute("nonce",V),document.head.appendChild(ae),W)return new Promise((he,Qe)=>{ae.addEventListener("load",he),ae.addEventListener("error",()=>Qe(new Error(`Unable to preload CSS for ${B}`)))})}))}function T(C){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=C,window.dispatchEvent(s),!s.defaultPrevented)throw C}return y.then(C=>{for(const s of C||[])s.status==="rejected"&&T(s.reason);return t().catch(T)})},JH=Ue.createContext(null);function e7(o){return{longitude:o.center.lng,latitude:o.center.lat,zoom:o._seaLevelZoom??o.zoom,pitch:o.pitch,bearing:o.bearing,padding:o.padding,elevation:o._centerAltitude}}function t7(o){return Number.isFinite(o.longitude)||Number.isFinite(o.latitude)||Number.isFinite(o.zoom)||Number.isFinite(o.pitch)||Number.isFinite(o.bearing)}function n7(o,t){return!!(Number.isFinite(t.longitude)&&o.center.lng!==t.longitude||Number.isFinite(t.latitude)&&o.center.lat!==t.latitude||Number.isFinite(t.bearing)&&o.bearing!==t.bearing||Number.isFinite(t.pitch)&&o.pitch!==t.pitch||Number.isFinite(t.zoom)&&(o._seaLevelZoom??o.zoom)!==t.zoom||t.padding&&!o.isPaddingEqual(t.padding))}function ZM(){}function i7(o,t){const a=o._constrain,u=o._calcMatrices;if(o._constrain=ZM,o._calcMatrices=ZM,Number.isFinite(t.bearing)&&(o.bearing=t.bearing),Number.isFinite(t.pitch)&&(o.pitch=t.pitch),t.padding&&!o.isPaddingEqual(t.padding)&&(o.padding=t.padding),Number.isFinite(t.longitude)||Number.isFinite(t.latitude)){const y=o.center;o._center=new y.constructor(t.longitude??y.lng,t.latitude??y.lat)}if(Number.isFinite(t.zoom))if(o._centerAltitude=t.elevation??0,o.elevation){o._seaLevelZoom=t.zoom;const y=o.pixelsPerMeter/o.worldSize*o._centerAltitude,T=o._mercatorZfromZoom(t.zoom),C=o._mercatorZfromZoom(o._maxZoom),s=Math.max(T-y,C);o._setZoom(o._zoomFromMercatorZ(s))}else o._seaLevelZoom=null,o.zoom=t.zoom;o._constrain=a,o._calcMatrices=u,o._unmodified||(o._constrain(),o._calcMatrices())}const r7=new Set(["_calcMatrices","_calcFogMatrices","_updateCameraState","_updateSeaLevelZoom"]);function s7(o){let t=!1,a={};const u=o;let y=null;const T={get(C,s){return s==="$reactViewState"?a:s==="$proposedTransform"?y:s==="$internalUpdate"?t:s==="_setZoom"?V=>{t&&(y==null||y[s](V)),Number.isFinite(a.zoom)||u[s](V)}:(t&&s==="_translateCameraConstrained"&&t7(a)&&(y=y||u.clone()),r7.has(s)?function(...V){y==null||y[s](...V),u[s](...V)}:t&&y?y[s]:u[s])},set(C,s,V){if(s==="$reactViewState")return a=V,i7(u,a),!0;if(s==="$proposedTransform")return y=V,!0;if(s==="$internalUpdate")return t=V,!0;let B=V;return s==="center"||s==="_center"?(Number.isFinite(a.longitude)||Number.isFinite(a.latitude))&&(B=new V.constructor(a.longitude??V.lng,a.latitude??V.lat)):s==="zoom"||s==="_zoom"||s==="_seaLevelZoom"?Number.isFinite(a.zoom)&&(B=u[s]):s==="_centerAltitude"?Number.isFinite(a.elevation)&&(B=u[s]):s==="pitch"||s==="_pitch"?Number.isFinite(a.pitch)&&(B=u[s]):(s==="bearing"||s==="rotation"||s==="angle")&&Number.isFinite(a.bearing)&&(B=u[s]),t&&B!==V&&(y=y||u.clone()),t&&y&&(y[s]=V),u[s]=B,!0}};return new Proxy(o,T)}const a7=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function WM(o){if(!o)return null;if(typeof o=="string"||("toJS"in o&&(o=o.toJS()),!o.layers))return o;const t={};for(const u of o.layers)t[u.id]=u;const a=o.layers.map(u=>{let y=null;"interactive"in u&&(y=Object.assign({},u),delete y.interactive);const T=t[u.ref];if(T){y=y||Object.assign({},u),delete y.ref;for(const C of a7)C in T&&(y[C]=T[C])}return y||u});return{...o,layers:a}}function o7(o,t){const a=Array.isArray(o)?o[0]:o?o.x:0,u=Array.isArray(o)?o[1]:o?o.y:0,y=Array.isArray(t)?t[0]:t?t.x:0,T=Array.isArray(t)?t[1]:t?t.y:0;return a===y&&u===T}function eh(o,t){if(o===t)return!0;if(!o||!t)return!1;if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let a=0;a<o.length;a++)if(!eh(o[a],t[a]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof o=="object"&&typeof t=="object"){const a=Object.keys(o),u=Object.keys(t);if(a.length!==u.length)return!1;for(const y of a)if(!t.hasOwnProperty(y)||!eh(o[y],t[y]))return!1;return!0}return!1}var XM={};const YM={version:8,sources:{},layers:[]},KM={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},QM={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},JM={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},l7=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],c7=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class jy{constructor(t,a,u){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=y=>{const T=this.props[JM[y.type]];T?T(y):y.type==="error"&&console.error(y.error)},this._onPointerEvent=y=>{(y.type==="mousemove"||y.type==="mouseout")&&this._updateHover(y);const T=this.props[KM[y.type]];T&&(this.props.interactiveLayerIds&&y.type!=="mouseover"&&y.type!=="mouseout"&&(y.features=this._hoveredFeatures||this._queryRenderedFeatures(y.point)),T(y),delete y.features)},this._onCameraEvent=y=>{if(!this._internalUpdate){const T=this.props[QM[y.type]],C=this._proxyTransform;T&&(y.viewState=e7(C.$proposedTransform??C),T(y)),y.type==="moveend"&&(C.$proposedTransform=null)}y.type in this._deferredEvents&&(this._deferredEvents[y.type]=!1)},this._MapClass=t,this.props=a,this._initialize(u)}get map(){return this._map}get transform(){return this._map.transform}setProps(t){const a=this.props;this.props=t;const u=this._updateSettings(t,a);u&&this._createProxyTransform(this._map);const y=this._updateSize(t),T=this._updateViewState(t,!0);this._updateStyle(t,a),this._updateStyleComponents(t,a),this._updateHandlers(t,a),(u||y||T&&!this._map.isMoving())&&this.redraw()}static reuse(t,a){const u=jy.savedMaps.pop();if(!u)return null;const y=u.map,T=y.getContainer();for(a.className=T.className;T.childNodes.length>0;)a.appendChild(T.childNodes[0]);y._container=a,u.setProps({...t,styleDiffing:!1}),y.resize();const{initialViewState:C}=t;return C&&(C.bounds?y.fitBounds(C.bounds,{...C.fitBoundsOptions,duration:0}):u._updateViewState(C,!1)),y.isStyleLoaded()?y.fire("load"):y.once("styledata",()=>y.fire("load")),y._update(),u}_initialize(t){const{props:a}=this,{mapStyle:u=YM}=a,y={...a,...a.initialViewState,accessToken:a.mapboxAccessToken||u7()||null,container:t,style:WM(u)},T=y.initialViewState||y.viewState||y;if(Object.assign(y,{center:[T.longitude||0,T.latitude||0],zoom:T.zoom||0,pitch:T.pitch||0,bearing:T.bearing||0}),a.gl){const Y=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Y,a.gl)}const C=new this._MapClass(y);T.padding&&C.setPadding(T.padding),a.cursor&&(C.getCanvas().style.cursor=a.cursor),this._createProxyTransform(C);const s=C._render;C._render=Y=>{this._inRender=!0,s.call(C,Y),this._inRender=!1};const V=C._renderTaskQueue.run;C._renderTaskQueue.run=Y=>{this._proxyTransform.$internalUpdate=!0,V.call(C._renderTaskQueue,Y),this._proxyTransform.$internalUpdate=!1,this._fireDefferedEvents()};const B=C.jumpTo;C.jumpTo=(...Y)=>(this._proxyTransform.$internalUpdate=!0,B.apply(C,Y),this._proxyTransform.$internalUpdate=!1,C);const W=C.fire;C.fire=this._fireEvent.bind(this,W),C.on("styledata",()=>{this._updateStyleComponents(this.props,{})}),C.on("sourcedata",()=>{this._updateStyleComponents(this.props,{})});for(const Y in KM)C.on(Y,this._onPointerEvent);for(const Y in QM)C.on(Y,this._onCameraEvent);for(const Y in JM)C.on(Y,this._onEvent);this._map=C}recycle(){const a=this.map.getContainer().querySelector("[mapboxgl-children]");a==null||a.remove(),jy.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createProxyTransform(t){const a=s7(t.transform);t.transform=a,t.painter.transform=a,this._proxyTransform=a}_updateSize(t){const{viewState:a}=t;if(a){const u=this._map;if(a.width!==u.transform.width||a.height!==u.transform.height)return u.resize(),!0}return!1}_updateViewState(t,a){const u=t.viewState||t,y=this._proxyTransform,{zoom:T,pitch:C,bearing:s}=y,V=n7(this._proxyTransform,u);if(y.$reactViewState=u,V&&a){const B=this._deferredEvents;B.move=!0,B.zoom||(B.zoom=T!==y.zoom),B.rotate||(B.rotate=s!==y.bearing),B.pitch||(B.pitch=C!==y.pitch)}return V}_updateSettings(t,a){const u=this._map;let y=!1;for(const T of l7)if(T in t&&!eh(t[T],a[T])){y=!0;const C=u[`set${T[0].toUpperCase()}${T.slice(1)}`];C==null||C.call(u,t[T])}return y}_updateStyle(t,a){if(t.cursor!==a.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==a.mapStyle){const{mapStyle:u=YM,styleDiffing:y=!0}=t,T={diff:y};return"localIdeographFontFamily"in t&&(T.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(WM(u),T),!0}return!1}_updateStyleComponents(t,a){const u=this._map;let y=!1;return u.isStyleLoaded()&&("light"in t&&u.setLight&&!eh(t.light,a.light)&&(y=!0,u.setLight(t.light)),"fog"in t&&u.setFog&&!eh(t.fog,a.fog)&&(y=!0,u.setFog(t.fog)),"terrain"in t&&u.setTerrain&&!eh(t.terrain,a.terrain)&&(!t.terrain||u.getSource(t.terrain.source))&&(y=!0,u.setTerrain(t.terrain))),y}_updateHandlers(t,a){const u=this._map;let y=!1;for(const T of c7){const C=t[T]??!0,s=a[T]??!0;eh(C,s)||(y=!0,C?u[T].enable(C):u[T].disable())}return y}_queryRenderedFeatures(t){const a=this._map,{interactiveLayerIds:u=[]}=this.props;try{return a.queryRenderedFeatures(t,{layers:u.filter(a.getLayer.bind(a))})}catch{return[]}}_updateHover(t){var y;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const T=t.type,C=((y=this._hoveredFeatures)==null?void 0:y.length)>0,s=this._queryRenderedFeatures(t.point),V=s.length>0;!V&&C&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=s,V&&!C&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=T}else this._hoveredFeatures=null}_fireEvent(t,a,u){const y=this._map,T=this._proxyTransform,C=T.$internalUpdate;try{T.$internalUpdate=!1,t.call(y,a,u)}finally{T.$internalUpdate=C}return y}_fireDefferedEvents(){const t=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&t.fire(a);this._internalUpdate=!1}}jy.savedMaps=[];function u7(){let o=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);o=t&&t[1]}try{o=o||XM.MapboxAccessToken}catch{}try{o=o||XM.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return o}const h7=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function d7(o){if(!o)return null;const t=o.map,a={getMap:()=>t,getCenter:()=>o.transform.center,getZoom:()=>o.transform.zoom,getBearing:()=>o.transform.bearing,getPitch:()=>o.transform.pitch,getPadding:()=>o.transform.padding,getBounds:()=>o.transform.getBounds(),project:u=>{const y=t.transform;t.transform=o.transform;const T=t.project(u);return t.transform=y,T},unproject:u=>{const y=t.transform;t.transform=o.transform;const T=t.unproject(u);return t.transform=y,T},queryTerrainElevation:(u,y)=>{const T=t.transform;t.transform=o.transform;const C=t.queryTerrainElevation(u,y);return t.transform=T,C},queryRenderedFeatures:(u,y)=>{const T=t.transform;t.transform=o.transform;const C=t.queryRenderedFeatures(u,y);return t.transform=T,C}};for(const u of f7(t))!(u in a)&&!h7.includes(u)&&(a[u]=t[u].bind(t));return a}function f7(o){const t=new Set;let a=o;for(;a;){for(const u of Object.getOwnPropertyNames(a))u[0]!=="_"&&typeof o[u]=="function"&&u!=="fire"&&u!=="setEventedParent"&&t.add(u);a=Object.getPrototypeOf(a)}return Array.from(t)}const p7=typeof document<"u"?Ue.useLayoutEffect:Ue.useEffect,m7=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function g7(o,t){for(const u of m7)u in t&&(o[u]=t[u]);const{RTLTextPlugin:a="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;a&&o.getRTLTextPluginStatus&&o.getRTLTextPluginStatus()==="unavailable"&&o.setRTLTextPlugin(a,u=>{u&&console.error(u)},!0)}const ex=Ue.createContext(null);function _7(o,t){const a=Ue.useContext(JH),[u,y]=Ue.useState(null),T=Ue.useRef(),{current:C}=Ue.useRef({mapLib:null,map:null});Ue.useEffect(()=>{const B=o.mapLib;let W=!0,Y;return Promise.resolve(B||QH(()=>Promise.resolve().then(()=>O7),[])).then(ae=>{if(!W)return;if(!ae)throw new Error("Invalid mapLib");const he="Map"in ae?ae:ae.default;if(!he.Map)throw new Error("Invalid mapLib");g7(he,o),o.reuseMaps&&(Y=jy.reuse(o,T.current)),Y||(Y=new jy(he.Map,o,T.current)),C.map=d7(Y),C.mapLib=he,y(Y),a==null||a.onMapMount(C.map,o.id)}).catch(ae=>{const{onError:he}=o;he?he({type:"error",target:null,error:ae}):console.error(ae)}),()=>{W=!1,Y&&(a==null||a.onMapUnmount(o.id),o.reuseMaps?Y.recycle():Y.destroy())}},[]),p7(()=>{u&&u.setProps(o)}),Ue.useImperativeHandle(t,()=>C.map,[u]);const s=Ue.useMemo(()=>({position:"relative",width:"100%",height:"100%",...o.style}),[o.style]),V={height:"100%"};return Ue.createElement("div",{id:o.id,ref:T,style:s},u&&Ue.createElement(ex.Provider,{value:C},Ue.createElement("div",{"mapboxgl-children":"",style:V},o.children)))}const y7=Ue.forwardRef(_7),x7=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function y_(o,t){if(!o||!t)return;const a=o.style;for(const u in t){const y=t[u];Number.isFinite(y)&&!x7.test(u)?a[u]=`${y}px`:a[u]=y}}function XL(o,t){if(o===t)return null;const a=eD(o),u=eD(t),y=[];for(const T of u)a.has(T)||y.push(T);for(const T of a)u.has(T)||y.push(T);return y.length===0?null:y}function eD(o){return new Set(o?o.trim().split(/\s+/):[])}const tD=Ue.memo(Ue.forwardRef((o,t)=>{const{map:a,mapLib:u}=Ue.useContext(ex),y=Ue.useRef({props:o}),T=Ue.useMemo(()=>{let at=!1;Ue.Children.forEach(o.children,Mt=>{Mt&&(at=!0)});const nt={...o,element:at?document.createElement("div"):null},Ge=new u.Marker(nt);return Ge.setLngLat([o.longitude,o.latitude]),Ge.getElement().addEventListener("click",Mt=>{var cn,St;(St=(cn=y.current.props).onClick)==null||St.call(cn,{type:"click",target:Ge,originalEvent:Mt})}),Ge.on("dragstart",Mt=>{var St,Oe;const cn=Mt;cn.lngLat=T.getLngLat(),(Oe=(St=y.current.props).onDragStart)==null||Oe.call(St,cn)}),Ge.on("drag",Mt=>{var St,Oe;const cn=Mt;cn.lngLat=T.getLngLat(),(Oe=(St=y.current.props).onDrag)==null||Oe.call(St,cn)}),Ge.on("dragend",Mt=>{var St,Oe;const cn=Mt;cn.lngLat=T.getLngLat(),(Oe=(St=y.current.props).onDragEnd)==null||Oe.call(St,cn)}),Ge},[]);Ue.useEffect(()=>(T.addTo(a.getMap()),()=>{T.remove()}),[]);const{longitude:C,latitude:s,offset:V,style:B,draggable:W=!1,popup:Y=null,rotation:ae=0,rotationAlignment:he="auto",pitchAlignment:Qe="auto"}=o;Ue.useEffect(()=>{y_(T.getElement(),B)},[B]),Ue.useImperativeHandle(t,()=>T,[]);const Ye=y.current.props;(T.getLngLat().lng!==C||T.getLngLat().lat!==s)&&T.setLngLat([C,s]),V&&!o7(T.getOffset(),V)&&T.setOffset(V),T.isDraggable()!==W&&T.setDraggable(W),T.getRotation()!==ae&&T.setRotation(ae),T.getRotationAlignment()!==he&&T.setRotationAlignment(he),T.getPitchAlignment()!==Qe&&T.setPitchAlignment(Qe),T.getPopup()!==Y&&T.setPopup(Y);const Ke=XL(Ye.className,o.className);if(Ke)for(const at of Ke)T.toggleClassName(at);return y.current.props=o,RD.createPortal(o.children,T.getElement())}));Ue.memo(Ue.forwardRef((o,t)=>{const{map:a,mapLib:u}=Ue.useContext(ex),y=Ue.useMemo(()=>document.createElement("div"),[]),T=Ue.useRef({props:o}),C=Ue.useMemo(()=>{const s={...o},V=new u.Popup(s);return V.setLngLat([o.longitude,o.latitude]),V.once("open",B=>{var W,Y;(Y=(W=T.current.props).onOpen)==null||Y.call(W,B)}),V},[]);if(Ue.useEffect(()=>{const s=V=>{var B,W;(W=(B=T.current.props).onClose)==null||W.call(B,V)};return C.on("close",s),C.setDOMContent(y).addTo(a.getMap()),()=>{C.off("close",s),C.isOpen()&&C.remove()}},[]),Ue.useEffect(()=>{y_(C.getElement(),o.style)},[o.style]),Ue.useImperativeHandle(t,()=>C,[]),C.isOpen()){const s=T.current.props;(C.getLngLat().lng!==o.longitude||C.getLngLat().lat!==o.latitude)&&C.setLngLat([o.longitude,o.latitude]),o.offset&&!eh(s.offset,o.offset)&&(C.options.anchor=o.anchor,C.setOffset(o.offset)),(s.anchor!==o.anchor||s.maxWidth!==o.maxWidth)&&C.setMaxWidth(o.maxWidth);const V=XL(s.className,o.className);if(V)for(const B of V)C.toggleClassName(B);T.current.props=o}return RD.createPortal(o.children,y)}));function r0(o,t,a,u){const y=Ue.useContext(ex),T=Ue.useMemo(()=>o(y),[]);return Ue.useEffect(()=>{const C=t,s=null,V=typeof t=="function"?t:null,{map:B}=y;return B.hasControl(T)||(B.addControl(T,C==null?void 0:C.position),s&&s(y)),()=>{V&&V(y),B.hasControl(T)&&B.removeControl(T)}},[]),T}function v7(o){const t=r0(({mapLib:a})=>new a.AttributionControl(o),{position:o.position});return Ue.useEffect(()=>{y_(t._container,o.style)},[o.style]),null}Ue.memo(v7);function b7(o){const t=r0(({mapLib:a})=>new a.FullscreenControl({container:o.containerId&&document.getElementById(o.containerId)}),{position:o.position});return Ue.useEffect(()=>{y_(t._controlContainer,o.style)},[o.style]),null}Ue.memo(b7);function w7(o,t){const a=Ue.useRef({props:o}),u=r0(({mapLib:y})=>{const T=new y.GeolocateControl(o),C=T._setupUI.bind(T);return T._setupUI=s=>{T._container.hasChildNodes()||C(s)},T.on("geolocate",s=>{var V,B;(B=(V=a.current.props).onGeolocate)==null||B.call(V,s)}),T.on("error",s=>{var V,B;(B=(V=a.current.props).onError)==null||B.call(V,s)}),T.on("outofmaxbounds",s=>{var V,B;(B=(V=a.current.props).onOutOfMaxBounds)==null||B.call(V,s)}),T.on("trackuserlocationstart",s=>{var V,B;(B=(V=a.current.props).onTrackUserLocationStart)==null||B.call(V,s)}),T.on("trackuserlocationend",s=>{var V,B;(B=(V=a.current.props).onTrackUserLocationEnd)==null||B.call(V,s)}),T},{position:o.position});return a.current.props=o,Ue.useImperativeHandle(t,()=>u,[]),Ue.useEffect(()=>{y_(u._container,o.style)},[o.style]),null}Ue.memo(Ue.forwardRef(w7));function T7(o){const t=r0(({mapLib:a})=>new a.NavigationControl(o),{position:o.position});return Ue.useEffect(()=>{y_(t._container,o.style)},[o.style]),null}const E7=Ue.memo(T7);function S7(o){const t=r0(({mapLib:T})=>new T.ScaleControl(o),{position:o.position}),a=Ue.useRef(o),u=a.current;a.current=o;const{style:y}=o;return o.maxWidth!==void 0&&o.maxWidth!==u.maxWidth&&(t.options.maxWidth=o.maxWidth),o.unit!==void 0&&o.unit!==u.unit&&t.setUnit(o.unit),Ue.useEffect(()=>{y_(t._container,y)},[y]),null}Ue.memo(S7);function y1(o,t){if(!o)throw new Error(t)}let A7=0;function I7(o,t,a){if(o.style&&o.style._loaded){const u={...a};return delete u.id,delete u.children,o.addSource(t,u),o.getSource(t)}return null}function C7(o,t,a){y1(t.id===a.id,"source id changed"),y1(t.type===a.type,"source type changed");let u="",y=0;for(const C in t)C!=="children"&&C!=="id"&&!eh(a[C],t[C])&&(u=C,y++);if(!y)return;const T=t.type;T==="geojson"?o.setData(t.data):T==="image"?o.updateImage({url:t.url,coordinates:t.coordinates}):"setCoordinates"in o&&y===1&&u==="coordinates"?o.setCoordinates(t.coordinates):"setUrl"in o&&u==="url"?o.setUrl(t.url):"setTiles"in o&&u==="tiles"?o.setTiles(t.tiles):console.warn(`Unable to update <Source> prop: ${u}`)}function R7(o){const t=Ue.useContext(ex).map.getMap(),a=Ue.useRef(o),[,u]=Ue.useState(0),y=Ue.useMemo(()=>o.id||`jsx-source-${A7++}`,[]);Ue.useEffect(()=>{if(t){const C=()=>setTimeout(()=>u(s=>s+1),0);return t.on("styledata",C),C(),()=>{var s;if(t.off("styledata",C),t.style&&t.style._loaded&&t.getSource(y)){const V=(s=t.getStyle())==null?void 0:s.layers;if(V)for(const B of V)B.source===y&&t.removeLayer(B.id);t.removeSource(y)}}}},[t]);let T=t&&t.style&&t.getSource(y);return T?C7(T,o,a.current):T=I7(t,y,o),a.current=o,T&&Ue.Children.map(o.children,C=>C&&Ue.cloneElement(C,{source:y}))||null}function M7(o,t,a,u){if(y1(a.id===u.id,"layer id changed"),y1(a.type===u.type,"layer type changed"),a.type==="custom"||u.type==="custom")return;const{layout:y={},paint:T={},filter:C,minzoom:s,maxzoom:V,beforeId:B}=a;if(B!==u.beforeId&&o.moveLayer(t,B),y!==u.layout){const W=u.layout||{};for(const Y in y)eh(y[Y],W[Y])||o.setLayoutProperty(t,Y,y[Y]);for(const Y in W)y.hasOwnProperty(Y)||o.setLayoutProperty(t,Y,void 0)}if(T!==u.paint){const W=u.paint||{};for(const Y in T)eh(T[Y],W[Y])||o.setPaintProperty(t,Y,T[Y]);for(const Y in W)T.hasOwnProperty(Y)||o.setPaintProperty(t,Y,void 0)}eh(C,u.filter)||o.setFilter(t,C),(s!==u.minzoom||V!==u.maxzoom)&&o.setLayerZoomRange(t,s,V)}function D7(o,t,a){if(o.style&&o.style._loaded&&(!("source"in a)||o.getSource(a.source))){const u={...a,id:t};delete u.beforeId,o.addLayer(u,a.beforeId)}}let P7=0;function nD(o){const t=Ue.useContext(ex).map.getMap(),a=Ue.useRef(o),[,u]=Ue.useState(0),y=Ue.useMemo(()=>o.id||`jsx-layer-${P7++}`,[]);if(Ue.useEffect(()=>{if(t){const C=()=>u(s=>s+1);return t.on("styledata",C),C(),()=>{t.off("styledata",C),t.style&&t.style._loaded&&t.getLayer(y)&&t.removeLayer(y)}}},[t]),t&&t.style&&t.getLayer(y))try{M7(t,y,o,a.current)}catch(C){console.warn(C)}else D7(t,y,o);return a.current=o,null}var qb={exports:{}},k7=qb.exports,iD;function L7(){return iD||(iD=1,(function(o,t){(function(a,u){o.exports=u()})(k7,(function(){var a,u,y;function T(s,V){if(!a)a=V;else if(!u)u=V;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",W={};a(W),y=V(W),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}T(["exports"],function(s){var V=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;function W(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i*m-d*l;return _?(r[0]=m*(_=1/_),r[1]=-l*_,r[2]=-d*_,r[3]=i*_,r):null}function Y(){var r=new B(9);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ae(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8];return r[0]=_*D-v*A,r[1]=d*A-l*D,r[2]=l*v-d*_,r[3]=v*S-m*D,r[4]=i*D-d*S,r[5]=d*m-i*v,r[6]=m*A-_*S,r[7]=l*S-i*A,r[8]=i*_-l*m,r}function he(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=i[0],F=i[1],U=i[2],Z=i[3],Q=i[4],X=i[5],te=i[6],se=i[7],le=i[8];return r[0]=k*l+F*_+U*A,r[1]=k*d+F*v+U*D,r[2]=k*m+F*S+U*P,r[3]=Z*l+Q*_+X*A,r[4]=Z*d+Q*v+X*D,r[5]=Z*m+Q*S+X*P,r[6]=te*l+se*_+le*A,r[7]=te*d+se*v+le*D,r[8]=te*m+se*S+le*P,r}function Qe(){var r=new B(16);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ye(r){var e=new B(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Ke(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function at(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8],P=e[9],k=e[10],F=e[11],U=e[12],Z=e[13],Q=e[14],X=e[15],te=i*v-l*_,se=i*S-d*_,le=i*A-m*_,_e=l*S-d*v,me=l*A-m*v,Ee=d*A-m*S,Se=D*Z-P*U,we=D*Q-k*U,De=D*X-F*U,Ne=P*Q-k*Z,pt=P*X-F*Z,ct=k*X-F*Q,dt=te*ct-se*pt+le*Ne+_e*De-me*we+Ee*Se;return dt?(r[0]=(v*ct-S*pt+A*Ne)*(dt=1/dt),r[1]=(d*pt-l*ct-m*Ne)*dt,r[2]=(Z*Ee-Q*me+X*_e)*dt,r[3]=(k*me-P*Ee-F*_e)*dt,r[4]=(S*De-_*ct-A*we)*dt,r[5]=(i*ct-d*De+m*we)*dt,r[6]=(Q*le-U*Ee-X*se)*dt,r[7]=(D*Ee-k*le+F*se)*dt,r[8]=(_*pt-v*De+A*Se)*dt,r[9]=(l*De-i*pt-m*Se)*dt,r[10]=(U*me-Z*le+X*te)*dt,r[11]=(P*le-D*me-F*te)*dt,r[12]=(v*we-_*Ne-S*Se)*dt,r[13]=(i*Ne-l*we+d*Se)*dt,r[14]=(Z*se-U*_e-Q*te)*dt,r[15]=(D*_e-P*se+k*te)*dt,r):null}function nt(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=e[9],F=e[10],U=e[11],Z=e[12],Q=e[13],X=e[14],te=e[15],se=i[0],le=i[1],_e=i[2],me=i[3];return r[0]=se*l+le*v+_e*P+me*Z,r[1]=se*d+le*S+_e*k+me*Q,r[2]=se*m+le*A+_e*F+me*X,r[3]=se*_+le*D+_e*U+me*te,r[4]=(se=i[4])*l+(le=i[5])*v+(_e=i[6])*P+(me=i[7])*Z,r[5]=se*d+le*S+_e*k+me*Q,r[6]=se*m+le*A+_e*F+me*X,r[7]=se*_+le*D+_e*U+me*te,r[8]=(se=i[8])*l+(le=i[9])*v+(_e=i[10])*P+(me=i[11])*Z,r[9]=se*d+le*S+_e*k+me*Q,r[10]=se*m+le*A+_e*F+me*X,r[11]=se*_+le*D+_e*U+me*te,r[12]=(se=i[12])*l+(le=i[13])*v+(_e=i[14])*P+(me=i[15])*Z,r[13]=se*d+le*S+_e*k+me*Q,r[14]=se*m+le*A+_e*F+me*X,r[15]=se*_+le*D+_e*U+me*te,r}function Ge(r,e,i){var l,d,m,_,v,S,A,D,P,k,F,U,Z=i[0],Q=i[1],X=i[2];return e===r?(r[12]=e[0]*Z+e[4]*Q+e[8]*X+e[12],r[13]=e[1]*Z+e[5]*Q+e[9]*X+e[13],r[14]=e[2]*Z+e[6]*Q+e[10]*X+e[14],r[15]=e[3]*Z+e[7]*Q+e[11]*X+e[15]):(d=e[1],m=e[2],_=e[3],v=e[4],S=e[5],A=e[6],D=e[7],P=e[8],k=e[9],F=e[10],U=e[11],r[0]=l=e[0],r[1]=d,r[2]=m,r[3]=_,r[4]=v,r[5]=S,r[6]=A,r[7]=D,r[8]=P,r[9]=k,r[10]=F,r[11]=U,r[12]=l*Z+v*Q+P*X+e[12],r[13]=d*Z+S*Q+k*X+e[13],r[14]=m*Z+A*Q+F*X+e[14],r[15]=_*Z+D*Q+U*X+e[15]),r}function Mt(r,e,i){var l=i[0],d=i[1],m=i[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function cn(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[4],_=e[5],v=e[6],S=e[7],A=e[8],D=e[9],P=e[10],k=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*d+A*l,r[5]=_*d+D*l,r[6]=v*d+P*l,r[7]=S*d+k*l,r[8]=A*d-m*l,r[9]=D*d-_*l,r[10]=P*d-v*l,r[11]=k*d-S*l,r}function St(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[0],_=e[1],v=e[2],S=e[3],A=e[8],D=e[9],P=e[10],k=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d-A*l,r[1]=_*d-D*l,r[2]=v*d-P*l,r[3]=S*d-k*l,r[8]=m*l+A*d,r[9]=_*l+D*d,r[10]=v*l+P*d,r[11]=S*l+k*d,r}function Oe(r,e,i){var l=Math.sin(i),d=Math.cos(i),m=e[0],_=e[1],v=e[2],S=e[3],A=e[4],D=e[5],P=e[6],k=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d+A*l,r[1]=_*d+D*l,r[2]=v*d+P*l,r[3]=S*d+k*l,r[4]=A*d-m*l,r[5]=D*d-_*l,r[6]=P*d-v*l,r[7]=k*d-S*l,r}function Re(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ve(r,e,i){var l,d,m,_=i[0],v=i[1],S=i[2],A=Math.sqrt(_*_+v*v+S*S);return A<V?null:(_*=A=1/A,v*=A,S*=A,l=Math.sin(e),d=Math.cos(e),r[0]=_*_*(m=1-d)+d,r[1]=v*_*m+S*l,r[2]=S*_*m-v*l,r[3]=0,r[4]=_*v*m-S*l,r[5]=v*v*m+d,r[6]=S*v*m+_*l,r[7]=0,r[8]=_*S*m+v*l,r[9]=v*S*m-_*l,r[10]=S*S*m+d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Je(r,e){var i=e[0],l=e[1],d=e[2],m=e[4],_=e[5],v=e[6],S=e[8],A=e[9],D=e[10];return r[0]=Math.sqrt(i*i+l*l+d*d),r[1]=Math.sqrt(m*m+_*_+v*v),r[2]=Math.sqrt(S*S+A*A+D*D),r}function He(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i+i,v=l+l,S=d+d,A=i*_,D=l*_,P=l*v,k=d*_,F=d*v,U=d*S,Z=m*_,Q=m*v,X=m*S;return r[0]=1-P-U,r[1]=D+X,r[2]=k-Q,r[3]=0,r[4]=D-X,r[5]=1-A-U,r[6]=F+Z,r[7]=0,r[8]=k+Q,r[9]=F-Z,r[10]=1-A-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var tt=nt;function ve(){var r=new B(3);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ht(r){var e=new B(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function dn(r){var e=r[0],i=r[1],l=r[2];return Math.sqrt(e*e+i*i+l*l)}function wt(r,e,i){var l=new B(3);return l[0]=r,l[1]=e,l[2]=i,l}function Kt(r,e,i,l){return r[0]=e,r[1]=i,r[2]=l,r}function wn(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Kn(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function it(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function ft(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function Qt(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Be(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function En(r,e,i,l){return r[0]=e[0]+i[0]*l,r[1]=e[1]+i[1]*l,r[2]=e[2]+i[2]*l,r}function Qn(r,e){var i=e[0]-r[0],l=e[1]-r[1],d=e[2]-r[2];return Math.sqrt(i*i+l*l+d*d)}function $n(r,e){var i=e[0]-r[0],l=e[1]-r[1],d=e[2]-r[2];return i*i+l*l+d*d}function ki(r){var e=r[0],i=r[1],l=r[2];return e*e+i*i+l*l}function er(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function qn(r,e){var i=e[0],l=e[1],d=e[2],m=i*i+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r}function Ni(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Vr(r,e,i){var l=e[0],d=e[1],m=e[2],_=i[0],v=i[1],S=i[2];return r[0]=d*S-m*v,r[1]=m*_-l*S,r[2]=l*v-d*_,r}function Fa(r,e,i,l){var d=e[0],m=e[1],_=e[2];return r[0]=d+l*(i[0]-d),r[1]=m+l*(i[1]-m),r[2]=_+l*(i[2]-_),r}function Cn(r,e,i){var l=e[0],d=e[1],m=e[2],_=i[3]*l+i[7]*d+i[11]*m+i[15];return r[0]=(i[0]*l+i[4]*d+i[8]*m+i[12])/(_=_||1),r[1]=(i[1]*l+i[5]*d+i[9]*m+i[13])/_,r[2]=(i[2]*l+i[6]*d+i[10]*m+i[14])/_,r}function vi(r,e,i){var l=e[0],d=e[1],m=e[2];return r[0]=l*i[0]+d*i[3]+m*i[6],r[1]=l*i[1]+d*i[4]+m*i[7],r[2]=l*i[2]+d*i[5]+m*i[8],r}function _r(r,e,i){var l=i[0],d=i[1],m=i[2],_=i[3],v=e[0],S=e[1],A=e[2],D=d*A-m*S,P=m*v-l*A,k=l*S-d*v;return r[0]=v+_*(D+=D)+d*(k+=k)-m*(P+=P),r[1]=S+_*P+m*D-l*k,r[2]=A+_*k+l*P-d*D,r}function Hi(r){return r[0]=0,r[1]=0,r[2]=0,r}function Wr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var tr=Kn,yr=it,Xr=dn;function to(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Rl(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function rc(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=i*i+l*l+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=l*_,r[2]=d*_,r[3]=m*_,r}function jr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function bs(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3];return r[0]=i[0]*l+i[4]*d+i[8]*m+i[12]*_,r[1]=i[1]*l+i[5]*d+i[9]*m+i[13]*_,r[2]=i[2]*l+i[6]*d+i[10]*m+i[14]*_,r[3]=i[3]*l+i[7]*d+i[11]*m+i[15]*_,r}function en(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Tn(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function si(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+_*v,r[1]=d*S+m*v,r[2]=m*S-d*v,r[3]=_*S-l*v,r}function Li(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S-m*v,r[1]=d*S+_*v,r[2]=m*S+l*v,r[3]=_*S-d*v,r}ve(),to();var Ii,Fs,_s,ms=rc,Pr=(Ii=ve(),Fs=wt(1,0,0),_s=wt(0,1,0),function(r,e,i){var l=Ni(e,i);return l<-.999999?(Vr(Ii,Fs,e),Xr(Ii)<1e-6&&Vr(Ii,_s,e),qn(Ii,Ii),(function(d,m,_){_*=.5;var v=Math.sin(_);d[0]=v*m[0],d[1]=v*m[1],d[2]=v*m[2],d[3]=Math.cos(_)})(r,Ii,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Vr(Ii,e,i),r[0]=Ii[0],r[1]=Ii[1],r[2]=Ii[2],r[3]=1+l,ms(r,r))});function mr(){var r=new B(2);return B!=Float32Array&&(r[0]=0,r[1]=0),r}function Fi(r,e){var i=new B(2);return i[0]=r,i[1]=e,i}function ia(r,e,i){return r[0]=e,r[1]=i,r}function ws(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function cl(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function Ia(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function bo(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function gs(r,e){var i=e[0],l=e[1],d=i*i+l*l;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r}function Vi(r,e){return r[0]*e[0]+r[1]*e[1]}en(),en(),Y();var Kr,wo,_u=cl;function Va(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}mr();var ul=(function(){if(wo)return Kr;function r(e,i,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=l,this.p2y=d}return wo=1,Kr=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<i)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=m/_}var v=0,S=1;for(l=e,d=0;d<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<i));d++)e>m?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Kr})(),hl=Va(ul);function Dt(r,e){this.x=r,this.y=e}function no(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!no(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!no(r[i],e[i]))return!1;return!0}return r===e}Dt.prototype={clone(){return new Dt(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround(r,e){const i=Math.cos(r),l=Math.sin(r),d=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Dt},Dt.convert=function(r){if(r instanceof Dt)return r;if(Array.isArray(r))return new Dt(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Dt(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const th=Math.PI/180,Lc=180/Math.PI;function oi(r){return r*th}function qe(r){return r*Lc}const ne=[[0,0],[1,0],[1,1],[0,1]];function oe(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function ye(r,e,i,l){const d=new hl(r,e,i,l);return function(m){return d.solve(m)}}const Pe=ye(.25,.1,.25,1);function xe(r,e,i){return Math.min(i,Math.max(e,r))}function Fe(r,e,i){return(i=xe((i-r)/(e-r),0,1))*i*(3-2*i)}function st(r,e,i){const l=i-e,d=((r-e)%l+l)%l+e;return d===e?i:d}function $e(r,e,i){if(!r.length)return i(null,[]);let l=r.length;const d=new Array(r.length);let m=null;r.forEach((_,v)=>{e(_,(S,A)=>{S&&(m=S),d[v]=A,--l===0&&i(m,d)})})}let lt=1;function Pt(){return lt++}function It(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function tn(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function yn(r,e,i){const l={};for(const d in r)l[d]=e.call(this,r[d],d,r);return l}function bn(r,e,i){const l={};for(const d in r)e.call(this,r[d],d,r)&&(l[d]=r[d]);return l}function Ln(r){return Array.isArray(r)?r.map(Ln):typeof r=="object"&&r?yn(r,Ln):r}function Vn(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const vn={};function kn(r){vn[r]||(typeof console<"u"&&console.warn(r),vn[r]=!0)}function $i(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function xr(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}function nr([r,e,i]){const l=oi(e+90),d=oi(i);return{x:r*Math.cos(l)*Math.sin(d),y:r*Math.sin(l)*Math.sin(d),z:r*Math.cos(d),azimuthal:e,polar:i}}function vr(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function ir(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,d,m)=>{const _=d||m;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ui=null;function cr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Oi(r,e,i,l){for(;e<i;){const d=e+i>>1;r[d]<l?e=d+1:i=d}return e}function gi(r,e,i,l){for(;e<i;){const d=e+i>>1;r[d]<=l?e=d+1:i=d}return e}function Ti(r){return r>0?1/(1.001-r):1+r}function ur(r){return r>0?1-1/(1.001-r):-r}function es(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const ts={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ts.API_URL)return null;try{const r=new URL(ts.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function hr(r){return ts.API_URL_REGEX.test(r)}function Ts(r){return ts.API_SPRITE_REGEX.test(r)}let Es,pa,ys,ra,sa,$o;function To(){return Es==null&&(Es=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Es}const ja={now:()=>ra!==void 0?ra:performance.now(),setNow(r){ra=r},restoreNow(){ra=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:l}=r;sa||(sa=document.createElement("canvas"));const d=sa.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(i>sa.width||l>sa.height)&&(sa.width=i,sa.height=l),d.clearRect(-e,-e,i+2*e,l+2*e),d.drawImage(r,0,0,i,l),d.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:r=>(pa||(pa=document.createElement("a")),pa.href=r,pa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ys==null&&(ys=window.matchMedia("(prefers-reduced-motion: reduce)")),ys.matches)},hasCanvasFingerprintNoise(){if($o!==void 0)return $o;if(!To())return $o=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let d=0;d<r.width;++d)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(d,0,1,1);const l=e.getImageData(0,0,r.width,r.height);i=0;for(let d=0;d<l.data.length;++d)if(d%4!=3&&i++!==l.data[d])return $o=!0,!0;return $o=!1,!1}};function dl(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(r.slice(i));for(const d in e)l.set(d,e[d]);return`${r.slice(0,i)}?${l.toString()}`}function ma(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const l=new URLSearchParams,d=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const v=d.get(_);v&&l.set(_,v)}const m=l.toString();return`${r.slice(0,i)}${m.length>0?`?${m}`:""}`}const pf="mapbox-tiles";let nd=500,nh=50;const yu=["language","worldview","jobid"];let Ss,Xs;function Eo(){try{return caches}catch{}}function As(){const r=Eo();r&&Ss==null&&(Ss=r.open(pf))}let So=1/0;const Ca={supported:!1,testSupport:function(r){!Ao&&Ua&&(Oc?fl(r):Zo=r)}};let Zo,Ua,Ao=!1,Oc=!1;const zc=typeof self<"u"?self:{};function fl(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ua),r.isContextLost())return;Ca.supported=!0}catch{}r.deleteTexture(e),Ao=!0}zc.document&&(Ua=zc.document.createElement("img"),Ua.onload=function(){Zo&&fl(Zo),Zo=null,Oc=!0},Ua.onerror=function(){Ao=!0,Zo=null},Ua.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const hs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(hs);class Ml extends Error{constructor(e,i,l){i===401&&hr(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Er=vr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ga=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Er())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,d){const m=new AbortController,_=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Er(),referrerPolicy:l.referrerPolicy,signal:m.signal});let v=!1,S=!1;const A=(D=_.url).indexOf("sku=")>0&&hr(D);var D;l.type==="json"&&_.headers.set("Accept","application/json");const P=(F,U,Z)=>{if(S)return;if(F&&F.message!=="SecurityError"&&kn(F.toString()),U&&Z)return k(U);const Q=Date.now();fetch(_).then(X=>{if(X.ok){const te=A?X.clone():null;return k(X,te,Q)}return d(new Ml(X.statusText,X.status,l.url))}).catch(X=>{X.name!=="AbortError"&&d(new Error(`${X.message} ${l.url}`))})},k=(F,U,Z)=>{(l.type==="arrayBuffer"?F.arrayBuffer():l.type==="json"?F.json():F.text()).then(Q=>{S||(U&&Z&&(function(X,te,se){if(As(),Ss==null)return;const le=ir(te.headers.get("Cache-Control")||"");if(le["no-store"])return;const _e={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((Se,we)=>_e.headers.set(we,Se)),le["max-age"]&&_e.headers.set("Expires",new Date(se+1e3*le["max-age"]).toUTCString());const me=_e.headers.get("Expires");if(!me||new Date(me).getTime()-se<42e4)return;let Ee=ma(X.url,{persistentParams:yu});if(te.status===206){const Se=X.headers.get("Range");if(!Se)return;_e.status=200,Ee=dl(Ee,{range:Se})}(function(Se,we){if(Xs===void 0)try{new Response(new ReadableStream),Xs=!0}catch{Xs=!1}Xs?we(Se.body):Se.blob().then(we).catch(De=>kn(De.message))})(te,Se=>{const we=new Response((De=te.status)!==200&&De!==404&&[101,103,204,205,304].includes(De)?null:Se,_e);var De;As(),Ss!=null&&Ss.then(Ne=>Ne.put(Ee,we)).catch(Ne=>kn(Ne.message))})})(_,U,Z),v=!0,d(null,Q,F.headers))}).catch(Q=>{S||d(new Error(Q.message))})};return A?(function(F,U){if(As(),Ss==null)return U(null);Ss.then(Z=>{let Q=ma(F.url,{persistentParams:yu});const X=F.headers.get("Range");X&&(Q=dl(Q,{range:X})),Z.match(Q).then(te=>{const se=(function(le){if(!le)return!1;const _e=new Date(le.headers.get("Expires")||0),me=ir(le.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!me["no-cache"]})(te);Z.delete(Q).catch(U),se&&Z.put(Q,te.clone()).catch(U),U(null,te,se)}).catch(U)}).catch(U)})(_,P):P(null,null),{cancel:()=>{S=!0,v||m.abort()}}})(r,e);if(vr(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(l,d){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(l.type==="json")try{_=JSON.parse(m.response)}catch(S){return d(S)}const v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const A=S.split(": "),D=A.shift(),P=A.join(": ");v.append(D,P)}),d(null,_,v)}else d(new Ml(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}})(r,e)},Nc=function(r,e){return ga(Object.assign(r,{type:"arrayBuffer"}),e)};function ih(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const rh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hi,Io;hi=[],Io=0;const Co=function(r,e){if(Ca.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Io>=ts.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return hi.push(m),m}Io++;let i=!1;const l=()=>{if(!i)for(i=!0,Io--;hi.length&&Io<ts.MAX_PARALLEL_IMAGE_REQUESTS;){const m=hi.shift(),{requestParameters:_,callback:v,cancelled:S}=m;S||(m.cancel=Co(_,v).cancel)}},d=Nc(r,(m,_,v)=>{l(),m?e(m):_&&(self.createImageBitmap?(function(S,A){const D=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(D).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(_,(S,A)=>e(S,A,v)):(function(S,A){const D=new Image;D.onload=()=>{A(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=rh})},D.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(S)],{type:"image/png"});D.src=S.byteLength?URL.createObjectURL(P):rh})(_,(S,A)=>e(S,A,v)))});return{cancel:()=>{d.cancel(),l()}}};var _a,sc,Ro,io={exports:{}},Bc={exports:{}},Dl={exports:{}},id=(function(){if(Ro)return io.exports;Ro=1;var r=(_a||(_a=1,Bc.exports=function(i,l){var d,m,_,v,S,A,D,P;for(m=i.length-(d=3&i.length),_=l,S=3432918353,A=461845907,P=0;P<m;)D=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,_=27492+(65535&(v=5*(65535&(_=(_^=D=(65535&(D=(D=(65535&D)*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((v>>>16)+58964&65535)<<16);switch(D=0,d){case 3:D^=(255&i.charCodeAt(P+2))<<16;case 2:D^=(255&i.charCodeAt(P+1))<<8;case 1:_^=D=(65535&(D=(D=(65535&(D^=255&i.charCodeAt(P)))*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Bc.exports),e=(sc||(sc=1,Dl.exports=function(i,l){for(var d,m=i.length,_=l^m,v=0;m>=4;)d=1540483477*(65535&(d=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:_^=(255&i.charCodeAt(v+2))<<16;case 2:_^=(255&i.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Dl.exports);return io.exports=r,io.exports.murmur3=r,io.exports.murmur2=e,io.exports})(),ro=Va(id);class Mo{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Fc extends Mo{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function xu(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function ac(r,e,i){if(i&&i[r]){const l=i[r].indexOf(e);l!==-1&&i[r].splice(l,1)}}class pl{on(e,i){return this._listeners=this._listeners||{},xu(e,i,this._listeners),this}off(e,i){return ac(e,i,this._listeners),ac(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},xu(e,i,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,i){const l=typeof e=="string"?new Mo(e,i):e,d=l.type;if(this.listens(d)){l.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const S of m)S.call(this,l);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const S of _)ac(d,S,this._oneTimeListeners),S.call(this,l);const v=this._eventedParent;if(v){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,S),v.fire(l)}}else l instanceof Fc&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Vs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Vs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,l]=e.split("");return new Vs({name:i,iconsetId:l})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Vs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ga,sh={},ah=(function(){if(Ga)return sh;Ga=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function i(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function l(m){return(_=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:_>1?1:_;var _}function d(m,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(_-m)*v*6:2*v<1?_:3*v<2?m+(_-m)*(2/3-v)*6:m}try{sh.parseCSSColor=function(m){var _,v=m.replace(/ /g,"").toLowerCase();if(v in r)return r[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var S=v.indexOf("("),A=v.indexOf(")");if(S!==-1&&A+1===v.length){var D=v.substr(0,S),P=v.substr(S+1,A-(S+1)).split(","),k=1;switch(D){case"rgba":if(P.length!==4)return null;k=l(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),k];case"hsla":if(P.length!==4)return null;k=l(P.pop());case"hsl":if(P.length!==3)return null;var F=(parseFloat(P[0])%360+360)%360/360,U=l(P[1]),Z=l(P[2]),Q=Z<=.5?Z*(U+1):Z+U-Z*U,X=2*Z-Q;return[e(255*d(X,Q,F+1/3)),e(255*d(X,Q,F)),e(255*d(X,Q,F-1/3)),k];default:return null}}return null}}catch{}return sh})();class Ei{constructor(e,i,l,d=1){this.r=e,this.g=i,this.b=l,this.a=d}static parse(e){if(!e)return;if(e instanceof Ei)return e;if(typeof e!="string")return;const i=ah.parseCSSColor(e);return i?new Ei(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,l,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*l)},${d})`}toNonPremultipliedRenderColor(e){const{r:i,g:l,b:d,a:m}=this;return new Pl(e,i,l,d,m)}toPremultipliedRenderColor(e){const{r:i,g:l,b:d,a:m}=this;return new mf(e,i*m,l*m,d*m,m)}clone(){return new Ei(this.r,this.g,this.b,this.a)}}class rd{constructor(e,i,l,d,m,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const v=e.image.height,S=v*v;this.premultiplied?(i=m===0?0:i/m*(v-1),l=m===0?0:l/m*(v-1),d=m===0?0:d/m*(v-1)):(i*=v-1,l*=v-1,d*=v-1),i=Math.max(0,Math.min(v-1,i)),l=Math.max(0,Math.min(v-1,l)),d=Math.max(0,Math.min(v-1,d));const A=Math.floor(i),D=Math.floor(l),P=Math.floor(d),k=Math.ceil(i),F=Math.ceil(l),U=Math.ceil(d),Z=i-A,Q=l-D,X=d-P,te=e.image.data,se=4*(A+D*S+P*v),le=4*(A+D*S+U*v),_e=4*(A+F*S+P*v),me=4*(A+F*S+U*v),Ee=4*(k+D*S+P*v),Se=4*(k+D*S+U*v),we=4*(k+F*S+P*v),De=4*(k+F*S+U*v);this.r=Rn(Rn(Rn(te[se],te[le],X),Rn(te[_e],te[me],X),Q),Rn(Rn(te[Ee],te[Se],X),Rn(te[we],te[De],X),Q),Z)/255*(this.premultiplied?m:1),this.g=Rn(Rn(Rn(te[se+1],te[le+1],X),Rn(te[_e+1],te[me+1],X),Q),Rn(Rn(te[Ee+1],te[Se+1],X),Rn(te[we+1],te[De+1],X),Q),Z)/255*(this.premultiplied?m:1),this.b=Rn(Rn(Rn(te[se+2],te[le+2],X),Rn(te[_e+2],te[me+2],X),Q),Rn(Rn(te[Ee+2],te[Se+2],X),Rn(te[we+2],te[De+2],X),Q),Z)/255*(this.premultiplied?m:1),this.a=m}else this.r=i,this.g=l,this.b=d,this.a=m}toArray(){const{r:e,g:i,b:l,a:d}=this;return[255*e,255*i,255*l,d]}toHslaArray(){let{r:e,g:i,b:l,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const U=1/d;e*=U,i*=U,l*=U}const m=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),v=Math.min(Math.max(l,0),1),S=Math.min(m,_,v),A=Math.max(m,_,v),D=A-S,P=.5*(S+A);if(D===0)return[0,0,100*P,d];const k=P>.5?D/(2-A-S):D/(A+S);let F;switch(A){case m:F=60*((_-v)/D+(_<v?6:0));break;case _:F=60*((v-m)/D+2);break;default:F=60*((m-_)/D+4)}return[F,100*k,100*P,d]}toArray01(){const{r:e,g:i,b:l,a:d}=this;return[e,i,l,d]}toArray01Scaled(e){const{r:i,g:l,b:d}=this;return[i*e,l*e,d*e]}toArray01Linear(){const{r:e,g:i,b:l,a:d}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(l,2.2),d]}}class Pl extends rd{constructor(e,i,l,d,m){super(e,i,l,d,m,!1)}}class mf extends rd{constructor(e,i,l,d,m){super(e,i,l,d,m,!0)}}function Rn(r,e,i){return r*(1-i)+e*i}function sd(r,e,i){return r.map((l,d)=>Rn(l,e[d],i))}Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1),Ei.blue=new Ei(0,0,1,1);var oc=Object.freeze({__proto__:null,array:sd,color:function(r,e,i){return new Ei(Rn(r.r,e.r,i),Rn(r.g,e.g,i),Rn(r.b,e.b,i),Rn(r.a,e.a,i))},number:Rn});class Is extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ya{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,d]of i)this.bindings[l]=d}concat(e){return new ya(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xa={kind:"null"},gn={kind:"number"},fi={kind:"string"},L={kind:"boolean"},ie={kind:"color"},de={kind:"object"},Ce={kind:"value"},Ot={kind:"collator"},Gt={kind:"formatted"},Sn={kind:"resolvedImage"};function li(r,e){return{kind:"array",itemType:r,N:e}}function Ci(r){if(r.kind==="array"){const e=Ci(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const kr=[xa,gn,fi,L,ie,Gt,de,li(Ce),Sn];function Qr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of kr)if(!Qr(i,e))return null}}return`Expected ${Ci(r)} but found ${Ci(e)} instead.`}function Do(r,e){return e.some(i=>i.kind===r.kind)}function Po(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function ko(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&ko(r.itemType,e.itemType):r.kind===e.kind}class Wo{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class lc{constructor(e,i,l,d,m){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=d,this.textColor=m}}class Ms{constructor(e){this.sections=e}static fromString(e){return new Ms([new lc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ms?e:Ms.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const d=i.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Ys{constructor(e,i={}){this.id=Vs.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,l,d,m;try{({id:i,params:l,sx:d,sy:m}=JSON.parse(e)||{})}catch{return null}return i?new Ys(i,{params:l,sx:d,sy:m}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class so{constructor(e,i,l,d,m=!1){this.primaryId=Vs.from(e),this.primaryOptions=i,l&&(this.secondaryId=Vs.from(l)),this.secondaryOptions=d,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ys(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ys(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?so.build({name:e}):e}static build(e,i,l,d){return!e||typeof e=="object"&&!("name"in e)?null:new so(e,l,i,d)}}function Wm(r,e,i,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,i,l]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vu(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ei||r instanceof Wo||r instanceof Ms||r instanceof so)return!0;if(Array.isArray(r)){for(const e of r)if(!vu(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!vu(r[e]))return!1;return!0}return!1}function Cs(r){if(r===null)return xa;if(typeof r=="string")return fi;if(typeof r=="boolean")return L;if(typeof r=="number")return gn;if(r instanceof Ei)return ie;if(r instanceof Wo)return Ot;if(r instanceof Ms)return Gt;if(r instanceof so)return Sn;if(Array.isArray(r)){const e=r.length;let i;for(const l of r){const d=Cs(l);if(i){if(i===d)continue;i=Ce;break}i=d}return li(i||Ce,e)}return de}function kl(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Ms||r instanceof so||r instanceof Ei?r.toString():JSON.stringify(r)}class Xo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!vu(e[1]))return i.error("invalid value");const l=e[1];let d=Cs(l);const m=i.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Xo(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ms?this.value.serialize():this.value}}class ns{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bu={string:fi,number:gn,boolean:L,object:de};class zn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,d=1;const m=e[0];if(m==="array"){let v,S;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in bu)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=bu[A],d++}else v=Ce;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}l=li(v,S)}else l=bu[m];const _=[];for(;d<e.length;d++){const v=i.parse(e[d],d,Ce);if(!v)return null;_.push(v)}return new zn(l,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Qr(this.type,Cs(l)))return l;if(i===this.args.length-1)throw new ns(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Ci(Cs(l))} but was expected to be of type ${Ci(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&i.push(d)}}return i.concat(this.args.map(l=>l.serialize()))}}class mn{constructor(e){this.type=Gt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let S=null;if(v["font-scale"]&&(S=i.parseObjectValue(v["font-scale"],_,"font-scale",gn),!S))return null;let A=null;if(v["text-font"]&&(A=i.parseObjectValue(v["text-font"],_,"text-font",li(fi)),!A))return null;let D=null;if(v["text-color"]&&(D=i.parseObjectValue(v["text-color"],_,"text-color",ie),!D))return null;const P=d[d.length-1];P.scale=S,P.font=A,P.textColor=D}else{const S=i.parse(e[_],_,Ce);if(!S)return null;const A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new mn(d)}evaluate(e){return new Ms(this.sections.map(i=>{const l=i.content.evaluate(e);return ko(Cs(l),Sn)?new lc("",l,null,null,null):new lc(kl(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class oh{constructor(e,i,l,d){this._imageWarnHistory={},this.type=Sn,this.namePrimary=e,this.nameSecondary=i,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let l=1;const d=[];function m(){if(l<e.length){const v=i.parse(e[l],l++,fi);return v?(d.push({image:v,options:{}}),!0):(i.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(l<e.length){const S=e[l];if((v=S)===null||typeof v!="object"||Array.isArray(v))return!0;const A=S.params,D=S.iconset,P=i.concat(l);if(!A&&!D)return l++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const k={},F=P.concat(void 0,"params");for(const U in A){if(!U)return F.error("Image parameter name should be non-empty"),!1;const Z=F.concat(void 0,U).parse(A[U],void 0,ie,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;k[U]=Z}d[d.length-1].options.params=k}if(D){if(typeof D!="object"||D.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!D.id)return P.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=D}return l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!_())return;return new oh(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,i){const l={};if(i){for(const d in i)if(i[d])try{l[d]=i[d].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=so.build(i,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){const m=d.getPrimary().id;if(d.available=e.availableImages.some(_=>Vs.isEqual(_,m)),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=e.availableImages.some(v=>Vs.isEqual(v,_)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const l={};if(i&&(l.iconset={id:i}),e){l.params={};for(const d in e)e[d]&&(l.params[d]=e[d].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function On(r){return od(r)?"string":Mn(r)?"number":Sp(r)?"boolean":Array.isArray(r)?"array":r===null?"null":ad(r)?"object":typeof r}function ad(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function od(r){return typeof r=="string"||r instanceof String}function Mn(r){return typeof r=="number"||r instanceof Number}function Sp(r){return typeof r=="boolean"||r instanceof Boolean}const Xm={"to-boolean":L,"to-color":ie,"to-number":gn,"to-string":fi};class cc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0],d=[];let m=xa;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);m=li(i.expectedType.itemType,_)}else{if(!(_>0&&vu(e[1][0])))return null;m=li(Cs(e[1][0]),_)}for(let v=0;v<_;v++){const S=e[1][v];let A;if(Array.isArray(S))A=i.parse(S,void 0,m.itemType);else{const D=On(S);if(D!==m.itemType.kind)return i.error(`Expected ${m.itemType.kind} but found ${D}.`);A=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!A)return null;d.push(A)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");m=Xm[l];for(let _=1;_<e.length;_++){const v=i.parse(e[_],_,Ce);if(!v)return null;d.push(v)}}return new cc(m,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const d of this.args){if(i=d.evaluate(e),l=null,i instanceof Ei)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Wm(i[0],i[1],i[2],i[3]),!l))return new Ei(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ns(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const d=Number(i);if(!isNaN(d))return d}throw new ns(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ms.fromString(kl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?so.build(kl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):kl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new mn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new oh(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const x_=["Unknown","Point","LineString","Polygon"];class ld{constructor(e,i,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?x_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-e[0])+this.featureDistanceData.bearing[1]*(d*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ei.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ao{constructor(e,i,l,d,m){this.name=e,this.type=i,this._evaluate=l,this.args=d,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const i=ao.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],d=ao.definitions[l];if(!d)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[];let S=null,A=-1;for(const[D,P]of _){if(Array.isArray(D)&&D.length!==e.length-1)continue;v.push(D),A++,S=new Tf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const k=[];let F=!1;for(let U=1;U<e.length;U++){const Z=e[U],Q=Array.isArray(D)?D[U-1]:D.type,X=S.parse(Z,1+k.length,Q);if(!X){F=!0;break}k.push(X)}if(!F)if(Array.isArray(D)&&D.length!==k.length)S.error(`Expected ${D.length} arguments, but found ${k.length} instead.`);else{for(let U=0;U<k.length;U++){const Z=Array.isArray(D)?D[U]:D.type,Q=k[U];S.concat(U+1).checkSubtype(Z,Q.type)}if(S.errors.length===0)return new ao(l,m,P,k,A)}}if(v.length===1)i.errors.push(...S.errors);else{const D=(v.length?v:_.map(([k])=>k)).map(oo).join(" | "),P=[];for(let k=1;k<e.length;k++){const F=i.parse(e[k],1+P.length);if(!F)return null;P.push(Ci(F.type))}i.error(`Expected arguments of type ${D}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){ao.definitions=i;for(const l in i)e[l]=ao}}function oo(r){return Array.isArray(r)?`(${r.map(Ci).join(", ")})`:`(${Ci(r.type)}...)`}class Lo{constructor(e,i,l){this.type=Ot,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const d=l["case-sensitive"]===void 0?i.parse(!1,1,L):i.parseObjectValue(l["case-sensitive"],1,"case-sensitive",L);if(!d)return null;const m=l["diacritic-sensitive"]===void 0?i.parse(!1,1,L):i.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",L);if(!m)return null;let _=null;return l.locale&&(_=i.parseObjectValue(l.locale,1,"locale",fi),!_)?null:new Lo(d,m,_)}evaluate(e){return new Wo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function gf(r,e,i=0,l=r.length-1,d=Vc){for(;l>i;){if(l-i>600){const S=l-i+1,A=e-i+1,D=Math.log(S),P=.5*Math.exp(2*D/3),k=.5*Math.sqrt(D*P*(S-P)/S)*(A-S/2<0?-1:1);gf(r,e,Math.max(i,Math.floor(e-A*P/S+k)),Math.min(l,Math.floor(e+(S-A)*P/S+k)),d)}const m=r[e];let _=i,v=l;for(Yo(r,i,e),d(r[l],m)>0&&Yo(r,i,l);_<v;){for(Yo(r,_,v),_++,v--;d(r[_],m)<0;)_++;for(;d(r[v],m)>0;)v--}d(r[i],m)===0?Yo(r,i,v):(v++,Yo(r,v,l)),v<=e&&(i=v+1),e<=v&&(l=v-1)}}function Yo(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function Vc(r,e){return r<e?-1:r>e?1:0}function v_(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}function lh(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function _f(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function jc(r,e,i){const l=r[0]-e[0],d=r[1]-e[1],m=r[0]-i[0],_=r[1]-i[1];return l*_-m*d===0&&l*m<=0&&d*_<=0}function Ap(r,e,i){return e[1]>r[1]!=i[1]>r[1]&&r[0]<(i[0]-e[0])*(r[1]-e[1])/(i[1]-e[1])+e[0]}function qa(r,e,i=!1){let l=!1;for(let d=0,m=e.length;d<m;d++){const _=e[d];for(let v=0,S=_.length,A=S-1;v<S;A=v++){const D=_[A],P=_[v];if(jc(r,D,P))return i;Ap(r,D,P)&&(l=!l)}}return l}function Ip(r,e,i,l){const d=l[0]-i[0],m=l[1]-i[1],_=(r[0]-i[0])*m-d*(r[1]-i[1]),v=(e[0]-i[0])*m-d*(e[1]-i[1]);return _>0&&v<0||_<0&&v>0}function yf(r,e,i,l){return(d=[l[0]-i[0],l[1]-i[1]])[0]*(m=[e[0]-r[0],e[1]-r[1]])[1]-d[1]*m[0]!==0&&!(!Ip(r,e,i,l)||!Ip(i,l,r,e));var d,m}function Ll(r){const e=new Dt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Dt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of r[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),i.x<l.x&&(i.x=l.x),i.y<l.y&&(i.y=l.y);return{min:e,max:i}}const Ko=8192;function Ym(r,e){const i=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(i*d*Ko),Math.round(l*d*Ko)]}function Km(r,e){for(let i=0;i<e.length;i++)if(qa(r,e[i]))return!0;return!1}function ch(r,e,i){for(const l of i)for(let d=0,m=l.length,_=m-1;d<m;_=d++)if(yf(r,e,l[_],l[d]))return!0;return!1}function Cp(r,e){for(let i=0;i<r.length;++i)if(!qa(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(ch(r[i],r[i+1],e))return!1;return!0}function b_(r,e){for(let i=0;i<e.length;i++)if(Cp(r,e[i]))return!0;return!1}function uc(r,e,i){const l=[];for(let d=0;d<r.length;d++){const m=[];for(let _=0;_<r[d].length;_++){const v=Ym(r[d][_],i);lh(e,v),m.push(v)}l.push(m)}return l}function w_(r,e,i){const l=[];for(let d=0;d<r.length;d++){const m=uc(r[d],e,i);l.push(m)}return l}function T_(r,e,i,l){if(r[0]<i[0]||r[0]>i[2]){const d=.5*l;let m=r[0]-i[0]>d?-l:i[0]-r[0]>d?l:0;m===0&&(m=r[0]-i[2]>d?-l:i[2]-r[0]>d?l:0),r[0]+=m}lh(e,r)}function Rp(r,e,i,l){const d=Math.pow(2,l.z)*Ko,m=[l.x*Ko,l.y*Ko],_=[];if(!r)return _;for(const v of r)for(const S of v){const A=[S.x+m[0],S.y+m[1]];T_(A,e,i,d),_.push(A)}return _}function Mp(r,e,i,l){const d=Math.pow(2,l.z)*Ko,m=[l.x*Ko,l.y*Ko],_=[];if(!r)return _;for(const S of r){const A=[];for(const D of S){const P=[D.x+m[0],D.y+m[1]];lh(e,P),A.push(P)}_.push(A)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of _)for(const A of S)T_(A,e,i,d)}var v;return _}class Uc{constructor(e,i){this.type=L,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(vu(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let d=0;d<l.features.length;++d){const m=l.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Uc(l,l.features[d].geometry)}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Uc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Uc(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=uc(l.coordinates,m,_),S=Rp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!qa(A,v))return!1}if(l.type==="MultiPolygon"){const v=w_(l.coordinates,m,_),S=Rp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!Km(A,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=uc(l.coordinates,m,_),S=Mp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!Cp(A,v))return!1}if(l.type==="MultiPolygon"){const v=w_(l.coordinates,m,_),S=Mp(i.geometry(),d,m,_);if(!_f(d,m))return!1;for(const A of S)if(!b_(A,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ha={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qo=1/298.257223563,cd=Qo*(2-Qo),Ra=Math.PI/180;class Ol{static fromTile(e,i,l){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),m=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Ra;return new Ol(m,l)}static get units(){return Ha}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ha[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ha).join(", ")}`);const l=6378.137*Ra*(i?Ha[i]:1),d=Math.cos(e*Ra),m=1/(1-cd*(1-d*d)),_=Math.sqrt(m);this.kx=l*_*d,this.ky=l*_*m*(1-cd)}distance(e,i){const l=$a(e[0]-i[0])*this.kx,d=(e[1]-i[1])*this.ky;return Math.sqrt(l*l+d*d)}bearing(e,i){const l=$a(i[0]-e[0])*this.kx;return Math.atan2(l,(i[1]-e[1])*this.ky)/Ra}destination(e,i,l){const d=l*Ra;return this.offset(e,Math.sin(d)*i,Math.cos(d)*i)}offset(e,i,l){return[e[0]+i/this.kx,e[1]+l/this.ky]}lineDistance(e){let i=0;for(let l=0;l<e.length-1;l++)i+=this.distance(e[l],e[l+1]);return i}area(e){let i=0;for(let l=0;l<e.length;l++){const d=e[l];for(let m=0,_=d.length,v=_-1;m<_;v=m++)i+=$a(d[m][0]-d[v][0])*(d[m][1]+d[v][1])*(l?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let l=0;if(i<=0)return e[0];for(let d=0;d<e.length-1;d++){const m=e[d],_=e[d+1],v=this.distance(m,_);if(l+=v,l>i)return uh(m,_,(i-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,l){let[d,m]=i,_=$a(l[0]-d)*this.kx,v=(l[1]-m)*this.ky;if(_!==0||v!==0){const S=($a(e[0]-d)*this.kx*_+(e[1]-m)*this.ky*v)/(_*_+v*v);S>1?(d=l[0],m=l[1]):S>0&&(d+=_/this.kx*S,m+=v/this.ky*S)}return _=$a(e[0]-d)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(e,i){let l=1/0,d=e[0][0],m=e[0][1],_=0,v=0;for(let S=0;S<e.length-1;S++){let A=e[S][0],D=e[S][1],P=$a(e[S+1][0]-A)*this.kx,k=(e[S+1][1]-D)*this.ky,F=0;P===0&&k===0||(F=($a(i[0]-A)*this.kx*P+(i[1]-D)*this.ky*k)/(P*P+k*k),F>1?(A=e[S+1][0],D=e[S+1][1]):F>0&&(A+=P/this.kx*F,D+=k/this.ky*F)),P=$a(i[0]-A)*this.kx,k=(i[1]-D)*this.ky;const U=P*P+k*k;U<l&&(l=U,d=A,m=D,_=S,v=F)}return{point:[d,m],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,l){let d=this.pointOnLine(l,e),m=this.pointOnLine(l,i);if(d.index>m.index||d.index===m.index&&d.t>m.t){const A=d;d=m,m=A}const _=[d.point],v=d.index+1,S=m.index;!xf(l[v],_[0])&&v<=S&&_.push(l[v]);for(let A=v+1;A<=S;A++)_.push(l[A]);return xf(l[S],m.point)||_.push(m.point),_}lineSliceAlong(e,i,l){let d=0;const m=[];for(let _=0;_<l.length-1;_++){const v=l[_],S=l[_+1],A=this.distance(v,S);if(d+=A,d>e&&m.length===0&&m.push(uh(v,S,(e-(d-A))/A)),d>=i)return m.push(uh(v,S,(i-(d-A))/A)),m;d>e&&m.push(S)}return m}bufferPoint(e,i){const l=i/this.ky,d=i/this.kx;return[e[0]-d,e[1]-l,e[0]+d,e[1]+l]}bufferBBox(e,i){const l=i/this.ky,d=i/this.kx;return[e[0]-d,e[1]-l,e[2]+d,e[3]+l]}insideBBox(e,i){return $a(e[0]-i[0])>=0&&$a(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function xf(r,e){return r[0]===e[0]&&r[1]===e[1]}function uh(r,e,i){const l=$a(e[0]-r[0]);return[r[0]+l*i,r[1]+(e[1]-r[1])*i]}function $a(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class hh{constructor(e=[],i=(l,d)=>l<d?-1:l>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,d=i[e];for(;e>0;){const m=e-1>>1,_=i[m];if(l(d,_)>=0)break;i[e]=_,e=m}i[e]=d}_down(e){const{data:i,compare:l}=this,d=this.length>>1,m=i[e];for(;e<d;){let _=1+(e<<1);const v=_+1;if(v<this.length&&l(i[v],i[_])<0&&(_=v),l(i[_],m)>=0)break;i[e]=i[_],e=_}i[e]=m}}var jt=8192;function Dp(r,e){return e.dist-r.dist}function ud(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function hc(r){return r[1]-r[0]+1}function dc(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function lo(r,e){if(r[0]>r[1])return[null,null];const i=hc(r);if(e){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(i===1)return[r,null];const l=Math.floor(i/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function Gc(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!dc(e,r.length))return i;for(let l=e[0];l<=e[1];++l)lh(i,r[l]);return i}function co(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let l=0;l<r[i].length;++l)lh(e,r[i][l]);return e}function qc(r,e,i){if(ud(r)||ud(e))return NaN;let l=0,d=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(d=r[1]-e[3]),r[3]<e[1]&&(d=e[1]-r[3]),i.distance([0,0],[l,d])}function dh(r){return 360*r-180}function wu(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function hd(r,e){const i=Math.pow(2,e.z),l=(r.y/jt+e.y)/i;return[dh((r.x/jt+e.x)/i),wu(l)]}function E_(r,e){const i=[];for(let l=0;l<r.length;++l)i.push(hd(r[l],e));return i}function Pp(r,e,i){const l=i.pointOnLine(e,r).point;return i.distance(r,l)}function kp(r,e,i,l,d){const m=i.slice(l[0],l[1]+1);let _=1/0;for(let v=e[0];v<=e[1];++v)if((_=Math.min(_,Pp(r[v],m,d)))===0)return 0;return _}function aa(r,e,i,l,d){const m=Math.min(d.pointToSegmentDistance(r,i,l),d.pointToSegmentDistance(e,i,l)),_=Math.min(d.pointToSegmentDistance(i,r,e),d.pointToSegmentDistance(l,r,e));return Math.min(m,_)}function ai(r,e,i,l,d){if(!dc(e,r.length)||!dc(l,i.length))return NaN;let m=1/0;for(let _=e[0];_<e[1];++_)for(let v=l[0];v<l[1];++v){if(yf(r[_],r[_+1],i[v],i[v+1]))return 0;m=Math.min(m,aa(r[_],r[_+1],i[v],i[v+1],d))}return m}function dd(r,e,i,l,d){if(!dc(e,r.length)||!dc(l,i.length))return NaN;let m=1/0;for(let _=e[0];_<=e[1];++_)for(let v=l[0];v<=l[1];++v)if((m=Math.min(m,d.distance(r[_],i[v])))===0)return m;return m}function Lp(r,e,i){if(qa(r,e,!0))return 0;let l=1/0;for(const d of e){const m=d.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[m-1]&&(l=Math.min(l,i.pointToSegmentDistance(r,d[m-1],d[0])))===0||(l=Math.min(l,Pp(r,d,i)))===0)return l}return l}function vf(r,e,i,l){if(!dc(e,r.length))return NaN;for(let m=e[0];m<=e[1];++m)if(qa(r[m],i,!0))return 0;let d=1/0;for(let m=e[0];m<e[1];++m)for(const _ of i)for(let v=0,S=_.length,A=S-1;v<S;A=v++){if(yf(r[m],r[m+1],_[A],_[v]))return 0;d=Math.min(d,aa(r[m],r[m+1],_[A],_[v],l))}return d}function Oo(r,e){for(const i of r)for(let l=0;l<=i.length-1;++l)if(qa(i[l],e,!0))return!0;return!1}function ml(r,e,i,l=1/0){const d=co(r),m=co(e);if(l!==1/0&&qc(d,m,i)>=l)return l;if(_f(d,m)){if(Oo(r,e))return 0}else if(Oo(e,r))return 0;let _=l;for(const v of r)for(let S=0,A=v.length,D=A-1;S<A;D=S++)for(const P of e)for(let k=0,F=P.length,U=F-1;k<F;U=k++){if(yf(v[D],v[S],P[U],P[k]))return 0;_=Math.min(_,aa(v[D],v[S],P[U],P[k],i))}return _}function qi(r,e,i,l,d,m,_){if(m===null||_===null)return;const v=qc(Gc(l,m),Gc(d,_),i);v<e&&r.push({dist:v,range1:m,range2:_})}function fc(r,e,i,l,d=1/0){let m=Math.min(l.distance(r[0],i[0][0]),d);if(m===0)return m;const _=new hh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Dp),v=e?50:100,S=co(i);for(;_.length;){const A=_.pop();if(A.dist>=m)continue;const D=A.range1;if(hc(D)<=v){if(!dc(D,r.length))return NaN;if(e){const P=vf(r,D,i,l);if((m=Math.min(m,P))===0)return m}else for(let P=D[0];P<=D[1];++P){const k=Lp(r[P],i,l);if((m=Math.min(m,k))===0)return m}}else{const P=lo(D,e);if(P[0]!==null){const k=qc(Gc(r,P[0]),S,l);k<m&&_.push({dist:k,range1:P[0],range2:[0,0]})}if(P[1]!==null){const k=qc(Gc(r,P[1]),S,l);k<m&&_.push({dist:k,range1:P[1],range2:[0,0]})}}}return m}function zl(r,e,i,l,d,m=1/0){let _=Math.min(m,d.distance(r[0],i[0]));if(_===0)return _;const v=new hh([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Dp),S=e?50:100,A=l?50:100;for(;v.length;){const D=v.pop();if(D.dist>=_)continue;const P=D.range1,k=D.range2;if(hc(P)<=S&&hc(k)<=A){if(!dc(P,r.length)||!dc(k,i.length))return NaN;if(e&&l?_=Math.min(_,ai(r,P,i,k,d)):e||l?e&&!l?_=Math.min(_,kp(i,k,r,P,d)):!e&&l&&(_=Math.min(_,kp(r,P,i,k,d))):_=Math.min(_,dd(r,P,i,k,d)),_===0)return _}else{const F=lo(P,e),U=lo(k,l);qi(v,_,d,r,i,F[0],U[0]),qi(v,_,d,r,i,F[0],U[1]),qi(v,_,d,r,i,F[1],U[0]),qi(v,_,d,r,i,F[1],U[1])}}return _}function Nl(r,e,i,l,d=1/0){let m=d;const _=Gc(r,[0,r.length-1]);for(const v of i)if(!(m!==1/0&&qc(_,Gc(v,[0,v.length-1]),l)>=m)&&(m=Math.min(m,zl(r,e,v,!0,l,m)),m===0))return m;return m}function bf(r,e,i,l,d=1/0){let m=d;const _=Gc(r,[0,r.length-1]);for(const v of i){if(m!==1/0&&qc(_,co(v),l)>=m)continue;const S=fc(r,e,v,l,m);if(isNaN(S))return S;if((m=Math.min(m,S))===0)return m}return m}function wf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Hc{constructor(e,i){this.type=gn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(vu(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let d=0;d<l.features.length;++d)if(wf(l.features[d].geometry.type))return new Hc(l,l.features[d].geometry)}else if(l.type==="Feature"){if(wf(l.geometry.type))return new Hc(l,l.geometry)}else if(wf(l.type))return new Hc(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),l=e.canonicalID();if(i!=null&&l!=null){if(e.geometryType()==="Point")return(function(d,m,_){const v=[];for(const A of d)for(const D of A)v.push(hd(D,m));const S=new Ol(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?zl(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S):_.type==="MultiLineString"?Nl(v,!1,_.coordinates,S):_.type==="Polygon"||_.type==="MultiPolygon"?bf(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,S):null})(i,l,this.geometries);if(e.geometryType()==="LineString")return(function(d,m,_){const v=[];for(const A of d){const D=[];for(const P of A)D.push(hd(P,m));v.push(D)}const S=new Ol(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Nl(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let A=1/0;for(let D=0;D<_.coordinates.length;D++){const P=Nl(_.coordinates[D],!0,v,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(_.type==="Polygon"||_.type==="MultiPolygon"){let A=1/0;for(let D=0;D<v.length;D++){const P=bf(v[D],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null})(i,l,this.geometries);if(e.geometryType()==="Polygon")return(function(d,m,_){const v=[];for(const A of(function(D){const P=D.length;if(P<=1)return[D];const k=[];let F,U;for(let Z=0;Z<P;Z++){const Q=v_(D[Z]);Q!==0&&(D[Z].area=Math.abs(Q),U===void 0&&(U=Q<0),U===Q<0?(F&&k.push(F),F=[D[Z]]):F.push(D[Z]))}return F&&k.push(F),k})(d)){const D=[];for(let P=0;P<A.length;++P)D.push(E_(A[P],m));v.push(D)}const S=new Ol(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return bf(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,S);if(_.type==="MultiLineString"){let A=1/0;for(let D=0;D<_.coordinates.length;D++){const P=bf(_.coordinates[D],!0,v,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(A,D,P){let k=1/0;for(const F of A)for(const U of D){const Z=ml(F,U,P,k);if(isNaN(Z))return Z;if((k=Math.min(k,Z))===0)return k}return k})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,S):null})(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fh(r){if(r instanceof ao&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Uc||r instanceof Hc)return!1;if(r instanceof Tu)return r.featureConstant;let e=!0;return r.eachChild(i=>{e&&!fh(i)&&(e=!1)}),e}function js(r){if(r instanceof ao&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!js(i)&&(e=!1)}),e}function Ur(r,e){if(r instanceof ao&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(l=>{i&&!Ur(l,e)&&(i=!1)}),i}function dr(r,e,i){return[r,e,i].filter(Boolean).join("")}function pc(r,e){switch(r){case"string":return kl(e);case"number":return+e;case"boolean":return!!e;case"color":return Ei.parse(e);case"formatted":return Ms.fromString(kl(e));case"resolvedImage":return so.build(kl(e))}return e}function Jo(r,e,i,l){return l!==void 0&&(r=l*Math.round(r/l)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Tu{constructor(e,i,l,d=!1){this.type=e,this.key=i,this.scope=l,this.featureConstant=d}static parse(e,i){let l=i.expectedType;if(l==null&&(l=Ce),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const d=i.parse(e[1],1);if(!(d instanceof Xo))return i.error("Key name of 'config' expression must be a string literal.");let m,_=!0;const v=kl(d.value);if(e.length>=3){const S=i.parse(e[2],2);if(!(S instanceof Xo))return i.error("Scope of 'config' expression must be a string literal.");m=kl(S.value)}if(i.options){const S=dr(v,m,i._scope),A=i.options.get(S);A&&(_=fh(A.value||A.default))}return new Tu(l,v,m,_)}evaluate(e){const i=dr(this.key,this.scope,e.scope),l=e.getConfig(i);if(!l)return null;const{type:d,value:m,values:_,minValue:v,maxValue:S,stepValue:A}=l,D=l.default.evaluate(e);let P=D;if(m){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),P=m.evaluate(e),e.scope=k}return d&&(P=pc(d,P)),P===void 0||v===void 0&&S===void 0&&A===void 0||(typeof P=="number"?P=Jo(P,v,S,A):Array.isArray(P)&&(P=P.map(k=>typeof k=="number"?Jo(k,v,S,A):k))),m!==void 0&&P!==void 0&&_&&!_.includes(P)&&(P=D,d&&(P=pc(d,P))),(d&&d!==this.type||P!==void 0&&!ko(Cs(P),this.type))&&(P=pc(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Bl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Bl(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tf{constructor(e,i=[],l,d=new ya,m=[],_,v,S){this.registry=e,this.path=i,this.key=i.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=d,this.errors=m,this.expectedType=l,this._scope=_,this.options=v,this.iconImageUseTheme=S}parse(e,i,l,d,m={}){return i||l?this.concat(i,null,l,d)._parse(e,m):this._parse(e,m)}parseObjectValue(e,i,l,d,m,_={}){return this.concat(i,l,d,m)._parse(e,_)}_parse(e,i){function l(d,m,_){return _==="assert"?new zn(m,[d]):_==="coerce"?new cc(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,v=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else m=l(m,_,i.typeAnnotation||"coerce");else m=l(m,_,i.typeAnnotation||"assert")}if(!(m instanceof Xo)&&m.type.kind!=="resolvedImage"&&Op(m)){const _=new ld(this._scope,this.options,this.iconImageUseTheme);try{m=new Xo(m.type,m.evaluate(_))}catch(v){return this.error(v.message),null}}return m}return cc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l,d){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof i=="string"?m.concat(i):m;const _=d?this.scope.concat(d):this.scope;return new Tf(this.registry,m,l||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const l=`${this.key}${i.map(d=>`[${d}]`).join("")}`;this.errors.push(new Is(l,e))}checkSubtype(e,i){const l=Qr(e,i);return l&&this.error(l),l}}function Op(r){if(r instanceof Bl)return Op(r.boundExpression);if(r instanceof ao&&r.name==="error"||r instanceof Lo||r instanceof Uc||r instanceof Hc||r instanceof Tu)return!1;const e=r instanceof cc||r instanceof zn;let i=!0;return r.eachChild(l=>{i=e?i&&Op(l):i&&l instanceof Xo}),!!i&&fh(r)&&Ur(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function $c(r,e){const i=r.length-1;let l,d,m=0,_=i,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),l=r[v],d=r[v+1],l<=e){if(v===i||e<d)return v;m=v+1}else{if(!(l>e))throw new ns("Input is not a number.");_=v-1}return 0}class Fl{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[d,m]of l)this.labels.push(d),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,gn);if(!l)return null;const d=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],S=e[_+1],A=_,D=_+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(d.length&&d[d.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=i.parse(S,D,m);if(!P)return null;m=m||P.type,d.push([v,P])}return new Fl(m,l,d)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return l[0].evaluate(e);const m=i.length;return d>=i[m-1]?l[m-1].evaluate(e):l[$c(i,d)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const zp=.95047,fd=1.08883,Np=4/29,gl=6/29,mc=3*gl*gl,Eu=gl*gl*gl,Zc=Math.PI/180,Qm=180/Math.PI;function Ef(r){return r>Eu?Math.pow(r,1/3):r/mc+Np}function Su(r){return r>gl?r*r*r:mc*(r-Np)}function pd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Wc(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function va(r){const e=Wc(r.r),i=Wc(r.g),l=Wc(r.b),d=Ef((.4124564*e+.3575761*i+.1804375*l)/zp),m=Ef((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Ef((.0193339*e+.119192*i+.9503041*l)/fd)),alpha:r.a}}function ph(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*Su(e),i=zp*Su(i),l=fd*Su(l),new Ei(pd(3.2404542*i-1.5371385*e-.4985314*l),pd(-.969266*i+1.8760108*e+.041556*l),pd(.0556434*i-.2040259*e+1.0572252*l),r.alpha)}function Sf(r,e,i){const l=e-r;return r+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const md={forward:va,reverse:ph,interpolate:function(r,e,i){return{l:Rn(r.l,e.l,i),a:Rn(r.a,e.a,i),b:Rn(r.b,e.b,i),alpha:Rn(r.alpha,e.alpha,i)}}},Af={forward:function(r){const{l:e,a:i,b:l}=va(r),d=Math.atan2(l,i)*Qm;return{h:d<0?d+360:d,c:Math.sqrt(i*i+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Zc,i=r.c;return ph({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Sf(r.h,e.h,i),c:Rn(r.c,e.c,i),l:Rn(r.l,e.l,i),alpha:Rn(r.alpha,e.alpha,i)}}};var S_=Object.freeze({__proto__:null,hcl:Af,lab:md});class Sr{constructor(e,i,l,d,m){this.type=e,this.operator=i,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,i,l,d){let m=0;if(e.name==="exponential")m=gd(i,e.base,l,d);else if(e.name==="linear")m=gd(i,1,l,d);else if(e.name==="cubic-bezier"){const _=e.controlPoints;m=new hl(_[0],_[1],_[2],_[3]).solve(gd(i,1,l,d))}return m}static parse(e,i){let[l,d,m,..._]=e;if(!Array.isArray(d)||d.length===0)return i.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const A=d[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const A=d.slice(1);if(A.length!==4||A.some(D=>typeof D!="number"||D<0||D>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,gn),!m)return null;const v=[];let S=null;l==="interpolate-hcl"||l==="interpolate-lab"?S=ie:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let A=0;A<_.length;A+=2){const D=_[A],P=_[A+1],k=A+3,F=A+4;if(typeof D!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=D)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const U=i.parse(P,F,S);if(!U)return null;S=S||U.type,v.push([D,U])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Sr(S,l,d,m,v):i.error(`Type ${Ci(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return l[0].evaluate(e);const m=i.length;if(d>=i[m-1])return l[m-1].evaluate(e);const _=$c(i,d),v=Sr.interpolationFactor(this.interpolation,d,i[_],i[_+1]),S=l[_].evaluate(e),A=l[_+1].evaluate(e);return this.operator==="interpolate"?oc[this.type.kind.toLowerCase()](S,A,v):this.operator==="interpolate-hcl"?Af.reverse(Af.interpolate(Af.forward(S),Af.forward(A),v)):md.reverse(md.interpolate(md.forward(S),md.forward(A),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function gd(r,e,i,l){const d=l-i,m=r-i;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Xc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const d=i.expectedType;d&&d.kind!=="value"&&(l=d);const m=[];for(const v of e.slice(1)){const S=i.parse(v,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,m.push(S)}const _=d&&m.some(v=>Qr(d,v.type));return new Xc(_?Ce:l,m)}evaluate(e){let i,l=null,d=0;for(const m of this.args){if(d++,l=m.evaluate(e),l&&l instanceof so&&!l.available&&(i||(i=l),l=null,d===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class el{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=i.parse(e[m+1],m+1);if(!v)return null;l.push([_,v])}const d=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return d?new el(l,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}class _d{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,gn),d=i.parse(e[2],2,li(i.expectedType||Ce));return l&&d?new _d(d.type.itemType,l,d):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ns("Array index out of bounds: negative index");if(i>=l.length)throw new ns("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new ns("Array index must be an integer. Use at-interpolated for fractional indices");return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yc{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,gn),d=i.parse(e[2],2,li(i.expectedType||Ce));return l&&d?new Yc(d.type.itemType,l,d):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ns(`Array index out of bounds: ${i} < 0.`);if(i>l.length-1)throw new ns(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i===Math.floor(i))return l[i];const d=Math.floor(i),m=Math.ceil(i),_=l[d],v=l[m];if(typeof _!="number"||typeof v!="number")throw new ns(`Cannot interpolate between non-number values at index ${i}.`);const S=i-d;return _*(1-S)+v*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Au{constructor(e,i){this.type=L,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,Ce);return l&&d?Do(l.type,[L,fi,gn,xa,Ce])?new Au(l,d):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Po(i,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(Cs(i))} instead.`);if(!Po(l,["string","array"]))throw new ns(`Expected second argument to be of type array or string, but found ${Ci(Cs(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class yd{constructor(e,i,l){this.type=gn,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,Ce);if(!l||!d)return null;if(!Do(l.type,[L,fi,gn,xa,Ce]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(l.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,gn);return m?new yd(l,d,m):null}return new yd(l,d)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Po(i,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(Cs(i))} instead.`);if(!Po(l,["string","array"]))throw new ns(`Expected second argument to be of type array or string, but found ${Ci(Cs(l))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return l.indexOf(i,d)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class xd{constructor(e,i,l,d,m,_){this.inputType=e,this.type=i,this.input=l,this.cases=d,this.outputs=m,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,d;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);const m={},_=[];for(let A=2;A<e.length-1;A+=2){let D=e[A];const P=e[A+1];Array.isArray(D)||(D=[D]);const k=i.concat(A);if(D.length===0)return k.error("Expected at least one branch label.");for(const U of D){if(typeof U!="number"&&typeof U!="string")return k.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return k.error("Numeric branch labels must be integer values.");if(l){if(k.checkSubtype(l,Cs(U)))return null}else l=Cs(U);if(m[String(U)]!==void 0)return k.error("Branch labels must be unique.");m[String(U)]=_.length}const F=i.parse(P,A,d);if(!F)return null;d=d||F.type,_.push(F)}const v=i.parse(e[1],1,Ce);if(!v)return null;const S=i.parse(e[e.length-1],e.length-1,d);return S?v.type.kind!=="value"&&i.concat(1).checkSubtype(l,v.type)?null:new xd(l,d,v,m,_,S):null}evaluate(e){const i=this.input.evaluate(e);return(ko(Cs(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],d={};for(const _ of i){const v=d[this.cases[_]];v===void 0?(d[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of l)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class If{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const v=i.parse(e[_],_,L);if(!v)return null;const S=i.parse(e[_+1],_+1,l);if(!S)return null;d.push([v,S]),l=l||S.type}const m=i.parse(e[e.length-1],e.length-1,l);return m?new If(l,d,m):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Cf{constructor(e,i,l,d){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=d}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ce),d=i.parse(e[2],2,gn);if(!l||!d)return null;if(!Do(l.type,[li(Ce),fi,Ce]))return i.error(`Expected first argument to be of type array or string, but found ${Ci(l.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,gn);return m?new Cf(l.type,l,d,m):null}return new Cf(l.type,l,d)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Po(i,["string","array"]))throw new ns(`Expected first argument to be of type array or string, but found ${Ci(Cs(i))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return i.slice(l,d)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Kc{constructor(e,i){this.type=li(fi),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,fi),d=i.parse(e[2],2,fi);return l&&d?new Kc(l,d):void 0}evaluate(e){const i=this.str.evaluate(e),l=this.delimiter.evaluate(e);return i.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Rf(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function vd(r,e,i,l){return l.compare(e,i)===0}function mh(r,e,i){const l=r!=="=="&&r!=="!=";return class YL{constructor(m,_,v){this.type=L,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const v=m[0];let S=_.parse(m[1],1,Ce);if(!S)return null;if(!Rf(v,S.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Ci(S.type)}'.`);let A=_.parse(m[2],2,Ce);if(!A)return null;if(!Rf(v,A.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Ci(A.type)}'.`);if(S.type.kind!==A.type.kind&&S.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${Ci(S.type)}' and '${Ci(A.type)}'.`);l&&(S.type.kind==="value"&&A.type.kind!=="value"?S=new zn(A.type,[S]):S.type.kind!=="value"&&A.type.kind==="value"&&(A=new zn(S.type,[A])));let D=null;if(m.length===4){if(S.type.kind!=="string"&&A.type.kind!=="string"&&S.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(D=_.parse(m[3],3,Ot),!D)return null}return new YL(S,A,D)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const S=Cs(_),A=Cs(v);if(S.kind!==A.kind||S.kind!=="string"&&S.kind!=="number")throw new ns(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=Cs(_),A=Cs(v);if(S.kind!=="string"||A.kind!=="string")return e(m,_,v)}return this.collator?i(m,_,v,this.collator.evaluate(m)):e(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const bd=mh("==",function(r,e,i){return e===i},vd),Jm=mh("!=",function(r,e,i){return e!==i},function(r,e,i,l){return!vd(0,e,i,l)}),Mf=mh("<",function(r,e,i){return e<i},function(r,e,i,l){return l.compare(e,i)<0}),Df=mh(">",function(r,e,i){return e>i},function(r,e,i,l){return l.compare(e,i)>0}),Pf=mh("<=",function(r,e,i){return e<=i},function(r,e,i,l){return l.compare(e,i)<=0}),A_=mh(">=",function(r,e,i){return e>=i},function(r,e,i,l){return l.compare(e,i)>=0});class gc{constructor(e,i,l,d,m,_){this.type=fi,this.number=e,this.locale=i,this.currency=l,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,gn);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return i.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=i.parseObjectValue(d.locale,2,"locale",fi),!m))return null;let _=null;if(d.currency&&(_=i.parseObjectValue(d.currency,2,"currency",fi),!_))return null;let v=null;if(d.unit&&(v=i.parseObjectValue(d.unit,2,"unit",fi),!v))return null;let S=null;if(d["min-fraction-digits"]&&(S=i.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",gn),!S))return null;let A=null;return d["max-fraction-digits"]&&(A=i.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",gn),!A)?null:new gc(l,m,_,v,S,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Qc{constructor(e){this.type=gn,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ci(l.type)} instead.`):new Qc(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ns(`Expected value to be of type string or array, but found ${Ci(Cs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function eg(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Iu={"==":bd,"!=":Jm,">":Df,"<":Mf,">=":A_,"<=":Pf,array:zn,at:_d,"at-interpolated":Yc,boolean:zn,case:If,coalesce:Xc,collator:Lo,format:mn,image:oh,in:Au,"index-of":yd,interpolate:Sr,"interpolate-hcl":Sr,"interpolate-lab":Sr,length:Qc,let:el,literal:Xo,match:xd,number:zn,"number-format":gc,object:zn,slice:Cf,step:Fl,string:zn,"to-boolean":cc,"to-color":cc,"to-number":cc,"to-string":cc,var:Bl,within:Uc,distance:Hc,config:Tu,split:Kc};function Cu(r,[e,i,l,d]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const m=d?d.evaluate(r):1,_=Wm(e,i,l,m);if(_)throw new ns(_);return new Ei(e/255,i/255,l/255,m)}function wd(r,[e,i,l,d]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const m=d?d.evaluate(r):1,_=(function(A,D,P,k){return typeof A=="number"&&A>=0&&A<=360?typeof D=="number"&&D>=0&&D<=100&&typeof P=="number"&&P>=0&&P<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[A,D,P,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[A,D,P,k]:[A,D,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[A,D,P,k]:[A,D,P]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,l,m);if(_)throw new ns(_);const v=`hsla(${e}, ${i}%, ${l}%, ${m})`,S=Ei.parse(v);if(!S)throw new ns(`Failed to parse HSLA color: ${v}`);return S}function kf(r,e){return r in e}function gh(r,e){const i=e[r];return i===void 0?null:i}function Vl(r){return{type:r}}function Ru(r){if(r instanceof Tu)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...Ru(i)])}),e}function _c(r){if(r instanceof ao&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild(i=>{!e&&_c(i)&&(e=!0)}),e}function tg(r){return{result:"success",value:r}}function uo(r){return{result:"error",value:r}}function Lf(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Td(r){return r["property-type"]==="data-driven"}function yc(r){return Lf(r.expression,"measure-light")}function Jc(r){return Lf(r.expression,"zoom")}function _h(r){return!!r.expression&&r.expression.interpolated}function Ed(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Bp(r){return r}function yh(r,e){const i=e.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",d=l||!(l||r.property!==void 0),m=r.type||(_h(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],Ei.parse(A[1])])),r.default=Ei.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!S_[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,v,S;if(m==="exponential")_=vh;else if(m==="interval")_=I_;else if(m==="categorical"){_=xh,v=Object.create(null);for(const A of r.stops)v[A[0]]=A[1];S=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Fp}if(l){const A={},D=[];for(let F=0;F<r.stops.length;F++){const U=r.stops[F],Z=U[0].zoom;A[Z]===void 0&&(A[Z]={zoom:Z,type:r.type,property:r.property,default:r.default,stops:[]},D.push(Z)),A[Z].stops.push([U[0].value,U[1]])}const P=[];for(const F of D)P.push([A[F].zoom,yh(A[F],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Sr.interpolationFactor.bind(void 0,k),zoomStops:P.map(F=>F[0]),evaluate:({zoom:F},U)=>vh({stops:P,base:r.base},e,F).evaluate(F,U)}}if(d){const A=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Sr.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(D=>D[0]),evaluate:({zoom:D})=>_(r,e,D,v,S)}}return{kind:"source",evaluate(A,D){const P=D&&D.properties?D.properties[r.property]:void 0;return P===void 0?eu(r.default,e.default):_(r,e,P,v,S)}}}function eu(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function xh(r,e,i,l,d){return eu(typeof i===d?l[i]:void 0,r.default,e.default)}function I_(r,e,i){if(!Mn(i))return eu(r.default,e.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const d=$c(r.stops.map(m=>m[0]),i);return r.stops[d][1]}function vh(r,e,i){const l=r.base!==void 0?r.base:1;if(!Mn(i))return eu(r.default,e.default);const d=r.stops.length;if(d===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[d-1][0])return r.stops[d-1][1];const m=$c(r.stops.map(D=>D[0]),i),_=(function(D,P,k,F){const U=F-k,Z=D-k;return U===0?0:P===1?Z/U:(Math.pow(P,Z)-1)/(Math.pow(P,U)-1)})(i,l,r.stops[m][0],r.stops[m+1][0]),v=r.stops[m][1],S=r.stops[m+1][1];let A=oc[e.type]||Bp;if(r.colorSpace&&r.colorSpace!=="rgb"){const D=S_[r.colorSpace];A=(P,k)=>D.reverse(D.interpolate(D.forward(P),D.forward(k),_))}return typeof v.evaluate=="function"?{evaluate(...D){const P=v.evaluate.apply(void 0,D),k=S.evaluate.apply(void 0,D);if(P!==void 0&&k!==void 0)return A(P,k,_)}}:A(v,S,_)}function Fp(r,e,i){return e.type==="color"?i=Ei.parse(i):e.type==="formatted"?i=Ms.fromString(i.toString()):e.type==="resolvedImage"?i=so.build(i.toString()):On(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),eu(i,r.default,e.default)}ao.register(Iu,{error:[{kind:"error"},[fi],(r,[e])=>{throw new ns(e.evaluate(r))}],typeof:[fi,[Ce],(r,[e])=>Ci(Cs(e.evaluate(r)))],"to-rgba":[li(gn,4),[ie],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[li(gn,4),[ie],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ie,[gn,gn,gn],Cu],rgba:[ie,[gn,gn,gn,gn],Cu],hsl:[ie,[gn,gn,gn],wd],hsla:[ie,[gn,gn,gn,gn],wd],has:{type:L,overloads:[[[fi],(r,[e])=>kf(e.evaluate(r),r.properties())],[[fi,de],(r,[e,i])=>kf(e.evaluate(r),i.evaluate(r))]]},get:{type:Ce,overloads:[[[fi],(r,[e])=>gh(e.evaluate(r),r.properties())],[[fi,de],(r,[e,i])=>gh(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Ce,[fi],(r,[e])=>gh(e.evaluate(r),r.featureState||{})],properties:[de,[],r=>r.properties()],"geometry-type":[fi,[],r=>r.geometryType()],worldview:[fi,[],r=>r.globals.worldview||""],"is-active-floor":[L,Vl(fi),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some(l=>{const d=l.evaluate(r);return i.has(d)})}],id:[Ce,[],r=>r.id()],zoom:[gn,[],r=>r.globals.zoom],pitch:[gn,[],r=>r.globals.pitch||0],"distance-from-center":[gn,[],r=>r.distanceFromCenter()],"measure-light":[gn,[fi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[gn,[],r=>r.globals.heatmapDensity||0],"line-progress":[gn,[],r=>r.globals.lineProgress||0],"raster-value":[gn,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[gn,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[gn,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ce,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[gn,Vl(gn),(r,e)=>{let i=0;for(const l of e)i+=l.evaluate(r);return i}],"*":[gn,Vl(gn),(r,e)=>{let i=1;for(const l of e)i*=l.evaluate(r);return i}],"-":{type:gn,overloads:[[[gn,gn],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[gn],(r,[e])=>-e.evaluate(r)]]},"/":[gn,[gn,gn],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[gn,[gn,gn],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[gn,[],()=>Math.LN2],pi:[gn,[],()=>Math.PI],e:[gn,[],()=>Math.E],"^":[gn,[gn,gn],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[gn,[gn],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[gn,[gn],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[gn,[gn],(r,[e])=>Math.log(e.evaluate(r))],log2:[gn,[gn],(r,[e])=>Math.log2(e.evaluate(r))],sin:[gn,[gn],(r,[e])=>Math.sin(e.evaluate(r))],cos:[gn,[gn],(r,[e])=>Math.cos(e.evaluate(r))],tan:[gn,[gn],(r,[e])=>Math.tan(e.evaluate(r))],asin:[gn,[gn],(r,[e])=>Math.asin(e.evaluate(r))],acos:[gn,[gn],(r,[e])=>Math.acos(e.evaluate(r))],atan:[gn,[gn],(r,[e])=>Math.atan(e.evaluate(r))],min:[gn,Vl(gn),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[gn,Vl(gn),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[gn,[gn],(r,[e])=>Math.abs(e.evaluate(r))],round:[gn,[gn],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[gn,[gn],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[gn,[gn],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[L,[fi,Ce],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[L,[Ce],(r,[e])=>r.id()===e.value],"filter-type-==":[L,[fi],(r,[e])=>r.geometryType()===e.value],"filter-<":[L,[fi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l<d}],"filter-id-<":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[L,[fi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l>d}],"filter-id->":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[L,[fi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[L,[fi,Ce],(r,[e,i])=>{const l=r.properties()[e.value],d=i.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[L,[Ce],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[L,[Ce],(r,[e])=>e.value in r.properties()],"filter-has-id":[L,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[L,[li(fi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[L,[li(Ce)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[L,[fi,li(Ce)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[L,[fi,li(Ce)],(r,[e,i])=>(function(l,d,m,_){for(;m<=_;){const v=m+_>>1;if(d[v]===l)return!0;d[v]>l?_=v-1:m=v+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:L,overloads:[[[L,L],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Vl(L),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:L,overloads:[[[L,L],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Vl(L),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[L,[L],(r,[e])=>!e.evaluate(r)],"is-supported-script":[L,[fi],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[fi,[fi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[fi,[fi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[fi,Vl(Ce),(r,e)=>e.map(i=>kl(i.evaluate(r))).join("")],"resolved-locale":[fi,[Ot],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[gn,[gn,gn,Ce],(r,e)=>{const[i,l,d]=e.map(_=>_.evaluate(r));if(i>l||i===l)return i;let m;if(typeof d=="string")m=(function(_){let v=0;if(_.length===0)return v;for(let S=0;S<_.length;S++)v=(v<<5)-v+_.charCodeAt(S),v&=v;return v})(d);else{if(typeof d!="number")throw new ns(`Invalid seed input: ${d}`);m=d}return i+eg(m)()*(l-i)}]});class Of{constructor(e,i,l,d,m){this.expression=e,this._warningHistory={},this._scope=l,this._options=d,this._iconImageUseTheme=m,this._evaluator=new ld(l,d,m),this._defaultValue=i?(function(_){return _.type==="color"&&(Ed(_.default)||Array.isArray(_.default))?new Ei(0,0,0,0):_.type==="color"?Ei.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Ru(e),this.isIndoorDependent=_c(e)}evaluateWithoutErrorHandling(e,i,l,d,m,_,v,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,d,m,_,v,S,A){this._evaluator||(this._evaluator=new ld(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=A||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new ns(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){const P=D;return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function bh(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Iu}function xc(r,e,i,l,d){const m=new Tf(Iu,[],e?(function(v){const S={color:ie,string:fi,number:gn,enum:fi,boolean:L,formatted:Gt,resolvedImage:Sn};return v.type==="array"?li(S[v.value]||Ce,v.length):S[v.type]})(e):void 0,void 0,void 0,i,l,d),_=m.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?tg(new Of(_,e,i,l,d)):uo(m.errors)}class Ma{constructor(e,i,l,d){this.kind=e,this._styleExpression=i,this.isLightConstant=l,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!js(i.expression),this.configDependencies=Ru(i.expression),this.isIndoorDependent=_c(i.expression)}evaluateWithoutErrorHandling(e,i,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,d,m,_)}evaluate(e,i,l,d,m,_,v){return this._styleExpression.evaluate(e,i,l,d,m,_,void 0,void 0,v)}}class ba{constructor(e,i,l,d,m,_){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!js(i.expression),this.isIndoorDependent=_c(i.expression),this.isLightConstant=m,this.isLineProgressConstant=_,this.configDependencies=Ru(i.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,i,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,d,m,_)}evaluate(e,i,l,d,m,_){return this._styleExpression.evaluate(e,i,l,d,m,_)}interpolationFactor(e,i,l){return this.interpolationType?Sr.interpolationFactor(this.interpolationType,e,i,l):0}}function jl(r,e,i,l,d){if((r=xc(r,e,i,l,d)).result==="error")return r;const m=r.value.expression,_=fh(m);if(!_&&!Td(e))return uo([new Is("","data expressions not supported")]);const v=Ur(m,["zoom","pitch","distance-from-center"]);if(!v&&!Jc(e))return uo([new Is("","zoom expressions not supported")]);const S=Ur(m,["measure-light"]);if(!S&&!yc(e))return uo([new Is("","measure-light expression not supported")]);const A=Ur(m,["line-progress"]);if(!A&&!(function(k){return Lf(k.expression,"line-progress")})(e))return uo([new Is("","line-progress expression not supported")]);const D=e.expression&&e.expression.relaxZoomRestriction,P=zf(m);return P||v||D?P instanceof Is?uo([P]):P instanceof Sr&&!_h(e)?uo([new Is("",'"interpolate" expressions cannot be used with this property')]):tg(P?new ba(_&&A?"camera":"composite",r.value,P.labels,P instanceof Sr?P.interpolation:void 0,S,A):new Ma(_&&A?"constant":"source",r.value,S,A)):uo([new Is("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class wh{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,yh(this._parameters,this._specification))}static deserialize(e){return new wh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zf(r){let e=null;if(r instanceof el)e=zf(r.result);else if(r instanceof Xc){for(const i of r.args)if(e=zf(i),e)break}else(r instanceof Fl||r instanceof Sr)&&r.input instanceof ao&&r.input.name==="zoom"&&(e=r);return e instanceof Is||r.eachChild(i=>{const l=zf(i);l instanceof Is?e=l:e&&l&&e!==l&&(e=new Is("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Da,zo,Us=(function(){if(zo)return Da;zo=1,Da=e;var r=3;function e(i,l,d){var m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(l=_[1])+2*(d=_[2]);for(var v=0;v<this.d*this.d;v++){var S=_[r+v],A=_[r+v+1];m.push(S===A?null:_.subarray(S,A))}var D=_[r+m.length+1];this.keys=_.subarray(_[r+m.length],D),this.bboxes=_.subarray(D),this.insert=this._insertReadonly}else{this.d=l+2*d;for(var P=0;P<this.d*this.d;P++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=d,this.scale=l/i,this.uid=0;var k=d/l*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,l,d,m,_){this._forEachCell(l,d,m,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,l,d,m,_,v){this.cells[_].push(v)},e.prototype.query=function(i,l,d,m,_){var v=this.min,S=this.max;if(i<=v&&l<=v&&S<=d&&S<=m&&!_)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,l,d,m,this._queryCell,A,{},_),A},e.prototype._queryCell=function(i,l,d,m,_,v,S,A){var D=this.cells[_];if(D!==null)for(var P=this.keys,k=this.bboxes,F=0;F<D.length;F++){var U=D[F];if(S[U]===void 0){var Z=4*U;(A?A(k[Z+0],k[Z+1],k[Z+2],k[Z+3]):i<=k[Z+2]&&l<=k[Z+3]&&d>=k[Z+0]&&m>=k[Z+1])?(S[U]=!0,v.push(P[U])):S[U]=!1}}},e.prototype._forEachCell=function(i,l,d,m,_,v,S,A){for(var D=this._convertToCellCoord(i),P=this._convertToCellCoord(l),k=this._convertToCellCoord(d),F=this._convertToCellCoord(m),U=D;U<=k;U++)for(var Z=P;Z<=F;Z++){var Q=this.d*Z+U;if((!A||A(this._convertFromCellCoord(U),this._convertFromCellCoord(Z),this._convertFromCellCoord(U+1),this._convertFromCellCoord(Z+1)))&&_.call(this,i,l,d,m,Q,v,S,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,l=r+this.cells.length+1+1,d=0,m=0;m<this.cells.length;m++)d+=this.cells[m].length;var _=new Int32Array(l+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=l,S=0;S<i.length;S++){var A=i[S];_[r+S]=v,_.set(A,v),v+=A.length}return _[r+i.length]=v,_.set(this.keys,v),_[r+i.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},Da})(),vc=Va(Us);const _l={};function Ft(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),_l[e]={klass:r,omit:i.omit||[]}}Ft(Object,"Object"),vc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},vc.deserialize=function(r){return new vc(r.buffer)},Object.defineProperty(vc,"name",{value:"Grid"}),Ft(vc,"Grid"),delete Dt.prototype.constructor,Ft(Ei,"Color"),Ft(Error,"Error"),Ft(Ms,"Formatted"),Ft(lc,"FormattedSection"),Ft(Ml,"AJAXError"),Ft(so,"ResolvedImage"),Ft(wh,"StylePropertyFunction"),Ft(Of,"StyleExpression",{omit:["_evaluator"]}),Ft(Vs,"ImageId"),Ft(Ys,"ImageVariant"),Ft(ba,"ZoomDependentExpression"),Ft(Ma,"ZoomConstantExpression"),Ft(ao,"CompoundExpression",{omit:["_evaluate"]});for(const r in Iu)_l[Iu[r]._classRegistryKey]||Ft(Iu[r],`Expression${r}`);function Gr(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function qr(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Gr(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const l of r)i.push(qr(l,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[l,d]of r.entries())i.entries.push(qr(l),qr(d,e));return i}if(r instanceof Set){const i={$name:"Set"};let l=0;for(const d of r.values())i[++l]=qr(d);return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,l=i._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const d=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const m in r)r.hasOwnProperty(m)&&(_l[l].omit.indexOf(m)>=0||(d[m]=qr(r[m],e)));r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(d.$name=l),d}throw new Error("can't serialize object of type "+typeof r)}function yl(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Gr(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(yl);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const d=r.entries||[],m=new Map;for(let _=0;_<d.length;_+=2)m.set(yl(d[_]),yl(d[_+1]));return m}if(e==="Set"){const d=new Set;for(const m of Object.keys(r))m!=="$name"&&d.add(yl(r[m]));return d}if(e==="BigInt")return BigInt(r.value);const{klass:i}=_l[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const l=Object.create(i.prototype);for(const d of Object.keys(r))d!=="$name"&&(l[d]=yl(r[d]));return l}throw new Error("can't deserialize object of type "+typeof r)}const Th=r=>r>=1536&&r<=1791,Mu=r=>r>=1872&&r<=1919,Eh=r=>r>=2208&&r<=2303,Du=r=>r>=11904&&r<=12031,Pu=r=>r>=12032&&r<=12255,ng=r=>r>=12272&&r<=12287,is=r=>r>=12288&&r<=12351,ku=r=>r>=12352&&r<=12447,Sh=r=>r>=12448&&r<=12543,Ul=r=>r>=12544&&r<=12591,ig=r=>r>=12704&&r<=12735,C_=r=>r>=12736&&r<=12783,Vp=r=>r>=12784&&r<=12799,jp=r=>r>=12800&&r<=13055,Nf=r=>r>=13056&&r<=13311,Ks=r=>r>=13312&&r<=19903,xs=r=>r>=19968&&r<=40959,Sd=r=>r>=40960&&r<=42127,Lu=r=>r>=42128&&r<=42191,Bf=r=>r>=44032&&r<=55215,Up=r=>r>=63744&&r<=64255,Gl=r=>r>=64336&&r<=65023,Ff=r=>r>=65040&&r<=65055,Vf=r=>r>=65072&&r<=65103,Gp=r=>r>=65104&&r<=65135,qp=r=>r>=65136&&r<=65279,Hp=r=>r>=65280&&r<=65519;function $p(r){for(const e of r)if(bc(e.charCodeAt(0)))return!0;return!1}function R_(r){for(const e of r)if(!M_(e.charCodeAt(0)))return!1;return!0}function M_(r){return!(Th(r)||Mu(r)||Eh(r)||Gl(r)||qp(r))}function rg(r){return!(r<11904||!(ig(r)||Ul(r)||Vf(r)||Up(r)||Nf(r)||Du(r)||C_(r)||is(r)||Ks(r)||xs(r)||jp(r)||Hp(r)||ku(r)||ng(r)||Pu(r)||Vp(r)||Sh(r)||Ff(r)||Lu(r)||Sd(r)))}function bc(r){return!(r!==746&&r!==747&&(r<4352||!(ig(r)||Ul(r)||Vf(r)&&!(r>=65097&&r<=65103)||Up(r)||Nf(r)||Du(r)||C_(r)||!(!is(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ks(r)||xs(r)||jp(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||Bf(r)||ku(r)||ng(r)||(e=>e>=12688&&e<=12703)(r)||Pu(r)||Vp(r)||Sh(r)&&r!==12540||!(!Hp(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Gp(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Ff(r)||(e=>e>=19904&&e<=19967)(r)||Sd(r)||Lu(r))))}function sg(r){return r===12312||r===12313||r===12316||r===12540||r===12448}function ag(r){return!(bc(r)||(function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||is(e)||Sh(e)||(i=>i>=57344&&i<=63743)(e)||Vf(e)||Gp(e)||Hp(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function jf(r){return Th(r)||Mu(r)||Eh(r)||Gl(r)||qp(r)}function og(r){return r>=1424&&r<=2303||Gl(r)||qp(r)}function D_(r,e){return!(!e&&og(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(i=>i>=6016&&i<=6143)(r))}function wc(r){for(const e of r)if(og(e.charCodeAt(0)))return!0;return!1}const Za={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let tu=null,Pa=Za.unavailable,nu=null;const lg=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Pa=Za.error),tu&&tu(r)};function cg(){Zp.fire(new Mo("pluginStateChange",{pluginStatus:Pa,pluginURL:nu}))}const Zp=new pl,Ou=function(){return Pa},Wp=function(){if(Pa!==Za.deferred||!nu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pa=Za.loading,cg(),nu&&Nc({url:nu},r=>{r?lg(r):(Pa=Za.loaded,cg())})},No={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pa===Za.loaded||No.applyArabicShaping!=null,isLoading:()=>Pa===Za.loading,setState(r){Pa=r.pluginStatus,nu=r.pluginURL},isParsing:()=>Pa===Za.parsing,isParsed:()=>Pa===Za.parsed,getPluginURL:()=>nu};class Mi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,l){for(const d of i)if(!D_(d.charCodeAt(0),l))return!1;return!0})(e,No.isLoaded())}}class Ad{constructor(e,i,l,d,m){this.property=e,this.value=i,this.expression=(function(_,v,S,A,D){if(Ed(_))return new wh(_,v);if(bh(_)||Array.isArray(_)&&_.length>0){const P=jl(_,v,S,A,D);if(P.result==="error")throw new Error(P.value.map(k=>`${k.key}: ${k.message}`).join(", "));return P.value}{let P=_;return typeof _=="string"&&v.type==="color"&&(P=Ei.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}})(i===void 0?e.specification.default:i,e.specification,l,d,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l,d){return this.property.possiblyEvaluate(this,e,i,l,d)}}class Ah{constructor(e,i,l,d){this.property=e,this.value=new Ad(e,void 0,i,l,d)}transitioned(e,i){return new ug(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new ug(this.property,this.value,null,{},0)}}class Id{constructor(e,i,l,d){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ln(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ah(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Ad(this._values[e].property,i===null?void 0:Ln(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const l=this._properties.properties;if(e)for(const d in e){const m=e[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);l[_]&&this.setTransition(_,m)}else l.hasOwnProperty(d)&&this.setValue(d,m)}}getTransition(e){return Ln(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ah(this._values[e].property)),this._values[e].transition=Ln(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const d=this.getTransition(i);d!==void 0&&(e[`${i}-transition`]=d)}return e}transitioned(e,i){const l=new hg(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,i._values[d]);return l}untransitioned(){const e=new hg(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class ug{constructor(e,i,l,d,m){const _=d.delay||0,v=d.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+_,this.end=this.begin+v,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const d=e.now||0,m=this.value.possiblyEvaluate(e,i,l),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(e,i,l);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,l),m,oe(v))}}return m}}class hg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const d=new ka(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,i,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xp{constructor(e,i,l,d){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ln(this._values[e].value)}setValue(e,i){this._values[e]=new Ad(this._values[e].property,i===null?void 0:Ln(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l,d){const m=new ka(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(e,i,l,d);return m}isIndoorDependent(){return this._isIndoorDependent}}class zu{constructor(e,i,l,d){this.property=e,this.value=i,this.parameters=l,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,d){return this.property.evaluate(this.value,this.parameters,e,i,l,d,this.iconImageUseTheme)}}class ka{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const d=oc[this.specification.type];return d?d(e,i,l):e}}class Xt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,d,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new zu(this,{kind:"constant",value:e.expression.evaluate(i,null,{},l,d,void 0,m)},i):new zu(this,e.expression,i,m)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new zu(this,{kind:"constant",value:void 0},e.parameters);const d=oc[this.specification.type];return d?new zu(this,{kind:"constant",value:d(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,d,m,_,v){return e.kind==="constant"?e.value:e.evaluate(i,l,d,m,_,void 0,v)}}class Ih{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,d){return!!e.expression.evaluate(i,null,{},l,d)}interpolate(){return!1}}class br{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Mi(0,{});for(const l in e){const d=e[l];d.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new Ad(d,void 0),_=this.defaultTransitionablePropertyValues[l]=new Ah(d);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(i)}}}Ft(Xt,"DataDrivenProperty"),Ft(Nt,"DataConstantProperty"),Ft(Ih,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function dg(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Yp(r){if(Array.isArray(r))return r.map(Yp);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Yp(r[i]);return e}return dg(r)}function Uf(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Uf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Kp(r,e="",i=null,l="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Uf(r)||(r=Cd(r));const d=r;let m=!0;try{m=(function(D){if(!Ch(D))return D;let P=Yp(D);return Gf(P),P=fg(P),P})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=We[`filter_${l}`];const D=xc(m,v,e,i);if(D.result==="error")throw new Error(D.value.map(P=>`${P.key}: ${P.message}`).join(", "));_=(P,k,F)=>D.value.evaluate(P,k,{},F)}let S=null,A=null;if(m!==d){const D=xc(d,v,e,i);if(D.result==="error")throw new Error(D.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,k,F,U,Z)=>D.value.evaluate(P,k,{},F,void 0,void 0,U,Z),A=!fh(D.value.expression)}return{filter:_,dynamicFilter:S||void 0,needGeometry:pg(m),needFeature:!!A}}function fg(r){if(!Array.isArray(r))return r;const e=(function(i){if(P_.has(i[0])){for(let l=1;l<i.length;l++)if(Ch(i[l]))return!0}return i})(r);return e===!0?e:e.map(i=>fg(i))}function Gf(r){let e=!1;const i=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)e=e||Ch(r[l]),i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Ch(r[1]);for(let l=2;l<r.length-1;l+=2)i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Ch(r[1]);for(let l=1;l<r.length-1;l+=2)i.push(r[l+1])}e&&(r.length=0,r.push("any",...i));for(let l=1;l<r.length;l++)Gf(r[l])}function Ch(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Ch(r[i]))return!0;return!1}const P_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function nx(r,e){return r<e?-1:r>e?1:0}function pg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(pg(r[e]))return!0;return!1}function Cd(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Bo(r[1],r[2],"=="):e==="!="?$f(Bo(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bo(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Cd))):e==="all"?["all"].concat(r.slice(1).map(Cd)):e==="none"?["all"].concat(r.slice(1).map(Cd).map($f)):e==="in"?qf(r[1],r.slice(2)):e==="!in"?$f(qf(r[1],r.slice(2))):e==="has"?Hf(r[1]):e!=="!has"||$f(Hf(r[1]));var i}function Bo(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function qf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(nx)]]:["filter-in-small",r,["literal",e]]}}function Hf(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function $f(r){return["!",r]}const Rd="";function ql(r,e){return e?`${r}${Rd}${e}`:r}let Qp;const Zf=()=>Qp||(Qp=new br({"icon-size":new Xt(We.layout_symbol["icon-size"]),"icon-image":new Xt(We.layout_symbol["icon-image"]),"icon-rotate":new Xt(We.layout_symbol["icon-rotate"]),"icon-offset":new Xt(We.layout_symbol["icon-offset"]),"text-size":new Xt(We.layout_symbol["text-size"]),"text-rotate":new Xt(We.layout_symbol["text-rotate"]),"text-offset":new Xt(We.layout_symbol["text-offset"])}));class mg{constructor(e,i,l,d,m,_){const v=xc(e,We.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,l){this.properties=new ka(Zf()),this.unevaluatedLayout=new Xp(Zf(),d,m,_);for(const S in l)this.unevaluatedLayout.setValue(S,l[S])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),l=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return e||i||l||d}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),l=this.hasProperty("text-rotate");return e||i||l}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Jp="-transition",em=new Set(["fill","line","background","hillshade","raster"]);class La extends pl{constructor(e,i,l,d,m,_){if(super(),this.id=e.id,this.fqid=ql(this.id,l),this.type=e.type,this.scope=l,this.lut=d,this.options=m,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=xc(this.filter,We[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Xp(i.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Id(i.paint,this.scope,m);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ka(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&em.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new mg(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Jp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const l=this._transitionablePaint,d=l._properties.properties;if(e.endsWith(Jp)){const P=e.slice(0,-11);return d[P]&&l.setTransition(P,i||void 0),!1}if(!d[e])return!1;const m=l._values[e],_=m.value.isDataDriven(),v=m.value;l.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const S=l._values[e].value,A=S.isDataDriven(),D=e.endsWith("pattern")||e==="line-dasharray";return A||_||D||this._handleOverridablePaintPropertyUpdate(e,v,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,l){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),bn(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof zu&&Td(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!js(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Kp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,l){return{}}queryRadius(e){}queryIntersectsFeature(e,i,l,d,m,_,v,S,A,D){}}const gg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fo{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const k_=new ArrayBuffer(0);class sr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=k_),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ti(r,e=1){let i=0,l=0;return{members:r.map(d=>{const m=gg[d.type].BYTES_PER_ELEMENT,_=i=Wf(i,Math.max(e,m)),v=d.components||1;return l=Math.max(l,m),i+=m*v,{name:d.name,type:d.type,components:v,offset:_}}),size:Wf(i,Math.max(l,e)),alignment:e}}function Wf(r,e){return Math.ceil(r/e)*e}class iu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.int16[d+0]=i,this.int16[d+1]=l,e}}iu.prototype.bytesPerElement=4,Ft(iu,"StructArrayLayout2i4");class Hl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=d,e}}Hl.prototype.bytesPerElement=6,Ft(Hl,"StructArrayLayout3i6");class Tc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=l,this.int16[_+2]=d,this.int16[_+3]=m,e}}Tc.prototype.bytesPerElement=8,Ft(Tc,"StructArrayLayout4i8");class Gs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Gs.prototype.bytesPerElement=4,Ft(Gs,"StructArrayLayout1f4");class Md extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=4*e,_=2*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.float32[_+1]=d,e}}Md.prototype.bytesPerElement=8,Ft(Md,"StructArrayLayout2i1f8");class Xf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=d,e}}Xf.prototype.bytesPerElement=8,Ft(Xf,"StructArrayLayout3i8");class Ds extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=l,this.int16[v+2]=d,this.int16[v+3]=m,this.int16[v+4]=_,e}}Ds.prototype.bytesPerElement=10,Ft(Ds,"StructArrayLayout5i10");class oa extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=6*e,D=12*e,P=3*e;return this.int16[A+0]=i,this.int16[A+1]=l,this.uint8[D+4]=d,this.uint8[D+5]=m,this.uint8[D+6]=_,this.uint8[D+7]=v,this.float32[P+2]=S,e}}oa.prototype.bytesPerElement=12,Ft(oa,"StructArrayLayout2i4ub1f12");class tl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=d,e}}tl.prototype.bytesPerElement=12,Ft(tl,"StructArrayLayout3f12");class $l extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=6*e,S=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=l,this.uint16[v+2]=d,this.uint16[v+3]=m,this.float32[S+2]=_,e}}$l.prototype.bytesPerElement=12,Ft($l,"StructArrayLayout4ui1f12");class Rh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=l,this.uint16[_+2]=d,this.uint16[_+3]=m,e}}Rh.prototype.bytesPerElement=8,Ft(Rh,"StructArrayLayout4ui8");class Mh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.int16[S+2]=d,this.int16[S+3]=m,this.int16[S+4]=_,this.int16[S+5]=v,e}}Mh.prototype.bytesPerElement=12,Ft(Mh,"StructArrayLayout6i12");class Dh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,l,d,m,_,v,S,A,D,P,k)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,F){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=l,this.int16[U+2]=d,this.int16[U+3]=m,this.uint16[U+4]=_,this.uint16[U+5]=v,this.uint16[U+6]=S,this.uint16[U+7]=A,this.int16[U+8]=D,this.int16[U+9]=P,this.int16[U+10]=k,this.int16[U+11]=F,e}}Dh.prototype.bytesPerElement=24,Ft(Dh,"StructArrayLayout4i4ui4i24");class tm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=10*e,A=5*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.int16[S+2]=d,this.float32[A+2]=m,this.float32[A+3]=_,this.float32[A+4]=v,e}}tm.prototype.bytesPerElement=20,Ft(tm,"StructArrayLayout3i3f20");class Zl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=l,this.float32[_+2]=d,this.float32[_+3]=m,e}}Zl.prototype.bytesPerElement=16,Ft(Zl,"StructArrayLayout4f16");class nm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}nm.prototype.bytesPerElement=4,Ft(nm,"StructArrayLayout1ul4");class nl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.uint16[d+0]=i,this.uint16[d+1]=l,e}}nl.prototype.bytesPerElement=4,Ft(nl,"StructArrayLayout2ui4");class Nu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,l,d,m,_,v,S,A,D,P,k,F)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,F,U){const Z=20*e,Q=10*e;return this.int16[Z+0]=i,this.int16[Z+1]=l,this.int16[Z+2]=d,this.int16[Z+3]=m,this.int16[Z+4]=_,this.float32[Q+3]=v,this.float32[Q+4]=S,this.float32[Q+5]=A,this.float32[Q+6]=D,this.int16[Z+14]=P,this.uint32[Q+8]=k,this.uint16[Z+18]=F,this.uint16[Z+19]=U,e}}Nu.prototype.bytesPerElement=40,Ft(Nu,"StructArrayLayout5i4f1i1ul2ui40");class Dd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=l,this.int16[A+2]=d,this.int16[A+4]=m,this.int16[A+5]=_,this.int16[A+6]=v,this.int16[A+7]=S,e}}Dd.prototype.bytesPerElement=16,Ft(Dd,"StructArrayLayout3i2i2i16");class Yf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=4*e,S=8*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=d,this.int16[S+6]=m,this.int16[S+7]=_,e}}Yf.prototype.bytesPerElement=16,Ft(Yf,"StructArrayLayout2f1f2i16");class Kf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=20*e,A=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=l,this.float32[A+1]=d,this.float32[A+2]=m,this.float32[A+3]=_,this.float32[A+4]=v,e}}Kf.prototype.bytesPerElement=20,Ft(Kf,"StructArrayLayout2ub4f20");class vs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,l)}emplace(e,i,l,d){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=d,e}}vs.prototype.bytesPerElement=6,Ft(vs,"StructArrayLayout3ui6");class Ph extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e){const me=this.length;return this.resize(me+1),this.emplace(me,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e,me){const Ee=30*e,Se=15*e,we=60*e;return this.int16[Ee+0]=i,this.int16[Ee+1]=l,this.int16[Ee+2]=d,this.float32[Se+2]=m,this.float32[Se+3]=_,this.uint16[Ee+8]=v,this.uint16[Ee+9]=S,this.uint32[Se+5]=A,this.uint32[Se+6]=D,this.uint32[Se+7]=P,this.uint16[Ee+16]=k,this.uint16[Ee+17]=F,this.uint16[Ee+18]=U,this.float32[Se+10]=Z,this.float32[Se+11]=Q,this.uint8[we+48]=X,this.uint8[we+49]=te,this.uint8[we+50]=se,this.uint32[Se+13]=le,this.int16[Ee+28]=_e,this.uint8[we+58]=me,e}}Ph.prototype.bytesPerElement=60,Ft(Ph,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Bu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e,me,Ee,Se,we,De,Ne,pt,ct,dt,Tt,vt,bt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e,me,Ee,Se,we,De,Ne,pt,ct,dt,Tt,vt,bt)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e,me,Ee,Se,we,De,Ne,pt,ct,dt,Tt,vt,bt,ot){const At=20*e,_t=40*e,Ct=80*e;return this.float32[At+0]=i,this.float32[At+1]=l,this.int16[_t+4]=d,this.int16[_t+5]=m,this.int16[_t+6]=_,this.int16[_t+7]=v,this.int16[_t+8]=S,this.int16[_t+9]=A,this.int16[_t+10]=D,this.int16[_t+11]=P,this.int16[_t+12]=k,this.uint16[_t+13]=F,this.uint16[_t+14]=U,this.uint16[_t+15]=Z,this.uint16[_t+16]=Q,this.uint16[_t+17]=X,this.uint16[_t+18]=te,this.uint16[_t+19]=se,this.uint16[_t+20]=le,this.uint16[_t+21]=_e,this.uint16[_t+22]=me,this.uint16[_t+23]=Ee,this.uint16[_t+24]=Se,this.uint16[_t+25]=we,this.uint16[_t+26]=De,this.uint16[_t+27]=Ne,this.uint32[At+14]=pt,this.float32[At+15]=ct,this.float32[At+16]=dt,this.float32[At+17]=Tt,this.float32[At+18]=vt,this.uint8[Ct+76]=bt,this.uint16[_t+39]=ot,e}}Bu.prototype.bytesPerElement=80,Ft(Bu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Pd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,d,m,_)}emplace(e,i,l,d,m,_,v){const S=6*e;return this.float32[S+0]=i,this.float32[S+1]=l,this.float32[S+2]=d,this.float32[S+3]=m,this.float32[S+4]=_,this.float32[S+5]=v,e}}Pd.prototype.bytesPerElement=24,Ft(Pd,"StructArrayLayout6f24");class Fu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,l,d,m)}emplace(e,i,l,d,m,_){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=d,this.float32[v+3]=m,this.float32[v+4]=_,e}}Fu.prototype.bytesPerElement=20,Ft(Fu,"StructArrayLayout5f20");class kd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=l,this.float32[A+2]=d,this.float32[A+3]=m,this.float32[A+4]=_,this.float32[A+5]=v,this.float32[A+6]=S,e}}kd.prototype.bytesPerElement=28,Ft(kd,"StructArrayLayout7f28");class Ld extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,l,d,m,_,v,S,A,D,P)}emplace(e,i,l,d,m,_,v,S,A,D,P,k){const F=11*e;return this.float32[F+0]=i,this.float32[F+1]=l,this.float32[F+2]=d,this.float32[F+3]=m,this.float32[F+4]=_,this.float32[F+5]=v,this.float32[F+6]=S,this.float32[F+7]=A,this.float32[F+8]=D,this.float32[F+9]=P,this.float32[F+10]=k,e}}Ld.prototype.bytesPerElement=44,Ft(Ld,"StructArrayLayout11f44");class kh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,l,d,m,_,v,S,A)}emplace(e,i,l,d,m,_,v,S,A,D){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=l,this.float32[P+2]=d,this.float32[P+3]=m,this.float32[P+4]=_,this.float32[P+5]=v,this.float32[P+6]=S,this.float32[P+7]=A,this.float32[P+8]=D,e}}kh.prototype.bytesPerElement=36,Ft(kh,"StructArrayLayout9f36");class Vu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const d=2*e;return this.float32[d+0]=i,this.float32[d+1]=l,e}}Vu.prototype.bytesPerElement=8,Ft(Vu,"StructArrayLayout2f8");class Qf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,d)}emplace(e,i,l,d,m){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=l,this.uint16[_+3]=d,this.uint16[_+4]=m,e}}Qf.prototype.bytesPerElement=12,Ft(Qf,"StructArrayLayout1ul3ui12");class Od extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Od.prototype.bytesPerElement=2,Ft(Od,"StructArrayLayout1ui2");class Wl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q){const X=this.length;return this.resize(X+1),this.emplace(X,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q)}emplace(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X){const te=16*e;return this.float32[te+0]=i,this.float32[te+1]=l,this.float32[te+2]=d,this.float32[te+3]=m,this.float32[te+4]=_,this.float32[te+5]=v,this.float32[te+6]=S,this.float32[te+7]=A,this.float32[te+8]=D,this.float32[te+9]=P,this.float32[te+10]=k,this.float32[te+11]=F,this.float32[te+12]=U,this.float32[te+13]=Z,this.float32[te+14]=Q,this.float32[te+15]=X,e}}Wl.prototype.bytesPerElement=64,Ft(Wl,"StructArrayLayout16f64");class Lh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,d,m,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,l,d,m,_,v)}emplace(e,i,l,d,m,_,v,S){const A=10*e,D=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=l,this.uint16[A+2]=d,this.uint16[A+3]=m,this.float32[D+2]=_,this.float32[D+3]=v,this.float32[D+4]=S,e}}Lh.prototype.bytesPerElement=20,Ft(Lh,"StructArrayLayout4ui3f20");class _g extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}_g.prototype.bytesPerElement=2,Ft(_g,"StructArrayLayout1i2");class Jf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Jf.prototype.bytesPerElement=1,Ft(Jf,"StructArrayLayout1ub1");class Ec extends Fo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ec.prototype.size=40;class im extends Nu{get(e){return new Ec(this,e)}}Ft(im,"CollisionBoxArray");class yg extends Fo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}yg.prototype.size=60;class ep extends Ph{get(e){return new yg(this,e)}}Ft(ep,"PlacedSymbolArray");class zd extends Fo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}zd.prototype.size=80;class ds extends Bu{get(e){return new zd(this,e)}}Ft(ds,"SymbolInstanceArray");class tp extends Gs{getoffsetX(e){return this.float32[1*e+0]}}Ft(tp,"GlyphOffsetArray");class L_ extends iu{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(L_,"SymbolLineVertexArray");class xg extends Fo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xg.prototype.size=12;class ru extends Qf{get(e){return new xg(this,e)}}Ft(ru,"FeatureIndexArray");class su extends nl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(su,"FillExtrusionCentroidArray");class rm extends Fo{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}rm.prototype.size=6;class vg extends Hl{get(e){return new rm(this,e)}}Ft(vg,"FillExtrusionWallArray");const Nd=ti([{name:"a_pos",components:2,type:"Int16"}],4),Xl=ti([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),bg=ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,l,d){let m=this.segments[this.segments.length-1];return e>fr.MAX_VERTEX_ARRAY_LENGTH&&kn(`Max vertices per segment is ${fr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>fr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}prepareSegment(e,i,l,d){return this._prepareSegment(e,i.length,l.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,d){return new fr([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function wg(r,e){return 256*(r=xe(Math.floor(r),0,255))+xe(Math.floor(e),0,255)}fr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft(fr,"SegmentVector");const sm=ti([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Tg=ti([{name:"a_pattern_b",components:4,type:"Uint16"}]),am=ti([{name:"a_dash",components:4,type:"Uint16"}]);class Bd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,l,d){this.ids.push(Sc(e)),this.positions.push(i,l,d)}eachPosition(e,i){const l=Sc(e);let d=0,m=this.ids.length-1;for(;d<m;){const _=d+m>>1;this.ids[_]>=l?m=_:d=_+1}for(;this.ids[d]===l;)i(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,i){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Ps(l,d,0,l.length-1),i&&(i.add(l.buffer),i.add(d.buffer)),{ids:l,positions:d}}static deserialize(e){const i=new Bd;let l;i.ids=e.ids,i.positions=e.positions;for(const d of i.ids)d!==l&&i.uniqueIds.push(d),l=d;return i.indexed=!0,i}}function Sc(r){const e=+r;return Number.isSafeInteger(e)?e:ro(String(r))}function Ps(r,e,i,l){for(;i<l;){const d=r[i+l>>1];let m=i-1,_=l+1;for(;;){do m++;while(r[m]<d);do _--;while(r[_]>d);if(m>=_)break;Oh(r,m,_),Oh(e,3*m,3*_),Oh(e,3*m+1,3*_+1),Oh(e,3*m+2,3*_+2)}_-i<l-_?(Ps(r,e,i,_),i=_+1):(Ps(r,e,_+1,l),l=_)}}function Oh(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}Ft(Bd,"FeaturePositionMap");class xl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Hr extends xl{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class fs extends xl{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Vo extends xl{constructor(e){super(e),this.current=[0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Fd extends xl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class rs extends xl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class ho extends xl{constructor(e){super(e),this.current=Ei.transparent.toPremultipliedRenderColor(null)}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const au=new Float32Array(16);class zh extends xl{constructor(e){super(e),this.current=au}set(e,i,l){if(this.fetchUniformLocation(e,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const ix=new Float32Array(9),f=new Float32Array(4);class n extends xl{constructor(e){super(e),this.current=f}set(e,i,l){if(this.fetchUniformLocation(e,i)){for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function c(r){return[wg(255*r.r,255*r.g),wg(255*r.b,255*r.a)]}function p(r,e,i,l,d,m,_,v){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Mi(0,{brightness:m,worldview:v}),e,i,d,l,_)==="none":r.value==="none")}class x{constructor(e,i,l,d){this.value=e,this.uniformNames=i.map(m=>`u_${m}`),this.type=l,this.context=d}setUniform(e,i,l,d,m){const _=d.constantOr(this.value);i.set(e,m,_ instanceof Ei?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new ho(e):new fs(e)}}class b{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,l,d,m){let _=null;m!=="u_pattern"&&m!=="u_dash"||(_=this.pattern),m==="u_pattern_b"&&(_=this.patternTransition),m==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,m,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new rs(e):new fs(e)}}class E{constructor(e,i,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,l,d,m,_,v,S){const A=this.paintVertexArray.length,D=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Mi(0,{brightness:_,worldview:S}),i,{},m,d,v):this.expression.kind==="constant"&&this.expression.value,P=p(this.lutExpression,i,{},d,m,_,v,S);this.paintVertexArray.resize(e),this._setPaintValue(A,e,D,P?null:this.context.lut)}updatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:S},l,d,void 0,m):this.expression.kind==="constant"&&this.expression.value,D=p(this.lutExpression,l,d,m,void 0,v,void 0,S);this._setPaintValue(e,i,A,D?null:this.context.lut)}_setPaintValue(e,i,l,d){if(this.type==="color"){const m=c(l.toPremultipliedRenderColor(d));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class I{constructor(e,i,l,d,m,_){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=d,this.context=m,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.evaluate(new Mi(this.context.zoom,{brightness:_,worldview:S}),i,{},m,d,v),D=this.expression.evaluate(new Mi(this.context.zoom+1,{brightness:_,worldview:S}),i,{},m,d,v),P=p(this.lutExpression,i,{},d,m,_,v,S),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,A,D,P?null:this.context.lut)}updatePaintArray(e,i,l,d,m,_,v,S){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:S},l,d,void 0,m),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:S},l,d,void 0,m),P=p(this.lutExpression,l,d,m,void 0,v,void 0,S);this._setPaintValue(e,i,A,D,P?null:this.context.lut)}_setPaintValue(e,i,l,d,m){if(this.type==="color"){const _=c(l.toPremultipliedRenderColor(m)),v=c(d.toPremultipliedRenderColor(m));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,_[0],_[1],v[0],v[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,d,m){const _=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=xe(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,m,v)}getBinding(e,i){return new fs(e)}}class M{constructor(e,i,l,d,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?am:sm).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Rh}populatePaintArray(e,i,l,d){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,d,m,_,v){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,i,l,d){if(!d||!l)return;const m=d[l[0]],_=d[l[1]];if(m){if(m){const{tl:v,br:S,pixelRatio:A}=m;for(let D=e;D<i;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],A)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:S}=_;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,v[0],v[1],S[0],S[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Tg.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class O{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[],this.context=i;const d=[];for(const m in e.paint._values){const _=e.paint.get(m);if(m.endsWith("-use-theme")||!l(m)||!(_ instanceof zu&&Td(_.property.specification)))continue;const v=G(m,e.type),S=_.value,A=_.property.specification.type,D=!!_.property.useIntegerZoom,P=m==="line-dasharray"||m.endsWith("pattern"),k=e.paint.get(`${m}-use-theme`),F=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(S.kind!=="constant"||F)if(S.kind==="source"||F||P){const U=K(m,A,"source");this.binders[m]=P?new M(S,v,A,U,e.id):new E(S,v,A,U),d.push(`/a_${m}`)}else{const U=K(m,A,"composite");this.binders[m]=new I(S,v,A,D,i,U),d.push(`/z_${m}`)}else this.binders[m]=P?new b(S.value,v):new x(S.value,v,A,i),d.push(`/u_${m}`);k&&(this.binders[m].lutExpression=k.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof E||i instanceof I?i.maxValue:0}populatePaintArrays(e,i,l,d,m,_,v,S){for(const A in this.binders){const D=this.binders[A];D.context=this.context,(D instanceof E||D instanceof I||D instanceof M)&&D.populatePaintArray(e,i,l,d,m,_,v,S)}}setConstantPatternPositions(e,i){for(const l in this.binders){const d=this.binders[l];d instanceof b&&d.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof M?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,l,d,m,_,v,S,A,D){let P=!1;const k=Object.keys(e),F=k.length!==0&&!S,U=F?k:i.uniqueIds;this.context.lut=m.lut;for(const Z in this.binders){const Q=this.binders[Z];if(Q.context=this.context,(Q instanceof E||Q instanceof I||Q instanceof M)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const X=m.paint.get(Z);Q.expression=X.value;for(const te of U){const se=e[te.toString()];i.eachPosition(te,(le,_e,me)=>{const Ee=d.feature(le);Q.updatePaintArray(_e,me,Ee,se,_,v,A,D)})}if(!F)for(const te of l.uniqueIds){const se=e[te.toString()];l.eachPosition(te,(le,_e,me)=>{const Ee=d.feature(le);Q.updatePaintArray(_e,me,Ee,se,_,v,A,D)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof x||l instanceof b)&&e.push(...l.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof x||d instanceof b||d instanceof I)for(const m of d.uniformNames)i.push({name:m,property:l,binding:d.getBinding(e,m)})}return i}setUniforms(e,i,l,d,m){for(const{name:_,property:v,binding:S}of l)this.binders[v].setUniform(e,S,m,d.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof E||i instanceof I||i instanceof M)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof M&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof E||l instanceof I||l instanceof M)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof E||i instanceof I||i instanceof M)&&i.destroy()}}}class z{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new O(d,i,l);this.needsUpload=!1,this._featureMap=new Bd,this._featureMapWithoutIds=new Bd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,l,d,m,_,v,S,A){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,i,d,m,_,v,S,A);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,d,m,_,v,S){for(const A of l)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,d,m,_,v||0,S)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const H={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function G(r,e){return H[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const $={"line-pattern":{source:$l,composite:$l},"fill-pattern":{source:$l,composite:$l},"fill-extrusion-pattern":{source:$l,composite:$l},"line-dasharray":{source:Rh,composite:Rh}},J={color:{source:Vu,composite:Zl},number:{source:Gs,composite:Vu}};function K(r,e,i){const l=$[r];return l&&l[i]||J[e][i]}Ft(x,"ConstantBinder"),Ft(b,"PatternConstantBinder"),Ft(E,"SourceExpressionBinder"),Ft(M,"PatternCompositeBinder"),Ft(I,"CompositeExpressionBinder"),Ft(O,"ProgramConfiguration",{omit:["_buffers"]}),Ft(z,"ProgramConfigurationSet");const ee=jt/Math.PI/2,re=64,pe=[re,32,16],fe=-ee,ue=ee;function Ie(r,e,i,l=ee){return i=oi(i),[r*Math.sin(i)*l,-e*l,r*Math.cos(i)*l]}function Te(r,e,i){return Ie(Math.cos(oi(r)),Math.sin(oi(r)),e,i)}const Ae=63710088e-1,be=2*Math.PI*Ae;class ge{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ge(st(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,d=e.lat*i,m=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*i);return Ae*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new ke({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(e){return Te(this.lat,this.lng,ee+e*ee/Ae)}static convert(e){if(e instanceof ge)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ge(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ge(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ke{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}setSouthWest(e){return this._sw=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}extend(e){const i=this._sw,l=this._ne;let d,m;if(e instanceof ge)d=e,m=e;else{if(!(e instanceof ke))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ke.convert(e)):this.extend(ge.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ge.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return i||l?(i.lng=Math.min(d.lng,i.lng),i.lat=Math.min(d.lat,i.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new ge(d.lng,d.lat),this._ne=new ge(m.lng,m.lat)),this}getCenter(){return new ge((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ge(this.getWest(),this.getNorth())}getSouthEast(){return new ge(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=ge.convert(e);let d=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){if(e)return e instanceof ke?e:new ke(e)}}function ze(r){return be*Math.cos(r*Math.PI/180)}function je(r){return(180+r)/360}function Xe(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Ze(r,e){return r/ze(e)}function ut(r){return 360*r-180}function xt(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function et(r,e){return r*ze(xt(e))}const Le=85.051129;function mt(r){return Math.cos(oi(xe(r,-85.051129,Le)))}function rt(r,e){const i=xe(e,0,25.5),l=Math.pow(2,i);return mt(r)*be/(512*l)}function yt(r){return 1/Math.cos(r*Math.PI/180)}function kt(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/jt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/jt/(1<<r.z)}class qt{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=ge.convert(e);return new qt(je(l.lng),Xe(l.lat),Ze(i,l.lat))}toLngLat(){return new ge(ut(this.x),xt(this.y))}toAltitude(){return et(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/be*yt(xt(this.y))}}function zt(r,e,i,l,d,m,_,v,S){const A=(e+l)/2,D=(i+d)/2,P=new Dt(A,D);v(P),(function(k,F,U,Z,Q,X){const te=U-Q,se=Z-X;return Math.abs((Z-F)*te-(U-k)*se)/Math.hypot(te,se)})(P.x,P.y,m.x,m.y,_.x,_.y)>=S?(zt(r,e,i,A,D,m,P,v,S),zt(r,A,D,l,d,P,_,v,S)):r.push(_)}function Lt(r,e,i){let l=r[0],d=l.x,m=l.y;e(l);const _=[l];for(let v=1;v<r.length;v++){const S=r[v],{x:A,y:D}=S;e(S),zt(_,d,m,A,D,l,S,e,i),d=A,m=D,l=S}return _}function un(r,e,i,l){if(l(e,i)){const d=e.add(i)._mult(.5);un(r,e,d,l),un(r,d,i,l)}else r.push(i)}function an(r,e){let i=r[0];const l=[i];for(let d=1;d<r.length;d++){const m=r[d];un(l,i,m,e),i=m}return l}const Zt=Math.pow(2,14)-1,on=-Zt-1;function xn(r,e){const i=Math.round(r.x*e),l=Math.round(r.y*e);return r.x=xe(i,on,Zt),r.y=xe(l,on,Zt),(i<r.x||i>r.x+1||l<r.y||l>r.y+1)&&kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Dn(r,e,i){const l=r.loadGeometry(),d=r.extent,m=jt/d;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:S,y:A,projection:D}=i,P=k=>{const F=ut((e.x+k.x/d)/_),U=xt((e.y+k.y/d)/_),Z=D.project(F,U);k.x=(Z.x*v-S)*d,k.y=(Z.y*v-A)*d};for(let k=0;k<l.length;k++)if(r.type!==1)l[k]=Lt(l[k],P,1);else{const F=[];for(const U of l[k])U.x<0||U.x>=d||U.y<0||U.y>=d||(P(U),F.push(U));l[k]=F}}for(const _ of l)for(const v of _)xn(v,m);return l}function jn(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Dn(r):[]}}class ni{constructor(e,i,l,d,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=m,e.readFields(Pn,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,l=[];let d,m=1,_=0,v=0,S=0;for(;e.pos<i;){if(_<=0){const A=e.readVarint();m=7&A,_=A>>3}if(_--,m===1||m===2)v+=e.readSVarint(),S+=e.readSVarint(),m===1&&(d&&l.push(d),d=[]),d&&d.push(new Dt(v,S));else{if(m!==7)throw new Error(`unknown command ${m}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let l=1,d=0,m=0,_=0,v=1/0,S=-1/0,A=1/0,D=-1/0;for(;e.pos<i;){if(d<=0){const P=e.readVarint();l=7&P,d=P>>3}if(d--,l===1||l===2)m+=e.readSVarint(),_+=e.readSVarint(),m<v&&(v=m),m>S&&(S=m),_<A&&(A=_),_>D&&(D=_);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,A,S,D]}toGeoJSON(e,i,l){const d=this.extent*Math.pow(2,l),m=this.extent*e,_=this.extent*i,v=this.loadGeometry();function S(k){return[360*(k.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+_)/d)*Math.PI))-90]}function A(k){return k.map(S)}let D;if(this.type===1){const k=[];for(const U of v)k.push(U[0]);const F=A(k);D=k.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const k=v.map(A);D=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=(function(U){const Z=U.length;if(Z<=1)return[U];const Q=[];let X,te;for(let se=0;se<Z;se++){const le=Un(U[se]);le!==0&&(te===void 0&&(te=le<0),te===le<0?(X&&Q.push(X),X=[U[se]]):X&&X.push(U[se]))}return X&&Q.push(X),Q})(v),F=[];for(const U of k)F.push(U.map(A));D=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const P={type:"Feature",geometry:D,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function Pn(r,e,i){r===1?e.id=i.readVarint():r===2?(function(l,d){const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=d._keys[l.readVarint()],v=d._values[l.readVarint()];d.properties[_]=v}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function Un(r){let e=0;for(let i,l,d=0,m=r.length,_=m-1;d<m;_=d++)i=r[d],l=r[_],e+=(l.x-i.x)*(i.y+l.y);return e}ni.types=["Unknown","Point","LineString","Polygon"];class Nn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new ni(this._pbf,i,this.extent,this._keys,this._values)}}function bi(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(l){let d=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=l.readVarint()>>3;d=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(i))}class pi{constructor(e,i){this.layers=e.readFields(Di,{},i)}}function Di(r,e,i){if(r===3){const l=new Nn(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}const ci="3d_elevation_id",Gn="level";class _i{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,l){return this.get(e,!0,i,l)}optional(e,i,l){return this.get(e,!1,i,l)}success(){return this._valid}get(e,i,l,d){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?l(d?d(m):m):i&&(this._valid=!1),this}}class pr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,l){return this.featureFunc(e,i,l)}parseVertex(e,i,l){return this.vertexFunc(e,i,l)}}const Pi=new pr((r,e,i)=>r.reset(e).require(ci,l=>{i.id=l}).optional("fixed_height_relative",l=>{i.constantHeight=l},Fn.decodeRelativeHeight).geometry(l=>{i.bounds=l},Ll).success(),(r,e,i)=>r.reset(e).require(ci,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height_relative",l=>{i.height=l},Fn.decodeRelativeHeight).geometry(l=>{i.position=l},Fn.getPoint).success()),Si=new pr((r,e,i)=>r.reset(e).require(ci,l=>{i.id=l}).optional("fixed_height",l=>{i.constantHeight=l},Fn.decodeMetricHeight).geometry(l=>{i.bounds=l},Ll).success(),(r,e,i)=>r.reset(e).require(ci,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height",l=>{i.height=l},Fn.decodeMetricHeight).geometry(l=>{i.position=l},Fn.getPoint).success());class Fn{static getPoint(e){return Fi(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Si:void 0:Pi}static parse(e){const i=[],l=[],d=e.length,m=new _i;for(let _=0;_<d;_++){const v=e.feature(_),S=v.properties.version,A=Fn.getVersionSchema(S);if(A===void 0){kn(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const D=v.properties.type;if(!D)continue;const P=ni.types[v.type];if(P==="Point"&&D==="curve_point"){const k={};A.parseVertex(m,v,k)&&i.push(k)}else if(P==="Polygon"&&D==="curve_meta"){const k={};A.parseFeature(m,v,k)&&l.push(k)}}return{vertices:i,features:l}}}class Hn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const d=Vi(i,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/d;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,!0}}class Ki{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const d=Ni(i,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/d;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,i,l){if((function(F,U){var Z=F[0],Q=F[1],X=F[2],te=U[0],se=U[1],le=U[2];return Math.abs(Z-te)<=V*Math.max(1,Math.abs(Z),Math.abs(te))&&Math.abs(Q-se)<=V*Math.max(1,Math.abs(Q),Math.abs(se))&&Math.abs(X-le)<=V*Math.max(1,Math.abs(X),Math.abs(le))})(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[d,m,_]=this.dir,v=this.pos[0]-e[0],S=this.pos[1]-e[1],A=this.pos[2]-e[2],D=d*d+m*m+_*_,P=2*(v*d+S*m+A*_),k=P*P-4*D*(v*v+S*S+A*A-i*i);if(k<0){const F=Math.max(-P/2,0),U=v+d*F,Z=S+m*F,Q=A+_*F,X=Math.hypot(U,Z,Q);return l[0]=U*i/X,l[1]=Z*i/X,l[2]=Q*i/X,!1}{const F=(-P-Math.sqrt(k))/(2*D);if(F<0){const U=Math.hypot(v,S,A);return l[0]=v*i/U,l[1]=S*i/U,l[2]=A*i/U,!1}return l[0]=v+d*F,l[1]=S+m*F,l[2]=A+_*F,!0}}}class Lr{constructor(e,i,l,d,m){this.TL=e,this.TR=i,this.BR=l,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(e,i,l){const d=[-1,1,1],m=[1,1,1],_=[1,-1,1],v=[-1,-1,1],S=Cn(d,d,e),A=Cn(m,m,e),D=Cn(_,_,e),P=Cn(v,v,e);return new Lr(S,A,D,P,i/l)}}function Bi(r,e,i){let l=1/0,d=-1/0;const m=[];for(const _ of r){tr(m,_,e);const v=Ni(m,i);l=Math.min(l,v),d=Math.max(d,v)}return[l,d]}function Qi(r,e){let i=!0;for(let l=0;l<r.planes.length;l++){const d=r.planes[l];let m=0;for(let _=0;_<e.length;_++)m+=+(Ni(d,e[_])+d[3]>=0);if(m===0)return 0;m!==e.length&&(i=!1)}return i?2:1}function wa(r,e){for(const i of r.projections){const l=Bi(e,r.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function Qs(r,e){let i=0;const l=[0,0,0,0];for(let d=0;d<r.length;d++)l[0]=r[d][0],l[1]=r[d][1],l[2]=r[d][2],l[3]=1,jr(l,e)>=0&&i++;return i}class ks{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ai.fromPoints(this.points),this.projections=[],this.frustumEdges=[tr([],this.points[2],this.points[3]),tr([],this.points[0],this.points[3]),tr([],this.points[4],this.points[0]),tr([],this.points[5],this.points[1]),tr([],this.points[6],this.points[2]),tr([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const d=[0,-l[2],l[1]],m=[l[2],0,-l[0]];this.projections.push({axis:d,projection:Bi(this.points,this.points[0],d)}),this.projections.push({axis:m,projection:Bi(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,i,l,d){const m=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const D=bs([],A,e),P=1/D[3]/i*m;return(k=D)[0]=(F=D)[0]*(U=[P,P,d?1/D[3]:P,P])[0],k[1]=F[1]*U[1],k[2]=F[2]*U[2],k[3]=F[3]*U[3],k;var k,F,U}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const D=qn([],Vr([],tr([],_[A[0]],_[A[1]]),tr([],_[A[2]],_[A[1]]))),P=-Ni(D,_[A[1]]);return D.concat(P)}),S=[];for(let A=0;A<_.length;A++)S.push([_[A][0],_[A][1],_[A][2]]);return new ks(S,v)}intersectsPrecise(e,i,l){for(let d=0;d<i.length;d++)if(!Qs(e,i[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Qs(e,this.planes[d]))return 0;for(const d of l)for(const m of this.frustumEdges){const _=Vr([],d,m),v=dn(_);if(v===0)continue;Be(_,_,1/v);const S=Bi(this.points,this.points[0],_),A=Bi(e,this.points[0],_);if(S[0]>A[1]||A[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const l=i[3];if(Ni([i[0],i[1],i[2]],e)+l<0)return!1}return!0}}class Ai{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const d of e)ft(i,i,d),Qt(l,l,d);return new Ai(i,l)}static fromTileIdAndHeight(e,i,l){const d=1<<e.canonical.z,m=e.canonical.x,_=e.canonical.y;return new Ai([m/d,_/d,i],[(m+1)/d,(_+1)/d,l])}static applyTransform(e,i){const l=e.getCorners();for(let d=0;d<l.length;++d)Cn(l[d],l[d],i);return Ai.fromPoints(l)}static applyTransformFast(e,i){const l=[i[12],i[13],i[14]],d=[...l];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const v=i[4*_+m],S=v*e.min[_],A=v*e.max[_];l[m]+=Math.min(S,A),d[m]+=Math.max(S,A)}return new Ai(l,d)}static projectAabbCorners(e,i){const l=e.getCorners();for(let d=0;d<l.length;++d)Cn(l[d],l[d],i);return l}constructor(e,i){this.min=e,this.max=i,this.center=Be([],wn([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=Ht(this.min),d=Ht(this.max);for(let m=0;m<i.length;m++)l[m]=i[m]?this.min[m]:this.center[m],d[m]=i[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Ai(l,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Qi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Qi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?wa(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?wa(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ft(Ai,"Aabb");class fo{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,l=i[1],d=-i[0],m=(e.extent+1)*this.metersToTile;return[new Dt(Math.trunc(e.position[0]+l*m),Math.trunc(e.position[1]+d*m)),new Dt(Math.trunc(e.position[0]-l*m),Math.trunc(e.position[1]-d*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Js{constructor(e,i,l,d,m,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[mr(),mr(),mr(),mr(),mr(),mr(),mr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=i,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((S=this.vertices[v.a].position)[0]===(A=this.vertices[v.b].position)[0]&&S[1]===A[1]);var S,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Fi(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const S=this.vertices[v.a].position,A=this.vertices[v.b].position,D=cl(mr(),A,S),P=bo(D),k=Ia(mr(),D,1/P);this.edgeProps.push({vec:D,dir:k,len:P});const F=this.vertexProps[v.a].dir,U=this.vertexProps[v.b].dir;ws(F,F,k),ws(U,U,k)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||gs(v.dir,v.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[l,d]=i;return Rn(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,d)}computeSlopeNormal(e,i){const l=this.getClosestEdge(e);if(!l)return wt(0,0,1);const d=l[0],m=this.edges[d],_=this.edgeProps[d].vec,v=wt(_[0],_[1],(this.vertices[m.b].height-this.vertices[m.a].height)*i),S=wt(v[1],-v[0],0);Vr(S,S,v);const A=dn(S);return A>0?Be(S,S,1/A):Kt(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,l=Number.POSITIVE_INFINITY,d=0;const[m,_,v,S,A,D,P]=this._tmpVec2;ia(P,e.x,e.y);const k=new Hn(P,null);for(let F=0;F<this.edges.length;F++){const U=this.edges[F],Z=this.edgeProps[F].dir;k.dir=Z;const Q=this.vertices[U.a].position,X=this.vertices[U.b].position,te=k.intersectsPlane(Q,this.vertexProps[U.a].dir,m),se=k.intersectsPlane(X,this.vertexProps[U.b].dir,_);if(!te||!se)continue;cl(v,_,m),cl(S,P,m);const le=Vi(v,v),_e=le>0?Vi(S,v)/le:0,me=xe(_e,0,1),Ee=Math.abs((_e-me)*this.edgeProps[F].len);cl(A,P,Q),ia(D,Z[1],-Z[0]);const Se=Ee+Math.abs(Vi(A,D));Se<l&&(i=F,l=Se,d=me)}return[i,d]}tessellate(e){const i=ve(),l=ve(),d=ve(),m=ve();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,S=this.edges[_].b,{position:A,height:D,extent:P}=this.vertices[v],{position:k,height:F,extent:U}=this.vertices[S],Z=this.vertexProps[v].dir,Q=this.vertexProps[S].dir;if(Kt(i,A[0]/e,A[1]/e,D),Kt(l,k[0]/e,k[1]/e,F),Kt(d,Z[1],-Z[0],0),Be(d,d,P),Kt(m,Q[1],-Q[0],0),Be(m,m,U),this.distSqLines(wt(i[0]+.5*d[0],i[1]+.5*d[1],i[2]+.5*d[2]),wt(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),wt(i[0]-.5*d[0],i[1]-.5*d[1],i[2]-.5*d[2]),wt(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]))<=.0025000000000000005)continue;const X=this.vertices.length,te=ws(mr(),A,k);this.vertices.push({position:Ia(te,te,.5),height:.5*(D+F),extent:.5*(P+U)});const se=ws(mr(),Z,Q);this.vertexProps.push({dir:gs(se,se)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:X}),this.edges.push({a:X,b:S});const le=cl(mr(),this.vertices[X].position,A),_e=bo(le),me={vec:le,dir:Ia(mr(),le,1/_e),len:_e};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(e,i,l,d){const m=Kn(ve(),i,e),_=Kn(ve(),d,l),v=Kn(ve(),e,l),S=Ni(m,m),A=Ni(m,_),D=Ni(m,v),P=Ni(_,_),k=Ni(_,v),F=S*P-A*A;if(F===0)return $n(Fa(m,l,d,Ni(v,_)/Ni(_,_)),e);const U=(S*k-A*D)/F;return $n(Fa(m,e,i,(A*k-D*P)/F),Fa(_,l,d,U))}}class la{static parseFrom(e,i){const l=Fn.parse(e);if(!l)return[];let{vertices:d,features:m}=l;const _=1/kt(i);m.sort((D,P)=>D.id-P.id),d.sort((D,P)=>D.id-P.id||D.idx-P.idx),d=d.filter((D,P,k)=>P===k.findIndex(F=>F.id===D.id&&F.idx===D.idx));const v=new Array;let S=0;const A=d.length;for(const D of m){if(D.constantHeight){v.push(new Js(D.id,D.bounds,D.constantHeight));continue}for(;S!==A&&d[S].id<D.id;)S++;if(S===A||d[S].id!==D.id)continue;const P=new Array,k=new Array,F=S;for(;S!==A&&d[S].id===D.id;){const U=d[S];if(P.push({position:U.position,height:U.height,extent:U.extent}),S!==F&&d[S-1].idx===U.idx-1){const Z=S-F;k.push({a:Z-1,b:Z})}S++}v.push(new Js(D.id,D.bounds,void 0,P,k,_))}return v}static getElevationFeature(e,i){if(!i)return;const l=+e.properties[ci];return Number.isNaN(l)?void 0:i.find(d=>d.id===l)}}class jo{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*jt,this.yOffset=(e.y*this.zScale-i.y)*jt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,l){const d=this.constantElevation(i,l);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),l))}computeBiasedHeight(e,i){return i<=0?e:e+i*Fe(0,i,e>=0?e:Math.abs(.5*e))}}Ft(Js,"ElevationFeature");class Wa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new iu,this.indexArray=new vs,this.segments=new fr,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Gs),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){const m=this.layers[0],_=[];let v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(const{feature:A,id:D,index:P,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,U=jn(A,F);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),U,l))continue;const Z=v?v.evaluate(U,{},l):void 0,Q={id:D,properties:A.properties,type:A.type,sourceLayerIndex:k,index:P,geometry:F?U.geometry:Dn(A,l,d),patterns:{},sortKey:Z};_.push(Q)}v&&_.sort((A,D)=>A.sortKey-D.sortKey);let S=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Mh,S=d.projection);for(const A of _){const{geometry:D,index:P,sourceLayerIndex:k}=A,F=e[P].feature;this.addFeature(A,D,P,i.availableImages,l,S,i.brightness,i.elevationFeatures),i.featureIndex.insert(F,D,P,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Xl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,l,d,m,_,v,S){let A;this.elevationMode!=="none"&&(A=la.getElevationFeature(e,S));for(const D of i)for(const P of D){const k=P.x,F=P.y;if(k<0||k>=jt||F<0||F>=jt)continue;if(_){const Q=_.projectTilePoint(k,F,m),X=_.upVector(m,k,F);this.addGlobeExtVertex(Q,X),this.addGlobeExtVertex(Q,X),this.addGlobeExtVertex(Q,X),this.addGlobeExtVertex(Q,X)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Z=U.vertexLength;if(this.addCircleVertex(k,F,-1,-1),this.addCircleVertex(k,F,1,-1),this.addCircleVertex(k,F,1,1),this.addCircleVertex(k,F,-1,1),this.elevationMode!=="none"){const Q=A?A.pointElevation(new Dt(k,F)):0;this.hasElevation=this.hasElevation||Q!==0;for(let X=0;X<4;X++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},d,m,v,void 0,this.worldview)}addCircleVertex(e,i,l,d){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*i+(d+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function wr(r,e){for(let i=0;i<r.length;i++)if(mo(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(mo(r,e[i]))return!0;return!!Rs(r,e)}function Jr(r,e,i){return!!mo(r,e)||!!Yl(e,r,i)}function rr(r,e){if(r.length===1)return Bh(e,r[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let d=0;d<l.length;d++)if(mo(r,l[d]))return!0}for(let i=0;i<r.length;i++)if(Bh(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Rs(r,e[i]))return!0;return!1}function ss(r,e,i){if(r.length>1){if(Rs(r,e))return!0;for(let l=0;l<e.length;l++)if(Yl(e[l],r,i))return!0}for(let l=0;l<r.length;l++)if(Yl(r[l],e,i))return!0;return!1}function Rs(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const l=r[i],d=r[i+1];for(let m=0;m<e.length-1;m++)if(Ar(l,d,e[m],e[m+1]))return!0}return!1}function Ar(r,e,i,l){return $i(r,i,l)!==$i(e,i,l)&&$i(r,e,i)!==$i(r,e,l)}function po(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Vd(r,e,i,l){const d=po(r,e,l),m=po(r,e,i);if(Math.sign(d)===Math.sign(m))return;const _=po(i,l,r),v=_+m-d;return Math.sign(_)!==Math.sign(v)?[_/(_-v),m/(m-d)]:void 0}function Yl(r,e,i){const l=i*i;if(e.length===1)return r.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(Nh(r,e[d-1],e[d])<l)return!0;return!1}function Nh(r,e,i){const l=e.distSqr(i);if(l===0)return r.distSqr(e);const d=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/l;return r.distSqr(d<0?e:d>1?i:i.sub(e)._mult(d)._add(e))}function Bh(r,e){let i,l,d,m=!1;for(let _=0;_<r.length;_++){i=r[_];for(let v=0,S=i.length-1;v<i.length;S=v++)l=i[v],d=i[S],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(m=!m)}return m}function mo(r,e){let i=!1;for(let l=0,d=r.length-1;l<r.length;d=l++){const m=r[l],_=r[d];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(i=!i)}return i}function il(r,e,i,l,d){for(const _ of r)if(e<=_.x&&i<=_.y&&l>=_.x&&d>=_.y)return!0;const m=[new Dt(e,i),new Dt(e,d),new Dt(l,d),new Dt(l,i)];if(r.length>2){for(const _ of m)if(mo(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Kl(r[_],r[_+1],m))return!0;return!1}function Kl(r,e,i){const l=i[0],d=i[2];if(r.x<l.x&&e.x<l.x||r.x>d.x&&e.x>d.x||r.y<l.y&&e.y<l.y||r.y>d.y&&e.y>d.y)return!1;const m=$i(r,e,i[0]);return m!==$i(r,e,i[1])||m!==$i(r,e,i[2])||m!==$i(r,e,i[3])}function Uo(r,e,i,l,d,m){let _=e.y-r.y,v=r.x-e.x;if(m=m||0){const S=_*_+v*v;if(S===0)return!0;const A=Math.sqrt(S);_/=A,v/=A}return!((i.x-r.x)*_+(i.y-r.y)*v-m<0||(l.x-r.x)*_+(l.y-r.y)*v-m<0||(d.x-r.x)*_+(d.y-r.y)*v-m<0)}function ar(r,e,i,l,d,m,_){return!(Uo(r,e,l,d,m,_)||Uo(e,i,l,d,m,_)||Uo(i,r,l,d,m,_)||Uo(l,d,r,e,i,_)||Uo(d,m,r,e,i,_)||Uo(m,l,r,e,i,_))}function ou(r,e,i){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(r)}function om(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function rx(r,e,i,l,d){if(!e[0]&&!e[1])return r;const m=Dt.convert(e)._mult(d);i==="viewport"&&m._rotate(-l);const _=[];for(let v=0;v<r.length;v++)_.push(r[v].sub(m));return _}function s0(r,e,i,l){const d=Dt.convert(r)._mult(l);return e==="viewport"&&d._rotate(-i),d}let a0,o0;function Eg(r,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Ft(Wa,"CircleBucket",{omit:["layers"]});class Ac{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=jd(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const l=(function(m,_,v){var S=Eg(256*m,256*(_=Math.pow(2,v)-_-1),v),A=Eg(256*(m+1),256*(_+1),v);return S[0]+","+S[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),d=(function(m,_,v){let S,A="";for(let D=m;D>0;D--)S=1<<D-1,A+=(_&S?1:0)+(v&S?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class O_{constructor(e,i){this.wrap=e,this.canonical=i,this.key=jd(e,i.z,i.z,i.x,i.y)}}class ca{constructor(e,i,l,d,m){this.overscaledZ=e,this.wrap=i,this.canonical=new Ac(l,+d,+m),this.key=i===0&&e===l?this.canonical.key:jd(i,e,l,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ca(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return jd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return jd(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new ca(i,this.wrap,i,l,d),new ca(i,this.wrap,i,l+1,d),new ca(i,this.wrap,i,l,d+1),new ca(i,this.wrap,i,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ca(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new O_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jd(r,e,i,l,d){const m=1<<Math.min(i,22);let _=m*(d%m)+l%m;return r&&i<22&&(_+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const Ud=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new ca(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new ca(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new ca(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new ca(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Ft(Ac,"CanonicalTileID"),Ft(ca,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ju=ti([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gd}=ju,Z1=ti([{name:"a_pos_3",components:3,type:"Int16"}]);var sx=ti([{name:"a_pos",type:"Int16",components:2}]);function Sg(r){return r*ee/Ae}const l0=[new Ai([fe,fe,fe],[ue,ue,ue]),new Ai([fe,fe,fe],[0,0,ue]),new Ai([0,fe,fe],[ue,0,ue]),new Ai([fe,0,fe],[0,ue,ue]),new Ai([0,0,fe],[ue,ue,ue])];function ax(r,e,i,l=!0){const d=Be([],r._camera.position,r.worldSize),m=[e,i,1,1];bs(m,m,r.pixelMatrixInverse),Rl(m,m,1/m[3]);const _=qn([],tr([],m,d)),v=r.globeMatrix,S=[v[12],v[13],v[14]],A=tr([],S,d),D=dn(A),P=qn([],A),k=r.worldSize/(2*Math.PI),F=Ni(P,_),U=Math.asin(k/D);if(U<Math.acos(F)){if(!l)return null;const De=[],Ne=[];Be(De,_,D/F),qn(Ne,tr(Ne,De,A)),qn(_,wn(_,A,Be(_,Ne,Math.tan(U)*D)))}const Z=[];new Ki(d,_).closestPointOnSphere(S,k,Z);const Q=qn([],cr(v,0)),X=qn([],cr(v,1)),te=qn([],cr(v,2)),se=Ni(Q,Z),le=Ni(X,Z),_e=Ni(te,Z),me=qe(Math.asin(-le/k));let Ee=qe(Math.atan2(se,_e));Ee=r.center.lng+(function(De,Ne){const pt=(Ne-De+180)%360-180;return pt<-180?pt+360:pt})(r.center.lng,Ee);const Se=je(Ee),we=xe(Xe(me),0,1);return new qt(Se,we)}class W1{constructor(e,i,l){this.a=tr([],e,l),this.b=tr([],i,l),this.center=l;const d=qn([],this.a),m=qn([],this.b);this.angle=Math.acos(Ni(d,m))}}function Ag(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(l,d,m,_){const v=Math.sin(m);return l*(Math.sin((1-_)*m)/v)+d*(Math.sin(_*m)/v)})(r.a[e],r.b[e],r.angle,xe(i,0,1))+r.center[e]}function lu(r){if(r.z<=1)return l0[r.z+2*r.y+r.x];const e=ox(lm(r));return Ai.fromPoints(e)}function Uu(r,e,i){return Be(r,r,1-i),En(r,r,e,i)}function c0(r,e,i){for(const l of r)Cn(l,l,e),Be(l,l,i)}function z_(r,e,i,l){const d=e/r.worldSize,m=r.globeMatrix;if(i.z<=1){const we=lu(i).getCorners();return c0(we,m,d),Ai.fromPoints(we)}const _=lm(i,l),v=ox(_,ee+Sg(r._tileCoverLift));c0(v,m,d);const S=Number.MAX_VALUE,A=[-S,-S,-S],D=[S,S,S];if(_.contains(r.center)){for(const Ne of v)ft(D,D,Ne),Qt(A,A,Ne);A[2]=0;const we=r.point,De=[we.x*d,we.y*d,0];return ft(D,D,De),Qt(A,A,De),new Ai(D,A)}if(r._tileCoverLift>0){for(const we of v)ft(D,D,we),Qt(A,A,we);return new Ai(D,A)}const P=[m[12]*d,m[13]*d,m[14]*d],k=_.getCenter(),F=xe(r.center.lat,-85.051129,Le),U=xe(k.lat,-85.051129,Le),Z=je(r.center.lng),Q=Xe(F);let X=Z-je(k.lng);const te=Q-Xe(U);X>.5?X-=1:X<-.5&&(X+=1);let se=0;Math.abs(X)>Math.abs(te)?se=X>=0?1:3:(se=te>=0?0:2,En(P,P,[m[4]*d,m[5]*d,m[6]*d],-Math.sin(oi(te>=0?_.getSouth():_.getNorth()))*ee));const le=v[se],_e=v[(se+1)%4],me=new W1(le,_e,P),Ee=[Ag(me,0)||le[0],Ag(me,1)||le[1],Ag(me,2)||le[2]],Se=Fh(r.zoom);if(Se>0){const we=(function({x:Ne,y:pt,z:ct},dt,Tt,vt,bt){const ot=1/(1<<ct);let At=Ne*ot,_t=At+ot,Ct=pt*ot,Et=Ct+ot,nn=0;const rn=(At+_t)/2-vt;return rn>.5?nn=-1:rn<-.5&&(nn=1),At=((At+nn)*dt-(vt*=dt))*Tt+vt,_t=((_t+nn)*dt-vt)*Tt+vt,Ct=(Ct*dt-(bt*=dt))*Tt+bt,Et=(Et*dt-bt)*Tt+bt,[[At,Et,0],[_t,Et,0],[_t,Ct,0],[At,Ct,0]]})(i,e,r._pixelsPerMercatorPixel,Z,Q);for(let Ne=0;Ne<v.length;Ne++)Uu(v[Ne],we[Ne],Se);const De=wn([],we[se],we[(se+1)%4]);Be(De,De,.5),Uu(Ee,De,Se)}for(const we of v)ft(D,D,we),Qt(A,A,we);return D[2]=Math.min(le[2],_e[2]),ft(D,D,Ee),Qt(A,A,Ee),new Ai(D,A)}function lm({x:r,y:e,z:i},l=!1){const d=1/(1<<i),m=new ge(ut(r*d),e===(1<<i)-1&&l?-90:xt((e+1)*d)),_=new ge(ut((r+1)*d),e===0&&l?90:xt(e*d));return new ke(m,_)}function ox(r,e=ee){const i=oi(r.getNorth()),l=oi(r.getSouth()),d=Math.cos(i),m=Math.cos(l),_=Math.sin(i),v=Math.sin(l),S=r.getWest(),A=r.getEast();return[Ie(m,v,S,e),Ie(m,v,A,e),Ie(d,_,A,e),Ie(d,_,S,e)]}function Ig(r,e,i,l){const d=1<<i.z,m=(r/jt+i.x)/d;return Te(xt((e/jt+i.y)/d),ut(m),l)}function qd({min:r,max:e}){return 16383/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const u0=new Float64Array(16);function Cg(r){const e=qd(r),i=Re(u0,[e,e,e]);return Ge(i,i,er([],r.min))}function or(r){const e=(function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l})(u0,r.min),i=1/qd(r);return Mt(e,e,[i,i,i])}function Rg(r){const e=jt/(2*Math.PI);return r/(2*Math.PI)/e}function Mg(r,e){return jt/(512*Math.pow(2,r))*qd(lu(e))}function N_(r,e,i,l,d){const m=Rg(i),_=[r,e,-i/(2*Math.PI)],v=Ke(new Float64Array(16));return Ge(v,v,_),Mt(v,v,[m,m,m]),cn(v,v,oi(-d)),St(v,v,oi(-l)),v}function Fh(r){return Fe(5,6,r)}function B_(r,e){const i=Te(e.lat,e.lng),l=(function(U){const Z=Te(U._center.lat,U._center.lng);let Q=Vr([],wt(0,1,0),Z);const X=Ve([],-U.angle,Z);Q=Cn(Q,Q,X),Ve(X,-U._pitch,Q);const te=qn([],Z);return Be(te,te,Sg(U.cameraToCenterDistance/U.pixelsPerMeter)),Cn(te,te,X),wn([],Z,te)})(r);return _=(d=Kn([],l,i))[0],v=d[1],S=d[2],A=(m=i)[0],D=m[1],P=m[2],F=(k=Math.sqrt((_*_+v*v+S*S)*(A*A+D*D+P*P)))&&Ni(d,m)/k,Math.acos(Math.min(Math.max(F,-1),1));var d,m,_,v,S,A,D,P,k,F}function np(r,e){return B_(r,e)>Math.PI/2*1.01}const Dg=oi(85),X1=Math.cos(Dg),h0=Math.sin(Dg),Y1=Qe(),d0=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function lx(r,e,i,l,d,m,_,v,S){if(m&&r.queryGeometry.isAboveHorizon)return!1;m&&(S*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,D=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const k of P){const F=k.add(v),U=d&&i.elevation?i.elevation.exaggeration()*d.getElevationAt(F.x,F.y,!0):0,Z=i.projection.projectTilePoint(F.x,F.y,A);if(U>0){const se=i.projection.upVector(A,F.x,F.y);Z.x+=se[0]*D*U,Z.y+=se[1]*D*U,Z.z+=se[2]*D*U}const Q=m?F:f0(Z.x,Z.y,Z.z,l),X=m?r.tilespaceRays.map(se=>go(se,U)):r.queryGeometry.screenGeometry,te=bs([],[Z.x,Z.y,Z.z,1],l);if(!_&&m?S*=te[3]/i.cameraToCenterDistance:_&&!m&&(S*=i.cameraToCenterDistance/te[3]),m){const se=xt((k.y/jt+A.y)/(1<<A.z));S/=i.projection.pixelsPerMeter(se,1)/Ze(1,se)}if(Jr(X,Q,S))return!0}return!1}function f0(r,e,i,l){const d=bs([],[r,e,i,1],l);return new Dt(d[0]/d[3],d[1]/d[3])}const as=wt(0,0,0),cx=wt(0,0,1);function go(r,e){const i=ve();return as[2]=e,r.intersectsPlane(as,cx,i),new Dt(i[0],i[1])}class p0 extends Wa{}let ux,m0,F_,V_;function Pg(r,{width:e,height:i},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*i*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*i*l);return r.width=e,r.height=i,r.data=d,r}function hx(r,e,i){const{width:l,height:d}=e;l===r.width&&d===r.height||(j_(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,d)},i,null),r.width=l,r.height=d,r.data=e.data)}function j_(r,e,i,l,d,m,_,v){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||i.x>r.width-d.width||i.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const S=r.data,A=e.data,D=m===4&&v;for(let P=0;P<d.height;P++){const k=((i.y+P)*r.width+i.x)*m,F=((l.y+P)*e.width+l.x)*m;if(D)for(let U=0;U<d.width;U++){const Z=k+U*m+3,Q=F+U*m;A[Q+0]=255,A[Q+1]=255,A[Q+2]=255,A[Q+3]=S[Z]}else if(_)for(let U=0;U<d.width;U++){const Z=k+U*m,Q=F+U*m,X=new Ei(S[Z+0]/255,S[Z+1]/255,S[Z+2]/255,S[Z+3]).toNonPremultipliedRenderColor(_).toArray();A[Q+0]=X[0],A[Q+1]=X[1],A[Q+2]=X[2],A[Q+3]=X[3]}else for(let U=0;U<d.width*m;U++)A[F+U]=S[k+U]}return e}Ft(p0,"HeatmapBucket",{omit:["layers"]});class Gu{constructor(e,i){Pg(this,e,1,i)}resize(e){hx(this,new Gu(e),1)}clone(){return new Gu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,d,m){j_(e,i,l,d,m,1,null)}}class ea{constructor(e,i){Pg(this,e,4,i)}resize(e){hx(this,new ea(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,d,m,_,v){j_(e,i,l,d,m,4,_,v)}}class g0{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function cm(r){const e={},i=r.resolution||256,l=r.clips?r.clips.length:1,d=r.image||new ea({width:i,height:l}),m=(_,v,S)=>{e[r.evaluationKey]=S;const A=r.expression.evaluate(e),D=A?A.toNonPremultipliedRenderColor(null):null;D&&(d.data[_+v+0]=Math.floor(255*D.r),d.data[_+v+1]=Math.floor(255*D.g),d.data[_+v+2]=Math.floor(255*D.b),d.data[_+v+3]=Math.floor(255*D.a))};if(r.clips)for(let _=0,v=0;_<l;++_,v+=4*i)for(let S=0,A=0;S<i;S++,A+=4){const D=S/(i-1),{start:P,end:k}=r.clips[_];m(v,A,P*(1-D)+k*D)}else for(let _=0,v=0;_<i;_++,v+=4)m(0,v,_/(i-1));return d}Ft(Gu,"AlphaImage"),Ft(ea,"RGBAImage");const K1=ti([{name:"a_pos",components:2,type:"Int16"}],4),_0=ti([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Q1=ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),J1=ti([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ql(r,e,i=2){const l=e&&e.length,d=l?e[0]*i:r.length;let m=dx(r,0,d,i,!0);const _=[];if(!m||m.next===m.prev)return _;let v,S,A;if(l&&(m=(function(D,P,k,F){const U=[];for(let Z=0,Q=P.length;Z<Q;Z++){const X=dx(D,P[Z]*F,Z<Q-1?P[Z+1]*F:D.length,F,!1);X===X.next&&(X.steiner=!0),U.push(x0(X))}U.sort(px);for(let Z=0;Z<U.length;Z++)k=nw(U[Z],k);return k})(r,e,m,i)),r.length>80*i){v=r[0],S=r[1];let D=v,P=S;for(let k=i;k<d;k+=i){const F=r[k],U=r[k+1];F<v&&(v=F),U<S&&(S=U),F>D&&(D=F),U>P&&(P=U)}A=Math.max(D-v,P-S),A=A!==0?32767/A:0}return ip(m,_,i,v,S,A,0),_}function dx(r,e,i,l,d){let m;if(d===(function(_,v,S,A){let D=0;for(let P=v,k=S-A;P<S;P+=A)D+=(_[k]-_[P])*(_[P+1]+_[k+1]),k=P;return D})(r,e,i,l)>0)for(let _=e;_<i;_+=l)m=gx(_/l|0,r[_],r[_+1],m);else for(let _=i-l;_>=e;_-=l)m=gx(_/l|0,r[_],r[_+1],m);return m&&rp(m,m.next)&&(Ng(m),m=m.next),m}function Hd(r,e){if(!r)return r;e||(e=r);let i,l=r;do if(i=!1,l.steiner||!rp(l,l.next)&&Ir(l.prev,l,l.next)!==0)l=l.next;else{if(Ng(l),l=e=l.prev,l===l.next)break;i=!0}while(i||l!==e);return e}function ip(r,e,i,l,d,m,_){if(!r)return;!_&&m&&(function(S,A,D,P){let k=S;do k.z===0&&(k.z=kg(k.x,k.y,A,D,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==S);k.prevZ.nextZ=null,k.prevZ=null,(function(F){let U,Z=1;do{let Q,X=F;F=null;let te=null;for(U=0;X;){U++;let se=X,le=0;for(let me=0;me<Z&&(le++,se=se.nextZ,se);me++);let _e=Z;for(;le>0||_e>0&&se;)le!==0&&(_e===0||!se||X.z<=se.z)?(Q=X,X=X.nextZ,le--):(Q=se,se=se.nextZ,_e--),te?te.nextZ=Q:F=Q,Q.prevZ=te,te=Q;X=se}te.nextZ=null,Z*=2}while(U>1)})(k)})(r,l,d,m);let v=r;for(;r.prev!==r.next;){const S=r.prev,A=r.next;if(m?tw(r,l,d,m):ew(r))e.push(S.i,r.i,A.i),Ng(r),r=A.next,v=A.next;else if((r=A)===v){_?_===1?ip(r=y0(Hd(r),e),e,i,l,d,m,2):_===2&&fx(r,e,i,l,d,m):ip(Hd(r),e,i,l,d,m,1);break}}}function ew(r){const e=r.prev,i=r,l=r.next;if(Ir(e,i,l)>=0)return!1;const d=e.x,m=i.x,_=l.x,v=e.y,S=i.y,A=l.y,D=Math.min(d,m,_),P=Math.min(v,S,A),k=Math.max(d,m,_),F=Math.max(v,S,A);let U=l.next;for(;U!==e;){if(U.x>=D&&U.x<=k&&U.y>=P&&U.y<=F&&um(d,v,m,S,_,A,U.x,U.y)&&Ir(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function tw(r,e,i,l){const d=r.prev,m=r,_=r.next;if(Ir(d,m,_)>=0)return!1;const v=d.x,S=m.x,A=_.x,D=d.y,P=m.y,k=_.y,F=Math.min(v,S,A),U=Math.min(D,P,k),Z=Math.max(v,S,A),Q=Math.max(D,P,k),X=kg(F,U,e,i,l),te=kg(Z,Q,e,i,l);let se=r.prevZ,le=r.nextZ;for(;se&&se.z>=X&&le&&le.z<=te;){if(se.x>=F&&se.x<=Z&&se.y>=U&&se.y<=Q&&se!==d&&se!==_&&um(v,D,S,P,A,k,se.x,se.y)&&Ir(se.prev,se,se.next)>=0||(se=se.prevZ,le.x>=F&&le.x<=Z&&le.y>=U&&le.y<=Q&&le!==d&&le!==_&&um(v,D,S,P,A,k,le.x,le.y)&&Ir(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;se&&se.z>=X;){if(se.x>=F&&se.x<=Z&&se.y>=U&&se.y<=Q&&se!==d&&se!==_&&um(v,D,S,P,A,k,se.x,se.y)&&Ir(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;le&&le.z<=te;){if(le.x>=F&&le.x<=Z&&le.y>=U&&le.y<=Q&&le!==d&&le!==_&&um(v,D,S,P,A,k,le.x,le.y)&&Ir(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function y0(r,e){let i=r;do{const l=i.prev,d=i.next.next;!rp(l,d)&&Og(l,i,i.next,d)&&zg(l,d)&&zg(d,l)&&(e.push(l.i,i.i,d.i),Ng(i),Ng(i.next),i=r=d),i=i.next}while(i!==r);return Hd(i)}function fx(r,e,i,l,d,m){let _=r;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&Lg(_,v)){let S=sp(_,v);return _=Hd(_,_.next),S=Hd(S,S.next),ip(_,e,i,l,d,m,0),void ip(S,e,i,l,d,m,0)}v=v.next}_=_.next}while(_!==r)}function px(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function nw(r,e){const i=(function(d,m){let _=m;const v=d.x,S=d.y;let A,D=-1/0;if(rp(d,_))return _;do{if(rp(d,_.next))return _.next;if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const Z=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Z<=v&&Z>D&&(D=Z,A=_.x<_.next.x?_:_.next,Z===v))return A}_=_.next}while(_!==m);if(!A)return null;const P=A,k=A.x,F=A.y;let U=1/0;_=A;do{if(v>=_.x&&_.x>=k&&v!==_.x&&mx(S<F?v:D,S,k,F,S<F?D:v,S,_.x,_.y)){const Z=Math.abs(S-_.y)/(v-_.x);zg(_,d)&&(Z<U||Z===U&&(_.x>A.x||_.x===A.x&&Ic(A,_)))&&(A=_,U=Z)}_=_.next}while(_!==P);return A})(r,e);if(!i)return e;const l=sp(i,r);return Hd(l,l.next),Hd(i,i.next)}function Ic(r,e){return Ir(r.prev,r,e.prev)<0&&Ir(e.next,r,r.next)<0}function kg(r,e,i,l,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function x0(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function mx(r,e,i,l,d,m,_,v){return(d-_)*(e-v)>=(r-_)*(m-v)&&(r-_)*(l-v)>=(i-_)*(e-v)&&(i-_)*(m-v)>=(d-_)*(l-v)}function um(r,e,i,l,d,m,_,v){return!(r===_&&e===v)&&mx(r,e,i,l,d,m,_,v)}function Lg(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,l){let d=i;do{if(d.i!==i.i&&d.next.i!==i.i&&d.i!==l.i&&d.next.i!==l.i&&Og(d,d.next,i,l))return!0;d=d.next}while(d!==i);return!1})(r,e)&&(zg(r,e)&&zg(e,r)&&(function(i,l){let d=i,m=!1;const _=(i.x+l.x)/2,v=(i.y+l.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&_<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==i);return m})(r,e)&&(Ir(r.prev,r,e.prev)||Ir(r,e.prev,e))||rp(r,e)&&Ir(r.prev,r,r.next)>0&&Ir(e.prev,e,e.next)>0)}function Ir(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function rp(r,e){return r.x===e.x&&r.y===e.y}function Og(r,e,i,l){const d=U_(Ir(r,e,i)),m=U_(Ir(r,e,l)),_=U_(Ir(i,l,r)),v=U_(Ir(i,l,e));return d!==m&&_!==v||!(d!==0||!Cc(r,i,e))||!(m!==0||!Cc(r,l,e))||!(_!==0||!Cc(i,r,l))||!(v!==0||!Cc(i,e,l))}function Cc(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function U_(r){return r>0?1:r<0?-1:0}function zg(r,e){return Ir(r.prev,r,r.next)<0?Ir(r,e,r.next)>=0&&Ir(r,r.prev,e)>=0:Ir(r,e,r.prev)<0||Ir(r,r.next,e)<0}function sp(r,e){const i=_x(r.i,r.x,r.y),l=_x(e.i,e.x,e.y),d=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=d,d.prev=i,l.next=i,i.prev=l,m.next=l,l.prev=m,l}function gx(r,e,i,l){const d=_x(r,e,i);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function Ng(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function _x(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bg(r,e){const i=r.length;if(i<=1)return[r];const l=[];let d,m;for(let _=0;_<i;_++){const v=xr(r[_]);v!==0&&(r[_].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(d&&l.push(d),d=[r[_]]):d.push(r[_]))}if(d&&l.push(d),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(gf(l[_],e,1,l[_].length-1,iw),l[_]=l[_].slice(0,e));return l}function iw(r,e){return e.area-r.area}function v0(r,e,i=1){if(!r)return null;const l=typeof r=="string"?so.from(r).getPrimary():r.getPrimary(),d=typeof r=="string"?null:r.getSecondary();for(const m of[l,d]){if(!m)continue;const _=m.id.toString();e.has(_)||e.set(_,[]),m.scaleSelf(i),e.get(_).push(m)}return{primary:l.toString(),secondary:d?d.toString():null}}function yx(r,e,i,l){const d=l.patternDependencies;let m=!1;for(const _ of e){const v=_.paint.get(`${r}-pattern`);v.isConstant()||(m=!0),v0(v.constantOr(null),d,i)&&(m=!0)}return m}function xx(r,e,i,l,d,m){const _=m.patternDependencies;for(const v of e){const S=v.paint.get(`${r}-pattern`).value;if(S.kind!=="constant"){let A=S.evaluate({zoom:l},i,{},m.availableImages);A=A&&A.name?A.name:A;const D=v0(A,_,d);if(!D)continue;const{primary:P,secondary:k}=D;P&&(i.patterns[v.id]=[P,k].filter(Boolean))}}return i}class qu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=jt&&i>=jt}static evaluate(e){if(e.length===0)return new qu;let i=[];for(const S of e)i.push(...S.portals);if(i.length===0)return new qu;for(const S of i){const A=S.va,D=S.vb;(qu.isOnBorder(A.x,D.x)||qu.isOnBorder(A.y,D.y))&&(S.type="border")}const l=i.filter(S=>S.type!=="unevaluated"),d=i.filter(S=>S.type==="unevaluated");if(d.length===0)return new qu;d.sort((S,A)=>S.hash===A.hash?S.isTunnel===A.isTunnel?0:S.isTunnel?-1:1:S.hash<A.hash?1:-1),i=l.concat(d);let m=l.length,_=m,v=m;do if(_++,_===i.length||i[m].hash!==i[_].hash){if(_-m===2){v<m&&(i[v]=i[m],i[m]=null);const S=i[v],A=i[_-1];S.type=S.isTunnel!==A.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:A.connection.a},v++}m=_}while(m!==i.length);return i.splice(v),i.sort((S,A)=>S.hash<A.hash?1:-1),{portals:i}}}Ft(qu,"ElevationPortalGraph");class hm{constructor(e,i,l){this.outPositions=e,this.outNormals=i,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,i,l){let d=e[2];l!=null&&(d*=l);const m=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(m);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(m,v);const S=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),D=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(S,A,D),v}addTriangle(e,i,l){this.outIndices.emplaceBack(e,i,l)}addTriangles(e,i,l){if(e.length===0)return;const d=l.length===1,m=ve(),_=ve();for(let v=0;v<e.length;v+=3){const S=i[e[v+0]],A=i[e[v+1]],D=i[e[v+2]],P=d?l[0]:l[e[v+1]],k=d?l[0]:l[e[v+2]];Kt(m,S.x,S.y,d?l[0]:l[e[v+0]]);const F=this.addVertex(m,_);Kt(m,A.x,A.y,P);const U=this.addVertex(m,_);Kt(m,D.x,D.y,k);const Z=this.addVertex(m,_);this.outIndices.emplaceBack(F,U,Z)}}addQuad(e,i,l,d,m,_){const v=this.addVertex(e,m,_),S=this.addVertex(i,m,_),A=this.addVertex(l,m,_),D=this.addVertex(d,m,_);this.addTriangle(v,S,A),this.addTriangle(A,D,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Oa{constructor(e,i,l,d){this.unevaluatedPortals=new qu,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Md,this.vertexNormals=new Xf,this.indexArray=new vs,this.tileToMeters=kt(e),this.bridgeProgramConfigurations=new z(i,{zoom:l,lut:d},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new z(i,{zoom:l,lut:d},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,i){const l=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(i[d]);return l}addTriangles(e,i,l){const d=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)d.push(m+i)}addRenderableRing(e,i,l,d,m,_){const v=[new Dt(m.min.x,m.min.y),new Dt(m.max.x,m.min.y),new Dt(m.max.x,m.max.y),new Dt(m.min.x,m.max.y)];for(let S=0;S<l-1;S++){const A=i+S,D=A+1,P=this.unevalVertices[A],k=this.unevalVertices[D];if(!(P.x>=m.min.x&&P.x<=m.max.x&&P.y>=m.min.y&&P.y<=m.max.y||k.x>=m.min.x&&k.x<=m.max.x&&k.y>=m.min.y&&k.y<=m.max.y||Kl(P,k,v))||this.isOnBorder(P.x,k.x)||this.isOnBorder(P.y,k.y))continue;const F=Oa.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[D]);let U,Z=this.vertexHashLookup.get(Oa.computePosHash(P));Z!=null?U=Z.next:(Z=this.vertexHashLookup.get(Oa.computePosHash(k)),U=Z!=null?Z.prev:F),this.unevalEdges.push({polygonIdx:e,a:A,b:D,hash:F,portalHash:U,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,l,d,m){if(i.length!==0){this.vertexHashLookup.clear();for(const _ of i){if(_.length===0)continue;const v=_[0];let S=Oa.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let A=0;A<v.length-1;A++){const D=v[A+0],P=v[A+1],k=Fi(P.x-D.x,P.y-D.y),F=bo(k);if(F===0)continue;let U="unevaluated";const Z=d.pointElevation(D),Q=d.pointElevation(P);Math.abs(Z)<.01&&Math.abs(Q)<.01?U="entrance":(this.isOnBorder(D.x,P.x)||this.isOnBorder(D.y,P.y))&&(U="border");const X=Oa.computeEdgeHash(D,P);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:D,vb:P,vab:k,length:F,hash:X,isTunnel:l,type:U});const te=Oa.computePosHash(D);this.vertexHashLookup.set(te,{prev:S,next:X}),S=X}}}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},d=new hm(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=i(),_=i(),v=i(),S=(k,F)=>{k.sort((Z,Q)=>Z.type===F&&Q.type!==F?-1:Z.type!==F&&Q.type===F?1:0);const U=k.findIndex(Z=>Z.type!==F);return U>=0?U:k.length};let A=0;this.unevalEdges.length>0&&(A=S(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),l(v);const D=i(),P=i();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(A),F=S(k,"tunnel")+A;this.unevalEdges.push(...k),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:F})}l(D),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(P),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(m),this.maskSegments=fr.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=fr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=fr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=fr.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.shadowCasterSegments=fr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,i,l,d,m,_,v,S){this.bridgeProgramConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S),this.tunnelProgramConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Q1.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,J1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,l,d,m){const _=(v,S)=>{for(let A=0;A<S.length-1;A++){const D=S[A].featureIndex,P=S[A+1].vertexStart,k=e.feature(D);v.populatePaintArrays(P,k,D,{},l,i,d,void 0,m)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,l,d,m){const _=new Map;for(let v=d;v<m;v++){const S=l[v],A=S.a,D=S.b,P=Oa.computePosHash(e[A]),k=Oa.computePosHash(e[D]);let F=_.get(P);F||(F={},_.set(P,F));let U=_.get(k);U||(U={},_.set(k,U)),i[A]<=0&&i[D]<=0||(F.to=D,U.from=A)}return _}isTerminalVertex(e,i){const l=Oa.computePosHash(this.unevalVertices[e]),d=i.get(l);return!d||!d.from||!d.to}constructBridgeStructures(e,i,l,d,m,_){e.clearVertexLookup();const v=this.computeVertexConnections(i,l,d,m.min,m.max),S=1/_,A=.5*S,D=(Tt,vt)=>Kt(Tt,i[vt].x,i[vt].y,l[vt]*S),P=ve(),k=ve(),F=ve(),U=ve(),Z=ve(),Q=(Tt,vt)=>{const bt=v.get(Oa.computePosHash(i[vt])),ot=bt.from,At=bt.to;if(!ot||!At)return;D(P,ot),D(k,vt),D(F,At),Hi(U),Wr(P,k)||(tr(Z,k,P),qn(U,Z)),Wr(F,k)||(tr(Z,F,k),wn(U,U,qn(Z,Z)));const _t=Xr(U);return _t>0?Be(Tt,U,1/_t):void 0};let X=Number.POSITIVE_INFINITY;this.sortSubarray(d,m.min,m.max,(Tt,vt)=>Tt.featureInfo.featureIndex-vt.featureInfo.featureIndex);const te=ve(),se=ve(),le=ve(),_e=ve(),me=ve(),Ee=ve(),Se=ve(),we=ve(),De=ve(),Ne=[ve(),ve(),ve(),ve()],pt=[ve(),ve(),ve(),ve()],ct=[{coord:new Dt(0,0),height:0},{coord:new Dt(0,0),height:0}],dt=(Tt,vt)=>Tt>vt;for(let Tt=m.min;Tt<m.max;Tt++){const vt=d[Tt];if(!vt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ct,i,l,vt,dt))continue;const[bt,ot]=ct;if(Kt(te,bt.coord.x,bt.coord.y,S*bt.height),Kt(se,ot.coord.x,ot.coord.y,S*ot.height),Wr(te,se))continue;tr(le,se,te),qn(le,le);const At=Q(we,vt.a)||le,_t=Q(De,vt.b)||le;Kt(_e,At[1],-At[0],0),qn(_e,_e),Kt(me,_t[1],-_t[0],0),qn(me,me),Vr(we,_e,At),qn(Ee,we),Vr(we,me,_t),qn(Se,we),wn(Ne[0],te,Be(we,tr(we,_e,Ee),A)),wn(Ne[1],te,Be(we,wn(we,_e,Ee),A)),wn(Ne[2],te,Be(we,Ee,A)),Ne[3]=te,wn(pt[0],se,Be(we,tr(we,me,Se),A)),wn(pt[1],se,Be(we,wn(we,me,Se),A)),wn(pt[2],se,Be(we,Se,A)),pt[3]=se,X=this.addFeatureSection(vt.featureInfo.featureIndex,X,this.bridgeFeatureSections,e);const Ct=e.addVertex(Ne[0],_e,_),Et=e.addVertex(Ne[1],_e,_),nn=e.addVertex(pt[0],me,_),rn=e.addVertex(pt[1],me,_);e.addTriangle(Ct,Et,nn),e.addTriangle(Et,rn,nn);const $t=e.addVertex(Ne[1],Ee,_),Wt=e.addVertex(Ne[2],Ee,_),An=e.addVertex(pt[1],Se,_),_n=e.addVertex(pt[2],Se,_);e.addTriangle($t,Wt,An),e.addTriangle(Wt,_n,An),er(_e,_e),er(me,me);const Jt=e.addVertex(Ne[2],_e,_),Bn=e.addVertex(Ne[3],_e,_),ri=e.addVertex(pt[2],me,_),Ri=e.addVertex(pt[3],me,_);e.addTriangle(Jt,Bn,ri),e.addTriangle(Bn,Ri,ri);const Jn=this.isTerminalVertex(vt.a,v),Zi=this.isTerminalVertex(vt.b,v);bt.height<.01&&Jn&&e.addQuad(Ne[3],Ne[2],Ne[1],Ne[0],er(At,At),_),ot.height<.01&&Zi&&e.addQuad(pt[0],pt[1],pt[2],pt[3],_t,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,l,d,m,_){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const S=(X,te)=>X.featureInfo.featureIndex-te.featureInfo.featureIndex;this.sortSubarray(d,m.min,m.max,S),this.sortSubarray(d,_.min,_.max,S);const A=X=>qn(X,X),D=[{coord:new Dt(0,0),height:0},{coord:new Dt(0,0),height:0}],P=(X,te)=>X<te,k=ve(),F=ve(),U=ve(),Z=ve(),Q=ve();for(let X=m.min;X<m.max;X++){if(!this.prepareEdgePoints(D,i,l,d[X],P))continue;const[te,se]=D,le=A(Kt(Q,-(se.coord.y-te.coord.y),se.coord.x-te.coord.x,0));v=this.addFeatureSection(d[X].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Kt(k,te.coord.x,te.coord.y,te.height),Kt(F,se.coord.x,se.coord.y,se.height),Kt(U,se.coord.x,se.coord.y,d[X].isTunnel?-.1:0),Kt(Z,te.coord.x,te.coord.y,d[X].isTunnel?-.1:0),le)}for(let X=_.min;X<_.max;X++){const te=d[X];te.isTunnel&&([te.a,te.b]=[te.b,te.a]);const se=i[te.a],le=i[te.b],_e=A(Kt(Q,-(le.y-se.y),le.x-se.x,0));v=this.addFeatureSection(te.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Kt(k,le.x,le.y,0),Kt(F,se.x,se.y,0),Kt(U,se.x,se.y,l[te.a]+4),Kt(Z,le.x,le.y,l[te.b]+4),_e),e.addQuad(Kt(k,se.x,se.y,0),Kt(F,le.x,le.y,0),Kt(U,le.x,le.y,l[te.b]+4),Kt(Z,se.x,se.y,l[te.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,l,d){e.coord.x=i,e.coord.y=l,e.height=d}prepareEdgePoints(e,i,l,d,m){let _=i[d.a].x,v=i[d.a].y,S=i[d.b].x,A=i[d.b].y,D=l[d.a],P=l[d.b];const k=m(D,0),F=m(P,0);if(k&&F)return this.setElevatedPoint(e[0],_,v,D),this.setElevatedPoint(e[1],S,A,P),!0;if(!k&&!F)return!1;if(k){if(!F){const U=P/(P-D);S=Rn(S,_,U),A=Rn(A,v,U),P=Rn(P,D,U)}}else{const U=D/(D-P);_=Rn(_,S,U),v=Rn(v,A,U),D=Rn(D,P,U)}return this.setElevatedPoint(e[0],_,v,D),this.setElevatedPoint(e[1],S,A,P),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((v,S)=>v.hash===S.hash?S.polygonIdx-v.polygonIdx:S.hash>v.hash?1:-1);let l=0,d=0,m=0,_=i[l].polygonIdx;do d++,(d===i.length||i[l].hash!==i[d].hash)&&((d-l===1||i[d-1].polygonIdx!==_)&&(m<l&&(i[m]=i[l],i[l]=null),i[m].type="none",m++),l=d,l!==i.length&&(_=i[l].polygonIdx));while(l!==i.length);if(i.splice(m),i.length!==0&&e.length!==0){i.sort((A,D)=>A.portalHash<D.portalHash?1:-1);let v=0,S=0;for(;v!==i.length&&S!==e.length;){const A=i[v],D=e[S];A.portalHash>D.hash?v++:D.hash>A.portalHash?S++:(A.type=D.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=jt&&i>=jt}addFeatureSection(e,i,l,d){return e!==i&&(i=e,l.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),i}sortSubarray(e,i,l,d){const m=e.slice(i,l);m.sort(d),e.splice(i,m.length,...m)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Oa.computePosHash(e))<<32n|BigInt(Oa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function b0(r,e){return r>e?1:r<e?-1:0}class vx{constructor(e=b0,i=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!i}rotateLeft(e){var i=e.right;i&&(e.right=i.left,i.left&&(i.left.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.left=e),e.parent=i}rotateRight(e){var i=e.left;i&&(e.left=i.right,i.right&&(i.right.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.right=e),e.parent=i}_splay(e){for(;e.parent;){var i=e.parent;i.parent?i.left===e&&i.parent.left===i?(this.rotateRight(i.parent),this.rotateRight(i)):i.right===e&&i.parent.right===i?(this.rotateLeft(i.parent),this.rotateLeft(i)):i.left===e&&i.parent.right===i?(this.rotateRight(i),this.rotateLeft(i)):(this.rotateLeft(i),this.rotateRight(i)):i.left===e?this.rotateRight(i):this.rotateLeft(i)}}splay(e){for(var i,l,d,m,_;e.parent;)(l=(i=e.parent).parent)&&l.parent?((d=l.parent).left===l?d.left=e:d.right=e,e.parent=d):(e.parent=null,this._root=e),m=e.left,_=e.right,e===i.left?(l&&(l.left===i?(i.right?(l.left=i.right,l.left.parent=l):l.left=null,i.right=l,l.parent=i):(m?(l.right=m,m.parent=l):l.right=null,e.left=l,l.parent=e)),_?(i.left=_,_.parent=i):i.left=null,e.right=i,i.parent=e):(l&&(l.right===i?(i.left?(l.right=i.left,l.right.parent=l):l.right=null,i.left=l,l.parent=i):(_?(l.left=_,_.parent=l):l.left=null,e.right=l,l.parent=e)),m?(i.right=m,m.parent=i):i.right=null,e.left=i,i.parent=e)}replace(e,i){e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,i){var l=this._root,d=null,m=this._compare;if(this._noDuplicates)for(;l;){if(d=l,m(l.key,e)===0)return;l=m(l.key,e)<0?l.right:l.left}else for(;l;)d=l,l=m(l.key,e)<0?l.right:l.left;return l={key:e,data:i,left:null,right:null,parent:d},d?m(d.key,l.key)<0?d.right=l:d.left=l:this._root=l,this.splay(l),this._size++,l}find(e){for(var i=this._root,l=this._compare;i;){var d=l(i.key,e);if(d<0)i=i.right;else{if(!(d>0))return i;i=i.left}}return null}contains(e){for(var i=this._root,l=this._compare;i;){var d=l(e,i.key);if(d===0)return!0;i=d<0?i.left:i.right}return!1}remove(e){var i=this.find(e);if(!i)return!1;if(this.splay(i),i.left)if(i.right){var l=this.minNode(i.right);l.parent!==i&&(this.replace(l,l.right),l.right=i.right,l.right.parent=l),this.replace(i,l),l.left=i.left,l.left.parent=l}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var i=this.find(e);if(i){this.splay(i);var l=i.left,d=i.right,m=null;l&&(l.parent=null,m=this.maxNode(l),this.splay(m),this._root=m),d&&(l?m.right=d:this._root=d,d.parent=m),this._size--}}pop(){var e=this._root,i=null;if(e){for(;e.left;)e=e.left;i={key:e.key,data:e.data},this.remove(e.key)}return i}next(e){var i=e;if(i)if(i.right)for(i=i.right;i&&i.left;)i=i.left;else for(i=e.parent;i&&i.right===e;)e=i,i=i.parent;return i}prev(e){var i=e;if(i)if(i.left)for(i=i.left;i&&i.right;)i=i.right;else for(i=e.parent;i&&i.left===e;)e=i,i=i.parent;return i}forEach(e){for(var i=this._root,l=[],d=!1,m=0;!d;)i?(l.push(i),i=i.left):l.length>0?(e(i=l.pop(),m++),i=i.right):d=!0;return this}range(e,i,l,d){const m=[],_=this._compare;let v,S=this._root;for(;m.length!==0||S;)if(S)m.push(S),S=S.left;else{if(S=m.pop(),v=_(S.key,i),v>0)break;if(_(S.key,e)>=0&&l.call(d,S))return this;S=S.right}return this}keys(){for(var e=this._root,i=[],l=[],d=!1;!d;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),l.push(e.key),e=e.right):d=!0;return l}values(){for(var e=this._root,i=[],l=[],d=!1;!d;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),l.push(e.data),e=e.right):d=!0;return l}at(e){for(var i=this._root,l=[],d=!1,m=0;!d;)if(i)l.push(i),i=i.left;else if(l.length>0){if(i=l.pop(),m===e)return i;m++,i=i.right}else d=!0;return null}load(e=[],i=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const d=e.length;return l&&ap(e,i,0,d-1,this._compare),this._root=$d(null,e,i,0,d),this._size=d,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,i,l,d,m){return new vx(l,m).load(e,i,d)}}function $d(r,e,i,l,d){const m=d-l;if(m>0){const _=l+Math.floor(m/2),v={key:e[_],data:i[_],parent:r};return v.left=$d(v,e,i,l,_),v.right=$d(v,e,i,_+1,d),v}return null}function ap(r,e,i,l,d){if(i>=l)return;const m=r[i+l>>1];let _=i-1,v=l+1;for(;;){do _++;while(d(r[_],m)<0);do v--;while(d(r[v],m)>0);if(_>=v)break;let S=r[_];r[_]=r[v],r[v]=S,S=e[_],e[_]=e[v],e[v]=S}ap(r,e,i,v,d),ap(r,e,v+1,l,d)}const bx=11102230246251565e-32,za=134217729,wx=(3+8*bx)*bx;function Fg(r,e,i,l,d){let m,_,v,S,A=e[0],D=l[0],P=0,k=0;D>A==D>-A?(m=A,A=e[++P]):(m=D,D=l[++k]);let F=0;if(P<r&&k<i)for(D>A==D>-A?(_=A+m,v=m-(_-A),A=e[++P]):(_=D+m,v=m-(_-D),D=l[++k]),m=_,v!==0&&(d[F++]=v);P<r&&k<i;)D>A==D>-A?(_=m+A,S=_-m,v=m-(_-S)+(A-S),A=e[++P]):(_=m+D,S=_-m,v=m-(_-S)+(D-S),D=l[++k]),m=_,v!==0&&(d[F++]=v);for(;P<r;)_=m+A,S=_-m,v=m-(_-S)+(A-S),A=e[++P],m=_,v!==0&&(d[F++]=v);for(;k<i;)_=m+D,S=_-m,v=m-(_-S)+(D-S),D=l[++k],m=_,v!==0&&(d[F++]=v);return m===0&&F!==0||(d[F++]=m),F}function Zd(r){return new Float64Array(r)}const op=Zd(4),Tx=Zd(8),w0=Zd(12),Ex=Zd(16),rl=Zd(4);function lp(r,e,i){e===null?(r.inOut=!1,r.otherInOut=!0):(r.isSubject===e.isSubject?(r.inOut=!e.inOut,r.otherInOut=e.otherInOut):(r.inOut=!e.otherInOut,r.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(r.prevInResult=!T0(e,i)||e.isVertical()?e.prevInResult:e)),r.resultTransition=T0(r,i)?(function(l,d){let m,_=!l.inOut,v=!l.otherInOut;switch(d){case 0:m=_&&v;break;case 1:m=_||v;break;case 3:m=_!==v;break;case 2:m=l.isSubject?_&&!v:v&&!_}return m?1:-1})(r,i):0}function T0(r,e){switch(r.type){case 0:switch(e){case 0:return!r.otherInOut;case 1:return r.otherInOut;case 2:return r.isSubject&&r.otherInOut||!r.isSubject&&!r.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class Vh{constructor(e,i,l,d,m){this.left=i,this.point=e,this.otherEvent=l,this.isSubject=d??!1,this.type=m||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const i=this.point,l=this.otherEvent.point;return this.left?(i[0]-e[0])*(l[1]-e[1])-(l[0]-e[0])*(i[1]-e[1])>0:(l[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(l[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new Vh(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Jl(r,e){return r[0]===e[0]&&r[1]===e[1]}function dm(r,e,i){const l=(function(d,m,_,v,S,A){const D=(m-A)*(_-S),P=(d-S)*(v-A),k=D-P;if(D===0||P===0||D>0!=P>0)return k;const F=Math.abs(D+P);return Math.abs(k)>=33306690738754716e-32*F?k:-(function(U,Z,Q,X,te,se,le){let _e,me,Ee,Se,we,De,Ne,pt,ct,dt,Tt,vt,bt,ot,At,_t,Ct,Et;const nn=U-te,rn=Q-te,$t=Z-se,Wt=X-se;ot=nn*Wt,De=za*nn,Ne=De-(De-nn),pt=nn-Ne,De=za*Wt,ct=De-(De-Wt),dt=Wt-ct,At=pt*dt-(ot-Ne*ct-pt*ct-Ne*dt),_t=$t*rn,De=za*$t,Ne=De-(De-$t),pt=$t-Ne,De=za*rn,ct=De-(De-rn),dt=rn-ct,Ct=pt*dt-(_t-Ne*ct-pt*ct-Ne*dt),Tt=At-Ct,we=At-Tt,op[0]=At-(Tt+we)+(we-Ct),vt=ot+Tt,we=vt-ot,bt=ot-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,op[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,op[2]=vt-(Et-we)+(Tt-we),op[3]=Et;let An=(function(Ri,Jn){let Zi=Jn[0];for(let yi=1;yi<4;yi++)Zi+=Jn[yi];return Zi})(0,op),_n=22204460492503146e-32*le;if(An>=_n||-An>=_n||(we=U-nn,_e=U-(nn+we)+(we-te),we=Q-rn,Ee=Q-(rn+we)+(we-te),we=Z-$t,me=Z-($t+we)+(we-se),we=X-Wt,Se=X-(Wt+we)+(we-se),_e===0&&me===0&&Ee===0&&Se===0)||(_n=11093356479670487e-47*le+wx*Math.abs(An),An+=nn*Se+Wt*_e-($t*Ee+rn*me),An>=_n||-An>=_n))return An;ot=_e*Wt,De=za*_e,Ne=De-(De-_e),pt=_e-Ne,De=za*Wt,ct=De-(De-Wt),dt=Wt-ct,At=pt*dt-(ot-Ne*ct-pt*ct-Ne*dt),_t=me*rn,De=za*me,Ne=De-(De-me),pt=me-Ne,De=za*rn,ct=De-(De-rn),dt=rn-ct,Ct=pt*dt-(_t-Ne*ct-pt*ct-Ne*dt),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=ot+Tt,we=vt-ot,bt=ot-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const Jt=Fg(4,op,4,rl,Tx);ot=nn*Se,De=za*nn,Ne=De-(De-nn),pt=nn-Ne,De=za*Se,ct=De-(De-Se),dt=Se-ct,At=pt*dt-(ot-Ne*ct-pt*ct-Ne*dt),_t=$t*Ee,De=za*$t,Ne=De-(De-$t),pt=$t-Ne,De=za*Ee,ct=De-(De-Ee),dt=Ee-ct,Ct=pt*dt-(_t-Ne*ct-pt*ct-Ne*dt),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=ot+Tt,we=vt-ot,bt=ot-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const Bn=Fg(Jt,Tx,4,rl,w0);ot=_e*Se,De=za*_e,Ne=De-(De-_e),pt=_e-Ne,De=za*Se,ct=De-(De-Se),dt=Se-ct,At=pt*dt-(ot-Ne*ct-pt*ct-Ne*dt),_t=me*Ee,De=za*me,Ne=De-(De-me),pt=me-Ne,De=za*Ee,ct=De-(De-Ee),dt=Ee-ct,Ct=pt*dt-(_t-Ne*ct-pt*ct-Ne*dt),Tt=At-Ct,we=At-Tt,rl[0]=At-(Tt+we)+(we-Ct),vt=ot+Tt,we=vt-ot,bt=ot-(vt-we)+(Tt-we),Tt=bt-_t,we=bt-Tt,rl[1]=bt-(Tt+we)+(we-_t),Et=vt+Tt,we=Et-vt,rl[2]=vt-(Et-we)+(Tt-we),rl[3]=Et;const ri=Fg(Bn,w0,4,rl,Ex);return Ex[ri-1]})(d,m,_,v,S,A,F)})(r[0],r[1],e[0],e[1],i[0],i[1]);return l>0?-1:l<0?1:0}function Wd(r,e){const i=r.point,l=e.point;return i[0]>l[0]?1:i[0]<l[0]?-1:i[1]!==l[1]?i[1]>l[1]?1:-1:(function(d,m,_){return d.left!==m.left?d.left?1:-1:dm(_,d.otherEvent.point,m.otherEvent.point)!==0?d.isBelow(m.otherEvent.point)?-1:1:!d.isSubject&&m.isSubject?1:-1})(r,e,i)}function Rc(r,e,i){const l=new Vh(e,!1,r,r.isSubject),d=new Vh(e,!0,r.otherEvent,r.isSubject);return Jl(r.point,r.otherEvent.point)&&console.warn("what is that, a collapsed segment?",r),l.contourId=d.contourId=r.contourId,Wd(d,r.otherEvent)>0&&(r.otherEvent.left=!0,d.left=!1),r.otherEvent.otherEvent=d,r.otherEvent=l,i.push(d),i.push(l),i}function G_(r,e){return r[0]*e[1]-r[1]*e[0]}function q_(r,e){return r[0]*e[0]+r[1]*e[1]}function H_(r,e,i){const l=(function(S,A,D,P){const k=[A[0]-S[0],A[1]-S[1]],F=[P[0]-D[0],P[1]-D[1]];function U(Ee,Se,we){return[Ee[0]+Se*we[0],Ee[1]+Se*we[1]]}const Z=[D[0]-S[0],D[1]-S[1]];let Q=G_(k,F),X=Q*Q;const te=q_(k,k);if(X>0){const Ee=G_(Z,F)/Q;if(Ee<0||Ee>1)return null;const Se=G_(Z,k)/Q;return Se<0||Se>1?null:Ee===0||Ee===1?[U(S,Ee,k)]:Se===0||Se===1?[U(D,Se,F)]:[U(S,Ee,k)]}if(Q=G_(Z,k),X=Q*Q,X>0)return null;const se=q_(k,Z)/te,le=se+q_(k,F)/te,_e=Math.min(se,le),me=Math.max(se,le);return _e<=1&&me>=0?_e===1?[U(S,_e>0?_e:0,k)]:me===0?[U(S,me<1?me:1,k)]:[U(S,_e>0?_e:0,k),U(S,me<1?me:1,k)]:null})(r.point,r.otherEvent.point,e.point,e.otherEvent.point),d=l?l.length:0;if(d===0||d===1&&(Jl(r.point,e.point)||Jl(r.otherEvent.point,e.otherEvent.point))||d===2&&r.isSubject===e.isSubject)return 0;if(d===1)return!Jl(r.point,l[0])&&!Jl(r.otherEvent.point,l[0])&&Rc(r,l[0],i),!Jl(e.point,l[0])&&!Jl(e.otherEvent.point,l[0])&&Rc(e,l[0],i),1;const m=[];let _=!1,v=!1;return Jl(r.point,e.point)?_=!0:Wd(r,e)===1?m.push(e,r):m.push(r,e),Jl(r.otherEvent.point,e.otherEvent.point)?v=!0:Wd(r.otherEvent,e.otherEvent)===1?m.push(e.otherEvent,r.otherEvent):m.push(r.otherEvent,e.otherEvent),_&&v||_?(e.type=1,r.type=e.inOut===r.inOut?2:3,_&&!v&&Rc(m[1].otherEvent,m[0].point,i),2):v?(Rc(m[0],m[1].point,i),3):m[0]!==m[3].otherEvent?(Rc(m[0],m[1].point,i),Rc(m[1],m[2].point,i),3):(Rc(m[0],m[1].point,i),Rc(m[3].otherEvent,m[2].point,i),3)}function E0(r,e){if(r===e)return 0;if(dm(r.point,r.otherEvent.point,e.point)!==0||dm(r.point,r.otherEvent.point,e.otherEvent.point)!==0)return Jl(r.point,e.point)?r.isBelow(e.otherEvent.point)?-1:1:r.point[0]===e.point[0]?r.point[1]<e.point[1]?-1:1:Wd(r,e)===1?e.isAbove(r.point)?-1:1:r.isBelow(e.point)?-1:1;if(r.isSubject!==e.isSubject)return r.isSubject?-1:1;{let i=r.point,l=e.point;if(i[0]===l[0]&&i[1]===l[1])return i=r.otherEvent.point,l=e.otherEvent.point,i[0]===l[0]&&i[1]===l[1]?0:(r.contourId??0)>(e.contourId??0)?1:-1}return Wd(r,e)===1?1:-1}class S0{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Sx(r,e,i,l){let d,m=r+1,_=e[r].point;const v=e.length;for(m<v&&(d=e[m].point);m<v&&d[0]===_[0]&&d[1]===_[1];){if(!i[m])return m;m++,m<v&&(d=e[m].point)}for(m=r-1;i[m]&&m>l;)m--;return m}function A0(r,e,i){const l=new S0;if(r.prevInResult!=null){const d=r.prevInResult,m=d.outputContourId;if(d.resultTransition>0){const _=e[m];if(_.holeOf!=null){const v=_.holeOf;e[v].holeIds.push(i),l.holeOf=v,l.depth=e[m].depth}else e[m].holeIds.push(i),l.holeOf=m,l.depth=e[m].depth+1}else l.holeOf=null,l.depth=e[m].depth}else l.holeOf=null,l.depth=0;return l}const Ax=Math.max,Vg=Math.min;let $_=0;function I0(r,e,i,l,d,m){let _,v,S,A,D,P;for(_=0,v=r.length-1;_<v;_++){if(S=r[_],A=r[_+1],D=new Vh(S,!1,void 0,e),P=new Vh(A,!1,D,e),D.otherEvent=P,S[0]===A[0]&&S[1]===A[1])continue;D.contourId=P.contourId=i,m||(D.isExteriorRing=!1,P.isExteriorRing=!1),Wd(D,P)>0?P.left=!0:D.left=!0;const k=S[0],F=S[1];d[0]=Vg(d[0],k),d[1]=Vg(d[1],F),d[2]=Ax(d[2],k),d[3]=Ax(d[3],F),l.push(D),l.push(P)}}const fm=[];function Z_(r,e,i){let l=r,d=e;typeof r[0][0][0]=="number"&&(l=[r]),typeof e[0][0][0]=="number"&&(d=[e]);let m=(function(k,F,U){let Z=null;return k.length*F.length===0&&(U===0?Z=fm:U===2?Z=k:(U===1||U===3)&&(Z=k.length===0?F:k)),Z})(l,d,i);if(m)return m===fm?null:m;const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=(function(k,F,U,Z,Q){const X=new hh(void 0,Wd);let te,se,le,_e,me,Ee;for(le=0,_e=k.length;le<_e;le++)for(te=k[le],me=0,Ee=te.length;me<Ee;me++)se=me===0,se&&$_++,I0(te[me],!0,$_,X,U,se);for(le=0,_e=F.length;le<_e;le++)for(te=F[le],me=0,Ee=te.length;me<Ee;me++)se=me===0,Q===2&&(se=!1),se&&$_++,I0(te[me],!1,$_,X,Z,se);return X})(l,d,_,v,i);if(m=(function(k,F,U,Z,Q){let X=null;return(U[0]>Z[2]||Z[0]>U[2]||U[1]>Z[3]||Z[1]>U[3])&&(Q===0?X=fm:Q===2?X=k:(Q===1||Q===3)&&(X=k.concat(F))),X})(l,d,_,v,i),m)return m===fm?null:m;const A=(function(k,F,U,Z,Q,X){const te=new vx(E0),se=[],le=Math.min(Z[2],Q[2]);let _e,me,Ee;for(;k.length!==0;){let Se=k.pop();if(se.push(Se),X===0&&Se.point[0]>le||X===2&&Se.point[0]>Z[2])break;if(Se.left){me=_e=te.insert(Se),Ee=te.minNode(),_e=_e!==Ee?te.prev(_e):null,me=te.next(me);const we=_e?_e.key:null;let De;if(lp(Se,we,X),me&&H_(Se,me.key,k)===2&&(lp(Se,we,X),lp(me.key,Se,X)),_e&&H_(_e.key,Se,k)===2){let Ne=_e;Ne=Ne!==Ee?te.prev(Ne):null,De=Ne?Ne.key:null,lp(we,De,X),lp(Se,we,X)}}else Se=Se.otherEvent,me=_e=te.find(Se),_e&&me&&(_e=_e!==Ee?te.prev(_e):null,me=te.next(me),te.remove(Se),me&&_e&&H_(_e.key,me.key,k))}return se})(S,0,0,_,v,i),D=(function(k){let F,U;const Z=(function(te){let se,le,_e,me,Ee;const Se=[];for(le=0,_e=te.length;le<_e;le++)se=te[le],(se.left&&se.inResult||!se.left&&se.otherEvent.inResult)&&Se.push(se);let we=!1;for(;!we;)for(we=!0,le=0,_e=Se.length;le<_e;le++)le+1<_e&&Wd(Se[le],Se[le+1])===1&&(me=Se[le],Se[le]=Se[le+1],Se[le+1]=me,we=!1);for(le=0,_e=Se.length;le<_e;le++)se=Se[le],se.otherPos=le;for(le=0,_e=Se.length;le<_e;le++)se=Se[le],se.left||(Ee=se.otherPos,se.otherPos=se.otherEvent.otherPos,se.otherEvent.otherPos=Ee);return Se})(k),Q={},X=[];for(F=0,U=Z.length;F<U;F++){if(Q[F])continue;const te=X.length,se=A0(Z[F],X,te),le=Ee=>{Q[Ee]=!0,Ee<Z.length&&Z[Ee]&&(Z[Ee].outputContourId=te)};let _e=F,me=F;for(se.points.push(Z[F].point);le(_e),_e=Z[_e].otherPos,le(_e),se.points.push(Z[_e].point),_e=Sx(_e,Z,Q,me),!(_e==me||_e>=Z.length)&&Z[_e];);X.push(se)}return X})(A),P=[];for(let k=0;k<D.length;k++){let F=D[k];if(F.isExterior()){let U=[F.points];for(let Z=0;Z<F.holeIds.length;Z++)U.push(D[F.holeIds[Z]].points);P.push(U)}}return P}function cp(r,e,i,l){const d=[],m=l===0?(_,v,S,A,D,P)=>{_.push(new Dt(P,S+(P-v)/(A-v)*(D-S)))}:(_,v,S,A,D,P)=>{_.push(new Dt(v+(P-S)/(D-S)*(A-v),P))};for(const _ of r){const v=[];for(const S of _){if(S.length<=2)continue;const A=[];for(let k=0;k<S.length-1;k++){const F=S[k].x,U=S[k].y,Z=S[k+1].x,Q=S[k+1].y,X=l===0?F:U,te=l===0?Z:Q;X<e?te>e&&m(A,F,U,Z,Q,e):X>i?te<i&&m(A,F,U,Z,Q,i):A.push(S[k]),te<e&&X>=e&&m(A,F,U,Z,Q,e),te>i&&X<=i&&m(A,F,U,Z,Q,i)}let D=S[S.length-1];const P=l===0?D.x:D.y;P>=e&&P<=i&&A.push(D),A.length&&(D=A[A.length-1],A[0].x===D.x&&A[0].y===D.y||A.push(A[0]),v.push(A))}v.length&&d.push(v)}return d}function Ix(r,e){const i=Z_(jg(r),jg([e]),0);return i==null?[]:jh(i)}function C0(r,e){let l=jg(r,65536);const d=[];for(;e.valid();e.next()){const[m,_]=e.get(),v=m.x*65536,S=m.y*65536,A=_.x*65536,D=_.y*65536,P=A-v,k=D-S,F=Math.hypot(P,k);if(F===0)continue;const U=Math.trunc(k/F*3),Z=-Math.trunc(P/F*3);d.push([[[v,S],[A,D],[A+U,D+Z],[v+U,S+Z],[v,S]]])}return d.length>0&&(l=Z_(l,d,2)),jh(l,1/65536,128)}function jg(r,e=1){return[r.map(i=>i.map(l=>[l.x*e,l.y*e]))]}function jh(r,e=1,i){return r.map(l=>l.map((d,m)=>{const _=d.map(v=>{let S=v[0],A=v[1];return i&&(S=Math.round(S/i)*i,A=Math.round(A/i)*i),new Dt(S*e,A*e)._round()});return m>0&&_.reverse(),_}))}class Hu{constructor(e,i){this.layoutVertexArray=new iu,this.indexArray=new vs,this.lineIndexArray=new nl,this.triangleSegments=new fr,this.lineSegments=new fr,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Gs)}update(e,i,l,d,m,_,v,S){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,_0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,l,d,m,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,d,m,_,void 0,v)}}class $u{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Hu(e,!1),this.elevationBufferData=new Hu(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.hasPattern=yx("fill",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:S,index:A,sourceLayerIndex:D}of e){const P=this.layers[0]._featureFilter.needGeometry,k=jn(v,P);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,l))continue;const F=m?m.evaluate(k,{},l,i.availableImages):void 0,U={id:S,properties:v.properties,type:v.type,sourceLayerIndex:D,index:A,geometry:P?k.geometry:Dn(v,l,d),patterns:{},sortKey:F};_.push(U)}m&&_.sort((v,S)=>v.sortKey-S.sortKey);for(const v of _){const{geometry:S,index:A,sourceLayerIndex:D}=v;if(this.hasPattern){const P=xx("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(v,S,A,l,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,S,A,D,this.index)}}update(e,i,l,d,m,_,v){this.bufferData.update(e,i,l,d,m,_,v,this.worldview),this.elevationBufferData.update(e,i,l,d,m,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,l,d,m,_,v,this.worldview)}addFeatures(e,i,l,d,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,d,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,l,d,m,_=[],v,S){const A=Bg(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,d,l,S):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,l,m,_,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,m,_,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,i,l,d,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,l,d,m,this.worldview))}addElevatedRoadFeature(e,i,l,d,m){const _=new Array,v=la.getElevationFeature(e,m);if(!v)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&_.push({polygons:A,elevationFeature:v,elevationTileID:l})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:d};for(const A of _)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Oa(A.elevationTileID,this.layers,this.zoom,this.lut));const P=A.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(Gn)&&(k=+e.properties[Gn]),this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,A.polygons,P,A.elevationFeature,k)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const D=new jo(l,A.elevationTileID);this.addElevatedGeometry(A.polygons,D,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,S)}}addElevatedGeometry(e,i,l,d,m,_){const v={elevation:l,elevationSampler:i,bias:d,index:m,featureInfo:_},[S,A]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,l){let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,_=null;l&&(_=l.elevationSampler.constantElevation(l.elevation,l.bias),_!=null&&(d=_,m=_));const v=(S,A,D)=>{if(l!=null)if(A.push(S),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),D.push(_);else{const P=l.elevationSampler.pointElevation(S,l.elevation,l.bias);i.elevatedLayoutVertexArray.emplaceBack(P),D.push(P),d=Math.min(d,P),m=Math.max(m,P)}};for(const S of e){let A=0;for(const se of S)A+=se.length;const D=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),P=D.vertexLength,k=[],F=[],U=[],Z=[],Q=[],X=i.layoutVertexArray.length;for(const se of S){if(se.length===0)continue;se!==S[0]&&F.push(k.length/2);const le=i.lineSegments.prepareSegment(se.length,i.layoutVertexArray,i.lineIndexArray),_e=le.vertexLength;l&&Q.push(i.layoutVertexArray.length-X),v(se[0],U,Z),i.layoutVertexArray.emplaceBack(se[0].x,se[0].y),i.lineIndexArray.emplaceBack(_e+se.length-1,_e),k.push(se[0].x),k.push(se[0].y);for(let me=1;me<se.length;me++)v(se[me],U,Z),i.layoutVertexArray.emplaceBack(se[me].x,se[me].y),i.lineIndexArray.emplaceBack(_e+me-1,_e+me),k.push(se[me].x),k.push(se[me].y);le.vertexLength+=se.length,le.primitiveLength+=se.length}const te=Ql(k,F);for(let se=0;se<te.length;se+=3)i.indexArray.emplaceBack(P+te[se],P+te[se+1],P+te[se+2]);if(te.length>0&&l&&this.elevationMode==="hd-road-base"){const se=l.elevation.isTunnel(),le=l.elevation.safeArea,_e=this.elevatedStructures.addVertices(U,Z);this.elevatedStructures.addTriangles(te,_e,se);const me=Q.length;if(me>0){for(let Ee=0;Ee<me-1;Ee++)this.elevatedStructures.addRenderableRing(l.index,Q[Ee]+_e,Q[Ee+1]-Q[Ee],se,le,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,Q[me-1]+_e,U.length-Q[me-1],se,le,l.featureInfo)}}D.vertexLength+=A,D.primitiveLength+=te.length/3}return[d,m]}prepareElevatedPolygons(e,i,l){const d=1/kt(l),m=[];for(const _ of e){const v=C0(_,new fo(i,d));m.push(...v)}return m}clipPolygonsToTile(e,i){const l=-i,d=-i,m=jt+i,_=jt+i;let v=0;const S=[],A=[];for(;v<e.length;v++){const k=e[v],F=Ll(k);(F.min.x>=l&&F.max.x<=m&&F.min.y>=d&&F.max.y<=_?S:A).push(k)}if(S.length===e.length)return e;const D=[new Dt(l,d),new Dt(m,d),new Dt(m,_),new Dt(l,_),new Dt(l,d)],P=S;for(const k of A)P.push(...Ix(k,D));return P}}let pm,mm,Uh,R0;Ft($u,"FillBucket",{omit:["layers","patternFeatures"]}),Ft(Hu,"FillBufferData"),Ft(Oa,"ElevatedStructures");class Ug{constructor(e,i,l,d){if(this.triangleCount=i.length/3,this.min=new Dt(0,0),this.max=new Dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,_]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const k=e[P];m.x=Math.min(m.x,k.x),m.y=Math.min(m.y,k.y),_.x=Math.max(_.x,k.x),_.y=Math.max(_.y,k.y)}if(d){const P=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/d);l=Math.max(l,P)}if(l===0)return;this.min=m,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const A=[];for(let P=0;P<this.triangleCount;P++){const k=e[i[3*P+0]].sub(this.min),F=e[i[3*P+1]].sub(this.min),U=e[i[3*P+2]].sub(this.min),Z=vl(Math.floor(Math.min(k.x,F.x,U.x)),this.xScale,this.cellsX),Q=vl(Math.floor(Math.max(k.x,F.x,U.x)),this.xScale,this.cellsX),X=vl(Math.floor(Math.min(k.y,F.y,U.y)),this.yScale,this.cellsY),te=vl(Math.floor(Math.max(k.y,F.y,U.y)),this.yScale,this.cellsY),se=new Dt(0,0),le=new Dt(0,0),_e=new Dt(0,0),me=new Dt(0,0);for(let Ee=X;Ee<=te;++Ee){se.y=le.y=Ee*S,_e.y=me.y=(Ee+1)*S;for(let Se=Z;Se<=Q;++Se)se.x=_e.x=Se*S,le.x=me.x=(Se+1)*S,(ar(k,F,U,se,le,me)||ar(k,F,U,se,me,_e))&&A.push({cellIdx:Ee*this.cellsX+Se,triIdx:P})}}if(A.length===0)return;A.sort((P,k)=>P.cellIdx-k.cellIdx||P.triIdx-k.triIdx);let D=0;for(;D<A.length;){const P=A[D].cellIdx,k={start:this.payload.length,len:0};for(;D<A.length&&A[D].cellIdx===P;)++k.len,this.payload.push(A[D++].triIdx);this.cells[P]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=vl(e.x-this.min.x,this.xScale,this.cellsX),d=vl(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[d*this.cellsX+l];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const v=this.payload[m.start+_],S=Math.floor(v/8),A=1<<v%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,i.push(v),i.length===this.triangleCount))return}}}query(e,i,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const d=vl(e.x-this.min.x,this.xScale,this.cellsX),m=vl(i.x-this.min.x,this.xScale,this.cellsX),_=vl(e.y-this.min.y,this.yScale,this.cellsY),v=vl(i.y-this.min.y,this.yScale,this.cellsY);for(let S=_;S<=v;S++)for(let A=d;A<=m;A++){const D=this.cells[S*this.cellsX+A];if(D)for(let P=0;P<D.len;P++){const k=this.payload[D.start+P],F=Math.floor(k/8),U=1<<k%8;if(!(this.lookup[F]&U)&&(this.lookup[F]|=U,l.push(k),l.length===this.triangleCount))return}}}}function vl(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Ft(Ug,"TriangleGridIndex");class M0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}updateAppearances(e,i,l,d){}populate(e,i,l,d){const m=[];for(const{feature:_,id:v,index:S,sourceLayerIndex:A}of e){const D=this.layers[0]._featureFilter.needGeometry,P=jn(_,D);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,l))continue;const k={id:v,properties:_.properties,type:_.type,sourceLayerIndex:A,index:S,geometry:D?P.geometry:Dn(_,l,d),patterns:{}};m.push(k)}for(const _ of m){const{geometry:v,index:S,sourceLayerIndex:A}=_;this.addFeature(_,v,S,l,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,v,S,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,l,d,m,_,v){}destroy(){}addFeature(e,i,l,d,m,_=[],v){for(const S of Bg(i,2)){const A=[],D=[],P=[],k=new Dt(1/0,1/0),F=new Dt(-1/0,-1/0);for(const Q of S)if(Q.length!==0){Q!==S[0]&&P.push(D.length/2);for(let X=0;X<Q.length;X++)D.push(Q[X].x),D.push(Q[X].y),A.push(Q[X]),k.x=Math.min(k.x,Q[X].x),k.y=Math.min(k.y,Q[X].y),F.x=Math.max(F.x,Q[X].x),F.y=Math.max(F.y,Q[X].y)}const U=Ql(D,P),Z=new Ug(A,U,8,256);this.footprints.push({vertices:A,indices:U,grid:Z,min:k,max:F})}}}Ft(M0,"ClipBucket",{omit:["layers"]});const D0=ti([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),W_=ti([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),P0=ti([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),rw=ti([{name:"a_centroid_pos",components:2,type:"Uint16"}]),X_=ti([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Y_=ti([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),k0=ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gm}=D0,_m=Number.MAX_SAFE_INTEGER,Cx=_m-1;function Gg(r,e,i,l){return r.order<e||r.order===_m||!(r.clipMask&i)||(function(d,m){return m.length!==0&&m.find(_=>_===d)===void 0})(l,r.clipScope)}function qg(r,e){return r.x-e.x||r.y-e.y}function L0(r,e){return qg(r.min,e.min)===0&&qg(r.max,e.max)===0}function ym(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function h(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!L0(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!no(r[i].clipScope,e[i].clipScope))return!1;return!0}function g(r,e,i){const l=1/jt,d=1/(1<<i.canonical.z),m=(e.x*l+i.canonical.x)*d+i.wrap,_=(e.y*l+i.canonical.y)*d;return{min:new Dt((r.x*l+i.canonical.x)*d+i.wrap,(r.y*l+i.canonical.y)*d),max:new Dt(m,_)}}function w(r,e,i){const l=1<<i.canonical.z,d=((e.x-i.wrap)*l-i.canonical.x)*jt,m=(e.y*l-i.canonical.y)*jt;return{min:new Dt(((r.x-i.wrap)*l-i.canonical.x)*jt,(r.y*l-i.canonical.y)*jt),max:new Dt(d,m)}}function R(r,e,i,l,d,m,_){const v=r.indices,S=r.vertices,A=[];for(let D=l;D<l+d;D+=3){const P=e[i[D+0]+m],k=e[i[D+1]+m],F=e[i[D+2]+m],U=Math.min(P.x,k.x,F.x),Z=Math.max(P.x,k.x,F.x),Q=Math.min(P.y,k.y,F.y),X=Math.max(P.y,k.y,F.y);A.length=0,r.grid.query(new Dt(U,Q),new Dt(Z,X),A);for(let te=0;te<A.length;te++){const se=A[te];if(ar(S[v[3*se+0]],S[v[3*se+1]],S[v[3*se+2]],P,k,F,_))return!0}}return!1}function j(r,e,i,l){if(!r||!i)return!1;let d=r.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(i.vertices.length<r.vertices.length)return j(i,l,r,e);const m=e.canonical,_=l.canonical,v=Math.pow(2,_.z-m.z);d=r.vertices.map(S=>new Dt((S.x+m.x*jt)*v-_.x*jt,(S.y+m.y*jt)*v-_.y*jt))}return R(i,d,r.indices,0,r.indices.length,0,0)}function q(r,e,i,l){const d=Math.pow(2,l.z-i.z);return new Dt((r+i.x*jt)*d-l.x*jt,(e+i.y*jt)*d-l.y*jt)}function ce(r,e){const i=[];e.grid.queryPoint(r,i);const l=e.indices,d=e.vertices;for(let m=0;m<i.length;m++){const _=i[m];if(mo([d[l[3*_+0]],d[l[3*_+1]],d[l[3*_+2]]],r))return!0}return!1}const Me=[new Dt(0,0),new Dt(jt,0),new Dt(jt,jt),new Dt(0,jt)];function ht(r,e){const i=[];let l=[];if(!e||r.length<2)return[r];if(r.length===2)return Kl(r[0],r[1],Me)?[r]:[];for(let d=0;d<r.length+2;d++){const m=r[d%r.length],_=r[(d+1)%r.length],v=Kl(d===0?r[r.length-1]:r[(d-1)%r.length],m,Me),S=Kl(m,_,Me),A=v||S;A&&l.push(m),A&&S||l.length>0&&(l.length>1&&i.push(l),l=[])}return l.length>1&&i.push(l),i}const Vt=ni.types,sn=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],hn=["fill-extrusion-flood-light-ground-radius"],Ut=Math.pow(2,13),Yt=Math.pow(2,15)-1,Wn=new Dt(0,1),di=2147483648;function $r(r,e,i,l,d,m,_,v){r.emplaceBack((e<<1)+_,(i<<1)+m,(Math.floor(l*Ut)<<1)+d,Math.round(v))}function Rt(r,e,i){r.emplaceBack(e.x*jt,e.y*jt,i?1:0)}function gt(r,e,i,l,d,m){r.emplaceBack(e.x,e.y,(i.x<<1)+l,(i.y<<1)+d,m)}function Bt(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ln{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class mi{constructor(){this.centroidXY=new Dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Or{constructor(){this.acc=new Dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,l){this.accCount++,this.acc._add(i);let d=!!this.borders;i.x<e.min.x?(e.min.x=i.x,d=!0):i.x>e.max.x&&(e.max.x=i.x,d=!0),i.y<e.min.y?(e.min.y=i.y,d=!0):i.y>e.max.y&&(e.max.y=i.y,d=!0),((i.x===0||i.x===jt)&&i.x===l.x)!=((i.y===0||i.y===jt)&&i.y===l.y)&&this.processBorderOverlap(i,l),d&&this.checkBorderIntersection(i,l)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Rn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>jt!=e.x>jt&&this.addBorderIntersection(1,Rn(i.y,e.y,(jt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Rn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>jt!=e.y>jt&&this.addBorderIntersection(3,Rn(i.x,e.x,(jt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Dt(0,0):new Dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function ii(r,e){const i=r.add(e)._unit(),l=xe(r.x*i.x+r.y*i.y,-1,1);var d,m,_;return _=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(_)))/4*Yt*((d=r).x*(m=e).y-d.y*m.x<0?-1:1)}const Ji=[r=>r.x<0,r=>r.x>jt,r=>r.y<0,r=>r.y>jt];function gr(r,e,i,l){const d=[4];if(l===0)return d;i._mult(l);const m=r.sub(i),_=e.sub(i),v=[r,e,m,_];for(let S=0;S<4;S++)for(const A of v)if(Ji[S](A)){d.push(S);break}return d}class Cr{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Ds,this.indexArray=new vs,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut},i=>hn.includes(i)),this._segments=new fr,this.hiddenByLandmarkVertexArray=new Jf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new fr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,l,d=!1){const m=e.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let S;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const A=e[0],D=e[1];S=ii(A.sub(e[m-1])._perp()._unit(),D.sub(A)._perp()._unit())}for(let A=0;A<m;A++){const D=A===m-1?0:A+1,P=e[A],k=e[D],F=e[D===m-1?0:D+1],U=k.sub(P)._perp()._unit(),Z=ii(U,F.sub(k)._perp()._unit()),Q=S,X=Z;if(sw(P,k,i)||d&&uA(P,i)&&uA(k,i)){S=Z;continue}const te=v.vertexLength;gt(this.vertexArray,P,k,1,1,Q),gt(this.vertexArray,P,k,1,0,Q),gt(this.vertexArray,P,k,0,1,X),gt(this.vertexArray,P,k,0,0,X),v.vertexLength+=4;const se=gr(P,k,U,l);for(const le of se)this._segmentToGroundQuads[_].push({id:te,region:le}),this._segmentToRegionTriCounts[_][le]+=2,v.primitiveLength+=2;S=Z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort((d,m)=>d.region-m.region);for(let l=0;l<i;l++){const d=this._segmentToGroundQuads[l],m=e[l],_=this._segmentToRegionTriCounts[l];_.reduce((S,A)=>S+A,0);let v=0;for(let S=0;S<=4;S++){const A=_[S];if(A!==0){let D=this.regionSegments[S];D||(D=this.regionSegments[S]=new fr);const P={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:A};D.get().push(P)}v+=A}for(let S=0;S<d.length;S++){const A=d[S].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,l,d,m,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,l,d,m,_,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,W_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,P0.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,l,d,m,_,v,S){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,l,d,m,_,v,S)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&di))}updateHiddenByLandmarkRange(e,i,l){if(!this.hasData())return;const d=i+e;if(i!==0){for(let m=e;m<d;++m)this.hiddenByLandmarkVertexArray.emplace(m,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Y_.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class cu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new vs,this.footprintVertices=new iu,this.footprintSegments=[],this.layoutVertexArray=new Tc,this.centroidVertexArray=new su,this.wallVertexArray=new vg,this.indexArray=new vs,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut},i=>sn.includes(i)),this.segments=new fr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Cr(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.features=[],this.hasPattern=yx("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=kt(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:_,index:v,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,D=jn(m,A);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),D,l))continue;const P={id:_,sourceLayerIndex:S,index:v,geometry:A?D.geometry:Dn(m,l,d),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length,F=Vt[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:xx("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const U of P.geometry)for(const Z of ht(U,F))this.addFeature(m.id,P,[Z],v,l,{},i.availableImages,d,i.brightness);else this.addFeature(m.id,P,P.geometry,v,l,{},i.availableImages,d,i.brightness);i.featureIndex.insert(m,P.geometry,v,S,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,l,d,m,_){for(const{featureId:v,feature:S}of this.features){const A=Vt[S.type]==="Polygon",{geometry:D}=S;if(this.wallMode)for(const P of D)for(const k of ht(P,A))this.addFeature(v,S,[k],S.index,i,l,d,m,_);else this.addFeature(v,S,D,S.index,i,l,d,m,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview),this.groundEffect.update(e,i,m,l,d,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,X_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,k0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rw.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,d,m,_,v,S,A){const D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,P=[new Dt(0,0),new Dt(jt,jt)],k=S.projection,F=k.name==="globe",U=this.wallMode||Vt[i.type]==="Polygon",Z=new Or;Z.centroidDataIndex=this.centroidData.length;const Q=new mi;Q.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(Q.buildingId=Number(i.properties.building_id));const X=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,te=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let se;if(Q.height=te,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Mh),this.wallMode){if(F)return void kn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;se=(function(De){const Ne=De[0].x===De[De.length-1].x&&De[0].y===De[De.length-1].y;(function($t){let Wt=0;const An=$t.length;for(let _n=0;_n<An;_n++)Wt+=($t[(_n+1)%An].x-$t[_n].x)*($t[(_n+1)%An].y+$t[_n].y);return Wt>=0})(De)||(De=De.reverse());const ct={geometry:[],joinNormals:[],indices:[]},dt=[],Tt=[],vt=[];let bt=De.length;for(;bt>=2&&De[bt-1].equals(De[bt-2]);)bt--;if(bt<(Ne?3:2))return ct;let ot,At,_t,Ct,Et,nn=0;for(;nn<bt-1&&De[nn].equals(De[nn+1]);)nn++;Ne&&(ot=De[bt-2],Et=De[nn].sub(ot)._unit()._perp());for(let $t=nn;$t<bt;$t++){if(_t=$t===bt-1?Ne?De[nn+1]:void 0:De[$t+1],_t&&De[$t].equals(_t))continue;Et&&(Ct=Et),ot&&(At=ot),ot=De[$t],Et=_t?_t.sub(ot)._unit()._perp():Ct,Ct=Ct||Et;let Wt=Ct.add(Et);Wt.x===0&&Wt.y===0||Wt._unit();const An=Wt.x*Et.x+Wt.y*Et.y,_n=An!==0?1/An:1/0,Jt=Ct.x*Et.y-Ct.y*Et.x>0;let Bn="miter";const ri=2;Bn==="miter"&&_n>ri&&(Bn="bevel"),Bn==="bevel"&&(_n>100&&(Bn="flipbevel"),_n<ri&&(Bn="miter"));const Ri=(Jn,Zi,yi,os)=>{const wi=new Dt(Jn.x,Jn.y),ji=new Dt(Jn.x,Jn.y);wi.x+=Zi.x*os,wi.y+=Zi.y*os,ji.x-=Zi.x*Math.max(yi,1),ji.y-=Zi.y*Math.max(yi,1),vt.push(Zi),dt.push(wi),Tt.push(ji)};if(Bn==="miter")Wt._mult(_n),Ri(ot,Wt,0,0);else if(Bn==="flipbevel")Wt=Et.mult(-1),Ri(ot,Wt,0,0),Ri(ot,Wt.mult(-1),0,0);else{const Jn=-Math.sqrt(_n*_n-1),Zi=Jt?Jn:0,yi=Jt?0:Jn;At&&Ri(ot,Ct,Zi,yi),_t&&Ri(ot,Et,Zi,yi)}}ct.geometry=[...dt,...Tt.reverse(),dt[0]],ct.joinNormals=[...vt,...vt.reverse(),vt[vt.length-1]];const rn=ct.geometry.length-1;for(let $t=0;$t<rn/2;$t++)if($t+1<rn/2){let Wt=$t,An=$t+1,_n=rn-1-$t,Jt=rn-2-$t;Wt=Wt===0?rn-1:Wt-1,An=An===0?rn-1:An-1,_n=_n===0?rn-1:_n-1,Jt=Jt===0?rn-1:Jt-1,ct.indices.push(_n),ct.indices.push(An),ct.indices.push(Wt),ct.indices.push(_n),ct.indices.push(Jt),ct.indices.push(An)}return ct})(l[0]),l=[se.geometry]}const le=(De,Ne)=>De<(Ne.length-1)/2||De===Ne.length-1,_e=this.wallMode?[l]:Bg(l,500);for(let De=_e.length-1;De>=0;De--){const Ne=_e[De];(Ne.length===0||pO(Ne[0]))&&_e.splice(De,1)}let me;if(F)me=pA(_e,P,m);else{me=[];for(const De of _e)me.push({polygon:De,bounds:P})}const Ee=U?this.edgeRadius:0,Se=Ee>0&&this.zoom<17,we=(De,Ne)=>{if(De.length===0)return!1;const pt=De[De.length-1];return Ne.x===pt.x&&Ne.y===pt.y};for(const{polygon:De,bounds:Ne}of me){let pt=0,ct=0;for(const bt of De)U&&!bt[0].equals(bt[bt.length-1])&&bt.push(bt[0]),ct+=U?bt.length-1:bt.length;const dt=this.segments.prepareSegment((U?5:4)*ct,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const Tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},vt=new ln;if(vt.vertexOffset=this.footprintVertices.length,vt.indexOffset=3*this.footprintIndices.length,vt.ringIndices=[],U){const bt=[],ot=[];pt=dt.vertexLength;for(let _t=0;_t<De.length;_t++){const Ct=De[_t];Ct.length&&_t!==0&&ot.push(bt.length/2);const Et=[];let nn,rn;nn=Ct[1].sub(Ct[0])._perp()._unit(),vt.ringIndices.push(Ct.length-1);for(let $t=1;$t<Ct.length;$t++){const Wt=Ct[$t],An=Ct[$t===Ct.length-1?1:$t+1],_n=Wt.clone();if(Ee){rn=An.sub(Wt)._perp()._unit();const Jt=nn.add(rn)._unit(),Bn=Ee*Math.min(4,1/(nn.x*Jt.x+nn.y*Jt.y));_n.x+=Bn*Jt.x,_n.y+=Bn*Jt.y,_n.x=Math.round(_n.x),_n.y=Math.round(_n.y),nn=rn}if(!X||Ee!==0&&!Se||we(Et,_n)||Et.push(_n),$r(this.layoutVertexArray,_n.x,_n.y,0,0,1,1,0),this.wallMode){const Jt=le($t,Ct);Rt(this.wallVertexArray,se.joinNormals[$t],!Jt)}dt.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),bt.push(Wt.x,Wt.y),F&&Bt(this.layoutVertexExtArray,k.projectTilePoint(_n.x,_n.y,m),k.upVector(m,_n.x,_n.y))}X&&(Ee===0||Se)&&(Et.length!==0&&we(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Ne,D))}const At=this.wallMode?se.indices:Ql(bt,ot);for(let _t=0;_t<At.length;_t+=3)this.footprintIndices.emplaceBack(vt.vertexOffset+At[_t+0],vt.vertexOffset+At[_t+1],vt.vertexOffset+At[_t+2]),this.indexArray.emplaceBack(pt+At[_t],pt+At[_t+2],pt+At[_t+1]),dt.primitiveLength++;vt.indexCount+=At.length,vt.vertexCount+=this.footprintVertices.length-vt.vertexOffset}for(let bt=0;bt<De.length;bt++){const ot=De[bt];Z.startRing(Q,ot[0]);let At=ot.length>4&&hA(ot[ot.length-2],ot[0],ot[1]),_t=Ee?fO(ot[ot.length-2],ot[0],ot[1],Ee):0;const Ct=[];let Et,nn,rn;nn=ot[1].sub(ot[0])._perp()._unit();let $t=!0;for(let Wt=1,An=0;Wt<ot.length;Wt++){let _n=ot[Wt-1],Jt=ot[Wt];const Bn=ot[Wt===ot.length-1?1:Wt+1];if(Z.appendEdge(Q,Jt,_n),sw(Jt,_n,Ne)){Ee&&(nn=Bn.sub(Jt)._perp()._unit(),$t=!$t);continue}const ri=Jt.sub(_n)._perp(),Ri=ri.x/(Math.abs(ri.x)+Math.abs(ri.y)),Jn=ri.y>0?1:0,Zi=_n.dist(Jt);if(An+Zi>32768&&(An=0),Ee){rn=Bn.sub(Jt)._perp()._unit();let ji=cA(_n,Jt,Bn,O0(nn,rn),Ee);isNaN(ji)&&(ji=0);const Tr=Jt.sub(_n)._unit();_n=_n.add(Tr.mult(_t))._round(),Jt=Jt.add(Tr.mult(-ji))._round(),_t=ji,nn=rn,X&&this.zoom>=17&&(we(Ct,_n)||Ct.push(_n),we(Ct,Jt)||Ct.push(Jt))}const yi=dt.vertexLength,os=ot.length>4&&hA(_n,Jt,Bn);let wi=dA(An,At,$t);if($r(this.layoutVertexArray,_n.x,_n.y,Ri,Jn,0,0,wi),$r(this.layoutVertexArray,_n.x,_n.y,Ri,Jn,0,1,wi),this.wallMode){const ji=le(Wt-1,ot),Tr=se.joinNormals[Wt-1];Rt(this.wallVertexArray,Tr,ji),Rt(this.wallVertexArray,Tr,ji)}if(An+=Zi,wi=dA(An,os,!$t),At=os,$r(this.layoutVertexArray,Jt.x,Jt.y,Ri,Jn,0,0,wi),$r(this.layoutVertexArray,Jt.x,Jt.y,Ri,Jn,0,1,wi),this.wallMode){const ji=le(Wt,ot),Tr=se.joinNormals[Wt];Rt(this.wallVertexArray,Tr,ji),Rt(this.wallVertexArray,Tr,ji)}if(dt.vertexLength+=4,this.indexArray.emplaceBack(yi+0,yi+1,yi+2),this.indexArray.emplaceBack(yi+1,yi+3,yi+2),dt.primitiveLength+=2,Ee){const ji=pt+(Wt===1?ot.length-2:Wt-2),Tr=Wt===1?pt:ji+1;if(this.indexArray.emplaceBack(yi+1,ji,yi+3),this.indexArray.emplaceBack(ji,Tr,yi+3),dt.primitiveLength+=2,Et===void 0&&(Et=yi),!sw(Bn,ot[Wt],Ne)){const zr=Wt===ot.length-1?Et:dt.vertexLength;this.indexArray.emplaceBack(yi+2,yi+3,zr),this.indexArray.emplaceBack(yi+3,zr+1,zr),this.indexArray.emplaceBack(yi+3,Tr,zr+1),dt.primitiveLength+=3}$t=!$t}if(F){const ji=this.layoutVertexExtArray,Tr=k.projectTilePoint(_n.x,_n.y,m),zr=k.projectTilePoint(Jt.x,Jt.y,m),Nr=k.upVector(m,_n.x,_n.y),ls=k.upVector(m,Jt.x,Jt.y);Bt(ji,Tr,Nr),Bt(ji,Tr,Nr),Bt(ji,zr,ls),Bt(ji,zr,ls)}}U&&(pt+=ot.length-1),X&&Ee&&this.zoom>=17&&(Ct.length!==0&&we(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,Ne,D,Ee>0))}this.footprintSegments.push(vt),Tt.triangleCount=this.indexArray.length-Tt.triangleArrayOffset,this.polygonSegments.push(Tt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=Z.borders?Wn:this.encodeCentroid(Z,Q),this.centroidData.push(Q),Z.borders){this.featuresOnBorder.push(Z);const De=this.featuresOnBorder.length-1;for(let Ne=0;Ne<Z.borders.length;Ne++)Z.borders[Ne][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ne].push(De)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,_,v,m,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,d,_,v,m,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,te)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],A=+(S.min.y+S.max.y>jt),D=2*A+(+(S.min.x+S.max.x>jt)^A);for(let P=0;P<S.polygonSegLen;P++){const k=S.polygonSegIdx+P;e.push({centroidIdx:v,subtile:D,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new vs;e.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let l=0,d=0,m=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;m++}const _=e.length;for(;d!==e.length;){l=e[d].triangleSegmentIdx;let v=0,S=d,A=d;for(let D=S;D<m&&e[D].subtile===v;D++)A++;for(;S!==m;){const D=e[S];v=D.subtile;const P=this.centroidData[D.centroidIdx].min.clone(),k=this.centroidData[D.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=S;U<A;U++){const Z=e[U],Q=this.polygonSegments[Z.polygonSegmentIdx],X=this.centroidData[Z.centroidIdx].min,te=this.centroidData[Z.centroidIdx].max,se=this.indexArray.uint16;for(let le=Q.triangleArrayOffset;le<Q.triangleArrayOffset+Q.triangleCount;le++)i.emplaceBack(se[3*le],se[3*le+1],se[3*le+2]);F.primitiveLength+=Q.triangleCount,P.x=Math.min(P.x,X.x),P.y=Math.min(P.y,X.y),k.x=Math.max(k.x,te.x),k.y=Math.max(k.y,te.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:P,max:k}),S=A;for(let U=S;U<m&&e[U].subtile===e[S].subtile;U++)A++}d=m;for(let D=d;D<_&&e[D].triangleSegmentIdx===e[d].triangleSegmentIdx;D++)m++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,l){const d=new fr;if(this.wallMode){for(const Z of this.triangleSubSegments)d.segments.push(Z.segment);return d}let m=0,_=0;const v=1<<e.canonical.z;if(i){const Z=i.getMinMaxForTile(e);Z&&(m=Z.min,_=Z.max)}_+=this.maxHeight;const S=e.toUnwrapped();let A;const D=[S.canonical.x/v+S.wrap,S.canonical.y/v],P=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],k=(Z,Q,X)=>[Z[0]*(1-X[0])+Q[0]*X[0],Z[1]*(1-X[1])+Q[1]*X[1]],F=[],U=[];for(const Z of this.triangleSubSegments){F[0]=Z.min.x/jt,F[1]=Z.min.y/jt,U[0]=Z.max.x/jt,U[1]=Z.max.y/jt;const Q=k(D,P,F),X=k(D,P,U);if(new Ai([Q[0],Q[1],m],[X[0],X[1],_]).intersectsPrecise(l)===0){A&&(d.segments.push(A),A=void 0);continue}const te=Z.segment;A&&A.vertexOffset!==te.vertexOffset&&(d.segments.push(A),A=void 0),A?(A.vertexLength+=te.vertexLength,A.primitiveLength+=te.primitiveLength):A={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&d.segments.push(A),d}encodeCentroid(e,i){const l=e.centroid(),d=i.span(),m=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Dt(xe(l.x,1,8191)<<3|m,xe(l.y,1,8191)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Dt(0,0);const i=e.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const d=i[0][0]!==l?0:1;return new Dt(6|(i[0][0]!==l?0:65528),(i[d][0]+i[d][1])/2<<3|6)}{const d=i[2][0]!==l?2:3;return new Dt((i[d][0]+i[d][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,d=e.flags&di?Wn:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==d.y||m!==d.x){for(let _=i;_<l;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped());if(h(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const S of this.centroidData)S.flags&di||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y||_.footprint.buildingIds.has(S.buildingId)&&(S.flags|=di);else for(const S of this.centroidData)if(!(S.flags&di||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y))for(let A=0;A<S.footprintSegLen;A++){const D=this.footprintSegments[S.footprintSegIdx+A];if(m.length=0,mO(this.footprintVertices,D.vertexOffset,D.vertexCount,_.footprintTileId.canonical,e.canonical,m),R(_.footprint,m,this.footprintIndices.uint16,D.indexOffset,D.indexCount,-D.vertexOffset,-v)){S.flags|=di;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,l){let d=!1;for(let m=0;m<l.footprintSegLen;m++){const _=this.footprintSegments[l.footprintSegIdx+m];let v=0;for(const S of _.ringIndices){for(let A=v,D=S+v-1;A<S+v;D=A++){const P=this.footprintVertices.int16[2*(A+_.vertexOffset)+0],k=this.footprintVertices.int16[2*(A+_.vertexOffset)+1],F=this.footprintVertices.int16[2*(D+_.vertexOffset)+1];k>i!=F>i&&e<(this.footprintVertices.int16[2*(D+_.vertexOffset)+0]-P)*(i-k)/(F-k)+P&&(d=!d)}v=S}}return d}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,d=!0;const m=4*(e+jt)*jt+(i+jt);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&di)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=l||this.footprintContainsPoint(e,i,_)&&(l=_.height,this.partLookup[m]=_,d=!!(_.flags&di));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:d};this.partLookup[m]=void 0}}function O0(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function fO(r,e,i,l){const d=e.sub(r)._perp()._unit(),m=i.sub(e)._perp()._unit();return cA(r,e,i,O0(d,m),l)}function cA(r,e,i,l,d){const m=Math.sqrt(1-l*l);return Math.min(r.dist(e)/3,e.dist(i)/3,d*m/l)}function sw(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function uA(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function pO(r){return r.every(e=>e.x<=0)||r.every(e=>e.x>=jt)||r.every(e=>e.y<=0)||r.every(e=>e.y>=jt)}function hA(r,e,i){if(r.x<0||r.x>=jt||e.x<0||e.x>=jt||i.x<0||i.x>=jt)return!1;const l=i.sub(e),d=l.perp(),m=r.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function dA(r,e,i){const l=e?2|r:-3&r;return i?1|l:-2&l}function fA(){const r=Math.PI/32,e=Math.tan(r),i=Ae;return i*Math.sqrt(1+2*e*e)-i}function pA(r,e,i){const l=1<<i.z,d=ut(i.x/l),m=ut((i.x+1)/l),_=xt(i.y/l),v=xt((i.y+1)/l);return(function(S,A,D,P,k=0,F){const U=[];if(!S.length||!D||!P)return U;const Z=(me,Ee)=>{for(const Se of me)U.push({polygon:Se,bounds:Ee})},Q=Math.ceil(Math.log2(D)),X=Math.ceil(Math.log2(P)),te=Q-X,se=[];for(let me=0;me<Math.abs(te);me++)se.push(te>0?0:1);for(let me=0;me<Math.min(Q,X);me++)se.push(0),se.push(1);let le=S;if(le=cp(le,A[0].y-k,A[1].y+k,1),le=cp(le,A[0].x-k,A[1].x+k,0),!le.length)return U;const _e=[];for(se.length?_e.push({polygons:le,bounds:A,depth:0}):Z(le,A);_e.length;){const me=_e.pop(),Ee=me.depth,Se=se[Ee],we=me.bounds[0],De=me.bounds[1],Ne=Se===0?we.x:we.y,pt=Se===0?De.x:De.y,ct=F?F(Se,Ne,pt):.5*(Ne+pt),dt=cp(me.polygons,Ne-k,ct+k,Se),Tt=cp(me.polygons,ct-k,pt+k,Se);if(dt.length){const vt=[we,new Dt(Se===0?ct:De.x,Se===1?ct:De.y)];se.length>Ee+1?_e.push({polygons:dt,bounds:vt,depth:Ee+1}):Z(dt,vt)}if(Tt.length){const vt=[new Dt(Se===0?ct:we.x,Se===1?ct:we.y),De];se.length>Ee+1?_e.push({polygons:Tt,bounds:vt,depth:Ee+1}):Z(Tt,vt)}}return U})(r,e,Math.ceil((m-d)/11.25),Math.ceil((_-v)/11.25),1,(S,A,D)=>{if(S===0)return .5*(A+D);{const P=xt((i.y+A/jt)/l);return(Xe(.5*(xt((i.y+D/jt)/l)+P))*l-i.y)*jt}})}function mO(r,e,i,l,d,m){const _=Math.pow(2,l.z-d.z);for(let v=0;v<i;v++){let S=r.int16[2*(v+e)+0],A=r.int16[2*(v+e)+1];S=(S+d.x*jt)*_-l.x*jt,A=(A+d.y*jt)*_-l.y*jt,m.push(new Dt(S,A))}}let mA,gA;Ft(cu,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(mi,"PartData"),Ft(ln,"FootprintSegment"),Ft(Or,"BorderCentroidData"),Ft(Cr,"GroundEffect");class Hg extends Dt{constructor(e,i,l){super(e,i),this.z=l}}class _A extends Hg{constructor(e,i,l,d){super(e,i,l),this.w=d}}function yA(r,e,i,l){const d=i==="x"?"y":"x",m=(l-r[i])/(e[i]-r[i]);r[d]=Math.round(r[d]+(e[d]-r[d])*m),r[i]=l,r.hasOwnProperty("z")&&(r.z=Rn(r.z,e.z,m)),r.hasOwnProperty("w")&&(r.w=Rn(r.w,e.w,m))}function xA(r,e,i,l){const d=i,m=l;for(const _ of["x","y"]){let v=r,S=e;v[_]>=S[_]&&(v=e,S=r),v[_]<d&&S[_]>d&&yA(v,S,_,d),v[_]<m&&S[_]>m&&yA(S,v,_,m)}}function z0(r,e,i,l,d,m){const _=[];for(let v=0;v<r.length;v++){const S=r[v];let A;const D=_.length;let P=0;for(let k=0;k<S.length-1;k++){let F=S[k],U=S[k+1],Z=0;const Q=P;let X,te;m&&(Z=Math.hypot(U.x-F.x,U.y-F.y),P+=Z,X=F,te=U),F.x<e&&U.x<e||(F.x<e?F=new Dt(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x<e&&(U=new Dt(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y<i&&U.y<i||(F.y<i?F=new Dt(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round():U.y<i&&(U=new Dt(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round()),F.x>=l&&U.x>=l||(F.x>=l?F=new Dt(l,F.y+(l-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x>=l&&(U=new Dt(l,F.y+(l-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y>=d&&U.y>=d||(F.y>=d?F=new Dt(F.x+(d-F.y)/(U.y-F.y)*(U.x-F.x),d)._round():U.y>=d&&(U=new Dt(F.x+(d-F.y)/(U.y-F.y)*(U.x-F.x),d)._round()),A&&F.equals(A[A.length-1])||(A=[F],_.push(A),m&&m.push({progress:{min:Q+vA(X,te,F)*Z,max:1},parentIndex:v,prevPoint:X,nextPoint:te})),A.push(U),m&&(m[m.length-1].progress.max=Q+vA(X,te,U)*Z,m[m.length-1].nextPoint=te)))))}if(m&&P>0)for(let k=D;k<_.length;k++)m[k].progress.min/=P,m[k].progress.max/=P}return _}function gO(r,e,i,l,d){if(r.length<2)return void l.push(r);const m=[];for(;e.valid();){const[A,D]=e.get();for(let P=0;P<r.length-1;P++){const k=r[P],F=r[P+1],U=Vd(k,F,A,D);if(U){const[Z]=U,Q=new Dt(Rn(k.x,F.x,Z),Rn(k.y,F.y,Z));m.push({t:P+Z,distance:0,point:Q})}}e.next()}if(m.length===0)return void l.push(r);m.sort((A,D)=>A.t-D.t);let _=0,v=0,S=[];for(l.push(S);_!==r.length;){if(v===m.length){for(;_!==r.length;)S.length!==0&&S[S.length-1].equals(r[_])||S.push(r[_]),_++;break}m[v].t<=_?(S.length!==0&&S[S.length-1].equals(m[v].point)||S.push(m[v].point),Math.trunc(m[v].t),v++):(S.length!==0&&S[S.length-1].equals(r[_])||S.push(r[_]),_++)}}function vA(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Rx(r,e){return r.x*e.x+r.y*e.y}function bA(r,e){if(r.length===1){let i=0;const l=e[i++];let d;for(;!d||l.equals(d);)if(d=e[i++],!d)return 1/0;for(;i<e.length;i++){const m=e[i],_=r[0],v=d.sub(l),S=m.sub(l),A=_.sub(l),D=Rx(v,v),P=Rx(v,S),k=Rx(S,S),F=Rx(A,v),U=Rx(A,S),Z=D*k-P*P,Q=(k*F-P*U)/Z,X=(D*U-P*F)/Z,te=l.z*(1-Q-X)+d.z*Q+m.z*X;if(isFinite(te))return te}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function wA(r,e,i){let l=1/0;rr(i,e)&&(l=bA(i,e[0]));for(let d=0;d<e.length;d++){const m=e[d],_=r[d];for(let v=0;v<m.length-1;v++){const S=m[v],A=[S,m[v+1],_[v+1],_[v],S];wr(i,A)&&(l=Math.min(l,bA(i,A)))}}return l!==1/0&&l}function TA(r,e,i,l,d,m,_,v,S,A,D){return r.projection.name==="globe"?(function(P,k,F,U,Z,Q,X,te,se,le,_e){const me=[],Ee=[],Se=P.projection.upVectorScale(_e,P.center.lat,P.worldSize).metersToTile,we=[0,0,0,1],De=[0,0,0,1],Ne=(ct,dt,Tt,vt)=>{ct[0]=dt,ct[1]=Tt,ct[2]=vt,ct[3]=1},pt=fA();F>0&&(F+=pt),U+=pt;for(const ct of k){const dt=[],Tt=[];for(const vt of ct){const bt=vt.x+Z.x,ot=vt.y+Z.y,At=P.projection.projectTilePoint(bt,ot,_e),_t=P.projection.upVector(_e,vt.x,vt.y);let Ct=F,Et=U;if(X){const nn=EA(bt,ot,F,U,X,te,se,le);Ct+=nn.base,Et+=nn.top}F!==0?Ne(we,At.x+_t[0]*Se*Ct,At.y+_t[1]*Se*Ct,At.z+_t[2]*Se*Ct):Ne(we,At.x,At.y,At.z),Ne(De,At.x+_t[0]*Se*Et,At.y+_t[1]*Se*Et,At.z+_t[2]*Se*Et),Cn(we,we,Q),Cn(De,De,Q),dt.push(new Hg(we[0],we[1],we[2])),Tt.push(new Hg(De[0],De[1],De[2]))}me.push(dt),Ee.push(Tt)}return[me,Ee]})(r,e,i,l,d,m,_,v,S,A,D):_?(function(P,k,F,U,Z,Q,X,te,se){const le=[],_e=[],me=[0,0,0,1];for(const Ee of P){const Se=[],we=[];for(const De of Ee){const Ne=De.x+U.x,pt=De.y+U.y,ct=EA(Ne,pt,k,F,Q,X,te,se);me[0]=Ne,me[1]=pt,me[2]=ct.base,me[3]=1,bs(me,me,Z),me[3]=Math.max(me[3],1e-5);const dt=new Hg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);me[0]=Ne,me[1]=pt,me[2]=ct.top,me[3]=1,bs(me,me,Z),me[3]=Math.max(me[3],1e-5);const Tt=new Hg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);Se.push(dt),we.push(Tt)}le.push(Se),_e.push(we)}return[le,_e]})(e,i,l,d,m,_,v,S,A):(function(P,k,F,U,Z){const Q=[],X=[],te=Z[8]*k,se=Z[9]*k,le=Z[10]*k,_e=Z[11]*k,me=Z[8]*F,Ee=Z[9]*F,Se=Z[10]*F,we=Z[11]*F;for(const De of P){const Ne=[],pt=[];for(const ct of De){const dt=ct.x+U.x,Tt=ct.y+U.y,vt=Z[0]*dt+Z[4]*Tt+Z[12],bt=Z[1]*dt+Z[5]*Tt+Z[13],ot=Z[2]*dt+Z[6]*Tt+Z[14],At=Z[3]*dt+Z[7]*Tt+Z[15],_t=vt+te,Ct=bt+se,Et=ot+le,nn=Math.max(At+_e,1e-5),rn=vt+me,$t=bt+Ee,Wt=ot+Se,An=Math.max(At+we,1e-5);Ne.push(new Hg(_t/nn,Ct/nn,Et/nn)),pt.push(new Hg(rn/An,$t/An,Wt/An))}Q.push(Ne),X.push(pt)}return[Q,X]})(e,i,l,d,m)}function EA(r,e,i,l,d,m,_,v){const S=_*d.getElevationAt(r,e,!0,!0),A=m[0]!==0,D=A?m[1]===0?_*(m[0]/7-450):_*(function(P,k,F){const U=Math.floor(k[0]/8),Z=Math.floor(k[1]/8),Q=10*(k[0]-8*U),X=10*(k[1]-8*Z),te=P.getElevationAt(U,Z,!0,!0),se=P.getMeterToDEM(F),le=Math.floor(.5*(Q*se-1)),_e=Math.floor(.5*(X*se-1)),me=P.tileCoordToPixel(U,Z),Ee=2*le+1,Se=2*_e+1,we=(function(Tt,vt,bt,ot,At){return[Tt.getElevationAtPixel(vt,bt,!0),Tt.getElevationAtPixel(vt+At,bt,!0),Tt.getElevationAtPixel(vt,bt+At,!0),Tt.getElevationAtPixel(vt+ot,bt+At,!0)]})(P,me.x-le,me.y-_e,Ee,Se),De=Math.abs(we[0]-we[1]),Ne=Math.abs(we[2]-we[3]),pt=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),ct=Math.min(.25,.5*se*(De+Ne)/Ee),dt=Math.min(.25,.5*se*pt/Se);return te+Math.max(ct*Q,dt*X)})(d,m,v):S;return{base:S+(i===0?-1:i),top:A?Math.max(D+l,S+i+2):S+l}}class _O{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yO{constructor(){this.tasks={},this.taskQueue=[],tn(["process"],this),this.invoker=new _O(this.process),this.nextId=0}add(e,i){const l=this.nextId++,d=(function({type:m,isSymbolTile:_,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||_?m!=="parseTile"||_?m==="parseTile"&&_?300-v:m==="maybePrepare"&&_?400-v:500:200-v:100-v})(i);if(d===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:i,priority:d,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<i&&(i=m.priority,e=d)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class SA{constructor(e,i,l){this.target=e,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},tn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new yO}send(e,i,l,d,m=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[v]=l);const S=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:qr(i,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(i.mustQueue||vr(self)){const d=this.callbacks[l],m=this.scheduler.add(()=>this.processTask(l,i),d&&d.metadata||{type:"message"});m&&(this.cancelCallbacks[l]=m)}else this.processTask(l,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(i.error?l(yl(i.error)):l(null,yl(i.data)))}else{const l=new Set,d=i.hasCallback?(_,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?qr(_):null,data:qr(v,l)},l)}:()=>{},m=yl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,d);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:v,scope:S}=m;this.parent.getWorkerSource(i.sourceMapId,_[0],v,S)[_[1]](m,d)}else d(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Mx={workerUrl:"",workerClass:null,workerParams:void 0};function xO(r){return Mx.workerClass!=null?new Mx.workerClass:new self.Worker(Mx.workerUrl,Object.assign({name:r},Mx.workerParams))}const aw="mapboxgl_preloaded_worker_pool";class $g{constructor(e){this.active={},this.name=e}acquire(e,i=$g.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const l=xO(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(l)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[aw]}numActive(){return Object.keys(this.active).length}}$g.workerCount=2;class K_{constructor(e,i,l="Worker",d=$g.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Pt();const m=this.workerPool.acquire(this.id,d);for(let _=0;_<m.length;_++){const v=new K_.Actor(m[_],i,this.id);v.name=`${l} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,l){$e(this.actors,(d,m)=>{d.send(e,i,m)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Dx,ow;function N0(){return Dx||(Dx=new $g),Dx}K_.Actor=SA;const lw=4096;class vO{constructor(e){this.module=e,this.memoryStack=this.module.malloc(lw),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>lw?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>lw?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,l){this.module.setFauxFacadeOptions(e?1:0,i?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const v of e){const S=this.createIntArray(v.ringIndices),A=this.createFloatArray(v.coordinates);if(S===-1||A===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,A,S,v.ringIndices.length-1)}for(const v of i){let S;S=v.entrances?JSON.parse(v.entrances):[];const A=this.createFloatArray(S),D=this.createFloatArray(v.coordinates);if(A===-1||D===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,A,S.length,D,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const l=this.module.getMeshCount(),d=new Array(l);for(let v=0;v<l;v++){const S=this.module.getPositionsPtr(v),A=this.module.getPositionsLength(v),D=new Float32Array(this.module.heapF32.buffer,S,A),P=this.module.getNormalsPtr(v),k=this.module.getNormalsLength(v),F=new Float32Array(this.module.heapF32.buffer,P,k),U=this.module.getAOPtr(v),Z=this.module.getAOLength(v),Q=new Float32Array(this.module.heapF32.buffer,U,Z),X=this.module.getUVPtr(v),te=this.module.getUVLength(v),se=new Float32Array(this.module.heapF32.buffer,X,te),le=this.module.getFauxFacadePtr(v),_e=this.module.getFauxFacadeLength(v),me=new Uint8Array(this.module.heapU8.buffer,le,_e),Ee=this.module.getIndicesPtr(v),Se=this.module.getIndicesLength(v),we=new Int16Array(this.module.heap16.buffer,Ee,Se),De=this.module.getBuildingPart(v);d[v]={positions:D,normals:F,ao:Q,uv:se,isFauxFacade:me,indices:we,buildingPart:De}}const m=this.module.getRingCount(),_=[];for(let v=0;v<m;v++){const S=this.module.getRingPtr(v),A=this.module.getRingLength(v),D=new Float32Array(this.module.heapF32.buffer,S,A);_.push(D)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Px,cw,Gh,Q_,uw,J_=null,ey=null,AA=null,B0=null;function IA(){return vr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:cw||ts.DRACO_URL}function CA(){if(vr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Q_)return Q_;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Q_=WebAssembly.validate(r)?ts.MESHOPT_SIMD_URL:ts.MESHOPT_URL,Q_}function bO(){return B0}const RA=5120,MA=5121,DA=5122,PA=5123,kA=5125,LA=5126,F0={[RA]:Int8Array,[MA]:Uint8Array,[DA]:Int16Array,[PA]:Uint16Array,[kA]:Uint32Array,[LA]:Float32Array},wO={[RA]:"DT_INT8",[MA]:"DT_UINT8",[DA]:"DT_INT16",[PA]:"DT_UINT16",[kA]:"DT_UINT32",[LA]:"DT_FLOAT32"},kx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function OA(r,e,i){const l=i.json.bufferViews.length,d=i.buffers.length;e.bufferView=l,i.json.bufferViews[l]={buffer:d,byteLength:r.byteLength},i.buffers[d]=r}const hw="KHR_draco_mesh_compression";function TO(r,e){const i=r.extensions&&r.extensions[hw];if(!i)return;const l=new Gh.Decoder,d=FA(e,i.bufferView),m=new Gh.Mesh;if(!l.DecodeArrayToMesh(d,d.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],v=F0[_.componentType],S=_.count*v.BYTES_PER_ELEMENT,A=Gh._malloc(S);v===Uint16Array?l.GetTrianglesUInt16Array(m,S,A):l.GetTrianglesUInt32Array(m,S,A),OA(Gh.memory.buffer.slice(A,A+S),_,e),Gh._free(A);for(const D of Object.keys(i.attributes)){const P=l.GetAttributeByUniqueId(m,i.attributes[D]),k=e.json.accessors[r.attributes[D]],F=wO[k.componentType],U=k.count*kx[k.type]*F0[k.componentType].BYTES_PER_ELEMENT,Z=Gh._malloc(U);l.GetAttributeDataArrayForAllPoints(m,P,Gh[F],U,Z),OA(Gh.memory.buffer.slice(Z,Z+U),k,e),Gh._free(Z)}l.destroy(),m.destroy(),delete r.extensions[hw]}const V0="EXT_meshopt_compression";function EO(r,e){if(!r.extensions||!r.extensions[V0])return;const i=r.extensions[V0],l=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),d=new Uint8Array(i.count*i.byteStride);uw.decodeGltfBuffer(d,i.count,i.byteStride,l,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=d.buffer,delete r.extensions[V0]}const zA=1179937895,NA=new TextDecoder("utf8");function BA(r,e){return new URL(r,e).href}function SO(r,e,i,l){return fetch(BA(r.uri,l)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[i]=d})}function FA(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function AO(r,e,i,l){if(r.uri){const d=BA(r.uri,l);return fetch(d).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[i]=m})}if(r.bufferView!==void 0){const d=FA(e,r.bufferView),m=new Blob([d],{type:r.mimeType});return createImageBitmap(m).then(_=>{e.images[i]=_})}}function VA(r,e=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===zA){const D=new Uint32Array(r,e);let P=2;const k=(D[P++]>>2)-3,F=D[P++]>>2;if(P++,l.json=JSON.parse(NA.decode(D.subarray(P,P+F))),P+=F,P<k){const U=D[P++];P++;const Z=e+(P<<2);l.buffers[0]=r.slice(Z,Z+U)}}else l.json=JSON.parse(NA.decode(new Uint8Array(r,e)));const{buffers:d,images:m,meshes:_,extensionsUsed:v,bufferViews:S}=l.json;let A=Promise.resolve();if(d){const D=[];for(let P=0;P<d.length;P++){const k=d[P];k.uri?D.push(SO(k,l,P,i)):l.buffers[P]||(l.buffers[P]=null)}A=Promise.all(D)}return A.then(()=>{const D=[],P=v&&v.includes(hw),k=v&&v.includes(V0);if(P&&D.push((function(){if(!Gh)return Px??(Px=(function(F){let U,Z=null;function Q(){U=new Uint8Array(Z.buffer)}function X(){throw new Error("Unexpected Draco error.")}const te={a:{a:X,d:function(se,le,_e){return U.copyWithin(se,le,le+_e)},c:function(se){const le=U.length,_e=Math.max(se>>>0,Math.ceil(1.2*le)),me=Math.ceil((_e-le)/65536);try{return Z.grow(me),Q(),!0}catch{return!1}},b:X}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,te):F.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,te))).then(se=>{const{Rb:le,Qb:_e,P:me,T:Ee,X:Se,Ja:we,La:De,Qa:Ne,Va:pt,Wa:ct,eb:dt,jb:Tt,f:vt,e:bt,yb:ot,zb:At,Ab:_t,Bb:Ct,Db:Et,Gb:nn}=se.instance.exports;Z=bt;const rn=(()=>{let $t=0,Wt=0,An=0,_n=0;return Jt=>{An&&(le(_n),le($t),Wt+=An,An=$t=0),$t||(Wt+=128,$t=_e(Wt));const Bn=Jt.length+7&-8;let ri=$t;Bn>=Wt&&(An=Bn,ri=_n=_e(Bn));for(let Ri=0;Ri<Jt.length;Ri++)U[ri+Ri]=Jt[Ri];return ri}})();return Q(),vt(),{memory:bt,_free:le,_malloc:_e,Mesh:class{constructor(){this.ptr=me()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){Tt(this.ptr)}DecodeArrayToMesh($t,Wt,An){const _n=rn($t),Jt=De(this.ptr,_n,Wt,An.ptr);return!!Se(Jt)}GetAttributeByUniqueId($t,Wt){return{ptr:Ne(this.ptr,$t.ptr,Wt)}}GetTrianglesUInt16Array($t,Wt,An){pt(this.ptr,$t.ptr,Wt,An)}GetTrianglesUInt32Array($t,Wt,An){ct(this.ptr,$t.ptr,Wt,An)}GetAttributeDataArrayForAllPoints($t,Wt,An,_n,Jt){dt(this.ptr,$t.ptr,Wt.ptr,An,_n,Jt)}},DT_INT8:ot(),DT_UINT8:At(),DT_INT16:_t(),DT_UINT16:Ct(),DT_UINT32:Et(),DT_FLOAT32:nn()}})})(fetch(IA())),Px.then(F=>{Gh=F,Px=void 0}))})()),k&&D.push((function(){if(uw)return;const F=(function(U){let Z;const Q=WebAssembly.instantiateStreaming(U,{}).then(se=>{Z=se.instance,Z.exports.__wasm_call_ctors()}),X={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(se,le,_e,me,Ee,Se){(function(we,De,Ne,pt,ct,dt,Tt){const vt=we.exports.sbrk,bt=pt+3&-4,ot=vt(bt*ct),At=vt(dt.length),_t=new Uint8Array(we.exports.memory.buffer);_t.set(dt,At);const Ct=De(ot,pt,ct,At,dt.length);if(Ct===0&&Tt&&Tt(ot,bt,ct),Ne.set(_t.subarray(ot,ot+pt*ct)),vt(ot-vt(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(Z,Z.exports[te[Ee]],se,le,_e,me,Z.exports[X[Se]])}}})(fetch(CA()));return F.ready.then(()=>{uw=F})})()),m)for(let F=0;F<m.length;F++)D.push(AO(m[F],l,F,i));return(D.length?Promise.all(D):Promise.resolve()).then(()=>{if(P&&_)for(const{primitives:F}of _)for(const U of F)TO(U,l);if(k&&_&&S)for(const F of S)EO(F,l);return l})})}function jA(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>VA(e,0,r))}function dw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function fw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class pw{constructor(e,i,l,d){this.context=e,this.format=l,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:d&&d.premultiply})}update(e,i){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:_}=m,{x:v,y:S}=i&&i.position?i.position:{x:0,y:0},A=v+l,D=S+d;!this.size||this.size[0]===A&&this.size[1]===D||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&D>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(A,D)))+1:1;_.texStorage2D(_.TEXTURE_2D,k,this.format,A,D),this.size=[A,D]}this.size&&(P?_.texSubImage2D(_.TEXTURE_2D,0,v,S,dw(this.format),fw(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,S,l,d,dw(this.format),fw(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,l=!1){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,l,d,m){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),this.wrapS=l),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Lx{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}}const IO=ti([{name:"a_pos_3f",components:3,type:"Float32"}]),CO=ti([{name:"a_color_3f",components:3,type:"Float32"}]),RO=ti([{name:"a_color_4f",components:4,type:"Float32"}]),MO=ti([{name:"a_uv_2f",components:2,type:"Float32"}]),DO=ti([{name:"a_normal_3f",components:3,type:"Float32"}]),PO=ti([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),kO=ti([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function UA(r,e){const i=j0(r.projection,r.zoom,r.width,r.height),l=(function(m,_,v,S,A){const D=new ge(v.lng-180*xm,v.lat),P=new ge(v.lng+180*xm,v.lat),k=m.project(D.lng,D.lat),F=m.project(P.lng,P.lat),U=-Math.atan2(F.y-k.y,F.x-k.x),Z=qt.fromLngLat(v);Z.y=xe(Z.y,-1+xm,1-xm);const Q=Z.toLngLat(),X=m.project(Q.lng,Q.lat),te=qt.fromLngLat(Q);te.x+=xm;const se=te.toLngLat(),le=m.project(se.lng,se.lat),_e=qA(le.x-X.x,le.y-X.y,U),me=qt.fromLngLat(Q);me.y+=xm;const Ee=me.toLngLat(),Se=m.project(Ee.lng,Ee.lat),we=qA(Se.x-X.x,Se.y-X.y,U),De=Math.abs(_e.x)/Math.abs(we.y),Ne=Ke([]);Oe(Ne,Ne,-U*(1-(A?0:S)));const pt=Ke([]);return Mt(pt,pt,[1,1-(1-De)*S,1]),pt[4]=-we.x/we.y*S,Oe(pt,pt,U),nt(pt,Ne,pt),pt})(r.projection,0,r.center,i,e),d=GA(r);return Mt(l,l,[d,d,1]),l}function GA(r){const e=r.projection,i=j0(r.projection,r.zoom,r.width,r.height),l=mw(e,r.center),d=mw(e,ge.convert(e.center));return Math.pow(2,l*i+(1-i)*d)}function j0(r,e,i,l,d=1/0){const m=r.range;if(!m)return 0;const _=Math.min(d,Math.max(i,l)),v=Math.log2(_/1024);return Fe(m[0]+v,m[1]+v,e)}const xm=1/4e4;function mw(r,e){const i=xe(e.lat,-85.051129,Le),l=new ge(e.lng-180*xm,i),d=new ge(e.lng+180*xm,i),m=r.project(l.lng,i),_=r.project(d.lng,i),v=qt.fromLngLat(l),S=qt.fromLngLat(d),A=_.x-m.x,D=_.y-m.y,P=S.x-v.x,k=S.y-v.y,F=Math.sqrt((P*P+k*k)/(A*A+D*D));return Math.log2(F)}function qA(r,e,i){const l=Math.cos(i),d=Math.sin(i);return{x:r*l-e*d,y:r*d+e*l}}function HA(r,e,i){Ke(r),Oe(r,r,oi(e[2])),cn(r,r,oi(e[0])),St(r,r,oi(e[1])),Mt(r,r,i),nt(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function U0(r,e,i,l,d,m,_,v){const S=[i[0]-e[0],i[1]-e[1],0],A=[l[0]-e[0],l[1]-e[1],0];if(dn(S)<1e-12||dn(A)<1e-12)return Tn(r);const D=Vr([],S,A);qn(D,D),Kn(A,l,e),S[2]=(m-d)*v,A[2]=(_-d)*v;const P=S;return Vr(P,S,A),qn(P,P),Pr(r,D,P)}function G0(r,e,i=!1){const l=Fh(e.zoom),d=(function(m,_,v){const S=_.worldSize,A=[m[12],m[13],m[14]],D=xt(A[1]/S),P=ut(A[0]/S),k=Ke([]),F=Ze(1,D)*S,U=Ze(1,0)*S*rt(D,_.zoom),Z=1/Rg(S);let Q=U*Z;if(v){const le=j0(_.projection,_.zoom,_.width,_.height,1024);Q=Z*_.projection.pixelSpaceConversion(_.center.lat,S,le)}const X=Te(D,P);wn(X,X,Be([],qn([],X),F*Q*A[2]));const te=(function(le){const _e=[le[0],le[1],le[2]];let me=[0,1,0];const Ee=Vr([],me,_e);return Vr(me,_e,Ee),ki(me)===0&&(me=[0,1,0],Vr(Ee,_e,me)),qn(Ee,Ee),qn(me,me),qn(_e,_e),[Ee[0],Ee[1],Ee[2],0,me[0],me[1],me[2],0,_e[0],_e[1],_e[2],0,le[0],le[1],le[2],1]})(X);Mt(k,k,[Q,Q,Q*F]),Ge(k,k,[-A[0],-A[1],-A[2]]);const se=nt([],_.globeMatrix,te);return nt(se,se,k),nt(se,se,m),se})(r,e,i);if(l>0){const m=(function(_,v){const S=v.worldSize,A=Ze(1,0)*S*rt(v.center.lat,v.zoom)/Rg(S),D=Ze(1,v.center.lat)*S,P=Ke([]);St(P,P,oi(v.center.lng)),cn(P,P,oi(v.center.lat)),Ge(P,P,[0,0,ee]),Mt(P,P,[A,A,A*D]);const k=v.point;return Ge(P,P,[-k.x,-k.y,0]),nt(P,P,_),nt(P,v.globeMatrix,P)})(r,e);return(function(_,v,S){const A=(U,Z,Q)=>{const X=dn(U),te=dn(Z),se=Uu(U,Z,Q);return Be(se,se,1/dn(se)*Rn(X,te,Q))},D=A([_[0],_[1],_[2]],[v[0],v[1],v[2]],S),P=A([_[4],_[5],_[6]],[v[4],v[5],v[6]],S),k=A([_[8],_[9],_[10]],[v[8],v[9],v[10]],S),F=Uu([_[12],_[13],_[14]],[v[12],v[13],v[14]],S);return[D[0],D[1],D[2],0,P[0],P[1],P[2],0,k[0],k[1],k[2],0,F[0],F[1],F[2],1]})(d,m,l)}return d}function gw(r,e,i,l){const d=Ai.projectAabbCorners(l,i);let m=Number.MAX_VALUE;for(let v=0;v<d.length;++v){const S=d[v];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<m&&(m=S[2])}const _=(function(v){const S=[];let A=0;for(let F=1;F<v.length;F++)(v[F][0]<v[A][0]||v[F][0]===v[A][0]&&v[F][1]<v[A][1])&&(A=F);let D,P=A;const k=new Uint8Array(v.length);do{if(k[P])break;S.push(new Dt(v[P][0],v[P][1])),k[P]=1,D=(P+1)%v.length;for(let F=0;F<v.length;F++){if(v[F][0]===v[D][0]&&v[F][1]===v[D][1]||v[F][0]===v[P][0]&&v[F][1]===v[P][1])continue;const U=[v[F][0]-v[P][0],v[F][1]-v[P][1]],Z=[v[D][0]-v[P][0],v[D][1]-v[P][1]],Q=U[0]*Z[1]-U[1]*Z[0];(Q>0||Q===0&&U[0]*Z[0]+U[1]*Z[1]>=0&&U[0]*U[0]+U[1]*U[1]>Z[0]*Z[0]+Z[1]*Z[1])&&(D=F)}P=D}while(P!==A);return S.length>0&&S.push(S[0]),S})(d);if(wr(r,_))return m}const Zg=64,ty={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function q0(r,e,i,l,d,m,_,v,S,A=!1){const D=i.zoom,P=i.project(l),k=rt(l.lat,D),F=1/k;Ke(r),Ge(r,r,[P.x+_[0]*F,P.y+_[1]*F,_[2]]);let U=1,Z=1;const Q=i.worldSize;if(A){if(i.projection.name==="mercator"){let le=0;i.elevation&&(le=i.elevation.getAtPointOrZero(new qt(P.x/Q,P.y/Q),0));const _e=bs([],[P.x,P.y,le,1],i.projMatrix)[3]/i.cameraToCenterDistance;U=_e,Z=_e*rt(i.center.lat,D)}else if(i.projection.name==="globe"){const le=G0(r,i),_e=[0,0,0,1];bs(_e,_e,nt([],i.projMatrix,le));const me=_e[3]/i.cameraToCenterDistance,Ee=Fh(D),Se=i.projection.pixelsPerMeter(l.lat,Q)*rt(l.lat,D),we=i.projection.pixelsPerMeter(i.center.lat,Q)*rt(i.center.lat,D);U=me/Rn(Se,mt(i.center.lat),Ee),Z=me*k/Se,U*=we,Z*=we}}else U=F;Mt(r,r,[U,U,Z]);const X=[...r],te=e.orientation,se=[];if(HA(se,[te[0]+(d?d[0]:0),te[1]+(d?d[1]:0),te[2]+(d?d[2]:0)],m),nt(r,X,se),v&&i.elevation){let le=0;const _e=[];if(S&&i.elevation){le=(function(Ee,Se,we,De,Ne){const pt=Se.elevation;if(!pt)return 0;const ct=Ai.projectAabbCorners(we,De),dt=Ze(1,Ne.lat)*Se.worldSize,Tt=(function(Wt,An){const _n=[0,0,1],Jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Bn of Jt){const ri=Wt[Bn.corners[0]],Ri=Wt[Bn.corners[1]],Jn=Wt[Bn.corners[2]],Zi=[Ri[0]-ri[0],Ri[1]-ri[1],An*(Ri[2]-ri[2])],yi=Vr(Zi,Zi,[Jn[0]-ri[0],Jn[1]-ri[1],An*(Jn[2]-ri[2])]);qn(yi,yi),Bn.dotProductWithUp=Ni(yi,_n)}return Jt.sort((Bn,ri)=>Bn.dotProductWithUp-ri.dotProductWithUp),Jt[0].corners})(ct,dt),vt=ct[Tt[0]],bt=ct[Tt[1]],ot=ct[Tt[2]],At=ct[Tt[3]],_t=pt.getAtPointOrZero(new qt(vt[0]/Se.worldSize,vt[1]/Se.worldSize),0),Ct=pt.getAtPointOrZero(new qt(bt[0]/Se.worldSize,bt[1]/Se.worldSize),0),Et=pt.getAtPointOrZero(new qt(ot[0]/Se.worldSize,ot[1]/Se.worldSize),0),nn=pt.getAtPointOrZero(new qt(At[0]/Se.worldSize,At[1]/Se.worldSize),0),rn=(_t+nn)/2,$t=(Ct+Et)/2;return rn>$t?Ct<Et?U0(Ee,bt,At,vt,Ct,nn,_t,dt):U0(Ee,ot,vt,At,Et,_t,nn,dt):_t<nn?U0(Ee,vt,bt,ot,_t,Ct,Et,dt):U0(Ee,At,ot,bt,nn,Et,Ct,dt),Math.max(rn,$t)})(_e,i,e.aabb,r,l);const me=nt([],He([],_e),se);nt(r,X,me)}else le=i.elevation.getAtPointOrZero(new qt(P.x/Q,P.y/Q),0);le!==0&&(r[14]+=le)}}class $A{constructor(e,i,l,d,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=l!=null?new ge(l[0],l[1]):new ge(0,0),this.orientation=d??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){nt(e.globalMatrix,i,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const _=[];m=l.orientation,Ke(d=_),St(d,d,oi(m[1])),Oe(d,d,oi(m[2])),cn(d,d,oi(m[0])),nt(e.globalMatrix,e.globalMatrix,_)}var d,m;if(e.meshes)for(const _ of e.meshes){const v=Ai.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Ke([]);this.aabb=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,l,d,m,_,v=!1){q0(this.matrix,this,e.transform,this.position,i,l,d,m,_,v)}upload(e){if(!this.uploaded){for(const i of this.nodes)_w(i,e);for(const i of this.nodes)H0(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)yw(e)}}function Ox(r,e,i=!1){r.uploaded||(r.gfxTexture=new pw(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function LO(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,IO.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,DO.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,MO.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?CO:RO).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,kO.members,!0)),r.segments=fr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&Ox(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&Ox(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&Ox(l.normalTexture,e),l.occlusionTexture&&Ox(l.occlusionTexture,e,i),l.emissionTexture&&Ox(l.emissionTexture,e)}function _w(r,e,i){if(r.meshes)for(const l of r.meshes)LO(l,e,i);if(r.children)for(const l of r.children)_w(l,e,i)}function H0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)H0(e)}function OO(r){r.pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()}function yw(r){if(r.meshes)for(const e of r.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&OO(e.material));if(r.children)for(const e of r.children)yw(e)}function Wg(r,e){const i=r.json.bufferViews[e.bufferView],l=F0[e.componentType];return new l(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==kx[e.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:kx[e.type]))}function xw(r,e,i,l){const d=F0[e.componentType],m=(function(D){switch(D){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),_=r.json.bufferViews[e.bufferView],v=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:kx[e.type],S=i.float32,A=S.length/i.capacity;for(let D=0,P=0;D<e.count*v;D+=v,P+=A)for(let k=0;k<A;k++)S[P+k]=l[D+k]*m;i._trim()}function zO(r,e,i){const l=r.indices,d=r.attributes,m={};m.indexArray=new vs;const _=e.json.accessors[l],v=_.count/3;m.indexArray.reserve(v);const S=Wg(e,_);for(let k=0;k<v;k++)m.indexArray.emplaceBack(S[3*k],S[3*k+1],S[3*k+2]);m.indexArray._trim(),m.vertexArray=new tl;const A=e.json.accessors[d.POSITION];m.vertexArray.reserve(A.count);const D=Wg(e,A);for(let k=0;k<A.count;k++)m.vertexArray.emplaceBack(D[3*k],D[3*k+1],D[3*k+2]);if(m.vertexArray._trim(),m.aabb=new Ai(A.min,A.max),m.centroid=(function(k,F){const U=[0,0,0],Z=k.length;if(Z>0){for(let Q=0;Q<Z;Q++){const X=3*k[Q];U[0]+=F[X],U[1]+=F[X+1],U[2]+=F[X+2]}U[0]/=Z,U[1]/=Z,U[2]/=Z}return U})(S,D),d.COLOR_0!==void 0){const k=e.json.accessors[d.COLOR_0],F=kx[k.type],U=Wg(e,k);m.colorArray=F===3?new tl:new Zl,m.colorArray.resize(k.count),xw(e,k,m.colorArray,U)}if(d.NORMAL!==void 0){m.normalArray=new tl;const k=e.json.accessors[d.NORMAL];m.normalArray.resize(k.count);const F=Wg(e,k);xw(e,k,m.normalArray,F)}if(d.TEXCOORD_0!==void 0&&i.length>0){m.texcoordArray=new Vu;const k=e.json.accessors[d.TEXCOORD_0];m.texcoordArray.resize(k.count);const F=Wg(e,k);xw(e,k,m.texcoordArray,F)}if(d._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Wg(e,k))}d._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Wg(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const P=r.material;return m.material=(function(k,F){const{emissiveFactor:U=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:Q=.5,normalTexture:X,occlusionTexture:te,emissiveTexture:se,doubleSided:le,name:_e}=k,{baseColorFactor:me=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Se=1,baseColorTexture:we,metallicRoughnessTexture:De}=k.pbrMetallicRoughness||{},Ne=te?F[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Ne){const pt=te.extensions.KHR_texture_transform;Ne.offsetScale=[pt.offset[0],pt.offset[1],pt.scale[0],pt.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new Ei(...me),metallicFactor:Ee,roughnessFactor:Se,baseColorTexture:we?F[we.index]:void 0,metallicRoughnessTexture:De?F[De.index]:void 0},doubleSided:le,emissiveFactor:new Ei(...U),alphaMode:Z,alphaCutoff:Q,normalTexture:X?F[X.index]:void 0,occlusionTexture:Ne,emissionTexture:se?F[se.index]:void 0,defined:k.defined===void 0}})(P!==void 0?e.json.materials[P]:{defined:!1},i),m}function ZA(r,e,i){const{matrix:l,rotation:d,translation:m,scale:_,mesh:v,extras:S,children:A,name:D}=r,P={};if(P.name=D,P.localMatrix=l||(function(k,F,U,Z){var Q=F[0],X=F[1],te=F[2],se=F[3],le=Q+Q,_e=X+X,me=te+te,Ee=Q*le,Se=Q*_e,we=Q*me,De=X*_e,Ne=X*me,pt=te*me,ct=se*le,dt=se*_e,Tt=se*me,vt=Z[0],bt=Z[1],ot=Z[2];return k[0]=(1-(De+pt))*vt,k[1]=(Se+Tt)*vt,k[2]=(we-dt)*vt,k[3]=0,k[4]=(Se-Tt)*bt,k[5]=(1-(Ee+pt))*bt,k[6]=(Ne+ct)*bt,k[7]=0,k[8]=(we+dt)*ot,k[9]=(Ne-ct)*ot,k[10]=(1-(Ee+De))*ot,k[11]=0,k[12]=U[0],k[13]=U[1],k[14]=U[2],k[15]=1,k})([],d||[0,0,0,1],m||[0,0,0],_||[1,1,1]),P.globalMatrix=Ye(P.localMatrix),v!==void 0){P.meshes=i[v];const k=P.anchor=[0,0];for(const F of P.meshes){const{min:U,max:Z}=F.aabb;k[0]+=U[0]+Z[0],k[1]+=U[1]+Z[1]}k[0]=Math.floor(k[0]/P.meshes.length/2),k[1]=Math.floor(k[1]/P.meshes.length/2)}if(S&&(S.id&&(P.id=S.id),S.lights&&(P.lights=(function(k){if(!k.length)return[];const F=(function(te){const se=atob(te),le=new Uint8Array(se.length);for(let _e=0;_e<se.length;_e++)le[_e]=se.codePointAt(_e);return le})(k),U=[],Z=F.length/24,Q=new Uint16Array(F.buffer),X=new Float32Array(F.buffer);for(let te=0;te<Z;te++){const se=Q[2*te*6]/30,le=Q[2*te*6+1]/30,_e=Q[2*te*6+10]/100,me=X[6*te+1],Ee=X[6*te+2],Se=X[6*te+3],we=X[6*te+4],De=Se-me,Ne=we-Ee,pt=Math.hypot(De,Ne);U.push({pos:[me+.5*De,Ee+.5*Ne,le],normal:[Ne/pt,-De/pt,0],width:pt,height:se,depth:_e,points:[me,Ee,Se,we]})}return U})(S.lights)),S.MAPBOX_geometry_bloom&&(P.isGeometryBloom=S.MAPBOX_geometry_bloom)),A){const k=[];for(const F of A)k.push(ZA(e.json.nodes[F],e,i));P.children=k}return P}function NO(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Ug(r.vertices,r.indices,8,256),[i,l]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:l}}function BO(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],S=_[1];typeof v=="number"&&typeof S=="number"&&l.push(new Dt(v,S))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let d=0;for(let _=0;_<l.length;_++){const v=l[_],S=l[(_+1)%l.length],A=l[(_+2)%l.length];d+=(v.x-S.x)*(A.y-S.y)-(A.x-S.x)*(v.y-S.y)}d>0&&l.reverse();const m=Ql(l.flatMap(_=>[_.x,_.y]),[]);return m.length===0?null:{vertices:l,indices:m}}function FO(r,e){const i=[],l=[];let d=0;const m=[];for(const _ of r){d=i.length;const v=_.vertexArray.float32,S=_.indexArray.uint16;for(let A=0;A<_.vertexArray.length;A++)m[0]=v[3*A+0],m[1]=v[3*A+1],m[2]=v[3*A+2],Cn(m,m,e),i.push(new Dt(m[0],m[1]));for(let A=0;A<3*_.indexArray.length;A++)l.push(S[A]+d)}if(l.length%3!=0)return null;for(let _=0;_<l.length;_+=3){const v=i[l[_+0]],S=i[l[_+1]],A=i[l[_+2]];(v.x-S.x)*(A.y-S.y)-(A.x-S.x)*(v.y-S.y)>0&&([l[_+1],l[_+2]]=[l[_+2],l[_+1]])}return{vertices:i,indices:l}}function vw(r){const e=(function(S,A){const D=[],P=WebGL2RenderingContext;if(S.json.textures)for(const k of S.json.textures){const F={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};k.sampler!==void 0&&Object.assign(F,S.json.samplers[k.sampler]),D.push({image:A[k.source],sampler:F,uploaded:!1})}return D})(r,r.images),i=(function(S,A){const D=[];for(const P of S.json.meshes){const k=[];for(const F of P.primitives)k.push(zO(F,S,A));D.push(k)}return D})(r,e),{scenes:l,scene:d,nodes:m}=r.json,_=l?l[d||0].nodes:[...m.keys()],v=[];for(const S of _)v.push(ZA(m[S],r,i));return(function(S,A,D){const P={},k=new Set;for(let F=0;F<S.length;F++){const U=D[A[F]];if(!U.extras)continue;const Z=U.extras["mapbox:footprint:version"],Q=U.extras["mapbox:footprint:id"];(Z||Q)&&k.add(F),Z==="1.0.0"&&Q&&(P[Q]=F)}for(let F=0;F<S.length;F++){if(k.has(F))continue;const U=S[F],Z=D[A[F]];if(!Z.extras)continue;let Q=null;U.id in P&&(Q=FO(S[P[U.id]].meshes,U.localMatrix)),Q||(Q=BO(Z)),Q&&(U.footprint=NO(Q))}if(k.size>0){const F=Array.from(k.values()).sort((U,Z)=>U-Z);for(let U=F.length-1;U>=0;U--)S.splice(F[U],1)}})(v,_,r.json.nodes),v}function VO(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,l=r.aabb.min[1]-1,d=Zg/(r.aabb.max[0]-i+2),m=Zg/(r.aabb.max[1]-l+2);for(let _=0;_<e.length;_+=3){const v=e[_+2],S=(e[_+0]-i)*d|0,A=(e[_+1]-l)*m|0;v>r.heightmap[A*Zg+S]&&(r.heightmap[A*Zg+S]=v)}}function WA(r,e,i,l,d){i.reserve(i.length+4*r.length),l.reserve(l.length+10*r.length),d.reserve(d.length+10*r.length);let m=l.length;for(const _ of r){const v=Math.min(10,Math.max(4,1.3*_.height))*e,S=[-_.normal[1],_.normal[0],0],A=Math.min(.29,.1*_.width/_.depth),D=_.width-2*_.depth*e*(A+.01),P=En([],_.pos,S,D/2),k=En([],_.pos,S,-D/2),F=[P[0],P[1],P[2]+_.height],U=[k[0],k[1],k[2]+_.height],Z=En([],_.normal,S,A);Be(Z,Z,v);const Q=En([],_.normal,S,-A);Be(Q,Q,v),wn(Z,P,Z),wn(Q,k,Q),P[2]+=.1,k[2]+=.1,l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(Q[0],Q[1],Q[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(k[0],k[1],k[2]),l.emplaceBack(F[0],F[1],F[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(k[0],k[1],k[2]),l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(Q[0],Q[1],Q[2]);const X=D/v/2;d.emplaceBack(-X-A,-1,X,.8),d.emplaceBack(X+A,-1,X,.8),d.emplaceBack(-X,0,X,1.3),d.emplaceBack(X,0,X,1.3),d.emplaceBack(X+A,-.8,X,.7),d.emplaceBack(X+A,-.8,X,.7),d.emplaceBack(0,0,X,1.3),d.emplaceBack(0,0,X,1.3),d.emplaceBack(X+A,-1.2,X,.8),d.emplaceBack(X+A,-1.2,X,.8),i.emplaceBack(6+m,4+m,8+m),i.emplaceBack(7+m,9+m,5+m),i.emplaceBack(0+m,1+m,2+m),i.emplaceBack(1+m,3+m,2+m),m+=10}}function jO(r,e){const i={};i.indexArray=new vs,i.vertexArray=new tl,i.colorArray=new Zl,WA(r,e,i.indexArray,i.vertexArray,i.colorArray);const l={defined:!0};l.emissiveFactor=Ei.black;const d={};return d.baseColorFactor=Ei.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const XA=ti([{name:"a_pos_3f",components:3,type:"Float32"}]),UO=ti([{name:"a_normal_3",components:3,type:"Int16"}]),GO=ti([{name:"a_centroid_3",components:3,type:"Int16"}]),YA=ti([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),qO=ti([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),HO=ti([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),$O=ti([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),ZO=ti([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),WO=ti([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),KA=ni.types,$0=32767;function XO(r,e){const i=jt+e;for(const l of r)for(const d of l)if(d.x<-e||d.x>i||d.y<-e||d.y>i)return!1;return!0}function YO(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class bw{constructor(){this.layoutVertexArray=new tl,this.layoutAttenuationArray=new Zl,this.layoutColorArray=new nl,this.indexArray=new vs,this.indexArrayForConflation=new vs,this.segmentsBucket=new fr}}class ww{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new fr,this.entranceBloom=new bw;const i=66560;this.layoutVertexArray=new tl,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new Hl,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new Hl,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new nl,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new Od,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new Jf,this.layoutAOArray.reserve(i),this.indexArray=new vs,this.indexArray.reserve(66560),this.indexArrayForConflation=new vs,this.segmentsBucket=new fr,this.entranceBloom=new bw,e&&(this.layoutFacadePaintArray=new nl,this.layoutFacadeDataArray=new Rh,this.layoutFacadeVerticalRangeArray=new nl)}reserve(e,i,l){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),l&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class QA{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Vu,this.footprintsIndices=new Od,this.footprintsMin=new Dt(1/0,1/0),this.footprintsMax=new Dt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new ww(!1),this.buildingWithFacade=new ww(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new Cr(e),this.groundEffect.groundRadiusArray=new Gs,this.hasAppearances=null}updateFootprints(e,i){const l=new Ug([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:l,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:d,id:e})}updateAppearances(e,i,l,d){}prepare(){return(function(){if(B0!=null||AA!=null)return null;if(ey!=null)return ey;const e=fetch(ts.BUILDING_GEN_URL);return ey=(function(i){let l,d,m,_,v;function S(){l=new Uint8Array(v.buffer),d=new Int16Array(v.buffer),m=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const D=()=>{},P={a:{a:A,f:function(k){const F=l.length,U=Math.max(k>>>0,Math.ceil(1.2*F)),Z=Math.ceil((U-F)/65536);try{return v.grow(Z),S(),!0}catch{return!1}},g:A,b:D,c:D,d:D,e:D}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,P):i.then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,P))).then(k=>{const F=k.instance.exports;return(0,F.g)(),v=F.f,S(),new vO({setStyle:F.h,setAOOptions:F.i,setMetricOptions:F.j,setStructuralOptions:F.k,setFacadeOptions:F.l,setFauxFacadeOptions:F.m,setFacadeClassifierOptions:F.n,addFeature:F.o,addFacade:F.p,generateMesh:F.q,getLastError:F.r,getOuterRingLength:F.s,getMeshCount:F.t,getPositionsPtr:F.u,getPositionsLength:F.v,getNormalsPtr:F.w,getNormalsLength:F.x,getAOPtr:F.y,getAOLength:F.z,getUVPtr:F.A,getUVLength:F.B,getFauxFacadePtr:F.C,getFauxFacadeLength:F.D,getIndicesPtr:F.E,getIndicesLength:F.F,getBuildingPart:F.G,getRingCount:F.H,getRingPtr:F.I,getRingLength:F.J,malloc:F.K,free:F.L,heapU8:l,heap16:d,heap32:m,heapF32:_})})})(e).then(i=>(ey=null,B0=i,B0)).catch(i=>{kn("Could not load building-gen"),ey=null,AA=i}),ey})()}populate(e,i,l,d){const m=bO();if(!m)return;const _=kt(l);this.tileToMeter=_,this.brightness=i.brightness,m.setStyle({normalScale:[1,-1,_],tileToMeters:_}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const v=new Map,S=new Map;let A=0;for(const{feature:X}of e){if(KA[X.type]!=="LineString"){v.set(X.id,X.properties.source_id);continue}const te=this.layers[0]._featureFilter.needGeometry;if(te&&!this.layers[0]._featureFilter.filter(new Mi(this.zoom),X,l))continue;const se=jn(X,te);if(!te&&!this.layers[0]._featureFilter.filter(new Mi(this.zoom),se,l))continue;const le=te?se.geometry:Dn(X,l,d),_e=[];for(const we of le)for(const De of we)_e.push(De.x),_e.push(De.y);const me={coordinates:_e,crossPerc:X.properties.cross_perc,distanceToRoad:X.properties.distance_to_road,entrances:X.properties.entrances,sourceId:0},Ee=X.properties.source_id;let Se=S.get(Ee);Se||(Se=[],S.set(Ee,Se)),Se.push(me),++A}this.maxHeight=0;const D=new Array,P=new Set,k=X=>{X!=null&&P.add(X)},F=(X,te)=>{X!=null&&D.push({buildingId:X,footprintIndex:te})},U=64*(e.length-A),Z=U/2;this.buildingWithFacade.reserve(U,Z,!0),this.buildingWithoutFacade.reserve(2*U,2*Z,!1),this.footprintsIndices.reserve(16*(e.length-A)),this.footprintsVertices.reserve(8*(e.length-A));for(const{feature:X,id:te,index:se,sourceLayerIndex:le}of e){if(KA[X.type]==="LineString")continue;const _e=this.layers[0]._featureFilter.needGeometry;if(_e&&!this.layers[0]._featureFilter.filter(new Mi(this.zoom),X,l))continue;let me=null;if(X.properties&&X.properties.hasOwnProperty("building_id")&&(me=Number(X.properties.building_id),P.has(me)))continue;const Ee=jn(X,_e);if(!_e&&!this.layers[0]._featureFilter.filter(new Mi(this.zoom),Ee,l))continue;const Se=_e?Ee.geometry:Dn(X,l,d),we=Bg(Se,500);let De=!1;for(const ei of we)if(ei.length!==1){De=!0;break}if(De){k(me);continue}if(!XO(Se,163)){k(me);continue}const Ne=this.layers[0],pt=YO(Ne.layout.get("building-roof-shape").evaluate(X,{},l)),ct=Ne.layout.get("building-base").evaluate(X,{},l),dt=Ne.layout.get("building-height").evaluate(X,{},l),Tt=Ne.layout.get("building-flood-light-ground-radius").evaluate(X,{},l),vt=Ne.paint.get("building-ambient-occlusion-intensity"),bt=Tt/this.tileToMeter;X.properties["building-part"]="roof";const ot=Ne.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),At=Ne.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="wall";const _t=Ne.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),Ct=Ne.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="window";const Et=Ne.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),nn=Ne.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);X.properties["building-part"]="door";const rn=Ne.paint.get("building-color").evaluate(X,{},this.canonical).toPremultipliedRenderColor(this.lut),$t=Ne.paint.get("building-emissive-strength").evaluate(X,{},this.canonical);let Wt=Ne.layout.get("building-flood-light-wall-radius").evaluate(X,{},l);Wt=xe(Wt,0,2048);const An=Wt/2048*$0,_n=v.get(te),Jt=S.get(_n)||[],Bn=Jt.length!==0&&Ne.layout.get("building-facade").evaluate(X,{},l);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(Bn,!1,1);let ri=0,Ri=0,Jn=0,Zi=0,yi=0,os=0,wi=0,ji=0,Tr=0,zr=0,Nr=0;if(Bn){let ei=Math.round(Ne.layout.get("building-facade-floors").evaluate(X,{},l));if(ct===0){ei=Math.max(1,ei-(Jt.length>0?1:0));let cs=4;if(dt>100){const $s=[10,13,15];cs=$s[X.id?X.id%$s.length:0]}else dt<=10&&(cs=3);m.setFacadeOptions(cs,!0),yi=(dt<15?1.3:1.61803)*cs/_}else yi=ct/_;os=dt/_,yi=Math.min(yi,os),Jn=Ne.layout.get("building-facade-unit-width").evaluate(X,{},l)/_,Zi=(os-yi)/ei,m.setFauxFacadeOptions(!0,!0,Jn);const ha=Ne.layout.get("building-facade-window").evaluate(X,{},l);ri=ha[0],Ri=ha[1],wi=Math.floor(65535*Math.min(1,yi/jt)),ji=Math.floor(65535*Math.min(1,os/jt)),Tr=Math.floor(255*ri)<<8|Math.floor(255*Ri),zr=Math.floor(65535*Math.min(1,Jn/jt)),Nr=Math.floor(65535*Math.min(1,Zi/jt))}const ls=Array(we.length),Ta={x:1/0,y:1/0},Xa={x:-1/0,y:-1/0},Ls={x:0,y:0};let Hs=0;for(let ei=0;ei<we.length;ei++){const ha=we[ei];if(ha.length>0){const cs=[],$s=Array(ha.length+1);$s[0]=0;for(let du=0;du<ha.length;du++){const bl=ha[du];for(let nc=0;nc<bl.length;nc++){const da=bl[bl.length-nc-1];Ta.x=Math.min(Ta.x,da.x),Ta.y=Math.min(Ta.y,da.y),Xa.x=Math.max(Xa.x,da.x),Xa.y=Math.max(Xa.y,da.y),Ls.x+=da.x,Ls.y+=da.y,Hs++,cs.push(da.x),cs.push(da.y)}$s[du+1]=cs.length}ls[ei]={id:X.id?X.id:0,height:dt,minHeight:ct,sourceId:0,roofType:pt,coordinates:cs,ringIndices:$s}}}Ls.x/=Hs||1,Ls.y/=Hs||1;const ta=m.generateMesh(ls,Jt);if(typeof ta=="string"){kn(`Unable to generate building ${X.id}: ${ta}`),k(me);continue}if(ta.meshes.length===0||ta.modifiedPolygonRings.length===0){k(me);continue}const Yn=Bn?this.buildingWithFacade:this.buildingWithoutFacade;let Br=0;for(const ei of ta.meshes)Br+=ei.positions.length/3;const Yr=Yn.segmentsBucket.prepareSegment(Br,Yn.layoutVertexArray,Yn.indexArray),tc=[];let Go=null,Ea=0,qo=-1;const Xd=Yn.layoutVertexArray.length,_o=Xd+Br;Yn.layoutVertexArray.resize(_o),Yn.layoutCentroidArray.resize(_o),Yn.layoutNormalArray.resize(_o),Yn.layoutAOArray.resize(_o),Yn.layoutColorArray.resize(_o),Yn.layoutFloodLightDataArray.resize(_o),Bn&&(Yn.layoutFacadePaintArray.resize(_o),Yn.layoutFacadeDataArray.resize(_o),Yn.layoutFacadeVerticalRangeArray.resize(_o));const _b=Yn.indexArray.length;let fy=0,sl=Xd;for(const ei of ta.meshes){let ha,cs;if(ei.buildingPart===1)ha=ot,cs=At;else if(ei.buildingPart===0)ha=_t,cs=Ct;else if(ei.buildingPart===2)ha=Et,cs=nn;else{if(ei.buildingPart!==3)continue;ha=rn,cs=$t}if(cs=xe(cs,0,1),ei.buildingPart===3){const Os=new Array;for(let xo=0;xo<ei.positions.length;xo+=12){const Em=ei.positions[xo+0],Aa=ei.positions[xo+1],wl=ei.positions[xo+3],Xu=ei.positions[xo+4],Qd=ei.positions[xo+2],oT=ei.positions[xo+8]-Qd,lT=1,sv=wl-Em,my=Xu-Aa,$h=Math.hypot(sv,my);Os.push({pos:[Em+.5*sv,Aa+.5*my,Qd],normal:[my/$h,-sv/$h,0],width:$h,height:oT,depth:lT,points:[Em,Aa,wl,Xu]})}const Sa=Yn.entranceBloom.segmentsBucket.prepareSegment(10*Os.length,Yn.entranceBloom.layoutVertexArray,Yn.entranceBloom.indexArray),Zs=Yn.entranceBloom.layoutVertexArray.length;Ea=Yn.entranceBloom.indexArray.length,WA(Os,.5/this.tileToMeter,Yn.entranceBloom.indexArray,Yn.entranceBloom.layoutVertexArray,Yn.entranceBloom.layoutAttenuationArray);const yo=Yn.entranceBloom.layoutVertexArray.length-Zs;qo=Yn.entranceBloom.indexArray.length-Ea;for(let xo=0;xo<yo;xo++)Yn.entranceBloom.layoutColorArray.emplaceBack(255*rn.r<<8|255*rn.g,255*rn.b<<8|51*$t);Sa.vertexLength+=yo,Sa.primitiveLength+=qo,Go={part:ei.buildingPart,vertexOffset:Zs,vertexLength:yo}}Yn.layoutVertexArray.float32.set(ei.positions,3*sl);const $s=ei.positions.length/3;for(let Os=0;Os<$s;++Os){const Sa=3*Os;fy=Math.max(fy,ei.positions[Sa+2]);const Zs=ei.normals[Sa+1]*$0,yo=ei.normals[Sa+2]*$0,xo=3*(sl+Os);Yn.layoutNormalArray.int16[xo]=ei.normals[Sa]*$0,Yn.layoutNormalArray.int16[xo+1]=Zs,Yn.layoutNormalArray.int16[xo+2]=yo;const Em=ei.ao[Os];Yn.layoutAOArray.uint8[sl+Os]=255*Em;const Aa=1+(Em-1)*vt,wl=255*ha.b*Aa<<8|255*cs;Yn.layoutColorArray.uint16[2*(sl+Os)]=255*ha.r*Aa<<8|255*ha.g*Aa,Yn.layoutColorArray.uint16[2*(sl+Os)+1]=wl}const du=Math.floor(Ls.x),bl=Math.floor(Ls.y),nc=Math.floor(dt);for(let Os=0;Os<$s;++Os){const Sa=3*(sl+Os);Yn.layoutCentroidArray.int16[Sa]=du,Yn.layoutCentroidArray.int16[Sa+1]=bl,Yn.layoutCentroidArray.int16[Sa+2]=nc}if(Yn.layoutFloodLightDataArray.uint16.fill(ei.buildingPart===0?An:0,sl,sl+$s),Bn){const Os=255*Et.r<<8|255*Et.g,Sa=255*Et.b<<8|255*nn;for(let Zs=0;Zs<$s;++Zs){const yo=2*(sl+Zs);Yn.layoutFacadePaintArray.uint16[yo]=Os,Yn.layoutFacadePaintArray.uint16[yo+1]=Sa}for(let Zs=0;Zs<$s;++Zs)if(ei.isFauxFacade[Zs]){const yo=Math.min(65535,Math.floor(ei.uv[2*Zs]*ta.outerRingLength));Yn.layoutFacadeDataArray.emplace(sl+Zs,1|yo,Tr,zr,Nr),Yn.layoutFacadeVerticalRangeArray.emplace(sl+Zs,wi,ji)}else Yn.layoutFacadeDataArray.emplace(sl+Zs,0,0,0,0),Yn.layoutFacadeVerticalRangeArray.emplace(sl+Zs,0,0)}const da=Yr.vertexLength,rv=ei.indices.length/3,Kd=Yn.indexArray.length;Yn.indexArray.resize(Kd+rv);for(let Os=0;Os<rv;++Os){const Sa=3*Os,Zs=3*Kd+Sa;Yn.indexArray.uint16[Zs]=da+ei.indices[Sa],Yn.indexArray.uint16[Zs+1]=da+ei.indices[Sa+1],Yn.indexArray.uint16[Zs+2]=da+ei.indices[Sa+2]}ei.buildingPart!==1&&ei.buildingPart!==0&&ei.buildingPart!==2&&ei.buildingPart!==3||tc.push({part:ei.buildingPart,vertexOffset:sl,vertexLength:ei.positions.length/3}),sl+=$s,Yr.vertexLength+=$s,Yr.primitiveLength+=ei.indices.length/3}this.maxHeight=Math.max(this.maxHeight,fy);const yb=Yn.indexArray.length-_b,Yd=this.footprintsIndices.length,dp=this.footprintsVertices.length,Tm=[],hu=new Dt(1/0,1/0),Wu=new Dt(-1/0,-1/0),iv=this.groundEffect.vertexArray.length;for(const ei of ta.modifiedPolygonRings){const ha=[],cs=new Dt(1/0,1/0),$s=new Dt(-1/0,-1/0);for(let du=0;du<ei.length;du+=2){const bl=ei.length-du-2;cs.x=Math.min(cs.x,ei[bl]),cs.y=Math.min(cs.y,ei[bl+1]),$s.x=Math.max($s.x,ei[bl]),$s.y=Math.max($s.y,ei[bl+1]);const nc=new Dt(ei[bl],ei[bl+1]);ha.push(nc),Tm.push(nc.x,nc.y),this.footprintsVertices.emplaceBack(nc.x,nc.y)}hu.x=Math.min(hu.x,cs.x),hu.y=Math.min(hu.y,cs.y),Wu.x=Math.max(Wu.x,$s.x),Wu.y=Math.max(Wu.y,$s.y),this.groundEffect.addData(ha,[cs,$s],bt)}const py=this.groundEffect.vertexArray.length-iv;this.groundEffect.groundRadiusArray.reserveForAdditional(py);for(let ei=0;ei<py;ei++)this.groundEffect.groundRadiusArray.emplaceBack(Tt);(Ta.x<0||Xa.x>jt||Ta.y<0||Xa.y>jt)&&this.featuresOnBorder.push({featureId:X.id,footprintIndex:this.footprints.length});{const ei=Ql(Tm,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+ei.length),this.footprintsIndices.uint16.set(ei,Yd),this.buildingIds.add(me??X.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,hu.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,hu.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Wu.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Wu.y);const ha={footprintVertexOffset:dp,footprintVertexLength:this.footprintsVertices.length-dp,footprintIndexOffset:Yd,footprintIndexLength:this.footprintsIndices.length-Yd,min:hu,max:Wu,hiddenFlags:0,indicesOffset:_b,indicesLength:yb,bloomIndicesOffset:Ea,bloomIndicesLength:qo,groundEffectVertexOffset:iv,groundEffectVertexLength:py,hasFauxFacade:Bn,height:fy,promoteId:te,feature:Ee,parts:tc,buildingBloom:Go},cs=this.footprints.length;X.id!==void 0&&this.featureFootprintLookup.set(X.id,cs),F(me,cs),this.footprints.push(ha)}this.programConfigurations.populatePaintArrays(Yn.layoutVertexArray.length,X,se,{},i.availableImages,l,i.brightness),this.groundEffect.addPaintPropertiesData(X,se,{},i.availableImages,l,i.brightness),i.featureIndex.insert(X,Se,se,le,this.index,Xd)}D.forEach(({buildingId:X,footprintIndex:te})=>{P.has(X)&&(this.footprints[te].hiddenFlags|=4)});const Q=new Set;this.buildingIds.forEach((X,te,se)=>{P.has(X)||Q.add(X)}),this.buildingIds=Q,this.groundEffect.prepareBorderSegments()}update(e,i,l,d,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v),this.groundEffect.update(e,i,m,l,d,_,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,XA.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,UO.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,GO.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,WO.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,HO.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,$O.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,XA.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,ZO.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,l=!0){let d=!1;const m=l?i:0,_=0|(l?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const S=this.footprints[v],A=S.hiddenFlags&_|m;S.hiddenFlags!==A&&(S.hiddenFlags=A,d=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const d of this.footprints){const m=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let S=d.indicesOffset;S<_;S++)m.indexArrayForConflation.uint16[3*S+0]=0,m.indexArrayForConflation.uint16[3*S+1]=0,m.indexArrayForConflation.uint16[3*S+2]=0;const v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let S=d.bloomIndicesOffset;S<v;S++)m.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const l=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=e.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=e.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,YA.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,qO.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,YA.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const l=e.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const m=i[d.promoteId],_=d.feature;_.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),D=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="door";const F=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical),Z=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const X of d.parts){let te,se=v;X.part===1?(se=v,te=S):X.part===0?(se=A,te=D):X.part===2?(se=P,te=k):X.part===3&&(se=F,te=U),te=xe(te,0,1);for(let le=0;le<X.vertexLength;le++){const _e=X.vertexOffset+le,me=1+(Z.layoutAOArray.uint8[_e]/255-1)*l;Z.layoutColorArray.emplace(_e,se.r*me*255<<8|se.g*me*255,se.b*me*255<<8|255*te),d.hasFauxFacade&&Z.layoutFacadePaintArray.emplace(_e,255*P.r<<8|255*P.g,255*P.b<<8|255*k)}}const Q=d.buildingBloom;if(Q)for(let X=0;X<Q.vertexLength;X++)Z.entranceBloom.layoutColorArray.emplace(Q.vertexOffset+X,255*F.r<<8|255*F.g,255*F.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped());if(h(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const m=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const S of this.footprints)S.min.x>_.max.x||S.max.x<_.min.x||S.min.y>_.max.y||S.max.y<_.min.y||(m.length=0,QO(this.footprintsVertices,S.footprintVertexOffset,S.footprintVertexLength,_.footprintTileId.canonical,e.canonical,m),R(_.footprint,m,this.footprintsIndices.uint16,S.footprintIndexOffset,S.footprintIndexLength,0,-v)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,d=!0;const m=4*(e+jt)*jt+(i+jt);if(this.footprintLookup.hasOwnProperty(m)){const v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Dt(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=l||KO(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(l=v.height,this.footprintLookup[m]=v,d=v.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:d};this.footprintLookup[m]=void 0}}function KO(r,e,i){for(let l=0;l<i.length;l+=3){const d=i[l],m=i[l+1],_=i[l+2],v=e[2*d+0],S=e[2*d+1],A=e[2*m+0],D=e[2*m+1],P=e[2*_+0],k=e[2*_+1],F=(v-P)*(r.y-k)-(S-k)*(r.x-P),U=(A-v)*(r.y-S)-(D-S)*(r.x-v);if(F<0!=U<0&&F!==0&&U!==0)continue;const Z=(P-A)*(r.y-D)-(k-D)*(r.x-A);if(Z===0||Z<0==F+U<=0)return!0}return!1}function QO(r,e,i,l,d,m){const _=Math.pow(2,l.z-d.z);for(let v=0;v<i;v++){let S=r.float32[2*(v+e)+0],A=r.float32[2*(v+e)+1];S=(S+d.x*jt)*_-l.x*jt,A=(A+d.y*jt)*_-l.y*jt,m.push(new Dt(S,A))}}let JA,e2;Ft(QA,"BuildingBucket",{omit:["layers"]}),Ft(ww,"BuildingGeometry"),Ft(bw,"BuildingBloomGeometry");const JO=ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),ez=ti([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:tz}=JO,nz=ti([{name:"a_packed",components:3,type:"Float32"}]),{members:iz}=nz,rz=ti([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:sz}=rz;class t2{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Gu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=It(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const d=[];let m=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,v=!0;d.push({left:m,right:_,isDash:v,zeroLength:e[0]===0});let S=e[0];for(let A=1;A<e.length;A++){v=!v;const D=e[A];m=S*l,S+=D,_=S*l,d.push({left:m,right:_,isDash:v,zeroLength:D===0})}return d}addRoundDash(e,i,l){const d=i/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let v=0,S=e[v];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++v]);const D=Math.abs(A-S.left),P=Math.abs(A-S.right),k=Math.min(D,P);let F;const U=m/l*(d+1);if(S.isDash){const Z=d-Math.abs(U);F=Math.sqrt(k*k+Z*Z)}else F=d-Math.sqrt(k*k+U*U);this.image.data[_+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const A=e[S],D=e[S+1];A.zeroLength?e.splice(S,1):D&&D.isDash===A.isDash&&(D.left=A.left,e.splice(S,1))}const l=e[0],d=e[e.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,v=e[_];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++_]);const A=Math.abs(S-v.left),D=Math.abs(S-v.right),P=Math.min(A,D);this.image.data[m+S]=Math.max(0,Math.min(255,(v.isDash?P:-P)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const d=i==="round",m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return kn("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let D=0;D<e.length;D++)e[D]<0&&(kn("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),v+=e[D];if(v!==0){const D=this.width/v,P=this.getDashRanges(e,this.width,D);d?this.addRoundDash(P,D,m):this.addRegularDash(P,i==="square"?.5*D:0)}const S=this.nextRow+m;this.nextRow+=_;const A={tl:[S,m],br:[v,0]};return this.positions[l]=A,A}}Ft(t2,"LineAtlas");const az=ni.types,oz=Math.cos(Math.PI/180*37.5),lz=Math.cos(Math.PI/180*5);class Tw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new oa,this.layoutVertexArray2=new tl,this.patternVertexArray=new tl,this.indexArray=new vs,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new fr,this.maxLineLength=0,this.zOffsetVertexArray=new tl,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.hasPattern=yx("line",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=kt(l);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),F=k.isConstant()&&!k.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&F?"none":"offset",this.elevationType==="offset"&&_==="none"&&kn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const S=[];for(const{feature:k,id:F,index:U,sourceLayerIndex:Z}of e){const Q=this.layers[0]._featureFilter.needGeometry,X=jn(k,Q);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),X,l))continue;const te=m?m.evaluate(X,{},l):void 0,se={id:F,properties:k.properties,type:k.type,sourceLayerIndex:Z,index:U,geometry:Q?X.geometry:Dn(k,l,d),patterns:{},sortKey:te};S.push(se)}m&&S.sort((k,F)=>k.sortKey-F.sortKey);const{lineAtlas:A,featureIndex:D}=i,P=this.addConstantDashes(A);for(const k of S){const{geometry:F,index:U,sourceLayerIndex:Z}=k;if(P&&this.addFeatureDashes(k,A),this.hasPattern){const Q=xx("line",this.layers,k,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Q)}else this.addFeature(k,F,U,l,A.positions,i.availableImages,i.brightness,i.elevationFeatures);D.insert(e[U].feature,F,U,Z,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")i=!0;else{const _=m.value,v=d.value;if(!v)continue;e.addDash(v,_)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(m.kind==="constant"&&_.kind==="constant")continue;let v,S;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:l},e);S=_.kind==="constant"?_.value:_.evaluate({zoom:l},e),i.addDash(v,S),e.patterns[d.id]=[i.getKey(v,S)]}}update(e,i,l,d,m,_,v,S){this.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,S)}addFeatures(e,i,l,d,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,d,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,iz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,sz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ez.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let l,d;if(i&&i>0?(l=`mapbox_clip_start_${i}`,d=`mapbox_clip_end_${i}`):(l="mapbox_clip_start",d="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(d))return{start:+e.properties[l],end:+e.properties[d]}}addFeature(e,i,l,d,m,_,v,S){const A=this.layers[0].layout,D=A.get("line-join").evaluate(e,{}),P=A.get("line-cap").evaluate(e,{}),k=A.get("line-miter-limit"),F=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const U=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if(Z.kind!=="constant"&&Z.isLineProgressConstant===!1&&(this.variableWidthValue=Z),this.elevationType==="road"){const Q=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,d,S,D,P,k,F)){const[X,te]=this.clipRuntimeLinesToTile(i,1);for(let se=0;se<X.length;se++){const le=X[se],_e=te[se],me={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,le),prevDir:this.computeSegPrevDir(_e,le)};this.addLine(le,e,d,D,P,k,F,me,U&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(Q)}}else for(let Q=0;Q<i.length;Q++)this.addLine(i[Q],e,d,D,P,k,F,void 0,U&&Q>0?Q:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,d,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return z0(e,-i,-i,jt+i,jt+i)}clipRuntimeLinesToTile(e,i){const l=[];return[z0(e,-i,-i,jt+i,jt+i,l),l]}addElevatedRoadFeature(e,i,l,d,m,_,v,S){const A=[],D=la.getElevationFeature(e,d);if(D){const P=this.clipLinesToTile(i,1),k=this.prepareElevatedLines(P,D,l);for(const F of k)A.push({geometry:F,elevation:D,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const P of A){const k=this.layoutVertexArray.length;this.addLine(P.geometry,e,l,m,_,v,S);const F=new jo(l,P.elevationTileID);if(P.elevation)for(let U=k;U<this.layoutVertexArray.length;U++){const Z=new Dt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),Q=F.pointElevation(Z,P.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,i,l){if(i.constantHeight!=null)return e;const d=[],m=1/kt(l);for(const _ of e)gO(_,new fo(i,m),0,d);return d}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,l,d,m,_,v,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const D=d==="none";this.patternJoinNone=this.hasPattern&&D,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=S&&S.progress.min>0,k=S&&S.progress.max<1;if(this.lineClips){let we={min:this.lineClips.start,max:this.lineClips.end},De=1;if(S){const ct=this.lineClips.end-this.lineClips.start;we=(function(dt,Tt,vt){return{min:es(dt.min,Tt,vt),max:es(dt.max,Tt,vt)}})(S.progress,{min:0,max:1},we),ct>0&&(De=(we.max-we.min)/ct)}const Ne=+i.properties.mapbox_clip_feature_len,pt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ne)||Number.isNaN(pt)){for(let dt=0;dt<e.length-1;dt++)this.totalDistance+=e[dt].dist(e[dt+1]);const ct=this.totalDistance/(we.max-we.min);this.totalFeatureLength=Number.isFinite(ct)?ct:0,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ne,this.distance=pt*De,this.lineClips.start=we.min,this.lineClips.end=we.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const F=az[i.type]==="Polygon";let U=e.length;for(;U>=2&&e[U-1].equals(e[U-2]);)U--;let Z=0;for(;Z<U-1&&e[Z].equals(e[Z+1]);)Z++;if(U<(F?3:2))return;d==="bevel"&&(_=1.05);const Q=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let X,te,se,le,_e,me,Ee,Se;S&&S.prevDir&&(me=S.prevDir.perp()),S&&S.nextDir&&(Ee=S.nextDir.perp()),this.e1=this.e2=-1,F&&(X=e[U-2],_e=e[Z].sub(X)._unit()._perp());for(let we=Z;we<U;we++){if(se=we===U-1?F?e[Z+1]:void 0:e[we+1],se&&e[we].equals(se))continue;_e&&(le=_e),X&&(te=X),X=e[we],Se=this.evaluateLineProgressFeatures(te?te.dist(X):0),_e=se?se.sub(X)._unit()._perp():le,le=le||_e;const De=te&&se;let Ne=De?d:F||D?"butt":m;const pt=le.x*_e.x+le.y*_e.y;if(D){const _t=function(Ct){if(Ct.patternJoinNone){const Et=Ct.segmentPoints.length/2,nn=Ct.lineSoFar-Ct.segmentStart;for(let rn=0;rn<Et;++rn){const $t=Ct.segmentPoints[2*rn+1],Wt=Math.round(Ct.segmentPoints[2*rn])+.5+.25*$t;Ct.patternVertexArray.emplaceBack(Wt,nn,Ct.segmentStart),Ct.patternVertexArray.emplaceBack(Wt,nn,Ct.segmentStart)}Ct.segmentPoints.length=0}Ct.e1=Ct.e2=-1};if(De&&pt<lz){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,Q,Se),_t(this),this.addCurrentVertex(X,_e,-1,-1,Q,Se);continue}if(te){if(!se){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,Q,Se),_t(this);continue}Ne="miter"}}let ct=le.add(_e);ct.x===0&&ct.y===0||ct._unit();const dt=ct.x*_e.x+ct.y*_e.y,Tt=dt!==0?1/dt:1/0,vt=2*Math.sqrt(2-2*dt),bt=dt<oz&&te&&se,ot=le.x*_e.y-le.y*_e.x>0,At=this.overscaling<=16?122880/(512*this.overscaling):0;if(De&&Ne==="round"){if(Tt<v)Ne="miter";else if(Tt<=2){const _t=Ew(X,-10,8202);Ne=this.elevationType==="offset"&&(_t||this.hasCrossSlope)?"miter":"fakeround"}}if(Ne==="miter"&&Tt>_&&(Ne="bevel"),Ne==="bevel"&&(Tt>2&&(Ne="flipbevel"),Tt<_&&(Ne="miter")),te&&!(Ne==="miter"&&bt)&&this.updateDistance(te,X),Ne==="miter")if(bt){const _t=X.dist(te);if(_t>2*At){const Et=X.sub(X.sub(te)._mult(At/_t)._round());this.updateDistance(te,Et),this.addCurrentVertex(Et,le,0,0,Q,Se),te=Et}this.updateDistance(te,X),ct._mult(Tt),this.addCurrentVertex(X,ct,0,0,Q,Se);const Ct=X.dist(se);if(Ct>2*At){const Et=X.add(se.sub(X)._mult(At/Ct)._round());this.updateDistance(X,Et),this.addCurrentVertex(Et,_e,0,0,Q,Se),X=Et}}else ct._mult(Tt),this.addCurrentVertex(X,ct,0,0,Q,Se);else if(Ne==="flipbevel"){if(Tt>100)ct=_e.mult(-1);else{const _t=Tt*le.add(_e).mag()/le.sub(_e).mag();ct._perp()._mult(_t*(ot?-1:1))}this.addCurrentVertex(X,ct,0,0,Q,Se),this.addCurrentVertex(X,ct.mult(-1),0,0,Q,Se)}else if(Ne==="bevel"||Ne==="fakeround"){Se!=null&&te&&this.addCurrentVertex(X,Ee||le,-1,-1,Q,Se);const _t=X.dist(te)<=2*At&&Ne!=="bevel",Ct=ct.mult(ot?1:-1);Ct._mult(Tt);const Et=_e.mult(ot?-1:1),nn=le.mult(ot?-1:1),rn=this.evaluateLineProgressFeatures(this.distance);if(Se==null&&(this.addHalfVertex(X,Ct.x,Ct.y,!1,!ot,0,Q,rn),_t||this.addHalfVertex(X,Ct.x+2*nn.x,Ct.y+2*nn.y,!1,ot,0,Q,rn)),Ne==="fakeround"){const $t=Math.round(180*vt/Math.PI/20);this.addHalfVertex(X,nn.x,nn.y,!1,ot,0,Q,rn);for(let Wt=0;Wt<$t;Wt++){let An=Wt/$t;if(An!==.5){const Jt=An-.5;An+=An*Jt*(An-1)*((1.0904+pt*(pt*(3.55645-1.43519*pt)-3.2452))*Jt*Jt+(.848013+pt*(.215638*pt-1.06021)))}const _n=Et.sub(nn)._mult(An)._add(nn)._unit();this.addHalfVertex(X,_n.x,_n.y,!1,ot,0,Q,rn)}this.addHalfVertex(X,Et.x,Et.y,!1,ot,0,Q,rn)}_t||Se!=null||this.addHalfVertex(X,Ct.x+2*Et.x,Ct.y+2*Et.y,!1,ot,0,Q,rn),Se!=null&&se&&this.addCurrentVertex(X,me||_e,1,1,Q,Se)}else if(Ne==="butt")this.addCurrentVertex(X,ct,0,0,Q,Se);else if(Ne==="square"){if(!te){const _t=P?0:-1;this.addCurrentVertex(X,ct,_t,_t,Q,Se)}if(this.addCurrentVertex(X,ct,0,0,Q,Se),te){const _t=k?0:1;this.addCurrentVertex(X,ct,_t,_t,Q,Se)}}else if(Ne==="round"){if(te){const _t=!De&&Ee?Ee:le;this.addCurrentVertex(X,_t,0,0,Q,Se),!De&&k||this.addCurrentVertex(X,_t,1,1,Q,Se,!0)}if(se){const _t=!De&&me?me:_e;!De&&P||this.addCurrentVertex(X,_t,-1,-1,Q,Se,!0),this.addCurrentVertex(X,_t,0,0,Q,Se)}}}}addVerticesTo(e,i,l,d,m,_,v,S,A,D){const P=(i.w-e.w)/this.tessellationStep|0;let k=0;const F=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const Z=(i.x-e.x)/P,Q=(i.y-e.y)/P,X=(i.z-e.z)/P,te=(i.w-e.w)/P;for(let se=1;se<P;++se){e.x+=Z,e.y+=Q,e.z+=X,this.lineSoFar+=te,k+=te;const le=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,l,d,D,!1,v,A,le),this.addHalfVertex(e,m,_,D,!0,-S,A,le)}}this.lineSoFar=i.w,this.scaledDistance=F;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,l,d,D,!1,v,A,U),this.addHalfVertex(i,m,_,D,!0,-S,A,U)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):kn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,l,d,m,_,v=!1){const S=i.x+i.y*l,A=i.y-i.x*l,D=i.y*d-i.x,P=-i.y-i.x*d;if(_!=null){const k=this.elevationType==="offset",F=-10,U=8202,Z=_.zOffset,Q=new _A(e.x,e.y,Z,this.lineSoFar),X=!!k&&Ew(e,F,U),te=this.lineSoFar,se=this.distance;if(this.currentVertex)if(X){const le=this.currentVertexIsOutside,_e=this.currentVertex,me=new _A(e.x,e.y,Z,this.lineSoFar);if(xA(_e,me,F,U),!Ew(me,F,U)){if(le){this.e1=this.e2=-1,this.distance-=_e.dist(Q),this.lineSoFar=_e.w;const Ee=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,S,A,v,!1,l,m,Ee),this.addHalfVertex(_e,D,P,v,!0,-d,m,Ee),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,me,S,A,D,P,l,d,m,v),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){xA(le,Q,F,U),this.e1=this.e2=-1,this.distance-=le.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const _e=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,S,A,v,!1,l,m,_e),this.addHalfVertex(le,D,P,v,!0,-d,m,_e),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,Q,S,A,D,P,l,d,m,v)}else X||(this.addHalfVertex(e,S,A,v,!1,l,m,_),this.addHalfVertex(e,D,P,v,!0,-d,m,_));this.currentVertex=Q,this.currentVertexIsOutside=X,this.lineSoFar=te}else this.addHalfVertex(e,S,A,v,!1,l,m,_),this.addHalfVertex(e,D,P,v,!0,-d,m,_)}addHalfVertex({x:e,y:i},l,d,m,_,v,S,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Rn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),_?this.e2=D:this.e1=D,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Ew(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let n2,i2;function r2(r,e,i){return e*(jt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Ft(Tw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const s2=(r,e,i)=>(1-i)*r+i*e;function a2(r,e){return 1/r2(r,1,e.tileZoom)}function o2(r,e,i,l){return r.translatePosMatrix(l||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const l2=r=>{const e=[];c2(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=r.layout.get("line-join").constantOr("miter")==="none",d=!!r.paint.get("line-pattern").constantOr(1);return l&&d&&e.push("LINE_JOIN_NONE"),e};function c2(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Sw;const u2=()=>Sw||(Sw={layout:n2||(n2=new br({"line-cap":new Xt(We.layout_line["line-cap"]),"line-join":new Xt(We.layout_line["line-join"]),"line-miter-limit":new Nt(We.layout_line["line-miter-limit"]),"line-round-limit":new Nt(We.layout_line["line-round-limit"]),"line-sort-key":new Xt(We.layout_line["line-sort-key"]),"line-z-offset":new Xt(We.layout_line["line-z-offset"]),"line-elevation-reference":new Nt(We.layout_line["line-elevation-reference"]),"line-cross-slope":new Nt(We.layout_line["line-cross-slope"]),visibility:new Nt(We.layout_line.visibility),"line-width-unit":new Nt(We.layout_line["line-width-unit"])})),paint:i2||(i2=new br({"line-opacity":new Xt(We.paint_line["line-opacity"]),"line-color":new Xt(We.paint_line["line-color"]),"line-translate":new Nt(We.paint_line["line-translate"]),"line-translate-anchor":new Nt(We.paint_line["line-translate-anchor"]),"line-width":new Xt(We.paint_line["line-width"]),"line-gap-width":new Xt(We.paint_line["line-gap-width"]),"line-offset":new Xt(We.paint_line["line-offset"]),"line-blur":new Xt(We.paint_line["line-blur"]),"line-dasharray":new Xt(We.paint_line["line-dasharray"]),"line-pattern":new Xt(We.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nt(We.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ih(We.paint_line["line-gradient"]),"line-trim-offset":new Nt(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nt(We.paint_line["line-trim-fade-range"]),"line-trim-color":new Nt(We.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(We.paint_line["line-emissive-strength"]),"line-border-width":new Xt(We.paint_line["line-border-width"]),"line-border-color":new Xt(We.paint_line["line-border-color"]),"line-occlusion-opacity":new Nt(We.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Sw);class cz extends Xt{possiblyEvaluate(e,i){return i=new Mi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,l,d){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,l,d)}}let zx;function h2(r,e){return e>0?e+2*r:r}const uz=ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hz=ti([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dz=ti([{name:"a_projected_pos",components:4,type:"Float32"}],4);ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fz=ti([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),pz=ti([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),mz=ti([{name:"a_texb",components:2,type:"Uint16"}]),gz=ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_z=ti([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const d2=ti([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yz=ti([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ti([{name:"triangle",components:3,type:"Uint16"}]),ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ti([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ti([{type:"Float32",name:"offsetX"}]),ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ua=24;function xz(r,e,i){return r.sections.forEach(l=>{l.text=(function(d,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),No.applyArabicShaping&&(d=No.applyArabicShaping(d)),d})(l.text,e,i)}),r}const Nx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function vz(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function bz(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const Aw=4294967296,f2=1/Aw,p2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Z0=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const l=this.readVarint(),d=l>>3,m=this.pos;this.type=7&l,r(d,e,this),this.pos===m&&this.skip(l)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Aw;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Aw;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,l;return l=e[this.pos++],i=127&l,l<128?i:(l=e[this.pos++],i|=(127&l)<<7,l<128?i:(l=e[this.pos++],i|=(127&l)<<14,l<128?i:(l=e[this.pos++],i|=(127&l)<<21,l<128?i:(l=e[this.pos],i|=(15&l)<<28,(function(d,m,_){const v=_.buf;let S,A;if(A=v[_.pos++],S=(112&A)>>4,A<128||(A=v[_.pos++],S|=(127&A)<<3,A<128)||(A=v[_.pos++],S|=(127&A)<<10,A<128)||(A=v[_.pos++],S|=(127&A)<<17,A<128)||(A=v[_.pos++],S|=(127&A)<<24,A<128)||(A=v[_.pos++],S|=(1&A)<<31,A<128))return ny(d,S,m);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&p2?p2.decode(this.buf.subarray(e,r)):(function(i,l,d){let m="",_=l;for(;_<d;){const v=i[_];let S,A,D,P=null,k=v>239?4:v>223?3:v>191?2:1;if(_+k>d)break;k===1?v<128&&(P=v):k===2?(S=i[_+1],(192&S)==128&&(P=(31&v)<<6|63&S,P<=127&&(P=null))):k===3?(S=i[_+1],A=i[_+2],(192&S)==128&&(192&A)==128&&(P=(15&v)<<12|(63&S)<<6|63&A,(P<=2047||P>=55296&&P<=57343)&&(P=null))):k===4&&(S=i[_+1],A=i[_+2],D=i[_+3],(192&S)==128&&(192&A)==128&&(192&D)==128&&(P=(15&v)<<18|(63&S)<<12|(63&A)<<6|63&D,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,k=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),_+=k}return m})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*f2),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*f2),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let l,d;if(e>=0?(l=e%4294967296|0,d=e/4294967296|0):(l=~(-e%4294967296),d=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(m,_,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(l,0,i),(function(m,_){const v=(7&m)<<4;_.buf[_.pos++]|=v|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))})(d,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(l,d,m){for(let _,v,S=0;S<d.length;S++){if(_=d.charCodeAt(S),_>55295&&_<57344){if(!v){_>56319||S+1===d.length?(l[m++]=239,l[m++]=191,l[m++]=189):v=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[m++]=239,l[m++]=191,l[m++]=189,v=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&m2(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const l=this.pos-i;l>=128&&m2(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,wz,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,Tz,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,Az,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,Ez,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,Sz,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,Iz,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,Cz,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,Rz,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,Mz,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function ny(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function m2(r,e,i){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(let d=i.pos-1;d>=r;d--)i.buf[d+l]=i.buf[d]}function wz(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function Tz(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function Ez(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function Sz(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function Az(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function Iz(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function Cz(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function Rz(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function Mz(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}function Dz(r,e,i){e.glyphs=[],r===1&&i.readMessage(Pz,e)}function Pz(r,e,i){if(r===3){const{id:l,bitmap:d,width:m,height:_,left:v,top:S,advance:A}=i.readMessage(kz,{});e.glyphs.push({id:l,bitmap:new Gu({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:v,top:S,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function kz(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const ec={horizontal:1,vertical:2,horizontalOnly:3};class Bx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const l=new Bx;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new Bx;return i.image=e,i}}class iy{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,l){const d=new iy;for(let m=0;m<e.sections.length;m++){const _=e.sections[m];_.image?d.addImageSection(_,l):d.addTextSection(_,i)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,l){let d="";for(let m=0;m<i.length;m++){const _=i.charCodeAt(m+1)||null,v=i.charCodeAt(m-1)||null;d+=!l&&(_&&ag(_)&&!Nx[i[m+1]]||v&&ag(v)&&!Nx[i[m-1]])||!Nx[i[m]]?i[m]:Nx[i[m]]}return d})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&W0[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&W0[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new iy;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Bx.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(l)}addImageSection(e,i){const l=e.image?e.image.getPrimary():null;if(!l)return void kn("Can't add FormattedSection with an empty image.");l.scaleSelf(i);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Bx.forImage(l)),this.sectionIndex.push(this.sections.length-1)):kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Iw(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z=1){const Q=iy.fromFeature(r,d,Z);P===ec.vertical&&Q.verticalizePunctuation(k);let X=[];const te=(function(Ee,Se,we,De,Ne,pt){if(!Ee)return[];const ct=[],dt=(function(bt,ot,At,_t,Ct,Et){let nn=0;for(let rn=0;rn<bt.length();rn++){const $t=bt.getSection(rn);nn+=g2(bt.getCodePoint(rn),$t,_t,Ct,ot,Et)}return nn/Math.max(1,Math.ceil(nn/At))})(Ee,Se,we,De,Ne,pt),Tt=Ee.text.indexOf("")>=0;let vt=0;for(let bt=0;bt<Ee.length();bt++){const ot=Ee.getSection(bt),At=Ee.getCodePoint(bt);if(W0[At]||(vt+=g2(At,ot,De,Ne,Se,pt)),bt<Ee.length()-1){const _t=rg(At);(Lz[At]||_t||ot.image)&&ct.push(y2(bt+1,vt,dt,ct,Oz(At,Ee.getCodePoint(bt+1),_t&&Tt),!1))}}return x2(y2(Ee.length(),vt,dt,ct,0,!0))})(Q,A,m,e,l,F),{processBidirectionalText:se,processStyledBidirectionalText:le}=No;if(se&&Q.sections.length===1){const Ee=se(Q.toString(),te);for(const Se of Ee){const we=new iy;we.text=Se,we.sections=Q.sections;for(let De=0;De<Se.length;De++)we.sectionIndex.push(0);X.push(we)}}else if(le){const Ee=le(Q.text,Q.sectionIndex,te);for(const Se of Ee){const we=new iy;we.text=Se[0],we.sectionIndex=Se[1],we.sections=Q.sections,X.push(we)}}else X=(function(Ee,Se){const we=[],De=Ee.text;let Ne=0;for(const pt of Se)we.push(Ee.substring(Ne,pt)),Ne=pt;return Ne<De.length&&we.push(Ee.substring(Ne,De.length)),we})(Q,te);const _e=[],me={positionedLines:_e,text:Q.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ee,Se,we,De,Ne,pt,ct,dt,Tt,vt,bt,ot){let At=0,_t=0,Ct=0;const Et=dt==="right"?1:dt==="left"?0:.5;let nn=!1;for(const _n of Ne){const Jt=_n.getSections();for(const Bn of Jt){if(Bn.image)continue;const ri=Se[Bn.fontStack];if(ri&&(nn=ri.ascender!==void 0&&ri.descender!==void 0,!nn))break}if(!nn)break}let rn=0;for(const _n of Ne){_n.trim();const Jt=_n.getMaxScale(),Bn=(Jt-1)*ua,ri={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[rn]=ri;const Ri=ri.positionedGlyphs;let Jn=0;if(!_n.length()){_t+=pt,++rn;continue}let Zi=0,yi=0;for(let wi=0;wi<_n.length();wi++){const ji=_n.getSection(wi),Tr=_n.getSectionIndex(wi),zr=_n.getCodePoint(wi);let Nr=ji.scale,ls=null,Ta=null,Xa=null,Ls=ua,Hs=0,ta=Tt;ta===ec.vertical&&sg(zr)&&(ta=ec.horizontal);const Yn=!(ta===ec.horizontal||!bt&&!bc(zr)||bt&&(W0[zr]||jf(zr)));if(ji.image){const Br=De.get(ji.image.toString());if(!Br)continue;Xa=ji.image,Ee.iconsInText=Ee.iconsInText||!0,Ta=Br.paddedRect;const Yr=Br.displaySize;Nr=Nr*ua/ot,ls={width:Yr[0],height:Yr[1],left:0,top:-3,advance:Yn?Yr[1]:Yr[0],localGlyph:!1},Hs=nn?-ls.height*Nr:Jt*ua-17-Yr[1]*Nr,Ls=ls.advance;const tc=(Yn?Yr[0]:Yr[1])*Nr-ua*Jt;tc>0&&tc>Jn&&(Jn=tc)}else{const Br=we[ji.fontStack];if(!Br)continue;Br[zr]&&(Ta=Br[zr]);const Yr=Se[ji.fontStack];if(!Yr)continue;const tc=Yr.glyphs[zr];if(!tc)continue;if(ls=tc.metrics,Ls=zr!==8203?ua:0,nn){const Go=Yr.ascender!==void 0?Math.abs(Yr.ascender):0,Ea=Yr.descender!==void 0?Math.abs(Yr.descender):0,qo=(Go+Ea)*Nr;Zi<qo&&(Zi=qo,yi=(Go-Ea)/2*Nr),Hs=-Go*Nr}else Hs=(Jt-Nr)*ua-17}Yn?(Ee.verticalizable=!0,Ri.push({glyph:zr,image:Xa,x:At,y:_t+Hs,vertical:Yn,scale:Nr,localGlyph:ls.localGlyph,fontStack:ji.fontStack,sectionIndex:Tr,metrics:ls,rect:Ta}),At+=Ls*Nr+vt):(Ri.push({glyph:zr,image:Xa,x:At,y:_t+Hs,vertical:Yn,scale:Nr,localGlyph:ls.localGlyph,fontStack:ji.fontStack,sectionIndex:Tr,metrics:ls,rect:Ta}),At+=ls.advance*Nr+vt)}Ri.length!==0&&(Ct=Math.max(At-vt,Ct),nn?v2(Ri,Et,Jn,yi,pt*Jt/2):v2(Ri,Et,Jn,0,pt/2)),At=0;const os=pt*Jt+Jn;ri.lineOffset=Math.max(Jn,Bn),_t+=os,++rn}const $t=_t,{horizontalAlign:Wt,verticalAlign:An}=Cw(ct);(function(_n,Jt,Bn,ri,Ri,Jn){const Zi=(Jt-Bn)*Ri,yi=-Jn*ri;for(const os of _n)for(const wi of os.positionedGlyphs)wi.x+=Zi,wi.y+=yi})(Ee.positionedLines,Et,Wt,An,Ct,$t),Ee.top+=-An*$t,Ee.bottom=Ee.top+$t,Ee.left+=-Wt*Ct,Ee.right=Ee.left+Ct,Ee.hasBaseline=nn})(me,e,i,l,X,_,v,S,P,A,k,U),!(function(Ee){for(const Se of Ee)if(Se.positionedGlyphs.length!==0)return!1;return!0})(_e))return me}const W0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function g2(r,e,i,l,d,m){if(e.image){const _=l.get(e.image.toString());return _?_.displaySize[0]*e.scale*ua/m+d:0}{const _=i[e.fontStack],v=_&&_.glyphs[r];return v?v.metrics.advance*e.scale+d:0}}function _2(r,e,i,l){const d=Math.pow(r-e,2);return l?r<e?d/2:2*d:d+Math.abs(i)*i}function Oz(r,e,i){let l=0;return r===10&&(l-=1e4),i&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function y2(r,e,i,l,d,m){let _=null,v=_2(e,i,d,m);for(const S of l){const A=_2(e-S.x,i,d,m)+S.badness;A<=v&&(_=S,v=A)}return{index:r,x:e,priorBreak:_,badness:v}}function x2(r){return r?x2(r.priorBreak).concat(r.index):[]}function Cw(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function v2(r,e,i,l,d){if(!(e||i||l||d))return;const m=r.length-1,_=r[m],v=(_.x+_.metrics.advance*_.scale)*e;for(let S=0;S<=m;S++)r[S].x-=v,r[S].y+=i+l+d}function Rw(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function X0(r,e,i,l){const{horizontalAlign:d,verticalAlign:m}=Cw(l),_=i[0]-r.displaySize[0]*d,v=i[1]-r.displaySize[1]*m;return{imagePrimary:r,imageSecondary:e,top:v,bottom:v+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function Mw(r,e,i,l,d,m){const _=r.imagePrimary;let v;if(_.content){const Q=_.content,X=_.pixelRatio||1;v=[Q[0]/X,Q[1]/X,_.displaySize[0]-Q[2]/X,_.displaySize[1]-Q[3]/X]}const S=e.left*m,A=e.right*m;let D,P,k,F;i==="width"||i==="both"?(F=d[0]+S-l[3],P=d[0]+A+l[1]):(F=d[0]+(S+A-_.displaySize[0])/2,P=F+_.displaySize[0]);const U=e.top*m,Z=e.bottom*m;return i==="height"||i==="both"?(D=d[1]+U-l[0],k=d[1]+Z+l[2]):(D=d[1]+(U+Z-_.displaySize[1])/2,k=D+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:D,right:P,bottom:k,left:F,collisionPadding:v}}function b2(r){return!r.imagePrimary.stretchX}function w2(r){return!r.imagePrimary.stretchY}function T2(r){return{width:r.right-r.left,height:r.bottom-r.top}}const up=128;function Xg(r,e,i,l){const{expression:d}=e;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Mi(r+1,{worldview:i}),void 0,void 0,void 0,l)};if(d.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:_}=d;let v=0;for(;v<m.length&&m[v]<=r;)v++;v=Math.max(0,v-1);let S=v;for(;S<m.length&&m[S]<r+1;)S++;S=Math.min(m.length-1,S);const A=m[v],D=m[S];return d.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:_}:{kind:"camera",minZoom:A,maxZoom:D,minSize:d.evaluate(new Mi(A,{worldview:i}),void 0,void 0,void 0,l),maxSize:d.evaluate(new Mi(D,{worldview:i}),void 0,void 0,void 0,l),interpolationType:_}}}function Dw(r,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:d}){return r.kind==="source"?l/up:r.kind==="composite"?Rn(l/up,d/up,i):e}function ry(r,e,i=1){let l=0,d=0;if(r.kind==="constant")d=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:m,minZoom:_,maxZoom:v}=r,S=m?xe(Sr.interpolationFactor(m,e,_,v),0,1):0;r.kind==="camera"?d=Rn(r.minSize,r.maxSize,S)*i:l=S*i}return{uSizeT:l,uSize:d}}class hp extends Dt{constructor(e,i,l,d,m){super(e,i),this.angle=d,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new hp(this.x,this.y,this.z,this.angle,this.segment)}}function E2(r,e,i,l,d){if(e.segment===void 0)return!0;let m=e,_=e.segment+1,v=0;for(;v>-i/2;){if(_--,_<0)return!1;v-=r[_].dist(m),m=r[_]}v+=r[_].dist(r[_+1]),_++;const S=[];let A=0;for(;v<i/2;){const D=r[_],P=r[_+1];if(!P)return!1;let k=r[_-1].angleTo(D)-D.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:k}),A+=k;v-S[0].distance>l;)A-=S.shift().angleDelta;if(A>d)return!1;_++,v+=D.dist(P)}return!0}function S2(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function A2(r,e,i){return r?.6*e*i:0}function I2(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function zz(r,e,i,l,d,m){const _=A2(i,d,m),v=I2(i,l)*m;let S=0;const A=S2(r)/2;for(let D=0;D<r.length-1;D++){const P=r[D],k=r[D+1],F=P.dist(k);if(S+F>A){const U=(A-S)/F,Z=Rn(P.x,k.x,U),Q=Rn(P.y,k.y,U),X=new hp(Z,Q,0,k.angleTo(P),D);return!_||E2(r,X,v,_,e)?X:void 0}S+=F}}function Nz(r,e,i,l,d,m,_,v,S){const A=A2(l,m,_),D=I2(l,d),P=D*_,k=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return e-P<e/4&&(e=P+e/4),C2(r,k?e/2*v%e:(D/2+2*m)*_*v%e,e,A,i,P,k,!1,S)}function C2(r,e,i,l,d,m,_,v,S){const A=m/2,D=S2(r);let P=0,k=e-i,F=[];for(let U=0;U<r.length-1;U++){const Z=r[U],Q=r[U+1],X=Z.dist(Q),te=Q.angleTo(Z);for(;k+i<P+X;){k+=i;const se=(k-P)/X,le=Rn(Z.x,Q.x,se),_e=Rn(Z.y,Q.y,se);if(le>=0&&le<S&&_e>=0&&_e<S&&k-A>=0&&k+A<=D){const me=new hp(le,_e,0,te,U);l&&!E2(r,me,m,l,d)||F.push(me)}}P+=X}return v||F.length||_||(F=C2(r,P/2,i,l,d,m,_,!0,S)),F}function R2(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let d=0,m=0;for(const _ of r)for(let v=l.length-1;v>=0;v--){const S=l[v];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===S.w&&_.h===S.h){const A=l.pop();A&&v<l.length&&(l[v]=A)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(l.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}Ft(hp,"Anchor");class Fx{static getImagePositionScale(e,i,l){if(i&&e){const{sx:d,sy:m}=e;return{x:d,y:m}}return{x:l,y:l}}constructor(e,i,l,d){this.paddedRect=e;const{pixelRatio:m,version:_,stretchX:v,stretchY:S,content:A,sdf:D,usvg:P}=i;this.pixelRatio=m,this.stretchX=v,this.stretchY=S,this.content=A,this.version=_,this.padding=l,this.sdf=D,this.usvg=P,this.scale=Fx.getImagePositionScale(d,P,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Pw(r,e,i){const l=Ys.parse(r),d=(function(m,_,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*_,h:(m.data?m.data.height:m.height*v[1])+2*_}})(e,i,[l.sx,l.sy]);return{bin:d,imagePosition:new Fx(d,e,i,l),imageVariant:l}}class M2{constructor(e,i,l){const d=new Map,m=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,d,1,_),this.addImages(i,m,2,_);const{w:v,h:S}=R2(_),A=new ea({width:v||1,height:S||1});for(const[D,P]of e.entries()){const k=d.get(D).paddedRect;ea.copy(P.data,A,{x:0,y:0},{x:k.x+1,y:k.y+1},P.data,null,P.sdf)}for(const[D,P]of i.entries()){const k=m.get(D),F=k.paddedRect;let U=k.padding;const Z=F.x+U,Q=F.y+U,X=P.data.width,te=P.data.height;U=U>1?U-1:U,ea.copy(P.data,A,{x:0,y:0},{x:Z,y:Q},P.data,l),ea.copy(P.data,A,{x:0,y:te-U},{x:Z,y:Q-U},{width:X,height:U},l),ea.copy(P.data,A,{x:0,y:0},{x:Z,y:Q+te},{width:X,height:U},l),ea.copy(P.data,A,{x:X-U,y:0},{x:Z-U,y:Q},{width:U,height:te},l),ea.copy(P.data,A,{x:0,y:0},{x:Z+X,y:Q},{width:U,height:te},l),ea.copy(P.data,A,{x:X-U,y:te-U},{x:Z-U,y:Q-U},{width:U,height:U},l),ea.copy(P.data,A,{x:0,y:te-U},{x:Z+X,y:Q-U},{width:U,height:U},l),ea.copy(P.data,A,{x:0,y:0},{x:Z+X,y:Q+te},{width:U,height:U},l),ea.copy(P.data,A,{x:X-U,y:0},{x:Z-U,y:Q+te},{width:U,height:U},l)}this.lut=l,this.image=A,this.iconPositions=d,this.patternPositions=m}addImages(e,i,l,d){for(const[m,_]of e.entries()){const{bin:v,imagePosition:S,imageVariant:A}=Pw(m,_,l);i.set(m,S),d.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>e.hasImage(m,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const m of e.getUpdatedImages(l)){for(const _ of this.iconPositions.keys()){const v=Ys.parse(_);if(Vs.isEqual(v.id,m)){const S=e.getImage(m,l);this.patchUpdatedImage(this.iconPositions.get(_),S,i,null)}}for(const _ of this.patternPositions.keys()){const v=Ys.parse(_);if(Vs.isEqual(v.id,m)){const S=e.getImage(m,l);this.patchUpdatedImage(this.patternPositions.get(_),S,i,d||this.lut)}}}}patchUpdatedImage(e,i,l,d=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[m,_]=e.tl,v=e.sdf;if(this.lut||v){const S={width:i.data.width,height:i.data.height},A=new ea(S);ea.copy(i.data,A,{x:0,y:0},{x:0,y:0},S,d,v),l.update(A,{position:{x:m,y:_}})}else l.update(i.data,{position:{x:m,y:_}})}}Ft(Fx,"ImagePosition"),Ft(M2,"ImageAtlas",{omit:["lut"]});const Vx=1e20;function D2(r,e,i,l,d,m,_,v,S){for(let A=e;A<e+l;A++)P2(r,i*m+A,m,d,_,v,S);for(let A=i;A<i+d;A++)P2(r,A*m+e,1,l,_,v,S)}function P2(r,e,i,l,d,m,_){m[0]=0,_[0]=-Vx,_[1]=Vx,d[0]=r[e];for(let v=1,S=0,A=0;v<l;v++){d[v]=r[e+v*i];const D=v*v;do{const P=m[S];A=(d[v]-d[P]+D-P*P)/(v-P)/2}while(A<=_[S]&&--S>-1);S++,m[S]=v,_[S]=A,_[S+1]=Vx}for(let v=0,S=0;v<l;v++){for(;_[S+1]<v;)S++;const A=m[S],D=v-A;r[e+v*i]=d[A]+D*D}}const kw={none:0,ideographs:1,all:2};class sy{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[],d=this.url||ts.GLYPHS_URL;for(const m in e)for(const _ of e[m])l.push({stack:m,id:_});$e(l,({stack:m,id:_},v)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=S.glyphs[_];if(A!==void 0)return void v(null,{stack:m,id:_,glyph:A});if(A=this._tinySDF(S,m,_),A)return S.glyphs[_]=A,void v(null,{stack:m,id:_,glyph:A});const D=Math.floor(_/256);if(256*D>65535)return kn("glyphs > 65535 not supported"),void v(null,{stack:m,id:_,glyph:A});if(S.ranges[D])return void v(null,{stack:m,id:_,glyph:A});let P=S.requests[D];P||(P=S.requests[D]=[],sy.loadGlyphRange(m,D,d,this.requestManager,(k,F)=>{if(F){S.ascender=F.ascender,S.descender=F.descender;for(const U in F.glyphs)this._doesCharSupportLocalGlyph(+U)||(S.glyphs[+U]=F.glyphs[+U]);S.ranges[D]=!0}for(const U of P)U(k,F);delete S.requests[D]})),P.push((k,F)=>{k?v(k):F&&v(null,{stack:m,id:_,glyph:F.glyphs[_]||null})})},(m,_)=>{if(m)i(m);else if(_){const v={};for(const{stack:S,id:A,glyph:D}of _)v[S]===void 0&&(v[S]={}),v[S].glyphs===void 0&&(v[S].glyphs={}),v[S].glyphs[A]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;i(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==kw.none&&(this.localGlyphMode===kw.all?!!this.localFontFamily:!!this.localFontFamily&&(xs(e)||Bf(e)||ku(e)||Sh(e)||is(e)||Ks(e)||(i=e)>=131072&&i<=173791||(l=>l>=66736&&l<=66815)(e)));var i}_tinySDF(e,i,l){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let Z="400";/bold/i.test(i)?Z="900":/medium/i.test(i)?Z="500":/light/i.test(i)&&(Z="200"),m=e.tinySDF=new sy.TinySDF({fontFamily:d,fontWeight:Z,fontSize:48,buffer:6,radius:16}),m.fontWeight=Z}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCodePoint(l),{data:v,width:S,height:A,glyphWidth:D,glyphHeight:P,glyphLeft:k,glyphTop:F,glyphAdvance:U}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Gu({width:S,height:A},v),metrics:{width:D/2,height:P/2,left:k/2,top:F/2-27,advance:U/2,localGlyph:!0}}}}function k2(r,e){return r+e[1]-e[0]}function Lw(r,e,i,l,d=1){const m=[],_=r.imagePrimary,v=_.pixelRatio,S=_.paddedRect.w-2,A=_.paddedRect.h-2,D=(r.right-r.left)*d,P=(r.bottom-r.top)*d,k=_.stretchX||[[0,S]],F=_.stretchY||[[0,A]],U=k.reduce(k2,0),Z=F.reduce(k2,0),Q=S-U,X=A-Z;let te=0,se=U,le=0,_e=Z,me=0,Ee=Q,Se=0,we=X;if(_.content&&l){const Ne=_.content;te=Y0(k,0,Ne[0]),le=Y0(F,0,Ne[1]),se=Y0(k,Ne[0],Ne[2]),_e=Y0(F,Ne[1],Ne[3]),me=Ne[0]-te,Se=Ne[1]-le,Ee=Ne[2]-Ne[0]-se,we=Ne[3]-Ne[1]-_e}const De=(Ne,pt,ct,dt)=>{const Tt=K0(Ne.stretch-te,se,D,r.left*d),vt=Q0(Ne.fixed-me,Ee,Ne.stretch,U),bt=K0(pt.stretch-le,_e,P,r.top*d),ot=Q0(pt.fixed-Se,we,pt.stretch,Z),At=K0(ct.stretch-te,se,D,r.left*d),_t=Q0(ct.fixed-me,Ee,ct.stretch,U),Ct=K0(dt.stretch-le,_e,P,r.top*d),Et=Q0(dt.fixed-Se,we,dt.stretch,Z),nn=new Dt(Tt,bt),rn=new Dt(At,bt),$t=new Dt(At,Ct),Wt=new Dt(Tt,Ct),An=new Dt(vt/v,ot/v),_n=new Dt(_t/v,Et/v),Jt=e*Math.PI/180;if(Jt){const yi=Math.sin(Jt),os=Math.cos(Jt),wi=[os,-yi,yi,os];nn._matMult(wi),rn._matMult(wi),Wt._matMult(wi),$t._matMult(wi)}const Bn=Ne.stretch+Ne.fixed,ri=ct.stretch+ct.fixed,Ri=pt.stretch+pt.fixed,Jn=dt.stretch+dt.fixed,Zi=r.imageSecondary;return{tl:nn,tr:rn,bl:Wt,br:$t,texPrimary:{x:_.paddedRect.x+1+Bn,y:_.paddedRect.y+1+Ri,w:ri-Bn,h:Jn-Ri},texSecondary:Zi?{x:Zi.paddedRect.x+1+Bn,y:Zi.paddedRect.y+1+Ri,w:ri-Bn,h:Jn-Ri}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:An,pixelOffsetBR:_n,minFontScaleX:Ee/v/D,minFontScaleY:we/v/P,isSDF:i}};if(_.stretchX||_.stretchY){const Ne=L2(k,Q,U),pt=L2(F,X,Z);for(let ct=0;ct<Ne.length-1;ct++){const dt=Ne[ct],Tt=Ne[ct+1];for(let vt=0;vt<pt.length-1;vt++)m.push(De(dt,pt[vt],Tt,pt[vt+1]))}}else m.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:A+1}));return m}function Bz(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2]];return r.stretchX||r.stretchY?O2(r.stretchX||[[0,r.paddedRect.w-2]])*O2(i):1}function Y0(r,e,i){let l=0;for(const d of r)l+=Math.max(e,Math.min(i,d[1]))-Math.max(e,Math.min(i,d[0]));return l}function L2(r,e,i){const l=[{fixed:-1,stretch:0}];for(const[d,m]of r){const _=l[l.length-1];l.push({fixed:d-_.stretch,stretch:_.stretch}),l.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return l.push({fixed:e+1,stretch:i}),l}function O2(r){return 2*r.length+1}function K0(r,e,i,l){return r/e*i+l}function Q0(r,e,i,l){return r-e*i/l}function Fz(r,e,i,l){const d=e+r.positionedLines[l].lineOffset;return l===0?i+d/2:i+(d+(e+r.positionedLines[l-1].lineOffset))/2}function z2(r,e,i,l,d,m,_,v,S){const A=[];if(e.positionedLines.length===0)return A;const D=(S!==void 0?S:l.layout.get("text-rotate").evaluate(m,{}))*Math.PI/180,P=(function(Q){const X=Q[0],te=Q[1],se=X*te;return se>0?[X,-te]:se<0?[-X,te]:X===0?[te,X]:[te,-X]})(i);let k=Math.abs(e.top-e.bottom);for(const Q of e.positionedLines)k-=Q.lineOffset;const F=e.positionedLines.length,U=k/F;let Z=e.top-i[1];for(let Q=0;Q<F;++Q){const X=e.positionedLines[Q];Z=Fz(e,U,Z,Q);for(const te of X.positionedGlyphs){if(!te.rect)continue;const se=te.rect||{};let le=4,_e=!0,me=1,Ee=0;if(te.image){const rn=_.get(te.image.toString());if(!rn)continue;if(rn.sdf){kn("SDF images are not supported in formatted text and will be ignored.");continue}_e=!1,me=rn.pixelRatio,le=1/me}const Se=(d||v)&&te.vertical,we=te.metrics.advance*te.scale/2,De=te.metrics,Ne=te.rect;if(Ne===null)continue;v&&e.verticalizable&&(Ee=te.image?we-te.metrics.width*te.scale/2:0);const pt=d?[te.x+we,te.y]:[0,0];let ct=[0,0],dt=[0,0],Tt=!1;d||(Se?(dt=[te.x+we+P[0],te.y+P[1]-Ee],Tt=!0):ct=[te.x+we+i[0],te.y+i[1]-Ee]);const vt=Ne.w*te.scale/(me*(te.localGlyph?2:1)),bt=Ne.h*te.scale/(me*(te.localGlyph?2:1));let ot,At,_t,Ct;if(Se){const rn=te.y-Z,$t=new Dt(-we,we-rn),Wt=-Math.PI/2,An=new Dt(...dt);ot=new Dt(-we+ct[0],ct[1]),ot._rotateAround(Wt,$t)._add(An),ot.x+=-rn+we,ot.y-=(De.left-le)*te.scale;const _n=te.image?De.advance*te.scale:ua*te.scale,Jt=String.fromCodePoint(te.glyph);vz(Jt)?ot.x+=(1-le)*te.scale:bz(Jt)?ot.x+=_n-De.height*te.scale+(-le-1)*te.scale:ot.x+=te.image||De.width+2*le===Ne.w&&De.height+2*le===Ne.h?(_n-bt)/2:(_n-(De.height+2*le)*te.scale)/2,At=new Dt(ot.x,ot.y-vt),_t=new Dt(ot.x+bt,ot.y),Ct=new Dt(ot.x+bt,ot.y-vt)}else{const rn=(De.left-le)*te.scale-we+ct[0],$t=(-De.top-le)*te.scale+ct[1],Wt=rn+vt,An=$t+bt;ot=new Dt(rn,$t),At=new Dt(Wt,$t),_t=new Dt(rn,An),Ct=new Dt(Wt,An)}if(D){let rn;rn=d?new Dt(0,0):Tt?new Dt(P[0],P[1]):new Dt(i[0],i[1]),ot._rotateAround(D,rn),At._rotateAround(D,rn),_t._rotateAround(D,rn),Ct._rotateAround(D,rn)}const Et=new Dt(0,0),nn=new Dt(0,0);A.push({tl:ot,tr:At,bl:_t,br:Ct,texPrimary:se,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:pt,sectionIndex:te.sectionIndex,isSDF:_e,pixelOffsetTL:Et,pixelOffsetBR:nn,minFontScaleX:0,minFontScaleY:0})}}return A}function Vz(r,e=1,i=!1){let l=1/0,d=1/0,m=-1/0,_=-1/0;const v=r[0];for(let F=0;F<v.length;F++){const U=v[F];(!F||U.x<l)&&(l=U.x),(!F||U.y<d)&&(d=U.y),(!F||U.x>m)&&(m=U.x),(!F||U.y>_)&&(_=U.y)}const S=Math.min(m-l,_-d);let A=S/2;const D=new hh([],jz);if(S===0)return new Dt(l,d);for(let F=l;F<m;F+=S)for(let U=d;U<_;U+=S)D.push(new ay(F+A,U+A,A,r));let P=(function(F){let U=0,Z=0,Q=0;const X=F[0];for(let te=0,se=X.length,le=se-1;te<se;le=te++){const _e=X[te],me=X[le],Ee=_e.x*me.y-me.x*_e.y;Z+=(_e.x+me.x)*Ee,Q+=(_e.y+me.y)*Ee,U+=3*Ee}return new ay(Z/U,Q/U,0,F)})(r),k=D.length;for(;D.length;){const F=D.pop();(F.d>P.d||!P.d)&&(P=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-P.d<=e||(A=F.h/2,D.push(new ay(F.p.x-A,F.p.y-A,A,r)),D.push(new ay(F.p.x+A,F.p.y-A,A,r)),D.push(new ay(F.p.x-A,F.p.y+A,A,r)),D.push(new ay(F.p.x+A,F.p.y+A,A,r)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function jz(r,e){return e.max-r.max}sy.loadGlyphRange=function(r,e,i,l,d){const m=256*e,_=m+255,v=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${m}-${_}`),hs.Glyphs);Nc(v,(S,A)=>{if(S)d(S);else if(A){const D={},P=(function(k){return new Z0(k).readFields(Dz,{})})(A);for(const k of P.glyphs)D[k.id]=k;d(null,{glyphs:D,ascender:P.ascender,descender:P.descender})}})},sy.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=e,this.cutoff=l,this.radius=i,this.lang=v;const S=this.size=r+4*e,A=this._createCanvas(S),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${m} ${r}px ${d}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(r),_=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),S=Math.min(this.size-this.buffer,_+Math.ceil(l)),A=v+2*this.buffer,D=S+2*this.buffer,P=Math.max(A*D,0),k=new Uint8ClampedArray(P),F={data:k,width:A,height:D,glyphWidth:v,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||S===0)return F;const{ctx:U,buffer:Z,gridInner:Q,gridOuter:X}=this;this.lang&&(U.lang=this.lang),U.clearRect(Z,Z,v,S),U.fillText(r,Z,Z+_);const te=U.getImageData(Z,Z,v,S);X.fill(Vx,0,P),Q.fill(0,0,P);for(let se=0;se<S;se++)for(let le=0;le<v;le++){const _e=te.data[4*(se*v+le)+3]/255;if(_e===0)continue;const me=(se+Z)*A+le+Z;if(_e===1)X[me]=0,Q[me]=Vx;else{const Ee=.5-_e;X[me]=Ee>0?Ee*Ee:0,Q[me]=Ee<0?Ee*Ee:0}}D2(X,0,0,A,D,A,this.f,this.v,this.z),D2(Q,Z,Z,v,S,A,this.f,this.v,this.z);for(let se=0;se<P;se++){const le=Math.sqrt(X[se])-Math.sqrt(Q[se]);k[se]=Math.round(255-255*(le/this.radius+this.cutoff))}return F}};class ay{constructor(e,i,l,d){this.p=new Dt(e,i),this.h=l,this.d=(function(m,_){let v=!1,S=1/0;for(let A=0;A<_.length;A++){const D=_[A];for(let P=0,k=D.length,F=k-1;P<k;F=P++){const U=D[P],Z=D[F];U.y>m.y!=Z.y>m.y&&m.x<(Z.x-U.x)*(m.y-U.y)/(Z.y-U.y)+U.x&&(v=!v),S=Math.min(S,Nh(m,U,Z))}}return(v?1:-1)*Math.sqrt(S)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Uz=Object.keys,Ow=Number.POSITIVE_INFINITY,Gz=Math.sqrt(2);function vm(r,e,i,l,d){const m=Rw(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],_={top:r.top-m[1],bottom:r.bottom+m[3],left:r.left-m[0],right:r.right+m[2],scaled:!1};return l!==void 0&&(function(v,S){v.top*=S,v.bottom*=S,v.left*=S,v.right*=S,v.scaled=!0})(_,l),i&&(function(v,S){if(!S)return;const A=oi(S),D=new Dt(v.left,v.top),P=new Dt(v.right,v.top),k=new Dt(v.left,v.bottom),F=new Dt(v.right,v.bottom),U=new Dt(0,0);D._rotateAround(A,U),P._rotateAround(A,U),k._rotateAround(A,U),F._rotateAround(A,U),v.left=Math.min(D.x,P.x,k.x,F.x),v.right=Math.max(D.x,P.x,k.x,F.x),v.top=Math.min(D.y,P.y,k.y,F.y),v.bottom=Math.max(D.y,P.y,k.y,F.y)})(_,i),d&&(_.left+=d[0],_.right+=d[0],_.top+=d[1],_.bottom+=d[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function N2(r,[e,i]){let l=0,d=0;if(i===Ow){e<0&&(e=0);const m=e/Gz;switch(r){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(r){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":d=i-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-i}switch(r){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,d]}function qz(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U){const Z=r.layers[0],Q=Z.appearances;if(Q.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const X={iconBBox:null,iconVerticalBBox:null},te={textBBox:null,textVerticalBBox:null},{baseIconRotate:se,baseTextRotate:le,iconScaleFactor:_e}=(function(Ee,Se,we){const De=Ee.get("icon-rotate").evaluate(Se,{},we),Ne=Ee.get("text-rotate").evaluate(Se,{},we),[pt,ct]=Ee.get("icon-size-scale-range");return{baseIconRotate:De,baseTextRotate:Ne,iconScaleFactor:xe(1,pt,ct)}})(l,d,m);e&&(X.iconBBox=vm(e,X.iconBBox,se,_),i)&&(X.iconVerticalBBox=vm(i,X.iconVerticalBBox,se+90,_));const me=eb(P.horizontal);me&&(te.textBBox=vm(me,te.textBBox,le,1,F)),P.vertical&&(te.textVerticalBBox=vm(P.vertical,te.textVerticalBBox,le+90,1,F));for(const Ee of Q)Ee.hasIconProperties()&&Hz(X,r,Z,Ee,d,m,v,se,_,S,e,A,_e,D,U),Ee.hasTextProperties()&&$z(te,Z,Ee,d,m,F,le,k,me,P.vertical);return{iconBBox:X.iconBBox,iconVerticalBBox:X.iconVerticalBBox,textBBox:te.textBBox,textVerticalBBox:te.textVerticalBBox}}function Hz(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U){const{appearanceIconOffset:Z,appearanceIconRotate:Q,appearanceIconSize:X}=B2(l,i,d,m,_,v,S,A.iconScaleFactor);let te=null,se=null,le=null;l.hasProperty("icon-image")?le=(function(_e,me,Ee,Se,we,De,Ne,pt){let ct=null;const dt=me.getAppearanceValueAndResolveTokens(Ee,"icon-image",Se,we,pt);if(dt){const Tt=_e.getResolvedImageFromTokens(dt),vt=Ee.getUnevaluatedProperty("icon-size"),bt=jx(Tt,Xg(_e.zoom,vt,_e.worldview,pt),vt,we,_e.zoom,Se,_e.pixelRatio,Ne,_e.worldview,pt);ct=De.get(bt.iconPrimary.toString())}return ct})(e,i,l,d,m,P,k,U):D&&(le=D.imagePrimary),le&&(te=X0(le,null,Z,F),e.allowVerticalPlacement&&(se=X0(le,null,Z,F))),te&&(r.iconBBox=vm(te,r.iconBBox,Q,X)),se&&(r.iconVerticalBBox=vm(se,r.iconVerticalBBox,Q+90,X))}function B2(r,e,i,l,d,m,_,v){const S=r.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(r,"icon-offset",i,l,[]):null,A=S&&Array.isArray(S)?S:d,D=r.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(r,"icon-rotate",i,l,[]):null,P=typeof D=="number"?D:m,k=r.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(r,"icon-size",i,l,[]):null;return{appearanceIconOffset:A,appearanceIconRotate:P,appearanceIconSize:typeof k=="number"?k*v:_}}function $z(r,e,i,l,d,m,_,v,S,A){const{appearanceTextOffset:D,appearanceTextRotate:P,appearanceTextSize:k}=F2(i,e,l,d,m,_,v),F=k/v;S&&(r.textBBox=vm(S,r.textBBox,P,F,D)),A&&(r.textVerticalBBox=vm(A,r.textVerticalBBox,P+90,F,D))}function F2(r,e,i,l,d,m,_){const v=r.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(r,"text-offset",i,l,[]):null,S=v&&Array.isArray(v)?[v[0]*ua,v[1]*ua]:d,A=r.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(r,"text-rotate",i,l,[]):null,D=typeof A=="number"?A:m,P=r.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(r,"text-size",i,l,[]):null;return{appearanceTextOffset:S,appearanceTextRotate:D,appearanceTextSize:typeof P=="number"?P:_}}function J0(r,e,i,l,d,m,_,v,S){if(!e||!e.usvg)return;const A=T2(l),D=T2(d),P=m!=="both"&&m!=="width"||!b2(l)?1:D.width/A.width,k=m!=="both"&&m!=="height"||!w2(l)?1:D.height/A.height;i.scaleSelf(P,k);const F=i.toString();_.set(F,i),v.set(F,e);const{imagePosition:U}=Pw(F,e,1);S.set(F,U)}function V2(r,e,i,l,d,m,_,v,S,A){if(!r)return;const D=(function(P,k,F,U,Z,Q,X){if(P.kind==="camera")return P.maxSize;if(P.kind==="composite"){const te=k.possiblyEvaluate(new Mi(P.maxZoom,{worldview:Q}),F,X).evaluate(Z,{},F,X),se=k.possiblyEvaluate(new Mi(P.minZoom,{worldview:Q}),F,X).evaluate(Z,{},F,X);return Math.max(te,se)}return k.possiblyEvaluate(new Mi(U,{worldview:Q}),F,X).evaluate(Z,{},F,X)})(e,i,l,d,m,S,A);return r.scaleSelf(D*v*_)}function jx(r,e,i,l,d,m,_,v,S,A){return{iconPrimary:V2(r.getPrimary(),e,i,l,d,m,_,v,S,A),iconSecondary:V2(r.getSecondary(),e,i,l,d,m,_,v,S,A)}}function Zz(r,e,i){if(!e)return;const l=i.get(r.toString()),d=i.get(e.toString());l&&d&&(l.paddedRect.w===d.paddedRect.w&&l.paddedRect.h===d.paddedRect.h||kn(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),l.usvg!==d.usvg&&kn(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function j2(r,e,i,l){if(!r)return;const d=e.get(i.toString());if(r.imagePrimary=d,l){const m=e.get(l.toString());r.imageSecondary=m}}function Wz(r,e){for(const i in r.horizontal)U2(r.horizontal[i],e);U2(r.vertical,e)}function U2(r,e){if(r){for(const i of r.positionedLines)for(const l of i.positionedGlyphs)if(l.image!==null){const d=l.image.toString();l.rect=e.get(d).paddedRect}}}function zw(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xz(r,e,i,l,d,m,_,v,S){const A=eb(m.horizontal)||m.vertical,D=i.get("icon-text-fit-padding").evaluate(l,{},d);let P,k=e;return e&&S!=="none"&&(r.allowVerticalPlacement&&m.vertical&&(P=Mw(e,m.vertical,S,D,v,_)),A&&(k=Mw(e,A,S,D,v,_))),{defaultShapedIcon:k,verticallyShapedIcon:P}}function G2(r,e){return r*e/24}function Yz(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te,se,le,_e,me,Ee){let Se=_.textMaxSize.evaluate(e,{},k);Se===void 0?Se=v*_.textScaleFactor:Se*=_.textScaleFactor;const we=r.layers[0].layout,De=G2(v,_.textScaleFactor),Ne=eb(i.horizontal)||i.vertical,pt=r.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((Q!=="none"||pt)&&r.appearanceFeatureData&&r.featureToAppearanceIndex[e.index]<r.appearanceFeatureData.length){const $t=r.appearanceFeatureData[r.featureToAppearanceIndex[e.index]];$t&&($t.textShaping=Ne,$t.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(e,{},k),$t.fontScale=De,$t.textScaleFactor=_.textScaleFactor)}const ct=F.name==="globe",dt=r.tilePixelRatio*Se/24,Tt=(Ct=r.overscaling,r.zoom>18&&Ct>2&&(Ct>>=1),Math.max(jt/(512*Ct),1)*we.get("symbol-spacing")),vt=we.get("text-padding")*r.tilePixelRatio,bt=we.get("icon-padding")*r.tilePixelRatio,ot=oi(we.get("text-max-angle")),At=we.get("icon-rotation-alignment")==="map"&&se!=="point",_t=Tt/2;var Ct;r.hasAnyIconTextFit===!1&&Q!=="none"&&(r.hasAnyIconTextFit=!0);const Et=e.properties?+e.properties[ci]:null,nn=Et&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(Et):65535,rn=($t,Wt,An)=>{if(Wt.x<0||Wt.x>=jt||Wt.y<0||Wt.y>=jt)return;let _n=null;if(ct){const{x:Jt,y:Bn,z:ri}=F.projectTilePoint(Wt.x,Wt.y,An);_n={anchor:new hp(Jt,Bn,ri,0,void 0),up:F.upVector(An,Wt.x,Wt.y)}}(function(Jt,Bn,ri,Ri,Jn,Zi,yi,os,wi,ji,Tr,zr,Nr,ls,Ta,Xa,Ls,Hs,ta,Yn,Br,Yr,tc,Go,Ea,qo,Xd,_o,_b,fy,sl,yb){const Yd=Jt.addToLineVertexArray(Bn,Ri);let dp,Tm,hu,Wu,iv,py,ei,ha=0,cs=0,$s=0,du=0,bl=-1,nc=-1;const da={};let rv=ro("");const Kd=ri?ri.anchor:Bn,Os=_o!=="none";let Sa=0,Zs=0;if(wi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Aa=wi.layout.get("text-offset").evaluate(Br,{},Ea);Sa=Aa[0]*ua,Zs=Aa[1]*ua}else Sa=wi.layout.get("text-radial-offset").evaluate(Br,{},Ea)*ua,Zs=Ow;if(Jt.allowVerticalPlacement&&Jn.vertical){const Aa=Jn.vertical;if(Ta)py=Fw(Aa),os&&(ei=Fw(os));else{const wl=wi.layout.get("text-rotate").evaluate(Br,{},Ea)+90;hu=tb(ji,Kd,Bn,Tr,zr,Nr,Aa,ls,wl,Xa,yb),os&&(Wu=tb(ji,Kd,Bn,Tr,zr,Nr,os,Hs,wl,null,sl))}}if(Zi){const Aa=wi.layout.get("icon-rotate").evaluate(Br,{},Ea),wl=Lw(Zi,Aa,tc,Os,Yr.iconScaleFactor),Xu=os?Lw(os,Aa,tc,Os,Yr.iconScaleFactor):void 0;Tm=tb(ji,Kd,Bn,Tr,zr,Nr,Zi,Hs,Aa,null,fy);const Qd=(function($h,lN,oC,cN,uN,lC,cC,hN,nZ,cT){const uC=$h.layers[0],hC=uC.appearances;let gy=lN.length;if(oC&&(gy=Math.max(gy,oC.length)),hC.length===0)return gy;const[dN,fN]=cN.get("icon-size-scale-range"),pN=xe(1,dN,fN);for(const uT of hC){const dC=uT.getUnevaluatedProperties();if(dC._values["icon-image"].value!==void 0){const fC=uC.getAppearanceValueAndResolveTokens(uT,"icon-image",lC,cC,cT);if(fC){const pC=$h.getResolvedImageFromTokens(fC);if(pC){const mC=uT.hasProperty("icon-size")?dC._values["icon-size"]:uN._values["icon-size"],mN=jx(pC,Xg($h.zoom,mC,$h.worldview,cT),mC,cC,$h.zoom,lC,$h.pixelRatio,pN,$h.worldview,cT),gC=hN.get(mN.iconPrimary.toString());gC&&(gy=Math.max(gy,Bz(gC)))}}}}return gy})(Jt,wl,Xu,wi.layout,wi._unevaluatedLayout,Br,Ea,Jt.iconAtlasPositions,0,Go);ha=4*Qd;const oT=wi.layout.get("icon-size").evaluate(Br,{},Ea,Go),lT=Yr.compositeIconSizes?Yr.compositeIconSizes[0].evaluate(Br,{},Ea,Go):0,sv=Yr.compositeIconSizes?Yr.compositeIconSizes[1].evaluate(Br,{},Ea,Go):0,my=Bw(Jt.layerIds[0],Jt.iconSizeData,oT,Yr.iconScaleFactor,lT,sv);Jt.addSymbols(Jt.icon,wl,my,Yn,ta,Br,void 0,ri,Bn,Yd.lineStartIndex,Yd.lineLength,-1,Go,Ea,qo,Xd,Jt.symbolInstances.length,Qd),bl=Jt.icon.placedSymbolArray.length-1,Xu&&(cs=4*Qd,Jt.addSymbols(Jt.icon,Xu,my,Yn,ta,Br,ec.vertical,ri,Bn,Yd.lineStartIndex,Yd.lineLength,-1,Go,Ea,qo,Xd,Jt.symbolInstances.length,Qd),nc=Jt.icon.placedSymbolArray.length-1)}for(const Aa in Jn.horizontal){const wl=Aa,Xu=Jn.horizontal[wl];dp||(rv=ro(Xu.text),Ta?iv=Fw(Xu):dp=tb(ji,Kd,Bn,Tr,zr,Nr,Xu,ls,wi.layout.get("text-rotate").evaluate(Br,{},Ea),Xa,yb));const Qd=Xu.positionedLines.length===1;if($s+=q2(Jt,ri,Bn,Xu,yi,wi,Ta,Br,Xa,Yd,Jn.vertical?ec.horizontal:ec.horizontalOnly,Qd?Uz(Jn.horizontal):[wl],da,bl,Yr,Go,Ea,Jt.symbolInstances.length,qo),Qd)break}Jn.vertical&&(du+=q2(Jt,ri,Bn,Jn.vertical,yi,wi,Ta,Br,Xa,Yd,ec.vertical,["vertical"],da,nc,Yr,Go,Ea,Jt.symbolInstances.length,qo));let yo=-1;const xo=(Aa,wl)=>Aa?Math.max(Aa,wl):wl;yo=xo(iv,yo),yo=xo(py,yo),yo=xo(ei,yo);const Em=yo>-1?1:0;Jt.glyphOffsetArray.length>=65535&&kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Br.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,Br.sortKey),Jt.symbolInstances.emplaceBack(Bn.x,Bn.y,Kd.x,Kd.y,Kd.z,da.right>=0?da.right:-1,da.center>=0?da.center:-1,da.left>=0?da.left:-1,da.vertical>=0?da.vertical:-1,bl,nc,rv,dp!==void 0?dp:Jt.collisionBoxArray.length,dp!==void 0?dp+1:Jt.collisionBoxArray.length,hu!==void 0?hu:Jt.collisionBoxArray.length,hu!==void 0?hu+1:Jt.collisionBoxArray.length,Tm!==void 0?Tm:Jt.collisionBoxArray.length,Tm!==void 0?Tm+1:Jt.collisionBoxArray.length,Wu||Jt.collisionBoxArray.length,Wu?Wu+1:Jt.collisionBoxArray.length,Tr,$s,du,ha,cs,Em,0,Sa,Zs,yo,0,Os?1:0,_b)})(r,Wt,_n,$t,i,l,m,d,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,vt,te,A,0,bt,At,X,e,_,D,P,k,U,Z,Q,nn,le,_e,me)};if(se==="line")for(const $t of z0(e.geometry,0,0,jt,jt)){const Wt=Nz($t,Tt,ot,i.vertical||Ne,l,24,dt,r.overscaling,jt);for(const An of Wt)Ne&&Kz(r,Ne.text,_t,An)||rn($t,An,k)}else if(se==="line-center"){for(const $t of e.geometry)if($t.length>1){const Wt=zz($t,ot,i.vertical||Ne,l,24,dt);Wt&&rn($t,Wt,k)}}else if(e.type==="Polygon")for(const $t of Bg(e.geometry,0)){const Wt=Vz($t,16);rn($t[0],new hp(Wt.x,Wt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const $t of e.geometry)rn($t,new hp($t[0].x,$t[0].y,0,0,void 0),k);else if(e.type==="Point")for(const $t of e.geometry)for(const Wt of $t)rn([Wt],new hp(Wt.x,Wt.y,0,0,void 0),k)}const Nw=255,Yg=Nw*up;function q2(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te){const se=z2(0,l,S,m,_,v,d,r.allowVerticalPlacement,void 0),le=m.layout.get("text-size").evaluate(v,{},Q),_e=U.compositeTextSizes?U.compositeTextSizes[0].evaluate(v,{},Q):0,me=U.compositeTextSizes?U.compositeTextSizes[1].evaluate(v,{},Q):0,Ee=Bw(r.layerIds[0],r.textSizeData,le,U.textScaleFactor,_e,me);r.addSymbols(r.text,se,Ee,S,_,v,D,e,i,A.lineStartIndex,A.lineLength,F,Z,Q,te,!1,X,se.length);for(const Se of P)k[Se]=r.text.placedSymbolArray.length-1;return 4*se.length}function Bw(r,e,i,l,d,m){const _=e;let v=null;return _.kind==="source"?(v=[up*i*l],v[0]>Yg&&kn(`${r}: Value for "text-size" is >= ${Nw}. Reduce your "text-size".`)):_.kind==="composite"&&(v=[up*d*l,up*m*l],(v[0]>Yg||v[1]>Yg)&&kn(`${r}: Value for "text-size" is >= ${Nw}. Reduce your "text-size".`)),v}function eb(r){for(const e in r)return r[e];return null}function tb(r,e,i,l,d,m,_,v,S,A,D){let P,k,F,U;if(P=D?D.top:_.top,k=D?D.bottom:_.bottom,F=D?D.left:_.left,U=D?D.right:_.right,Rw(_)&&_.collisionPadding){const Z=_.collisionPadding;F-=Z[0],P-=Z[1],U+=Z[2],k+=Z[3]}if(S){const Z=new Dt(F,P),Q=new Dt(U,P),X=new Dt(F,k),te=new Dt(U,k),se=oi(S);let le=new Dt(0,0);A&&(le=new Dt(A[0],A[1])),Z._rotateAround(se,le),Q._rotateAround(se,le),X._rotateAround(se,le),te._rotateAround(se,le),F=Math.min(Z.x,Q.x,X.x,te.x),U=Math.max(Z.x,Q.x,X.x,te.x),P=Math.min(Z.y,Q.y,X.y,te.y),k=Math.max(Z.y,Q.y,X.y,te.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,F,P,U,k,v,l,d,m),r.length-1}function Fw(r){Rw(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Kz(r,e,i,l){const d=r.compareText;if(e in d){const m=d[e];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<i)return!0}else d[e]=[];return d[e].push(l),!1}function H2(r,e){const i=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,d=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),m=Math.sin(i)*d/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*m+d;const v=d*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let S=Math.max(r.zoom-17,0);r.isOrthographic&&(S/=10),_*=1+S}return Math.min(1.01*_,v)}function Ux(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),l=r.x*i,d=(r.x+1)*i,m=r.y*i,_=(r.y+1)*i,v=ut(l),S=ut(d),A=xt(m),D=xt(_),P=e.project(v,A),k=e.project(S,A),F=e.project(S,D),U=e.project(v,D);let Z=Math.min(P.x,k.x,F.x,U.x),Q=Math.min(P.y,k.y,F.y,U.y),X=Math.max(P.x,k.x,F.x,U.x),te=Math.max(P.y,k.y,F.y,U.y);const se=i/16;function le(me,Ee,Se,we,De,Ne){const pt=(Se+De)/2,ct=(we+Ne)/2,dt=e.project(ut(pt),xt(ct)),Tt=Math.max(0,Z-dt.x,Q-dt.y,dt.x-X,dt.y-te);Z=Math.min(Z,dt.x),X=Math.max(X,dt.x),Q=Math.min(Q,dt.y),te=Math.max(te,dt.y),Tt>se&&(le(me,dt,Se,we,pt,ct),le(dt,Ee,pt,ct,De,Ne))}le(P,k,l,m,d,m),le(k,F,d,m,d,_),le(F,U,d,_,l,_),le(U,P,l,_,l,m),Z-=se,Q-=se,X+=se,te+=se;const _e=1/Math.max(X-Z,te-Q);return{scale:_e,x:Z*_e,y:Q*_e,x2:X*_e,y2:te*_e,projection:e}}function $2(r,{x:e,y:i},l=0){return new Dt(((e-l)*r.scale-r.x)*jt,(i*r.scale-r.y)*jt)}const Qz=Ke(new Float32Array(16));class bm{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ge(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l,d=!0){return e._coordinatePoint(e.locationCoordinate(i,l),d)}pixelsPerMeter(e,i){return Ze(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return H2(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,d){const m=e.horizonLineFromTop(!1),_=new Dt(i,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,d))}pointCoordinate3D(e,i,l){const d=new Dt(i,l);if(e.elevation)return e.elevation.pointCoordinate(d);{const m=this.pointCoordinate(e,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return Qz}createTileMatrix(e,i,l){let d,m,_;const v=l.canonical,S=Ke(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Ux(v,this);d=1,m=A.x+l.wrap*A.scale,_=A.y,Mt(S,S,[d/A.scale,d/A.scale,e.pixelsPerMeter/i])}else d=i/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*l.wrap)*d,_=v.y*d;return Ge(S,S,[m,_,0]),Mt(S,S,[d/jt,d/jt,1]),S}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class Jz extends bm{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(oi(i));this.n=(d+Math.sin(oi(l)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:d,r0:m}=this,_=oi(e-this.center[0]),v=oi(i),S=Math.sqrt(d-2*l*Math.sin(v))/l;return{x:S*Math.sin(_*l),y:S*Math.cos(_*l)-m,z:0}}unproject(e,i){const{n:l,c:d,r0:m}=this,_=m+i;let v=Math.atan2(e,Math.abs(_))*Math.sign(_);_*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(_));const S=oi(this.center[0])*l;v=st(v,-Math.PI-S,Math.PI-S);const A=xe(qe(v/l)+this.center[0],-180,180),D=Math.asin(xe((d-(e*e+_*_)*l*l)/(2*l),-1,1)),P=xe(qe(D),-85.051129,Le);return new ge(A,P)}}const Gx=1.340264,qx=-.081106,Hx=893e-6,$x=.003796,nb=Math.sqrt(3)/2;class e3 extends bm{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(nb*Math.sin(i)),d=l*l,m=d*d*d;return{x:.5*(e*Math.cos(l)/(nb*(Gx+3*qx*d+m*(7*Hx+9*$x*d)))/Math.PI+.5),y:1-.5*(l*(Gx+qx*d+m*(Hx+$x*d))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,d=l*l,m=d*d*d;for(let D,P,k,F=0;F<12&&(P=l*(Gx+qx*d+m*(Hx+$x*d))-i,k=Gx+3*qx*d+m*(7*Hx+9*$x*d),D=P/k,l=xe(l-D,-Math.PI/3,Math.PI/3),d=l*l,m=d*d*d,!(Math.abs(D)<1e-12));++F);const _=nb*e*(Gx+3*qx*d+m*(7*Hx+9*$x*d))/Math.cos(l),v=Math.asin(Math.sin(l)/nb),S=xe(180*_/Math.PI,-180,180),A=xe(180*v/Math.PI,-85.051129,Le);return new ge(S,A)}}class t3 extends bm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),d=xe(360*(.5-i),-85.051129,Le);return new ge(l,d)}}const oy=Math.PI/2;function ib(r){return Math.tan((oy+r)/2)}class n3 extends bm{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let d=oi(i),m=oi(l);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const _=Math.cos(d),v=ib(d);this.n=d===m?Math.sin(d):Math.log(_/Math.cos(m))/Math.log(ib(m)/v),this.f=_*Math.pow(ib(d),this.n)/this.n}project(e,i){i=oi(i),this.southernCenter&&(i=-i),e=oi(e-this.center[0]);const l=1e-6,{n:d,f:m}=this;m>0?i<-oy+l&&(i=-oy+l):i>oy-l&&(i=oy-l);const _=m/Math.pow(ib(i),d);let v=_*Math.sin(d*e),S=m-_*Math.cos(d*e);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:d}=this,m=d-i,_=Math.sign(m),v=Math.sign(l)*Math.sqrt(e*e+m*m);let S=Math.atan2(e,Math.abs(m))*_;m*l<0&&(S-=Math.PI*Math.sign(e)*_);const A=xe(qe(S/l)+this.center[0],-180,180),D=xe(qe(2*Math.atan(Math.pow(d/v,1/l))-oy),-85.051129,Le);return new ge(A,this.southernCenter?-D:D)}}class Z2 extends bm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:je(e),y:Xe(i),z:0}}unproject(e,i){const l=ut(e),d=xt(i);return new ge(l,d)}}const W2=oi(Le);class i3 extends bm{project(e,i){const l=(i=oi(i))*i,d=l*l;return{x:.5*((e=oi(e))*(.8707-.131979*l+d*(d*(.003971*l-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+d*(.028874*l-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,d=25,m=0,_=l*l;do{_=l*l;const A=_*_;m=(l*(1.007226+_*(.015085+A*(.028874*_-.044475-.005916*A)))-i)/(1.007226+_*(.045255+A*(.259866*_-.311325-.005916*11*A))),l=xe(l-m,-W2,W2)}while(Math.abs(m)>1e-6&&--d>0);_=l*l;const v=xe(qe(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),S=qe(l);return new ge(v,S)}}const X2=oi(Le);class r3 extends bm{project(e,i){i=oi(i),e=oi(e);const l=Math.cos(i),d=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),_=Math.sin(m)/m,v=.5*(e*d+2*l*Math.sin(e/2)/_)||0,S=.5*(i+Math.sin(i)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,d=i=(2*(1-i)-1)*Math.PI,m=25;const _=1e-6;let v=0,S=0;do{const A=Math.cos(d),D=Math.sin(d),P=2*D*A,k=D*D,F=A*A,U=Math.cos(l/2),Z=Math.sin(l/2),Q=2*U*Z,X=Z*Z,te=1-F*U*U,se=te?1/te:0,le=te?Math.acos(A*U)*Math.sqrt(1/te):0,_e=.5*(2*le*A*Z+2*l/Math.PI)-e,me=.5*(le*D+d)-i,Ee=.5*se*(F*X+le*A*U*k)+1/Math.PI,Se=se*(Q*P/4-le*D*Z),we=.125*se*(P*Z-le*D*F*Q),De=.5*se*(k*U+le*X*A)+.5,Ne=Se*we-De*Ee;v=(me*Se-_e*De)/Ne,S=(_e*we-me*Ee)/Ne,l=xe(l-v,-Math.PI,Math.PI),d=xe(d-S,-X2,X2)}while((Math.abs(v)>_||Math.abs(S)>_)&&--m>0);return new ge(qe(l),qe(d))}}class Y2 extends bm{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(oi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:d}=this;return{x:oi(e)*d*l+.5,y:-Math.sin(oi(i))/d*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:d}=this,m=-(i-.5)/l,_=xe(qe((e-.5)/l)/d,-180,180),v=Math.asin(xe(m*d,-1,1)),S=xe(qe(v),-85.051129,Le);return new ge(_,S)}}class s3 extends Z2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const d=Ig(e,i,l);return Cn(d,d,Cg(lu(l))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,i,l){const d=Te(i.lat,i.lng),m=qn([],d),_=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;En(d,d,m,Ze(1,0)*jt*_);const v=Ke(new Float64Array(16));return nt(v,e.pixelMatrix,e.globeMatrix),Cn(d,d,v),new Dt(d[0],d[1])}pixelsPerMeter(e,i){return Ze(1,0)*i}pixelSpaceConversion(e,i,l){const d=Ze(1,e)*i,m=Rn(Ze(1,45)*i,d,l);return this.pixelsPerMeter(e,i)/m}createTileMatrix(e,i,l){const d=or(lu(l.canonical));return nt(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,i){const{center:l}=e,d=Cg(lu(i));return St(d,d,oi(l.lng)),cn(d,d,oi(l.lat)),Mt(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,i,l,d){return ax(e,i,l,!0)||new qt(0,0)}pointCoordinate3D(e,i,l){const d=this.pointCoordinate(e,i,l,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,i){return!ax(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(d,m){const _=d.cameraToCenterDistance,v=d._centerAltitude*m,S=d._camera,A=d._camera.forward(),D=wn([],Be([],A,-_),[0,0,v]),P=d.worldSize/(2*Math.PI),k=[0,0,-P],F=d.width/d.height,U=Math.tan(d.fovAboveCenter),Z=Be([],S.up(),U),Q=Be([],S.right(),U*F),X=qn([],wn([],wn([],A,Z),Q)),te=[];let se;if(new Ki(D,X).closestPointOnSphere(k,P,te)){const le=wn([],te,k),_e=tr([],le,D);se=Math.cos(d.fovAboveCenter)*dn(_e)}else{const le=tr([],D,k),_e=tr([],k,D);qn(_e,_e);const me=dn(le)-P;se=Math.sqrt(me*(me+2*P));const Ee=Math.acos(se/(P+me))-Math.acos(Ni(A,_e));se*=Math.cos(Ee)}return 1.01*se})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Fh(e.zoom);if(l>0){const d=H2(e,Ze(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Rn(i,d+m*(1-Math.cos(_)),Math.pow(l,10))}return i}upVector(e,i,l){return Ig(i,l,e,1)}upVectorScale(e){return{metersToTile:Sg(qd(lu(e)))}}}function K2(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Z2(r);case"equirectangular":return new t3(r);case"naturalEarth":return new i3(r);case"equalEarth":return new e3(r);case"winkelTripel":return new r3(r);case"albers":return i?new Y2(r):new Jz(r);case"lambertConformalConic":return i?new Y2(r):new n3(r);case"globe":return new s3(r)}throw new Error(`Invalid projection name: ${r.name}`)}const a3=ni.types,o3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zx(r,e,i,l,d,m,_,v,S,A,D,P,k){const F=v?Math.min(Yg,Math.round(v[0])):0,U=v?Math.min(Yg,Math.round(v[1])):0;r.emplaceBack(e,i,Math.round(32*l),Math.round(32*d),m,_,(F<<1)+(S?1:0),0+(U<<1),16*A,16*D,256*P,256*k)}function Wx(r,e,i){r.emplaceBack(e,i)}function Xx(r,e,i,l,d,m,_){r.emplaceBack(e,i,l,d,m,_)}const rb=(r,e,i,l)=>{for(let d=0;d<e;d++)r.emplaceBack(i[0],i[1],i[2],l[0],l[1],l[2])};function ly(r,e,i,l,d){r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d),r.emplaceBack(e,i,l,d)}function l3(r){for(const e of r.sections)if(wc(e.text))return!0;return!1}class Vw{constructor(e){this.layoutVertexArray=new Dh,this.indexArray=new vs,this.programConfigurations=e,this.segments=new fr,this.dynamicLayoutVertexArray=new Zl,this.opacityVertexArray=new nm,this.placedSymbolArray=new ep,this.iconTransitioningVertexArray=new nl,this.globeExtVertexArray=new tm,this.zOffsetVertexArray=new Gs,this.orientationVertexArray=new Pd,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,i){const l=[],d=this.layoutVertexArray.uint16;for(let m=0;m<i;++m){const _=12*(e+m);l.push(...d.slice(_,_+12))}return l}updateSymbolVertexData(e,i,l,d,m,_,v,S,A,D,P,k,F){const U=this.layoutVertexArray.uint16,Z=12*e;U[Z]=i,U[Z+1]=l,U[Z+2]=d,U[Z+3]=m,U[Z+4]=_,U[Z+5]=v,U[Z+6]=S,U[Z+7]=A,U[Z+8]=D,U[Z+9]=P,U[Z+10]=k,U[Z+11]=F}upload(e,i,l,d,m,_){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uz.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,o3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,mz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,fz.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,pz.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ft(Vw,"SymbolBuffers");class jw{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new fr,this.collisionVertexArray=new Kf,this.collisionVertexArrayExt=new Zl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,gz.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_z.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(jw,"CollisionBuffers");class sb{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ke([]),this.placementViewportMatrix=Ke([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Xg(this.zoom,i["text-size"],this.worldview,e.availableImages),this.iconSizeData=Xg(this.zoom,i["icon-size"],this.worldview,e.availableImages);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>ec[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();if(!i||i.length===0)return!1;const l=Array.isArray(e)?e:[e];return i.some(d=>l.some(m=>d.getProperty(m)!=null))}createArrays(){this.text=new Vw(new z(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Vw(new z(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new tp,this.lineVertexArray=new L_,this.symbolInstances=new ds}calculateGlyphDependencies(e,i,l,d,m){for(const _ of e){const v=_.codePointAt(0);if(v===void 0)break;if(i[v]=!0,d&&m&&v<=65535){const S=Nx[_];S&&(i[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,l,d,m,_,v){if(!e.hasProperty("icon-size"))return v*_;let S=1;const A=e.getUnevaluatedProperties()._values["icon-size"],D=Xg(this.zoom,A,this.worldview,m),P=ry(D,i);if(D.kind!=="constant"&&D.kind!=="camera"||(S=P.uSize),D.kind==="composite"){const{minZoom:k,maxZoom:F}=D,U=A.possiblyEvaluate(new Mi(k,{worldview:this.worldview}),d),Z=A.possiblyEvaluate(new Mi(F,{worldview:this.worldview}),d),Q=U.evaluate(l,{},d,m);S=Q+(Z.evaluate(l,{},d,m)-Q)*P.uSizeT}return D.kind==="source"&&(S=A.possiblyEvaluate(new Mi(this.zoom,{worldview:this.worldview}),d).evaluate(l,{},d,m)),S*_}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!h(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?so.build(e):e}populate(e,i,l,d){const m=this.layers[0],_=m.layout,v=this.projection.name==="globe",S=_.get("text-font"),A=_.get("text-field"),D=_.get("icon-image"),[P,k]=_.get("icon-size-scale-range"),F=xe(i.scaleFactor||1,P,k),U=(A.value.kind!=="constant"||A.value.value instanceof Ms&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),Z=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,Q=this.hasAnyAppearanceProperty("icon-image"),X=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!U&&!Z&&!Q)return;const te=i.iconDependencies,se=i.glyphDependencies,le=i.availableImages,_e=new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),me=Ee=>{const Se=Ee.id.toString();te.has(Se)?te.get(Se).push(Ee):te.set(Se,[Ee])};for(const Ee of e){const{feature:Se,id:we,index:De,sourceLayerIndex:Ne}=Ee,pt=m._featureFilter.needGeometry,ct=jn(Se,pt);if(!m._featureFilter.filter(_e,ct,l))continue;if(pt||(ct.geometry=Dn(Se,l,d)),v&&Se.type!==1&&l.z<=5){const Ct=ct.geometry,Et=.98078528056,nn=(rn,$t)=>Ni(Ig(rn.x,rn.y,l,1),Ig($t.x,$t.y,l,1))<Et;for(let rn=0;rn<Ct.length;rn++)Ct[rn]=an(Ct[rn],nn)}let dt,Tt;if(U){const Ct=m.getValueAndResolveTokens("text-field",ct,l,le),Et=Ms.factory(Ct);l3(Et)&&(this.hasRTLText=!0),(!this.hasRTLText||Ou()==="unavailable"||this.hasRTLText&&No.isParsed())&&(dt=xz(Et,m,ct))}if(Z){const Ct=m.getValueAndResolveTokens("icon-image",ct,l,le);Tt=this.getResolvedImageFromTokens(Ct)}const vt=this.layers[0];let bt=!1;if(!Tt&&Q){const Ct=vt.getAppearances();for(const Et of Ct)if(Et.getProperty("icon-image")){const nn=vt.getAppearanceValueAndResolveTokens(Et,"icon-image",ct,l,le);if(nn){Tt=this.getResolvedImageFromTokens(nn),bt=!0;break}}}if(!dt&&!Tt)continue;const ot=this.sortFeaturesByKey?X.evaluate(ct,{},l):void 0,At={id:we,text:dt,icon:Tt,index:De,sourceLayerIndex:Ne,geometry:ct.geometry,properties:Se.properties,type:a3[Se.type],sortKey:ot};if(this.features.push(At),this.featureToAppearanceIndex[De]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:we,properties:Se.properties,usesAppearanceIconAsPlaceholder:bt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),Tt){const Ct=vt._unevaluatedLayout._values,{iconPrimary:Et,iconSecondary:nn}=jx(Tt,this.iconSizeData,Ct["icon-size"],l,this.zoom,At,this.pixelRatio,F,this.worldview,le);me(Et),nn&&(this.hasAnySecondaryIcon=!0,me(nn))}const _t=vt.getAppearances();if(_t.length!==0&&_t.forEach(Ct=>{if(!Ct.getProperty("icon-image"))return;const Et=this.getCombinedIconPrimary(Ct,vt,ct,l,le,At,F);Et&&me(Et)}),dt){const Ct=S.evaluate(ct,{},l).join(","),Et=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ec.vertical)>=0;for(const nn of dt.sections)if(nn.image){const rn=nn.image.getPrimary().scaleSelf(this.pixelRatio),$t=rn.id.toString(),Wt=te.get($t)||[];Wt.push(rn),te.set($t,Wt)}else{const rn=$p(dt.toString()),$t=nn.fontStack||Ct,Wt=se[$t]=se[$t]||{};this.calculateGlyphDependencies(nn.text,Wt,Et,this.allowVerticalPlacement,rn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ee){const Se={},we={},De=[];let Ne=0;function pt(vt){De.push(Ee[vt]),Ne++}function ct(vt,bt,ot){const At=we[vt];return delete we[vt],we[bt]=At,De[At].geometry[0].pop(),De[At].geometry[0]=De[At].geometry[0].concat(ot[0]),At}function dt(vt,bt,ot){const At=Se[bt];return delete Se[bt],Se[vt]=At,De[At].geometry[0].shift(),De[At].geometry[0]=ot[0].concat(De[At].geometry[0]),At}function Tt(vt,bt,ot){const At=ot?bt[0][bt[0].length-1]:bt[0][0];return`${vt}:${At.x}:${At.y}`}for(let vt=0;vt<Ee.length;vt++){const bt=Ee[vt],ot=bt.geometry,At=bt.text?bt.text.toString():null;if(!At){pt(vt);continue}const _t=Tt(At,ot),Ct=Tt(At,ot,!0);if(_t in we&&Ct in Se&&we[_t]!==Se[Ct]){const Et=dt(_t,Ct,ot),nn=ct(_t,Ct,De[Et].geometry);delete Se[_t],delete we[Ct],we[Tt(At,De[nn].geometry,!0)]=nn,De[Et].geometry=null}else _t in we?ct(_t,Ct,ot):Ct in Se?dt(_t,Ct,ot):(pt(vt),Se[_t]=Ne-1,we[Ct]=Ne-1)}return De.filter(vt=>vt.geometry)})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Se)=>Ee.sortKey-Se.sortKey)}getCombinedIconPrimary(e,i,l,d,m,_,v){let S,A;const D=e.getUnevaluatedProperties();if(D._values["icon-image"].value!==void 0){const P=i.getAppearanceValueAndResolveTokens(e,"icon-image",l,d,m);S=this.getResolvedImageFromTokens(P)}else{const P=i.getValueAndResolveTokens("icon-image",l,d,m);S=this.getResolvedImageFromTokens(P)}if(S){const P=e.hasProperty("icon-size")?D._values["icon-size"]:i._unevaluatedLayout._values["icon-size"];A=jx(S,Xg(this.zoom,P,this.worldview,m),P,d,this.zoom,_,this.pixelRatio,v,this.worldview,m).iconPrimary}return A}updateSymbolInstanceIconVertices(e,i,l,d,m,_,v,S,A,D,P,k,F,U){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(i.activeAppearance===l)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(l){const Z=this.getCombinedIconPrimary(l,A,d,_,v,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:i.properties,type:"Point",id:i.id},D);if(!Z)return{vertexOffsetDelta:0,hasChanges:!1};const Q=Z.toString(),X=this.iconAtlasPositions&&this.iconAtlasPositions.get(Q);if(X){const{appearanceIconOffset:te,appearanceIconRotate:se}=B2(l,A,d,_,k,U,F,D);let le=X0(X,void 0,te,A.layout.get("icon-anchor").evaluate(d,P,_));const _e=X.sdf,me=A.layout.get("icon-text-fit").constantOr("none");me!=="none"&&i.textShaping&&i.iconTextFitPadding&&i.fontScale&&(le=Mw(le,i.textShaping,me,i.iconTextFitPadding,te,i.fontScale));const Ee=this.calculateEffectiveAppearanceIconSize(l,S.zoom,d,_,v,D,F),Se=0,we=1+(Math.min(Yg,Math.round(Ee*up))<<1),De=Lw(le,se,_e,me!=="none",D);i.isUsingAppearanceIconVertexData||(i.isUsingAppearanceIconVertexData=!0,i.layoutBasedIconVertexData=this.icon.getSymbolVertexData(m,e.numIconVertices));let Ne=m;for(let ct=0;ct<De.length;++ct){const dt=De[ct],Tt=i.layoutBasedIconVertexData[0]||e.tileAnchorX,vt=i.layoutBasedIconVertexData[1]||e.tileAnchorY,bt=16*dt.pixelOffsetTL.x,ot=16*dt.pixelOffsetTL.y,At=16*dt.pixelOffsetBR.x,_t=16*dt.pixelOffsetBR.y,Ct=16*dt.minFontScaleX,Et=16*dt.minFontScaleY;this.icon.updateSymbolVertexData(Ne,Tt,vt,Math.round(32*dt.tl.x),Math.round(32*dt.tl.y),dt.texPrimary.x,dt.texPrimary.y,Se,we,bt,ot,Ct,Et),this.icon.updateSymbolVertexData(Ne+1,Tt,vt,Math.round(32*dt.tr.x),Math.round(32*dt.tr.y),dt.texPrimary.x+dt.texPrimary.w,dt.texPrimary.y,Se,we,At,ot,Ct,Et),this.icon.updateSymbolVertexData(Ne+2,Tt,vt,Math.round(32*dt.bl.x),Math.round(32*dt.bl.y),dt.texPrimary.x,dt.texPrimary.y+dt.texPrimary.h,Se,we,bt,_t,Ct,Et),this.icon.updateSymbolVertexData(Ne+3,Tt,vt,Math.round(32*dt.br.x),Math.round(32*dt.br.y),dt.texPrimary.x+dt.texPrimary.w,dt.texPrimary.y+dt.texPrimary.h,Se,we,At,_t,Ct,Et),Ne+=4}const pt=e.numIconVertices-4*De.length;for(let ct=0;ct<pt;++ct)this.icon.updateSymbolVertexData(Ne+ct,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(i.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(m,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(i.isUsingAppearanceIconVertexData){const Q=i.layoutBasedIconVertexData.length/12;for(let X=0;X<Q;++X){const te=X*12;this.icon.updateSymbolVertexData(m+X,i.layoutBasedIconVertexData[te+0],i.layoutBasedIconVertexData[te+1],i.layoutBasedIconVertexData[te+2],i.layoutBasedIconVertexData[te+3],i.layoutBasedIconVertexData[te+4],i.layoutBasedIconVertexData[te+5],i.layoutBasedIconVertexData[te+6],i.layoutBasedIconVertexData[te+7],i.layoutBasedIconVertexData[te+8],i.layoutBasedIconVertexData[te+9],i.layoutBasedIconVertexData[te+10],i.layoutBasedIconVertexData[te+11])}return i.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:Q,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te){const se=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!se)return{vertexOffsetDelta:se?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(i.activeAppearance===l)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(l&&i.textShaping){const{appearanceTextOffset:le,appearanceTextRotate:_e,appearanceTextSize:me}=F2(l,v,d,_,P,F,k);i.fontScale=G2(me,i.textScaleFactor);const Ee=l.getUnevaluatedProperty("text-size");let Se=this.textSizeData,we=Q,De=X;l.hasProperty("text-size")&&(Se=Xg(this.zoom,Ee,this.worldview,te),we=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,De=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Ne=i.textShaping.bottom-P[1],pt=i.textShaping.left-P[0],ct=i.textShaping.right-P[0];i.textShaping.top=le[1]+(i.textShaping.top-P[1]),i.textShaping.bottom=le[1]+Ne,i.textShaping.left=le[0]+pt,i.textShaping.right=le[0]+ct;const dt=z2(0,i.textShaping,le,v,!1,d,A,this.allowVerticalPlacement,_e),Tt=me&&Se.kind==="composite"?Ee.possiblyEvaluate(new Mi(we,{}),_).evaluate(d,D,_):U,vt=me&&Se.kind==="composite"?Ee.possiblyEvaluate(new Mi(De,{}),_).evaluate(d,D,_):Z,bt=Bw(l.name,Se,me,S,Tt,vt),ot=Array.isArray(bt)?bt[1]:me,At=0,_t=1+(Math.min(Yg,Math.round(ot*up))<<1);i.isUsingAppearanceTextVertexData||(i.isUsingAppearanceTextVertexData=!0,i.layoutBasedTextVertexData=this.text.getSymbolVertexData(m,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let Ct=0;Ct<dt.length&&Ct<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++Ct){const Et=dt[Ct],nn=Et.glyphOffset[1],rn=e.tileAnchorX,$t=e.tileAnchorY,Wt=m+4*Ct;this.text.updateSymbolVertexData(Wt,rn,$t,Math.round(32*Et.tl.x),Math.round(32*(nn+Et.tl.y)),Et.texPrimary.x,Et.texPrimary.y,At,_t,Et.pixelOffsetTL.x,Et.pixelOffsetTL.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+1,rn,$t,Math.round(32*Et.tr.x),Math.round(32*(nn+Et.tr.y)),Et.texPrimary.x+Et.texPrimary.w,Et.texPrimary.y,At,_t,Et.pixelOffsetBR.x,Et.pixelOffsetTL.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+2,rn,$t,Math.round(32*Et.bl.x),Math.round(32*(nn+Et.bl.y)),Et.texPrimary.x,Et.texPrimary.y+Et.texPrimary.h,At,_t,Et.pixelOffsetTL.x,Et.pixelOffsetBR.y,Et.minFontScaleX,Et.minFontScaleY),this.text.updateSymbolVertexData(Wt+3,rn,$t,Math.round(32*Et.br.x),Math.round(32*(nn+Et.br.y)),Et.texPrimary.x+Et.texPrimary.w,Et.texPrimary.y+Et.texPrimary.h,At,_t,Et.pixelOffsetBR.x,Et.pixelOffsetBR.y,Et.minFontScaleX,Et.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(i.isUsingAppearanceTextVertexData){const _e=i.layoutBasedTextVertexData.length/12;for(let me=0;me<_e;++me){const Ee=me*12;this.text.updateSymbolVertexData(m+me,i.layoutBasedTextVertexData[Ee+0],i.layoutBasedTextVertexData[Ee+1],i.layoutBasedTextVertexData[Ee+2],i.layoutBasedTextVertexData[Ee+3],i.layoutBasedTextVertexData[Ee+4],i.layoutBasedTextVertexData[Ee+5],i.layoutBasedTextVertexData[Ee+6],i.layoutBasedTextVertexData[Ee+7],i.layoutBasedTextVertexData[Ee+8],i.layoutBasedTextVertexData[Ee+9],i.layoutBasedTextVertexData[Ee+10],i.layoutBasedTextVertexData[Ee+11])}return i.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:_e,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,i,l,d,m,_,v){this.text.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,m,l,d,_,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const l=kt(e),d=1/l;let m=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v),A=wt(1,0,0),D=wt(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:k,numIconVertices:F,numVerticalIconVertices:U}=S,Z=P>0||k>0,Q=F>0,X=this.elevationFeatures[S.elevationFeatureIndex];if(X){const te=new Dt(S.tileAnchorX,S.tileAnchorY),se=.075+X.pointElevation(te);S.zOffset!==se&&(i=!0,S.zOffset=se),se!==0&&(this.hasAnyZOffset=!0);const le=X.computeSlopeNormal(te,d),_e=Pr(en(),wt(0,0,1),le);_r(A,A,_e),_r(D,D,_e),A[2]*=l,D[2]*=l,A[0]===1&&A[1]===0&&A[2]===0&&D[0]===0&&D[1]===1&&D[2]===0||(m=m||Z,_=_||Q)}if(Z&&(rb(this.text.orientationVertexArray,P,A,D),rb(this.text.orientationVertexArray,k,A,D)),Q){const{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:se}=S;te>=0&&rb(this.icon.orientationVertexArray,F,A,D),se>=0&&rb(this.icon.orientationVertexArray,U,A,D)}}m||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,_,v)=>{l+=_,l>m.length&&m.resize(l);for(let S=-_;S<0;S++)m.emplace(S+l,v)},i=(m,_,v)=>{d+=_,d>m.length&&m.resize(d);for(let S=-_;S<0;S++)m.emplace(S+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,d=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:A}=_,D=_.zOffset,P=A>0;if((v>0||S>0)&&(e(this.text.zOffsetVertexArray,v,D),e(this.text.zOffsetVertexArray,S,D)),P){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:F}=_;k>=0&&i(this.icon.zOffsetVertexArray,A,D),F>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,D)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,l,d,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,l,d,m){if(!(e&&i&&l&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,v=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!v)return!1;const S=this.layers[0],A=S.layout;let D=1,P=0,k=!1;if(_){const[X,te]=A.get("icon-size-scale-range");D=xe(1,X,te)}let F=1,U=0,Z=!1;if(v){const[X,te]=A.get("text-size-scale-range");F=xe(1,X,te)}const Q=new Map;if(m&&l)for(const X of l){const te=m.getImage(X,S.scope);if(te){const se=new Ys(X.toString());Q.set(se.toString(),te)}}for(let X=0;X<this.symbolInstances.length;X++){const te=this.symbolInstances.get(X),se=this.featureToAppearanceIndex[te.featureIndex],le=se!==void 0?this.appearanceFeatureData[se]:void 0;if(!le)continue;const _e=le.id,me=i&&_e!==void 0?i[String(_e)]:void 0,Ee={type:"Point",id:le.id,properties:le.properties,geometry:[]},Se=S.appearances&&S.appearances.find(we=>we.isActive({globals:d,feature:Ee,canonical:e,featureState:me}));if(v){const we=A.get("text-size"),De=A.get("text-offset").evaluate(Ee,me,e),Ne=we.evaluate(Ee,me,e),pt=A.get("text-rotate").evaluate(Ee,me,e),ct=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,dt=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,Tt=we.evaluate(Ee,{zoom:ct},e),vt=we.evaluate(Ee,{zoom:dt},e),bt=this.updateSymbolInstanceTextVertices(te,le,Se,Ee,U,e,S,F,Q,me,De,Ne,pt,Tt,vt,ct,dt,l);U+=bt.vertexOffsetDelta,Z=Z||bt.hasChanges}if(_){const we=A.get("icon-offset").evaluate(Ee,me,e),De=A.get("icon-size").evaluate(Ee,me,e,l),Ne=A.get("icon-rotate").evaluate(Ee,me,e),pt=this.updateSymbolInstanceIconVertices(te,le,Se,Ee,P,e,l,d,S,D,me,we,De,Ne);P+=pt.vertexOffsetDelta,k=k||pt.hasChanges}le.activeAppearance=Se}return k&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),Z&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),k||Z}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=K2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:m}of i)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z,Q,X,te){const se=e.indexArray,le=e.layoutVertexArray,_e=e.globeExtVertexArray,me=e.segments.prepareSegment(4*te,le,se,this.canOverlap?_.sortKey:void 0),Ee=this.glyphOffsetArray.length,Se=me.vertexLength,we=this.allowVerticalPlacement&&v===ec.vertical?Math.PI/2:0,De=_.text&&_.text.sections;for(let ct=0;ct<i.length;ct++){const{tl:dt,tr:Tt,bl:vt,br:bt,texPrimary:ot,texSecondary:At,pixelOffsetTL:_t,pixelOffsetBR:Ct,minFontScaleX:Et,minFontScaleY:nn,glyphOffset:rn,isSDF:$t,sectionIndex:Wt}=i[ct],An=me.vertexLength,_n=rn[1];if(Zx(le,A.x,A.y,dt.x,_n+dt.y,ot.x,ot.y,l,$t,_t.x,_t.y,Et,nn),Zx(le,A.x,A.y,Tt.x,_n+Tt.y,ot.x+ot.w,ot.y,l,$t,Ct.x,_t.y,Et,nn),Zx(le,A.x,A.y,vt.x,_n+vt.y,ot.x,ot.y+ot.h,l,$t,_t.x,Ct.y,Et,nn),Zx(le,A.x,A.y,bt.x,_n+bt.y,ot.x+ot.w,ot.y+ot.h,l,$t,Ct.x,Ct.y,Et,nn),S){const{x:Jt,y:Bn,z:ri}=S.anchor,[Ri,Jn,Zi]=S.up;Xx(_e,Jt,Bn,ri,Ri,Jn,Zi),Xx(_e,Jt,Bn,ri,Ri,Jn,Zi),Xx(_e,Jt,Bn,ri,Ri,Jn,Zi),Xx(_e,Jt,Bn,ri,Ri,Jn,Zi),ly(e.dynamicLayoutVertexArray,Jt,Bn,ri,we)}else ly(e.dynamicLayoutVertexArray,A.x,A.y,A.z,we);if(Q){const Jt=At||ot;Wx(e.iconTransitioningVertexArray,Jt.x,Jt.y),Wx(e.iconTransitioningVertexArray,Jt.x+Jt.w,Jt.y),Wx(e.iconTransitioningVertexArray,Jt.x,Jt.y+Jt.h),Wx(e.iconTransitioningVertexArray,Jt.x+Jt.w,Jt.y+Jt.h)}se.emplaceBack(An,An+1,An+2),se.emplaceBack(An+1,An+2,An+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rn[0]),ct!==i.length-1&&Wt===i[ct+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,_,_.index,{},F,U,Z,De&&De[Wt],this.worldview)}const Ne=te-i.length;Ne!==0&&this._addNullVertices(Ne,le,l,S,_e,e,Q,me,se);const pt=S?S.anchor:A;e.placedSymbolArray.emplaceBack(pt.x,pt.y,pt.z,A.x,A.y,Ee,this.glyphOffsetArray.length-Ee,Se,D,P,A.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],v,0,0,0,k,0),e.symbolInstanceIndices.push(X)}_addNullVertices(e,i,l,d,m,_,v,S,A){for(let D=0;D<e;D++){for(let k=0;k<4;k++)Zx(i,0,0,0,0,0,0,l,!1,0,0,0,0),d&&Xx(m,0,0,0,0,0,0),ly(_.dynamicLayoutVertexArray,0,0,0,0),v&&Wx(_.iconTransitioningVertexArray,0,0);const P=S.vertexLength;A.emplaceBack(P,P+1,P+2),A.emplaceBack(P+1,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,l,d,m,_,v){e.emplaceBack(i,l,d,m,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,l,d,m,_,v){const S=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),A=S.vertexLength,D=v.tileAnchorX,P=v.tileAnchorY;for(let F=0;F<4;F++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Dt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Dt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Dt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,D,P,new Dt(e.x1,e.y2)),S.vertexLength+=4;const k=l.indexArray;k.emplaceBack(A,A+1),k.emplaceBack(A+1,A+2),k.emplaceBack(A+2,A+3),k.emplaceBack(A+3,A),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,d,m,_){for(let v=d;v<m;v++){const S=l.get(v),A=this.getSymbolInstanceTextSize(e,_,i,v);this._addCollisionDebugVertices(S,A,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,l,d,m,_){for(let v=d;v<m;v++){const S=l.get(v),A=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(S,A,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jw(Dd,d2.members,nl),this.iconCollisionBox=new jw(Dd,d2.members,nl);const d=ry(this.iconSizeData,e),m=ry(this.textSizeData,e,l);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(m,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,l,d){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:d),_=Dw(this.textSizeData,e,m)/ua;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,l){const d=this.icon.placedSymbolArray.get(l),m=Dw(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,l,d){e.emplaceBack(i,-l,-l,d),e.emplaceBack(i,l,-l,d),e.emplaceBack(i,l,l,d),e.emplaceBack(i,-l,l,d)}_updateTextDebugCollisionBoxes(e,i,l,d,m,_,v){for(let S=d;S<m;S++){const A=l.get(S),D=this.getSymbolInstanceTextSize(e,_,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,A.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,l,d,m,_,v){for(let S=d;S<m;S++){const A=l.get(S),D=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,A.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,l,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=ry(this.iconSizeData,e,d),_=ry(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,l),this._updateTextDebugCollisionBoxes(_,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,l),this._updateIconDebugCollisionBoxes(m,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,d),this._updateIconDebugCollisionBoxes(m,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,d,m,_,v,S,A){const D={};if(i<l){const{x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(i);D.textBox={x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.textFeatureIndex=_e}if(d<m){const{x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(d);D.verticalTextBox={x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.verticalTextFeatureIndex=_e}if(_<v){const{x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(_);D.iconBox={x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.iconFeatureIndex=_e}if(S<A){const{x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le,featureIndex:_e}=e.get(S);D.verticalIconBox={x1:P,y1:k,x2:F,y2:U,padding:Z,projectedAnchorX:Q,projectedAnchorY:X,projectedAnchorZ:te,tileAnchorX:se,tileAnchorY:le},D.verticalIconFeatureIndex=_e}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),d=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),d=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const S=this.symbolInstances.get(v);d.push(0|Math.round(i*S.tileAnchorX+l*S.tileAnchorY)),m.push(S.featureIndex)}return _.sort((v,S)=>d[v]-d[S]||m[S]-m[v]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:A}=l;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&i<this.elevationFeatures.length&&(l=this.elevationFeatures[i]),l}}function Q2(r,e){return e.replace(/{([^{}]+)}/g,(i,l)=>l in r?String(r[l]):"")}let J2,eI,Uw;Ft(sb,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),sb.addDynamicAttributes=ly;class tI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(tI,"FormatSectionOverride",{omit:["defaultValue"]});const Gw=()=>Uw||(Uw={layout:J2||(J2=new br({"symbol-placement":new Nt(We.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nt(We.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nt(We.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nt(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nt(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(We.layout_symbol["icon-size"]),"icon-size-scale-range":new Nt(We.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Xt(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(We.layout_symbol["icon-image"]),"icon-image-use-theme":new Nt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Xt(We.layout_symbol["icon-rotate"]),"icon-padding":new Nt(We.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(We.layout_symbol["icon-offset"]),"icon-anchor":new Xt(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(We.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(We.layout_symbol["text-field"]),"text-font":new Xt(We.layout_symbol["text-font"]),"text-size":new Xt(We.layout_symbol["text-size"]),"text-size-scale-range":new Nt(We.layout_symbol["text-size-scale-range"]),"text-max-width":new Xt(We.layout_symbol["text-max-width"]),"text-line-height":new Xt(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(We.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(We.layout_symbol["text-justify"]),"text-radial-offset":new Xt(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(We.layout_symbol["text-anchor"]),"text-max-angle":new Nt(We.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(We.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(We.layout_symbol["text-rotate"]),"text-padding":new Nt(We.layout_symbol["text-padding"]),"text-keep-upright":new Nt(We.layout_symbol["text-keep-upright"]),"text-transform":new Xt(We.layout_symbol["text-transform"]),"text-offset":new Xt(We.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nt(We.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(We.layout_symbol["text-optional"]),visibility:new Nt(We.layout_symbol.visibility)})),paint:eI||(eI=new br({"icon-opacity":new Xt(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(We.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(We.paint_symbol["icon-color"]),"icon-halo-color":new Xt(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(We.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(We.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(We.paint_symbol["text-color"],{runtimeType:ie,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Xt(We.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(We.paint_symbol["text-halo-blur"]),"text-translate":new Nt(We.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nt(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nt(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nt(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nt(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(We.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Uw);class ab extends La{constructor(e,i,l,d){super(e,Gw(),i,l,d,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Ke([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(d=>{d.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const m of l)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,l,d){return this._saturation===e&&this._contrast===i&&this._brightnessMin===l&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(m,_,v,S){m=ur(m),_=Ti(_);const A=Qe(),D=m/3,P=1-2*D,k=[P,D,D,0,D,P,D,0,D,D,P,0,0,0,0,1],F=.5-.5*_,U=S-v;return nt(A,[U,0,0,0,0,U,0,0,0,0,U,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,F,F,F,1]),nt(A,A,k),A})(e,i,l,d),this._saturation=e,this._contrast=i,this._brightnessMin=l,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,l,d){const m=this.layout.get(e).evaluate(i,{},l,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||bh(_.value)||!m?m:Q2(i.properties,m)}getAppearanceValueAndResolveTokens(e,i,l,d,m){const _=e.getProperty(i);if(!_)return;const v=_.evaluate(l,{},d,m),S=e.getUnevaluatedProperties()._values[i];return S.isDataDriven()||bh(S.value)||!v||typeof v!="string"?v:Q2(l.properties,v)}createBucket(e){return new sb(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Gw().paint.overridableProperties){if(!ab.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new tI(i),d=new Of(l,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Ma("source",d):new ba("composite",d,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new zu(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&ab.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),d=Gw().paint.properties[i];let m=!1;const _=v=>{for(const S of v)if(d.overrides&&d.overrides.hasOverride(S))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ms)_(l.value.value.sections);else if(l.value.kind==="source"){const v=A=>{m||(A instanceof Xo&&Cs(A.value)===Gt?_(A.value.sections):A instanceof mn?_(A.sections):A.eachChild(v))},S=l.value;S._styleExpression&&v(S._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,l){return{config:new O(this,{zoom:i,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let nI,iI,rI,sI;var qw=ti([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ob(r,e,i,l,d,m,_,v){const S=[r,e,1,i,l,1,d,m,1],A=[_,v,1],D=ae([],S),[P,k,F]=vi(A,A,D);return he(S,S,[P,0,0,0,k,0,0,0,F])}function aI(r,e,i,l,d,m,_,v){const S=(function(A,D,P,k,F,U,Z,Q){const X=ob(0,0,1,0,1,1,0,1),te=ob(A,D,P,k,F,U,Z,Q);return he(te,te,ae([],X))})(r,e,i,l,d,m,_,v);return[S[2]/S[8]/jt,S[5]/S[8]/jt]}function lb(r){return[r[0],Math.min(Math.max(r[1],-85.051129),Le)]}class oI extends pl{constructor(e,i,l,d){super(),this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Mo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Co(this.map._requestManager.transformRequest(this.url,hs.Image),(l,d)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Fc(l)):d&&(this.image=d instanceof HTMLImageElement?ja.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Lx(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Lx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],l=e[0][1];for(const m of e)m[1]>l&&(l=m[1]),m[1]<i&&(i=m[1]);const d=(l+i)/2;if(d>Le?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(qt.fromLngLat);this.tileID=(function(_){let v=1/0,S=1/0,A=-1/0,D=-1/0;for(const Z of _)v=Math.min(v,Z.x),S=Math.min(S,Z.y),A=Math.max(A,Z.x),D=Math.max(D,Z.y);const P=Math.max(A-v,D-S),k=Math.max(0,Math.floor(-Math.log2(P))),F=Math.pow(2,k);let U=Math.floor((v+A)/2*F);return U>1&&(U-=1),new Ac(k,U,Math.floor((S+D)/2*F))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Mo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Lx||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const X in this.tiles){const te=this.tiles[X];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Ux(new Ac(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(X){const te=X[1].x-X[0].x,se=X[1].y-X[0].y,le=X[2].x-X[1].x,_e=X[2].y-X[1].y,me=X[3].x-X[2].x,Ee=X[3].y-X[2].y,Se=X[0].x-X[3].x,we=X[0].y-X[3].y,De=te*_e-le*se,Ne=le*Ee-me*_e,pt=me*we-Se*Ee,ct=Se*se-te*we;return De>0&&Ne>0&&pt>0&&ct>0||De<0&&Ne<0&&pt<0&&ct<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Ux(this.tileID,this.map.transform.projection),[m,_,v,S]=this.coordinates.map(X=>{const te=d.projection.project(X[0],X[1]);return $2(d,te)._round()});this.perspectiveTransform=aI(m.x,m.y,_.x,_.y,v.x,v.y,S.x,S.y);const A=this._boundsArray=new Tc;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(_.x,_.y,jt,0),A.emplaceBack(S.x,S.y,0,jt),A.emplaceBack(v.x,v.y,jt,jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,qw.members),this.boundsSegments=fr.simpleSegment(0,0,4,2);const D=[],P=[lb((k=this.coordinates)[0]),lb(k[1]),lb(k[2]),lb(k[3])];var k;const[F,U,Z,Q]=(function(X){let te=X[0][0],se=te,le=X[0][1],_e=le;for(let me=1;me<X.length;me++)X[me][0]<te?te=X[me][0]:X[me][0]>se&&(se=X[me][0]),X[me][1]<le?le=X[me][1]:X[me][1]>_e&&(_e=X[me][1]);return[te,le,se-te,_e-le]})(P);{const X=new Tc,[te,se,le,_e]=(function(bt){let ot=bt[0].x,At=ot,_t=bt[0].y,Ct=_t;for(let Et=1;Et<bt.length;Et++)bt[Et].x<ot?ot=bt[Et].x:bt[Et].x>At&&(At=bt[Et].x),bt[Et].y<_t?_t=bt[Et].y:bt[Et].y>Ct&&(Ct=bt[Et].y);return[ot,_t,At-ot,Ct-_t]})(l),me=bt=>[(bt.x-te)/le,(bt.y-se)/_e],[Ee,Se,we,De]=l.map(me),Ne=(function(bt,ot,At,_t,Ct,Et,nn,rn){const $t=ob(0,0,1,0,1,1,0,1);return he($t,$t,ae([],ob(bt,ot,At,_t,Ct,Et,nn,rn)))})(Ee[0],Ee[1],Se[0],Se[1],we[0],we[1],De[0],De[1]);this.elevatedGlobePerspectiveTransform=aI(Ee[0],Ee[1],Se[0],Se[1],we[0],we[1],De[0],De[1]);const pt=(bt,ot)=>{D.push(bt.lng);const At=Math.round((bt.lng-F)/Z*jt),_t=Math.round((bt.lat-U)/Q*jt),Ct=me(ot),Et=vi([],[Ct[0],Ct[1],1],Ne),nn=Math.round(Et[0]/Et[2]*jt),rn=Math.round(Et[1]/Et[2]*jt);X.emplaceBack(At,_t,nn,rn)},ct=l[3].x-l[0].x,dt=l[3].y-l[0].y,Tt=l[2].x-l[1].x,vt=l[2].y-l[1].y;for(let bt=0;bt<65;bt++){const ot=bt/64,At=[l[0].x+ot*ct,l[0].y+ot*dt],_t=[l[1].x+ot*Tt,l[1].y+ot*vt],Ct=_t[0]-At[0],Et=_t[1]-At[1];for(let nn=0;nn<65;nn++){const rn=nn/64,$t={x:At[0]+Ct*rn,y:At[1]+Et*rn};pt(i.projection.unproject($t.x,$t.y),$t)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(X,qw.members)}{this.maxLongitudeTriangleSize=0;let X=[],te=new vs;const se=(le,_e,me)=>{te.emplaceBack(le,_e,me);const Ee=D[le],Se=D[_e],we=D[me],De=Math.min(Math.min(Ee,Se),we),Ne=Math.max(Math.max(Ee,Se),we)-De;Ne>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ne),X.push(De+Ne/2)};for(let le=0;le<64;le++)for(let _e=0;_e<64;_e++){const me=65*le+_e,Ee=me+1,Se=me+65,we=Se+1;se(me,Se,Ee),se(Ee,Se,we)}[X,te]=(function(le,_e){const me=Array.from({length:le.length},(we,De)=>De);me.sort((we,De)=>le[we]-le[De]);const Ee=[],Se=new vs;for(let we=0;we<me.length;we++){const De=me[we];Ee.push(le[De]);const Ne=3*De,pt=Ne+1;Se.emplaceBack(_e.uint16[Ne],_e.uint16[pt],_e.uint16[pt+1])}return[Ee,Se]})(X,te),this.elevatedGlobeTrianglesCenterLongitudes=X,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(te)}this.elevatedGlobeSegments=fr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/jt,0,Q/jt,0,0,U,F,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof Lx||(this.texture?this.texture.update(this.image):(this.texture=new pw(i,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let d=(m=e+180)+360*Math.round((l[0]-m)/360);var m;const _=new fr,v=(P,k)=>{_.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-d)<=S){const P=gi(l,0,l.length,d+S);return P===l.length||v(P,Oi(l,P+1,l.length,d+360-S)-P),_}d<l[0]&&(d+=360);const A=Oi(l,0,l.length,d-S);if(A===l.length)return v(0,l.length),_;v(0,A-0);const D=gi(l,A+1,l.length,d+S);return D!==l.length&&v(D,l.length-D),_}}const Hw=1024,c3=(Math.pow(Hw,2)-1)/268170240;class lI extends La{constructor(e,i,l,d){super(e,{layout:rI||(rI=new br({visibility:new Nt(We.layout_raster.visibility)})),paint:sI||(sI=new br({"raster-opacity":new Nt(We.paint_raster["raster-opacity"]),"raster-color":new Ih(We.paint_raster["raster-color"]),"raster-color-mix":new Nt(We.paint_raster["raster-color-mix"]),"raster-color-range":new Nt(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nt(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(We.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(We.paint_raster["raster-saturation"]),"raster-contrast":new Nt(We.paint_raster["raster-contrast"]),"raster-resampling":new Nt(We.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nt(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nt(We.paint_raster["raster-array-band"]),"raster-elevation":new Nt(We.paint_raster["raster-elevation"]),"raster-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof oI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(d)||l===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=cm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:d}],resolution:Hw}),this.colorRampTexture=null,this._curRampRange=[l,d])}is3D(e){return this.paint.get("raster-elevation")>0}}let cI,uI,hI,dI,fI;class pI extends La{constructor(e,i,l,d){super(e,{layout:cI||(cI=new br({visibility:new Nt(We["layout_raster-particle"].visibility)})),paint:uI||(uI=new br({"raster-particle-array-band":new Nt(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nt(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ih(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nt(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nt(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nt(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nt(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nt(We["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,d),this._updateColorRamp(),this.lastInvalidatedAt=ja.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=cm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ja.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class u3 extends La{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function $w(r,e,i){const l=[0,0,1],d=Tn([]);return Li(d,d,i?-oi(r)+Math.PI:oi(r)),si(d,d,-oi(e)),_r(l,l,d),qn(l,l)}const mI={None:0,Model:1,Symbol:2,FillExtrusion:4};class cb{constructor(e,i,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),i!=null&&i.__line__&&(this.line=i.__line__)}}function Zw(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class gI{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class _I{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Wl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,l=this.instancedDataArray.float32;let d=Math.floor(l[i+2]);const m=1.05*(l[i+2]-d);return d/=100,[l[i]%1*1.05,l[i+1]%1*1.05,m,d]}tileCoordinatesForInstance(e){const i=16*e,l=this.instancedDataArray.float32;let d=l[i+0];return d=d>jt?d-jt:d,new Dt(Math.trunc(d),Math.trunc(l[i+1]))}translationForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+4],l[i+5],l[i+6]]}rotationScaleForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+7],l[i+8],l[i+9],l[i+10],l[i+11],l[i+12],l[i+13],l[i+14],l[i+15]]}transformForInstance(e){const i=16*e,l=this.instancedDataArray.float32;return[l[i+7],l[i+8],l[i+9],l[i+4],l[i+10],l[i+11],l[i+12],l[i+5],l[i+13],l[i+14],l[i+15],l[i+6],0,0,0,1]}}class Ww{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,l,d){}populate(e,i,l,d){this.tileToMeter=kt(l);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const _=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?i.elevationFeatures:void 0;for(const{feature:v,id:S,index:A,sourceLayerIndex:D}of e){const P=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),k=jn(v,m);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,l))continue;const F={id:P,sourceLayerIndex:D,index:A,geometry:m?k.geometry:Dn(v,l,d),properties:v.properties,type:v.type,patterns:{}},U=this.addFeature(F,F.geometry,k,_,l);U&&i.featureIndex.insert(v,F.geometry,A,D,this.index,this.instancesPerModel[U].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let l=0;for(const d of this.modelUris){const m=e.getModel(d,i);if(!m)continue;const _=this.instancesPerModel[d];if(_){const v=.5*Qn(m.aabb.max,m.aabb.min)*_.maxScale+_.maxXYTranslationDistance,S=Math.min(jt,Math.max(v/this.tileToMeter,256));l=Math.max(S,l)}}return l}update(e,i,l,d){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const v in e)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],e[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const d of l.features){const m=this.layers[0],_=d.feature,v=this.canonical,S=m.paint.get("model-rotation").evaluate(_,{},v),A=m.paint.get("model-scale").evaluate(_,{},v),D=m.paint.get("model-translation").evaluate(_,{},v);Wr(d.rotation,S)&&Wr(d.scale,A)&&Wr(d.translation,D)||(this.evaluate(d,d.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,i,l,d){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const m=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(h(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],A=S.instancedDataArray;for(const D of S.features){const P=D.instancedDataOffset,k=D.instancedDataCount;for(let F=0;F<k;F++){const U=16*(F+P);let Z=A.float32[U+0];const Q=Z>jt;Z=Q?Z-jt:Z;const X=Math.floor(Z),te=Math.floor(A.float32[U+1]);let se=!1;for(const le of this.activeReplacements)if(!Gg(le,l,mI.Model,d)&&!(le.min.x>X||X>le.max.x||le.min.y>te||te>le.max.y)&&(se=ce(q(X,te,e.canonical,le.footprintTileId.canonical),le.footprint),se))break;A.float32[U]=se?Z+jt:Z,_=_||se!==Q}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,PO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)i.removeModel(l,"",!0)}addFeature(e,i,l,d,m){const _=this.layers[0],v=_.layout.get("model-id"),S=_.layout.get("model-allow-density-reduction"),A=v.evaluate(l,{},this.canonical);if(!A)return kn(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),A;(Zw(A,!1)||this.styleDefinedModelURLs[A]!==void 0)&&(this.modelUris.includes(A)||this.modelUris.push(A)),this.instancesPerModel[A]||(this.instancesPerModel[A]=new _I);const D=this.instancesPerModel[A],P=D.instancedDataArray,k=new gI(l,P.length);let F;d&&(F=la.getElevationFeature(e,d));for(const U of i)for(const Z of U){if(Z.x<0||Z.x>=jt||Z.y<0||Z.y>=jt)continue;if(this.lookupDim!==0&&S){const X=(this.lookupDim-1)/jt,te=this.lookupDim*(Z.y*X|0)+Z.x*X|0;if(this.lookup){if(this.lookup[te]!==0)continue;this.lookup[te]=1}}this.instanceCount++;const Q=P.length;if(P.resize(Q+1),d){D.instancesRoadElevation||(D.instancesRoadElevation=[]);const X=F?F.pointElevation(new Dt(Z.x,Z.y)):0;D.instancesRoadElevation.push(X)}D.instancesEvaluatedElevation.push(0),P.float32[16*Q]=Z.x,P.float32[16*Q+1]=Z.y}return k.instancedDataCount=D.instancedDataArray.length-k.instancedDataOffset,k.instancedDataCount>0&&(e.id&&(D.idToFeaturesIndex[e.id]=D.features.length),D.features.push(k),this.evaluate(k,{},D,!1)),A}getModelUris(){return this.modelUris}evaluate(e,i,l,d){const m=this.layers[0],_=e.feature,v=this.canonical,S=e.rotation=m.paint.get("model-rotation").evaluate(_,i,v),A=e.scale=m.paint.get("model-scale").evaluate(_,i,v),D=e.translation=m.paint.get("model-translation").evaluate(_,i,v),P=Object.assign({},m.paint.get("model-color").evaluate(_,i,v));P.a=m.paint.get("model-color-mix-intensity").evaluate(_,i,v);const k=[];this.maxVerticalOffset<D[2]&&(this.maxVerticalOffset=D[2]);const F=D[0]*D[0]+D[1]*D[1],U=F>0?Math.sqrt(F):0;l.maxScale=Math.max(Math.max(l.maxScale,A[0]),Math.max(A[1],A[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,U),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),HA(k,S,A);const Z=Math.round(100*P.a)+P.b/1.05;for(let Q=0;Q<e.instancedDataCount;++Q){const X=e.instancedDataOffset+Q,te=16*X,se=l.instancedDataArray.float32;let le=0;d&&(le=se[te+6]-l.instancesEvaluatedElevation[X]);const _e=0|se[te+1];se[te]=(0|se[te])+P.r/1.05,se[te+1]=_e+P.g/1.05,se[te+2]=Z,se[te+3]=1/(v.z>10?this.tileToMeter:kt(v,_e)),se[te+4]=D[0],se[te+5]=D[1],se[te+6]=D[2]+(l.instancesRoadElevation?l.instancesRoadElevation[X]:0)+le,se[te+7]=k[0],se[te+8]=k[1],se[te+9]=k[2],se[te+10]=k[4],se[te+11]=k[5],se[te+12]=k[6],se[te+13]=k[8],se[te+14]=k[9],se[te+15]=k[10],l.instancesEvaluatedElevation[X]=D[2]}}}let yI,xI;Ft(Ww,"ModelBucket",{omit:["layers"]}),Ft(_I,"PerModelAttributes"),Ft(gI,"ModelFeature");class cy{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const d=l||e.findDEMTileFor(i);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,v=1<<i.canonical.z-_.canonical.z;return new cy(d,m.dim/jt/v,[(i.canonical.x/v-_.canonical.x)*m.dim,(i.canonical.y/v-_.canonical.y)*m.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1];return new Dt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,i,l,d){const m=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],v=Math.floor(m),S=Math.floor(_),A=this._dem;return d=!!d,l?Rn(Rn(A.get(v,S,d),A.get(v,S+1,d),_-S),Rn(A.get(v+1,S,d),A.get(v+1,S+1,d),_-S),m-v):A.get(v,S,d)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ze(1,e)*this._dem.stride}}const Xw=new Float32Array(262144),Kg=new Uint8Array(262144);function vI(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,vI(i));return e}function bI(r,e,i){if(r.meshes)for(const l of r.meshes){if(l.aabb.min[0]===1/0)continue;const d=Ai.applyTransform(l.aabb,r.globalMatrix);i.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(r.children)for(const l of r.children)bI(l,e,i)}const wI=["","wall","door","roof","window","lamp","logo"];class TI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:vI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Ai.applyTransformFast(l.aabb,this.node.globalMatrix),i.encapsulate(l.transformedAabb)),e++;this.aabb=i}return this.aabb}}class ub{constructor(e,i,l,d,m,_,v,S){this.id=l,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=ty.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=ty.HasMapboxMeshFeatures),m&&(this.modelTraits|=ty.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new TI(A)),bI(A,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const l of this.getNodesInfo()){const d=l.node;d.footprint&&i.push({footprint:d.footprint,id:e})}}updateAppearances(e,i,l,d){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const l=i?this.stateDependentLayers:this.layers;if(!no(e,this.states))for(const d of l)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const d=l.node;this.uploaded?this.updatePbrBuffer(d):_w(d,e,!0)}for(const l of i)H0(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(e,i,l){const d=e.transform.projectionOptions,m=e.style.getBrightness(),_=this.brightness!==m;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Yx(l.paint.get("model-color").value,_)||Yx(l.paint.get("model-color-mix-intensity").value,_)||Yx(l.paint.get("model-roughness").value,_)||Yx(l.paint.get("model-emissive-strength").value,_)||Yx(l.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=m;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),d=this.id.canonical;for(const m of l){const _=m.feature;m.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},d),m.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},d)}}evaluate(e,i){const l=this.getNodesInfo();for(const d of l){if(!d.node.meshes)continue;const m=d.feature,_=i&&i[m.id];if(no(_,d.state))continue;d.state=structuredClone(_);const v=d.node.meshes&&d.node.meshes[0].featureData,S=d.evaluatedColor[2],A=d.evaluatedRMEA[2],D=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let P=0;P<wI.length;P++){const k=wI[P];k.length&&(m.properties.part=k);const F=e.paint.get("model-color").evaluate(m,_,D).toPremultipliedRenderColor(null),U=e.paint.get("model-color-mix-intensity").evaluate(m,_,D);d.evaluatedColor[P]=[F.r,F.g,F.b,U],d.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(m,_,D),d.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(m,_,D),d.evaluatedRMEA[P][3]=F.a,d.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,_,D),!d.hasTranslucentParts&&F.a<1&&(d.hasTranslucentParts=!0)}delete m.properties.part,d3(d,S!==d.evaluatedColor[2]||A!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,_,D);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,_,D),d.evaluatedScale=e.paint.get("model-scale").evaluate(m,_,D),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,l,d){const m=e.findDEMTileFor(l);if(m&&(m.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=cy.create(e,l,m);if(!_)return;this.modelTraits&ty.HasMapboxMeshFeatures&&this.updateDEM(e,_,l,d);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const A=S.footprint.vertices;let D=_.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)D=Math.min(D,_.getElevationAt(A[P].x,A[P].y,!0,!0));S.elevation=D}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,l,d){let m=i._dem._modifiedForSources[d];if(m===void 0&&(i._dem._modifiedForSources[d]=[],m=i._dem._modifiedForSources[d]),m.includes(l.canonical))return;const _=i._dem.dim;m.push(l.canonical);let v=!1;for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.grid)continue;const D=A.footprint.grid,P=i.tileCoordToPixel(D.min.x,D.min.y),k=i.tileCoordToPixel(D.max.x,D.max.y),F=Math.min(Math.min(_-k.y,P.x),Math.min(P.y,_-k.x));if(F<0)continue;const U=xe(F,2,5);let Z=Math.max(0,P.x-U),Q=Math.max(0,P.y-U),X=Math.min(k.x+U,_-1),te=Math.min(k.y+U,_-1);for(let me=Q;me<=te;++me)for(let Ee=Z;Ee<=X;++Ee)Kg[me*_+Ee]=255;let se=0,le=0;for(let me=0;me<D.cellsY;++me)for(let Ee=0;Ee<D.cellsX;++Ee){if(!D.cells[me*D.cellsX+Ee])continue;const Se=i.tileCoordToPixel(D.min.x+Ee/D.xScale,D.min.y+me/D.yScale),we=i.tileCoordToPixel(D.min.x+(Ee+1)/D.xScale,D.min.y+(me+1)/D.yScale);for(let De=Se.y;De<=Math.min(we.y+1,_-1);++De)for(let Ne=Se.x;Ne<=Math.min(we.x+1,_-1);++Ne)Kg[De*_+Ne]===255&&(Kg[De*_+Ne]=0,se+=i.getElevationAtPixel(Ne,De),le++)}const _e=se/le;Z=Math.max(1,P.x-U),Q=Math.max(1,P.y-U),X=Math.min(k.x+U,_-2),te=Math.min(k.y+U,_-2),v=!0;for(let me=Q;me<=te;++me)for(let Ee=Z;Ee<=X;++Ee)Kg[me*_+Ee]===0&&(Xw[me*_+Ee]=i._dem.set(Ee,me,_e));for(let me=1;me<U;++me){Z=Math.max(1,P.x-me),Q=Math.max(1,P.y-me),X=Math.min(k.x+me,_-2),te=Math.min(k.y+me,_-2);for(let Ee=Q;Ee<=te;++Ee)for(let Se=Z;Se<=X;++Se){const we=Ee*_+Se;if(Kg[we]===255){let De=0,Ne=0,pt=-1,ct=-1;for(let dt=-1;dt<=1;++dt)for(let Tt=-1;Tt<=1;++Tt){const vt=(Ee+dt)*_+Se+Tt;if(Kg[vt]>=me)continue;const bt=Xw[vt],ot=Math.abs(bt);ot>Ne&&(De=bt,Ne=ot,pt=Tt,ct=dt)}if(Ne>.1){const dt=1-(me+.5*Math.abs(pt*ct))/U;let Tt=i._dem.get(Se,Ee)+De*dt;const vt=i._dem.get(Se+pt,Ee+ct),bt=i._dem.get(Se-pt,Ee-ct,!0);(Tt-vt)*(Tt-bt)>0&&(Tt=(vt+bt)/2),Xw[we]=i._dem.set(Se,Ee,Tt),Kg[we]=me}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ja.now())}setFilter(e){this.filter=e?Kp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Mi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)H0(i.node),yw(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());for(const d of this.getNodesInfo()){const m=d.node.footprint;d.hiddenByReplacement=!!m&&!l.find(_=>_.footprint===m)}}getHeightAtTileCoord(e,i){const l=[],d=[0,0,0],m=Ke([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],S=v.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};at(m,_.node.globalMatrix),d[0]=e,d[1]=i,Cn(d,d,m);const A=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Zg|0,D=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Zg|0)*Zg+Math.min(63,A),P=v.heightmap[D];if(!(P<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:P,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Dt(e,i),new Dt(e,i),l),l.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Yx(r,e){return r instanceof Ma&&!r.isLightConstant&&e}function h3(r,e,i,l,d,m,_,v){let S=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,D=240&e|(240&e)>>4;i[3]>0&&(S=Rn(S,255*i[0],i[3]),A=Rn(A,255*i[1],i[3]),D=Rn(D,255*i[2],i[3]));const P=S<<8|A,k=D<<8|Math.floor(255*l[3]),F=(function(me){const Ee=xe(me,0,2);return Math.min(Math.round(.5*Ee*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],U=xe(d[0],0,1),Z=xe(d[1],0,1),Q=xe(d[2],0,1),X=xe(d[3],0,1);let te,se,le,_e;if(U!==Z&&_!==m&&Z!==U){const me=_-m;se=1/(me*(Z-U)),le=-(m+me*U)/(me*(Z-U));const Ee=xe(d[4],-1,1);_e=Math.pow(10,Ee),te=255*Q<<8|255*X}else te=65535,se=0,le=1,_e=1;if(r.emplaceBack(P,k,F,te,se,le,_e),v){const me=v.length;v.clear();for(let Ee=0;Ee<me;Ee++)v.emplaceBack(P,k,F,te,se,le,_e)}}function d3(r,e,i){const l=r.node;let d=0;const m=i&ty.HasMeshoptCompression;for(const _ of l.meshes){if(l.lights&&l.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new Lh,_.featureArray.reserve(_.featureData.length);let v=e;for(const S of _.featureData){const A=m?65535&S:S>>16&65535,D=m?S>>16&65535:65535&S,P=(15&D)<8?15&D:0,k=r.evaluatedRMEA[P],F=r.evaluatedColor[P],U=r.emissionHeightBasedParams[P];let Z;if(v&&P===2&&l.lights&&(Z=new Lh,Z.resize(10*l.lights.length)),h3(_.featureArray,A,F,k,U,_.aabb.min[2],_.aabb.max[2],Z),Z&&v){v=!1;const Q=l.meshes[l.lightMeshIndex];Q.featureArray=Z,Q.featureArray._trim()}}_.featureArray._trim(),d++}}Ft(ub,"Tiled3dModelBucket",{omit:["layers"]}),Ft(TI,"Tiled3dModelFeature");const f3=["id","tile","layer","source","sourceLayer","state"];class Qg{constructor(e,i,l,d,m){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=d,this.properties=e?e.properties:{},this.id=m}clone(){const e=new Qg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of f3)this[i]!==void 0&&(e[i]=this[i]);return e}}class Jg extends pl{constructor(e,i,l,d){super(),this.id=e,this.type="model",this.models=[],this._options=i,this._modelsInfo=new Map}loadGLTFFromURI(e){return jA(this.map._requestManager.transformRequest(e,hs.Model).url)}load(){for(const e in this._options.models){const i=this._options.models[e],l=this._modelsInfo.get(e);if(l){l.modelSpec=i;const d=l.model;d&&(d.position=i.position!=null?new ge(i.position[0],i.position[1]):new ge(0,0),d.orientation=i.orientation!=null?i.orientation:[0,0,0],Jg.applyModelSpecification(d,i),d.computeBoundsAndApplyParent(),this.models.push(d))}else this._modelsInfo.set(e,{modelSpec:i,model:null}),this.loadGLTFFromURI(i.uri).then(d=>{if(!d)return;const m=this._modelsInfo.get(e);if(!m)return;const _=vw(d),v=m.modelSpec,S=new $A(e,v.uri,v.position,v.orientation,_);Jg.applyModelSpecification(S,v),S.computeBoundsAndApplyParent(),this.models.push(S),m.model=S,this.loaded()&&this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(d=>{this.fire(new Fc(new Error(`Could not load model ${e} from ${i.uri}: ${d.message}`)))})}this.loaded()&&this.fire(new Mo("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,i){i.nodeOverrides&&Jg.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Jg.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(l=>typeof l=="string")){e.nodeOverrideNames=[];for(const l of i)e.nodeOverrideNames.push(l)}else Object.entries(i).forEach(([l,d])=>{const m={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const _=d.orientation;_&&(m.orientation=_)}e.nodeOverrides.set(l,m)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(l=>typeof l=="string")){e.materialOverrideNames=[];for(const l of i)e.materialOverrideNames.push(l)}else Object.entries(i).forEach(([l,d])=>{const m={color:new Ei(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=d["model-color"];_!==void 0&&(m.color.r=_[0],m.color.g=_[1],m.color.b=_[2]);const v=d["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);const S=d["model-emissive-strength"];S!==void 0&&(m.emissionStrength=S);const A=d["model-opacity"];A!==void 0&&(m.opacity=A),e.materialOverrides.set(l,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=ql(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const i=new Map;for(const l in e){const d=e[l];if(this._modelsInfo.has(l)){const m=this._modelsInfo.get(l);m&&m.modelSpec.uri===d.uri&&i.set(l,m)}}this._modelsInfo=i,this._options.models=e,this.load()}}function Yw(r,e,i,l){const d=1<<r.z;e.lat=xt((l/jt+r.y)/d),e.lng=ut((i/jt+r.x)/d)}function p3(r,e,i,l){const d=r.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let m=Number.MAX_VALUE;const _=d.node,v=i.tile,S=l.calculatePosMatrix(v.tileID.toUnwrapped(),l.worldSize),A=d.evaluatedScale;let D=0;l.elevation&&_.elevation&&(D=_.elevation*l.elevation.exaggeration()),Ge(S,S,[(_.anchor?_.anchor[0]:0)*(A[0]-1),(_.anchor?_.anchor[1]:0)*(A[1]-1),D]),Mt(S,S,A);const P=i.queryGeometry,k=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(Z){const Q=nt([],S,Z.globalMatrix);nt(Q,l.expandedFarZProjMatrix,Q);for(let X=0;X<Z.meshes.length;++X){const te=Z.meshes[X];if(X===Z.lightMeshIndex)continue;const se=gw(k,l,Q,te.aabb);se!=null&&(m=Math.min(se,m))}if(Z.children)for(const X of Z.children)F(X)};if(F(_),m===Number.MAX_VALUE)return;const U=new ge(0,0);return Yw(v.tileID.canonical,U,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:m,position:U,feature:d.feature}}const m3={circle:class extends La{constructor(r,e,i,l){super(r,{layout:a0||(a0=new br({"circle-sort-key":new Xt(We.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nt(We.layout_circle["circle-elevation-reference"]),visibility:new Nt(We.layout_circle.visibility)})),paint:o0||(o0=new br({"circle-radius":new Xt(We.paint_circle["circle-radius"]),"circle-color":new Xt(We.paint_circle["circle-color"]),"circle-blur":new Xt(We.paint_circle["circle-blur"]),"circle-opacity":new Xt(We.paint_circle["circle-opacity"]),"circle-translate":new Nt(We.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nt(We.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}createBucket(r){return new Wa(r)}queryRadius(r){const e=r;return ou("circle-radius",this,e)+ou("circle-stroke-width",this,e)+om(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,l,d,m,_,v){const S=s0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return lx(r,l,m,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const l=d0(this);return{config:new O(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends La{createBucket(r){return new p0(r)}constructor(r,e,i,l){super(r,{layout:ux||(ux=new br({visibility:new Nt(We.layout_heatmap.visibility)})),paint:m0||(m0=new br({"heatmap-radius":new Xt(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ih(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(We.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return ou("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,l,d,m,_,v){const S=this.paint.get("heatmap-radius").evaluate(e,i);return lx(r,l,m,_,v,!0,!0,new Dt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new O(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends La{constructor(r,e,i,l){super(r,{layout:F_||(F_=new br({visibility:new Nt(We.layout_hillshade.visibility)})),paint:V_||(V_=new br({"hillshade-illumination-direction":new Nt(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nt(We.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends La{constructor(r,e,i,l){super(r,{layout:pm||(pm=new br({"fill-sort-key":new Xt(We.layout_fill["fill-sort-key"]),visibility:new Nt(We.layout_fill.visibility),"fill-elevation-reference":new Nt(We.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Xt(We.layout_fill["fill-construct-bridge-guard-rail"])})),paint:mm||(mm=new br({"fill-antialias":new Nt(We.paint_fill["fill-antialias"]),"fill-opacity":new Xt(We.paint_fill["fill-opacity"]),"fill-color":new Xt(We.paint_fill["fill-color"]),"fill-outline-color":new Xt(We.paint_fill["fill-outline-color"]),"fill-translate":new Nt(We.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(We.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nt(We.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nt(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(We.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Xt(We.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Xt(We.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new O(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new $u(r)}queryRadius(){return om(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,l,d,m){return!r.queryGeometry.isAboveHorizon&&rr(rx(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends La{constructor(r,e,i,l){super(r,{layout:mA||(mA=new br({visibility:new Nt(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nt(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gA||(gA=new br({"fill-extrusion-opacity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nt(We["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Xt(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nt(We["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nt(We["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nt(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nt(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nt(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nt(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nt(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new cu(r)}queryRadius(){return om(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,l,d,m,_,v,S){const A=s0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],F=v&&m.elevation,U=m.elevation?m.elevation.exaggeration():1,Z=r.tile.getBucket(this);if(F&&Z instanceof cu){const le=Z.centroidVertexArray,_e=S+1;_e<le.length&&(k[0]=le.geta_centroid_pos0(_e),k[1]=le.geta_centroid_pos1(_e))}if(k[0]===0&&k[1]===1)return!1;m.projection.name==="globe"&&(l=pA([l],[new Dt(0,0),new Dt(jt,jt)],r.tileID.canonical).map(le=>le.polygon).flat());const Q=F?v:null,[X,te]=TA(m,l,P,D,A,_,Q,k,U,m.center.lat,r.tileID.canonical),se=r.queryGeometry;return wA(X,te,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends La{constructor(r,e,i,l){super(r,{layout:JA||(JA=new br({visibility:new Nt(We.layout_building.visibility),"building-facade":new Xt(We.layout_building["building-facade"]),"building-facade-floors":new Xt(We.layout_building["building-facade-floors"]),"building-facade-unit-width":new Xt(We.layout_building["building-facade-unit-width"]),"building-facade-window":new Xt(We.layout_building["building-facade-window"]),"building-roof-shape":new Xt(We.layout_building["building-roof-shape"]),"building-height":new Xt(We.layout_building["building-height"]),"building-base":new Xt(We.layout_building["building-base"]),"building-flood-light-wall-radius":new Xt(We.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Xt(We.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Xt(We.layout_building["building-flip-roof-orientation"])})),paint:e2||(e2=new br({"building-opacity":new Nt(We.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Nt(We.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Nt(We.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Nt(We.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Nt(We.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Nt(We.paint_building["building-vertical-scale"]),"building-cast-shadows":new Nt(We.paint_building["building-cast-shadows"]),"building-color":new Xt(We.paint_building["building-color"]),"building-emissive-strength":new Xt(We.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Nt(We.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Nt(We.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Nt(We.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Nt(We.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Nt(We.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new QA(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,l,d,m,_,v,S,A){let D=this.layout.get("building-height").evaluate(e,i);const P=this.layout.get("building-base").evaluate(e,i),k=r.tile.getBucket(this).getFootprint(e);if(k){if(k.hiddenFlags!==0)return!1;D=k.height}const[F,U]=TA(m,l,P,D,new Dt(0,0),_,null,[0,0],1,m.center.lat,r.tileID.canonical),Z=r.queryGeometry;return wA(F,U,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends La{constructor(r,e,i,l){const d=u2();super(r,d,e,i,l),d.layout&&(this.layout=new ka(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(zx)return zx;const i=u2();return zx=new cz(i.paint.properties["line-width"].specification),zx.useIntegerZoom=!0,zx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Tw(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const l=l2(this);return{config:new O(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}queryRadius(r){const e=r,i=h2(ou("line-width",this,e),ou("line-gap-width",this,e)),l=ou("line-offset",this,e);return i/2+Math.abs(l)+om(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,l,d,m){if(r.queryGeometry.isAboveHorizon)return!1;const _=rx(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*h2(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(l=(function(A,D){const P=[],k=new Dt(0,0);for(let F=0;F<A.length;F++){const U=A[F],Z=[];for(let Q=0;Q<U.length;Q++){const X=U[Q],te=U[Q+1],se=Q===0?k:X.sub(U[Q-1])._unit()._perp(),le=Q===U.length-1?k:te.sub(X)._unit()._perp(),_e=se._add(le)._unit();_e._mult(1/(_e.x*le.x+_e.y*le.y)),Z.push(_e._mult(D)._add(X))}P.push(Z)}return P})(l,S*r.pixelToTileUnitsFactor)),(function(A,D,P){for(let k=0;k<D.length;k++){const F=D[k];if(A.length>=3){for(let U=0;U<F.length;U++)if(mo(A,F[U]))return!0}if(ss(A,F,P))return!0}return!1})(_,l,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ab,background:class extends La{constructor(r,e,i,l){super(r,{layout:nI||(nI=new br({visibility:new Nt(We.layout_background.visibility)})),paint:iI||(iI=new br({"background-pitch-alignment":new Nt(We.paint_background["background-pitch-alignment"]),"background-color":new Nt(We.paint_background["background-color"]),"background-pattern":new Nt(We.paint_background["background-pattern"]),"background-opacity":new Nt(We.paint_background["background-opacity"]),"background-emissive-strength":new Nt(We.paint_background["background-emissive-strength"]),"background-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:lI,"raster-particle":pI,sky:class extends La{constructor(r,e,i,l){super(r,{layout:hI||(hI=new br({visibility:new Nt(We.layout_sky.visibility)})),paint:dI||(dI=new br({"sky-type":new Nt(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nt(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nt(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nt(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nt(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ih(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nt(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nt(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nt(We.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),d=!l,m=r.style.light,_=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?$w(_.azimuthal,90-_.polar,e):$w(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return $w(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends La{constructor(r,e,i,l){super(r,{paint:fI||(fI=new br({}))},e,null)}},model:class extends La{constructor(r,e,i,l){super(r,{layout:yI||(yI=new br({visibility:new Nt(We.layout_model.visibility),"model-id":new Xt(We.layout_model["model-id"]),"model-allow-density-reduction":new Nt(We.layout_model["model-allow-density-reduction"])})),paint:xI||(xI=new br({"model-opacity":new Xt(We.paint_model["model-opacity"]),"model-rotation":new Xt(We.paint_model["model-rotation"]),"model-scale":new Xt(We.paint_model["model-scale"]),"model-translation":new Xt(We.paint_model["model-translation"]),"model-color":new Xt(We.paint_model["model-color"]),"model-color-mix-intensity":new Xt(We.paint_model["model-color-mix-intensity"]),"model-type":new Nt(We.paint_model["model-type"]),"model-cast-shadows":new Nt(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nt(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nt(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(We.paint_model["model-emissive-strength"]),"model-roughness":new Xt(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nt(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nt(We.paint_model["model-front-cutoff"]),"model-elevation-reference":new Nt(We.paint_model["model-elevation-reference"]),"model-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Ww(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof ub?8191:0}queryRenderedFeatures(r,e,i){const l=e.getSource();if(!(l&&l instanceof Jg))return{};const d=l,m={};m[this.id]=[];const _=m[this.id];let v=0;for(const S of d.models){const A=e.getFeatureState(this.sourceLayer,S.id),D={type:"Unknown",id:S.id,properties:S.featureProperties},P=this.paint.get("model-rotation").evaluate(D,A),k=this.paint.get("model-scale").evaluate(D,A),F=this.paint.get("model-translation").evaluate(D,A),U=this.paint.get("model-elevation-reference");let Z=[];q0(Z,S,i,S.position,P,k,F,U==="ground",U==="ground",!1),i.projection.name==="globe"&&(Z=G0(Z,i));const Q=nt([],i.projMatrix,Z),X=gw(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,Q,S.aabb);if(X!=null){const te=new Qg(void 0,0,0,0,S.id);te.layer=this.layer,te.properties=structuredClone(S.featureProperties),te.properties.layer=this.id,te.properties.uri=S.uri,te.properties.orientation=S.orientation,te.sourceLayer=this.sourceLayer,te.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},te.state=A,te.source=this.source,_.push({featureIndex:v,feature:te,intersectionZ:X})}++v}return m}queryIntersectsFeature(r,e,i,l,d,m,_,v,S,A){if(!this.modelManager)return!1;const D=this.modelManager,P=r.tile.getBucket(this);if(!(P&&P instanceof Ww))return!1;for(const k in P.instancesPerModel){const F=P.instancesPerModel[k],U=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(F.idToFeaturesIndex.hasOwnProperty(U)){const Z=F.features[F.idToFeaturesIndex[U]],Q=D.getModel(k,A||this.scope);if(!Q)return!1;let X=[];const te=new ge(0,0),se=P.canonical;let le=Number.MAX_VALUE;for(let _e=0;_e<Z.instancedDataCount;++_e){const me=16*(Z.instancedDataOffset+_e),Ee=F.instancedDataArray.float32,Se=[Ee[me+4],Ee[me+5],Ee[me+6]];Yw(se,te,Math.floor(Ee[me]),Math.floor(Ee[me+1])),q0(X,Q,m,te,Z.rotation,Z.scale,Se,!1,!1,!1),m.projection.name==="globe"&&(X=G0(X,m));const we=nt([],m.projMatrix,X),De=r.queryGeometry,Ne=gw(De.isPointQuery()?De.screenBounds:De.screenGeometry,m,we,Q.aabb);Ne!=null&&(le=Math.min(Ne,le))}return le!==Number.MAX_VALUE&&le}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ba}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends La{constructor(r,e,i,l){super(r,{layout:Uh||(Uh=new br({"clip-layer-types":new Nt(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nt(We.layout_clip["clip-layer-scope"]),visibility:new Nt(We.layout_clip.visibility)})),paint:R0||(R0=new br({}))},e,i,l)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new M0(r)}is3D(r){return!0}}},Kw=new Ei(0,0,0);function g3(r,e,i){r===1&&e.icons.push((function(l,d){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:_}=m;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&EI(_,"x"),_.stretch_y&&_.stretch_y.length&&EI(_,"y"),m})(l.readFields(_3,{name:void 0},d))})(i,i.readVarint()+i.pos))}function EI(r,e){const i=[],l=r[`stretch_${e}`];let d=null;for(let m=0;m<l.length;m++)d===null?d=i.length===0?l[0]:i[i.length-1][1]+l[m]:(i.push([d,d+l[m]]),d=null);r[`stretch_${e}_areas`]=i}function _3(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(l,d){return l.readFields(y3,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(l,d){return l.readFields(b3,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function y3(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=SI(i,i.readVarint()+i.pos):r===4?e.variables.push((function(l,d){return l.readFields(v3,{name:void 0},d)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=SI(i,i.readVarint()+i.pos))}function SI(r,e){return r.readFields(x3,{},e)}function x3(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function v3(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=fb(i.readVarint()),e.value="rgb_color")}function b3(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(hb(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(l,d){return l.readFields(C3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(l,d){return l.readFields(M3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(l,d){return l.readFields(D3,{children:[]},d)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(l,d){const m=l.readFields(P3,{left:0,width:20,mask_type:1,children:[]},d);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(i,i.readVarint()+i.pos))}function hb(r,e){return r.readFields(w3,{},e)}function w3(r,e,i){r===1?(e.group=(function(l,d){return l.readFields(T3,{opacity:255,children:[]},d)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(l,d){return l.readFields(S3,{paint_order:1,commands:[],step:1,diffs:[],rule:1},d)})(i,i.readVarint()+i.pos),e.node="path")}function T3(r,e,i){r===1?e.transform=db(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(hb(i,i.readVarint()+i.pos))}function db(r,e){return r.readFields(E3,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function E3(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function S3(r,e,i){r===1?e.fill=(function(l,d){return l.readFields(A3,{rgb_color:Kw,paint:"rgb_color",opacity:255},d)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(l,d){return l.readFields(I3,{rgb_color:Kw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function A3(r,e,i){r===1?(e.rgb_color=fb(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function fb(r){return new Ei((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function I3(r,e,i){r===1?(e.rgb_color=fb(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function C3(r,e,i){r===1?e.transform=db(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(AI(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function AI(r,e){return r.readFields(R3,{offset:0,opacity:255,rgb_color:Kw},e)}function R3(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=fb(i.readVarint()))}function M3(r,e,i){r===1?e.transform=db(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(AI(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function D3(r,e,i){r===1?e.transform=db(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(hb(i,i.readVarint()+i.pos))}function P3(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(hb(i,i.readVarint()+i.pos))}class k3{static calculate(e={},i=[]){const l=new Map,d=new Map;if(Object.keys(e).length===0)return l;i.forEach(m=>{d.set(m.name,m.rgb_color||new Ei(0,0,0))});for(const[m,_]of Object.entries(e))d.has(m)?l.set(d.get(m).toString(),_):console.warn(`Ignoring unknown image variable "${m}"`);return l}}function uy(r,e=255,i){const l=e/255,d=r.toString(),m=i.has(d)?i.get(d).clone():r.clone();return m.a*=l,m.toString()}function Kx(r,e){if(!To()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}let Qw,Qx=null;function Jw(r,e,i,l,d){for(const m of l.children)II(r,e,i,m,d)}function II(r,e,i,l,d){l.group?(r.save(),(function(m,_,v,S,A){const D=S.mask_idx!=null?v.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(_=hy(S.transform).preMultiplySelf(_)),!(function(U,Z,Q){return U.opacity!==255||Z||Q})(S,P!=null,D!=null))return void Jw(m,_,v,S,A);const k=Kx(m.canvas.width,m.canvas.height),F=k.getContext("2d");Jw(F,_,v,S,A),P&&LI(F,_,v,P),D&&OI(F,_,v,D,A),m.globalAlpha=S.opacity/255,m.drawImage(k,0,0)})(r,e,i,l.group,d),r.restore()):l.path&&(r.save(),(function(m,_,v,S,A){m.setTransform(_),S.paint_order===1?(CI(m,v,S,A),MI(m,v,S,A)):(MI(m,v,S,A),CI(m,v,S,A))})(r,e,i,l.path,d),r.restore())}function CI(r,e,i,l){const d=i.fill;if(!d)return;const m=d.opacity/255;switch(r.save(),r.beginPath(),zI(i,r),d.paint){case"rgb_color":r.fillStyle=uy(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":{const _=e.linear_gradients[d.linear_gradient_idx];_.transform&&r.setTransform(hy(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=DI(r,_,m,l);break}case"radial_gradient_idx":{const _=e.radial_gradients[d.radial_gradient_idx];_.transform&&r.setTransform(hy(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=PI(r,_,m,l)}}r.fill(RI(i)),r.restore()}function RI(r){return r.rule===1?"nonzero":r.rule===2?"evenodd":void 0}function MI(r,e,i,l){const d=i.stroke;if(!d)return;const m=NI(i);r.lineWidth=d.width,r.miterLimit=d.miterlimit,r.setLineDash(d.dasharray),r.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":r.strokeStyle=uy(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":r.strokeStyle=DI(r,e.linear_gradients[d.linear_gradient_idx],_,l,!0);break;case"radial_gradient_idx":r.strokeStyle=PI(r,e.radial_gradients[d.radial_gradient_idx],_,l,!0)}switch(d.linejoin){case 2:case 1:r.lineJoin="miter";break;case 3:r.lineJoin="round";break;case 4:r.lineJoin="bevel"}switch(d.linecap){case 1:r.lineCap="butt";break;case 2:r.lineCap="round";break;case 3:r.lineCap="square"}r.stroke(m)}function DI(r,e,i,l,d=!1){if(e.stops.length===1){const k=e.stops[0];return uy(k.rgb_color,k.opacity*i,l)}const{x1:m,y1:_,x2:v,y2:S}=e;let A=new DOMPoint(m,_),D=new DOMPoint(v,S);if(d){const k=hy(e.transform);A=k.transformPoint(A),D=k.transformPoint(D)}const P=r.createLinearGradient(A.x,A.y,D.x,D.y);for(const k of e.stops)P.addColorStop(k.offset,uy(k.rgb_color,k.opacity*i,l));return P}function PI(r,e,i,l,d=!1){if(e.stops.length===1){const X=e.stops[0];return uy(X.rgb_color,X.opacity*i,l)}const m=hy(e.transform),{fx:_,fy:v,fr:S,cx:A,cy:D,r:P}=e;let k=new DOMPoint(_,v),F=new DOMPoint(A,D),U=S,Z=P;if(d){k=m.transformPoint(k),F=m.transformPoint(F);const X=(m.a+m.d)/2;U=S*X,Z=e.r*X}const Q=r.createRadialGradient(k.x,k.y,U,F.x,F.y,Z);for(const X of e.stops)Q.addColorStop(X.offset,uy(X.rgb_color,X.opacity*i,l));return Q}function kI(r,e,i,l){const d=l.transform?hy(l.transform).preMultiplySelf(e):e,m=Kx(r.canvas.width,r.canvas.height),_=m.getContext("2d");for(const S of l.children)if(S.group)kI(_,d,i,S.group);else if(S.path){const A=S.path,D=new Path2D;D.addPath(NI(A),d),_.fill(D,RI(A))}const v=l.clip_path_idx!=null?i.clip_paths[l.clip_path_idx]:null;v&&LI(_,d,i,v),r.globalCompositeOperation="source-over",r.drawImage(m,0,0)}function LI(r,e,i,l){const d=Kx(r.canvas.width,r.canvas.height);kI(d.getContext("2d"),e,i,l),r.globalCompositeOperation="destination-in",r.drawImage(d,0,0)}function OI(r,e,i,l,d){if(l.children.length===0)return;const m=l.mask_idx!=null?i.masks[l.mask_idx]:null;m&&OI(r,e,i,m,d);const _=r.canvas.width,v=r.canvas.height,S=Kx(_,v),A=S.getContext("2d"),D=l.width,P=l.height,k=l.left,F=l.top,U=new Path2D,Z=new Path2D;Z.rect(k,F,D,P),U.addPath(Z,e),A.clip(U);for(const te of l.children)II(A,e,i,te,d);const Q=A.getImageData(0,0,_,v),X=Q.data;if(l.mask_type===1)for(let te=0;te<X.length;te+=4)X[te+3]=X[te+3]/255*(.2126*X[te]+.7152*X[te+1]+.0722*X[te+2]);A.putImageData(Q,0,0),r.globalCompositeOperation="destination-in",r.drawImage(S,0,0)}function hy(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function zI(r,e){const i=r.step;let l=r.diffs[0]*i,d=r.diffs[1]*i;e.moveTo(l,d);for(let m=0,_=2;m<r.commands.length;m++)switch(r.commands[m]){case 1:l+=r.diffs[_++]*i,d+=r.diffs[_++]*i,e.moveTo(l,d);break;case 2:l+=r.diffs[_++]*i,d+=r.diffs[_++]*i,e.lineTo(l,d);break;case 3:{const v=l+r.diffs[_++]*i,S=d+r.diffs[_++]*i;l=v+r.diffs[_++]*i,d=S+r.diffs[_++]*i,e.quadraticCurveTo(v,S,l,d);break}case 4:{const v=l+r.diffs[_++]*i,S=d+r.diffs[_++]*i,A=v+r.diffs[_++]*i,D=S+r.diffs[_++]*i;l=A+r.diffs[_++]*i,d=D+r.diffs[_++]*i,e.bezierCurveTo(v,S,A,D,l,d);break}case 5:e.closePath();break}return e}function NI(r){return zI(r,new Path2D)}class pb{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ft(pb,"LRUCache");class eT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ea(e,e.data)}getFromCache(e,i,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new pb(150)),this.cacheMap.get(l).get(ql(e.toString(),i))}setInCache(e,i,l,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new pb(150));const m=this.cacheDependenciesMap.get(d),_=ql(e.id.toString(),l);m.get(_)||m.set(_,new Set);const v=this.cacheMap.get(d),S=e.toString();m.get(_).add(S),v.put(ql(e.toString(),l),i)}removeImagesFromCacheByIds(e,i,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const d=this.cacheMap.get(l),m=this.cacheDependenciesMap.get(l);for(const _ of e){const v=ql(_.toString(),i);if(m.has(v)){for(const S of m.get(v))d.delete(S);m.delete(v)}}}rasterize(e,i,l,d){const m=this.getFromCache(e,l,d);if(m)return m.clone();const _=(function(S,A){const D=k3.calculate(A.params,S.metadata?S.metadata.variables:[]),P=S.usvg_tree,k=P.width,F=P.height,U=Math.max(1,Math.round(k*A.sx)),Z=Math.max(1,Math.round(F*A.sy)),Q=new DOMMatrix([U/k,0,0,Z/F,0,0]);return Qx===null&&(Qx=Kx(10,10),Qw=Qx.getContext("2d",{willReadFrequently:!0})),Qx.width=U,Qx.height=Z,Jw(Qw,Q,P,P,D),Qw.getImageData(0,0,U,Z)})(i.icon,e),v=eT._getImage(_);return this.setInCache(e,v,l,d),v.clone()}}class BI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function FI(r,e,i,l){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const v=1/l[_];let S=(r[_]-i[_])*v,A=(e[_]-i[_])*v;if(S>A){const D=S;S=A,A=D}if(S>d&&(d=S),A<m&&(m=A),d>m)return null}return d}function VI(r,e,i,l,d,m,_,v,S,A,D){const P=l-r,k=d-e,F=m-i,U=_-r,Z=v-e,Q=S-i,X=D[1]*Q-D[2]*Z,te=D[2]*U-D[0]*Q,se=D[0]*Z-D[1]*U,le=P*X+k*te+F*se;if(Math.abs(le)<1e-15)return null;const _e=1/le,me=A[0]-r,Ee=A[1]-e,Se=A[2]-i,we=(me*X+Ee*te+Se*se)*_e;if(we<0||we>1)return null;const De=Ee*F-Se*k,Ne=Se*P-me*F,pt=me*k-Ee*P,ct=(D[0]*De+D[1]*Ne+D[2]*pt)*_e;return ct<0||we+ct>1?null:(U*De+Z*Ne+Q*pt)*_e}function jI(r,e,i){return(r-e)/(i-e)}function UI(r,e,i,l,d,m,_,v,S){const A=1<<i,D=m-l,P=_-d,k=(r+1)/A*D+l,F=(e+0)/A*P+d,U=(e+1)/A*P+d;v[0]=(r+0)/A*D+l,v[1]=F,S[0]=k,S[1]=U}class GI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(m){const _=Math.ceil(Math.log2(m.dim/8)),v=[];let S=Math.ceil(Math.pow(2,_));const A=1/S,D=(F,U,Z,Q,X)=>{const te=Q?1:0,se=(F+1)*Z-te,le=U*Z,_e=(U+1)*Z-te;X[0]=F*Z,X[1]=le,X[2]=se,X[3]=_e};let P=new BI(S);const k=[];for(let F=0;F<S*S;F++){D(F%S,Math.floor(F/S),A,!1,k);const U=wm(k[0],k[1],m),Z=wm(k[2],k[1],m),Q=wm(k[2],k[3],m),X=wm(k[0],k[3],m);P.minimums.push(Math.min(U,Z,Q,X)),P.maximums.push(Math.max(U,Z,Q,X)),P.leaves.push(1)}for(v.push(P),S/=2;S>=1;S/=2){const F=v[v.length-1];P=new BI(S);for(let U=0;U<S*S;U++){D(U%S,Math.floor(U/S),2,!0,k);const Z=F.getElevation(k[0],k[1]),Q=F.getElevation(k[2],k[1]),X=F.getElevation(k[2],k[3]),te=F.getElevation(k[0],k[3]),se=F.isLeaf(k[0],k[1]),le=F.isLeaf(k[2],k[1]),_e=F.isLeaf(k[2],k[3]),me=F.isLeaf(k[0],k[3]),Ee=Math.min(Z.min,Q.min,X.min,te.min),Se=Math.max(Z.max,Q.max,X.max,te.max),we=se&&le&&_e&&me;P.maximums.push(Se),P.minimums.push(Ee),P.leaves.push(Se-Ee<=5&&we?1:0)}v.push(P)}return v})(this.dem),l=i.length-1,d=i[l];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,d,m,_,v=1){return FI([e,i,-100],[l,d,this.maximums[0]*v],m,_)}raycast(e,i,l,d,m,_,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,l,d,m,_,v);if(S==null)return null;const A=[],D=[],P=[],k=[],F=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:U,t:Z,nodex:Q,nodey:X,depth:te}=F.pop();if(this.leaves[U]){UI(Q,X,te,e,i,l,d,P,k);const le=1<<te,_e=(Q+0)/le,me=(Q+1)/le,Ee=(X+0)/le,Se=(X+1)/le,we=wm(_e,Ee,this.dem)*v,De=wm(me,Ee,this.dem)*v,Ne=wm(me,Se,this.dem)*v,pt=wm(_e,Se,this.dem)*v,ct=VI(P[0],P[1],we,k[0],P[1],De,k[0],k[1],Ne,m,_),dt=VI(k[0],k[1],Ne,P[0],k[1],pt,P[0],P[1],we,m,_),Tt=Math.min(ct!==null?ct:Number.MAX_VALUE,dt!==null?dt:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const vt=En([],m,_,Z);if(qI(we,De,pt,Ne,jI(vt[0],P[0],k[0]),jI(vt[1],P[1],k[1]))>=vt[2])return Z}continue}let se=0;for(let le=0;le<this._siblingOffset.length;le++){UI((Q<<1)+this._siblingOffset[le][0],(X<<1)+this._siblingOffset[le][1],te+1,e,i,l,d,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[U]+le]*v;const _e=FI(P,k,m,_);if(_e!=null){const me=_e;A[le]=me;let Ee=!1;for(let Se=0;Se<se&&!Ee;Se++)me>=A[D[Se]]&&(D.splice(Se,0,le),Ee=!0);Ee||(D[se]=le),se++}}for(let le=0;le<se;le++){const _e=D[le];F.push({idx:this.childOffsets[U]+_e,t:A[_e],nodex:(Q<<1)+this._siblingOffset[_e][0],nodey:(X<<1)+this._siblingOffset[_e][1],depth:te+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,d,m){if(e[d].isLeaf(i,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,v=e[_];let S=0,A=0;for(let D=0;D<this._siblingOffset.length;D++){const P=2*i+this._siblingOffset[D][0],k=2*l+this._siblingOffset[D][1],F=v.getElevation(P,k),U=v.isLeaf(P,k),Z=this._addNode(F.min,F.max,U);U&&(S|=1<<D),A||(A=Z)}for(let D=0;D<this._siblingOffset.length;D++)S&1<<D||this._construct(e,2*i+this._siblingOffset[D][0],2*l+this._siblingOffset[D][1],_,A+D)}}function qI(r,e,i,l,d,m){return Rn(Rn(r,i,m),Rn(e,l,m),d)}function wm(r,e,i){const l=i.dim,d=xe(r*l-.5,0,l-1),m=xe(e*l-.5,0,l-1),_=Math.floor(d),v=Math.floor(m),S=Math.min(_+1,l-1),A=Math.min(v+1,l-1);return qI(i.get(_,v),i.get(S,v),i.get(_,A),i.get(S,A),d-_,m-v)}const L3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function O3(r,e,i){return(256*r*256+256*e+i)/10-1e4}function z3(r,e,i){return 256*r+e+i/256-32768}class mb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,d=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void kn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let S=0;S<m;S++)_[this._idx(-1,S)]=_[this._idx(0,S)],_[this._idx(m,S)]=_[this._idx(m-1,S)],_[this._idx(S,-1)]=_[this._idx(S,0)],_[this._idx(S,m)]=_[this._idx(S,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const v=l==="terrarium"?z3:O3;for(let S=0;S<_.length;++S){const A=4*S;this.floatView[S]=v(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=ja.now()}_buildQuadTree(){this._tree=new GI(this)}get(e,i,l=!1){l&&(e=xe(e,-1,this.dim),i=xe(i,-1,this.dim));const d=this._idx(e,i);return this.floatView[d]}set(e,i,l){const d=this._idx(e,i),m=this.floatView[d];return this.floatView[d]=l,l-m}static getUnpackVector(e){return L3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],d=mb.getUnpackVector(i);let m=Math.floor((e+d[3])/d[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new g0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=i*this.dim,m=i*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(i){case-1:d=m-1;break;case 1:m=d+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const S=-i*this.dim,A=-l*this.dim;for(let D=_;D<v;D++)for(let P=d;P<m;P++){const k=4*this._idx(P,D),F=4*this._idx(P+S,D+A);this.pixels[k+0]=e.pixels[F+0],this.pixels[k+1]=e.pixels[F+1],this.pixels[k+2]=e.pixels[F+2],this.pixels[k+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function N3(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(l,d){return l.readFields(U3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(i,i.readVarint()+i.pos))}function B3(r,e,i){r===1?(e.delta_filter=(function(l,d){return l.readFields(F3,{blockSize:0},d)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function F3(r,e,i){r===1&&(e.blockSize=i.readVarint())}function V3(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function j3(r,e,i){let l=0,d=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(m,_){return m.readFields(B3,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(m,_){return m.readFields(V3,{},_)})(i,i.readVarint()+i.pos):r===5?d=i.readFloat():r===6?l=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=l)}function U3(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(l,d){return l.readFields(j3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(i,i.readVarint()+i.pos))}function G3(r,e,i){if(r===2)(function(l,d,m){l.readFields(q3,m,d)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function q3(r,e,i){if(r===1){let l=0;const d=i.readVarint()+i.pos;for(;i.pos<d;)e[l++]=i.readVarint()}}function H3(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let l=2;l>=1;l--){const d=l===1?1:0,m=l===2?1:0;for(let _=0;_<e[0];_++){const v=e[1]*_;for(let S=d;S<e[1];S++){const A=e[2]*(S+v);for(let D=m;D<e[2];D++){const P=e[3]*(D+A);for(let k=0;k<e[3];k++){const F=P+k;r[F]+=r[F-i]}}}}i*=e[l]}return r}function $3(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function Z3(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const l=r[i],d=r[i+1];r[i]=(240&l)>>4|(61440&l)>>8|(240&d)<<4|61440&d,r[i+1]=15&l|(3840&l)>>4|(15&d)<<8|(3840&d)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const l=r[i],d=r[i+1],m=r[i+2],_=r[i+3];r[i+0]=(192&l)>>6|(192&d)>>4|(192&m)>>2|192&_,r[i+1]=(48&l)>>4|(48&d)>>2|48&m|(48&_)<<2,r[i+2]=(12&l)>>2|12&d|(12&m)<<2|(12&_)<<4,r[i+3]=3&l|(3&d)<<2|(3&m)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ft(mb,"DEMData"),Ft(GI,"DemMinMaxQuadTree",{omit:["dem"]});var uu=Uint8Array,Jx=Uint16Array,W3=Int32Array,HI=new uu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$I=new uu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),X3=new uu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZI=function(r,e){for(var i=new Jx(31),l=0;l<31;++l)i[l]=e+=1<<r[l-1];var d=new W3(i[30]);for(l=1;l<30;++l)for(var m=i[l];m<i[l+1];++m)d[m]=m-i[l]<<5|l;return{b:i,r:d}},WI=ZI(HI,2),XI=WI.b,Y3=WI.r;XI[28]=258,Y3[258]=28;for(var K3=ZI($I,0).b,YI=new Jx(32768),qs=0;qs<32768;++qs){var dy=(43690&qs)>>1|(21845&qs)<<1;YI[qs]=((65280&(dy=(61680&(dy=(52428&dy)>>2|(13107&dy)<<2))>>4|(3855&dy)<<4))>>8|(255&dy)<<8)>>1}var ev=function(r,e,i){for(var l=r.length,d=0,m=new Jx(e);d<l;++d)r[d]&&++m[r[d]-1];var _,v=new Jx(e);for(d=1;d<e;++d)v[d]=v[d-1]+m[d-1]<<1;_=new Jx(1<<e);var S=15-e;for(d=0;d<l;++d)if(r[d])for(var A=d<<4|r[d],D=e-r[d],P=v[r[d]-1]++<<D,k=P|(1<<D)-1;P<=k;++P)_[YI[P]>>S]=A;return _},tv=new uu(288);for(qs=0;qs<144;++qs)tv[qs]=8;for(qs=144;qs<256;++qs)tv[qs]=9;for(qs=256;qs<280;++qs)tv[qs]=7;for(qs=280;qs<288;++qs)tv[qs]=8;var KI=new uu(32);for(qs=0;qs<32;++qs)KI[qs]=5;var Q3=ev(tv,9),J3=ev(KI,5),tT=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},qh=function(r,e,i){var l=e/8|0;return(r[l]|r[l+1]<<8)>>(7&e)&i},nT=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},eN=function(r){return(r+7)/8|0},tN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hh=function(r,e,i){var l=new Error(e||tN[r]);if(l.code=r,Error.captureStackTrace&&Error.captureStackTrace(l,Hh),!i)throw l;return l},nN=new uu(0),iN=typeof TextDecoder<"u"&&new TextDecoder;try{iN.decode(nN,{stream:!0})}catch{}const rN={gzip_data:"gzip"};class Zu extends Error{constructor(e){super(e),this.name="MRTError"}}const sN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},QI={uint32:1,uint16:2,uint8:4},aN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let iT;class gb{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Zu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),l=new DataView(e);if(i[0]!==13)throw new Zu("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),l=this.getHeaderLength(e);if(i.length<l)throw new Zu(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const d=new iT(i.subarray(0,l)).readFields(N3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Zu(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const m of d.layers)this.layers[m.name]=new JI(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],l=this.getLayer(e.layerName);for(let d of e.blockIndices){const m=l.dataIndex[d],_=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(l._blocksInProgress.has(d))continue;const S={layerName:l.name,firstByte:_,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:d,blockShape:[m.bands.length].concat(l.bandShape),buffer:l.buffer,codec:m.codec.codec,filters:m.filters.map(A=>A.filter)};l._blocksInProgress.add(d),i.push(S)}return new eC(i,()=>{i.forEach(d=>l._blocksInProgress.delete(d.blockIndex))},(d,m)=>{if(i.forEach(_=>l._blocksInProgress.delete(_.blockIndex)),d)throw d;m.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class JI{constructor({version:e,name:i,units:l,tileSize:d,pixelFormat:m,buffer:_,dataIndex:v},S){if(this.version=e,this.version!==1)throw new Zu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=l,this.tileSize=d,this.buffer=_,this.pixelFormat=sN[m],this.dataIndex=v,this.bandShape=[d+2*_,d+2*_,QI[this.pixelFormat]],this._decodedBlocks=new pb(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return QI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[l,d]of this.dataIndex.entries()){for(const[m,_]of d.bands.entries())if(_===e)return{bandIndex:i+m,blockIndex:l,blockBandIndex:m};i+=d.bands.length}break;case"number":for(const[l,d]of this.dataIndex.entries()){if(e>=i&&e<i+d.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-i};i+=d.bands.length}break;default:throw new Zu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,l=-1/0;const d=[],m=new Set;for(const _ of e){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new Zu(`Invalid band: ${JSON.stringify(_)}`);const S=this.dataIndex[v];d.includes(v)||d.push(v),m.add(v),i=Math.min(i,S.firstByte),l=Math.max(l,S.lastByte)}if(m.size>this.cacheSize)throw new Zu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:l,blockIndices:d}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(e);if(i<0)throw new Zu(`Band not found: ${JSON.stringify(e)}`);const d=this._decodedBlocks.get(i.toString());if(!d)throw new Zu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[i],_=this.bandShape.reduce((A,D)=>A*D,1),v=l*_,S=d.subarray(v,v+_);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}gb.setPbf=function(r){iT=r};class eC{constructor(e,i,l){this.tasks=e,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}gb.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(l=>{const{layerName:d,firstByte:m,lastByte:_,pixelFormat:v,blockShape:S,blockIndex:A,filters:D,codec:P}=l,k=i.subarray(m,_+1),F=new Uint32Array(S[0]*S[1]*S[2]);let U;if(P!=="gzip_data")throw new Zu(`Unhandled codec: ${P}`);return U=(function(Z,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve((_e=(function(Se){Se[0]==31&&Se[1]==139&&Se[2]==8||Hh(6,"invalid gzip data");var we=Se[3],De=10;4&we&&(De+=2+(Se[10]|Se[11]<<8));for(var Ne=(we>>3&1)+(we>>4&1);Ne>0;Ne-=!Se[De++]);return De+(2&we)})(X=Z),_e+8>X.length&&Hh(6,"invalid gzip data"),(function(Se,we,De,Ne){var pt=Se.length;if(!pt||we.f&&!we.l)return De||new uu(0);var ct=!De,dt=ct||we.i!=2,Tt=we.i;ct&&(De=new uu(3*pt));var vt=function(qo){var Xd=De.length;if(qo>Xd){var _o=new uu(Math.max(2*Xd,qo));_o.set(De),De=_o}},bt=we.f||0,ot=we.p||0,At=we.b||0,_t=we.l,Ct=we.d,Et=we.m,nn=we.n,rn=8*pt;do{if(!_t){bt=qh(Se,ot,1);var $t=qh(Se,ot+1,3);if(ot+=3,!$t){var Wt=Se[(wi=eN(ot)+4)-4]|Se[wi-3]<<8,An=wi+Wt;if(An>pt){Tt&&Hh(0);break}dt&&vt(At+Wt),De.set(Se.subarray(wi,An),At),we.b=At+=Wt,we.p=ot=8*An,we.f=bt;continue}if($t==1)_t=Q3,Ct=J3,Et=9,nn=5;else if($t==2){var _n=qh(Se,ot,31)+257,Jt=qh(Se,ot+10,15)+4,Bn=_n+qh(Se,ot+5,31)+1;ot+=14;for(var ri=new uu(Bn),Ri=new uu(19),Jn=0;Jn<Jt;++Jn)Ri[X3[Jn]]=qh(Se,ot+3*Jn,7);ot+=3*Jt;var Zi=tT(Ri),yi=(1<<Zi)-1,os=ev(Ri,Zi);for(Jn=0;Jn<Bn;){var wi,ji=os[qh(Se,ot,yi)];if(ot+=15&ji,(wi=ji>>4)<16)ri[Jn++]=wi;else{var Tr=0,zr=0;for(wi==16?(zr=3+qh(Se,ot,3),ot+=2,Tr=ri[Jn-1]):wi==17?(zr=3+qh(Se,ot,7),ot+=3):wi==18&&(zr=11+qh(Se,ot,127),ot+=7);zr--;)ri[Jn++]=Tr}}var Nr=ri.subarray(0,_n),ls=ri.subarray(_n);Et=tT(Nr),nn=tT(ls),_t=ev(Nr,Et),Ct=ev(ls,nn)}else Hh(1);if(ot>rn){Tt&&Hh(0);break}}dt&&vt(At+131072);for(var Ta=(1<<Et)-1,Xa=(1<<nn)-1,Ls=ot;;Ls=ot){var Hs=(Tr=_t[nT(Se,ot)&Ta])>>4;if((ot+=15&Tr)>rn){Tt&&Hh(0);break}if(Tr||Hh(2),Hs<256)De[At++]=Hs;else{if(Hs==256){Ls=ot,_t=null;break}var ta=Hs-254;Hs>264&&(ta=qh(Se,ot,(1<<(Yr=HI[Jn=Hs-257]))-1)+XI[Jn],ot+=Yr);var Yn=Ct[nT(Se,ot)&Xa],Br=Yn>>4;if(Yn||Hh(3),ot+=15&Yn,ls=K3[Br],Br>3){var Yr=$I[Br];ls+=nT(Se,ot)&(1<<Yr)-1,ot+=Yr}if(ot>rn){Tt&&Hh(0);break}dt&&vt(At+131072);var tc=At+ta;if(At<ls){var Go=0-ls,Ea=Math.min(ls,tc);for(Go+At<0&&Hh(3);At<Ea;++At)De[At]=Ne[Go+At]}for(;At<tc;++At)De[At]=De[At-ls]}}we.l=_t,we.p=Ls,we.b=At,we.f=bt,_t&&(bt=1,we.m=Et,we.d=Ct,we.n=nn)}while(!bt);return At!=De.length&&ct?(function(qo,Xd,_o){return(_o==null||_o>qo.length)&&(_o=qo.length),new uu(qo.subarray(0,_o))})(De,0,At):De.subarray(0,At)})(X.subarray(_e,-8),{i:2},new uu(((se=X)[(le=se.length)-4]|se[le-3]<<8|se[le-2]<<16|se[le-1]<<24)>>>0),te)));var X,te,se,le,_e;const me=rN[Q];if(!me)throw new Error(`Unhandled codec: ${Q}`);const Ee=new globalThis.DecompressionStream(me);return new Response(new Blob([Z]).stream().pipeThrough(Ee)).arrayBuffer().then(Se=>new Uint8Array(Se))})(k,P).then(Z=>((function(Q,X){Q.readFields(G3,X)})(new iT(Z),F),new aN[v](F.buffer))),U.then(Z=>{for(let Q=D.length-1;Q>=0;Q--)switch(D[Q]){case"delta_filter":H3(Z,S);break;case"zigzag_filter":$3(Z);break;case"bitshuffle_filter":Z3(Z,v);break;default:throw new Zu(`Unhandled filter "${D[Q]}"`)}return{layerName:d,blockIndex:A,data:Z}}).catch(Z=>{throw Z})}))},Ft(eC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ft(gb,"MapboxRasterTile"),Ft(JI,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class tC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class nC{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vc(jt,16,0),this.featureIndexArray=new ru,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,l,d,m,_=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,m,_);const A=this.grid;for(let D=0;D<i.length;D++){const P=i[D],k=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const U=P[F];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}v!==0&&(k[0]-=v,k[1]-=v,k[2]+=v,k[3]+=v),k[0]<jt&&k[1]<jt&&k[2]>=0&&k[3]>=0&&A.insert(S,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pi(new Z0(this.rawTileData)).layers,this.sourceLayerCoder=new tC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:l,transform:d,tileTransform:m,pixelPosMatrix:_,availableImages:v,worldview:S}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=i.queryRadius?i.queryRadius:0,D=l.bufferedTilespaceBounds,P=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(Z,Q,X,te)=>il(l.bufferedTilespaceGeometry,Z-A,Q-A,X+A,te+A));P.sort(oN);let k=null;d.elevation&&P.length>0&&(k=cy.create(d.elevation,this.tileID));const F={};let U;for(let Z=0;Z<P.length;Z++){const Q=P[Z];if(Q===U)continue;U=Q;const X=this.featureIndexArray.get(Q);let te=null;this.is3DTile?this.loadMatchingModelFeature(F,X,e,l,d,S):this.loadMatchingFeature(F,X,e,v,S,(se,le,_e,me=0)=>(te||(te=Dn(se,this.tileID.canonical,m)),le.queryIntersectsFeature(l,se,_e,te,this.z,d,_,k,me,i.scope)))}return F}loadMatchingFeature(e,i,l,d,m,_){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:D}=i,P=this.bucketLayerIDs[S],k=l.layers,F=Object.keys(k);if(F.length&&!Vn(F,P))return;const U=l.sourceCache,Z=this.sourceLayerCoder.decode(A),Q=this.vtLayers[Z].feature(v),X=this.getId(Q,Z);for(let te=0;te<P.length;te++){const se=P[te];if(!k[se])continue;const{styleLayer:le,targets:_e}=k[se];let me={};X!==void 0&&(me=U.getFeatureState(le.sourceLayer,X));const Ee=!_||_(Q,le,me,D);if(!Ee)continue;const Se=new Qg(Q,this.z,this.x,this.y,X);Se.tile=this.tileID.canonical,Se.state=me;let we=this.serializedLayersCache.get(se);we||(we=le.serialize(),we.id=se,this.serializedLayersCache.set(se,we)),Se.source=we.source,Se.sourceLayer=we["source-layer"],Se.layer=Object.assign({},we),Se.layer.paint=iC(we.paint,le.paint,Q,me,d),Se.layer.layout=iC(we.layout,le.layout,Q,me,d);let De=!1;for(const Ne of _e){this.updateFeatureProperties(Se,Ne);const{filter:pt}=Ne;if(pt){if(Q.properties=Se.properties,pt.needGeometry){const ct=jn(Q,!0);if(!pt.filter(new Mi(this.tileID.overscaledZ,{worldview:m}),ct,this.tileID.canonical))continue}else if(!pt.filter(new Mi(this.tileID.overscaledZ,{worldview:m}),Q))continue}De=!0,Ne.targetId&&this.addFeatureVariant(Se,Ne)}De&&this.appendToResult(e,se,v,Se,Ee)}}loadMatchingModelFeature(e,i,l,d,m,_){const{featureIndex:v,bucketIndex:S}=i,A=this.bucketLayerIDs[S],D=l.layers,P=Object.keys(D);if(!P.length||Vn(P,A))for(let k=0;k<A.length;k++){const F=A[k],{styleLayer:U,targets:Z}=D[F];if(U.type!=="model")continue;const Q=d.tile,X=Q.getBucket(U);if(!(X&&X instanceof ub))continue;const te=p3(X,v,d,m);if(!te)continue;const{z:se,x:le,y:_e}=Q.tileID.canonical,{feature:me,intersectionZ:Ee,position:Se}=te;let we={};me.id!==void 0&&(we=l.sourceCache.getFeatureState(U.sourceLayer,me.id));const De=new Qg({},se,le,_e,me.id);De.tile=this.tileID.canonical,De.state=we,De.properties=me.properties,De.geometry={type:"Point",coordinates:[Se.lng,Se.lat]};let Ne=this.serializedLayersCache.get(F);Ne||(Ne=U.serialize(),Ne.id=F,this.serializedLayersCache.set(F,Ne)),De.source=Ne.source,De.sourceLayer=Ne["source-layer"],De.layer=Object.assign({},Ne);let pt=!1;for(const ct of Z){this.updateFeatureProperties(De,ct);const{filter:dt}=ct;if(dt){if(me.properties=De.properties,dt.needGeometry){if(!dt.filter(new Mi(this.tileID.overscaledZ,{worldview:_}),me,this.tileID.canonical))continue}else if(!dt.filter(new Mi(this.tileID.overscaledZ,{worldview:_}),me))continue}pt=!0,ct.targetId&&this.addFeatureVariant(De,ct)}pt&&this.appendToResult(e,F,v,De,Ee)}}updateFeatureProperties(e,i,l){if(i.properties){const d={};for(const m in i.properties){const _=i.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);_!=null&&(d[m]=_)}e.properties=d}}addFeatureVariant(e,i,l){const d={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(d)}appendToResult(e,i,l,d,m){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:l,feature:d,intersectionZ:m})}lookupSymbolFeatures(e,i,l,d,m,_){const v={};this.loadVTLayers();for(const S of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:l,featureIndex:S,layoutVertexArrayOffset:0},d,m,_);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(l),m=this.vtFeatures[d];if(m[i])return m[i];const _=this.vtLayers[d].feature(i);return m[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const m=xc(d);if(m.result!=="success"){const _=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void kn(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=m.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[d];typeof l=="boolean"&&(l=Number(l))}return l}}function iC(r,e,i,l,d){return yn(r,(m,_)=>{const v=e instanceof ka?e.get(_):null;return v&&v.evaluate?v.evaluate(i,l,void 0,d):v})}function oN(r,e){return e-r}Ft(nC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const rC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const m=rC[15&l];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new rT(v,_,m,e)}constructor(e,i=64,l=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=rC.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return sT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:v}=this,S=[0,m.length-1,0],A=[];for(;S.length;){const D=S.pop()||0,P=S.pop()||0,k=S.pop()||0;if(P-k<=v){for(let Q=k;Q<=P;Q++){const X=_[2*Q],te=_[2*Q+1];X>=e&&X<=l&&te>=i&&te<=d&&A.push(m[Q])}continue}const F=k+P>>1,U=_[2*F],Z=_[2*F+1];U>=e&&U<=l&&Z>=i&&Z<=d&&A.push(m[F]),(D===0?e<=U:i<=Z)&&(S.push(k),S.push(F-1),S.push(1-D)),(D===0?l>=U:d>=Z)&&(S.push(F+1),S.push(P),S.push(1-D))}return A}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:_}=this,v=[0,d.length-1,0],S=[],A=l*l;for(;v.length;){const D=v.pop()||0,P=v.pop()||0,k=v.pop()||0;if(P-k<=_){for(let Q=k;Q<=P;Q++)aC(m[2*Q],m[2*Q+1],e,i)<=A&&S.push(d[Q]);continue}const F=k+P>>1,U=m[2*F],Z=m[2*F+1];aC(U,Z,e,i)<=A&&S.push(d[F]),(D===0?e-l<=U:i-l<=Z)&&(v.push(k),v.push(F-1),v.push(1-D)),(D===0?e+l>=U:i+l>=Z)&&(v.push(F+1),v.push(P),v.push(1-D))}return S}}function sT(r,e,i,l,d,m){if(d-l<=i)return;const _=l+d>>1;sC(r,e,_,l,d,m),sT(r,e,i,l,_-1,1-m),sT(r,e,i,_+1,d,1-m)}function sC(r,e,i,l,d,m){for(;d>l;){if(d-l>600){const A=d-l+1,D=i-l+1,P=Math.log(A),k=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*k*(A-k)/A)*(D-A/2<0?-1:1);sC(r,e,i,Math.max(l,Math.floor(i-D*k/A+F)),Math.min(d,Math.floor(i+(A-D)*k/A+F)),m)}const _=e[2*i+m];let v=l,S=d;for(nv(r,e,l,i),e[2*d+m]>_&&nv(r,e,l,d);v<S;){for(nv(r,e,v,S),v++,S--;e[2*v+m]<_;)v++;for(;e[2*S+m]>_;)S--}e[2*l+m]===_?nv(r,e,l,S):(S++,nv(r,e,S,d)),S<=i&&(l=S+1),i<=S&&(d=S-1)}}function nv(r,e,i,l){aT(r,i,l),aT(e,2*i,2*l),aT(e,2*i+1,2*l+1)}function aT(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function aC(r,e,i,l){const d=r-i,m=e-l;return d*d+m*m}s.$=Sp,s.A=Ys,s.B=ql,s.C=2,s.D=K_,s.E=pl,s.F=Fx,s.G=R2,s.H=ad,s.I=Vs,s.J=dg,s.K=On,s.L=Mn,s.M=_h,s.N=Td,s.O=Jc,s.P=Dt,s.Q=bh,s.R=hs,s.S=Yp,s.T=pw,s.U=xc,s.V=cb,s.W=jl,s.X=Ur,s.Y=fh,s.Z=js,s._=ao,s.a=function(r){return ts.API_CDN_URL_REGEX.test(r)},s.a$=xt,s.a0=od,s.a1=ah,s.a2=Uf,s.a3=class extends cb{},s.a4=Ed,s.a5=yc,s.a6=We,s.a7=function(r){const e=r.value;return e?od(e)?Zw(e,!0)?[]:[new cb(r.key,e,`invalid url "${e}"`)]:[new cb(r.key,e,`string expected, "${On(e)}" found`)]:[]},s.a8=Id,s.a9=br,s.aA=xe,s.aB=nt,s.aC=bs,s.aD=ee,s.aE=mo,s.aF=je,s.aG=Lt,s.aH=function(r,e){const i={};for(let l=0;l<e.length;l++){const d=e[l];d in r&&(i[d]=r[d])}return i},s.aI=ke,s.aJ=Xe,s.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,l){const d=this.entries[r]=this.entries[r]||{callbacks:[]};if(d.result){const[m,_]=d.result;return this.scheduler?this.scheduler.add(()=>{l(m,_)},e):l(m,_),()=>{}}return d.callbacks.push(l),d.cancel||(d.cancel=i((m,_)=>{d.result=[m,_];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,_)},e):v(m,_);setTimeout(()=>delete this.entries[r],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==l),d.callbacks.length||(d.cancel(),delete this.entries[r]))}}},s.aL=function(r,e,i){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},d=>{const m=Nc(r.request,(_,v,S)=>{_?d(_):v&&d(null,{rawData:v,vectorTile:i?void 0:new pi(new Z0(v)),responseHeaders:new Map(S.entries())})});return()=>{m.cancel(),d()}},e)},s.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=Ml,s.aO=function(r){So++,So>nh&&(r.getActor().send("enforceCacheSizeLimit",nd),So=0)},s.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},s.aQ=ca,s.aR=lI,s.aS=pI,s.aT=ge,s.aU=oI,s.aV=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<r.length;l++){const d=document.createElement("source");ih(r[l])||(i.crossOrigin="Anonymous"),d.src=r[l],i.appendChild(d)}return{cancel:()=>{}}},s.aW=Lx,s.aX=Jg,s.aY=tn,s.aZ=Ux,s.a_=ut,s.aa=Nt,s.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return nr(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Rn(r.x,e.x,i),y:Rn(r.y,e.y,i),z:Rn(r.z,e.z,i),azimuthal:Rn(r.azimuthal,e.azimuthal,i),polar:Rn(r.polar,e.polar,i)}}},s.ac=Mi,s.ad=ba,s.ae=qt,s.af=Cn,s.ag=dn,s.ah=Fe,s.ai=ka,s.aj=Fh,s.ak=Rn,s.al=jt,s.am=sd,s.an=oi,s.ao=Ei,s.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,l]){const d=nr([1,i,l]);return{x:d.x,y:d.y,z:d.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Rn(r.x,e.x,i),y:Rn(r.y,e.y,i),z:Rn(r.z,e.z,i)}}},s.aq=function(r,e,i=0,l=!0){const d=new Dt(i,i),m=r.sub(d),_=e.add(d),v=[m,new Dt(_.x,m.y),_,new Dt(m.x,_.y)];return l&&v.push(m.clone()),v},s.ar=function(r,e){const i=[];for(let l=0;l<r.length;l++){const d=st(l-1,-1,r.length-1),m=st(l+1,-1,r.length-1),_=r[l],v=r[m],S=r[d].sub(_).unit(),A=v.sub(_).unit(),D=A.angleWithSep(S.x,S.y),P=S.add(A).unit().mult(-1*e/Math.sin(D/2));i.push(_.add(P))}return i},s.as=$2,s.at=il,s.au=function(r,e,i=0){return wt(((e.x-i)*r.scale-r.x)*jt,(e.y*r.scale-r.y)*jt,et(e.z,e.y))},s.av=tr,s.aw=qn,s.ax=Ki,s.ay=r2,s.az=function(r){let e=1/0,i=1/0,l=-1/0,d=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),l=Math.max(l,m.x),d=Math.max(d,m.y);return{min:new Dt(e,i),max:new Dt(l,d)}},s.b=function(r){return ts.API_FONTS_REGEX.test(r)},s.b$=q,s.b0=vs,s.b1=Tc,s.b2=Pt,s.b3=im,s.b4=sb,s.b5=function(){No.isLoading()||No.isLoaded()||Ou()!=="deferred"||Wp()},s.b6=Kp,s.b7=jn,s.b8=Qg,s.b9=ir,s.bA=Ke,s.bB=Oe,s.bC=Qe,s.bD=function(r,e){const{x:i,y:l}=r.point,d=N_(i,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return nt(d,d,or(lu(e)))},s.bE=W,s.bF=Hi,s.bG=Qn,s.bH=En,s.bI=Vr,s.bJ=Ni,s.bK=ry,s.bL=ec,s.bM=Dw,s.bN=function(r,e,i,l,d){const m=5*e+2;r.float32[m+0]=i,r.float32[m+1]=l,r.float32[m+2]=d},s.bO=ly,s.bP=Fi,s.bQ=Ia,s.bR=ws,s.bS=_u,s.bT=st,s.bU=function(r,e,i,l){var d=new B(4);return d[0]=r,d[1]=e,d[2]=i,d[3]=l,d},s.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,d=Math.floor(r.x),m=Math.floor((r.x-d)*l),_=Math.floor(r.y*l),v=this.findDEMTileFor(new ca(i,d,i,m,_));return!(!v||!v.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||r.y<0||r.y>1)return e;const d=l.getSource().maxzoom,m=1<<d,_=Math.floor(r.x),v=r.x-_,S=new ca(d,_,d,Math.floor(v*m),Math.floor(r.y*m)),A=this.findDEMTileFor(S);if(!A||!A.dem)return e;const D=A.dem,P=1<<A.tileID.canonical.z,k=(v*P-A.tileID.canonical.x)*D.dim,F=(r.y*P-A.tileID.canonical.y)*D.dim,U=Math.floor(k),Z=Math.floor(F);return(i?this.exaggeration():1)*Rn(Rn(D.get(U,Z),D.get(U,Z+1),F-Z),Rn(D.get(U+1,Z),D.get(U+1,Z+1),F-Z),k-U)}static getAtTileOffset(r,e,i,l){const d=1<<r.canonical.z;return l?l.pointElevation(e):i?i.getAtPointOrZero(new qt(r.wrap+(r.canonical.x+e.x/jt)/d,(r.canonical.y+e.y/jt)/d)):0}static getAtTileOffsetFunc(r,e,i,l){return(d,m,_)=>{const v=this.getAtTileOffset(r,d,m,_),S=l.upVector(r.canonical,d.x,d.y);return Be(S,S,v*l.upVectorScale(r.canonical,e,i).metersToTile),S}}getForTilePoints(r,e,i,l){if(this.isUsingMockSource())return!1;const d=cy.create(this,r,l);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,d=1<<r.canonical.z-l.canonical.z;let m=r.canonical.x/d-l.canonical.x,_=r.canonical.y/d-l.canonical.y,v=0;for(let S=0;S<r.canonical.z-l.canonical.z&&!i.leaves[v];S++){m*=2,_*=2;const A=2*Math.floor(_)+Math.floor(m);v=i.childOffsets[v]+A,m%=1,_%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const d of r){const m=this.getMinMaxForTile(d.tileID);m&&(i=Math.min(i,m.min),l=Math.max(l,m.max),e=!0)}return e?{min:i,max:l}:null}},s.bW=z0,s.bX=wr,s.bY=ua,s.bZ=Gg,s.b_=mI,s.ba=Tw,s.bb=$u,s.bc=Dn,s.bd=iu,s.be=Od,s.bf=sx,s.bg=fr,s.bh=Ql,s.bi=qw,s.bj=function(r,e){const i=Fh(e.zoom);if(i===0)return lu(r);const l=lm(r),d=ox(l),m=je(l.getWest())*e.worldSize,_=je(l.getEast())*e.worldSize,v=Xe(l.getNorth())*e.worldSize,S=Xe(l.getSouth())*e.worldSize,A=[m,v,0],D=[_,v,0],P=[m,S,0],k=[_,S,0],F=at([],e.globeMatrix);return Cn(A,A,F),Cn(D,D,F),Cn(P,P,F),Cn(k,k,F),d[0]=Uu(d[0],P,i),d[1]=Uu(d[1],k,i),d[2]=Uu(d[2],D,i),d[3]=Uu(d[3],A,i),Ai.fromPoints(d)},s.bk=Cg,s.bl=at,s.bm=Ig,s.bn=Uu,s.bo=Hl,s.bp=Z1,s.bq=Re,s.br=Ge,s.bs=gb,s.bt=Z0,s.bu=Nc,s.bv=function(r,e){const i=[];for(const l in r)l in e||i.push(l);return i},s.bw=$e,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=no,s.bz=Ye,s.c=Ts,s.c$=function(r,e,i){let l=0;for(let d=0;d<2;++d)r[d]>0&&(l+=(r[d]-0)*(r[d]-0)),e[d]<0&&(l+=(0-e[d])*(0-e[d]));return l},s.c0=ce,s.c1=Cw,s.c2=N2,s.c3=zw,s.c4=rT,s.c5=Be,s.c6=Xr,s.c7=Tn,s.c8=function(r,e,i){i*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+d*v,r[1]=d*S-l*v,r[2]=m*S+_*v,r[3]=_*S-m*v,r},s.c9=si,s.cA=ve,s.cB=ks,s.cC=GA,s.cD=Ac,s.cE=z_,s.cF=function(r,e,i,l,d,m,_,v,S){if(S.name==="globe")return z_(r,e,new Ac(i,l,d),!1);const A=Ux({z:i,x:l,y:d},S);return new Ai([(m+A.x/A.scale)*e,e*(A.y/A.scale),_],[(m+A.x2/A.scale)*e,e*(A.y2/A.scale),v])},s.cG=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},s.cH=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},s.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return ne[e]},s.cJ=Le,s.cK=Rl,s.cL=6,s.cM=function(r){const e=Ke(new Float64Array(16));nt(e,r.pixelMatrix,r.globeMatrix);const i=[0,fe,0],l=[0,ue,0];return Cn(i,i,e),Cn(l,l,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!np(r,new ge(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!np(r,new ge(r.center.lat,-90))]},s.cN=function(r,e){const{scale:i}=r.tileTransform,l=i*jt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(d,m,_){var v=m[1],S=m[2],A=m[3],D=_[0],P=_[1];return d[0]=m[0]*D,d[1]=v*D,d[2]=S*P,d[3]=A*P,d})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.cO=j0,s.cP=tt,s.cQ=UA,s.cR=function(r){const e=UA(r,!0);return W([],[e[0],e[1],e[4],e[5]])},s.cS=Mt,s.cT=Lr,s.cU=cn,s.cV=function(r){const{x:e,y:i}=r.point,{lng:l,lat:d}=r._center;return N_(e,i,r.worldSize,l,d)},s.cW=it,s.cX=qe,s.cY=jd,s.cZ=Kl,s.c_=5,s.ca=cr,s.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.cc=He,s.cd=function(r,e,i,l,d){var m=1/Math.tan(e/2);if(r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0){var _=1/(l-d);r[10]=(d+l)*_,r[14]=2*d*l*_}else r[10]=-1,r[14]=-2*l;return r},s.ce=function(r,e,i,l,d,m,_){var v=1/(e-i),S=1/(l-d),A=1/(m-_);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+i)*v,r[13]=(d+l)*S,r[14]=(_+m)*A,r[15]=1,r},s.cf=Ze,s.cg=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.ch=Hr,s.ci=Fd,s.cj=fs,s.ck=Vo,s.cl=zh,s.cm=K2,s.cn=function(){var r=new B(4);return B!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.co=function(r,e,i){var l=e[0],d=e[1],m=e[2],_=e[3],v=Math.sin(i),S=Math.cos(i);return r[0]=l*S+m*v,r[1]=d*S+_*v,r[2]=l*-v+m*S,r[3]=d*-v+_*S,r},s.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cq=Wr,s.cr=function(r){var e=r[0],i=r[1],l=r[2],d=r[3];return Math.sqrt(e*e+i*i+l*l+d*d)},s.cs=ms,s.ct=_r,s.cu=O_,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Fa,s.d=function(r){return ts.API_TILEJSON_REGEX.test(r)},s.d$=class{constructor(r,e,i,l){this.context=r,this.format=l,this.size=i,this.texture=r.gl.createTexture();const[d,m,_]=this.size,{gl:v}=r;v.bindTexture(v.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,m,_,0,dw(this.format),fw(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_3D,this.texture),r!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,r),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.d0=function(r){return r*r*r*r*r},s.d1=ze,s.d2=45,s.d3=rs,s.d4=function(r,e,i){const l=Math.sqrt(r*r+e*e+i*i),d=l>0?Math.acos(i/l)*Lc:0;let m=r!==0||e!==0?Math.atan2(-e,-r)*Lc+90:0;return m<0&&(m+=360),[l,m,d]},s.d5=wt,s.d6=nr,s.d7=kt,s.d8=wn,s.d9=Ai,s.dA=function(r){return r({pluginStatus:Pa,pluginURL:nu}),Zp.on("pluginStateChange",r),r},s.dB=ho,s.dC=class extends xl{constructor(r){super(r),this.current=ix}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dD=oe,s.dE=function(r,e,i){const l=Fh(i.zoom),d=r.style.map._antialias,m=r.terrain&&r.terrain.exaggeration()>0;return l===0&&!d&&!m},s.dF=function(r){const e=r.pixelsPerMeter,i=e/Ze(1,r.center.lat),l=Ke(new Float64Array(16));return Ge(l,l,[r.point.x,r.point.y,0]),Mt(l,l,[i,i,e]),Float32Array.from(l)},s.dG=lm,s.dH=function(r){const e=80.051129;r=xe(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(oi(r))),3);return Math.round(i*(pe.length-1))},s.dI=function(r,e,i,l){const d=e.getNorth(),m=e.getSouth(),_=e.getWest(),v=e.getEast(),S=1<<r.z,A=v-_,D=d-m,P=A/re,k=-D/pe[i],F=[0,P,0,k,0,0,d,_,0];if(r.z>0){const U=180/l;he(F,F,[U/A+1,0,0,0,U/D+1,0,-.5*U/P,.5*U/k,1])}return F[2]=S,F[5]=r.x,F[8]=r.y,F},s.dJ=lu,s.dK=function(r,e,i){const l=Ke(new Float64Array(16)),d=(e/(1<<r)-.5)*Math.PI*2;return St(l,i.globeMatrix,d),Float32Array.from(l)},s.dL=g0,s.dM=Sg,s.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dO=Y,s.dP=function(r,e){var i=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=i,r[2]=0,r[3]=-i,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dQ=vi,s.dR=Mg,s.dS=Ti,s.dT=ur,s.dU=Hw,s.dV=function(r,e){const i=[0,0,0];return Cn(i,i,Cg(lu(e.canonical))),Cn(i,i,r),i},s.dW=r=>({u_matrix:new zh(r),u_texsize:new Vo(r),u_pixels_to_tile_units:new n(r),u_device_pixel_ratio:new fs(r),u_width_scale:new fs(r),u_floor_width_scale:new fs(r),u_image:new Hr(r),u_units_to_pixels:new Vo(r),u_tile_units_to_pixels:new fs(r),u_alpha_discard_threshold:new fs(r),u_trim_offset:new Vo(r),u_trim_fade_range:new Vo(r),u_trim_gradient_mix_range:new Vo(r),u_trim_color:new rs(r),u_zbias_factor:new fs(r),u_tile_to_meter:new fs(r),u_ground_shadow_factor:new Fd(r),u_pattern_transition:new fs(r)}),s.dX=r=>({u_matrix:new zh(r),u_pixels_to_tile_units:new n(r),u_device_pixel_ratio:new fs(r),u_width_scale:new fs(r),u_floor_width_scale:new fs(r),u_units_to_pixels:new Vo(r),u_dash_image:new Hr(r),u_gradient_image:new Hr(r),u_image_height:new fs(r),u_texsize:new Vo(r),u_tile_units_to_pixels:new fs(r),u_alpha_discard_threshold:new fs(r),u_trim_offset:new Vo(r),u_trim_fade_range:new Vo(r),u_trim_gradient_mix_range:new Vo(r),u_trim_color:new rs(r),u_zbias_factor:new fs(r),u_tile_to_meter:new fs(r),u_ground_shadow_factor:new Fd(r)}),s.dY=r=>({u_camera_to_center_distance:new fs(r),u_extrude_scale:new n(r),u_device_pixel_ratio:new fs(r),u_matrix:new zh(r),u_inv_rot_matrix:new zh(r),u_merc_center:new Vo(r),u_tile_id:new Fd(r),u_zoom_transition:new fs(r),u_up_dir:new Fd(r),u_emissive_strength:new fs(r)}),s.dZ=Yf,s.d_=yz,s.da=Kn,s.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.dc=jA,s.dd=vw,s.de=$A,s.df=Zw,s.dg=function(r,e){return r.readFields(g3,{icons:[]},e)},s.dh=N0,s.di=sy,s.dj=kw,s.dk=Er,s.dl=lg,s.dm=ma,s.dn=ro,s.dp=Ln,s.dq=function(r){const e=r.indexOf(Rd);return e>=0?r.slice(0,e):r},s.dr=function(r){return r.indexOf(Rd)>=0},s.ds=function(r){const e=r.lastIndexOf(Rd);return e>=0?r.slice(e+1):""},s.dt=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.du=function(r,e,i,l){return r.type==="custom"?new u3(r,e):new m3[r.type](r,e,i,l)},s.dv=bn,s.dw=function(r){const e=r.indexOf(Rd);return e>=0?r.slice(e+1):""},s.dx=class extends Qg{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.dy=Zp,s.dz=ga,s.e=ts,s.e$=Kt,s.e0=d0,s.e1=(r,e,i,l,d,m)=>{const _=r.transform,v=_.projection.name==="globe";let S;if(m.paint.get("circle-pitch-alignment")==="map")if(v){const D=Mg(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;S=Float32Array.from([D,0,0,D])}else S=_.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ja.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Y1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){A.u_inv_rot_matrix=l,A.u_merc_center=d,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Fh(_.zoom);const D=d[0]*jt,P=d[1]*jt;A.u_up_dir=_.projection.upVector(new Ac(0,0,0),D,P)}return A},s.e2=l2,s.e3=so,s.e4=(r,e,i,l,d,m,_,v,S,A)=>{const D=r.transform,P=D.pitch<15?s2(.07,.7,xe((14-D.zoom)/5,0,1)):.07,k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:o2(r,e,i,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:m,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:a2(e,D),u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:P,u_tile_to_meter:kt(e.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:A}},s.e5=(r,e,i,l,d,m,_,v,S,A)=>{const D=r.transform,P=D.calculatePixelsToTileUnitsMatrix(e),k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=D.pitch<15?s2(.07,.7,xe((14-D.zoom)/5,0,1)):.07;return{u_matrix:o2(r,e,i,l),u_pixels_to_tile_units:P,u_device_pixel_ratio:m,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:c2(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:a2(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:F,u_tile_to_meter:kt(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e6=It,s.e7=cm,s.e8=et,s.e9=Ud,s.eA=function(r,e){var i=2*Math.acos(e[3]),l=Math.sin(i/2);return l>V?(r[0]=e[0]/l,r[1]=e[1]/l,r[2]=e[2]/l):(r[0]=1,r[1]=0,r[2]=0),i},s.eB=Yw,s.eC=q0,s.eD=G0,s.eE=[1,1,1],s.eF=cy,s.eG=to,s.eH=function(r,e,i,l){var d=e[0],m=e[1],_=e[2],v=e[3];return r[0]=d+l*(i[0]-d),r[1]=m+l*(i[1]-m),r[2]=_+l*(i[2]-_),r[3]=v+l*(i[3]-v),r},s.eI=ty,s.eJ=nl,s.eK=Vu,s.eL=function(r,e,i,l,d,m,_,v,S,A,D,P,k,F,U,Z){var Q=new B(16);return Q[0]=r,Q[1]=e,Q[2]=i,Q[3]=l,Q[4]=d,Q[5]=m,Q[6]=_,Q[7]=v,Q[8]=S,Q[9]=A,Q[10]=D,Q[11]=P,Q[12]=k,Q[13]=F,Q[14]=U,Q[15]=Z,Q},s.eM=Ae,s.eN=kh,s.eO=Ld,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Dt(1/0,1/0),max:new Dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=g(new Dt(0,0),new Dt(jt,jt),r),l=[];if(e&&!ym(i,this._globalClipBounds))return l;for(const d of this._activeRegions){if(d.hiddenByOverlap||!ym(i,d))continue;const m=w(d.min,d.max,r);l.push({min:m.min,max:m.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return l}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const l of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(l).buckets[e.layer];d&&d.updateFootprints(l.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),l=r.getClipMask(),d=r.getClipScope();for(const m of e){if(!m.footprint)continue;const _=g(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:i,clipMask:l,clipScope:d})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||qg(e.min,i.min)||qg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(l,d){const m=(_,v)=>_+v;return l.length-d.length||l.reduce(m,"").localeCompare(d.reduce(m,""))})(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],l=this._prevRegions[e];r=i.priority!==l.priority||!L0(i,l)||i.order!==l.order||i.clipMask!==l.clipMask||!no(i.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==_m&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const l=this._activeRegions;if(i>=l.length)return i;const d=l[i].priority;for(;i<l.length&&l[i].priority===d;)++i;return i};if(this._sourceIds.length>1){let i=0,l=e(i);for(;i!==l;){let d=i;const m=i;for(;d!==l;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let v=0;v<m;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&_.order===_m&&ym(_,S)&&(_.hiddenByOverlap=j(_.footprint,_.tileId,S.footprint,S.tileId),_.hiddenByOverlap))break}++d}i=l,l=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eQ=_m,s.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new iu,l=new vs,d=[],m=r+1+2,_=e[0]+1,v=e[0]+1+(1+e.length),S=(A,D,P)=>{let k=A===m-1?A-2:A===0?A:A-1;return k+=P?24575:0,[k,D]};for(let A=0;A<m;++A)i.emplaceBack(...S(A,0,!0));for(let A=0;A<_;++A)for(let D=0;D<m;++D)i.emplaceBack(...S(D,A,(D===0||D===m-1)&&!0));for(let A=0;A<e.length;++A){const D=e[A];for(let P=0;P<m;++P)i.emplaceBack(...S(P,D,!0))}for(let A=0;A<e.length;++A){const D=l.length,P=e[A]+1+2,k=new vs;for(let Z=0;Z<P-1;Z++){const Q=Z===P-2,X=Q?m*(v-e.length+A-Z):m;for(let te=0;te<m-1;te++){const se=Z*m+te;Z===0||Q||te===0||te===m-2?(k.emplaceBack(se+1,se,se+X),k.emplaceBack(se+X,se+X+1,se+1)):(l.emplaceBack(se+1,se,se+X),l.emplaceBack(se+X,se+X+1,se+1))}}const F=fr.simpleSegment(0,D,i.length,l.length-D);for(let Z=0;Z<k.uint16.length;Z+=3)l.emplaceBack(k.uint16[Z],k.uint16[Z+1],k.uint16[Z+2]);const U=fr.simpleSegment(0,D,i.length,l.length-D);d.push({withoutSkirts:F,withSkirts:U})}return{vertices:i,indices:l,segments:d}}_createGrid(r){const e=this._fillGridMeshWithLods(re,pe);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,sx.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new vs;for(let _=0;_<=re;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Fu,l=new Fu,d=new Fu,m=new Fu;this._poleSegments=[];for(let _=0,v=0;_<5;_++){const S=360/(1<<_);i.emplaceBack(0,-ee,0,.5,0),l.emplaceBack(0,-ee,0,.5,1),d.emplaceBack(0,-ee,0,.5,.5),m.emplaceBack(0,-ee,0,.5,.5);for(let A=0;A<=re;A++){let D=A/re,P=0;const k=Rn(0,S,D),[F,U,Z]=Ie(X1,h0,k,ee);i.emplaceBack(F,U,Z,D,P),l.emplaceBack(F,U,Z,D,1-P);const Q=oi(k);D=.5+.5*Math.sin(Q),P=.5+.5*Math.cos(Q),d.emplaceBack(F,U,Z,D,P),m.emplaceBack(F,U,Z,D,1-P)}this._poleSegments.push(fr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Gd,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,Gd,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(d,Gd,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(m,Gd,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eS=Cx,s.eT=ye,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=Pe,s.eW=yt,s.eX=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},s.eY=yr,s.eZ=Te,s.e_=ki,s.ea=cu,s.eb=fA,s.ec=di,s.ed=450,s.ee=7,s.ef=rt,s.eg=function(r,e){if(r===e){var i=e[1],l=e[2],d=e[3],m=e[6],_=e[7],v=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=l,r[9]=m,r[11]=e[14],r[12]=d,r[13]=_,r[14]=v}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.eh=c3,s.ei=ti,s.ej=_g,s.ek=256,s.el=or,s.em=tl,s.en=St,s.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.ep=Fu,s.eq=eg,s.er=kd,s.es=function(r,e,i,l,d){return xe((r-e)/(i-e)*(d-l)+l,l,d)},s.et=Li,s.eu=function(r,e){var i=e[0],l=e[1],d=e[2],m=e[3],_=e[4],v=e[5],S=e[6],A=e[7],D=e[8],P=D*_-v*A,k=-D*m+v*S,F=A*m-_*S,U=i*P+l*k+d*F;return U?(r[0]=P*(U=1/U),r[1]=(-D*l+d*A)*U,r[2]=(v*l-d*_)*U,r[3]=k*U,r[4]=(D*i-d*S)*U,r[5]=(-v*i+d*m)*U,r[6]=F*U,r[7]=(-A*i+l*S)*U,r[8]=(_*i-l*m)*U,r):null},s.ev=2,s.ew=er,s.ex=en,s.ey=Je,s.ez=function(r,e){var i=new B(3);Je(i,e);var l=1/i[0],d=1/i[1],m=1/i[2],_=e[0]*l,v=e[1]*d,S=e[2]*m,A=e[4]*l,D=e[5]*d,P=e[6]*m,k=e[8]*l,F=e[9]*d,U=e[10]*m,Z=_+D+U,Q=0;return Z>0?(Q=2*Math.sqrt(Z+1),r[3]=.25*Q,r[0]=(P-F)/Q,r[1]=(k-S)/Q,r[2]=(v-A)/Q):_>D&&_>U?(Q=2*Math.sqrt(1+_-D-U),r[3]=(P-F)/Q,r[0]=.25*Q,r[1]=(v+A)/Q,r[2]=(k+S)/Q):D>U?(Q=2*Math.sqrt(1+D-_-U),r[3]=(k-S)/Q,r[0]=(v+A)/Q,r[1]=.25*Q,r[2]=(P+F)/Q):(Q=2*Math.sqrt(1+U-_-D),r[3]=(v-A)/Q,r[0]=(k+S)/Q,r[1]=(P+F)/Q,r[2]=.25*Q),r},s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.f0=function([r,e,i]){const l=Math.hypot(r,e,i),d=Math.atan2(r,i),m=.5*Math.PI-Math.acos(-e/l);return new ge(qe(d),qe(m))},s.f1=rc,s.f2=mw,s.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(ui==null){const l=i.navigator?i.navigator.userAgent:null;ui=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ui})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(r,e){nd=r,nh=e},s.f5=np,s.f6=B_,s.f7=function(r){const e=[0,0,0],i=Ke(new Float64Array(16));return nt(i,r.pixelMatrix,r.globeMatrix),Cn(e,e,i),new Dt(e[0],e[1])},s.f8=function(){const r=Dx;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(aw),Dx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){N0().acquire(aw)},s.fA=mb,s.fB=ni,s.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==zA){const i=new Uint32Array(r,0,7),[,,l,d,m,_]=i;e=i.byteLength+d+m+_+m,(l!==r.byteLength||e>=r.byteLength)&&kn("Invalid b3dm header information.")}return VA(r,e)},s.fD=function(r,e){const i=vw(r);for(const l of i){for(const d of l.meshes)VO(d);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(jO(l.lights,e)))}return i},s.fE=ub,s.fF=vr,s.fG=SA,s.fH=No,s.fI=Za,s.fJ=function(r){As(),Ss!=null&&Ss.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-r;l++)e.delete(i[l]).catch(d=>kn(d.message))}).catch(i=>kn(i.message))}).catch(e=>kn(e.message))},s.fa=Ou,s.fb=function(r,e,i=!1){if(Pa===Za.deferred||Pa===Za.loading||Pa===Za.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");nu=ja.resolveURL(r),Pa=Za.deferred,tu=e,cg(),i||Wp()},s.fc=function(r){Q_=ja.resolveURL(r),J_||(J_=new K_(N0(),new pl)),J_.broadcast("setMeshoptUrl",Q_)},s.fd=CA,s.fe=function(r){cw=ja.resolveURL(r),J_||(J_=new K_(N0(),new pl)),J_.broadcast("setDracoUrl",cw)},s.ff=IA,s.fg=Mx,s.fh=function(r){const e=Eo();if(!e)return;const i=e.delete(pf);r&&i.then(()=>r()).catch(r)},s.fi=$g,s.fj=Ft,s.fk=Gu,s.fl=2,s.fm=tC,s.fn=nC,s.fo=t2,s.fp=ci,s.fq="hd_road_elevation",s.fr=la,s.fs=yn,s.ft=qu,s.fu=Pw,s.fv=1,s.fw=function(r,e,i,l,d,m,_,v=1,S,A,D,P){r.createArrays(),r.tilePixelRatio=jt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const k=r.layers[0].layout,F=r.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=v,U.textSizeScaleRange=k.get("text-size-scale-range"),U.iconSizeScaleRange=k.get("icon-size-scale-range");const[Z,Q]=U.textSizeScaleRange,[X,te]=U.iconSizeScaleRange;U.textScaleFactor=xe(U.scaleFactor,Z,Q),U.iconScaleFactor=xe(U.scaleFactor,X,te);const se=F["text-size"],le=F["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:De,maxZoom:Ne}=r.textSizeData;U.compositeTextSizes=[se.possiblyEvaluate(new Mi(De,{worldview:D}),m),se.possiblyEvaluate(new Mi(Ne,{worldview:D}),m)]}if(r.iconSizeData.kind==="composite"){const{minZoom:De,maxZoom:Ne}=r.iconSizeData;U.compositeIconSizes=[le.possiblyEvaluate(new Mi(De,{worldview:D}),m,P),le.possiblyEvaluate(new Mi(Ne,{worldview:D}),m,P)]}U.layoutTextSize=se.possiblyEvaluate(new Mi(_+1,{worldview:D}),m),U.layoutIconSize=le.possiblyEvaluate(new Mi(_+1,{worldview:D}),m,P),U.textMaxSize=se.possiblyEvaluate(new Mi(18,{worldview:D}),m);const _e=k.get("symbol-placement"),me=k.get("text-rotation-alignment")==="map"&&_e!=="point",Ee=k.get("text-size");let Se=!1;const we=[];for(const De of r.features){const Ne=k.get("text-font").evaluate(De,{},m).join(","),pt=Ee.evaluate(De,{},m)*U.textScaleFactor,ct=U.layoutTextSize.evaluate(De,{},m)*U.textScaleFactor,dt=U.layoutIconSize.evaluate(De,{},m,P)*U.iconScaleFactor,Tt={horizontal:{},vertical:void 0},vt=De.text;let bt,ot=[0,0];if(vt){const yi=vt.toString(),os=k.get("text-letter-spacing").evaluate(De,{},m)*ua,wi=k.get("text-line-height").evaluate(De,{},m)*ua,ji=R_(yi)?os:0,Tr=k.get("text-anchor").evaluate(De,{},m),zr=k.get("text-variable-anchor");if(!zr){const Ls=k.get("text-radial-offset").evaluate(De,{},m);if(Ls)ot=N2(Tr,[Ls*ua,Ow]);else{const Hs=k.get("text-offset").evaluate(De,{},m);ot=[Hs[0]*ua,Hs[1]*ua]}}let Nr=me?"center":k.get("text-justify").evaluate(De,{},m);const ls=_e==="point",Ta=ls?k.get("text-max-width").evaluate(De,{},m)*ua:1/0,Xa=Ls=>{r.allowVerticalPlacement&&$p(yi)&&(Tt.vertical=Iw(vt,e,i,d,Ne,Ta,wi,Tr,Ls,ji,ot,ec.vertical,!0,ct,pt,S))};if(!me&&zr){const Ls=Nr==="auto"?zr.map(ta=>zw(ta)):[Nr];let Hs=!1;for(let ta=0;ta<Ls.length;ta++){const Yn=Ls[ta];if(!Tt.horizontal[Yn])if(Hs)Tt.horizontal[Yn]=Tt.horizontal[0];else{const Br=Iw(vt,e,i,d,Ne,Ta,wi,"center",Yn,ji,ot,ec.horizontal,!1,ct,pt,S);Br&&(Tt.horizontal[Yn]=Br,Hs=Br.positionedLines.length===1)}}Xa("left")}else{if(Nr==="auto"&&(Nr=zw(Tr)),ls||k.get("text-writing-mode").indexOf("horizontal")>=0||!$p(yi)){const Ls=Iw(vt,e,i,d,Ne,Ta,wi,Tr,Nr,ji,ot,ec.horizontal,!1,ct,pt,S);Ls&&(Tt.horizontal[Nr]=Ls)}Xa(ls?"left":Nr)}}let At,_t,Ct,Et,nn,rn,$t=!1;const Wt=k.get("icon-text-fit").evaluate(De,{},m);if(De.icon&&De.icon.hasPrimary()){const yi=jx(De.icon,r.iconSizeData,F["icon-size"],m,r.zoom,De,S,U.iconScaleFactor,D,P);At=yi.iconPrimary,Ct=yi.iconSecondary;const os=At.toString();if(_t=l.get(os),_t&&(nn=k.get("icon-offset").evaluate(De,{},m),rn=k.get("icon-anchor").evaluate(De,{},m),bt=X0(d.get(os),Ct?d.get(Ct.toString()):void 0,nn,rn),$t=_t.sdf,r.sdfIcons===void 0?r.sdfIcons=_t.sdf:r.sdfIcons!==_t.sdf&&kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==r.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ct){const wi=Ct.toString();Et=l.get(wi)}}Se=Se||!(!De.icon||!De.icon.hasSecondary());const An=eb(Tt.horizontal)||Tt.vertical;r.iconsInText||(r.iconsInText=!!An&&An.iconsInText);const _n=ct*U.textScaleFactor/ua,{defaultShapedIcon:Jt,verticallyShapedIcon:Bn}=Xz(r,bt,k,De,m,Tt,_n,nn,Wt);Wt!=="none"&&bt&&(b2(bt)||w2(bt))&&(J0(0,_t,At,bt,Jt,Wt,A,l,d),J0(0,Et,Ct,bt,Jt,Wt,A,l,d),Bn&&(J0(0,_t,At,bt,Bn,Wt,A,l,d),J0(0,Et,Ct,bt,Bn,Wt,A,l,d))),bt=Jt;const{iconBBox:ri,iconVerticalBBox:Ri,textBBox:Jn,textVerticalBBox:Zi}=qz(r,bt,Bn,k,De,m,dt,nn,U,d,rn,Tt,ct,ot,P);we.push({feature:De,shapedTextOrientations:Tt,shapedText:An,shapedIcon:bt,iconPrimary:At,iconSecondary:Ct,iconOffset:nn,iconAnchor:rn,verticallyShapedIcon:Bn,layoutTextSize:ct,layoutIconSize:dt,textOffset:ot,isSDFIcon:$t,iconTextFit:Wt,iconCollisionBounds:ri,iconVerticalCollisionBounds:Ri,textCollisionBounds:Jn,textVerticalCollisionBounds:Zi})}return{featureData:we,sizes:U,hasAnySecondaryIcon:Se,textAlongLine:me,symbolPlacement:_e}},s.fx=M2,s.fy=function(r,e,i,l,d,m,_,v,S,A){r.iconAtlasPositions=A.iconPositions;const{featureData:D,hasAnySecondaryIcon:P,sizes:k,textAlongLine:F,symbolPlacement:U}=e;for(const Z of D){const{shapedIcon:Q,verticallyShapedIcon:X,feature:te,shapedTextOrientations:se,shapedText:le,layoutTextSize:_e,textOffset:me,isSDFIcon:Ee,iconPrimary:Se,iconSecondary:we,iconTextFit:De,iconOffset:Ne,iconCollisionBounds:pt,iconVerticalCollisionBounds:ct,textCollisionBounds:dt}=Z;j2(Q,A.iconPositions,Se,we),j2(X,A.iconPositions,Se,we),Wz(se,A.iconPositions),Zz(Se,we,A.iconPositions),(le||Q)&&Yz(r,te,se,Q,X,S,k,_e,0,me,Ee,l,d,_,v,P,De,Ne,F,U,pt,ct,dt)}i&&r.generateCollisionDebugBuffers(m,r.collisionBoxArray,k.textScaleFactor)},s.fz=pi,s.g=function(r,e){return ga(Object.assign(r,{method:"GET"}),e)},s.h=function(r){return r.indexOf("mapbox:")===0},s.i=function(r){return ts.API_STYLE_REGEX.test(r)&&!Ts(r)},s.j=hr,s.k=Ca,s.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(r,e){return ga(Object.assign(r,{type:"json"}),e)},s.n=Co,s.o=ja,s.p=function(r,e){return ga(Object.assign(r,{method:"POST"}),e)},s.q=ea,s.r=To,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return ow||(ow=new $g("ImageRasterizer")),ow},s.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=kn,s.x=eT,s.y=Fc,s.z=Mo}),T(["./shared"],function(s){function V(qe){const ne=qe?qe.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function B(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let oe="[";for(const ye of qe)oe+=`${B(ye)},`;return`${oe}]`}let ne="{";for(const oe of Object.keys(qe).sort())ne+=`${oe}:${B(qe[oe])},`;return`${ne}}`}function W(qe){let ne="";for(const oe of s.bx)ne+=`/${B(qe[oe])}`;return ne}function Y(qe,ne){return(function oe(ye){return typeof ye=="string"&&ye===ne||(Array.isArray(ye)?ye.some(oe):!(!ye||typeof ye!="object")&&Object.values(ye).some(oe))})(qe)}class ae{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,oe){this._layerConfigs={},this._layers={},this.update(ne,[],oe)}update(ne,oe,ye){this._options=ye;for(const xe of ne)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=s.du(xe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of oe)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Pe=(function(xe,Fe){const st={};for(let lt=0;lt<xe.length;lt++){const Pt=xe[lt];let It=Fe&&Fe[Pt.id];It||(Pt.type==="symbol"?It=Pt.id:(It=W(Pt),Pt.type==="line"&&Pt.paint&&Y(Pt.paint["line-width"],"line-progress")&&(It+=`/${B(Pt.paint["line-width"])}`))),Fe&&(Fe[Pt.id]=It);let tn=st[It];tn||(tn=st[It]=[]),tn.push(Pt)}const $e=[];for(const lt in st)$e.push(st[lt]);return $e})(Object.values(this._layerConfigs),this.keyCache);for(const xe of Pe){const Fe=xe.map(tn=>this._layers[tn.id]),st=Fe[0];if(st.visibility==="none")continue;const $e=st.source||"";let lt=this.familiesBySource[$e];lt||(lt=this.familiesBySource[$e]={});const Pt=st.sourceLayer||"_geojsonTileLayer";let It=lt[Pt];It||(It=lt[Pt]=[]),It.push(Fe)}}}const he=1*s.fl;class Qe{constructor(ne){const oe={},ye=[];for(const st in ne){const $e=ne[st],lt=oe[st]={};for(const Pt in $e.glyphs){const It=$e.glyphs[+Pt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const tn=It.metrics.localGlyph?he:1,yn={x:0,y:0,w:It.bitmap.width+2*tn,h:It.bitmap.height+2*tn};ye.push(yn),lt[Pt]=yn}}const{w:Pe,h:xe}=s.G(ye),Fe=new s.fk({width:Pe||1,height:xe||1});for(const st in ne){const $e=ne[st];for(const lt in $e.glyphs){const Pt=$e.glyphs[+lt];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const It=oe[st][lt],tn=Pt.metrics.localGlyph?he:1;s.fk.copy(Pt.bitmap,Fe,{x:0,y:0},{x:It.x+tn,y:It.y+tn},Pt.bitmap)}}this.image=Fe,this.positions=oe}}function Ye(qe,ne,oe){qe[ne]?oe&&(qe[ne].center=oe):qe[ne]={floorIds:new Set,center:oe||[0,0],floors:{}}}function Ke(qe,ne,oe,ye){for(const Pe of ne)Ye(qe,Pe),qe[Pe].floors[oe]=ye,qe[Pe].floorIds.add(oe)}function at(qe){return{id:qe.properties.id.toString(),center:qe.properties.center.toString().split(";").map(Number)}}function nt(qe){return{id:qe.properties.id.toString(),isDefault:!!qe.properties.is_default&&qe.properties.is_default,connections:qe.properties.connected_floor_ids?new Set(qe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:qe.properties.conflicted_floor_ids?new Set(qe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:qe.properties.building_ids?new Set(qe.properties.building_ids.toString().split(";")):new Set,name:qe.properties.name.toString(),zIndex:qe.properties.z_index}}function Ge(qe,ne){return ne.every(oe=>qe.properties&&qe.properties[oe]!=null)}function Mt(qe){return Ge(qe,["type","id","name"])&&qe.properties.type==="building"}function cn(qe){return Ge(qe,["type","id","name","z_index"])&&qe.properties.type==="floor"}s.fj(Qe,"GlyphAtlas");class St{constructor(ne){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,oe,ye,Pe,xe,Fe){this.status="parsing",this.data=ne,this.collisionBoxArray=new s.b3;const st=new s.fm(Object.keys(ne.layers).sort()),$e=new s.fn(this.tileID,this.promoteId);$e.bucketLayerIDs=[];const lt={},Pt=new s.fo(256,256),It={featureIndex:$e,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Pt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Ln=this.indoor.indoorState.activeFloorsVisible,Vn=(function(vn,kn,$i){const xr=(function(ir,ui){if(!ir)return s.w("No source layers defined in indoor specification"),ui;if(ir.size===0)return ui;const cr=ir.difference(ui);for(const Oi of cr)s.w(`Missing source layer required in indoor specification: ${Oi}`);return ui.intersection(ui)})(kn.sourceLayers,new Set(Object.keys(vn.layers))),nr=kn.indoorState,vr=(function(ir,ui,cr,Oi){const gi=new Set,Ti=new Set,ur=new Set,es=new Map,ts={},hr=Ts=>{const Es=es.get(Ts)||new Set;for(const pa of gi)if((es.get(pa)||new Set).has(Ts)||Es.has(pa))return!0;return!1};for(const Ts of ui){const Es=ir.layers[Ts];if(Es)for(let pa=0;pa<Es.length;pa++){const ys=Es.feature(pa);if(Mt(ys)){const{id:ra,center:sa}=at(ys);Ye(ts,ra,sa),gi.add(ra);continue}if(cn(ys)){const{id:ra,isDefault:sa,connections:$o,conflicts:To,buildings:ja,name:dl,zIndex:ma}=nt(ys);Ke(ts,ja,ra,{name:dl,zIndex:ma}),es.set(ra,To),(ra===Oi||$o.has(Oi))&&gi.add(ra),Ti.add(ra),sa&&ur.add(ra)}}else s.w(`indoor source layer not found: ${Ts}`)}if(cr)for(const Ts of cr)Ti.has(Ts)&&(hr(Ts)||gi.add(Ts));for(const Ts of ur)gi.has(Ts)||hr(Ts)||gi.add(Ts);return{buildings:ts,activeFloors:gi}})(vn,xr,nr.lastActiveFloors,nr.selectedFloorId);return $i.send("setIndoorData",vr),vr})(ne,this.indoor,xe);It.activeFloors=Ln?Vn.activeFloors:void 0}const tn=[],yn=oe.familiesBySource[this.source];for(const Ln in yn){const Vn=ne.layers[Ln];if(!Vn)continue;let vn=!1,kn=!1,$i=!1;for(const ui of yn[Ln])ui[0].type==="symbol"?vn=!0:kn=!0,ui[0].is3D()&&ui[0].type!=="model"&&($i=!0);if(this.extraShadowCaster&&!$i||this.isSymbolTile===!0&&!vn||this.isSymbolTile===!1&&!kn)continue;Vn.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xr=st.encode(Ln),nr=[],vr=this.localizableLayerIds&&this.localizableLayerIds.has(Ln);let ir=!1;for(let ui=0,cr=0;ui<Vn.length;ui++){const Oi=Vn.feature(ui),gi=$e.getId(Oi,Ln),Ti=Oi.properties?Oi.properties.worldview:null;if(vr&&this.worldview&&typeof Ti=="string")if(Ti==="all")Oi.properties.$localized=!0;else{if(!Ti.split(",").includes(this.worldview))continue;Oi.properties.$localized=!0,Oi.properties.worldview=this.worldview}!ir&&Oi.properties&&Oi.properties.hasOwnProperty(s.fp)&&(ir=!0),nr.push({feature:Oi,id:gi,index:cr,sourceLayerIndex:xr}),cr++}ir&&!It.elevationFeatures&&ne.layers.hasOwnProperty(s.fq)&&(It.elevationFeatures=s.fr.parseFrom(ne.layers[s.fq],this.canonical));for(const ui of yn[Ln]){const cr=ui[0];if(this.extraShadowCaster&&(!cr.is3D()||cr.type==="model")||this.isSymbolTile!==void 0&&cr.type==="symbol"!==this.isSymbolTile||cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility==="none")continue;Oe(ui,this.zoom,It.brightness,ye,this.worldview);const Oi=lt[cr.id]=cr.createBucket({index:$e.bucketLayerIDs.length,layers:ui,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Pe,worldview:this.worldview,localizable:vr,availableImages:ye});$e.bucketLayerIDs.push(ui.map(Ti=>s.B(Ti.id,Ti.scope)));let gi=Oi.prepare?Oi.prepare():null;gi!=null?(gi=gi.then(()=>Oi.populate(nr,It,this.tileID.canonical,this.tileTransform)),tn.push(gi)):Oi.populate(nr,It,this.tileID.canonical,this.tileTransform)}}const bn=()=>{let Ln,Vn,vn,kn,$i,xr;Pt.trim();const nr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},vr=()=>{if(Ln)return this.status="done",Fe(Ln);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(lt).filter(ui=>!ui.isEmpty()),featureIndex:$e,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:It.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vn&&vn&&kn){const ui=new Qe(Vn),cr=new Map;for(const[Ti,ur]of vn.entries()){const{imagePosition:es}=s.fu(Ti,ur,s.fv);cr.set(Ti,es)}const Oi={};for(const Ti in lt){const ur=lt[Ti];ur instanceof s.b4&&(Oe(ur.layers,this.zoom,It.brightness,ye,this.worldview),Oi[Ti]=s.fw(ur,Vn,ui.positions,vn,cr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,$i,this.worldview,ye))}const gi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,vn,$i,()=>{gi.iconsPending=!1,ir(Oi,ui,gi)}),this.rasterizeIfNeeded(xe,kn,xr,()=>{gi.patternsPending=!1,ir(Oi,ui,gi)})}},ir=(ui,cr,Oi,gi)=>{if(Oi.iconsPending||Oi.patternsPending)return;const Ti=new s.fx(vn,kn,this.lut);for(const ur in lt){const es=lt[ur];if(ur in ui)s.fy(es,ui[ur],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,vn,Ti);else if(es.hasPattern&&(es instanceof s.ba||es instanceof s.bb||es instanceof s.ea)){Oe(es.layers,this.zoom,It.brightness,ye,this.worldview);const ts=Object.fromEntries(Ti.patternPositions);es.addFeatures(It,this.tileID.canonical,ts,ye,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(lt).filter(ur=>!ur.isEmpty()),featureIndex:$e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cr.image,lineAtlas:Pt,imageAtlas:Ti,brightness:It.brightness})};if(!this.extraShadowCaster){const ui=s.fs(It.glyphDependencies,gi=>Object.keys(gi).map(Number));Object.keys(ui).length?xe.send("getGlyphs",{uid:this.uid,stacks:ui},(gi,Ti)=>{Ln||(Ln=gi,Vn=Ti,vr())},void 0,!1,nr):Vn={};const cr=Array.from(It.iconDependencies.keys()).map(gi=>s.I.parse(gi));cr.length?xe.send("getImages",{images:cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gi,Ti)=>{Ln||(Ln=gi,vn=new Map,$i=this.updateImageMapAndGetImageTaskQueue(vn,Ti,It.iconDependencies),vr())},void 0,!1,nr):(vn=new Map,$i=new Map);const Oi=Array.from(It.patternDependencies.keys()).map(gi=>s.I.parse(gi));Oi.length?xe.send("getImages",{images:Oi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gi,Ti)=>{Ln||(Ln=gi,kn=new Map,xr=this.updateImageMapAndGetImageTaskQueue(kn,Ti,It.patternDependencies),vr())},void 0,!1,nr):(kn=new Map,xr=new Map)}if(It.elevationFeatures&&It.elevationFeatures.length>0){const ui=[];for(const Oi of Object.values(lt))if(Oi instanceof s.bb){const gi=Oi.getUnevaluatedPortalGraph();gi&&ui.push(gi)}const cr=s.ft.evaluate(ui);for(const Oi of Object.values(lt))if(Oi instanceof s.bb){const gi=ne.layers[st.decode(Oi.sourceLayerIndex)];Oi.setEvaluatedPortalGraph(cr,gi,this.tileID.canonical,It.availableImages,It.brightness)}}vr()};tn.length>0?Promise.allSettled(tn).then(bn).catch(Fe):bn()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,oe,ye,Pe){Array.from(oe.values()).some(xe=>xe.usvg)?this.rasterize(ne,oe,ye,Pe):Pe()}updateImageMapAndGetImageTaskQueue(ne,oe,ye){const Pe=new Map;for(const xe of oe.keys()){const Fe=ye.get(xe)||[];for(const st of Fe){const $e=st.toString(),lt=oe.get(st.id.toString());lt.usvg?Pe.has($e)||(Pe.set($e,st),ne.set($e,Object.assign({},lt))):ne.set($e,lt)}}return Pe}rasterize(ne,oe,ye,Pe){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ye},(xe,Fe)=>{if(!xe)for(const[st,$e]of Fe.entries()){const lt=Object.assign(oe.get(st),{data:$e});oe.set(st,lt)}Pe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Oe(qe,ne,oe,ye,Pe){const xe=new s.ac(ne,{brightness:oe,worldview:Pe});for(const Fe of qe)Fe.recalculate(xe,ye)}class Re extends s.E{constructor(ne,oe,ye,Pe,xe,Fe,st){super(),this.actor=ne,this.layerIndex=oe,this.availableImages=ye,this.availableModels=Pe,this.loadVectorData=Fe||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ne.scheduler),this.isSpriteLoaded=xe,this.scheduler=ne.scheduler,this.brightness=st}loadTile(ne,oe){const ye=ne.uid,Pe=ne&&ne.request,xe=Pe&&Pe.collectResourceTiming,Fe=this.loading[ye]=new St(ne);Fe.abort=this.loadVectorData(ne,(st,$e)=>{const lt=!this.loading[ye];if(delete this.loading[ye],Fe.cancelRasterize(),lt||st||!$e)return Fe.status="done",lt||(this.loaded[ye]=Fe),oe(st);const Pt=$e.rawData,It={},tn=s.aM($e.responseHeaders);tn&&tn.expires&&(It.expires=tn.expires),tn&&tn.cacheControl&&(It.cacheControl=tn.cacheControl),Fe.vectorTile=$e.vectorTile||new s.fz(new s.bt(Pt));const yn=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(bn,Ln)=>{if(bn||!Ln)return oe(bn);const Vn={};if(xe){const vn=V(Pe);vn.length>0&&(Vn.resourceTiming=JSON.parse(JSON.stringify(vn)))}oe(null,Object.assign({rawTileData:Pt.slice(0),responseHeaders:$e.responseHeaders},Ln,It,Vn))})};this.isSpriteLoaded?yn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yn,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):yn()}),this.loaded=this.loaded||{},this.loaded[ye]=Fe})}reloadTile(ne,oe){const ye=this.loaded,Pe=ne.uid;if(ye&&ye[Pe]){const xe=ye[Pe];xe.updateParameters(ne);const Fe=(st,$e)=>{const lt=xe.reloadCallback;lt&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,lt)),oe(st,$e)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else oe(null,void 0)}abortTile(ne,oe){const ye=ne.uid,Pe=this.loading[ye];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[ye]),oe()}removeTile(ne,oe){const ye=this.loaded,Pe=ne.uid;ye&&ye[Pe]&&delete ye[Pe],oe()}}class Ve{loadTile(ne,oe){const{uid:ye,encoding:Pe,rawImageData:xe,padding:Fe}=ne,st=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Fe):xe;oe(null,new s.fA(ye,st,Pe,Fe<1))}reloadTile(ne,oe){oe(null,null)}abortTile(ne,oe){oe()}removeTile(ne,oe){oe()}getImageData(ne,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ye=this.offscreenCanvasContext.getImageData(-oe,-oe,ne.width+2*oe,ne.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}s.bs.setPbf(s.bt);class Je{constructor(ne){this._mrt=new s.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,oe){const ye=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ye.parseHeader(ne),this._isHeaderLoaded=!0;const Pe=[];for(const xe in ye.layers){const Fe=ye.getLayer(xe),st=Fe.getDataRange(Fe.getBandList()),$e=ye.createDecodingTask(st),lt=ne.slice(st.firstByte,st.lastByte+1),Pt=s.bs.performDecoding(lt,$e).then(It=>$e.complete(null,It)).catch(It=>$e.complete(It,null));Pe.push(Pt)}Promise.allSettled(Pe).then(()=>oe(null,ye)).catch(xe=>oe(xe))}catch(Pe){oe(Pe)}}}class He{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,oe){const ye=ne.uid,Pe=ne.request,xe=this.loading[ye]=new Je(ne),{cancel:Fe}=s.bu(Pe,(st,$e,lt)=>{const Pt=!this.loading[ye];if(delete this.loading[ye],Pt||st||!$e)return xe.status="done",Pt||(this.loaded[ye]=xe),oe(st);xe.parse($e,(It,tn)=>{if(It||!tn)return oe(It);oe(null,tn,lt)}),this.loaded[ye]=xe});xe.abort=Fe}reloadTile(ne,oe){oe(null,void 0)}abortTile(ne,oe){const ye=ne.uid,Pe=this.loading[ye];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[ye]),oe()}removeTile(ne,oe){const ye=ne.uid;this.loaded[ye]&&delete this.loaded[ye],oe()}decodeRasterArray(ne,oe){s.bs.performDecoding(ne.buffer,ne.task).then(ye=>oe(null,ye)).catch(ye=>oe(ye))}}const tt=s.fB.prototype.toGeoJSON;class ve{constructor(ne){this._feature=ne,this.extent=s.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const oe of this._feature.geometry)ne.push([new s.P(oe[0],oe[1])]);return ne}{const ne=[];for(const oe of this._feature.geometry){const ye=[];for(const Pe of oe)ye.push(new s.P(Pe[0],Pe[1]));ne.push(ye)}return ne}}toGeoJSON(ne,oe,ye){return tt.call(this,ne,oe,ye)}}class Ht{constructor(ne,oe){this.name=ne,this.extent=s.al,this.length=oe.length,this._jsonFeatures=oe}feature(ne){return new ve(this._jsonFeatures[ne])}}class dn{constructor(ne){this.layers={},this.extent=s.al;for(const oe of Object.keys(ne))this.layers[oe]=new Ht(oe,ne[oe])}}const wt=64/4096;class Kt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],oe){for(const ye of ne){const Pe=ye.id;if(Pe==null)continue;let xe=this.features.get(Pe);xe&&this.updateCache(xe,oe),ye.geometry?(xe=Kn(ye),this.updateCache(xe,oe),this.features.set(Pe,xe)):this.features.delete(Pe),this.updateCache(xe,oe)}}updateCache(ne,oe){for(const{canonical:ye,uid:Pe}of Object.values(oe)){const{z:xe,x:Fe,y:st}=ye;wn(ne,Math.pow(2,xe),Fe,st)&&delete oe[Pe]}}getTile(ne,oe,ye){const Pe=Math.pow(2,ne),xe=[];for(const Fe of this.features.values())wn(Fe,Pe,oe,ye)&&xe.push(Be(Fe,Pe,oe,ye));return{features:xe}}getFeatures(){return[...this.features.values()]}}function wn({minX:qe,minY:ne,maxX:oe,maxY:ye},Pe,xe,Fe){return qe<(xe+1+wt)/Pe&&ne<(Fe+1+wt)/Pe&&oe>(xe-wt)/Pe&&ye>(Fe-wt)/Pe}function Kn(qe){const{id:ne,geometry:oe,properties:ye}=qe;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Pe,coordinates:xe}=oe,Fe={id:ne,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},st=Fe.geometry;if(Pe==="Point")it(xe,st,Fe);else if(Pe==="MultiPoint")for(const $e of xe)it($e,st,Fe);else if(Pe==="LineString")Fe.type=2,ft(xe,st,Fe);else if(Pe==="MultiLineString")Fe.type=2,Qt(xe,st,Fe);else if(Pe==="Polygon")Fe.type=3,Qt(xe,st,Fe,!0);else{if(Pe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const $e of xe)Qt($e,st,Fe,!0)}return Fe}function it([qe,ne],oe,ye){const Pe=s.aF(qe);let xe=s.aJ(ne);xe=xe<0?0:xe>1?1:xe,oe.push(Pe,xe),ye.minX=Math.min(ye.minX,Pe),ye.minY=Math.min(ye.minY,xe),ye.maxX=Math.max(ye.maxX,Pe),ye.maxY=Math.max(ye.maxY,xe)}function ft(qe,ne,oe,ye=!1,Pe=!1){const xe=[];for(const Fe of qe)it(Fe,xe,oe);ne.push(xe),ye&&(function(Fe,st){let $e=0;for(let lt=0,Pt=Fe.length,It=Pt-2;lt<Pt;It=lt,lt+=2)$e+=(Fe[lt]-Fe[It])*(Fe[lt+1]+Fe[It+1]);if($e>0===st)for(let lt=0,Pt=Fe.length;lt<Pt/2;lt+=2){const It=Fe[lt],tn=Fe[lt+1];Fe[lt]=Fe[Pt-2-lt],Fe[lt+1]=Fe[Pt-1-lt],Fe[Pt-2-lt]=It,Fe[Pt-1-lt]=tn}})(xe,Pe)}function Qt(qe,ne,oe,ye=!1){for(let Pe=0;Pe<qe.length;Pe++)ft(qe[Pe],ne,oe,ye,Pe===0)}function Be(qe,ne,oe,ye){const{id:Pe,type:xe,geometry:Fe,tags:st}=qe,$e=[];if(xe===1)(function(lt,Pt,It,tn,yn){for(let bn=0;bn<lt.length;bn+=2){const Ln=Math.round(s.al*(lt[bn+0]*Pt-It)),Vn=Math.round(s.al*(lt[bn+1]*Pt-tn));yn.push([Ln,Vn])}})(Fe,ne,oe,ye,$e);else if(xe===2)for(const lt of Fe)En(lt,ne,oe,ye,$e);else if(xe===3)for(const lt of Fe)Qn(lt,ne,oe,ye,$e);return{id:Pe,type:xe,geometry:$e,tags:st}}function En(qe,ne,oe,ye,Pe){const Fe=s.al+128;let st;for(let $e=0;$e<qe.length-2;$e+=2){let lt=Math.round(s.al*(qe[$e+0]*ne-oe)),Pt=Math.round(s.al*(qe[$e+1]*ne-ye)),It=Math.round(s.al*(qe[$e+2]*ne-oe)),tn=Math.round(s.al*(qe[$e+3]*ne-ye));const yn=It-lt,bn=tn-Pt;lt<-128&&It<-128||(lt<-128?(Pt+=Math.round(bn*((-128-lt)/yn)),lt=-128):It<-128&&(tn=Pt+Math.round(bn*((-128-lt)/yn)),It=-128),Pt<-128&&tn<-128||(Pt<-128?(lt+=Math.round(yn*((-128-Pt)/bn)),Pt=-128):tn<-128&&(It=lt+Math.round(yn*((-128-Pt)/bn)),tn=-128),lt>=Fe&&It>=Fe||(lt>=Fe?(Pt+=Math.round(bn*((Fe-lt)/yn)),lt=Fe):It>=Fe&&(tn=Pt+Math.round(bn*((Fe-lt)/yn)),It=Fe),Pt>=Fe&&tn>=Fe||(Pt>=Fe?(lt+=Math.round(yn*((Fe-Pt)/bn)),Pt=Fe):tn>=Fe&&(It=lt+Math.round(yn*((Fe-Pt)/bn)),tn=Fe),st&&lt===st[st.length-1][0]&&Pt===st[st.length-1][1]||(st=[[lt,Pt]],Pe.push(st)),st.push([It,tn])))))}}function Qn(qe,ne,oe,ye,Pe){const xe=(oe-wt)/ne,Fe=(ye-wt)/ne,st=(oe+1+wt)/ne,$e=(ye+1+wt)/ne;function lt(tn,yn){let bn=0;return tn<xe?bn|=1:tn>st&&(bn|=2),yn<Fe?bn|=4:yn>$e&&(bn|=8),bn}let Pt=[];for(let tn=1;tn<=8;tn*=2){let yn=qe[qe.length-2],bn=qe[qe.length-1],Ln=!(lt(yn,bn)&tn);for(let Vn=0;Vn<qe.length;Vn+=2){const vn=qe[Vn],kn=qe[Vn+1],$i=!(lt(vn,kn)&tn);$i!==Ln&&(8&tn?Pt.push(yn+(vn-yn)*($e-bn)/(kn-bn),$e):4&tn?Pt.push(yn+(vn-yn)*(Fe-bn)/(kn-bn),Fe):2&tn?Pt.push(st,bn+(kn-bn)*(st-yn)/(vn-yn)):1&tn&&Pt.push(xe,bn+(kn-bn)*(xe-yn)/(vn-yn))),$i&&Pt.push(vn,kn),yn=vn,bn=kn,Ln=$i}if(!(qe=Pt).length||tn===8)break;Pt=[]}const It=[];for(let tn=0;tn<Pt.length;tn+=2)It.push([Math.round(s.al*(Pt[tn]*ne-oe)),Math.round(s.al*(Pt[tn+1]*ne-ye))]);It.length&&Pe.push(It)}function $n({name:qe,features:ne},oe){oe.writeStringField(1,qe),oe.writeVarintField(5,s.al);const ye=new Map,Pe=new Map,xe={keys:ye,values:Pe,feature:null};for(const Fe of ne)xe.feature=Fe,oe.writeMessage(2,ki,xe);for(const Fe of ye.keys())oe.writeStringField(3,Fe);for(const Fe of Pe.keys())oe.writeMessage(4,Fa,Fe)}function ki(qe,ne){const oe=qe.feature;oe.id!==void 0&&Number.isSafeInteger(+oe.id)&&ne.writeVarintField(1,+oe.id),oe.tags&&ne.writeMessage(2,er,qe),ne.writeVarintField(3,oe.type),ne.writeMessage(4,Vr,oe)}function er({keys:qe,values:ne,feature:oe},ye){for(const Pe of Object.keys(oe.tags)){let xe=oe.tags[Pe];if(xe===null)continue;let Fe=qe.get(Pe);Fe===void 0&&(Fe=qe.size,qe.set(Pe,Fe)),ye.writeVarint(Fe);const st=typeof xe;st!=="string"&&st!=="boolean"&&st!=="number"&&(xe=JSON.stringify(xe));let $e=ne.get(xe);$e===void 0&&($e=ne.size,ne.set(xe,$e)),ye.writeVarint($e)}}function qn(qe,ne){return(ne<<3)+(7&qe)}function Ni(qe){return qe<<1^qe>>31}function Vr(qe,ne){const{geometry:oe,type:ye}=qe;let Pe=0,xe=0;if(ye===1){ne.writeVarint(qn(1,oe.length));for(const Fe of oe){const st=Fe[0]-Pe,$e=Fe[1]-xe;ne.writeVarint(Ni(st)),ne.writeVarint(Ni($e)),Pe+=st,xe+=$e}}else for(const Fe of oe){if(Fe.length===0)continue;ne.writeVarint(qn(1,1));const st=Fe.length-(ye===3?1:0);for(let $e=0;$e<st;$e++){$e===1&&ne.writeVarint(qn(2,st-1));const lt=Fe[$e][0]-Pe,Pt=Fe[$e][1]-xe;ne.writeVarint(Ni(lt)),ne.writeVarint(Ni(Pt)),Pe+=lt,xe+=Pt}ye===3&&ne.writeVarint(qn(7,1))}}function Fa(qe,ne){const oe=typeof qe;oe==="string"?ne.writeStringField(1,qe):oe==="boolean"?ne.writeBooleanField(7,qe):oe==="number"&&(qe%1!=0?ne.writeDoubleField(3,qe):qe<0?ne.writeSVarintField(6,qe):ne.writeVarintField(5,qe))}const Cn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},vi=Math.fround||(_r=new Float32Array(1),qe=>(_r[0]=+qe,_r[0]));var _r;class Hi{constructor(ne){this.options=Object.assign(Object.create(Cn),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:oe,minZoom:ye,maxZoom:Pe}=this.options;oe&&console.time("total time");const xe=`prepare ${ne.length} points`;oe&&console.time(xe),this.points=ne;const Fe=[];for(let $e=0;$e<ne.length;$e++){const lt=ne[$e];if(!lt.geometry)continue;const[Pt,It]=lt.geometry.coordinates,tn=vi(yr(Pt)),yn=vi(Xr(It));Fe.push(tn,yn,1/0,$e,-1,1),this.options.reduce&&Fe.push(0)}let st=this.trees[Pe+1]=this._createTree(Fe);oe&&console.timeEnd(xe);for(let $e=Pe;$e>=ye;$e--){const lt=+Date.now();st=this.trees[$e]=this._createTree(this._cluster(st,$e)),oe&&console.log("z%d: %d clusters in %dms",$e,st.numItems,+Date.now()-lt)}return oe&&console.timeEnd("total time"),this}getClusters(ne,oe){let ye=((ne[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,ne[1]));let xe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ye=-180,xe=180;else if(ye>xe){const It=this.getClusters([ye,Pe,180,Fe],oe),tn=this.getClusters([-180,Pe,xe,Fe],oe);return It.concat(tn)}const st=this.trees[this._limitZoom(oe)],$e=st.range(yr(ye),Xr(Fe),yr(xe),Xr(Pe)),lt=st.data,Pt=[];for(const It of $e){const tn=this.stride*It;Pt.push(lt[tn+5]>1?Wr(lt,tn,this.clusterProps):this.points[lt[tn+3]])}return Pt}getChildren(ne){const oe=this._getOriginId(ne),ye=this._getOriginZoom(ne),Pe="No cluster with the specified id.",xe=this.trees[ye];if(!xe)throw new Error(Pe);const Fe=xe.data;if(oe*this.stride>=Fe.length)throw new Error(Pe);const st=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),$e=xe.within(Fe[oe*this.stride],Fe[oe*this.stride+1],st),lt=[];for(const Pt of $e){const It=Pt*this.stride;Fe[It+4]===ne&&lt.push(Fe[It+5]>1?Wr(Fe,It,this.clusterProps):this.points[Fe[It+3]])}if(lt.length===0)throw new Error(Pe);return lt}getLeaves(ne,oe,ye){const Pe=[];return this._appendLeaves(Pe,ne,oe=oe||10,ye=ye||0,0),Pe}getTile(ne,oe,ye){const Pe=this.trees[this._limitZoom(ne)],xe=Math.pow(2,ne),{extent:Fe,radius:st}=this.options,$e=st/Fe,lt=(ye-$e)/xe,Pt=(ye+1+$e)/xe,It={features:[]};return this._addTileFeatures(Pe.range((oe-$e)/xe,lt,(oe+1+$e)/xe,Pt),Pe.data,oe,ye,xe,It),oe===0&&this._addTileFeatures(Pe.range(1-$e/xe,lt,1,Pt),Pe.data,xe,ye,xe,It),oe===xe-1&&this._addTileFeatures(Pe.range(0,lt,$e/xe,Pt),Pe.data,-1,ye,xe,It),It.features.length?It:null}getClusterExpansionZoom(ne){let oe=this._getOriginZoom(ne)-1;for(;oe<=this.options.maxZoom;){const ye=this.getChildren(ne);if(oe++,ye.length!==1)break;ne=ye[0].properties.cluster_id}return oe}_appendLeaves(ne,oe,ye,Pe,xe){const Fe=this.getChildren(oe);for(const st of Fe){const $e=st.properties;if($e&&$e.cluster?xe+$e.point_count<=Pe?xe+=$e.point_count:xe=this._appendLeaves(ne,$e.cluster_id,ye,Pe,xe):xe<Pe?xe++:ne.push(st),ne.length===ye)break}return xe}_createTree(ne){const oe=new s.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<ne.length;ye+=this.stride)oe.add(ne[ye],ne[ye+1]);return oe.finish(),oe.data=ne,oe}_addTileFeatures(ne,oe,ye,Pe,xe,Fe){for(const st of ne){const $e=st*this.stride,lt=oe[$e+5]>1;let Pt,It,tn;if(lt)Pt=tr(oe,$e,this.clusterProps),It=oe[$e],tn=oe[$e+1];else{const Ln=this.points[oe[$e+3]];Pt=Ln.properties;const[Vn,vn]=Ln.geometry.coordinates;It=yr(Vn),tn=Xr(vn)}const yn={type:1,geometry:[[Math.round(this.options.extent*(It*xe-ye)),Math.round(this.options.extent*(tn*xe-Pe))]],tags:Pt};let bn;bn=lt||this.options.generateId?oe[$e+3]:this.points[oe[$e+3]].id,bn!==void 0&&(yn.id=bn),Fe.features.push(yn)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,oe){const{radius:ye,extent:Pe,reduce:xe,minPoints:Fe}=this.options,st=ye/(Pe*Math.pow(2,oe)),$e=ne.data,lt=[],Pt=this.stride;for(let It=0;It<$e.length;It+=Pt){if($e[It+2]<=oe)continue;$e[It+2]=oe;const tn=$e[It],yn=$e[It+1],bn=ne.within($e[It],$e[It+1],st),Ln=$e[It+5];let Vn=Ln;for(const vn of bn){const kn=vn*Pt;$e[kn+2]>oe&&(Vn+=$e[kn+5])}if(Vn>Ln&&Vn>=Fe){let vn,kn=tn*Ln,$i=yn*Ln,xr=-1;const nr=(It/Pt<<5)+(oe+1)+this.points.length;for(const vr of bn){const ir=vr*Pt;if($e[ir+2]<=oe)continue;$e[ir+2]=oe;const ui=$e[ir+5];kn+=$e[ir]*ui,$i+=$e[ir+1]*ui,$e[ir+4]=nr,xe&&(vn||(vn=this._map($e,It,!0),xr=this.clusterProps.length,this.clusterProps.push(vn)),xe(vn,this._map($e,ir)))}$e[It+4]=nr,lt.push(kn/Vn,$i/Vn,1/0,nr,-1,Vn),xe&&lt.push(xr)}else{for(let vn=0;vn<Pt;vn++)lt.push($e[It+vn]);if(Vn>1)for(const vn of bn){const kn=vn*Pt;if(!($e[kn+2]<=oe)){$e[kn+2]=oe;for(let $i=0;$i<Pt;$i++)lt.push($e[kn+$i])}}}}return lt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,oe,ye){if(ne[oe+5]>1){const Fe=this.clusterProps[ne[oe+6]];return ye?Object.assign({},Fe):Fe}const Pe=this.points[ne[oe+3]].properties,xe=this.options.map(Pe);return ye&&xe===Pe?Object.assign({},xe):xe}}function Wr(qe,ne,oe){return{type:"Feature",id:qe[ne+3],properties:tr(qe,ne,oe),geometry:{type:"Point",coordinates:[(ye=qe[ne],360*(ye-.5)),to(qe[ne+1])]}};var ye}function tr(qe,ne,oe){const ye=qe[ne+5],Pe=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,xe=qe[ne+6],Fe=xe===-1?{}:Object.assign({},oe[xe]);return Object.assign(Fe,{cluster:!0,cluster_id:qe[ne+3],point_count:ye,point_count_abbreviated:Pe})}function yr(qe){return qe/360+.5}function Xr(qe){const ne=Math.sin(qe*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function to(qe){const ne=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Rl(qe,ne,oe,ye){let Pe=ye;const xe=ne+(oe-ne>>1);let Fe,st=oe-ne;const $e=qe[ne],lt=qe[ne+1],Pt=qe[oe],It=qe[oe+1];for(let tn=ne+3;tn<oe;tn+=3){const yn=rc(qe[tn],qe[tn+1],$e,lt,Pt,It);if(yn>Pe)Fe=tn,Pe=yn;else if(yn===Pe){const bn=Math.abs(tn-xe);bn<st&&(Fe=tn,st=bn)}}Pe>ye&&(Fe-ne>3&&Rl(qe,ne,Fe,ye),qe[Fe+2]=Pe,oe-Fe>3&&Rl(qe,Fe,oe,ye))}function rc(qe,ne,oe,ye,Pe,xe){let Fe=Pe-oe,st=xe-ye;if(Fe!==0||st!==0){const $e=((qe-oe)*Fe+(ne-ye)*st)/(Fe*Fe+st*st);$e>1?(oe=Pe,ye=xe):$e>0&&(oe+=Fe*$e,ye+=st*$e)}return Fe=qe-oe,st=ne-ye,Fe*Fe+st*st}function jr(qe,ne,oe,ye){const Pe={id:qe??null,type:ne,geometry:oe,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")bs(Pe,oe);else if(ne==="Polygon")bs(Pe,oe[0]);else if(ne==="MultiLineString")for(const xe of oe)bs(Pe,xe);else if(ne==="MultiPolygon")for(const xe of oe)bs(Pe,xe[0]);return Pe}function bs(qe,ne){for(let oe=0;oe<ne.length;oe+=3)qe.minX=Math.min(qe.minX,ne[oe]),qe.minY=Math.min(qe.minY,ne[oe+1]),qe.maxX=Math.max(qe.maxX,ne[oe]),qe.maxY=Math.max(qe.maxY,ne[oe+1])}function en(qe,ne,oe,ye){if(!ne.geometry)return;const Pe=ne.geometry.coordinates;if(Pe&&Pe.length===0)return;const xe=ne.geometry.type,Fe=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let st=[],$e=ne.id;if(oe.promoteId?$e=ne.properties[oe.promoteId]:oe.generateId&&($e=ye||0),xe==="Point")Tn(Pe,st);else if(xe==="MultiPoint")for(const lt of Pe)Tn(lt,st);else if(xe==="LineString")si(Pe,st,Fe,!1);else if(xe==="MultiLineString"){if(oe.lineMetrics){for(const lt of Pe)st=[],si(lt,st,Fe,!1),qe.push(jr($e,"LineString",st,ne.properties));return}Li(Pe,st,Fe,!1)}else if(xe==="Polygon")Li(Pe,st,Fe,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const lt of ne.geometry.geometries)en(qe,{id:$e,geometry:lt,properties:ne.properties},oe,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const lt of Pe){const Pt=[];Li(lt,Pt,Fe,!0),st.push(Pt)}}qe.push(jr($e,xe,st,ne.properties))}function Tn(qe,ne){ne.push(Ii(qe[0]),Fs(qe[1]),0)}function si(qe,ne,oe,ye){let Pe,xe,Fe=0;for(let $e=0;$e<qe.length;$e++){const lt=Ii(qe[$e][0]),Pt=Fs(qe[$e][1]);ne.push(lt,Pt,0),$e>0&&(Fe+=ye?(Pe*Pt-lt*xe)/2:Math.sqrt(Math.pow(lt-Pe,2)+Math.pow(Pt-xe,2))),Pe=lt,xe=Pt}const st=ne.length-3;ne[2]=1,Rl(ne,0,st,oe),ne[st+2]=1,ne.size=Math.abs(Fe),ne.start=0,ne.end=ne.size}function Li(qe,ne,oe,ye){for(let Pe=0;Pe<qe.length;Pe++){const xe=[];si(qe[Pe],xe,oe,ye),ne.push(xe)}}function Ii(qe){return qe/360+.5}function Fs(qe){const ne=Math.sin(qe*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function _s(qe,ne,oe,ye,Pe,xe,Fe,st){if(ye/=ne,xe>=(oe/=ne)&&Fe<ye)return qe;if(Fe<oe||xe>=ye)return null;const $e=[];for(const lt of qe){const Pt=lt.geometry;let It=lt.type;const tn=Pe===0?lt.minX:lt.minY,yn=Pe===0?lt.maxX:lt.maxY;if(tn>=oe&&yn<ye){$e.push(lt);continue}if(yn<oe||tn>=ye)continue;let bn=[];if(It==="Point"||It==="MultiPoint")ms(Pt,bn,oe,ye,Pe);else if(It==="LineString")Pr(Pt,bn,oe,ye,Pe,!1,st.lineMetrics);else if(It==="MultiLineString")Fi(Pt,bn,oe,ye,Pe,!1);else if(It==="Polygon")Fi(Pt,bn,oe,ye,Pe,!0);else if(It==="MultiPolygon")for(const Ln of Pt){const Vn=[];Fi(Ln,Vn,oe,ye,Pe,!0),Vn.length&&bn.push(Vn)}if(bn.length){if(st.lineMetrics&&It==="LineString"){for(const Ln of bn)$e.push(jr(lt.id,It,Ln,lt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(bn.length===1?(It="LineString",bn=bn[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=bn.length===3?"Point":"MultiPoint"),$e.push(jr(lt.id,It,bn,lt.tags))}}return $e.length?$e:null}function ms(qe,ne,oe,ye,Pe){for(let xe=0;xe<qe.length;xe+=3){const Fe=qe[xe+Pe];Fe>=oe&&Fe<=ye&&ia(ne,qe[xe],qe[xe+1],qe[xe+2])}}function Pr(qe,ne,oe,ye,Pe,xe,Fe){let st=mr(qe);const $e=Pe===0?ws:cl;let lt,Pt,It=qe.start;for(let Vn=0;Vn<qe.length-3;Vn+=3){const vn=qe[Vn],kn=qe[Vn+1],$i=qe[Vn+2],xr=qe[Vn+3],nr=qe[Vn+4],vr=Pe===0?vn:kn,ir=Pe===0?xr:nr;let ui=!1;Fe&&(lt=Math.sqrt(Math.pow(vn-xr,2)+Math.pow(kn-nr,2))),vr<oe?ir>oe&&(Pt=$e(st,vn,kn,xr,nr,oe),Fe&&(st.start=It+lt*Pt)):vr>ye?ir<ye&&(Pt=$e(st,vn,kn,xr,nr,ye),Fe&&(st.start=It+lt*Pt)):ia(st,vn,kn,$i),ir<oe&&vr>=oe&&(Pt=$e(st,vn,kn,xr,nr,oe),ui=!0),ir>ye&&vr<=ye&&(Pt=$e(st,vn,kn,xr,nr,ye),ui=!0),!xe&&ui&&(Fe&&(st.end=It+lt*Pt),ne.push(st),st=mr(qe)),Fe&&(It+=lt)}let tn=qe.length-3;const yn=qe[tn],bn=qe[tn+1],Ln=Pe===0?yn:bn;Ln>=oe&&Ln<=ye&&ia(st,yn,bn,qe[tn+2]),tn=st.length-3,xe&&tn>=3&&(st[tn]!==st[0]||st[tn+1]!==st[1])&&ia(st,st[0],st[1],st[2]),st.length&&ne.push(st)}function mr(qe){const ne=[];return ne.size=qe.size,ne.start=qe.start,ne.end=qe.end,ne}function Fi(qe,ne,oe,ye,Pe,xe){for(const Fe of qe)Pr(Fe,ne,oe,ye,Pe,xe,!1)}function ia(qe,ne,oe,ye){qe.push(ne,oe,ye)}function ws(qe,ne,oe,ye,Pe,xe){const Fe=(xe-ne)/(ye-ne);return ia(qe,xe,oe+(Pe-oe)*Fe,1),Fe}function cl(qe,ne,oe,ye,Pe,xe){const Fe=(xe-oe)/(Pe-oe);return ia(qe,ne+(ye-ne)*Fe,xe,1),Fe}function Ia(qe,ne){const oe=[];for(let ye=0;ye<qe.length;ye++){const Pe=qe[ye],xe=Pe.type;let Fe;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Fe=bo(Pe.geometry,ne);else if(xe==="MultiLineString"||xe==="Polygon"){Fe=[];for(const st of Pe.geometry)Fe.push(bo(st,ne))}else if(xe==="MultiPolygon"){Fe=[];for(const st of Pe.geometry){const $e=[];for(const lt of st)$e.push(bo(lt,ne));Fe.push($e)}}oe.push(jr(Pe.id,xe,Fe,Pe.tags))}return oe}function bo(qe,ne){const oe=[];oe.size=qe.size,qe.start!==void 0&&(oe.start=qe.start,oe.end=qe.end);for(let ye=0;ye<qe.length;ye+=3)oe.push(qe[ye]+ne,qe[ye+1],qe[ye+2]);return oe}function gs(qe,ne){if(qe.transformed)return qe;const oe=1<<qe.z,ye=qe.x,Pe=qe.y;for(const xe of qe.features){const Fe=xe.geometry,st=xe.type;if(xe.geometry=[],st===1)for(let $e=0;$e<Fe.length;$e+=2)xe.geometry.push(Vi(Fe[$e],Fe[$e+1],ne,oe,ye,Pe));else for(let $e=0;$e<Fe.length;$e++){const lt=[];for(let Pt=0;Pt<Fe[$e].length;Pt+=2)lt.push(Vi(Fe[$e][Pt],Fe[$e][Pt+1],ne,oe,ye,Pe));xe.geometry.push(lt)}}return qe.transformed=!0,qe}function Vi(qe,ne,oe,ye,Pe,xe){return[Math.round(oe*(qe*ye-Pe)),Math.round(oe*(ne*ye-xe))]}function Kr(qe,ne,oe,ye,Pe){const xe=ne===Pe.maxZoom?0:Pe.tolerance/((1<<ne)*Pe.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:oe,y:ye,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const st of qe)wo(Fe,st,xe,Pe);return Fe}function wo(qe,ne,oe,ye){const Pe=ne.geometry,xe=ne.type,Fe=[];if(qe.minX=Math.min(qe.minX,ne.minX),qe.minY=Math.min(qe.minY,ne.minY),qe.maxX=Math.max(qe.maxX,ne.maxX),qe.maxY=Math.max(qe.maxY,ne.maxY),xe==="Point"||xe==="MultiPoint")for(let st=0;st<Pe.length;st+=3)Fe.push(Pe[st],Pe[st+1]),qe.numPoints++,qe.numSimplified++;else if(xe==="LineString")_u(Fe,Pe,qe,oe,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let st=0;st<Pe.length;st++)_u(Fe,Pe[st],qe,oe,xe==="Polygon",st===0);else if(xe==="MultiPolygon")for(let st=0;st<Pe.length;st++){const $e=Pe[st];for(let lt=0;lt<$e.length;lt++)_u(Fe,$e[lt],qe,oe,!0,lt===0)}if(Fe.length){let st=ne.tags||null;if(xe==="LineString"&&ye.lineMetrics){st={};for(const lt in ne.tags)st[lt]=ne.tags[lt];st.mapbox_clip_start=Pe.start/Pe.size,st.mapbox_clip_end=Pe.end/Pe.size}const $e={geometry:Fe,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:st};ne.id!==null&&($e.id=ne.id),qe.features.push($e)}}function _u(qe,ne,oe,ye,Pe,xe){const Fe=ye*ye;if(ye>0&&ne.size<(Pe?Fe:ye))return void(oe.numPoints+=ne.length/3);const st=[];for(let $e=0;$e<ne.length;$e+=3)(ye===0||ne[$e+2]>Fe)&&(oe.numSimplified++,st.push(ne[$e],ne[$e+1])),oe.numPoints++;Pe&&(function($e,lt){let Pt=0;for(let It=0,tn=$e.length,yn=tn-2;It<tn;yn=It,It+=2)Pt+=($e[It]-$e[yn])*($e[It+1]+$e[yn+1]);if(Pt>0===lt)for(let It=0,tn=$e.length;It<tn/2;It+=2){const yn=$e[It],bn=$e[It+1];$e[It]=$e[tn-2-It],$e[It+1]=$e[tn-1-It],$e[tn-2-It]=yn,$e[tn-1-It]=bn}})(st,xe),qe.push(st)}const Va={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ul{constructor(ne,oe){const ye=(oe=this.options=(function(xe,Fe){for(const st in Fe)xe[st]=Fe[st];return xe})(Object.create(Va),oe)).debug;if(ye&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=(function(xe,Fe){const st=[];if(xe.type==="FeatureCollection")for(let $e=0;$e<xe.features.length;$e++)en(st,xe.features[$e],Fe,$e);else en(st,xe.type==="Feature"?xe:{geometry:xe},Fe);return st})(ne,oe);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=(function(xe,Fe){const st=Fe.buffer/Fe.extent;let $e=xe;const lt=_s(xe,1,-1-st,st,0,-1,2,Fe),Pt=_s(xe,1,1-st,2+st,0,-1,2,Fe);return(lt||Pt)&&($e=_s(xe,1,-st,1+st,0,-1,2,Fe)||[],lt&&($e=Ia(lt,1).concat($e)),Pt&&($e=$e.concat(Ia(Pt,-1)))),$e})(Pe,oe),Pe.length&&this.splitTile(Pe,0,0,0),ye&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,oe,ye,Pe,xe,Fe,st){const $e=[ne,oe,ye,Pe],lt=this.options,Pt=lt.debug;for(;$e.length;){Pe=$e.pop(),ye=$e.pop(),oe=$e.pop(),ne=$e.pop();const It=1<<oe,tn=hl(oe,ye,Pe);let yn=this.tiles[tn];if(!yn&&(Pt>1&&console.time("creation"),yn=this.tiles[tn]=Kr(ne,oe,ye,Pe,lt),this.tileCoords.push({z:oe,x:ye,y:Pe}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ye,Pe,yn.numFeatures,yn.numPoints,yn.numSimplified),console.timeEnd("creation"));const ui=`z${oe}`;this.stats[ui]=(this.stats[ui]||0)+1,this.total++}if(yn.source=ne,xe==null){if(oe===lt.indexMaxZoom||yn.numPoints<=lt.indexMaxPoints)continue}else{if(oe===lt.maxZoom||oe===xe)continue;if(xe!=null){const ui=xe-oe;if(ye!==Fe>>ui||Pe!==st>>ui)continue}}if(yn.source=null,ne.length===0)continue;Pt>1&&console.time("clipping");const bn=.5*lt.buffer/lt.extent,Ln=.5-bn,Vn=.5+bn,vn=1+bn;let kn=null,$i=null,xr=null,nr=null,vr=_s(ne,It,ye-bn,ye+Vn,0,yn.minX,yn.maxX,lt),ir=_s(ne,It,ye+Ln,ye+vn,0,yn.minX,yn.maxX,lt);ne=null,vr&&(kn=_s(vr,It,Pe-bn,Pe+Vn,1,yn.minY,yn.maxY,lt),$i=_s(vr,It,Pe+Ln,Pe+vn,1,yn.minY,yn.maxY,lt),vr=null),ir&&(xr=_s(ir,It,Pe-bn,Pe+Vn,1,yn.minY,yn.maxY,lt),nr=_s(ir,It,Pe+Ln,Pe+vn,1,yn.minY,yn.maxY,lt),ir=null),Pt>1&&console.timeEnd("clipping"),$e.push(kn||[],oe+1,2*ye,2*Pe),$e.push($i||[],oe+1,2*ye,2*Pe+1),$e.push(xr||[],oe+1,2*ye+1,2*Pe),$e.push(nr||[],oe+1,2*ye+1,2*Pe+1)}}getTile(ne,oe,ye){ne=+ne,oe=+oe,ye=+ye;const Pe=this.options,{extent:xe,debug:Fe}=Pe;if(ne<0||ne>24)return null;const st=1<<ne,$e=hl(ne,oe=oe+st&st-1,ye);if(this.tiles[$e])return gs(this.tiles[$e],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",ne,oe,ye);let lt,Pt=ne,It=oe,tn=ye;for(;!lt&&Pt>0;)Pt--,It>>=1,tn>>=1,lt=this.tiles[hl(Pt,It,tn)];return lt&&lt.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Pt,It,tn),console.time("drilling down")),this.splitTile(lt.source,Pt,It,tn,ne,oe,ye),Fe>1&&console.timeEnd("drilling down"),this.tiles[$e]?gs(this.tiles[$e],xe):null):null}}function hl(qe,ne,oe){return 32*((1<<qe)*oe+ne)+qe}function Dt(qe,ne){const oe=qe.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ye=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ye)return void ne(null,null);const Pe=lt=>lt.tags&&"3d_elevation_id"in lt.tags&&"source"in lt.tags&&lt.tags.source==="elevation",xe=ye.features.filter(lt=>Pe(lt));let Fe={_geojsonTileLayer:ye.features};xe.length>0&&(Fe={_geojsonTileLayer:ye.features.filter(lt=>!Pe(lt)),hd_road_elevation:xe});const st=new dn(Fe),$e=(function(lt){const Pt=new s.bt;for(const It of Object.keys(lt))Pt.writeMessage(3,$n,{name:It,features:lt[It]});return Pt.finish()})(Fe).buffer;ne(null,{vectorTile:st,rawData:$e})}class no extends Re{constructor(ne,oe,ye,Pe,xe,Fe,st){super(ne,oe,ye,Pe,xe,Dt,st),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new Kt}loadData(ne,oe){const ye=ne&&ne.request,Pe=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(xe,Fe)=>{if(xe||!Fe)return oe(xe);if(typeof Fe!="object")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const $e=s.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(lt=>`${lt.key}: ${lt.message}`).join(", "));Fe.features=Fe.features.filter(lt=>$e.value.evaluate({zoom:0},lt))}ne.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),ne.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new Hi((function({superclusterOptions:$e,clusterProperties:lt}){if(!lt||!$e)return $e;const Pt={},It={},tn={accumulated:null,zoom:0},yn={properties:null},bn=Object.keys(lt);for(const Ln of bn){const[Vn,vn]=lt[Ln],kn=s.U(vn),$i=s.U(typeof Vn=="string"?[Vn,["accumulated"],["get",Ln]]:Vn);Pt[Ln]=kn.value,It[Ln]=$i.value}return $e.map=Ln=>{yn.properties=Ln;const Vn={};for(const vn of bn)Vn[vn]=Pt[vn].evaluate(tn,yn);return Vn},$e.reduce=(Ln,Vn)=>{yn.properties=Vn;for(const vn of bn)tn.accumulated=Ln[vn],Ln[vn]=It[vn].evaluate(tn,yn)},$e})(ne)).load(Fe.features):ne.dynamic?this._dynamicIndex:(function($e,lt){return new ul($e,lt)})(Fe,ne.geojsonVtOptions)}catch($e){return oe($e)}const st={};if(Pe){const $e=V(ye);$e&&(st.resourceTiming={},st.resourceTiming[ne.source]=JSON.parse(JSON.stringify($e)))}oe(null,st)}})}reloadTile(ne,oe){const ye=this.loaded;return ye&&ye[ne.uid]?ne.partial?oe(null,void 0):super.reloadTile(ne,oe):this.loadTile(ne,oe)}loadGeoJSON(ne,oe){if(ne.request)s.m(ne.request,oe);else{if(typeof ne.data!="string")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return oe(null,JSON.parse(ne.data))}catch{return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ye){oe(ye)}}getClusterChildren(ne,oe){try{oe(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ye){oe(ye)}}getClusterLeaves(ne,oe){try{oe(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ye){oe(ye)}}}class th{constructor(ne,oe,ye){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=oe,this.worldview=ye}parse(ne,oe,ye,Pe){this.status="parsing";const xe=new s.aQ(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Fe=[],st=oe.familiesBySource[ye.source],$e=new s.fn(xe,ye.promoteId);$e.bucketLayerIDs=[],$e.is3DTile=!0,s.fC(ne).then(lt=>{if(!lt)return Pe(new Error("Could not parse tile"));const Pt=lt.json.extensionsUsed&&lt.json.extensionsUsed.includes("MAPBOX_mesh_features")||lt.json.asset.extras&&lt.json.asset.extras.MAPBOX_mesh_features,It=lt.json.extensionsUsed&&lt.json.extensionsUsed.includes("EXT_meshopt_compression"),tn=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const yn in st)for(const bn of st[yn]){const Ln=bn[0];$e.bucketLayerIDs.push(bn.map(kn=>s.B(kn.id,kn.scope))),Ln.recalculate(tn,[]);const Vn=s.fD(lt,1/s.d7(ye.tileID.canonical)),vn=new s.fE(bn,Vn,xe,Pt,It,this.brightness,$e,this.worldview);Pt||(vn.needsUpload=!0),Fe.push(vn),vn.evaluate(Ln)}this.status="done",Pe(null,{buckets:Fe,featureIndex:$e,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(lt=>Pe(new Error(lt.message)))}}class Lc{constructor(ne,oe,ye,Pe,xe,Fe,st,$e){this.actor=ne,this.layerIndex=oe,this.availableImages=ye,this.availableModels=Pe,this.brightness=st,this.loading={},this.loaded={},this.worldview=$e}loadTile(ne,oe){const ye=ne.uid,Pe=this.loading[ye]=new th(ne,this.brightness,this.worldview);s.bu(ne.request,(xe,Fe)=>{const st=!this.loading[ye];return delete this.loading[ye],st||xe?(Pe.status="done",st||(this.loaded[ye]=Pe),oe(xe)):Fe&&Fe.byteLength!==0?void Pe.parse(Fe,this.layerIndex,ne,($e,lt)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Pe,$e||!lt?oe($e):oe(null,lt)}):(Pe.status="done",this.loaded[ye]=Pe,oe())})}reloadTile(ne,oe){const ye=this.loaded,Pe=ne.uid;if(ye&&ye[Pe]){const xe=ye[Pe];xe.projection=ne.projection,xe.brightness=ne.brightness;const Fe=(st,$e)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(ne,oe)),oe(st,$e)};xe.status==="parsing"?xe.reloadCallback=Fe:xe.status==="done"&&this.loadTile(ne,oe)}}abortTile(ne,oe){const ye=ne.uid;this.loading[ye]&&delete this.loading[ye],oe()}removeTile(ne,oe){const ye=this.loaded,Pe=ne.uid;ye&&ye[Pe]&&delete ye[Pe],oe()}}class oi{constructor(ne){this.self=ne,this.actor=new s.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:Re,geojson:no,"raster-dem":Ve,"raster-array":He,"batched-model":Lc},this.workerSources={},this.self.registerWorkerSource=(oe,ye)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=ye},this.self.registerRTLTextPlugin=oe=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=oe.applyArabicShaping,s.fH.processBidirectionalText=oe.processBidirectionalText,s.fH.processStyledBidirectionalText=oe.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,oe,ye){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ye()}checkIfReady(ne,oe,ye){ye()}setReferrer(ne,oe){this.referrer=oe}spriteLoaded(ne,oe){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ye,isLoaded:Pe}=oe;if(this.isSpriteLoaded[ne][ye]=Pe,this.workerSources[ne]&&this.workerSources[ne][ye])for(const xe in this.workerSources[ne][ye]){const Fe=this.workerSources[ne][ye][xe];for(const st in Fe){const $e=Fe[st];$e instanceof Re&&($e.isSpriteLoaded=Pe,$e.fire(new s.z("isSpriteLoaded")))}}}setImages(ne,oe,ye){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Pe,images:xe}=oe;if(this.availableImages[ne][Pe]=xe,this.workerSources[ne]&&this.workerSources[ne][Pe]){for(const Fe in this.workerSources[ne][Pe]){const st=this.workerSources[ne][Pe][Fe];for(const $e in st)st[$e].availableImages=xe}ye()}else ye()}setModels(ne,{scope:oe,models:ye},Pe){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][oe]=ye,this.workerSources[ne]&&this.workerSources[ne][oe]){for(const xe in this.workerSources[ne][oe]){const Fe=this.workerSources[ne][oe][xe];for(const st in Fe)Fe[st].availableModels=ye}Pe()}else Pe()}setProjection(ne,oe){this.projections[ne]=s.cm(oe)}setBrightness(ne,oe,ye){this.brightness=oe,ye()}setWorldview(ne,oe,ye){this.worldview=oe,ye()}setLayers(ne,oe,ye){this.getLayerIndex(ne,oe.scope).replace(oe.layers,oe.options),ye()}updateLayers(ne,oe,ye){this.getLayerIndex(ne,oe.scope).update(oe.layers,oe.removedIds,oe.options),ye()}loadTile(ne,oe,ye){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).loadTile(oe,ye)}decodeRasterArray(ne,oe,ye){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).decodeRasterArray(oe,ye)}reloadTile(ne,oe,ye){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).reloadTile(oe,ye)}abortTile(ne,oe,ye){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).abortTile(oe,ye)}removeTile(ne,oe,ye){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).removeTile(oe,ye)}removeSource(ne,oe,ye){if(!(this.workerSources[ne]&&this.workerSources[ne][oe.scope]&&this.workerSources[ne][oe.scope][oe.type]&&this.workerSources[ne][oe.scope][oe.type][oe.source]))return;const Pe=this.workerSources[ne][oe.scope][oe.type][oe.source];delete this.workerSources[ne][oe.scope][oe.type][oe.source],Pe.removeSource!==void 0?Pe.removeSource(oe,ye):ye()}loadWorkerSource(ne,oe,ye){try{this.self.importScripts(oe.url),ye()}catch(Pe){ye(Pe)}}syncRTLPluginState(ne,oe,ye){if(s.fH.isParsed())ye(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(ye);else try{s.fH.setState(oe);const Pe=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||Pe==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(Pe),s.fH.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Pe){ye(Pe)}}setDracoUrl(ne,oe){this.dracoUrl=oe}getAvailableImages(ne,oe){this.availableImages[ne]||(this.availableImages[ne]={});let ye=this.availableImages[ne][oe];return ye||(ye=[]),ye}getAvailableModels(ne,oe){this.availableModels[ne]||(this.availableModels[ne]={});let ye=this.availableModels[ne][oe];return ye||(ye={}),ye}getLayerIndex(ne,oe){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ye=this.layerIndexes[ne][oe];return ye||(ye=this.layerIndexes[ne][oe]=new ae,ye.scope=oe),ye}getWorkerSource(ne,oe,ye,Pe){const xe=this.workerSources;return xe[ne]||(xe[ne]={}),xe[ne][Pe]||(xe[ne][Pe]={}),xe[ne][Pe][oe]||(xe[ne][Pe][oe]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),xe[ne][Pe][oe][ye]||(xe[ne][Pe][oe][ye]=new this.workerSourceTypes[oe]({send:(Fe,st,$e,lt,Pt,It)=>this.actor.send(Fe,st,$e,ne,Pt,It),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Pe),this.getAvailableImages(ne,Pe),this.getAvailableModels(ne,Pe),this.isSpriteLoaded[ne][Pe],void 0,this.brightness,this.worldview)),xe[ne][Pe][oe][ye]}rasterizeImagesWorker(ne,oe,ye){const Pe=new Map;for(const[xe,{image:Fe,imageVariant:st}]of oe.tasks.entries()){const $e=this.imageRasterizer.rasterize(st,Fe,oe.scope,ne);Pe.set(xe,$e)}ye(void 0,Pe)}removeRasterizedImages(ne,oe,ye){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,ne),ye()}enforceCacheSizeLimit(ne,oe){s.fJ(oe)}getWorkerPerformanceMetrics(ne,oe,ye){ye(void 0,void 0)}}return s.fF(self)&&(self.worker=new oi(self)),oi}),T(["./shared"],function(s){var V="3.18.1";const B={create:"create",load:"load",fullLoad:"fullLoad"},W={mark(f){performance.mark(f)},measure(f,n,c){performance.measure(f,n,c)}};function Y(f){const n=f.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var ae,he={},Qe=(function(){if(ae)return he;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,E,I=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(I);try{E=new Worker(M),b=!0}catch{b=!1}return E&&E.terminate(),URL.revokeObjectURL(M),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var E=b.getContext("2d");if(!E)return!1;var I=E.getImageData(0,0,1,1);return I&&I.width===b.width})()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=(function(b){var E,I=(function(M){var O=document.createElement("canvas"),z=Object.create(f.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=M,O.getContext("webgl2",z)})(b);if(!I)return!1;try{E=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!E||I.isContextLost())&&(I.shaderSource(E,"void main() {}"),I.compileShader(E),I.getShaderParameter(E,I.COMPILE_STATUS)===!0)})(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}ae=1,he.supported=f,he.notSupportedReason=n;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},he})();function Ye(f,n,c){const p=document.createElement(f);return n!=null&&(p.className=n),c&&c.appendChild(p),p}function Ke(f,n,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(n))p.setAttributeNS(null,x,String(n[x]));return c&&c.appendChild(p),p}const at=typeof document<"u"?document.documentElement&&document.documentElement.style:null,nt=at&&at.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ge;function Mt(){at&&nt&&(Ge=at[nt],at[nt]="none")}function cn(){at&&nt&&(at[nt]=Ge)}function St(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",St,!0)}function Oe(){window.addEventListener("click",St,!0),window.setTimeout(()=>{window.removeEventListener("click",St,!0)},0)}function Re(f,n){const c=f.getBoundingClientRect();return He(f,c,n)}function Ve(f,n){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<n.length;x++)p.push(He(f,c,n[x]));return p}function Je(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function He(f,n,c){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new s.P((c.clientX-n.left)*p,(c.clientY-n.top)*p)}const tt="01",ve="NO_ACCESS_TOKEN";class Ht{constructor(n,c,p){this._transformRequestFn=n,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",tt,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,c){return this._transformRequestFn&&this._transformRequestFn(n,c)||{url:n}}normalizeStyleURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.params.push(`sdk=js-${V}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(n,c){if(!s.h(n))return n;const p=wt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(n,c,p,x){if(!s.h(n))return n;const b=wt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||c)}normalizeIconsetURL(n,c){const p=wt(n);return s.h(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Kt(p)}normalizeSpriteURL(n,c,p,x){const b=wt(n);return s.h(n)?(b.path=`/styles/v1${b.path}/sprite${c}${p}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${c}${p}`,Kt(b))}normalizeTileURL(n,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const x=wt(n);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||(function(E){for(const I of E){const M=I.match(/^access_token=(.*)$/);if(M)return M[1]}return null})(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(n,c){const p=wt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return c&&(b=b.filter(E=>!E.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(n,c){const p=!!c&&s.h(c),x=[];for(const b of n.tiles||[])s.j(b)?x.push(this.canonicalizeTileURL(b,p)):x.push(b);return x}_makeAPIURL(n,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=wt(s.e.API_URL);if(n.protocol=x.protocol,n.authority=x.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(x.path!=="/"&&(n.path=`${x.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Kt(n);if(c=c||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${c||""}`),Kt(n)}}const dn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wt(f){const n=f.match(dn);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Kt(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const wn="mapbox.eventData";function Kn(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class it{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const c=Kn(s.e.ACCESS_TOKEN);let p="";return p=c&&c.u?s.f(c.u):s.e.ACCESS_TOKEN||"",n?`${wn}.${n}:${p}`:`${wn}:${p}`}fetchEventData(){const n=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(n)try{const b=localStorage.getItem(c);b&&(this.eventData=JSON.parse(b));const E=localStorage.getItem(p);E&&(this.anonId=E);const I=localStorage.getItem(x);I&&(this.anonIdTimestamp=Number(I));const M=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<M)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),b=this.anonId,E=this.anonIdTimestamp;if(n&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),E&&localStorage.setItem(x,E.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,c,p,x){if(!s.e.EVENTS_URL)return;const b=wt(s.e.EVENTS_URL);b.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(n).toISOString()},I=c?Object.assign(E,c):E,M={url:Kt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(M,O=>{this.pendingRequest=null,p(O),this.saveEventData(),this.processRequests(x)})}queueRequest(n,c){this.queue.push(n),this.processRequests(c)}}class ft extends it{constructor(n){super("metrics"),n&&(this.data=n)}postMetricsEvent(n){if(!s.e.EVENTS_URL||!n&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},n)}}const Qt=new class extends it{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>s.h(c)||s.j(c))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Kn(s.e.ACCESS_TOKEN),c=n?n.u:s.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),E=new Date(x),I=(x-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||b.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:V,skuId:tt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},f):this.processRequests()}},Be=Qt.postTurnstileEvent.bind(Qt),En=new class extends it{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,c,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(ve)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:V,skuId:tt,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},Qn=En.postMapLoadEvent.bind(En),$n=new class extends it{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=s.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:c,style:p,importedStyles:x}=n;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(c),E={mapInstanceId:b,eventId:this.getEventId(b),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},f)}},ki=$n.postStyleLoadEvent.bind($n),er=new ft({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),qn=er.postMetricsEvent.bind(er),Ni=new ft({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Vr=Ni.postMetricsEvent.bind(Ni),Fa=new class extends it{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:c}=this.queue.shift(),p=(function(x){const b=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),I=(function($){const J={};if($){for(const K in $)if(K!=="other")for(const ee of $[K]){const re=`${K}ResolveRangeMin`,pe=`${K}ResolveRangeMax`,fe=`${K}RequestCount`,ue=`${K}RequestCachedCount`;J[re]=Math.min(J[re]||1/0,ee.startTime),J[pe]=Math.max(J[pe]||-1/0,ee.responseEnd);const Ie=Te=>{J[Te]===void 0&&(J[Te]=0),++J[Te]};ee.transferSize!==void 0&&ee.transferSize===0&&Ie(ue),Ie(fe)}}return J})((function($,J){const K={};if($)for(const ee of $){const re=J(ee);K[re]===void 0&&(K[re]=[]),K[re].push(ee)}return K})(b,Y)),M=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=O?O.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},G=($,J,K)=>{K!=null&&$.push({name:J,value:K.toString()})};for(const $ in I)G(H.counters,$,I[$]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(G(H.counters,"interactionRangeMin",x.interactionRange[0]),G(H.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const $ of Object.values(B)){const J=E.find(K=>K.name===$);J&&G(H.counters,$,J.startTime)}return G(H.counters,"visibilityHidden",x.visibilityHidden),G(H.attributes,"style",(function($){if($)for(const J of $){const K=J.name.split("?")[0];if(s.i(K)){const ee=K.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}})(b)),G(H.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),G(H.attributes,"fogEnabled",x.fogEnabled?"true":"false"),G(H.attributes,"projection",x.projection),G(H.attributes,"zoom",x.zoom),G(H.metadata,"devicePixelRatio",M),G(H.metadata,"connectionEffectiveType",z),G(H.metadata,"navigatorUserAgent",navigator.userAgent),G(H.metadata,"screenWidth",window.screen.width),G(H.metadata,"screenHeight",window.screen.height),G(H.metadata,"windowWidth",window.innerWidth),G(H.metadata,"windowHeight",window.innerHeight),G(H.metadata,"mapWidth",x.width/M),G(H.metadata,"mapHeight",x.height/M),G(H.metadata,"webglRenderer",x.renderer),G(H.metadata,"webglVendor",x.vendor),G(H.metadata,"sdkVersion",V),G(H.metadata,"sdkIdentifier","mapbox-gl-js"),H})(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(n,p,()=>{},f)}},Cn=Fa.postPerformanceEvent.bind(Fa),vi=new class extends it{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,c,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=wt(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${n||""}`),x.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const b={url:Kt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,c,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(ve)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},_r=vi.getSessionAPI.bind(vi),Hi=new Set;function Wr(f,n){n?Hi.add(f):Hi.delete(f)}class tr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,c){this._updatedSourceCaches[n]=c,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const c=n.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(n.id),this.setDirty()}removeLayer(n){const c=n.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][n.id]=n,this._updatedLayers[c].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const c in this._updatedLayers)n[c]=n[c]||{},n[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)n[c]=n[c]||{},n[c].removedIds=Object.keys(this._removedLayers[c]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function yr(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class Xr extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const c=this.atlasTexture.get(n);c&&(c.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(n.id,n)}removeImageProvider(n,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(n)}getPendingImageProviders(){const n=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,c){if(this.loaded.get(c)!==n&&(this.loaded.set(c,n),n)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(n,c){return!!this.getImage(n,c)}getImage(n,c){return this.images.get(c).get(n.toString())}addImage(n,c,p){this._validate(n,p)&&this.images.get(c).set(n.toString(),p)}_validate(n,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,c){if(!n)return!0;let p=0;for(const x of n){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(n,c){return n?n.length!==4||!c.usvg&&(n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,c,p){const x=this.images.get(c).get(n.toString());p.version=x.version+1,this.images.get(c).set(n.toString(),p),this.updatedImages.get(c).add(n),this.removeFromImageRasterizerCache(n,c)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,c){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([n],c))}removeImage(n,c){const p=this.images.get(c),x=p.get(n.toString());p.delete(n.toString()),this.patterns.get(c).delete(n.toString()),this.removeFromImageRasterizerCache(n,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(c=>s.I.from(c))}getImages(n,c,p){const x=[],b=[],E=this.imageProviders.get(c);for(const z of n){if(!z.iconsetId){x.push(z);continue}const H=E.get(z.iconsetId);H&&(this.getImage(z,c)?b.push(z):H.addPendingRequest(z))}if(x.length===0)return void this._notify(b,c,p);let I=!0;const M=!!this.loaded.get(c),O=this.images.get(c);if(!M)for(const z of x)O.has(z.toString())||(I=!1);M||I?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(n,c){const p=new Map,{tasks:x,scope:b}=n;for(const[E,I]of x.entries()){const M=this.getImage(I.id,b);M&&p.set(E,{image:M,imageVariant:I})}this._rasterizeImages(b,p,c)}_rasterizeImages(n,c,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:n},p);else{const x=new Map;for(const[b,{image:E,imageVariant:I}]of c.entries())x.set(b,this.imageRasterizer.rasterize(I,E,n,0));p(void 0,x)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,c,p){const x=this.images.get(c),b=new Map;for(const E of n){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:E.name}))}const I=x.get(E.toString());if(!I){s.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(M,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),b.set(s.I.toString(E),M)}p(null,b)}getPixelSize(n){const{width:c,height:p}=this.atlasImage.get(n);return{width:c,height:p}}getPattern(n,c,p){const x=n.toString(),b=this.patterns.get(c),E=b.get(x),I=this.getImage(n,c);if(!I)return null;if(E){if(E.position.version===I.version)return E.position;E.position.version=I.version}else{if(I.usvg&&!I.data){const M=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const O=new s.A(n).scaleSelf(s.o.devicePixelRatio),z=new Map([[O.toString(),{image:I,imageVariant:O}]]);return this._rasterizeImages(c,z,(H,G)=>this.storePatternImage(O,c,I,p,G)),null}this.storePattern(n,c,I)}return this._updatePatternAtlas(c,p),b.get(x).position}getPatternInFlightId(n,c){return s.B(n,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,c,p,x,b){const E=n.toString(),I=b?b.get(E):void 0;I&&(p.data=I,this.storePattern(n.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),c)))}storePattern(n,c,p){const x={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},b=new s.F(x,p,s.C);this.patterns.get(c).set(n.toString(),{bin:x,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,c){const p=n.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new s.T(n,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,c){const p=this.patterns.get(n),x=Array.from(p.values()).map(({bin:O})=>O),{w:b,h:E}=s.G(x),I=this.atlasImage.get(n);I.resize({width:b||1,height:E||1});const M=this.images.get(n);for(const[O,{bin:z,position:H}]of p.entries()){let G=H.padding;const $=z.x+G,J=z.y+G,K=M.get(O).data,ee=K.width,re=K.height;G=G>1?G-1:G,s.q.copy(K,I,{x:0,y:0},{x:$,y:J},{width:ee,height:re},c),s.q.copy(K,I,{x:0,y:re-G},{x:$,y:J-G},{width:ee,height:G},c),s.q.copy(K,I,{x:0,y:0},{x:$,y:J+re},{width:ee,height:G},c),s.q.copy(K,I,{x:ee-G,y:0},{x:$-G,y:J},{width:G,height:re},c),s.q.copy(K,I,{x:0,y:0},{x:$+ee,y:J},{width:G,height:re},c),s.q.copy(K,I,{x:ee-G,y:re-G},{x:$-G,y:J-G},{width:G,height:G},c),s.q.copy(K,I,{x:0,y:re-G},{x:$+ee,y:J-G},{width:G,height:G},c),s.q.copy(K,I,{x:0,y:0},{x:$+ee,y:J+re},{width:G,height:G},c),s.q.copy(K,I,{x:ee-G,y:0},{x:$-G,y:J+re},{width:G,height:G},c)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,c){const p=this.images.get(c);for(const x of n){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const b=p.get(x.toString());yr(b)&&this.updateImage(x,c,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function to(f){const n=f.value,c=f.valueSpec,p=f.style,x=f.styleSpec,b=f.key,E=f.arrayElementValidator||Vi;if(!Array.isArray(n))return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(c.length&&n.length!==c.length)return[new s.V(b,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new s.V(b,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(I.function=c.function),s.H(c.value)&&(I=c.value);let M=[];for(let O=0;O<n.length;O++)M=M.concat(E({array:n,arrayIndex:O,value:n[O],valueSpec:I,style:p,styleSpec:x,key:`${b}[${O}]`},!0));return M}function Rl(f){const n=f.key,c=f.value,p=f.valueSpec;if(!s.L(c))return[new s.V(n,c,`number expected, ${s.K(c)} found`)];if(c!=c)return[new s.V(n,c,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[f.arrayIndex]),c<x)return[new s.V(n,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[f.arrayIndex]),c>x)return[new s.V(n,c,`${c} is greater than the maximum value ${x}`)]}return[]}function rc(f){const n=f.key,c=f.value;if(!s.H(c))return[new s.V(n,c,`object expected, ${s.K(c)} found`)];const p=f.valueSpec,x=s.J(c.type);let b,E,I,M={};const O=x!=="categorical"&&c.property===void 0,z=!O,H=(function(K){const ee=K.stops;return Array.isArray(ee)&&Array.isArray(ee[0])&&s.H(ee[0][0])})(c),G=Kr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(K){if(x==="identity")return[new s.V(K.key,K.value,'identity function may not have a "stops" property')];let ee=[];const re=K.value;return ee=ee.concat(to({key:K.key,value:re,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:$})),Array.isArray(re)&&re.length===0&&ee.push(new s.V(K.key,re,"array must have at least one stop")),ee},default:function(K){return Vi({key:K.key,value:K.value,valueSpec:p,style:K.style,styleSpec:K.styleSpec})}}});return x==="identity"&&O&&G.push(new s.V(f.key,f.value,'missing required property "property"')),x==="identity"||c.stops||G.push(new s.V(f.key,f.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!s.M(p)&&G.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(z&&!s.N(p)?G.push(new s.V(f.key,f.value,"property functions not supported")):O&&!s.O(p)&&G.push(new s.V(f.key,f.value,"zoom functions not supported"))),x!=="categorical"&&!H||c.property!==void 0||G.push(new s.V(f.key,f.value,'"property" property is required')),G;function $(K){let ee=[];const re=K.value,pe=K.key;if(!Array.isArray(re))return[new s.V(pe,re,`array expected, ${s.K(re)} found`)];if(re.length!==2)return[new s.V(pe,re,`array length 2 expected, length ${re.length} found`)];if(H){if(!s.H(re[0]))return[new s.V(pe,re,`object expected, ${s.K(re[0])} found`)];const fe=re[0];if(fe.zoom===void 0)return[new s.V(pe,re,"object stop key must have zoom")];if(fe.value===void 0)return[new s.V(pe,re,"object stop key must have value")];const ue=s.J(fe.zoom);if(typeof ue!="number")return[new s.V(pe,fe.zoom,"stop zoom values must be numbers")];if(I&&I>ue)return[new s.V(pe,fe.zoom,"stop zoom values must appear in ascending order")];ue!==I&&(I=ue,E=void 0,M={}),ee=ee.concat(Kr({key:`${pe}[0]`,value:re[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Rl,value:J}}))}else ee=ee.concat(J({key:`${pe}[0]`,value:re[0],style:K.style,styleSpec:K.styleSpec},re));return s.Q(s.S(re[1]))?ee.concat([new s.V(`${pe}[1]`,re[1],"expressions are not allowed in function stops.")]):ee.concat(Vi({key:`${pe}[1]`,value:re[1],valueSpec:p,style:K.style,styleSpec:K.styleSpec}))}function J(K,ee){const re=s.K(K.value),pe=s.J(K.value),fe=K.value!==null?K.value:ee;if(b){if(re!==b)return[new s.V(K.key,fe,`${re} stop domain type must match previous stop domain type ${b}`)]}else b=re;if(re!=="number"&&re!=="string"&&re!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new s.V(K.key,fe,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&x!=="categorical"){let ue=`number expected, ${re} found`;return s.N(p)&&x===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(K.key,fe,ue)]}return x!=="categorical"||re!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?x!=="categorical"&&re==="number"&&typeof pe=="number"&&typeof E=="number"&&E!==void 0&&pe<E?[new s.V(K.key,fe,"stop domain values must appear in ascending order")]:(E=pe,x==="categorical"&&pe in M?[new s.V(K.key,fe,"stop domain values must be unique")]:(M[pe]=!0,[])):[new s.V(K.key,fe,`integer expected, found ${String(pe)}`)]}}function jr(f){const n=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const c=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(c))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return bs(c,f);if(f.expressionContext==="appearance")return en(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(c,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(c))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bs(f,n){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return f instanceof s._&&c.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(x=>{p.push(...bs(x,n))}),p)}function en(f,n){const c=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)c.add(x);if(c.size===0)return[];const p=[];return f instanceof s._&&!c.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(x=>{p.push(...en(x,n))}),p)}function Tn(f){const n=f.key,c=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(s.J(c))===-1&&x.push(new s.V(n,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(s.J(c))===-1&&x.push(new s.V(n,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function si(f){return s.a2(s.S(f.value))?jr(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Li(f)}function Li(f){const n=f.value,c=f.key;if(!Array.isArray(n))return[new s.V(c,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(c,n,"filter array must have at least 1 element")];const p=f.styleSpec;let x=Tn({key:`${c}[0]`,value:n[0],valueSpec:p.filter_operator});const b=()=>{n.length>=2&&(s.a0(n[1])||x.push(new s.V(`${c}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let E=2;E<n.length;E++)s.J(n[1])==="$type"?x=x.concat(Tn({key:`${c}[${E}]`,value:n[E],valueSpec:p.geometry_type})):s.a0(n[E])||s.L(n[E])||s.$(n[E])||x.push(new s.V(`${c}[${E}]`,n[E],`string, number, or boolean expected, ${s.K(n[E])} found.`))};switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&x.push(new s.V(c,n,`"$type" cannot be use with operator "${n[0]}"`)),n.length!==3&&x.push(new s.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"==":case"!=":n.length!==3&&x.push(new s.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let E=1;E<n.length;E++)x=x.concat(Li({key:`${c}[${E}]`,value:n[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":n.length!==2?x.push(new s.V(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||x.push(new s.V(`${c}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return x}function Ii(f,n){const c=f.key,p=f.style,x=f.layer,b=f.styleSpec,E=f.value,I=f.objectKey,M=b[`${n}_${f.layerType}`];if(!M)return[];const O=I.match(/^(.*)-use-theme$/);if(O&&M[O[1]])return s.Q(s.S(E))?[].concat(Vi({key:c,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:I})):Vi({key:c,value:E,valueSpec:{type:"string"},style:p,styleSpec:b});const z=I.match(/^(.*)-transition$/);if(n==="paint"&&z&&M[z[1]]&&M[z[1]].transition)return Vi({key:c,value:E,valueSpec:b.transition,style:p,styleSpec:b});const H=f.valueSpec||M[I];if(!H)return[new s.a3(c,E,`unknown property "${I}"`)];let G;if(s.a0(E)&&s.N(H)&&!H.tokens&&(G=/^{([^}]+)}$/.exec(E))){const J=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new s.V(c,E,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const $=[];if(f.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||$.push(new s.V(c,E,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(E))&&s.J(E.type)==="identity"&&$.push(new s.V(c,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.N(H)&&(s.a5(H)||s.O(H))){const J=s.W(s.S(E),H).value,K="expression"in J&&J.expression||"_styleExpression"in J&&J._styleExpression&&J._styleExpression.expression;K&&!s.X(K,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(K)&&s.Z(K)||$.push(new s.V(c,E,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(Vi({key:f.key,value:E,valueSpec:H,style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:I}))}function Fs(f){return Ii(f,"paint")}function _s(f){return Ii(f,"layout")}function ms(f){let n=[];const c=f.value,p=f.key,x=f.style,b=f.styleSpec;if(!s.H(c))return[new s.V(p,c,"object expected")];c.type||c.ref||n.push(new s.V(p,c,'either "type" or "ref" is required'));let E=s.J(c.type);const I=s.J(c.ref);if(c.id){const M=s.J(c.id);for(let O=0;O<f.arrayIndex;O++){const z=x.layers[O];s.J(z.id)===M&&n.push(new s.V(p,c.id,`duplicate layer id "${M}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let M;["type","source","source-layer","filter","layout"].forEach(O=>{O in c&&n.push(new s.V(p,c[O],`"${O}" is prohibited for ref layers`))}),x.layers.forEach(O=>{s.J(O.id)===I&&(M=O)}),M?M.ref?n.push(new s.V(p,c.ref,"ref cannot reference another ref layer")):E=s.J(M.type):typeof I=="string"&&n.push(new s.V(p,c.ref,`ref layer "${I}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(c.source)if(s.a0(c.source)){const M=x.sources&&x.sources[c.source],O=M&&s.J(M.type);M?O==="vector"&&E==="raster"?n.push(new s.V(p,c.source,`layer "${c.id}" requires a raster source`)):O==="raster"&&E!=="raster"?n.push(new s.V(p,c.source,`layer "${c.id}" requires a vector source`)):O!=="vector"||c["source-layer"]?O==="raster-dem"&&E!=="hillshade"?n.push(new s.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&O==="geojson"&&!M.lineMetrics?n.push(new s.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&O!=="raster-array"&&n.push(new s.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new s.V(p,c.source,`source "${c.source}" not found`))}else n.push(new s.V(`${p}.source`,c.source,'"source" must be a string'));else n.push(new s.V(p,c,'missing required property "source"'));return n=n.concat(Kr({key:p,value:c,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vi({key:`${p}.type`,value:c.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:M=>si(Object.assign({layerType:E},M)),layout:M=>Kr({layer:c,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":O=>_s(Object.assign({layerType:E},O))}}),paint:M=>Kr({layer:c,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":O=>Fs(Object.assign({layerType:E,layer:c},O))}}),appearances(M){const O=to({key:M.key,value:M.value,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:G=>(function($){const{key:J,layer:K,layerType:ee}=$,re=s.J($.value),pe=s.J(re.name),fe=s.J(re.condition),ue=Kr({key:J,value:re,valueSpec:$.styleSpec.appearance,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{condition:Ie=>(function(Te){const Ae=[];return Ae.push(...jr({key:Te.key,value:Te.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Ae})(Object.assign({layer:K,layerType:ee},Ie)),properties:Ie=>(function(Te){const Ae=[],{styleSpec:be,layer:ge,layerType:ke}=Te,ze=be[`paint_${ke}`],je=be[`layout_${ke}`],Xe=Te.object[Te.objectKey];for(const Ze in Xe){const ut=Ze in ze?"paint":Ze in je?"layout":void 0;if(!ut){Ae.push(new s.V(Te.key,Ze,`unknown property "${Ze}" for layer type "${ke}"`));continue}const xt=Object.assign({},Te,{key:`${Te.key}.${Ze}`,object:Xe,objectKey:Ze,layer:ge,layerType:ke,value:Xe[Ze],valueSpec:ut==="paint"?ze[Ze]:je[Ze]});Ae.push(...Ii(xt,ut))}return Ae})(Object.assign({layer:K,layerType:ee},Ie))}});return pe!=="hidden"&&fe===void 0&&ue.push(new s.V($.key,"name",'Appearance with name different than "hidden" must have a condition')),ue})(Object.assign({layerType:E,layer:c},G))}),z=Array.isArray(M.value)?M.value:[],H=new Set;return z.forEach((G,$)=>{const J=s.J(G.name);if(J)if(H.has(J)){const K=s.J(c.id);O.push(new s.V(M.key,J,`Duplicated appearance name "${J}" for layer "${K}"`))}else H.add(J)}),O}}})),n}function Pr({key:f,value:n}){return s.a0(n)?[]:[new s.V(f,n,`string expected, ${s.K(n)} found`)]}const mr={promoteId:function f({key:n,value:c}){if(s.a0(c))return Pr({key:n,value:c});if(Array.isArray(c)){const x=[],b=s.S(c),E=s.U(b);return E.result==="error"&&E.value.forEach(I=>{x.push(new s.V(`${n}${I.key}`,null,`${I.message}`))}),s.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),x}if(!s.H(c))return[new s.V(n,c,`string, expression or object expected, "${s.K(c)}" found`)];const p=[];for(const x in c)p.push(...f({key:`${n}.${x}`,value:c[x]}));return p}};function Fi(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(c,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(c,n,'"type" is required')];const b=s.J(n.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||E.push(new s.a3(c,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Kr({key:c,value:n,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:mr})),E;case"geojson":if(E=Kr({key:c,value:n,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:mr}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${c}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const I in n.clusterProperties){const M=n.clusterProperties[I];if(!Array.isArray(M))return[new s.V(`${c}.clusterProperties.${I}`,M,"array expected")];const[O,z]=M,H=typeof O=="string"?[O,["accumulated"],["get",I]]:O;E.push(...jr({key:`${c}.${I}.map`,value:z,expressionContext:"cluster-map"})),E.push(...jr({key:`${c}.${I}.reduce`,value:H,expressionContext:"cluster-reduce"}))}}return E;case"video":return Kr({key:c,value:n,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Kr({key:c,value:n,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new s.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tn({key:`${c}.type`,value:n.type,valueSpec:{values:ia(p)}})}}function ia(f){return f.source.reduce((n,c)=>{const p=f[c];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values||{}))),n},[])}function ws(f){const n=f.value,c=f.styleSpec,p=c.light,x=f.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let b=[];for(const E in n){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);b=b.concat(M&&p[M[1]]?Vi({key:E,value:n[E],valueSpec:{type:"string"},style:x,styleSpec:c}):I&&p[I[1]]&&p[I[1]].transition?Vi({key:E,value:n[E],valueSpec:c.transition,style:x,styleSpec:c}):p[E]?Vi({key:E,value:n[E],valueSpec:p[E],style:x,styleSpec:c}):[new s.V(E,n[E],`unknown property "${E}"`)])}return b}function cl(f){const n=f.value;if(!n)return[];const c=f.key;if(!s.H(n))return[new s.V(c,n,`object expected, ${s.K(n)} found`)];let p=[];const x=f.styleSpec,b=x["light-3d"],E=f.style,I=f.style.lights;for(const z of["type","id"])if(!(z in n))return p=p.concat([new s.V(c,n,`missing property "${z}"`)]),p;if(!s.a0(n.type))return p=p.concat([new s.V(`${c}.type`,n.type,"string expected")]),p;if(I)for(let z=0;z<f.arrayIndex;z++){const H=s.J(n.type),G=I[z];s.J(G.type)===H&&p.push(new s.V(c,n.id,`duplicate light type "${n.type}", previously defined at line ${G.id.__line__}`))}const M=`properties_light_${n.type}`;if(!(M in x))return p=p.concat([new s.V(`${c}.type`,n,`Invalid light type ${n.type}`)]),p;const O=x[M];for(const z in n)if(z==="properties"){const H=n[z];if(!s.H(H))return p=p.concat([new s.V("properties",H,`object expected, ${s.K(H)} found`)]),p;for(const G in H){const $=G.match(/^(.*)-transition$/),J=G.match(/^(.*)-use-theme$/);p=p.concat(J&&O[J[1]]?Vi({key:z,value:H[G],valueSpec:{type:"string"},style:E,styleSpec:x}):$&&O[$[1]]&&O[$[1]].transition?Vi({key:z,value:n[z],valueSpec:x.transition,style:E,styleSpec:x}):O[G]?Vi({key:G,value:H[G],valueSpec:O[G],style:E,styleSpec:x}):[new s.a3(f.key,H[G],`unknown property "${G}"`)])}}else p=p.concat(b[z]?Vi({key:z,value:n[z],valueSpec:b[z],style:E,styleSpec:x}):[new s.a3(z,n[z],`unknown property "${z}"`)]);return p}function Ia(f){const n=f.value,c=f.key,p=f.style,x=f.styleSpec,b=x.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let E=[];for(const I in n){const M=I.match(/^(.*)-transition$/),O=I.match(/^(.*)-use-theme$/);E=E.concat(O&&b[O[1]]?Vi({key:I,value:n[I],valueSpec:{type:"string"},style:p,styleSpec:x}):M&&b[M[1]]&&b[M[1]].transition?Vi({key:I,value:n[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?Vi({key:I,value:n[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,n[I],`unknown property "${I}"`)])}if(n.source)if(s.a0(n.source)){const I=p.sources&&p.sources[n.source],M=I&&s.J(I.type);I?M!=="raster-dem"&&E.push(new s.V(`${c}.source`,n.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):E.push(new s.V(`${c}.source`,n.source,`source "${n.source}" not found`))}else E.push(new s.V(`${c}.source`,n.source,"source must be a string"));else E.push(new s.V(c,n,'terrain is missing required property "source"'));return E}function bo(f){const n=f.value,c=f.style,p=f.styleSpec,x=p.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let b=[];for(const E in n){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);b=b.concat(M&&x[M[1]]?Vi({key:E,value:n[E],valueSpec:{type:"string"},style:c,styleSpec:p}):I&&x[I[1]]&&x[I[1]].transition?Vi({key:E,value:n[E],valueSpec:p.transition,style:c,styleSpec:p}):x[E]?Vi({key:E,value:n[E],valueSpec:x[E],style:c,styleSpec:p}):[new s.a3(E,n[E],`unknown property "${E}"`)])}return b}const gs={"*":()=>[],array:to,boolean:function(f){const n=f.value,c=f.key;return s.$(n)?[]:[new s.V(c,n,`boolean expected, ${s.K(n)} found`)]},number:Rl,color:function({key:f,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(f,n,`color expected, "${n}" found`)]:[]:[new s.V(f,n,`color expected, ${s.K(n)} found`)]},enum:Tn,filter:si,function:rc,layer:ms,object:Kr,source:Fi,model:s.a7,light:ws,"light-3d":cl,terrain:Ia,fog:bo,string:Pr,formatted:function(f){return Pr(f).length===0?[]:jr(f)},resolvedImage:function(f){return Pr(f).length===0?[]:jr(f)},projection:function(f){const n=f.value,c=f.styleSpec,p=c.projection,x=f.style;if(s.H(n)){let b=[];for(const E in n)b=b.concat(Vi({key:E,value:n[E],valueSpec:p[E],style:x,styleSpec:c}));return b}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(f){const n=f.key,{value:c,styleSpec:p}=f;if(!s.H(c))return[new s.V(n,c,"import must be an object")];const{data:x,...b}=c;Object.defineProperty(b,"__line__",{value:c.__line__,enumerable:!1});let E=Kr(Object.assign({},f,{value:b,valueSpec:p.import}));return s.J(b.id)===""&&E.push(new s.V(`${f.key}.id`,b,"import id can't be an empty string")),x&&(E=E.concat(_u(x,p,{key:`${f.key}.data`}))),E},iconset:function(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(c,n,"object expected")];if(!n.type)return[new s.V(c,n,'"type" is required')];const b=s.J(n.type);let E=[];if(E=E.concat(Kr({key:c,value:n,valueSpec:p[`iconset_${b}`],style:x,styleSpec:p})),(function(I,M){return!(I!=="source"||!M.source)})(b,n)){const I=x.sources&&x.sources[n.source],M=I&&s.J(I.type);I?M!=="raster-array"&&E.push(new s.V(c,n.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):E.push(new s.V(c,n.source,`source "${n.source}" not found`))}return E}};function Vi(f,n=!1){const c=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression){if(s.a4(s.J(c)))return rc(f);if(s.Q(s.S(c)))return jr(f)}if(p.type&&gs[p.type]){const b=gs[p.type](f);return n===!0&&b.length>0&&Array.isArray(f.value)?jr(f):b}return Kr(Object.assign({},f,{valueSpec:p.type?x[p.type]:p}))}function Kr(f){const n=f.key,c=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},b=f.style,E=f.styleSpec;if(!s.H(c))return[new s.V(n,c,`object expected, ${s.K(c)} found`)];let I=[];for(const M in c){const O=M.split(".")[0];let z;x[O]?z=x[O]:p[O]?z=Vi:x["*"]?z=x["*"]:p["*"]&&(z=Vi),z?I=I.concat(z({key:(n&&`${n}.`)+M,value:c[M],valueSpec:p[O]||p["*"],style:b,styleSpec:E,object:c,objectKey:M},c)):I.push(new s.a3(n,c[M],`unknown property "${M}"`))}for(const M in p){if(x[M])continue;const O=p[M];O.required&&O.default===void 0&&c[M]===void 0&&I.push(new s.V(n,c,`missing required property "${M}"`))}return I}function wo({key:f,value:n}){const c=Pr({key:f,value:n});if(c.length)return c;const p=n;return p.indexOf("{fontstack}")===-1&&c.push(new s.V(f,n,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new s.V(f,n,'"glyphs" url must include a "{range}" token')),c}function _u(f,n=s.a6,c={}){return Kr({key:c.key||"",value:f,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:f,objectElementValidators:{glyphs:wo}})}function Va(f,n=s.a6){return xe(_u(f,n))}const ul=f=>xe(Fi(f)),hl=f=>xe(ws(f)),Dt=f=>xe(cl(f)),no=f=>xe(Ia(f)),th=f=>xe(bo(f)),Lc=f=>xe((function(n){const c=n.value,p=n.style,x=n.styleSpec,b=x.snow;if(c===void 0)return[];if(!s.H(c))return[new s.V("snow",c,`object expected, ${s.K(c)} found`)];let E=[];for(const I in c){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&b[M[1]]&&b[M[1]].transition?Vi({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?Vi({key:I,value:c[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return E})(f)),oi=f=>xe((function(n){const c=n.value,p=n.style,x=n.styleSpec,b=x.rain;if(c===void 0)return[];if(!s.H(c))return[new s.V("rain",c,`object expected, ${s.K(c)} found`)];let E=[];for(const I in c){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&b[M[1]]&&b[M[1]].transition?Vi({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):b[I]?Vi({key:I,value:c[I],valueSpec:b[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return E})(f)),qe=f=>xe(ms(f)),ne=f=>xe(si(f)),oe=f=>xe(Fs(f)),ye=f=>xe(_s(f)),Pe=f=>xe(s.a7(f));function xe(f){return f.slice().sort((n,c)=>n.line&&c.line?n.line-c.line:0)}function Fe(f,n){let c=!1;if(n&&n.length)for(const p of n)p instanceof s.a3?s.w(p.message):(f.fire(new s.y(new Error(p.message))),c=!0);return c}const st=s.a6.light;let $e;class lt extends s.E{constructor(n,c="flat"){super(),this._transitionable=new s.a8($e||($e=new s.a9({anchor:new s.aa(st.anchor),position:new s.ab(st.position),color:new s.aa(st.color),intensity:new s.aa(st.intensity)}))),this.setLight(n,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c,p={}){this._validate(hl,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=c)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Fe(this,n.call(Va,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Pt=s.a6.terrain;let It=class extends s.E{constructor(f,n,c,p,x){super(),this.scope=c,this._transitionable=new s.a8(new s.a9({source:new s.aa(Pt.source),exaggeration:new s.aa(Pt.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=x}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let c=-1,p=-1,x=1;for(const b of n.zoomStops)x=n.evaluate(new s.ac(b,{worldview:this.worldview})),x>.01?(c=b,p=-1):p=b;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const tn=.05;function yn(f,n,c,p){const x=s.ah(45,65,c),[b,E]=bn(f,p);let I=1-Math.min(1,Math.exp((n-b)/(E-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*f.alpha}function bn(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}function Ln(f,n,c,p,x){const b=s.af([],[n,c,p],x.mercatorFogMatrix);return yn(f,s.ag(b),x.pitch,x._fov)}function Vn(f,n,c,p,x,b,E){const I=[[c,p,0],[x,p,0],[x,b,0],[c,b,0]];let M=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const z of I){const H=s.af([],z,n),G=s.ag(H);M=Math.min(M,G),O=Math.max(O,G)}return[yn(f,M,E.pitch,E._fov),yn(f,O,E.pitch,E._fov)]}const vn=s.a6.fog;class kn extends s.E{constructor(n,c,p,x){super();const b=new s.a9({range:new s.aa(vn.range),color:new s.aa(vn.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(vn["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(vn["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(vn["horizon-blend"]),"star-intensity":new s.aa(vn["star-intensity"]),"vertical-range":new s.aa(vn["vertical-range"])});this._transitionable=new s.a8(b,p,new Map(x)),this.set(n,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new s.ai(b),this.scope=p}get state(){const n=this._transform,c=n.projection.name==="globe",p=s.aj(n.zoom),x=this.properties.get("range"),b=[.5,3];return{range:c?[s.ak(b[0],x[0],p),s.ak(b[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c,p={}){if(this._validate(th,n,p))return;const x=Object.assign({},n);for(const b of Object.keys(vn))x[b]===void 0&&(x[b]=vn[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?(function(p,x,b){const E=s.ae.fromLngLat(x),I=b.elevation?b.elevation.getAtPointOrZero(E):0;return Ln(p,E.x,E.y,I,b)})(this.state,n,c):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Vn(this.state,c,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,c,p,x,b){return this._transform.projection.supportsFog?Vn(this.state,n,c,p,x,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?bn(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=n.points[p];let b;if(x[2]>=0)b=x;else{const E=n.points[p-4];b=s.am(E,x,E[2]/(E[2]-x[2]))}if(Ln(this.state,b[0],b[1],0,this._transform)>=tn)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Fe(this,n.call(Va,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let $i,xr,nr,vr=class extends s.E{constructor(f,n,c,p){super();const x=$i||($i=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(Lc,f,c))return;const p=Object.assign({},f),x=s.a6.snow;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Fe(this,f.call(Va,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},ir=class extends s.E{constructor(f,n,c,p){super();const x=xr||(xr=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(oi,f,c))return;const p=Object.assign({},f),x=s.a6.rain;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Fe(this,f.call(Va,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class ui extends s.E{constructor(n,c,p,x){super(),this.scope=p,this._options=n,this.properties=new s.ai(c),this._transitionable=new s.a8(c,p,new Map(x)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,c){this._options=n,this._transitionable.setTransitionOrValue(n.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const cr=()=>nr||(nr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let Oi;const gi=()=>Oi||(Oi=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class Ti{constructor(n,c,p){this.screenBounds=n,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,c){let p,x;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);p=[b],x=c.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),E=s.P.convert(n[1]),I=b.add(E)._div(2);p=[b,E],x=s.aq(b,E).every(M=>c.isPointAboveHorizon(M))&&c.isPointAboveHorizon(I)}return new Ti(p,x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),s.ar(x,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,n),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>p.y))+((b.x>c.x)+(b.x>p.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(n,c,p,x=0){const b=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let I=n.tileID.wrap+(E.unwrapped?x:0);const M=E.polygon.map(ee=>s.as(n.tileTransform,ee,I));if(!s.at(M,0,0,s.al,s.al))return;I=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const O=this.screenGeometryMercator.polygon.map(ee=>s.au(n.tileTransform,ee,I)),z=O.map(ee=>new s.P(ee[0],ee[1])),H=c.getFreeCameraOptions().position||new s.ae(0,0,0),G=s.au(n.tileTransform,H,I),$=O.map(ee=>{const re=s.av(ee,ee,G);return s.aw(re,re),new s.ax(G,re)}),J=s.ay(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:$,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(K=s.az(M),K.min.x=s.aA(K.min.x,0,s.al),K.min.y=s.aA(K.min.y,0,s.al),K.max.x=s.aA(K.max.x,0,s.al),K.max.y=s.aA(K.max.y,0,s.al),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:J};var K}_bufferedScreenMercator(n,c){const p=ts(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(n,c){const p=ts(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(n,c){const p=(function(b,E){const I=s.aB([],E.pixelMatrix,E.globeMatrix),M=[0,-s.aD,0,1],O=[0,s.aD,0,1],z=[0,0,0,1];s.aC(M,M,I),s.aC(O,O,I),s.aC(z,z,I);const H=new s.P(M[0]/M[3],M[1]/M[3]),G=new s.P(O[0]/O[3],O[1]/O[3]),$=s.aE(b,H)&&M[3]<z[3],J=s.aE(b,G)&&O[3]<z[3];if(!$&&!J)return null;const K=(function(Ae,be,ge){for(let ke=1;ke<Ae.length;ke++){const ze=es(be.pointCoordinate3D(Ae[ke-1]).x),je=es(be.pointCoordinate3D(Ae[ke]).x);if(ge<0){if(ze<je)return{idx:ke,t:-ze/(je-1-ze)}}else if(je<ze)return{idx:ke,t:(1-ze)/(je+1-ze)}}return null})(b,E,$?-1:1);if(!K)return null;const{idx:ee,t:re}=K;let pe=ee>1?ur(b.slice(0,ee),E):[],fe=ee<b.length?ur(b.slice(ee),E):[];pe=pe.map(Ae=>new s.P(es(Ae.x),Ae.y)),fe=fe.map(Ae=>new s.P(es(Ae.x),Ae.y));const ue=[...pe];ue.length===0&&ue.push(fe[fe.length-1]);const Ie=s.ak(ue[ue.length-1].y,(fe.length===0?pe[0]:fe[0]).y,re);let Te;return Te=$?[new s.P(0,Ie),new s.P(0,0),new s.P(1,0),new s.P(1,Ie)]:[new s.P(1,Ie),new s.P(1,1),new s.P(0,1),new s.P(0,Ie)],ue.push(...Te),fe.length===0?ue.push(pe[0]):ue.push(...fe),{polygon:ue.map(Ae=>new s.ae(Ae.x,Ae.y)),unwrapped:!1}})(n,c);if(p)return p;const x=(function(b,E){let I=!1,M=-1/0,O=0;for(let H=0;H<b.length-1;H++)b[H].x>M&&(M=b[H].x,O=H);for(let H=0;H<b.length-1;H++){const G=(O+H)%(b.length-1),$=b[G],J=b[G+1];Math.abs($.x-J.x)>.5&&($.x<J.x?($.x+=1,G===0&&(b[b.length-1].x+=1)):(J.x+=1,G+1===b.length-1&&(b[0].x+=1)),I=!0)}const z=s.aF(E.center.lng);return I&&z<Math.abs(z-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:I}})(ur(n,c).map(b=>new s.P(es(b.x),b.y)),c);return{polygon:x.polygon.map(b=>new s.ae(b.x,b.y)),unwrapped:x.unwrapped}}}function ur(f,n){return s.aG(f,c=>{const p=n.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function es(f){return f<0?1+f%1:f%1}function ts(f){return 100*f|0}function hr(f,n,c,p,x){const b=function(I,M){if(I)return x(I);if(M){if(f.url&&M.tiles&&f.tiles&&delete f.tiles,M.variants){if(!Array.isArray(M.variants))return x(new Error("variants must be an array"));for(const z of M.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return x(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){M=Object.assign(M,z);break}}}const O=s.aH(Object.assign({},M,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=n.canonicalizeTileset(O,f.url),x(null,O)}},E=(function(I,M,O){if(!I)return null;if(!M&&!O)return I;O=O||I.worldview_default;const z=Object.values(I.language||{});if(z.length===0)return null;const H=Object.values(I.worldview||{});if(H.length===0)return null;const G=z.every(J=>J===M),$=H.every(J=>J===O);return G&&$?I:M in(I.language_options||{})||O in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null})(f.data,c,p);return E?s.o.frame(()=>b(null,E)):f.url?s.m(n.transformRequest(n.normalizeSourceURL(f.url,null,c,p),s.R.Source),b):s.o.frame(()=>{const{data:I,...M}=f;b(null,M)})}function Ts(f,n){const c=Math.pow(2,n.z),p=Math.floor(s.aF(f.getWest())*c),x=Math.floor(s.aJ(f.getNorth())*c),b=Math.ceil(s.aF(f.getEast())*c),E=Math.ceil(s.aJ(f.getSouth())*c);return n.x>=p&&n.x<b&&n.y>=x&&n.y<E}class Es{constructor(n,c,p){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const c of n)this.extraBounds.push(s.aI.convert(this.validateBounds(c)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Ts(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Ts(c,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const c=new Es(n.bounds,n.minzoom,n.maxzoom);return c.addExtraBounds(n.extra_bounds),c}}class pa extends s.E{constructor(n,c,p,x){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=hr(this._options,this.map._requestManager,c,p,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(x));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of b.vector_layers)this.vectorLayerIds.push(E.id),b.worldview&&b.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Es.fromTileJSON(b),Be(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,c){const p=n.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(x,s.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,I=E?{image:E.image.clone()}:null,M={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(p)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",M,O.bind(this));else if(n.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",M,O.bind(this),void 0,!0);else{const z=s.aL.call({deduped:this._deduped},M,(H,G)=>{if(H||!G)O.call(this,H);else{const $=s.aM(G.responseHeaders);M.data={rawData:G.rawData.slice(0),expires:$.expires,cacheControl:$.cacheControl},n.actor&&n.actor.send("loadTile",M,O.bind(this),void 0,!0)}},!0);n.request={cancel:z}}function O(z,H){return delete n.request,n.aborted?c(null):z&&z instanceof s.aN&&z.status!==404?c(z):(H&&H.resourceTiming&&(n.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&n.setExpiryData(H),n.loadVectorData(H,this.map.painter),s.aO(this.dispatcher),c(null,H),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ys extends s.E{constructor(n,c,p,x){super(),this.id=n,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,s.aH(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=hr(this._options,this.map._requestManager,null,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Es.fromTileJSON(x),Be(x.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const p=s.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(x,s.R.Tile),(b,E,I)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(b)return n.state="errored",c(b);if(!E)return c(null);const M=s.aM(I);this.map._refreshExpiredTiles&&n.setExpiryData(M),n.setTexture(E,this.map.painter),n.state="loaded",s.aO(this.dispatcher),c(null)})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c&&c()}unloadTile(n,c){n.texture&&n.texture instanceof s.T?(n.destroy(!1),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ra([f,n],c,p,{scaled:x=!0}={}){const{tileSize:b,buffer:E}=p,{x:I,y:M,z:O}=c;if(!isFinite(I)||!isFinite(M)||!isFinite(O))throw new Error("Invalid MRT header");const z=2**O,H=z*s.aF(f),G=z*s.aJ(n);return(function([$,J],K,{scaled:ee=!0}={}){if(!K)throw new Error("bandView is undefined");const{data:re,tileSize:pe,buffer:fe,offset:ue,scale:Ie,dimension:Te}=K;if($<-fe||$>pe+fe||J<-fe||J>pe+fe)throw new Error(`Point (${$}, ${J}) out of bounds for tileSize=${pe}, buffer=${fe}`);const Ae=(J+fe)*(pe+2*fe)+($+fe);if(new Uint32Array(re.buffer)[Ae]===4294967295)return null;let be=[];be=ee?[]:new K.data.constructor(Te);for(let ge=0;ge<Te;ge++)be[ge]=Math.round(1e12*(re[Te*Ae+ge]*Ie+ue))/1e12;return be})([Math.min(Math.max(-E,Math.floor((H-I)*b)),b-1+E),Math.min(Math.max(-E,Math.floor((G-M)*b)),b-1+E)],p,{scaled:x})}class sa extends ys{constructor(n,c,p,x){super(n,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(n){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,c){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile),b={request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=x,n.actor||(n.actor=this.dispatcher.getActor());const E=(I,M,O)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(I)return I.name==="AbortError"?void 0:(n.state="errored",c(I));if(this.map._refreshExpiredTiles&&M){const z=s.aM(O);n.setExpiryData(z)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!M)return c(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=M}c(null)};n.request=this.partial?n.fetchHeader(void 0,E.bind(this)):n.actor.send("loadTile",b,E.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){const p=n.texturePerLayer;if(n.flushAllQueues(),p.size){n.destroy(!1);for(const x of p.values())this.map.painter.saveTileTexture(x)}else n.destroy()}prepareTile(n,c,p,x){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(c,p,x,(b,E)=>{if(b)return n.state="errored",this.fire(new s.y(b)),void this.triggerRepaint(n);E&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(p,E,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:b})=>b===n),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(n,c,p){if(!n)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;c instanceof s.aR?b=c.paint.get("raster-array-band"):c instanceof s.aS&&(b=c.paint.get("raster-particle-array-band"));const E=b||this.getInitialBand(x);if(E==null)return;if(!n.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(n,x,c.id,E);if(n.updateNeeded(c.id,E)&&!p)return;const I=n.textureDescriptorPerLayer.get(c.id);return Object.assign({},I,{texture:n.texturePerLayer.get(c.id)})}getImages(n,c){const p=new Map;for(const x of n)for(const b of c){const[E,I]=b.split("/"),M=x.getLayer(E);if(!M||!M.hasBand(I)||!M.hasDataForBand(I))continue;const{bytes:O,tileSize:z,buffer:H}=M.getBandView(I),G=z+2*H,$={data:new s.q({width:G,height:G},O),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,$)}return p}queryRasterArrayValueByBandId(n,c,p){const x=c._mrt;return new Promise(b=>{const E={},I=new Set;for(const[M,O]of Object.entries(x.layers)){if(p.layerName&&M!==p.layerName)continue;const z={};E[M]=z;for(const{bands:H}of O.dataIndex)for(const G of H)p.bands&&!p.bands.includes(G)||(I.add(s.B(M,G)),c.fetchBand(M,null,G,$=>{s.o.frame(()=>{z[G]=$?null:ra([n.lng,n.lat],x,O.getBandView(G)),I.delete(s.B(M,G)),I.size===0&&b(E)})},!1))}I.size===0&&b(E)})}_loadTileForQuery(n,c){if(this._loadTileLoaded[n.uid])return void c(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(c);this._loadTilePending[n.uid]=[c];const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile);n.actor.send("loadTile",{request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,E,I)=>{if(b)return this._loadTilePending[n.uid].forEach(M=>M(b,null)),void delete this._loadTilePending[n.uid];if(!E)return this._loadTilePending[n.uid].forEach(M=>M(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&E){const M=s.aM(I);n.setExpiryData(M)}n._mrt=E,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(M=>M(null,E)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,c,p){return new Promise((x,b)=>{this._loadTileForQuery(c,(E,I)=>{E?b(E):x(I?this.queryRasterArrayValueByBandId(n,c,p):null)})})}queryRasterArrayValue(n,c){const p=s.aT.convert(n),x=this.findLoadedParent(p);return x&&x._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,c):this.queryRasterArrayValueByAllBands(p,x,c):Promise.resolve(null)}findLoadedParent(n){const c=s.ae.fromLngLat(n,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,b=Math.floor(c.x),E=Math.floor((c.x-b)*x),I=Math.floor(c.y*x),M=this.map.style.getSourceCache(this.id),O=new s.aQ(p,b,p,E,I);return M.findLoadedParent(O,this.minzoom)}}const $o={vector:pa,raster:ys,"raster-dem":class extends ys{constructor(f,n,c,p){super(f,n,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,b){x&&(f.state="errored",n(x)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=s.n(this.map._requestManager.transformRequest(c,s.R.Tile),(function(x,b,E){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(x)f.state="errored",n(x);else if(b){const I=s.aM(E);this.map._refreshExpiredTiles&&f.setExpiryData(I);const M=ImageBitmap&&b instanceof ImageBitmap&&s.r(),O=1-(b.width-s.aP(b.width))/2;O<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const z=M?b:s.o.getImageData(b,O),H={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:O};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",H,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),p=(n.x-1+c)%c,x=n.x===0?f.wrap-1:f.wrap,b=(n.x+1+c)%c,E=n.x+1===c?f.wrap+1:f.wrap,I={};return I[new s.aQ(f.overscaledZ,x,n.z,p,n.y).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(I[new s.aQ(f.overscaledZ,x,n.z,p,n.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<c&&(I[new s.aQ(f.overscaledZ,x,n.z,p,n.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,E,n.z,b,n.y+1).key]={backfilled:!1}),I}},"raster-array":sa,geojson:class extends s.E{constructor(f,n,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const c of this._data.features)n.set(c.id,c);for(const c of f.features)n.set(c.id,c);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:f},this.workerOptions);n.scope=this.scope;const c=this._data;typeof c=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(c),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,b=this._partialReload,E={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};f.request=this.actor.send(c,E,(I,M)=>b&&!M?(f.state="loaded",n(null)):(delete f.request,f.destroy(!1),f.aborted?n(null):I?n(I):(f.loadVectorData(M,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(f,n,c,p){super(f,n,c,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aV(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new s.y(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(f,n,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=hr(this._options,this.map._requestManager,n,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Es(x.bounds,this.minzoom,this.maxzoom)),Be(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const b=Object.values(f.buckets);for(const E of b)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(b,E){return f.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadModelData(E,this.map.painter),f.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(f,n,c,p){super(f,n,c,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,n,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Es(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:c,y:p,z:x}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:b.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",n(null)):E===void 0?(f.state="errored",n(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):(function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement})(E)?(this.loadTileData(f,E),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(f.state="errored",n(E))}),f.request.cancel=()=>b.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof s.T?(f.destroy(!1),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},To=function(f,n,c,p){const x=new $o[n.type](f,n,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return s.aY(["load","abort","unload","serialize","prepare"],x),x};function ja(f,n,c=""){return`${c}:${n.id||""}:${n.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:b}=p;return`featureset:${x}${b?`:import:${b}`:""}`}})(f.target)}`}function dl(f,n,c,p=""){if(f.uniqueFeatureID){const x=ja(f,n,p);if(c.has(x))return!0;c.add(x)}return!1}function ma(f,n,c,p,x=!1,b=void 0){const E=n.sourceCache.transform,I=n.sourceCache.tilesIn(f,n.has3DLayers,x);I.sort(nh);const M=[];for(const O of I){const z=O.tile.queryRenderedFeatures(n,O,c,p,E,x,b);Object.keys(z).length&&M.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:z})}for(const O in n.layers){const z=n.layers[O];if(z.styleLayer){const H=z.styleLayer.queryRenderedFeatures(f,n.sourceCache,p);Object.keys(H).length&&M.push({wrappedTileID:0,queryResults:H})}}return M.length===0?{}:(function(O){const z={},H={};for(const G of O){const $=G.queryResults,J=G.wrappedTileID,K=H[J]=H[J]||{};for(const ee in $){const re=$[ee],pe=K[ee]=K[ee]||{},fe=z[ee]=z[ee]||[];for(const ue of re)pe[ue.featureIndex]||(pe[ue.featureIndex]=!0,fe.push(ue))}}return z})(M)}function pf(f,n,c,p,x,b){const E={},I=p.queryRenderedSymbols(f),M=[];for(const O of Object.keys(I).map(Number))M.push(x[O]);M.sort(nh);for(const O of M){const z=O.featureIndex.lookupSymbolFeatures(I[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,n,c,b);for(const H in z){const G=E[H]=E[H]||[],$=z[H];$.sort((J,K)=>{const ee=O.featureSortOrder;if(ee){const re=ee.indexOf(J.featureIndex);return ee.indexOf(K.featureIndex)-re}return K.featureIndex-J.featureIndex});for(const J of $)G.push(J)}}return E}function nd(f,n){const c=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],x={};for(let b=0;b<c.length;b++){const E=c[b],I=E.tileID.canonical.key;x[I]||(x[I]=!0,E.querySourceFeatures(p,n))}return p}function nh(f,n){const c=f.tileID,p=n.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function yu(f,n){const c={};if(!n)return c;for(const p of f){const x=p.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>x.filter(E=>E.id===b)[0]));for(const b of x)c[b.fqid]=p}}return c}const Ss=32,Xs=33,Eo=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,c=0,p=0,x=0,b=0,E=0,I=0;for(1&n?x=b=E=Ss:c=p=I=Ss;(n>>=1)>1;){const O=c+x>>1,z=p+b>>1;1&n?(x=c,b=p,c=E,p=I):(c=x,p=b,x=E,b=I),E=O,I=z}const M=4*f;Eo[M+0]=c,Eo[M+1]=p,Eo[M+2]=x,Eo[M+3]=b}const As=new Uint16Array(2178),So=new Uint8Array(1089),Ca=new Uint16Array(1089);function Zo(f){return f===0?-.03125:f===32?.03125:0}const Ua={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Ao{constructor(n,c,p,x,b,E){this.tileID=n,this.uid=s.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(n){const c=n+this.timeAdded;c<s.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,c,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=yu(n.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b4){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b4&&b.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],E=c.style.getOwnLayer(x);if(!E)continue;const I=E.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,I)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,c,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,yu(n.buckets,c.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,c){for(const b in this.buckets){const E=this.buckets[b];if(E.uploadPending()){let I={},M=[],O={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){M=c.style.listImages();const z=E.layers[0],H=z.sourceLayer||"_geojsonTileLayer",G=c.style.getLayerSourceCache(z);G&&(I=G._state.getState(H,void 0))}O={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}E.upload(n,this.tileID.canonical,I,M,O)}}const p=n.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new s.T(n,x.image,p.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(n,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&c){const b=c.style.getLut(p);this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p,b)}if(!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const c in this.buckets){const p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,p.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,c,p,x,b,E,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=this.evaluateQueryRenderedFeaturePadding(),O=(function(z,H){const G=s.bq([],[.5*z.width,.5*-z.height,1]);return s.br(G,G,[1,-1,0]),s.aB(G,G,z.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(G)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:c,pixelPosMatrix:O,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:M,scope:I})}querySourceFeatures(n,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),b=c?c.sourceLayer:"",E=x._geojsonTileLayer||x[b];if(!E)return;const I=s.b6(c&&c.filter),{z:M,x:O,y:z}=this.tileID.canonical,H={z:M,x:O,y:z};for(let G=0;G<E.length;G++){const $=E.feature(G);if(I.needGeometry){const ee=s.b7($,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ee,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),$))continue;const J=p.getId($,b),K=new s.b8($,M,O,z,J);K.tile=H,n.push(K)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const c=this.expirationTime;if(n.cacheControl){const p=s.b9(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const c in this.buckets)if(n.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(n,c){if(!this.latestFeatureIndex||!n.style)return;const p=n.style.listImages(),x=n.style.getBrightness();for(const b in this.buckets){if(!n.style.hasLayer(b))continue;const E=this.buckets[b],I=E.layers[0],M=I.sourceLayer||"_geojsonTileLayer",O=n.style.getLayerSourceCache(I);let z={};O&&(z=O._state.getState(M,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},G=Object.keys(z).length>0&&!c;E.hasAppearances=E.layers.some(K=>K.appearances&&K.appearances.length>0);const $=G?E.stateDependentLayers:E.layers;if(G&&E.stateDependentLayers.length!==0||c){const K=this.latestFeatureIndex.loadVTLayers();E.update(z,K[M],p,H,$,c,x)}if(G&&E.stateDependentLayers.length!==0||c||E.hasAppearances){const K={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};E.updateAppearances(this.tileID.canonical,z,p,K,n.imageManager)}(E instanceof s.ba||E instanceof s.bb)&&n._terrain&&n._terrain.enabled&&O&&E.uploadPending()&&n._terrain._clearRenderCacheForTile(O.id,this.tileID);const J=n&&n.style&&n.style.getOwnLayer(b);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(n,c){const p={};for(const x of c)p[x]=!0;this.dependencies[n]=p}hasDependency(n,c){for(const p of n){const x=this.dependencies[p];if(x){for(const b of c)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=s.bc(Ua,this.tileID.canonical,this.tileTransform)[0],x=new s.bd,b=new s.be;for(let E=0;E<p.length;E++){const{x:I,y:M}=p[E];x.emplaceBack(I,M),b.emplaceBack(E)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(x,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(n,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=s.bc(Ua,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const E=(function(I,M){const O=s.aZ(I,M),z=Math.pow(2,I.z);for(let ee=0;ee<Xs;ee++)for(let re=0;re<Xs;re++){const pe=s.a_((I.x+(re+Zo(re))/Ss)/z),fe=s.a$((I.y+(ee+Zo(ee))/Ss)/z),ue=M.project(pe,fe),Ie=ee*Xs+re;As[2*Ie+0]=Math.round((ue.x*O.scale-O.x)*s.al),As[2*Ie+1]=Math.round((ue.y*O.scale-O.y)*s.al)}So.fill(0),Ca.fill(0);for(let ee=2045;ee>=0;ee--){const re=4*ee,pe=Eo[re+0],fe=Eo[re+1],ue=Eo[re+2],Ie=Eo[re+3],Te=pe+ue>>1,Ae=fe+Ie>>1,be=Te+Ae-fe,ge=Ae+pe-Te,ke=fe*Xs+pe,ze=Ie*Xs+ue,je=Ae*Xs+Te,Xe=Math.hypot((As[2*ke+0]+As[2*ze+0])/2-As[2*je+0],(As[2*ke+1]+As[2*ze+1])/2-As[2*je+1])>=16;So[je]=So[je]||(Xe?1:0),ee<1022&&(So[je]=So[je]||So[(fe+ge>>1)*Xs+(pe+be>>1)]||So[(Ie+ge>>1)*Xs+(ue+be>>1)])}const H=new s.b1,G=new s.b0;let $=0;function J(ee,re){const pe=re*Xs+ee;return Ca[pe]===0&&(H.emplaceBack(As[2*pe+0],As[2*pe+1],ee*s.al/Ss,re*s.al/Ss),Ca[pe]=++$),Ca[pe]-1}function K(ee,re,pe,fe,ue,Ie){const Te=ee+pe>>1,Ae=re+fe>>1;if(Math.abs(ee-ue)+Math.abs(re-Ie)>1&&So[Ae*Xs+Te])K(ue,Ie,ee,re,Te,Ae),K(pe,fe,ue,Ie,Te,Ae);else{const be=J(ee,re),ge=J(pe,fe),ke=J(ue,Ie);G.emplaceBack(be,ge,ke)}}return K(0,0,Ss,Ss,Ss,0),K(Ss,Ss,0,0,0,Ss),{vertices:H,indices:G}})(this.tileID.canonical,c);x=E.vertices,b=E.indices}else{x=new s.b1,b=new s.b0;for(const{x:I,y:M}of p)x.emplaceBack(I,M,0,0);const E=s.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let I=0;I<E.length;I+=3)b.emplaceBack(E[I],E[I+1],E[I+2])}this._tileBoundsBuffer=n.createVertexBuffer(x,s.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.bg.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(n,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,b=s.bj(x,c),E=s.bk(b),I=s.aj(c.zoom);let M;I>0&&(M=s.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,x,c,E,M,I),this._makeGlobeTileDebugTextBuffer(n,x,c,E,M,I)}_globePoint(n,c,p,x,b,E,I){let M=s.bm(n,c,p);if(E){const O=1<<p.z,z=s.aF(x.center.lng),H=s.aJ(x.center.lat),G=(p.x+.5)/O-z;let $=0;G>.5?$=-1:G<-.5&&($=1);let J=(n/s.al+p.x)/O+$,K=(c/s.al+p.y)/O;J=(J-z)*x._pixelsPerMercatorPixel+z,K=(K-H)*x._pixelsPerMercatorPixel+H;const ee=[J*x.worldSize,K*x.worldSize,0];s.af(ee,ee,E),M=s.bn(M,ee,I)}return s.af(M,M,b)}_makeGlobeTileDebugBorderBuffer(n,c,p,x,b,E){const I=new s.bd,M=new s.be,O=new s.bo,z=(G,$,J,K,ee)=>{const re=(J-G)/(ee-1),pe=(K-$)/(ee-1),fe=I.length;for(let ue=0;ue<ee;ue++){const Ie=G+ue*re,Te=$+ue*pe;I.emplaceBack(Ie,Te);const Ae=this._globePoint(Ie,Te,c,p,x,b,E);O.emplaceBack(Ae[0],Ae[1],Ae[2]),M.emplaceBack(fe+ue)}},H=s.al;z(0,0,H,0,16),z(H,0,H,H,16),z(H,H,0,H,16),z(0,H,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(M),this._tileDebugBuffer=n.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(O,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,M.length)}_makeGlobeTileDebugTextBuffer(n,c,p,x,b,E){const I=s.al/4,M=new s.bd,O=new s.b0,z=new s.bo,H=25;O.reserve(32),M.reserve(H),z.reserve(H);const G=($,J)=>H*$+J;for(let $=0;$<H;$++){const J=$*I;for(let K=0;K<H;K++){const ee=K*I;M.emplaceBack(ee,J);const re=this._globePoint(ee,J,c,p,x,b,E);z.emplaceBack(re[0],re[1],re[2])}}for(let $=0;$<4;$++)for(let J=0;J<4;J++){const K=G($,J),ee=G($,J+1),re=G($+1,J),pe=G($+1,J+1);O.emplaceBack(K,ee,re),O.emplaceBack(re,ee,pe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(O),this._tileDebugTextBuffer=n.createVertexBuffer(M,s.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,H,32)}destroy(n=!0){for(const c in this.buckets)this.buckets[c].destroy(n);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class Oc extends Ao{constructor(n,c,p,x,b){super(n,c,p,x,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,c,p){const x=p.context,b=x.gl;let E=this.texturePerLayer.get(n)||p.getTileTexture(c.width);E&&E instanceof s.T?E.update(c,{premultiply:!1}):E=new s.T(x,c,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,E)}flushQueues(n){const c=this._workQueuePerLayer.get(n)||[],p=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}}fetchHeader(n=16384,c){const p=this._mrt=new s.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bu(x,(b,E,I)=>{if(b)c(b);else try{const M=p.getHeaderLength(E);if(M>n)return void(this.request=this.fetchHeader(M,c));p.parseHeader(E),this._isHeaderLoaded=!0;let O=0;for(const z of Object.values(p.layers))O=Math.max(O,z.dataIndex[z.dataIndex.length-1].lastByte);E.byteLength>=O&&(this.entireBuffer=E),c(null,this.entireBuffer||E,I)}catch(M){c(M)}}),this.request}fetchBandForRender(n,c,p,x){this.fetchBand(n,c,p,b=>{if(b)return void x(b);this.updateTextureDescriptor(n,c,p);const E=this.textureDescriptorPerLayer.get(c);x(null,E?E.img:null)})}fetchBand(n,c,p,x,b=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void x(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void x(new Error("Can't fetch tile band without an actor"));let M;const O=s.B(String(p),s.B(this.tileID.key,n));let z=this._taskQueue.get(O);z?z.add(x):(z=new Set,z.add(x),this._taskQueue.set(O,z));const H=(K,ee)=>{M.complete(K,ee),K?x(K):(z.forEach(re=>re(null,ee)),this._taskQueue.delete(O))},G=(K,ee)=>{if(K)return x(K);const re=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ee,task:M},H,void 0,!0);if(c!==null){const pe=this._workQueuePerLayer.get(c)||[];pe.push(()=>{re&&re.cancel(),M.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,pe)}};let $;try{$=E.getLayer(n)}catch(K){if(this.state==="reloading")return;throw K}if(!$)return void x(new Error(`Unknown sourceLayer "${n}"`));if($.hasDataForBand(p))return z.forEach(K=>K(null,null)),void this._taskQueue.delete(O);const J=$.getDataRange([p]);if(M=E.createDecodingTask(J),!M||M.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)G(null,this.entireBuffer.slice(J.firstByte,J.lastByte+1));else{const K=Object.assign({},this.requestParams,{headers:{Range:`bytes=${J.firstByte}-${J.lastByte}`}}),ee=s.bu(K,G);if(c!==null){const re=this._fetchQueuePerLayer.get(c)||[];re.push(()=>{ee.cancel(),M.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,re)}}}updateNeeded(n,c){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,c,p){if(!this._mrt)return;const x=this._mrt.getLayer(n);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:b,tileSize:E,buffer:I,offset:M,scale:O}=x.getBandView(p),z=E+2*I,H=new s.q({width:z,height:z},b),G=this.texturePerLayer.get(c);G&&G instanceof s.T&&G.update(H,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:n,band:p,img:H,buffer:I,offset:M,tileSize:E,format:x.pixelFormat,mix:[O,256*O,65536*O,16777216*O]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const c of this.texturePerLayer.values())c&&c instanceof s.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class zc{constructor(n,c){this.max=n,this.onRemove=c,this.reset()}reset(){for(const n in this.data)for(const c of this.data[n])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(n,c,p){const x=n.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:c,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},p)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const c=this.data[n].shift();return c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),c.value}getByKey(n){const c=this.data[n];return c?c[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,c){if(!this.has(n))return this;const p=n.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),b=this.data[p][x];return this.data[p].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(n){const c=[];for(const p in this.data)for(const x of this.data[p])n(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class fl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,c,p){const x=String(c);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][x]=this.stateChanges[n][x]||{},Object.assign(this.stateChanges[n][x],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==x&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][x]===null){this.deletedStates[n][x]={};for(const b in this.state[n][x])p[b]||(this.deletedStates[n][x][b]=null)}else for(const b in p)this.deletedStates[n]&&this.deletedStates[n][x]&&this.deletedStates[n][x][b]===null&&delete this.deletedStates[n][x][b]}removeFeatureState(n,c,p){if(this.deletedStates[n]===null)return;const x=String(c);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&c!==void 0)this.deletedStates[n][x]!==null&&(this.deletedStates[n][x]=this.deletedStates[n][x]||{},this.deletedStates[n][x][p]=null);else if(c!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][x])for(p in this.deletedStates[n][x]={},this.stateChanges[n][x])this.deletedStates[n][x][p]=null;else this.deletedStates[n][x]=null;else this.deletedStates[n]=null}getState(n,c){const p=this.state[n]||{},x=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(c!==void 0){const I=String(c),M=Object.assign({},p[I],x[I]);if(b){const O=b[c];if(O===null)return{};for(const z in O)delete M[z]}return M}const E=Object.assign({},p,x);if(b)for(const I in b)delete E[I];return E}initializeTileState(n,c){n.refreshFeatureState(c)}coalesceChanges(n,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),Object.assign(this.state[x][E],this.stateChanges[x][E]),b[E]=this.state[x][E];p[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const E in this.state[x])b[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const I of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][I];b[E]=this.state[x][E]}p[x]=p[x]||{},Object.assign(p[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in n)n[x].refreshFeatureState(c)}}class hs extends s.E{constructor(n,c,p){super(),this.id=n,this._onlySymbols=p,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new zc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,c){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,c)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(n,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Ml).map(n=>n.key)}getRenderableIds(n,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,n,c)&&p.push(this._tiles[x]);return n?p.sort((x,b)=>{const E=x.tileID,I=b.tileID,M=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),O=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-I.overscaledZ||O.y-M.y||O.x-M.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Ml).map(x=>x.key)}hasRenderableParent(n){const c=this.findLoadedParent(n,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(n,c,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(c||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,c){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,n,c)))}_tileLoaded(n,c,p,x,b){if(x){if(n.state="errored",x.status!==404)this._source.fire(new s.y(x,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=s.o.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(c,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let E=new Map;b&&b.responseHeaders&&(E=b.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(n){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const b=c[x];if(n.neighboringTiles&&n.neighboringTiles[b]){const E=this.getTileByID(b);p(n,E),p(E,n)}}function p(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=b.tileID.canonical.x-x.tileID.canonical.x;const I=b.tileID.canonical.y-x.tileID.canonical.y,M=Math.pow(2,x.tileID.canonical.z),O=b.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,E,I),x.neighboringTiles&&x.neighboringTiles[O]&&(x.neighboringTiles[O].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,c,p,x){for(const b in this._tiles){let E=this._tiles[b];if(x[b]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>p)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const O=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[O.key],E&&E.hasData()&&(I=O)}let M=I;for(;M.overscaledZ>c;)if(M=M.scaledTo(M.overscaledZ-1),n[M.key]){x[I.key]=I;break}}}findLoadedParent(n,c){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=n.overscaledZ-1;p>=c;p--){const x=n.scaledTo(p),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(n){const c=this._tiles[n.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,c){c=c||this._source.tileSize;const p=Math.ceil(n.width/c)+1,x=Math.ceil(n.height/c)+1,b=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(I)}handleWrapJump(n){const c=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,c){const p={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(n,c,p,x,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,M=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const G=O.attenuationRange()[0],$=Math.floor(G)-Math.log2(O.getDemUpscale());M>$&&(M=$)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new s.aQ(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y));else if(this.tileCoverLift!==0){const G=n.clone();G.tileCoverLift=this.tileCoverLift,I=G.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&n.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=n.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const G=this._source.hasTile.bind(this._source);I=I.filter($=>G($))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Er(this._source.type)){const G=n.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),$=Math.min(G,this._source.maxzoom);if(E){const J=n.extendTileCover(I,$);for(const K of J)I.push(K)}else if(b){const J=n.extendTileCoverToNearPlane(I,this.transform.getFrustum($),$);for(const K of J)I.push(K)}else if(this.castsShadows&&x){const J=n.extendTileCover(I,$,x,16);for(const K of J)this._shadowCasterTiles[K.key]=!0,I.push(K)}}const z=this._updateRetainedTiles(I);if(Er(this._source.type)&&I.length!==0){const G={},$={},J=Object.keys(z);for(const ee of J){const re=z[ee],pe=this._tiles[ee];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=s.o.now())continue;const fe=this.findLoadedParent(re,Math.max(re.overscaledZ-hs.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),G[fe.tileID.key]=fe.tileID),$[ee]=re}const K=I[I.length-1].overscaledZ;for(const ee in this._tiles){const re=this._tiles[ee];if(z[ee]||!re.hasData())continue;let pe=re.tileID;for(;pe.overscaledZ>K;){pe=pe.scaledTo(pe.overscaledZ-1);const fe=this._tiles[pe.key];if(fe&&fe.hasData()&&$[pe.key]){z[ee]=re.tileID;break}}}for(const ee in G)z[ee]||(this._coveredTiles[ee]=!0,z[ee]=G[ee])}for(const G in z)this._tiles[G].clearFadeHold();const H=s.bv(this._tiles,z);for(const G of H){const $=this._tiles[G];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(+G)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const c={};if(n.length===0)return c;const p={},x=n.reduce((O,z)=>Math.min(O,z.overscaledZ),1/0),b=n[0].overscaledZ,E=Math.max(b-hs.maxOverzooming,this._source.minzoom),I=Math.max(b+hs.maxUnderzooming,this._source.minzoom),M={};for(const O of n){const z=this._addTile(O);c[O.key]=O,z.hasData()||x<this._source.maxzoom&&(M[O.key]=O)}this._retainLoadedChildren(M,x,I,c);for(const O of n){let z=this._tiles[O.key];if(z.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const G=O.children(this._source.maxzoom)[0],$=this.getTile(G);if($&&$.hasData()){c[G.key]=G;continue}}else{const G=O.children(this._source.maxzoom);if(c[G[0].key]&&c[G[1].key]&&c[G[2].key]&&c[G[3].key])continue}let H=z.wasRequested();for(let G=O.overscaledZ-1;G>=E;--G){const $=O.scaledTo(G);if(p[$.key]||(p[$.key]=!0,z=this.getTile($),!z&&H&&(z=this._addTile($)),z&&(c[$.key]=$,H=z.wasRequested(),z.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const c=[];let p,x=this._tiles[n].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;x=b}for(const b of c)this._loadedParentTiles[b]=p}}_addTile(n){let c=this._tiles[n.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),c;c=this._cache.getAndRemove(n),c&&(this._setTileReloadTimer(n.key,c),c.tileID=n,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();c=this._source.type==="raster-array"?new Oc(n,b,this.transform.tileZoom,x,this._isRaster):new Ao(n,b,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,n.key,c.state))}return c.uses++,this._tiles[n.key]=c,p||this._source.fire(new s.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(n,c){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=c.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const c=this._tiles[n];c&&(c.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,c,p){const x=[],b=this.transform;if(!b)return x;const E=b.projection.name==="globe",I=s.aF(b.center.lng);for(const M in this._tiles){const O=this._tiles[M];if(p&&O.clearQueryDebugViz(),O.holdingForFade())continue;let z;if(E){const H=O.tileID.canonical;if(H.z===0){const G=[Math.abs(s.aA(I,...ga(H,-1))-I),Math.abs(s.aA(I,...ga(H,1))-I)];z=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(s.aA(I,...ga(H,-1))-I),Math.abs(s.aA(I,...ga(H,0))-I),Math.abs(s.aA(I,...ga(H,1))-I)];z=[G.indexOf(Math.min(...G))-1]}}else z=[0];for(const H of z){const G=n.containsTile(O,b,c,H);G&&x.push(G)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,c){const p=this.getRenderableIds(n,c).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(n){const c=n.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const E of c){const I=1/(1<<E.canonical.z);b[E.key]=((E.canonical.x+.5)*I+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*I-p[1])*x[1]-p[2]*x[2]}return c.sort((E,I)=>b[E.key]-b[I.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Er(this._source.type))for(const n in this._tiles){const c=this._tiles[n];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,c,p){this._state.updateState(n=n||"_geojsonTileLayer",c,p)}removeFeatureState(n,c,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",c,p)}getFeatureState(n,c){return this._state.getState(n=n||"_geojsonTileLayer",c)}setDependencies(n,c,p){const x=this._tiles[n];x&&x.setDependencies(c,p)}reloadTilesForDependencies(n,c){for(const p in this._tiles)this._tiles[p].hasDependency(n,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,c))}_preloadTiles(n,c){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(n,c))};return void this._source.on("data",M)}const p=new Map,x=Array.isArray(n)?n:[n],b=this.map.painter.terrain,E=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const M of x){const O=M.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of O)p.set(z.key,z);this.usedForTerrain&&M.updateElevation(!1)}const I=Array.from(p.values());s.bw(I,(M,O)=>{const z=new Ao(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(z,H=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),O(H,z)})},c)}}function Ml(f,n){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-c||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function Er(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ga(f,n){const c=1<<f.z;return[f.x/c+n,(f.x+1)/c+n]}hs.maxOverzooming=10,hs.maxUnderzooming=3;class Nc{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:n,visibilityChanged:c});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:n,visibilityChanged:c})}}}onNewFrame(n){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(n,c){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,E=this.style.getLayerSourceCache(b);let I=1;b.type==="fill-extrusion"?I=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(I=x.visible?b.paint.get("building-vertical-scale"):0);let M=E?E.getTile(c):null;if(!M&&E)for(const O in E._tiles){const z=E._tiles[O];if(c.canonical.isChildOf(z.tileID.canonical)){M=z;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(b):null,tileID:M?M.tileID:c,verticalScale:I})}n.hasAnyZOffset=!1;let p=!1;for(let x=0;x<n.symbolInstances.length;x++){const b=n.symbolInstances.get(x),E=b.zOffset,I=this._getHeightAtTileOffset(c,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==Number.NEGATIVE_INFINITY?I:E,p||E===b.zOffset||(p=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,c,p,x){let b=c,E=p;if(n.canonical.z!==x.canonical.z){const I=x.canonical,M=1/(1<<n.canonical.z-I.z);b=(c+n.canonical.x*s.al)*M-I.x*s.al|0,E=(p+n.canonical.y*s.al)*M-I.y*s.al|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(n,c,p){let x,b;for(let E=0;E<this.layers.length;++E){const I=this.layers[E].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:M,tileID:O,verticalScale:z}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:H,tileY:G}=this._mapCoordToOverlappingTile(n,c,p,O),$=M.getHeightAtTileCoord(H,G);$&&$.height!==void 0&&($.hidden?x=$.height:b=Math.max($.height*z,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){const I=this.layers[E];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:M,tileID:O}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:z,tileY:H}=this._mapCoordToOverlappingTile(n,c,p,O),G=M.getHeightAtTileCoord(z,H);if(G&&!G.hidden)return G.height===void 0&&x!==void 0?Math.min(G.maxHeight,x)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ih(f,n){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return s.bx.forEach(p=>{p in n&&(c[p]=n[p])}),c}function rh(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=ih(f[c],n[f[c].ref]));return f}const hi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Io(f,n,c){c.push({command:hi.addSource,args:[f,n[f]]})}function Co(f,n,c){n.push({command:hi.removeSource,args:[f]}),c[f]=!0}function _a(f,n,c,p){Co(f,c,p),Io(f,n,c)}function sc(f,n,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],n[c][p]))return!1;for(p in n[c])if(n[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],n[c][p]))return!1;return!0}function Ro(f,n,c,p,x,b){let E;for(E in n=n||{},f=f||{})f.hasOwnProperty(E)&&(s.by(f[E],n[E])||c.push({command:b,args:[p,E,n[E],x]}));for(E in n)n.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(s.by(f[E],n[E])||c.push({command:b,args:[p,E,n[E],x]}))}function io(f){return f.id}function Bc(f,n){return f[n.id]=n,f}function Dl(f,n,c){const p=n.createTileMatrix(f,f.worldSize,c.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,p)}function id(f,n,c){if(n.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(n.projection),Dl(p,n.getProjection(),f)}function ro(f,n,c){return n.name===c.projection.name?f.projMatrix:Dl(c,n,f)}class Mo{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let c=1,p=this._distances[c];const x=n*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const b=c-1,E=this._distances[b],I=p-E,M=I>0?(x-E)/I:0;return this.points[b].mult(1-M).add(this.points[c].mult(M))}}class Fc{constructor(n,c,p){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(c/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,p,x,b){this._forEachCell(c,p,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(n,c,p,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(n,c,p,x,b,E){this.circleCells[b].push(E)}_query(n,c,p,x,b,E){if(p<0||n>this.width||x<0||c>this.height)return!b&&[];const I=[];if(n<=0&&c<=0&&this.width<=p&&this.height<=x){if(b)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const O=this.circles[3*M],z=this.circles[3*M+1],H=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:O-H,y1:z-H,x2:O+H,y2:z+H})}return E?I.filter(E):I}return this._forEachCell(n,c,p,x,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?I.length>0:I}_queryCircle(n,c,p,x,b){const E=n-p,I=n+p,M=c-p,O=c+p;if(I<0||E>this.width||O<0||M>this.height)return!x&&[];const z=[];return this._forEachCell(E,M,I,O,this._queryCellCircle,z,{hitTest:x,circle:{x:n,y:c,radius:p},seenUids:{box:{},circle:{}}},b),x?z.length>0:z}query(n,c,p,x,b){return this._query(n,c,p,x,!1,b)}hitTest(n,c,p,x,b){return this._query(n,c,p,x,!0,b)}hitTestCircle(n,c,p,x){return this._queryCircle(n,c,p,!0,x)}_queryCell(n,c,p,x,b,E,I,M){const O=I.seenUids,z=this.boxCells[b];if(z!==null){const G=this.bboxes;for(const $ of z)if(!O.box[$]){O.box[$]=!0;const J=4*$;if(n<=G[J+2]&&c<=G[J+3]&&p>=G[J+0]&&x>=G[J+1]&&(!M||M(this.boxKeys[$]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[$],x1:G[J],y1:G[J+1],x2:G[J+2],y2:G[J+3]})}}}const H=this.circleCells[b];if(H!==null){const G=this.circles;for(const $ of H)if(!O.circle[$]){O.circle[$]=!0;const J=3*$;if(this._circleAndRectCollide(G[J],G[J+1],G[J+2],n,c,p,x)&&(!M||M(this.circleKeys[$]))){if(I.hitTest)return E.push(!0),!0;{const K=G[J],ee=G[J+1],re=G[J+2];E.push({key:this.circleKeys[$],x1:K-re,y1:ee-re,x2:K+re,y2:ee+re})}}}}}_queryCellCircle(n,c,p,x,b,E,I,M){const O=I.circle,z=I.seenUids,H=this.boxCells[b];if(H!==null){const $=this.bboxes;for(const J of H)if(!z.box[J]){z.box[J]=!0;const K=4*J;if(this._circleAndRectCollide(O.x,O.y,O.radius,$[K+0],$[K+1],$[K+2],$[K+3])&&(!M||M(this.boxKeys[J])))return E.push(!0),!0}}const G=this.circleCells[b];if(G!==null){const $=this.circles;for(const J of G)if(!z.circle[J]){z.circle[J]=!0;const K=3*J;if(this._circlesCollide($[K],$[K+1],$[K+2],O.x,O.y,O.radius)&&(!M||M(this.circleKeys[J])))return E.push(!0),!0}}}_forEachCell(n,c,p,x,b,E,I,M){const O=this._convertToXCellCoord(n),z=this._convertToYCellCoord(c),H=this._convertToXCellCoord(p),G=this._convertToYCellCoord(x);for(let $=O;$<=H;$++)for(let J=z;J<=G;J++)if(b.call(this,n,c,p,x,this.xCellCount*J+$,E,I,M))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,p,x,b,E){const I=x-n,M=b-c,O=p+E;return O*O>I*I+M*M}_circleAndRectCollide(n,c,p,x,b,E,I){const M=(E-x)/2,O=Math.abs(n-(x+M));if(O>M+p)return!1;const z=(I-b)/2,H=Math.abs(c-(b+z));if(H>z+p)return!1;if(O<=M||H<=z)return!0;const G=O-M,$=H-z;return G*G+$*$<=p*p}}const xu=Math.tan(85*Math.PI/180);function ac(f,n,c,p,x,b,E){const I=s.bC();if(c)if(b.name==="globe"){const M=s.bD(x,n);s.aB(I,I,M)}else{const M=s.bE([],E);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],p||s.bB(I,I,x.angle)}else s.aB(I,x.labelPlaneMatrix,f);return I}function pl(f,n,c,p,x,b,E){const I=ac(f,n,c,p,x,b,E);return b.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function Vs(f,n,c,p,x,b,E){if(c){if(b.name==="globe"){const I=ac(f,n,c,p,x,b,E);return s.bl(I,I),s.aB(I,f,I),I}{const I=s.bz(f),M=s.bA([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],s.aB(I,I,M),p||s.bB(I,I,-x.angle),I}}return x.glCoordMatrix}function Ga(f,n,c,p){const x=[f,n,c,1];c?s.aC(x,x,p):ya(x,x,p);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function sh(f,n){return Math.min(.5+f/n*.5,1.5)}function ah(f,n){const c=f[0]/f[3],p=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&p>=-n[1]&&p<=n[1]}function Ei(f,n,c,p,x,b,E,I,M,O,z=1){const H=c.transform,G=p?f.textSizeData:f.iconSizeData,$=s.bK(G,c.transform.zoom,z),J=H.projection.name==="globe",K=[256/c.width*2+1,256/c.height*2+1],ee=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ee.clear();let re=null;J&&(re=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const pe=f.lineVertexArray,fe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ue=c.transform.width/c.transform.height;let Ie,Te=!1;for(let Ae=0;Ae<fe.length;Ae++){const be=fe.get(Ae),{numGlyphs:ge,writingMode:ke}=be;if(ke!==s.bL.vertical||Te||Ie===s.bL.horizontal||(Te=!0),Ie=ke,(be.hidden||ke===s.bL.vertical)&&!Te){Is(ge,ee);continue}Te=!1;const ze=new s.P(be.tileAnchorX,be.tileAnchorY),je=f.elevationType==="road",Xe=!!H.elevation||je;let{x:Ze,y:ut,z:xt}=H.projection.projectTilePoint(ze.x,ze.y,O.canonical),et=null;if(Xe){const on=je?f.getElevationFeatureForText(Ae):null;et={getElevation:M,elevation:H.elevation,elevationFeature:on};const[xn,Dn,jn]=M(ze,H.elevation,on);Ze+=xn,ut+=Dn,xt+=jn}const Le=[Ze,ut,xt,1];if(s.aC(Le,Le,n),!ah(Le,K)){Is(ge,ee);continue}const mt=Le[3],rt=sh(c.transform.getCameraToCenterDistance(H.projection),mt),yt=s.bM(G,$,be),kt=E?yt/rt:yt*rt,qt=Ga(Ze,ut,xt,x);if(qt[3]<=0){Is(ge,ee);continue}let zt={};const Lt=s.an(f.layers[0].layout.get("text-max-angle")),un=Math.cos(Lt),an=E?null:et,Zt=mf(be,kt,!1,I,n,x,b,f.glyphOffsetArray,pe,ee,re,qt,ze,zt,ue,an,H.projection,O,E,un);Te=Zt.useVertical,an&&Zt.needsFlipping&&(zt={}),(Zt.notEnoughRoom||Te||Zt.needsFlipping&&mf(be,kt,!0,I,n,x,b,f.glyphOffsetArray,pe,ee,re,qt,ze,zt,ue,an,H.projection,O,E,un).notEnoughRoom)&&Is(ge,ee)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ee),re&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(re)):(f.icon.dynamicLayoutVertexBuffer.updateData(ee),re&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(re))}function rd(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee){const{lineStartIndex:re,glyphStartIndex:pe,segment:fe}=I,ue=pe+I.numGlyphs,Ie=re+I.lineLength,Te=n.getoffsetX(pe),Ae=n.getoffsetX(ue-1),be=oc(f*Te,c,p,x,b,E,fe,re,Ie,M,O,z,H,G,!0,$,J,K,ee);if(!be)return null;const ge=oc(f*Ae,c,p,x,b,E,fe,re,Ie,M,O,z,H,G,!0,$,J,K,ee);return ge?{first:be,last:ge}:null}function Pl(f,n,c,p){return f===s.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===s.bL.vertical?p>0?{needsFlipping:!0}:null:n!==0&&(function(x,b){return x===0||Math.abs(b/x)>xu})(c,p)?n===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function mf(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe,fe){const ue=n/24,Ie=f.lineOffsetX*ue,Te=f.lineOffsetY*ue,{lineStartIndex:Ae,glyphStartIndex:be,numGlyphs:ge,segment:ke,writingMode:ze,flipState:je}=f,Xe=Ae+f.lineLength,Ze=ut=>{if(z){const[mt,rt,yt]=ut.up,kt=O.length;s.bN(z,kt+0,mt,rt,yt),s.bN(z,kt+1,mt,rt,yt),s.bN(z,kt+2,mt,rt,yt),s.bN(z,kt+3,mt,rt,yt)}const[xt,et,Le]=ut.point;s.bO(O,xt,et,Le,ut.angle)};if(ge>1){const ut=rd(ue,I,Ie,Te,c,H,G,f,M,b,$,K,!1,ee,re,pe,fe);if(!ut)return{notEnoughRoom:!0};if(p&&!c){let[xt,et,Le]=ut.first.point,[mt,rt,yt]=ut.last.point;[xt,et]=Ga(xt,et,Le,E),[mt,rt]=Ga(mt,rt,yt,E);const kt=Pl(ze,je,(mt-xt)*J,rt-et);if(f.flipState=kt&&kt.needsFlipping?1:2,kt)return kt}Ze(ut.first);for(let xt=be+1;xt<be+ge-1;xt++){const et=oc(ue*I.getoffsetX(xt),Ie,Te,c,H,G,ke,Ae,Xe,M,b,$,K,!1,!1,ee,re,pe,fe);if(!et)return O.length-=4*(xt-be),{notEnoughRoom:!0};Ze(et)}Ze(ut.last)}else{if(p&&!c){const xt=Ga(G.x,G.y,0,x),et=Ae+ke+1,Le=new s.P(M.getx(et),M.gety(et)),mt=Ga(Le.x,Le.y,0,x),rt=mt[3]>0?mt:sd(G,Le,xt,1,x,void 0,ee,re.canonical),yt=Pl(ze,je,(rt[0]-xt[0])*J,rt[1]-xt[1]);if(f.flipState=yt&&yt.needsFlipping?1:2,yt)return yt}const ut=oc(ue*I.getoffsetX(be),Ie,Te,c,H,G,ke,Ae,Xe,M,b,$,K,!1,!1,ee,re,pe,fe);if(!ut)return{notEnoughRoom:!0};Ze(ut)}return{}}function Rn(f,n,c,p,x){const{x:b,y:E,z:I}=p.projectTilePoint(f.x,f.y,n);if(!x)return Ga(b,E,I,c);const[M,O,z]=x.getElevation(f,x.elevation,x.elevationFeature);return Ga(b+M,E+O,I+z,c)}function sd(f,n,c,p,x,b,E,I){const M=Rn(f.sub(n)._unit()._add(f),I,x,E,b);return s.av(M,c,M),s.aw(M,M),s.bH(M,c,M,p)}function oc(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe){const fe=p?f-n:f+n;let ue=fe>0?1:-1,Ie=0;p&&(ue*=-1,Ie=Math.PI),ue<0&&(Ie+=Math.PI);let Te=I+E+(ue>0?0:1)|0,Ae=x,be=x,ge=0,ke=0;const ze=Math.abs(fe),je=[],Xe=[];let Ze=b,ut=Ze,xt=s.bF([]);const et=()=>sd(ut,Ze,be,ze-ge+1,z,G,K,ee.canonical);for(;ge+ke<=ze;){if(Te+=ue,Te<I||Te>=M)return null;if(be=Ae,ut=Ze,je.push(be),$&&Xe.push(ut),Ze=new s.P(O.getx(Te),O.gety(Te)),Ae=H[Te],!Ae){const an=Rn(Ze,ee.canonical,z,K,G);Ae=an[3]>0?H[Te]=an:et()}ge+=ke;const Lt=s.av([],Ae,be),un=s.bG(be,Ae);if(c&&un>0&&ke>0&&s.bJ(xt,Lt)/(ke*un)<pe)return null;ke=un,xt=Lt}J&&G&&(H[Te]&&(Ae=et(),ke=s.bG(be,Ae),xt=s.av([],Ae,be)),H[Te]=Ae);const Le=(ze-ge)/ke,mt=Ze.sub(ut)._mult(Le)._add(ut),rt=s.bH([],be,xt,Le);let yt=[0,0,1],kt=xt[0],qt=xt[1];if(re&&(yt=K.upVector(ee.canonical,mt.x,mt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const Lt=[yt[2],0,-yt[0]],un=s.bI([],yt,Lt);s.aw(Lt,Lt),s.aw(un,un),kt=s.bJ(xt,Lt),qt=s.bJ(xt,un)}if(c){const Lt=s.bI([],yt,xt);s.aw(Lt,Lt),s.bH(rt,rt,Lt,c*ue)}const zt=Ie+Math.atan2(qt,kt);return je.push(rt),$&&Xe.push(mt),{point:rt,angle:zt,path:je,tilePath:Xe,up:yt}}function Is(f,n){const c=n.length,p=c+4*f;n.resize(p),n.float32.fill(-1/0,4*c,4*p)}function ya(f,n,c){const p=n[0],x=n[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const xa=100;class gn{constructor(n,c,p=new Fc(n.width+200,n.height+200,25),x=new Fc(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+xa,this.screenBottomBoundary=n.height+xa,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,p,x,b,E,I,M,O,z,H){let G=p.projectedAnchorX,$=p.projectedAnchorY,J=p.projectedAnchorZ;const K=p.tileAnchorX,ee=p.tileAnchorY,re=p.elevation,pe=p.tileID,fe=n.getProjection();if(re&&pe){const[Xe,Ze,ut]=fe.upVector(pe.canonical,p.tileAnchorX,p.tileAnchorY),xt=fe.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=Xe*re*xt,$+=Ze*re*xt,J+=ut*re*xt}const ue=n.projection.name==="globe",Ie=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(pe&&ue&&Ie<1&&!E){const Xe=1<<pe.canonical.z,Ze=s.bP(K,ee);s.bQ(Ze,Ze,1/s.al),s.bR(Ze,Ze,s.bP(pe.canonical.x,pe.canonical.y)),s.bQ(Ze,Ze,1/Xe),s.bS(Ze,Ze,s.bP(x[0],x[1])),Ze[0]=s.bT(Ze[0],-.5,.5),s.bQ(Ze,Ze,s.al);const ut=s.bU(Ze[0],Ze[1],s.al/(2*Math.PI),1);s.aC(ut,ut,b),G=s.ak(G,ut[0],Ie),$=s.ak($,ut[1],Ie),J=s.ak(J,ut[2],Ie)}const Te=this.projectAndGetPerspectiveRatio(z,G,$,J,p.tileID,fe.name==="globe"||!!re||this.transform.pitch>0,fe),Ae=O*Te.perspectiveRatio,be=(p.x1*c+I.x-p.padding)*Ae+Te.point.x,ge=(p.y1*c+I.y-p.padding)*Ae+Te.point.y,ke=(p.x2*c+I.x+p.padding)*Ae+Te.point.x,ze=(p.y2*c+I.y+p.padding)*Ae+Te.point.y,je=Te.perspectiveRatio<=.55||Te.occluded;return!this.isInsideGrid(be,ge,ke,ze)||!M&&this.grid.hitTest(be,ge,ke,ze,H)||je?{box:[],offscreen:!1,occluded:Te.occluded}:{box:[be,ge,ke,ze],offscreen:this.isOffscreen(be,ge,ke,ze),occluded:!1}}placeCollisionCircles(n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee){const re=[],pe=this.transform.elevation,fe=n.getProjection(),ue=n.elevationType==="road",Ie=!!pe||ue,Te=s.bV.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,fe),Ae=new s.P(p.tileAnchorX,p.tileAnchorY),be=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:ge,y:ke,z:ze}=fe.projectTilePoint(be.x,be.y,ee.canonical),je=null;if(Ie){const un=ue?n.getElevationFeatureForText(x):null;je={getElevation:Te,elevation:pe,elevationFeature:un};const[an,Zt,on]=Te(Ae,pe,un);ge+=an,ke+=Zt,ze+=on}const Xe=fe.name==="globe",Ze=this.projectAndGetPerspectiveRatio(M,ge,ke,ze,ee,Xe||!!pe||this.transform.pitch>0,fe),{perspectiveRatio:ut}=Ze,xt=(G?I/ut:I*ut)/s.bY,et=Ga(ge,ke,ze,O),Le=p.lineOffsetX*xt,mt=p.lineOffsetY*xt,rt=s.an(n.layers[0].layout.get("text-max-angle")),yt=Math.cos(rt),kt=Ze.signedDistanceFromCamera>0?rd(xt,E,Le,mt,ue&&p.flipState===1,et,be,p,b,O,{},Ie&&!G?je:null,G&&Ie,fe,ee,G,yt):null;let qt=!1,zt=!1,Lt=!0;if(kt&&!Ze.occluded){const un=.5*J*ut+K,an=new s.P(-100,-100),Zt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),on=new Mo,{first:xn,last:Dn}=kt,jn=xn.path.length;let ni=[];for(let Nn=jn-1;Nn>=1;Nn--)ni.push(xn.path[Nn]);for(let Nn=1;Nn<Dn.path.length;Nn++)ni.push(Dn.path[Nn]);const Pn=2.5*un;z&&(ni=ni.map(([Nn,bi,pi],Di)=>(Ie&&!Xe&&(pi=Te(Di<jn-1?xn.tilePath[jn-1-Di]:Dn.tilePath[Di-jn+2],pe,je.elevationFeature)[2]),Ga(Nn,bi,pi,z))),ni.some(Nn=>Nn[3]<=0)&&(ni=[]));let Un=[];if(ni.length>0){let Nn=1/0,bi=-1/0,pi=1/0,Di=-1/0;for(const ci of ni)Nn=Math.min(Nn,ci[0]),pi=Math.min(pi,ci[1]),bi=Math.max(bi,ci[0]),Di=Math.max(Di,ci[1]);bi>=an.x&&Nn<=Zt.x&&Di>=an.y&&pi<=Zt.y&&(Un=[ni.map(ci=>new s.P(ci[0],ci[1]))],(Nn<an.x||bi>Zt.x||pi<an.y||Di>Zt.y)&&(Un=s.bW(Un,an.x,an.y,Zt.x,Zt.y)))}for(const Nn of Un){on.reset(Nn,.25*un);let bi=0;bi=on.length<=.5*un?1:Math.ceil(on.paddedLength/Pn)+1;for(let pi=0;pi<bi;pi++){const Di=pi/Math.max(bi-1,1),ci=on.lerp(Di),Gn=ci.x+xa,_i=ci.y+xa;re.push(Gn,_i,un,0);const pr=Gn-un,Pi=_i-un,Si=Gn+un,Fn=_i+un;if(Lt=Lt&&this.isOffscreen(pr,Pi,Si,Fn),zt=zt||this.isInsideGrid(pr,Pi,Si,Fn),!c&&this.grid.hitTestCircle(Gn,_i,un,$)&&(qt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:qt,occluded:!1}}}}return{circles:!H&&qt||!zt?[]:re,offscreen:Lt,collisionDetected:qt,occluded:Ze.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,b=-1/0,E=-1/0;for(const z of n){const H=new s.P(z.x+xa,z.y+xa);p=Math.min(p,H.x),x=Math.min(x,H.y),b=Math.max(b,H.x),E=Math.max(E,H.y),c.push(H)}const I=this.grid.query(p,x,b,E).concat(this.ignoredGrid.query(p,x,b,E)),M={},O={};for(const z of I){const H=z.key;if(M[H.bucketInstanceId]===void 0&&(M[H.bucketInstanceId]={}),M[H.bucketInstanceId][H.featureIndex])continue;const G=[new s.P(z.x1,z.y1),new s.P(z.x2,z.y1),new s.P(z.x2,z.y2),new s.P(z.x1,z.y2)];s.bX(c,G)&&(M[H.bucketInstanceId][H.featureIndex]=!0,O[H.bucketInstanceId]===void 0&&(O[H.bucketInstanceId]=[]),O[H.bucketInstanceId].push(H.featureIndex))}return O}insertCollisionBox(n,c,p,x,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,p,x,b){const E=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:x,collisionGroupID:b};for(let M=0;M<n.length;M+=4)E.insertCircle(I,n[M],n[M+1],n[M+2])}projectAndGetPerspectiveRatio(n,c,p,x,b,E,I){const M=[c,p,x,1];let O=!1;x||this.transform.pitch>0?(s.aC(M,M,n),this.fogState&&b&&I.name!=="globe"&&(O=(function(G,$,J,K,ee,re){const pe=re.calculateFogTileMatrix(ee),fe=[$,J,K];return s.af(fe,fe,pe),yn(G,s.ag(fe),re.pitch,re._fov)})(this.fogState,c,p,x,b.toUnwrapped(),this.transform)>.9)):ya(M,M,n);const z=M[3];return{point:new s.P((M[0]/z+1)/2*this.transform.width+xa,(-M[1]/z+1)/2*this.transform.height+xa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/z*.5,1.5),signedDistanceFromCamera:z,occluded:E&&M[2]>z||O}}isOffscreen(n,c,p,x){return p<xa||n>=this.screenRightBoundary||x<xa||c>this.screenBottomBoundary}isInsideGrid(n,c,p,x){return p>=0&&n<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=s.bA([]);return s.br(n,n,[-100,-100,0]),n}}class fi{constructor(n,c,p,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class L{constructor(n,c,p,x,b,E=!1){this.text=new fi(n?n.text:null,c,p,b),this.icon=new fi(n?n.icon:null,c,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ie{constructor(n,c,p,x=!1){this.text=n,this.icon=c,this.skipFade=p,this.clipped=x}}class de{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Ce{constructor(n,c,p,x,b){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=b}}class Ot{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[n]}}function Gt(f,n,c,p,x){const{horizontalAlign:b,verticalAlign:E}=s.c1(f),I=-(b-.5)*n,M=-(E-.5)*c,O=s.c2(f,p);return new s.P(I+O[0]*x,M+O[1]*x)}function Sn(f,n,c,p,x){const b=new s.P(f,n);return c&&b._rotate(p?x:-x),b}class li{constructor(n,c,p,x,b,E){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new gn(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ot(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(n,c,p,x,b=1){const E=p.getBucket(c),I=p.latestFeatureIndex;if(!E||!I||c.fqid!==E.layerIds[0])return;const M=E.layers[0].layout,O=E.layers[0].paint,z=p.collisionBoxArray,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),G=p.tileSize/s.al,$=p.tileID.toUnwrapped();this.transform.setProjection(E.projection);const J=(K=p.tileID,ee=E.getProjection(),re=this.transform,ee.name===this.projection?re.calculateProjMatrix(K.toUnwrapped()):Dl(re,ee,K));var K,ee,re;const pe=M.get("text-pitch-alignment")==="map",fe=M.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const ue=c.dynamicFilter(),Ie=c.dynamicFilterNeedsFeature(),Te=this.transform.calculatePixelsToTileUnitsMatrix(p),Ae=pl(J,p.tileID.canonical,pe,fe,this.transform,E.getProjection(),Te);let be=null;const ge=E.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(pe){const Le=Vs(J,p.tileID.canonical,pe,fe,this.transform,E.getProjection(),Te);be=s.aB([],this.transform.labelPlaneMatrix,Le)}let ke=null;ue&&p.latestFeatureIndex&&(ke={unwrappedTileID:$,dynamicFilter:ue,dynamicFilterNeedsFeature:Ie}),this.retainedQueryData[E.bucketInstanceId]=new Ce(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,p.tileID);const[ze,je]=E.layers[0].layout.get("text-size-scale-range"),Xe=s.aA(b,ze,je),[Ze,ut]=M.get("icon-size-scale-range"),xt=s.aA(b,Ze,ut),et={bucket:E,layout:M,paint:O,posMatrix:J,invMatrix:ge,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ae,labelToScreenMatrix:be,clippingData:ke,scale:H,textPixelRatio:G,holdingForFade:p.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:s.bK(E.textSizeData,this.transform.zoom,Xe),partiallyEvaluatedIconSize:s.bK(E.iconSizeData,this.transform.zoom,xt),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Le of E.sortKeyRanges){const{sortKey:mt,symbolInstanceStart:rt,symbolInstanceEnd:yt}=Le;n.push({sortKey:mt,symbolInstanceStart:rt,symbolInstanceEnd:yt,parameters:et})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:et})}attemptAnchorPlacement(n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe,fe,ue,Ie){const{textOffset0:Te,textOffset1:Ae,crossTileID:be}=K,ge=[Te,Ae],ke=Gt(n,E,I,ge,M),ze=this.collisionIndex.placeCollisionBox(re,M,c,p,x,b,Sn(ke.x,ke.y,O,z,this.transform.angle),J,H,G,$.predicate);if(fe){const je=re.getSymbolInstanceIconSize(Ie,this.transform.zoom,K.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,je,fe,p,x,b,Sn(ke.x,ke.y,O,z,this.transform.angle),J,H,G,$.predicate).box.length===0)return}if(ze.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(je=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:ge,width:E,height:I,anchor:n,textScale:M,prevAnchor:je},this.markUsedJustification(re,n,K,pe),re.allowVerticalPlacement&&(this.markUsedOrientation(re,pe,K),this.placedOrientations[be]=pe),{shift:ke,placedGlyphBoxes:ze}}}placeLayerBucketPart(n,c,p,x,b=1){const{bucket:E,layout:I,paint:M,posMatrix:O,textLabelPlaneMatrix:z,labelToScreenMatrix:H,clippingData:G,textPixelRatio:$,mercatorCenter:J,invMatrix:K,holdingForFade:ee,collisionBoxArray:re,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:fe,collisionGroup:ue,latestFeatureIndex:Ie}=n.parameters,Te=I.get("text-optional"),Ae=I.get("icon-optional"),be=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),ke=I.get("text-rotation-alignment")==="map",ze=I.get("icon-rotation-alignment")==="map",je=I.get("text-pitch-alignment")==="map",Xe=M.get("symbol-z-offset"),Ze=I.get("symbol-elevation-reference")==="sea",ut=I.get("symbol-placement"),[xt,et]=I.get("text-size-scale-range"),[Le,mt]=I.get("icon-size-scale-range"),rt=s.aA(b,xt,et),yt=s.aA(b,Le,mt),kt=I.get("text-variable-anchor"),qt=ke&&ut!=="point",zt=ze&&ut!=="point",Lt=kt&&E.hasTextData(),un=E.hasIconTextFit()&&Lt&&E.hasIconData();this.transform.setProjection(E.projection);const an=Lt||qt,Zt=zt||un;let on=be&&(ge||!E.hasIconData()||Ae),xn=ge&&(be||!E.hasTextData()||Te);const Dn=!Xe.isConstant();!E.collisionArrays&&re&&E.deserializeCollisionBoxes(re),p&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,re,rt,yt);const jn=(Pn,Un,Nn)=>{const{crossTileID:bi,numVerticalGlyphVertices:pi}=Pn;let Di=null;if(G&&G.dynamicFilterNeedsFeature||Dn){const wr=this.retainedQueryData[E.bucketInstanceId];Di=Ie.loadFeature({featureIndex:Pn.featureIndex,bucketIndex:wr.bucketIndex,sourceLayerIndex:wr.sourceLayerIndex,layoutVertexArrayOffset:0});const Jr=Di.properties?Di.properties.worldview:null;if(E.localizable&&E.worldview&&typeof Jr=="string")if(Jr==="all")Di.properties.$localized=!0;else{if(!Jr.split(",").includes(E.worldview))return;Di.properties.$localized=!0,Di.properties.worldview=E.worldview}}if(G&&!(0,G.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},Di,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new s.P(Pn.tileAnchorX,Pn.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[bi]=new ie(!1,!1,!1,!0),void c.add(bi);const ci=Xe.evaluate(Di,{});if(c.has(bi))return;if(ee)return void(this.placements[bi]=new ie(!1,!1,!1));let Gn=!1,_i=!1,pr=!0,Pi=!1,Si=!1,Fn=null,Hn={box:null,offscreen:null,occluded:null},Ki={box:null},Lr=null,Bi=null,Qi=null,wa=0,Qs=0,ks=0;Nn.textFeatureIndex?wa=Nn.textFeatureIndex:Pn.useRuntimeCollisionCircles&&(wa=Pn.featureIndex),Nn.verticalTextFeatureIndex&&(Qs=Nn.verticalTextFeatureIndex);const Ai=E.elevationFeatures?E.elevationFeatures[Pn.elevationFeatureIndex]:void 0,fo=wr=>{wr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Jr=this.transform.elevation;wr.elevation=Ze?ci:ci+s.bV.getAtTileOffset(wr.tileID,new s.P(wr.tileAnchorX,wr.tileAnchorY),Jr,Ai),wr.elevation+=Pn.zOffset},Js=Nn.textBox;if(Js){fo(Js);const wr=rr=>{let ss=s.bL.horizontal;if(E.allowVerticalPlacement&&!rr&&this.prevPlacement){const Rs=this.prevPlacement.placedOrientations[bi];Rs&&(this.placedOrientations[bi]=Rs,ss=Rs,this.markUsedOrientation(E,ss,Pn))}return ss},Jr=(rr,ss)=>{if(E.allowVerticalPlacement&&pi>0&&Nn.verticalTextBox){for(const Rs of E.writingModes)if(Rs===s.bL.vertical?(Hn=ss(),Ki=Hn):Hn=rr(),Hn&&Hn.box&&Hn.box.length)break}else Hn=rr()};if(kt){let rr=kt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[bi]){const Ar=this.prevPlacement.variableOffsets[bi];rr.indexOf(Ar.anchor)>0&&(rr=rr.filter(po=>po!==Ar.anchor),rr.unshift(Ar.anchor))}const ss=(Ar,po,Vd)=>{const Yl=E.getSymbolInstanceTextSize(pe,Pn,this.transform.zoom,Un),Nh=(Ar.x2-Ar.x1)*Yl+2*Ar.padding,Bh=(Ar.y2-Ar.y1)*Yl+2*Ar.padding,mo=Pn.hasIconTextFit&&!ge?po:null;mo&&fo(mo);let il={box:[],offscreen:!1,occluded:!1};const Kl=be?2*rr.length:rr.length;for(let Uo=0;Uo<Kl;++Uo){const ar=this.attemptAnchorPlacement(rr[Uo%rr.length],Ar,J,K,an,Nh,Bh,Yl,ke,je,$,O,ue,Uo>=rr.length,Pn,Un,E,Vd,mo,pe,fe);if(ar&&(il=ar.placedGlyphBoxes,il&&il.box&&il.box.length)){Gn=!0,Fn=ar.shift;break}}return il};Jr(()=>ss(Js,Nn.iconBox,s.bL.horizontal),()=>{const Ar=Nn.verticalTextBox;return Ar&&fo(Ar),E.allowVerticalPlacement&&!(Hn&&Hn.box&&Hn.box.length)&&pi>0&&Ar?ss(Ar,Nn.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Hn&&(Gn=Hn.box,pr=Hn.offscreen,Pi=Hn.occluded);const Rs=wr(!(!Hn||!Hn.box));if(!Gn&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[bi];Ar&&(this.variableOffsets[bi]=Ar,this.markUsedJustification(E,Ar.anchor,Pn,Rs))}}else{const rr=(ss,Rs)=>{const Ar=E.getSymbolInstanceTextSize(pe,Pn,this.transform.zoom,Un),po=this.collisionIndex.placeCollisionBox(E,Ar,ss,J,K,an,new s.P(0,0),be,$,O,ue.predicate);return po&&po.box&&po.box.length&&(this.markUsedOrientation(E,Rs,Pn),this.placedOrientations[bi]=Rs),po};Jr(()=>rr(Js,s.bL.horizontal),()=>{const ss=Nn.verticalTextBox;return E.allowVerticalPlacement&&pi>0&&ss?(fo(ss),rr(ss,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),wr(!!(Hn&&Hn.box&&Hn.box.length))}}if(Lr=Hn,Gn=Lr&&Lr.box&&Lr.box.length>0,pr=Lr&&Lr.offscreen,Pi=Lr&&Lr.occluded,Pn.useRuntimeCollisionCircles){const wr=Pn.centerJustifiedTextSymbolIndex>=0?Pn.centerJustifiedTextSymbolIndex:Pn.verticalPlacedTextSymbolIndex,Jr=E.text.placedSymbolArray.get(wr),rr=s.bM(E.textSizeData,pe,Jr),ss=I.get("text-padding");Bi=this.collisionIndex.placeCollisionCircles(E,be,Jr,wr,E.lineVertexArray,E.glyphOffsetArray,rr,O,z,H,p,je,ue.predicate,Pn.collisionCircleDiameter*rr/s.bY,ss,this.retainedQueryData[E.bucketInstanceId].tileID),Gn=be||Bi.circles.length>0&&!Bi.collisionDetected,pr=pr&&Bi.offscreen,Pi=Bi.occluded}if(Nn.iconFeatureIndex&&(ks=Nn.iconFeatureIndex),Nn.iconBox){const wr=Jr=>{fo(Jr);const rr=Pn.hasIconTextFit&&Fn?Sn(Fn.x,Fn.y,ke,je,this.transform.angle):new s.P(0,0),ss=E.getSymbolInstanceIconSize(fe,this.transform.zoom,Pn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,ss,Jr,J,K,Zt,rr,ge,$,O,ue.predicate)};Ki&&Ki.box&&Ki.box.length&&Nn.verticalIconBox?(Qi=wr(Nn.verticalIconBox),_i=Qi.box.length>0):(Qi=wr(Nn.iconBox),_i=Qi.box.length>0),pr=pr&&Qi.offscreen,Si=Qi.occluded}const la=Te||Pn.numHorizontalGlyphVertices===0&&pi===0,jo=Ae||Pn.numIconVertices===0;if(la||jo?jo?la||(_i=_i&&Gn):Gn=_i&&Gn:_i=Gn=_i&&Gn,Gn&&Lr&&Lr.box&&this.collisionIndex.insertCollisionBox(Lr.box,I.get("text-ignore-placement"),E.bucketInstanceId,Ki&&Ki.box&&Qs?Qs:wa,ue.ID),_i&&Qi&&this.collisionIndex.insertCollisionBox(Qi.box,I.get("icon-ignore-placement"),E.bucketInstanceId,ks,ue.ID),Bi&&(Gn&&this.collisionIndex.insertCollisionCircles(Bi.circles,I.get("text-ignore-placement"),E.bucketInstanceId,wa,ue.ID),p)){const wr=E.bucketInstanceId;let Jr=this.collisionCircleArrays[wr];Jr===void 0&&(Jr=this.collisionCircleArrays[wr]=new de);for(let rr=0;rr<Bi.circles.length;rr+=4)Jr.circles.push(Bi.circles[rr+0]),Jr.circles.push(Bi.circles[rr+1]),Jr.circles.push(Bi.circles[rr+2]),Jr.circles.push(Bi.collisionDetected?1:0)}const Wa=E.projection.name!=="globe";on=on&&(Wa||!Pi),xn=xn&&(Wa||!Si),this.placements[bi]=new ie(Gn||on,_i||xn,pr||E.justReloaded),c.add(bi)},ni=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,ni),E.elevationType==="road"&&E.updateRoadElevation(ni.canonical),E.updateZOffset(),E.sortFeaturesByY){const Pn=E.getSortedSymbolIndexes(this.transform.angle);for(let Un=Pn.length-1;Un>=0;--Un){const Nn=Pn[Un];jn(E.symbolInstances.get(Nn),Nn,E.collisionArrays[Nn])}E.hasAnyZOffset&&s.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Pn=E.getSortedIndexesByZOffset();for(let Un=0;Un<Pn.length;++Un){const Nn=Pn[Un];jn(E.symbolInstances.get(Nn),Nn,E.collisionArrays[Nn])}}else for(let Pn=n.symbolInstanceStart;Pn<n.symbolInstanceEnd;Pn++)jn(E.symbolInstances.get(Pn),Pn,E.collisionArrays[Pn]);if(p&&E.bucketInstanceId in this.collisionCircleArrays){const Pn=this.collisionCircleArrays[E.bucketInstanceId];s.bl(Pn.invProjMatrix,O),Pn.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(n,c,p,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:O}=p,z=s.c3(c),H=x===s.bL.vertical?M:z==="left"?b:z==="center"?E:z==="right"?I:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:O),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:O),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:O),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=H>=0&&M!==H?0:O)}markUsedOrientation(n,c,p){const x=c===s.bL.horizontal||c===s.bL.horizontalOnly?c:0,b=c===s.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:O}=p,z=n.text.placedSymbolArray;E>=0&&(z.get(E).placedOrientation=x),I>=0&&(z.get(I).placedOrientation=x),M>=0&&(z.get(M).placedOrientation=x),O>=0&&(z.get(O).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(n):1,b=c?c.opacities:{},E=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const M in this.placements){const O=this.placements[M],z=b[M];z?(this.opacities[M]=new L(z,x,O.text,O.icon,null,O.clipped),p=p||O.text!==z.text.placed||O.icon!==z.icon.placed):(this.opacities[M]=new L(null,x,O.text,O.icon,O.skipFade,O.clipped),p=p||O.text||O.icon)}for(const M in b){const O=b[M];if(!this.opacities[M]){const z=new L(O,x,!1,!1);z.isHidden()||(this.opacities[M]=z,p=p||O.text.placed||O.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c,p,x){x&&(this.lastReplacementSourceUpdateTime=x.updateTime);const b=new Set;for(const E of c){const I=E.getBucket(n);I&&E.latestFeatureIndex&&n.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,b,E,E.collisionBoxArray,p,x,E.tileID,n.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,E.tileID),I.elevationType==="road"&&I.updateRoadElevation(E.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(n,c,p,x,b,E,I,M){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const O=n.layers[0].layout,z=n.layers[0].paint,H=!!n.layers[0].dynamicFilter(),G=new L(null,0,!1,!1,!0),$=O.get("text-allow-overlap"),J=O.get("icon-allow-overlap"),K=O.get("text-variable-anchor"),ee=O.get("text-rotation-alignment")==="map",re=O.get("text-pitch-alignment")==="map",pe=z.get("symbol-z-offset"),fe=O.get("symbol-elevation-reference")==="sea",ue=!pe.isConstant(),Ie=new L(null,0,$&&(J||!n.hasIconData()||O.get("icon-optional")),J&&($||!n.hasTextData()||O.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const Te=(be,ge,ke)=>{for(let ze=0;ze<ge/4;ze++)be.opacityVertexArray.emplaceBack(ke)};let Ae=0;E&&n.updateReplacement(I,E);for(let be=0;be<n.symbolInstances.length;be++){const ge=n.symbolInstances.get(be),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:ze,crossTileID:je,numIconVertices:Xe,tileAnchorX:Ze,tileAnchorY:ut}=ge;let xt=null;const et=this.retainedQueryData[n.bucketInstanceId];ue&&ge&&et&&(xt=p.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:et.bucketIndex,sourceLayerIndex:et.sourceLayerIndex,layoutVertexArrayOffset:0}));const Le=pe.evaluate(xt,{}),mt=c.has(je);let rt=this.opacities[je];mt?rt=G:rt||(rt=Ie,this.opacities[je]=rt),c.add(je);const yt=ke>0||ze>0,kt=Xe>0,qt=this.placedOrientations[je],zt=qt===s.bL.vertical,Lt=qt===s.bL.horizontal||qt===s.bL.horizontalOnly;!yt&&!kt||rt.isHidden()||Ae++;let un=!1;if((yt||kt)&&E)for(const an of n.activeReplacements){if(s.bZ(an,b,s.b_.Symbol,M)||an.min.x>Ze||Ze>an.max.x||an.min.y>ut||ut>an.max.y)continue;const Zt=s.b$(Ze,ut,I.canonical,an.footprintTileId.canonical);if(un=s.c0(Zt,an.footprint),un)break}if(yt){const an=un?Ys:Ms(rt.text);Te(n.text,ke,zt?Ys:an),Te(n.text,ze,Lt?Ys:an);const Zt=rt.text.isHidden(),{leftJustifiedTextSymbolIndex:on,centerJustifiedTextSymbolIndex:xn,rightJustifiedTextSymbolIndex:Dn,verticalPlacedTextSymbolIndex:jn}=ge,ni=n.text.placedSymbolArray,Pn=Zt||zt?1:0;on>=0&&(ni.get(on).hidden=Pn),xn>=0&&(ni.get(xn).hidden=Pn),Dn>=0&&(ni.get(Dn).hidden=Pn),jn>=0&&(ni.get(jn).hidden=Zt||Lt?1:0);const Un=this.variableOffsets[je];Un&&this.markUsedJustification(n,Un.anchor,ge,qt);const Nn=this.placedOrientations[je];Nn&&(this.markUsedJustification(n,"left",ge,Nn),this.markUsedOrientation(n,Nn,ge))}if(kt){const an=un?Ys:Ms(rt.icon),{placedIconSymbolIndex:Zt,verticalPlacedIconSymbolIndex:on}=ge,xn=n.icon.placedSymbolArray,Dn=rt.icon.isHidden()?1:0;Zt>=0&&(Te(n.icon,Xe,zt?Ys:an),xn.get(Zt).hidden=Dn),on>=0&&(Te(n.icon,ge.numVerticalIconVertices,Lt?Ys:an),xn.get(on).hidden=Dn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const an=n.collisionArrays[be];if(an){let Zt=new s.P(0,0),on=!0;if(an.textBox||an.verticalTextBox){if(K){const Dn=this.variableOffsets[je];Dn?(Zt=Gt(Dn.anchor,Dn.width,Dn.height,Dn.textOffset,Dn.textScale),ee&&Zt._rotate(re?this.transform.angle:-this.transform.angle)):on=!1}H&&(on=!rt.clipped),an.textBox&&Ci(n.textCollisionBox.collisionVertexArray,rt.text.placed,!on||zt,Le,fe,Zt.x,Zt.y),an.verticalTextBox&&Ci(n.textCollisionBox.collisionVertexArray,rt.text.placed,!on||Lt,Le,fe,Zt.x,Zt.y)}const xn=on&&!!(!Lt&&an.verticalIconBox);an.iconBox&&Ci(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,xn,Le,fe,ge.hasIconTextFit?Zt.x:0,ge.hasIconTextFit?Zt.y:0),an.verticalIconBox&&Ci(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,!xn,Le,fe,ge.hasIconTextFit?Zt.x:0,ge.hasIconTextFit?Zt.y:0)}}}if(n.fullyClipped=Ae===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>n}isStale(){return this.stale}setStale(){this.stale=!0}}function Ci(f,n,c,p,x,b,E){f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,b||0,E||0,p,x?1:0)}const kr=Math.pow(2,25),Qr=Math.pow(2,24),Do=Math.pow(2,17),Po=Math.pow(2,16),ko=Math.pow(2,9),Wo=Math.pow(2,8),lc=Math.pow(2,1);function Ms(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*kr+n*Qr+c*Do+n*Po+c*ko+n*Wo+c*lc+n}const Ys=0;class so{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,p,x,b,E){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(I,x,n[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,O)=>M.sortKey-O.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,p,M.symbolInstanceStart===0,E),this._currentPartIndex++,b())return!0}return!1}}class Wm{startNewPlacement(n,c,p,x,b,E,I,M){return this.placement=new li(n,x,b,E,I,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=p,this._fadeDuration=x,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(n,c,p,x,b){const E=s.o.now(),I=()=>{const M=s.o.now()-E;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&M>2};for(;this._currentPlacementIndex>=0;){const M=c[n[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&M.visibility!=="none"&&(!M.minzoom||M.minzoom<=O)&&(!M.maxzoom||M.maxzoom>O)){const z=M,H=z.layout.get("symbol-z-elevate"),G=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=z.layout.get("symbol-z-order"),J=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&G),K=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),ee=J&&K,re=this._inProgressLayer=this._inProgressLayer||new so(z),pe=s.B(M.source,M.scope);if(re.continuePlacement(H||ee?x[pe]:p[pe],this.placement,this._showCollisionBoxes,M,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const vu=512/s.al/2;class Cs{constructor(n,c,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*s.al,b=n.canonical.y*s.al;for(let E=0;E<c.length;E++){const{key:I,crossTileID:M,tileAnchorX:O,tileAnchorY:z}=c.get(E),H=Math.floor((x+O)*vu),G=Math.floor((b+z)*vu);this.index.add(H,G),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(n,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=vu/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*s.al,I=c.canonical.y*s.al;for(let M=0;M<n.length;M++){const O=n.get(M);if(O.crossTileID)continue;const{key:z,tileAnchorX:H,tileAnchorY:G}=O,$=Math.floor((E+H)*b),J=Math.floor((I+G)*b),K=this.index.range($-x,J-x,$+x,J+x).sort((ee,re)=>ee-re);for(const ee of K){const re=this.crossTileIDs[ee];if(this.keys[ee]===z&&!p.has(re)){p.add(re),O.crossTileID=re;break}}}}}class kl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],b={};for(const E in x){const I=x[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),b[I.tileID.key]=I}this.indexes[p]=b}this.lng=n}addBucket(n,c,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>n.overscaledZ)for(const I in E){const M=E[I];M.tileID.isChildOf(n)&&M.findMatches(c.symbolInstances,n,x)}else{const I=E[n.scaledTo(Number(b)).key];I&&I.findMatches(c.symbolInstances,n,x)}}for(let b=0;b<c.symbolInstances.length;b++){const E=c.symbolInstances.get(b);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Cs(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[b]),delete x[b],c=!0)}return c}}class ns{constructor(){this.layerIndexes={},this.crossTileIDs=new kl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,p,x){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new Xo);let E=!1;const I={};x.name!=="globe"&&b.handleWrapJump(p);for(const M of c){const O=M.getBucket(n);O&&n.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(M.tileID,O,this.crossTileIDs)&&(E=!0),I[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(n){const c={};n.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const bu=771;class zn{constructor(n,c,p,x){this.blendFunction=n,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}zn.Replace=[1,0,1,0],zn.disabled=new zn(zn.Replace,s.ao.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,s.ao.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,bu,1,bu],s.ao.transparent,[!0,!0,!0,!0]),zn.alphaBlendedNonPremultiplied=new zn([770,bu,770,bu],s.ao.transparent,[!0,!0,!0,!0]),zn.multiply=new zn([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),zn.additive=new zn([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class mn{constructor(n,c,p){this.func=n,this.mask=c,this.range=p}}mn.ReadOnly=!1,mn.ReadWrite=!0,mn.disabled=new mn(519,mn.ReadOnly,[0,1]);const oh=7680;class On{constructor(n,c,p,x,b,E){this.test=n,this.ref=c,this.mask=p,this.fail=x,this.depthFail=b,this.pass=E}}On.disabled=new On({func:519,mask:0},0,0,oh,oh,oh);const ad=1029,od=2305;class Mn{constructor(n,c,p){this.enable=n,this.mode=c,this.frontFace=p}}function Sp(f,n){const c=s.ca(f,3);s.cc(f,n),s.cg(f,3,c)}function Xm(f,n){const c=s.c7([]);return s.c8(c,c,-n),s.c9(c,c,-f),c}function cc(f,n){const c=[f[0],f[1],0],p=[n[0],n[1],0];if(s.ag(c)>=1e-15){const E=s.aw([],c);s.c5(p,E,s.bJ(p,E)),n[0]=p[0],n[1]=p[1]}const x=s.bI([],n,f);if(s.c6(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Xm(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Mn.disabled=new Mn(!1,ad,od),Mn.backCCW=new Mn(!0,ad,od),Mn.backCW=new Mn(!0,ad,2304),Mn.frontCW=new Mn(!0,1028,2304),Mn.frontCCW=new Mn(!0,1028,od);class x_{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=s.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c,p){if(this.orientation=null,!this.position)return;const x=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0),E=s.ae.fromLngLat(n,b),I=[E.x-x.x,E.y-x.y,E.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=cc(I,c)}setPitchBearing(n,c){this.orientation=Xm(s.an(n),s.an(-c))}}class ld{constructor(n,c){this._transform=s.bA([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.ca(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&s.cg(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c7([]),n&&Sp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Xm(n,c),Sp(this._transform,this._orientation)}forward(){const n=s.ca(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.ca(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.ca(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const p=new Float64Array(16);return s.bl(p,this.getWorldToCamera(n,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,c,p){const x=this.position;s.c5(x,x,-n);const b=new Float64Array(16);return s.bq(b,[p,p,p]),s.br(b,b,x),b[10]*=c,b}getWorldToCamera(n,c){const p=new Float64Array(16),x=new Float64Array(4),b=this.position;return s.cb(x,this._orientation),s.c5(b,b,-n),s.cc(p,x),s.br(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(n,c,p,x){const b=new Float64Array(16);return s.cd(b,n,c,p,x),b}getCameraToClipOrthographic(n,c,p,x,b,E){const I=new Float64Array(16);return s.ce(I,n,c,p,x,b,E),I}getDistanceToElevation(n,c=!1){const p=n===0?0:s.cf(n,c?s.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new ld([...this.position],[...this.orientation])}}const ao=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n});class oo{constructor(n=0,c=0,p=0,x=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=p,this.right=x}interpolate(n,c,p){return c.top!=null&&n.top!=null&&(this.top=s.ak(n.top,c.top,p)),c.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,c.bottom,p)),c.left!=null&&n.left!=null&&(this.left=s.ak(n.left,c.left,p)),c.right!=null&&n.right!=null&&(this.right=s.ak(n.right,c.right,p)),this}getCenter(n,c){const p=s.aA((this.left+n-this.right)/2,0,n),x=s.aA((this.top+c-this.bottom)/2,0,c);return new s.P(p,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Lo=15;class gf{constructor(n,c,p,x,b,E,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new oo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ld,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new gf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Lo}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const p=this.getProjection(),x=!s.by(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<c.length;E++){const I=new s.P(c[E][0]*this.width,p+c[E][1]*(this.height-p)),M=n.pointCoordinate(I);if(!M)continue;const O=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);x+=M[3]*O,b+=O}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}equals(n){const c=this.elevation,p=n.elevation,x=c!=null!=(p!=null)||c&&p&&c.exaggeration()!==p.exaggeration();return this.width===n.width&&this.height===n.height&&this.center.lng===n.center.lng&&this.center.lat===n.center.lat&&this.zoom===n.zoom&&this.bearing===n.bearing&&this.pitch===n.pitch&&this.fov===n.fov&&this.projection.name===n.projection.name&&this._edgeInsets.equals(n.padding)&&!x}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const x=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!s.cp(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.cq(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new x_;return c.position=new s.ae(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!s.cr(n))return!1;s.cs(n,n);const c=s.ct([],[0,0,-1],n),p=s.ct([],[0,-1,0],n);if(p[2]<0)return!1;const x=cc(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=s.aA(n[2],x/p,x/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,p){this._unmodified=!1,this._edgeInsets.interpolate(n,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new s.cu(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),E=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(p.x,x.x,b.x,E.x)),M=Math.floor(Math.max(p.x,x.x,b.x,E.x)),O=1;for(let z=I-O;z<=M+O;z++)z!==0&&c.push(new s.cu(z,n))}return c}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,c,p,x){let b=[];const E=p!=null,I=!E;if(I&&this.zoom<c||E&&p[0]===0&&p[1]===0)return b;const M=new Set,O=(H,G,$,J,K)=>{const ee=s.cY(G,H,$,J,K);M.has(ee)||(b.push(new s.aQ(H,G,$,J,K)),M.add(ee))};for(let H=0;H<n.length;H++){const G=n[H];if(I&&G.canonical.z!==c||E&&x!==void 0&&x>G.canonical.z)continue;const $=G.canonical,J=G.overscaledZ,K=G.wrap,ee=1<<$.z,re=$.x+1<ee,pe=$.x>0,fe=$.y+1<ee,ue=$.y>0,Ie=G.wrap-(pe?0:1),Te=G.wrap+(re?0:1),Ae=pe?$.x-1:ee-1,be=re?$.x+1:0;if(E)p[0]<0?(O(J,Te,$.z,be,$.y),p[1]<0&&fe&&(O(J,K,$.z,$.x,$.y+1),O(J,Te,$.z,be,$.y+1)),p[1]>0&&ue&&(O(J,K,$.z,$.x,$.y-1),O(J,Te,$.z,be,$.y-1))):p[0]>0?(O(J,Ie,$.z,Ae,$.y),p[1]<0&&fe&&(O(J,K,$.z,$.x,$.y+1),O(J,Ie,$.z,Ae,$.y+1)),p[1]>0&&ue&&(O(J,K,$.z,$.x,$.y-1),O(J,Ie,$.z,Ae,$.y-1))):p[1]<0&&fe?O(J,K,$.z,$.x,$.y+1):ue&&O(J,K,$.z,$.x,$.y-1);else{const ge=G.visibleQuadrants;1&ge&&(O(J,Ie,$.z,Ae,$.y),ue&&(O(J,K,$.z,$.x,$.y-1),O(J,Ie,$.z,Ae,$.y-1))),2&ge&&(O(J,Te,$.z,be,$.y),ue&&(O(J,K,$.z,$.x,$.y-1),O(J,Te,$.z,be,$.y-1))),4&ge&&(O(J,Ie,$.z,Ae,$.y),fe&&(O(J,K,$.z,$.x,$.y+1),O(J,Ie,$.z,Ae,$.y+1))),8&ge&&(O(J,Te,$.z,be,$.y),fe&&(O(J,K,$.z,$.x,$.y+1),O(J,Te,$.z,be,$.y+1)))}}const z=[];for(const H of b)b.some(G=>H.isChildOf(G))||z.push(H);if(b=z.filter(H=>!n.some(G=>!!(H.overscaledZ<c&&G.isChildOf(H))||H.equals(G)||H.isChildOf(G))),I){const H=1<<c,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[H*G.x,H*G.y],J=4,K=J*J;b=b.filter(ee=>{const re=ee.canonical.x+.5-$[0],pe=ee.canonical.y+.5-$[1];return re*re+pe*pe<K})}return b}extendTileCoverToNearPlane(n,c,p){const x=[],b=new Set;for(const pe of n)b.add(pe.key);const E=(pe,fe,ue,Ie,Te)=>{const Ae=s.cY(fe,pe,ue,Ie,Te);b.has(Ae)||(x.push(new s.aQ(pe,fe,ue,Ie,Te)),b.add(Ae))},I=n.reduce((pe,fe)=>Math.max(pe,fe.overscaledZ),p),M=1<<p,O=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],z=new s.P(0,0),H=new s.P(0,0),G=(pe,fe)=>{const ue=Math.floor(pe[0]),Ie=Math.floor(pe[1]),Te=(pe[0]-ue)*s.al,Ae=(pe[1]-Ie)*s.al,be=Math.floor(fe[0]),ge=Math.floor(fe[1]),ke=(fe[0]-be)*s.al,ze=(fe[1]-ge)*s.al;for(let je=-1;je<=1;je++){const Xe=ue+je;if(!(Xe<0||Xe>=M)){z.x=Te-je*s.al,H.x=ke-(Xe-be)*s.al;for(let Ze=-1;Ze<=1;Ze++){const ut=Ie+Ze;z.y=Ae-Ze*s.al,H.y=ze-(ut-ge)*s.al,s.cZ(z,H,O)&&E(I,0,p,Xe,ut)}}}},$=c.points,J=$[s.cv],K=$[s.cw],ee=this._projectToGround(J,$[s.cx]),re=this._projectToGround(K,$[s.cy]);return G(J,ee),G(K,re),x}_projectToGround(n,c){return s.cz(s.cA(),n,c,n[2]/(n[2]-c[2]))}coveringTiles(n){let c=this.coveringZoomLevel(n);const p=c,x=this.elevation&&this.elevation.exaggeration(),b=x&&!n.isTerrainDEM,E=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,O=1<<c,z=[O*I.x,O*I.y,0],H=this.projection.name==="globe",G=!H,$=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,G),J=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=O*s.cf(1,this.center.lat),ee=this._camera.position[2]/s.cf(1,this.center.lat),re=[O*J.x,O*J.y,ee*(G?1:K)],pe=H||x,fe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ue=this.isLODDisabled(!0)?c:0;let Ie;if(this._elevation&&n.isTerrainDEM)Ie=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();Ie=Le?Le.max:this._centerAltitude}else Ie=this._centerAltitude;const Te=n.isTerrainDEM?-Ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?s.cC(this):1,be=Le=>{const rt=new s.ae(Le.x+25e-6,Le.y,Le.z),yt=new s.ae(Le.x,Le.y+25e-6,Le.z),kt=Le.toLngLat(),qt=rt.toLngLat(),zt=yt.toLngLat(),Lt=this.locationCoordinate(kt),un=this.locationCoordinate(qt),an=this.locationCoordinate(zt),Zt=Math.hypot(un.x-Lt.x,un.y-Lt.y),on=Math.hypot(an.x-Lt.x,an.y-Lt.y);return Math.sqrt(Zt*on)*Ae/25e-6},ge=Le=>{const mt=Ie,rt=Te;return{aabb:s.cF(this,O,0,0,0,Le,rt,mt,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:mt,wrap:Le,fullyVisible:!1}},ke=[];let ze=[];const je=c,Xe=n.reparseOverscaled?p:c,Ze=(ee-this._centerAltitude)*K,ut=Le=>{if(!this._elevation||!Le.tileID||!E)return;const mt=this._elevation.getMinMaxForTile(Le.tileID),rt=Le.aabb;mt?(rt.min[2]=mt.min,rt.max[2]=mt.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Le.shouldSplit=et(Le),Le.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},xt=(Le,mt)=>{if(.707*mt<Le)return 1;const rt=mt/Le;return rt/(1.4144271570014144+(Math.pow(1.1,rt-1.4144271570014144+1)-1)/(1.1-1)-1)},et=Le=>{if(Le.zoom<ue)return!0;if(Le.zoom===je)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const mt=Le.aabb.distanceX(re),rt=Le.aabb.distanceY(re);let yt=Ze,kt=1;if(H){yt=Le.aabb.distanceZ(re);const on=Math.pow(2,Le.zoom),xn=s.a$((Le.y+1)/on),Dn=s.a$(Le.y/on),jn=Math.min(Math.max(M,xn),Dn),ni=s.d1(jn)/s.d1(M);if(kt=jn===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ni/this._mercatorScaleRatio),this.zoom<=s.c_&&Le.zoom===je-1&&ni>=.9)return!0}else if(b&&(yt=Le.aabb.distanceZ(re)*K),this.projection.isReprojectedInTileSpace&&p<=5){const on=Math.pow(2,Le.zoom),xn=be(new s.ae((Le.x+.5)/on,(Le.y+.5)/on));kt=xn>.85?1:xn}if(!E&&!H){const on=Math.sqrt(mt*mt+rt*rt+yt*yt);let xn=(1<<je-Le.zoom)*fe*kt;return xn*=xt(Math.max(yt,Ze),on),on<xn}let qt=Number.MAX_VALUE,zt=0;const Lt=Le.aabb.getCorners(),un=[];for(const on of Lt){s.av(un,on,re),H||(b?un[2]*=K:un[2]=Ze);const xn=s.bJ(un,this._camera.forward());xn<qt&&(qt=xn,zt=Math.abs(un[2]))}let an=(1<<je-Le.zoom)*fe*kt;if(an*=xt(Math.max(zt,Ze),qt),qt<an)return!0;const Zt=Le.aabb.closestPoint(z);return Zt[0]===z[0]&&Zt[1]===z[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)ke.push(ge(-Le)),ke.push(ge(Le));for(ke.push(ge(0));ke.length>0;){const Le=ke.pop(),mt=Le.x,rt=Le.y;let yt=Le.fullyVisible;const kt=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!yt){let qt=pe?Le.aabb.intersects($):Le.aabb.intersectsFlat($);if(qt===0&&kt()){const zt=new s.cD(Le.zoom,mt,rt);qt=s.cE(this,O,zt,!0).intersects($)}if(qt===0)continue;yt=qt===2}if(Le.zoom===je||!et(Le)){const qt=Le.zoom===je?Xe:Le.zoom;if(n.minzoom&&n.minzoom>qt)continue;let zt=0;if(!yt){let Zt=pe?Le.aabb.intersectsPrecise($):Le.aabb.intersectsPreciseFlat($);if(Zt===0&&kt()){const on=new s.cD(Le.zoom,mt,rt);Zt=s.cE(this,O,on,!0).intersectsPrecise($)}if(Zt===0)continue;if(n.calculateQuadrantVisibility)if($.containsPoint(Le.aabb.center))zt=15;else for(let on=0;on<4;on++)Le.aabb.quadrant(on).intersects($)!==0&&(zt|=1<<on)}const Lt=z[0]-(.5+mt+(Le.wrap<<Le.zoom))*(1<<c-Le.zoom),un=z[1]-.5-rt,an=Le.tileID?Le.tileID:new s.aQ(qt,Le.wrap,Le.zoom,mt,rt);n.calculateQuadrantVisibility&&(an.visibleQuadrants=zt),ze.push({tileID:an,distanceSq:Lt*Lt+un*un});continue}for(let qt=0;qt<4;qt++){const zt=(mt<<1)+qt%2,Lt=(rt<<1)+(qt>>1),un={aabb:E?Le.aabb.quadrant(qt):s.cF(this,O,Le.zoom+1,zt,Lt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:zt,y:Lt,wrap:Le.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};b&&!H&&(un.tileID=new s.aQ(Le.zoom+1===je?Xe:Le.zoom+1,Le.wrap,Le.zoom+1,zt,Lt),ut(un)),ke.push(un)}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,mt=this.horizonLineFromTop();ze=ze.filter(rt=>{const yt=[0,0,0,1],kt=[s.al,s.al,0,1],qt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());s.aC(yt,yt,qt),s.aC(kt,kt,qt);const zt=s.cG([],yt,kt),Lt=s.cH([],yt,kt),un=s.c$(zt,Lt);if(un===0)return!0;let an=!1;const Zt=this._elevation;if(Zt&&un>Le&&mt!==0){const on=this.calculateProjMatrix(rt.tileID.toUnwrapped());let xn;n.isTerrainDEM||(xn=Zt.getMinMaxForTile(rt.tileID)),xn||(xn={min:Te,max:Ie});const Dn=s.cI(this.rotation),jn=[Dn[0]*s.al,Dn[1]*s.al,xn.max];s.af(jn,jn,on),an=(1-jn[1])*this.height*.5<mt}return un<Le||an})}return ze.sort((Le,mt)=>Le.distanceSq-mt.distanceSq).map(Le=>Le.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const c=s.aA(n.lat,-s.cJ,s.cJ),p=this.projection.project(n.lng,c);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let p,x;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(c.x-b.x)/I,x=(c.y-b.y)/I}else{const I=this.pointCoordinate(c),M=this.pointCoordinate(b);p=I.x-M.x,x=I.y-M.y}const E=this.locationCoordinate(n);this.setLocation(new s.ae(E.x-p,E.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,c){return this.projection.locationPoint(this,n,c)}locationPoint3D(n,c){return this.projection.locationPoint(this,n,c,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,c){return this.coordinateLocation(this.pointCoordinate3D(n,c))}locationCoordinate(n,c){const p=c?s.cf(c,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new s.ae(x.x,x.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const p=c??this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.aC(x,x,this.pixelMatrixInverse),s.aC(b,b,this.pixelMatrixInverse);const E=b[3];s.cK(x,x,1/x[3]),s.cK(b,b,1/E);const I=x[2],M=b[2];return{p0:x,p1:b,t:I===M?0:(p-I)/(M-I)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.aC(c,c,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cK(c,c,1/c[3]),s.cK(p,p,1/p[3]),c[2]=s.cf(c[2],this._center.lat)*this.worldSize,p[2]=s.cf(p[2],this._center.lat)*this.worldSize,s.cK(c,c,1/this.worldSize),s.cK(p,p,1/this.worldSize),new s.ax([c[0],c[1],c[2]],s.aw([],s.av([],p,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:p,t:x}=n,b=s.cf(c[2],this._center.lat),E=s.cf(p[2],this._center.lat);return new s.ae(s.ak(c[0],p[0],x)/this.worldSize,s.ak(c[1],p[1],x)/this.worldSize,s.ak(b,E,x))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n,c){if(!this.elevation)return this.pointCoordinate(n,c);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ae(p[0],p[1],p[2]);let x=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,c);const E=.02*b,I=n.clone();for(let M=0;M<10&&b-x>E;M++){I.y=s.ak(x,b,.66);const O=this.projection.pointCoordinate3D(this,I.x,I.y);O?(b=I.y,p=O):x=I.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.aC(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(c,n)),E=this.pointLocation3D(new s.P(x,n)),I=this.pointLocation3D(new s.P(x,p)),M=this.pointLocation3D(new s.P(c,p));let O=Math.min(b.lng,E.lng,I.lng,M.lng),z=Math.max(b.lng,E.lng,I.lng,M.lng),H=Math.min(b.lat,E.lat,I.lat,M.lat),G=Math.max(b.lat,E.lat,I.lat,M.lat);const $=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,K=(ee,re,pe,fe,ue)=>{const Ie=(ee+pe)/2,Te=(re+fe)/2,Ae=new s.P(Ie,Te),{lng:be,lat:ge}=this.pointLocation3D(Ae),ke=Math.max(0,O-be,H-ge,be-z,ge-G);O=Math.min(O,be),z=Math.max(z,be),H=Math.min(H,ge),G=Math.max(G,ge),(ue<J||ke>$)&&(K(ee,re,Ie,Te,ue+1),K(Ie,Te,pe,fe,ue+1))};if(K(c,n,x,n,1),K(x,n,x,p,1),K(x,p,c,p,1),K(c,p,c,n,1),this.projection.name==="globe"){const[ee,re]=s.cM(this);ee?(G=90,z=180,O=-180):re&&(H=-90,z=180,O=-180)}return new s.aI(new s.aT(O,H),new s.aT(z,G))}_getBoundsRectangular(n,c){const{top:p,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=new s.P(x,p),M=new s.P(E,p),O=new s.P(E,b),z=new s.P(x,b);let H=this.pointCoordinate(I,n),G=this.pointCoordinate(M,n);const $=this.pointCoordinate(O,c),J=this.pointCoordinate(z,c),K=(ee,re)=>(re.y-ee.y)/(re.x-ee.x);return H.y>1&&G.y>=0?H=new s.ae((1-J.y)/K(J,H)+J.x,1):H.y<0&&G.y<=1&&(H=new s.ae(-J.y/K(J,H)+J.x,0)),G.y>1&&H.y>=0?G=new s.ae((1-$.y)/K($,G)+$.x,1):G.y<0&&H.y<=1&&(G=new s.ae(-$.y/K($,G)+$.x,0)),new s.aI().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((p,x)=>{if(x.dem){const b=x.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=n.canonical,b=1/this.height,E=this.cameraWorldSize,I=E/this.zoomScale(x.z),M=(x.x+Math.pow(2,x.z)*n.wrap)*I,O=x.y*I,z=this.point;z.x*=E/this.worldSize,z.y*=E/this.worldSize;const H=this.angle,G=Math.sin(-H),$=-Math.cos(-H);return p[c]={bearing:[G,$],center:[(z.x-M)*b,(z.y-O)*b],scale:I/s.al*b},p[c]}calculateFogTileMatrix(n){const c=n.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(n,c=!1,p=!1){const x=n.key;let b;if(b=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const E=this.calculatePosMatrix(n,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,s.aB(E,I,E),b[x]=new Float32Array(E),b[x]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=s.cN(n,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=s.bq([],[n,n,n]);return s.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=s.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),b=s.cf(1,this._center.lat);p[2]/=b,x[2]/=b,s.aw(x,x);const E=n.raycast(p,x,n.exaggeration());if(E){const I=s.bH([],p,x,E),M=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),O=(M.z+s.ag([M.x-p[0],M.y-p[1],M.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,p=s.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),b=c.getAtPointOrZero(new s.ae(...x)),E=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),M=x[2]-E;if(M<=I)if(M<0||n){const O=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],O.z-x[2]],H=s.ag(z);z[2]-=(I-M)/this._pixelsPerMercatorPixel;const G=s.ag(z);if(G===0)return;s.c5(z,z,H/G*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],O.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const G=this.center;return G.lat=s.aA(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(G.lng=s.aA(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let b=0,E=p,I=x;const M=this.width/2,O=this.height/2,z=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-O<z&&(I=z+O),x+O>H&&(I=H-O),H-z<this.height&&(b=Math.max(b,this.height/(H-z)),I=(H+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,J=this.worldSize/2-(G+$)/2;E=(p+J+this.worldSize)%this.worldSize-J,E-M<G&&(E=G+M),E+M>$&&(E=$-M),$-G<this.width&&(b=Math.max(b,this.width/($-G)),E=($+G)/2)}E===p&&I===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(E,I))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const x=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,b);let I;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-n.x/this.width,M[9]=2*n.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ke=ge*this.aspect,ze=-ke,je=-ge;ke-=n.x,ze-=n.x,ge+=n.y,je+=n.y,I=this._camera.getCameraToClipOrthographic(ze,ke,je,ge,this._nearZ,this._farZ),((Xe,Ze,ut,xt)=>{for(let et=0;et<16;et++)Xe[et]=s.ak(Ze[et],ut[et],xt)})(I,I,M,s.d0(this.pitch>=Lo?1:this.pitch/Lo))}else I=M;const O=s.cP([],M,E);let z=s.cP([],I,E);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),ke=s.bA([]);s.br(ke,ke,[ge.x*this.worldSize,ge.y*this.worldSize,0]),s.aB(ke,ke,s.cQ(this)),s.br(ke,ke,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),s.aB(z,z,ke),s.aB(O,O,ke),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],z,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=z,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),c){const ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-n.x/this.width,ge[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cP([],ge,E)}else this.expandedFarZProjMatrix=this.projMatrix;const H=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const G=new Float32Array(16);s.bA(G),s.cS(G,G,[1,-1,1]),s.cU(G,G,this._pitch),s.bB(G,G,this.angle);const $=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz($);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-n.x/this.width,$[9]=2*(n.y+J)/this.height,this.skyboxMatrix=s.aB(G,$,G);const K=this.point,ee=K.x,re=K.y,pe=this.width%2/2,fe=this.height%2/2,ue=Math.cos(this.angle),Ie=Math.sin(this.angle),Te=ee-Math.round(ee)+ue*pe+Ie*fe,Ae=re-Math.round(re)+ue*fe+Ie*pe,be=new Float64Array(z);if(s.br(be,be,[Te>.5?Te-1:Te,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=be,z=s.bC(),s.cS(z,z,[this.width/2,-this.height/2,1]),s.br(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=s.bC(),s.cS(z,z,[1,-1,1]),s.br(z,z,[-1,-1,0]),s.cS(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},z=s.bl(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(ge,ge,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,c];s.c5(b,b,x),s.c5(p,p,-1),s.cW(p,p,b);const E=s.bC();s.br(E,E,p),s.cS(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,x)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*b,x.y/this.worldSize-p[1]*b,n/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((c-p)/x,1)),this._camera.position=s.bH([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),b=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((n[2]-b)/Math.cos(p),E),M=this._zoomFromMercatorZ(I);s.bH(n,n,c,I),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(x,-Math.PI,Math.PI),this._setZoom(s.aA(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,p=s.cL,x=0,b=1/0;for(;p-c>1e-6&&p>c;){const E=c+.5*(p-c),I=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,I),O=this.scaleZoom(M/(Math.max(0,n)*this.tileSize)),z=Math.abs(E-O);z<b&&(b=z,x=E),E<O?c=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const p=Math.min(n.x,c.x),x=Math.max(n.x,c.x),b=Math.min(n.y,c.y),E=Math.max(n.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(p,b),new s.P(x,E),new s.P(p,E),new s.P(x,b)],M=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const z of I){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const G=this.rayIntersectionCoordinate(H);if(G.x<M||G.y<0||G.x>O||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,c){const p=s.ag(s.av([],this._camera.position,n)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([c,p,x],b){const E=[c,p,x,1];s.aC(E,E,b);const I=E[3]=Math.max(E[3],1e-6);return E[0]/=I,E[1]/=I,E[2]/=I,E})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,c=this.zoom,p=this.worldSize){const x=s.cO(n,c,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=s.ak(1,E,s.d0(this.pitch>=Lo?1:this.pitch/Lo))),E}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Yo=(f,n)=>{if(n>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?s.ah(60,45,c.pitch):s.ah(30,15,c.pitch),b=c._farZ-c._nearZ,E=n*c.height,I=((1-(M=x))*c.cameraToCenterDistance+M*(c._farZ+E))*p;var M;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/b,(I-E-c._nearZ)/b]}}},Vc=2048;class v_{constructor(n,c){this.aabb=n,this.lastCascade=c}}class lh{add(n,c){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[n.key]=new v_(c,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,c,p){const x=s.d9.fromPoints(n.points);let b=0;for(const E in this.receivers){const I=this.receivers[E];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const M=I.aabb.getCorners();for(let O=0;O<p.length;O++){let z=!0;for(const H of M){const G=[H[0]*c,H[1]*c,H[2]];if(s.af(G,G,p[O].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){z=!1;break}}if(I.lastCascade=O,b=Math.max(b,O),z)break}}return b+1}}class _f{constructor(n){this.painter=n,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new lh,this._depthMode=new mn(n.context.gl.LEQUAL,mn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,c){const p=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity"),b=c.properties.get("shadow-draw-before-layer");if(!c.shadowsEnabled()||x<=0)return;let E=-1,I=0;for(const re of p.style.order){const pe=p.style._mergedLayers[re];pe.hasShadowPass()&&!pe.isHidden(n.zoom)&&(E=I),b&&b===re&&(this._drawShadowAfterLayer=I>0?I-1:0),I+=1}if(this._enabled=E>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=E);const M=p.context,O=Vc,z=Vc;if(this._cascades.length===0||Vc!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<2;++re){const pe=p._shadowMapDebug,fe=M.gl,ue=M.createFramebuffer(O,z,pe?1:0,"texture"),Ie=new s.T(M,{width:O,height:z,data:null},fe.DEPTH_COMPONENT16);if(ue.depthAttachment.set(Ie.texture),pe){const Te=new s.T(M,{width:O,height:z,data:null},fe.RGBA8);ue.colorAttachment0.set(Te.texture)}this._cascades.push({framebuffer:ue,texture:Ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Ap(c);let H=0;if(n.elevation){const re=n.elevation,pe=[1e4,-1e4];re.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const ue=fe.dem.tree;pe[0]=Math.min(pe[0],ue.minimums[0]),pe[1]=Math.max(pe[1],ue.maximums[0])}),pe[0]!==1e4&&(H=(pe[1]-pe[0])*re.exaggeration())}const G=1.5*n.cameraToCenterDistance,$=3*G,J=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const pe=this._cascades[re];let fe=n.height/50,ue=1;re===0?ue=G:(fe=G,ue=$);const[Ie,Te]=Ip(n,this.shadowDirection,fe,ue,Vc,H);pe.scale=n.scale,pe.matrix=Ie,pe.boundingSphereRadius=Te,s.bl(J,pe.matrix),pe.frustum=s.cB.fromInvProjectionMatrix(J,1,0,!0),pe.far=ue}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Vc,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ee=p.transform.elevation;for(const re of this._groundShadowTiles){let pe={min:0,max:0};if(ee){const fe=ee.getMinMaxForTile(re);fe&&(pe=fe)}this.addShadowReceiver(re.toUnwrapped(),pe.min,pe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,Vc,Vc]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:s.ao.white,depth:1});for(const E of n.order){const I=n._mergedLayers[E];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const M=n.getLayerSourceCache(I),O=M?c[M.id]:void 0;(I.type==="model"||O&&O.length)&&p.renderLayer(p,M,I,O)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,c=n.style,p=n.context,x=p.gl,b=c.directionalLight,E=c.ambientLight;if(!b||!E)return;const I=[],M=Yo(n,n.longestCutoffRange);M.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const O=qa(c,b,E),z=new mn(x.LEQUAL,mn.ReadOnly,n.depthRangeFor3D),H=new On({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const G of this._groundShadowTiles){const $=G.toUnwrapped(),J=n.isTileAffectedByFog(G),K=n.getOrCreateProgram("groundShadow",{defines:I,overrideFog:J});this.setupShadows($,K),n.uploadCommonUniforms(p,K,$,null,M);const ee=ao(n.transform.calculateProjMatrix($),O);K.draw(n,x.TRIANGLES,z,H,zn.multiply,Mn.disabled,ee,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?zn.unblended:zn.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(n){const c=this.painter.transform,p=c.calculatePosMatrix(n,c.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){const c=s.bz(n);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,n),c}setupShadows(n,c,p){if(!this.enabled)return;const x=this.painter.transform,b=this.painter.context,E=b.gl,I=this._uniformValues,M=new Float64Array(16),O=x.calculatePosMatrix(n,x.worldSize);for(let z=0;z<this._cascades.length;z++)s.aB(M,this._cascades[z].matrix,O),I[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(E.TEXTURE0+11+z),this._cascades[z].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const z=s.d7(n.canonical),H=2/x.tileSize*s.al/Vc,G=H*this._cascades[0].boundingSphereRadius,$=H*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(p==="vector-tile"?1:3)*(function(K){const ee=s.aA((K-22)/-22,0,1);return .125*(1-ee)+4*ee})(x.zoom);I.u_shadow_normal_offset=[z,G*J,$*J],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(b,I)}setupShadowsFromMatrix(n,c,p=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,E=this._uniformValues,I=new Float64Array(16);for(let M=0;M<2;M++)s.aB(I,this._cascades[M].matrix,n),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(b.TEXTURE0+11+M),this._cascades[M].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=p,p?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,c,p,x){if(x[2]>=0)return{};const b=(function(M,O,z){const H=z/(1<<M.canonical.z);return new s.d9([M.canonical.x*H+M.wrap*z,M.canonical.y*H+M.wrap*z,0],[(M.canonical.x+1)*H+M.wrap*z,(M.canonical.y+1)*H+M.wrap*z,O])})(n,c,p).getCorners(),E=c/-x[2];x[0]<0?(s.d8(b[0],b[0],[x[0]*E,0,0]),s.d8(b[3],b[3],[x[0]*E,0,0])):x[0]>0&&(s.d8(b[1],b[1],[x[0]*E,0,0]),s.d8(b[2],b[2],[x[0]*E,0,0])),x[1]<0?(s.d8(b[0],b[0],[0,x[1]*E,0]),s.d8(b[1],b[1],[0,x[1]*E,0])):x[1]>0&&(s.d8(b[2],b[2],[0,x[1]*E,0]),s.d8(b[3],b[3],[0,x[1]*E,0]));const I={};return I.vertices=b,I.planes=[jc(b[1],b[0],b[4]),jc(b[2],b[1],b[5]),jc(b[3],b[2],b[6]),jc(b[0],b[3],b[7])],I}addShadowReceiver(n,c,p){this._receivers.add(n,s.d9.fromTileIdAndHeight(n,c,p))}getMaxCascadeForTile(n){const c=this._receivers.get(n);return c&&c.lastCascade?c.lastCascade:0}}function jc(f,n,c){const p=s.av([],c,n),x=s.av([],f,n),b=s.bI([],p,x),E=s.ag(b);return E===0?[0,0,1,0]:(s.c5(b,b,1/E),[b[0],b[1],b[2],-s.bJ(b,n)])}function Ap(f){const n=f.properties.get("direction"),c=s.d4(n.x,n.y,n.z);c[2]=s.aA(c[2],0,75);const p=s.d6([c[0],c[1],c[2]]);return s.d5(p.x,p.y,p.z)}function qa(f,n,c){const p=n.properties.get("color-use-theme")==="none",x=n.properties.get("color"),b=n.properties.get("intensity"),E=n.properties.get("direction"),I=[E.x,E.y,E.z],M=c.properties.get("color-use-theme")==="none",O=c.properties.get("color"),z=c.properties.get("intensity"),H=Math.max(s.bJ([0,0,1],I),0),G=[0,0,0];s.c5(G,O.toPremultipliedRenderColor(M?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),z);const $=[0,0,0];return s.c5($,x.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),H*b),s.db([G[0]>0?G[0]/(G[0]+$[0]):0,G[1]>0?G[1]/(G[1]+$[1]):0,G[2]>0?G[2]/(G[2]+$[2]):0])}function Ip(f,n,c,p,x,b){const E=f.zoom,I=f.scale,M=f.worldSize,O=1/M,z=f.aspect,H=Math.sqrt(1+z*z)*Math.tan(.5*f.fovX),G=H*H,$=p-c,J=p+c;let K,ee;G>$/J?(K=p,ee=p*H):(K=.5*J*(1+G),ee=.5*Math.sqrt($*$+2*(p*p+c*c)*G+J*J*G*G));const re=f.projection.pixelsPerMeter(f.center.lat,M),pe=f._camera.getCameraToWorldMercator(),fe=[0,0,-K*O];s.af(fe,fe,pe);let ue=ee*O;const Ie=function(yt){return yt[0]/=I,yt[1]/=I,yt[2]=s.cf(yt[2],f._center.lat),yt},Te=f._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const yt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?re:1),kt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);kt[8]=2*-f.centerOffset.x/f.width,kt[9]=2*f.centerOffset.y/f.height;const qt=new Float64Array(16);s.cP(qt,kt,yt);const zt=new Float64Array(16);s.bl(zt,qt);const Lt=s.cB.fromInvProjectionMatrix(zt,M,E,!0);for(const un of Lt.points){const an=Ie(un);ue=Math.max(ue,s.c6(s.da([],fe,an)))}}ue*=x/(x-1);const Ae=Math.acos(n[2]),be=Math.atan2(-n[0],-n[1]),ge=new ld;ge.position=fe,ge.setPitchBearing(Ae,be);const ke=ge.getWorldToCamera(M,re),ze=ue*M,je=Math.min(f._mercatorZfromZoom(17)*M*-2,-2*ze),Xe=ge.getCameraToClipOrthographic(-ze,ze,-ze,ze,je,(ze+b*re)/n[2]),Ze=new Float64Array(16);s.aB(Ze,Xe,ke);const ut=s.d5(Math.floor(1e6*fe[0])/1e6*M,Math.floor(1e6*fe[1])/1e6*M,0),xt=.5*x,et=[0,0,0];s.af(et,ut,Ze),s.c5(et,et,xt);const Le=[Math.floor(et[0]),Math.floor(et[1]),Math.floor(et[2])],mt=[0,0,0];s.av(mt,et,Le),s.c5(mt,mt,-1/xt);const rt=new Float64Array(16);return s.bA(rt),s.br(rt,rt,mt),s.aB(Ze,rt,Ze),[Ze,ze]}class yf extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,c){return s.dc(this.requestManager.transformRequest(c,s.R.Model).url).then(p=>{if(!p)return;const x=s.dd(p),b=new s.de(n,c,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${c}: ${p.message}`)))})}load(n,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(n),b=[],E=[];for(const I of x){const M=n[I];this.hasURLBeenRequested(M)&&!p.forceReload||(this.modelByURL[M]={modelId:I,scope:c},b.push(this.loadModel(I,M)),E.push(I)),this.models[c][I]||(this.models[c][I]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+E.length,Promise.allSettled(b).then(I=>{for(let M=0;M<I.length;M++){const{status:O}=I[M];if(O==="rejected")continue;const{value:z}=I[M];this.models[c][E[M]]||(this.models[c][E[M]]={model:null,numReferences:1}),this.models[c][E[M]].model=z}this.numModelsLoading[c]-=E.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,c):this.getModelByURL(this.modelUris[c][n]))}getModel(n,c){return this.models[c]||(this.models[c]={}),this.models[c][n]?this.models[c][n].model:void 0}getModelByURL(n){if(!n)return null;const c=this.modelByURL[n];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(n,c){return this.models[c]&&this.models[c][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===x)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:b,modelId:E}=this.modelByURL[x];this.models[b][E].numReferences++}else this.modelUris[p][n]=x,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in n)p[x]=this.requestManager.normalizeModelURL(n[x])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of n)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&s.df(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,c,p=!1,x=!1){if(this.models[c]&&this.models[c][n]&&(this.models[c][n].numReferences--,this.models[c][n].numReferences===0||x)){const b=this.modelUris[c][n];p||delete this.modelUris[c][n],delete this.modelByURL[b];const E=this.models[c][n].model;if(!E)return;delete this.models[c][n],E.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const c of Object.keys(this.models[n])){const p=this.models[n][c].model;delete this.models[n][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(n.context)}}const Ll=s.a6.colorTheme,Ko=new s.a9({data:new s.aa(Ll.data)});function Ym(f){if(!f.metadata||!f.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:c,top:p,width:x,height:b}=f.metadata.content_area,E=c*n,I=p*n;return[E,I,E+x*n,I+b*n]}function Km(f){if(f)return f.map(([n,c])=>[n*s.o.devicePixelRatio,c*s.o.devicePixelRatio])}class ch{constructor(n,c,p){this.id=n,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof sa))return n;const x=c.map(E=>this.sourceCache.getTile(E)),b=p.getImages(x,Array.from(this.pendingRequests));for(const[E,I]of b)n.set(s.I.from({name:E,iconsetId:this.id}),I),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),n}}class Cp{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(n,c){const p=Ye("button",n,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return Ye("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,c){this._map&&(n.setAttribute("aria-label",c),n.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const c=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Ye("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,c){for(let p=0;p<n.length;p++){const x=n[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(x.id)}),E=(x.name||"").trim(),I=x.zIndex.toString(),M=E?Array.from(E).slice(0,3).join(""):I;this._setButtonTitle(b,M),this._model&&x.id===this._model.selectedFloorId&&c&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<n.length-1&&this._createSeparator()}}}class b_ extends s.E{constructor(n){super(),this._style=n,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[c,p]of Object.entries(n.buildings))if(this._buildings[c])for(const x of p.floorIds)this._buildings[c].floors[x]||(this._buildings[c].floors[x]=p.floors[x]);else this._buildings[c]=p;for(const c of n.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(n,c){const p=this._style.getIndoorSourceLayers(n,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Cp,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const n=this._style.map.transform,c=(function(p,x,b,E){let I=null,M=Number.MAX_SAFE_INTEGER;if(E<16)return null;for(const[O,z]of Object.entries(p)){const H=z.center;if(H){const G=x.distanceTo(s.aT.convert(H));G<M&&b.contains(H)&&(M=G,I=O)}}return I})(this._buildings,n.center,n.getBounds(),n.zoom);c!==this._closestBuildingId&&(this._closestBuildingId=c,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,c=this._closestBuildingId,p=c&&n?n[c]:void 0;if(!p)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let x=null;for(const E of p.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){x=E;break}const b=Array.from(p.floorIds).map(E=>({id:E,name:p.floors[E].name,zIndex:p.floors[E].zIndex})).sort((E,I)=>I.zIndex-E.zIndex).filter((E,I,M)=>I===0||E.zIndex!==M[I-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const uc=(f,n)=>Fe(f,n&&n.filter(c=>c.identifier!=="source.canvas")),w_=s.aH(hi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),T_=s.aH(hi,["setCenter","setZoom","setBearing","setPitch"]),Rp=new Set(["background","sky","slot","custom"]),Mp={version:8,layers:[],sources:{}},Uc={duration:300,delay:0};class Ha extends s.E{constructor(n,c={}){super(),this.map=n,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Uc),this._buildingIndex=new Nc(this),this.crossTileSymbolIndex=new ns,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new tr,this._hasDataDrivenEmissive=!1,this.indoorManager=new b_(this),this.dispatcher=c.dispatcher?c.dispatcher:new s.D(s.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Xr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new s.di(n._requestManager,c.localFontFamily?s.dj.all:c.localIdeographFontFamily?s.dj.ideographs:s.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new yf(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const p=this;this._rtlTextPluginCallback=Ha.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(s.dl(b),E&&E.every(I=>I))for(const I in p._sourceCaches){const M=p._sourceCaches[I],O=M.getSource().type;O!=="vector"&&O!=="geojson"||M.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===b.id&&this._validateLayer(I)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const c=s.dm(n);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${s.dn(JSON.stringify(n))}`}_diffStyle(n,c,p){this.globalId=this._getGlobalId(n);const x=(b,E)=>{try{E(null,this.setState(b,p))}catch(I){E(I,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),E=this.map._requestManager.transformRequest(b,s.R.Style);s.m(E,(I,M)=>{I?this.fire(new s.y(I)):M&&x(M,c)})}else typeof n=="object"&&x(n,c)}loadURL(n,c={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,c.accessToken),this.resolvedImports.add(n);const x=this.importsCache.get(n);if(x)return this._load(x,p);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(b,(E,I)=>{if(this._request=null,E)this.fire(new s.y(E));else if(I)return this.importsCache.set(n,I),this._load(I,p)})}loadJSON(n,c={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Mp,!1)}_loadImports(n,c,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of n){const E=this._createFragmentStyle(b),I=new Promise(z=>{E.once("style.import.load",z),E.once("error",z)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(b.url)){E.loadEmpty();continue}const M=b.data||this.importsCache.get(b.url);M?(E.loadJSON(M,{validate:c}),this._isInternalStyle(M)&&(E.globalId=null)):b.url?E.loadURL(b.url,{validate:c}):E.loadEmpty();const O={style:E,id:b.id,config:b.config};if(p){const z=this.fragments.findIndex(({id:H})=>H===p);this.fragments=this.fragments.slice(0,z).concat(O).concat(this.fragments.slice(z))}else this.fragments.push(O)}return Promise.allSettled(x)}getImportGlobalIds(n=this,c=new Set){for(const p of n.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(n){const c=this.scope?s.B(n.id,this.scope):n.id;let p;const x=this._initialConfig&&this._initialConfig[c];(n.config||x)&&(p=Object.assign({},n.config,x));const b=new Ha(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,c){if(this._isInternalStyle(n)){const b=Object.assign({},Mp,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(b,c)}if(this.updateConfig(this._config,n.schema),c&&uc(this,Va(n)))return;this._loaded=!0,this.stylesheet=s.dp(n);const p=()=>{for(const M in n.sources)this.addSource(M,n.sources[M],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const M in n.iconsets)this.addIconset(M,n.iconsets[M]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=rh(this.stylesheet.layers);if(this._order=b.map(M=>M.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new lt(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new lt(this.stylesheet.light)),this._layers={};for(const M of b){const O=s.du(M,this.scope,this._styleColorTheme.lut,this.options);O.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(O.fqid),O.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(O.fqid),this._hasAppearances=this._hasAppearances||O.getAppearances().length!==0,O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const z=this.getOwnLayerSourceCache(O),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&O.canCastShadows()&&H&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();n.imports?this._loadImports(n.imports,c).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(M=>{this.fire(new s.y(new Error("Failed to load imports",M))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const b=this._evaluateColorThemeData(x);this._loadColorTheme(b).then(()=>{p()}).catch(E=>{s.w(`Couldn't load color theme from the stylesheet: ${E}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(n=>n.style.hasAppearances())}mergeAll(){let n,c,p,x,b,E,I,M,O,z;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(G=>{if(G.stylesheet){if(G.light!=null&&(n=G.light),G.stylesheet.lights)for(const $ of G.stylesheet.lights)$.type==="ambient"&&G.ambientLight!=null&&(c=G.ambientLight),$.type==="directional"&&G.directionalLight!=null&&(p=G.directionalLight);x=this._prioritizeTerrain(x,G.terrain,G.stylesheet.terrain),G.stylesheet.fog&&G.fog!=null&&(b=G.fog),G.stylesheet.snow&&G.snow!=null&&(E=G.snow),G.stylesheet.rain&&G.rain!=null&&(I=G.rain),G.stylesheet.camera!=null&&(z=G.stylesheet.camera),G.stylesheet.projection!=null&&(M=G.stylesheet.projection),G.stylesheet.transition!=null&&(O=G.stylesheet.transition),H[G.scope]=G._styleColorTheme}}),this.light=n,this.ambientLight=c,this.directionalLight=p,this.fog=b,this.snow=E,this.rain=I,this._styleColorThemeForScope=H,x===null?delete this.terrain:this.terrain=x,this.camera=z||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=Object.assign({},Uc,O),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const c=p=>{for(const x of p.fragments)c(x.style);n(p)};c(this)}_prioritizeTerrain(n,c,p){const x=n&&n.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?n:null:c!=null&&(!n||x||c&&c.drapeRenderMode===1)?c:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{n=this._prioritizeTerrain(n,c.terrain,c.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(n=c.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},c={},p={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const E=s.B(b,x.scope);n[E]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const E=s.B(b,x.scope);c[E]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const E=s.B(b,x.scope);p[E]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const c of Object.values(n.stylesheet.indoor)){const p=c,x=s.B(p.sourceId,n.scope);this._mergedIndoor[x]=new Set(p.sourceLayers||[])}})}mergeLayers(){const n={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const I of E._order){const M=E._layers[I];if(M.type==="slot"){const O=s.dq(I);if(n[O])continue;n[O]=[]}M.slot&&n[M.slot]?n[M.slot].push(M):c.push(M)}}),this._mergedOrder=[];let x=-1;const b=(E=[])=>{for(const I of E)if(I.type==="slot"){const M=s.dq(I.id);n[M]&&b(n[M]),this._mergedSlots.push(M)}else{const M=s.B(I.id,I.scope);this._mergedOrder.push(M),p[M]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(c),this._has3DLayers){const E={};for(let I=0;I<this._mergedOrder.length;++I){const M=this._mergedOrder[I];E[M]=I===x?1:I<x?p[M].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,M)=>E[I]-E[M])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(c,p,x){const b=Object.assign({},p);for(const I of Object.keys(Ll))b[I]===void 0&&(b[I]=Ll[I].default);const E=new s.a8(Ko,c,new Map(x));return E.setTransitionOrValue(b,x),E.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=n;E.startsWith(b)||(E=b+E);const I=s.I.from("mapbox-reserved-lut"),M=new Image;M.src=E,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:O,height:z,data:H}=s.o.getImageData(M);if(z>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==z*z)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:O,height:z},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const G=this.imageManager.getImage(I,this.scope);G?(this._styleColorTheme.lut={image:G.data,data:n},p()):x(new Error("Missing LUT image."))}})}getLut(n){const c=this._styleColorThemeForScope[n];return c?c.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(c,p,x){let b,E,I;const M=s.o.devicePixelRatio>1?"@2x":"";let O=s.m(p.transformRequest(p.normalizeSpriteURL(c,M,".json"),s.R.SpriteJSON),(G,$)=>{O=null,I||(I=G,b=$,H())}),z=s.n(p.transformRequest(p.normalizeSpriteURL(c,M,".png"),s.R.SpriteImage),(G,$)=>{z=null,I||(I=G,E=$,H())});function H(){if(I)x(I);else if(b&&E){const G=s.o.getImageData(E),$={};for(const J in b){const{width:K,height:ee,x:re,y:pe,sdf:fe,pixelRatio:ue,stretchX:Ie,stretchY:Te,content:Ae}=b[J],be=new s.q({width:K,height:ee});s.q.copy(G,be,{x:re,y:pe},{x:0,y:0},{width:K,height:ee},null),$[J]={data:be,pixelRatio:ue!==void 0?ue:1,sdf:fe!==void 0&&fe,stretchX:Ie,stretchY:Te,content:Ae,usvg:!1,version:0}}x(null,$)}}return{cancel(){O&&(O.cancel(),O=null),z&&(z.cancel(),z=null)}}})(n,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.y(c));else if(p){const x=new Map;for(const b in p)x.set(s.I.from(b),p[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(n,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new ch(n,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(b,E)=>{if(this._spriteRequest=null,b)c?this._loadSprite(n):this.fire(new s.y(b));else if(E){const I=new Map;for(const M in E)I.set(s.I.from(M),E[M]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),(b,E)=>{if(b)return void x(b);const I={},M=s.dg(new s.bt(E));for(const O of M.icons){const z={version:1,pixelRatio:s.o.devicePixelRatio,content:Ym(O),stretchX:O.metadata?Km(O.metadata.stretch_x_areas):void 0,stretchY:O.metadata?Km(O.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:O};I[O.name]=z}x(null,I)}))}_validateLayer(n){const c=this.getOwnSource(n.source);if(!c)return;const p=n.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,c)=>{const p=this.fragments[c];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const c=[];for(const p of n){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];if(c._transitionablePaint&&c._transitionablePaint._values){const p=c._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const c=this.getOwnLayer(n);if(c)return c;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const c=this.getOwnSource(n);if(c)return c;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,c){const p=this.map.painter;if(p)for(let x=n.minzoom||0;x<(n.maxzoom||25.5);x++){const b=n.getProgramIds();if(b)for(const E of b){const I=n.getDefaultProgramParams(E,c.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(E,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(E,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(E,I)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const c=this.calculateLightsBrightness();n.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const M in I){const{updatedIds:O,removedIds:z}=I[M];(O||z)&&(this._updateWorkerLayers(M,O,z),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const I in this._mergedSourceCaches){const M=this._mergedSourceCaches[I];b[I]=M.used,M.used=!1,M.tileCoverLift=0}for(const I of this._mergedOrder){const M=this._mergedLayers[I];if(M.visibility!=="none"&&M.recalculate(n,this._availableImages),!M.isHidden(n.zoom)){const O=this.getLayerSourceCache(M);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,n)}):this.precompilePrograms(M,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const I of E)I.sourceCache.used=!0;for(const I in b){const M=this._mergedSourceCaches[I];b[I]!==M.used&&M.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const c of n){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const c in n)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(n,c,p){const x=this.getFragmentStyle(n);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:n,removedIds:p||[],options:x.options})}setState(n,c){if(this._checkLoaded(),uc(this,Va(n)))return!1;(n=s.dp(n)).layers=rh(n.layers);const p=(function(E,I){if(!E)return[{command:hi.setStyle,args:[I]}];let M=[];try{if(!s.by(E.version,I.version))return[{command:hi.setStyle,args:[I]}];if(s.by(E.center,I.center)||M.push({command:hi.setCenter,args:[I.center]}),s.by(E.zoom,I.zoom)||M.push({command:hi.setZoom,args:[I.zoom]}),s.by(E.bearing,I.bearing)||M.push({command:hi.setBearing,args:[I.bearing]}),s.by(E.pitch,I.pitch)||M.push({command:hi.setPitch,args:[I.pitch]}),s.by(E.sprite,I.sprite)||M.push({command:hi.setSprite,args:[I.sprite]}),s.by(E.glyphs,I.glyphs)||M.push({command:hi.setGlyphs,args:[I.glyphs]}),s.by(E.imports,I.imports)||(function($=[],J=[],K){J=J||[];const ee=($=$||[]).map(io),re=J.map(io),pe=$.reduce(Bc,{}),fe=J.reduce(Bc,{}),ue=ee.slice();let Ie,Te,Ae,be;for(Ie=0,Te=0;Ie<ee.length;Ie++)Ae=ee[Ie],fe.hasOwnProperty(Ae)?Te++:(K.push({command:hi.removeImport,args:[Ae]}),ue.splice(ue.indexOf(Ae,Te),1));for(Ie=0,Te=0;Ie<re.length;Ie++)Ae=re[re.length-1-Ie],ue[ue.length-1-Ie]!==Ae&&(pe.hasOwnProperty(Ae)?(K.push({command:hi.removeImport,args:[Ae]}),ue.splice(ue.lastIndexOf(Ae,ue.length-Te),1)):Te++,be=ue[ue.length-Ie],K.push({command:hi.addImport,args:[fe[Ae],be]}),ue.splice(ue.length-Ie,0,Ae));for(const ge of J){const ke=pe[ge.id];ke&&(delete ke.data,s.by(ke,ge)||K.push({command:hi.updateImport,args:[ge.id,ge]}))}})(E.imports,I.imports,M),s.by(E.transition,I.transition)||M.push({command:hi.setTransition,args:[I.transition]}),s.by(E.light,I.light)||M.push({command:hi.setLight,args:[I.light]}),s.by(E.fog,I.fog)||M.push({command:hi.setFog,args:[I.fog]}),s.by(E.snow,I.snow)||M.push({command:hi.setSnow,args:[I.snow]}),s.by(E.rain,I.rain)||M.push({command:hi.setRain,args:[I.rain]}),s.by(E.projection,I.projection)||M.push({command:hi.setProjection,args:[I.projection]}),s.by(E.lights,I.lights)||M.push({command:hi.setLights,args:[I.lights]}),s.by(E.camera,I.camera)||M.push({command:hi.setCamera,args:[I.camera]}),s.by(E.iconsets,I.iconsets)||(function($,J,K){let ee;for(ee in J=J||{},$=$||{})$.hasOwnProperty(ee)&&(J.hasOwnProperty(ee)||K.push({command:hi.removeIconset,args:[ee]}));for(ee in J){if(!J.hasOwnProperty(ee))continue;const re=J[ee];$.hasOwnProperty(ee)?s.by($[ee],re)||(K.push({command:hi.removeIconset,args:[ee]}),K.push({command:hi.addIconset,args:[ee,re]})):K.push({command:hi.addIconset,args:[ee,re]})}})(E.iconsets,I.iconsets,M),!s.by(E["color-theme"],I["color-theme"]))return[{command:hi.setStyle,args:[I]}];const O={},z=[];(function($,J,K,ee){let re;for(re in J=J||{},$=$||{})$.hasOwnProperty(re)&&(J.hasOwnProperty(re)||Co(re,K,ee));for(re in J){if(!J.hasOwnProperty(re))continue;const pe=J[re];$.hasOwnProperty(re)?s.by($[re],pe)||($[re].type==="geojson"&&pe.type==="geojson"&&sc($,J,re)?K.push({command:hi.setGeoJSONSourceData,args:[re,pe.data]}):_a(re,J,K,ee)):Io(re,J,K)}})(E.sources,I.sources,z,O);const H=[];E.layers&&E.layers.forEach($=>{$.source&&O[$.source]?M.push({command:hi.removeLayer,args:[$.id]}):H.push($)});let G=E.terrain;G&&O[G.source]&&(M.push({command:hi.setTerrain,args:[void 0]}),G=void 0),M=M.concat(z),s.by(G,I.terrain)||M.push({command:hi.setTerrain,args:[I.terrain]}),(function($,J,K){J=J||[];const ee=($=$||[]).map(io),re=J.map(io),pe=$.reduce(Bc,{}),fe=J.reduce(Bc,{}),ue=ee.slice(),Ie=Object.create(null);let Te,Ae,be,ge,ke,ze,je;for(Te=0,Ae=0;Te<ee.length;Te++)be=ee[Te],fe.hasOwnProperty(be)?Ae++:(K.push({command:hi.removeLayer,args:[be]}),ue.splice(ue.indexOf(be,Ae),1));for(Te=0,Ae=0;Te<re.length;Te++)be=re[re.length-1-Te],ue[ue.length-1-Te]!==be&&(pe.hasOwnProperty(be)?(K.push({command:hi.removeLayer,args:[be]}),ue.splice(ue.lastIndexOf(be,ue.length-Ae),1)):Ae++,ze=ue[ue.length-Te],K.push({command:hi.addLayer,args:[fe[be],ze]}),ue.splice(ue.length-Te,0,be),Ie[be]=!0);for(Te=0;Te<re.length;Te++)if(be=re[Te],ge=pe[be],ke=fe[be],!Ie[be]&&!s.by(ge,ke))if(s.by(ge.source,ke.source)&&s.by(ge["source-layer"],ke["source-layer"])&&s.by(ge.type,ke.type)){for(je in Ro(ge.layout,ke.layout,K,be,null,hi.setLayoutProperty),Ro(ge.paint,ke.paint,K,be,null,hi.setPaintProperty),s.by(ge.slot,ke.slot)||K.push({command:hi.setSlot,args:[be,ke.slot]}),s.by(ge.filter,ke.filter)||K.push({command:hi.setFilter,args:[be,ke.filter]}),s.by(ge.minzoom,ke.minzoom)&&s.by(ge.maxzoom,ke.maxzoom)||K.push({command:hi.setLayerZoomRange,args:[be,ke.minzoom,ke.maxzoom]}),ge)ge.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Ro(ge[je],ke[je],K,be,je.slice(6),hi.setPaintProperty):s.by(ge[je],ke[je])||K.push({command:hi.setLayerProperty,args:[be,je,ke[je]]}));for(je in ke)ke.hasOwnProperty(je)&&!ge.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Ro(ge[je],ke[je],K,be,je.slice(6),hi.setPaintProperty):s.by(ge[je],ke[je])||K.push({command:hi.setLayerProperty,args:[be,je,ke[je]]}))}else K.push({command:hi.removeLayer,args:[be]}),ze=ue[ue.lastIndexOf(be)+1],K.push({command:hi.addLayer,args:[ke,ze]})})(H,I.layers,M)}catch(O){console.warn("Unable to compute style diff:",O),M=[{command:hi.setStyle,args:[I]}]}return M})(this.serialize(),n).filter(E=>!(E.command in T_));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in w_));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const b=[];return p.forEach(E=>{b.push(this[E.command](...E.args))}),c&&Promise.all(b).then(c).catch(c),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[c,p]of n.entries()){if(this.getImage(c))return this.fire(new s.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,c){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,c,p=!1){this.imageManager.updateImage(n,this.scope,c),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(n){return this.modelManager.addModelURLs(n,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,c,p={}){return this._checkLoaded(),this._validate(Pe,`models.${n}`,c,null,p)||(this.modelManager.addModel(n,c,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.getActualScope())}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(n,c,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(ul,`sources.${n}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=To(n,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=E=>{const I=(E?"symbol:":"other:")+x.id,M=s.B(I,this.scope),O=this._sourceCaches[I]=new hs(M,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=O,O.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const c=this.getOwnSource(n);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([b,E])=>E.type==="source"&&E.source===n);if(x)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const x of p){const b=s.dq(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getOwnSource(n).setData(c),this._changes.setDirty()}getOwnSource(n){const c=this.getOwnSourceCache(n);return c&&c.getSource()}getOwnSources(){const n=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const c in n){const p=n[c]._tiles;for(const x in p){const b=p[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const b of n){if(this._validate(Dt,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(b),E.updateTransitions(c)}else this.ambientLight=new ui(b,cr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(b),E.updateTransitions(c)}else this.directionalLight=new ui(b,gi(),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,c=this.ambientLight;if(!n||!c)return;const p=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),x=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),E=n.properties.get("direction"),I=1-s.d4(E.x,E.y,E.z)[2]/90,M=p(x)*b*I,O=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),z=c.properties.get("intensity"),H=p(O)*z;return Number(((M+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dr(n)){const c=s.ds(n),p=this.fragments.find(({id:b})=>b===c);if(!p)return;const x=s.dq(n);return p.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:p})=>p===n);return c?c.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const c={},p=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in n){const b=this._featuresetSelectors[x]=[];for(const E of n[x].selectors){if(E.featureNamespace){const M=this.getOwnLayer(E.layer);if(!M){s.w(`Layer is undefined for selector: ${E.layer}`);continue}const O=p(M.source,M.sourceLayer);if(O in c&&c[O]!==E.featureNamespace){s.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[O]=E.featureNamespace}let I;if(E.properties)for(const M in E.properties){const O=s.U(E.properties[M]);O.result==="success"&&(I=I||{},I[M]=O.value)}b.push({layerId:E.layer,namespace:E.featureNamespace,properties:I,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const c=this.getFragmentStyle(n);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(n,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const E of x[n].selectors){const I=p.getOwnLayer(E.layer);I&&b.push(I)}return b}getConfigProperty(n,c){const p=this.getFragmentStyle(n);if(!p)return null;const x=s.B(c,p.scope),b=p.options.get(x),E=b?b.value||b.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,c){const p=s.B(n,c);return this._mergedIndoor[p]}setIndoorData(n,c){this.indoorManager.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,c,p){const x=this.getFragmentStyle(n);if(!x)return;const b=x.stylesheet.schema;if(!b||!b[c])return;const E=s.U(p);if(E.result!=="success")return void uc(this,E.value);const I=E.value.expression,M=s.B(c,x.scope),O=x.options.get(M);if(!O)return;let z;const{minValue:H,maxValue:G,stepValue:$,type:J,values:K}=b[c],ee=s.U(b[c].default);ee.result==="success"&&(z=ee.value.expression),z?(this.options.set(M,Object.assign({},O,{value:I,default:z,minValue:H,maxValue:G,stepValue:$,type:J,values:K})),this.updateConfigDependencies(c)):this.fire(new s.y(new Error(`No schema defined for the config option "${c}" in the "${n}" fragment.`)))}getConfig(n){const c=this.getFragmentStyle(n);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const b in p){const E=s.B(b,c.scope),I=c.options.get(E),M=I?I.value||I.default:null;x[b]=M?M.serialize():null}return x}setConfig(n,c){const p=this.getFragmentStyle(n);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const c=this.getFragmentStyle(n);return c?c.stylesheet.schema:null}setSchema(n,c){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(n,c){if(this._config=n,n||c)if(c)for(const p in c){let x,b;const E=s.U(c[p].default);if(E.result==="success"&&(x=E.value.expression),n&&n[p]!==void 0){const G=s.U(n[p]);G.result==="success"&&(b=G.value.expression)}const{minValue:I,maxValue:M,stepValue:O,type:z,values:H}=c[p];if(x){const G=s.B(p,this.scope);this.options.set(G,{default:x,value:b,minValue:I,maxValue:M,stepValue:O,type:z,values:H})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,c=()=>!0){for(const p of n){const x=this.getLayer(p);x&&c(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,c=>!n||c.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,c,p={}){this._checkLoaded();const x=n.id;if(this._layers[x])return void this.fire(new s.y(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if(uc(this,s.dt(n)))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=s.dp(n),n=Object.assign(n,{source:x})),this._validate(qe,`layers.${x}`,n,{arrayIndex:-1},p))return;b=s.du(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}const E=s.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let I=this._order.length;if(c){const H=this._order.indexOf(c);if(H===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));b.slot&&b.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):I=H}this._order.splice(I,0,x),this._handleLayerOrderChange(),this._layers[x]=b;const M=this.getOwnLayerSourceCache(b),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&b.canCastShadows()&&O&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(b);if(z&&b.source&&M&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const H=s.B(b.source,b.scope);z.type!==b.type?this._changes.updateSourceCache(H,"clear"):(this._changes.updateSourceCache(H,"reload"),M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,c){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===c)return;const x=this._order.indexOf(n);this._order.splice(x,1);let b=this._order.length;if(c){const E=this._order.indexOf(c);if(E===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot&&p.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):b=E}this._order.splice(b,0,n),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(n){this._checkLoaded();const c=this._checkLayer(n);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let b=!1;for(const E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){b=!0;break}x.castsShadows=b}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,p){this._checkLoaded();const x=this._checkLayer(n);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,c){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(n,c,p={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!s.by(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ne,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=s.dp(c),this._updateLayer(x)))}getFilter(n){const c=this._checkLayer(n);if(c)return s.dp(c.filter)}setLayoutProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.by(b.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&uc(b,ye.call(Va,{key:`layers.${n}.layout.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(c,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);b&&(c==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(c)?this.setPaintProperty(n,c,p,x):this.setLayoutProperty(n,c,p,x))}getLayoutProperty(n,c){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(c)}setPaintProperty(n,c,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.by(b.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&uc(b,oe.call(Va,{key:`layers.${n}.paint.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:s.a6})))return;const E=b.setPaintProperty(c,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,c){const p=this._checkLayer(n);if(p)return p.getPaintProperty(c)}setFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:M,importId:O}=n.target,z=this.getFragmentStyle(O),H=z.getFeaturesetLayers(M);for(const{source:G,sourceLayer:$}of H)z.setFeatureState({id:n.id,source:G,sourceLayer:$},c)}else if("layerId"in n.target){const{layerId:M}=n.target,O=this.getLayer(M);this.setFeatureState({id:n.id,source:O.source,sourceLayer:O.sourceLayer},c)}return}const p=n.source,x=n.sourceLayer,b=this._checkSource(p);if(!b)return;const E=b.type;if(E==="geojson"&&x)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const M of I)M.setFeatureState(x,n.id,c)}removeFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:M,importId:O}=n.target,z=this.getFragmentStyle(O),H=z.getFeaturesetLayers(M);for(const{source:G,sourceLayer:$}of H)z.removeFeatureState({id:n.id,source:G,sourceLayer:$},c)}else if("layerId"in n.target){const{layerId:M}=n.target,O=this.getLayer(M);this.removeFeatureState({id:n.id,source:O.source,sourceLayer:O.sourceLayer},c)}return}const p=n.source,x=this._checkSource(p);if(!x)return;const b=x.type,E=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const M of I)M.removeFeatureState(E,n.id,c)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:E,importId:I}=n.target,M=this.getFragmentStyle(I),O=M.getFeaturesetLayers(E);for(const{source:z,sourceLayer:H}of O){const G=M.getFeatureState({id:n.id,source:z,sourceLayer:H});if(G&&!b)b=G;else if(!s.by(b,G))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:E}=n.target,I=this.getLayer(E);b=this.getFeatureState({id:n.id,source:I.source,sourceLayer:I.sourceLayer})}return b}const c=n.source,p=n.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),c=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const c of Object.values(this._mergedLayers))n(c)&&this._updateLayer(c)}_updateLayer(n){this._changes.updateLayer(n);const c=this.getLayerSourceCache(n),p=s.B(n.source,n.scope),x=this._changes.getUpdatedSourceCaches();n.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,x={},b=[];for(let I=p.length-1;I>=0;I--){const M=p[I];if(c(M)){x[M]=I;for(const O of n){const z=O[M];if(z)for(const H of z)b.push(H)}}}b.sort((I,M)=>M.intersectionZ-I.intersectionZ);const E=[];for(let I=p.length-1;I>=0;I--){const M=p[I];if(c(M))for(let O=b.length-1;O>=0;O--){const z=b[O].feature;if(z.layer&&x[z.layer.id]<I)break;E.push(z),b.pop()}else for(const O of n){const z=O[M];if(z)for(const H of z)E.push(H.feature)}}return E}queryRasterValue(n,c,p){const x=this.getOwnSource(n);return x?x.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(c,p):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const b={},E=z=>{if(Rp.has(z.type))return;const H=this.getOwnLayerSourceCache(z),G=b[H.id]=b[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(G.has3DLayers=!0),G.layers[z.fqid]=G.layers[z.fqid]||{styleLayer:z,targets:[]},G.layers[z.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const z of c.layers){const H=this._layers[z];if(!H)return this.fire(new s.y(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];E(H)}}else for(const z in this._layers)E(this._layers[z]);const I=this._queryRenderedFeatures(n,b,p),M=this._flattenAndSortRenderedFeatures(I),O=[];for(const z of M)s.dw(z.layer.id)===this.scope&&O.push(z);return O}queryRenderedFeatureset(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const b="mock",E=[];if(c&&c.target)E.push(Object.assign({},c,{targetId:b,filter:x}));else{const z=this.getFeaturesetDescriptors();for(const H of z)E.push({targetId:b,filter:x,target:H});for(const{style:H}of this.fragments){const G=H.getFeaturesetDescriptors();for(const $ of G)E.push({targetId:b,filter:x,target:$})}}const I=this.queryRenderedTargets(n,E,p),M=[],O=new Set;for(const z of I)for(const H of z.variants[b])dl(H,z,O)||M.push(new s.dx(z,H));return M}queryRenderedTargets(n,c,p){const x={},b=(I,M,O,z)=>{const H=x[M.id]=x[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(H.layers[I.fqid]=H.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(H.has3DLayers=!0),!z)return O.uniqueFeatureID=!1,void H.layers[I.fqid].targets.push(O);H.layers[I.fqid].targets.push(Object.assign({},O,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const I of c)if("featuresetId"in I.target){const{featuresetId:M,importId:O}=I.target,z=this.getFragmentStyle(O);if(!z||!z._featuresetSelectors)continue;const H=z._featuresetSelectors[M];if(!H){this.fire(new s.y(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const G of H){const $=z.getOwnLayer(G.layerId);$&&!Rp.has($.type)&&b($,z.getOwnLayerSourceCache($),I,G)}}else if("layerId"in I.target){const{layerId:M}=I.target,O=this.getLayer(M);if(!O||Rp.has(O.type))continue;b(O,this.getLayerSourceCache(O),I)}const E=this._queryRenderedFeatures(n,x,p);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(n,c,p){const x=[],b=!!this.map._showQueryGeometry,E=Ti.createFromScreenPoints(n,p);for(const I in c){const M=ma(E,c[I],this._availableImages,p,b,this.getActualScope());Object.keys(M).length&&x.push(M)}if(this.placement)for(const I in c){if(!c[I].sourceCache._onlySymbols)continue;const M=pf(E.screenGeometry,c[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&x.push(M)}return x}querySourceFeatures(n,c){const p=c&&c.filter;p&&this._validate(ne,"querySourceFeatures.filter",p,null,c);let x=[];const b=this.getOwnSourceCaches(n);for(const E of b)x=x.concat(nd(E,c));return x}addSourceType(n,c,p){return Ha.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Ha.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,c,p={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const I in n)if(!s.by(n[I],x[I])){b=!0;break}if(!b)return;const E=this._getTransitionParameters();this.light.setLight(n,c,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,c=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const x=!("source"in n)||n.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=s.dp(p),p=Object.assign(p,{source:I})}const b=Object.assign({},p),E={};if(this.terrain&&x){b.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(E.style=I.serialize())}if(this._validate(no,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new s.z("data",{dataType:"style"}))}else{const b=this.terrain,E=b.get();for(const I of Object.keys(s.a6.terrain))!p.hasOwnProperty(I)&&s.a6.terrain[I].default&&(p[I]=s.a6.terrain[I].default);for(const I in n)if(!s.by(n[I],E[I])){b.set(n,this.options),this.stylesheet.terrain=n;const M=this._getTransitionParameters({duration:0});b.updateTransitions(M),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new kn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(n){const c=this.snow=new vr(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(n){const c=this.rain=new ir(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!s.by(c.get(),n)){c.set(n,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),n()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,c){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const p=this.terrain=new It(n,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,p,x,b={}){if(b&&b.validate===!1)return!1;const E=Object.assign({},this.serialize());return uc(this,n.call(Va,Object.assign({key:c,style:E,value:p,styleSpec:s.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const c=this.getSourceCaches(n);for(const p of c)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];c._clear&&c._clear()}}reloadSource(n){const c=this.getSourceCaches(n);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let c;this.directionalLight&&(c=Ap(this.directionalLight));const p=new Set,x=new Set;for(const b in this._mergedLayers){const E=this._mergedLayers[b];E.type==="building"&&p.add(E.source),E.hasElevation()&&!x.has(E.source)&&x.add(E.source)}for(const b in this._mergedSourceCaches){const E=this._mergedSourceCaches[b],I=x.has(E._source.id);p.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(n,void 0,void 0,c,I)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Wm),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(n,c,p,x,b){this.pauseablePlacement||(this.pauseablePlacement=new Wm);let E=!1,I=!1;const M={},O={};for(const K of this._mergedOrder){const ee=this._mergedLayers[K];if(ee.type!=="symbol")continue;const re=s.B(ee.source,ee.scope);let pe=M[re];if(!pe){const ue=this.getLayerSourceCache(ee);if(!ue)continue;const Ie=ue.getRenderableIds(!0).map(Te=>ue.getTileByID(Te));O[re]=Ie.slice(),pe=M[re]=Ie.sort((Te,Ae)=>Ae.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(Ae.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(ee,pe,n.center.lng,n.projection);E=E||fe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const z=!!(this.placement&&!n.equals(this.placement.transform)),H=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!b||this.placement.lastReplacementSourceUpdateTime!==b.updateTime)),G=z||H||E,$=(G||this.pauseablePlacement.isStale())&&p===0,J=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),n.zoom)&&p!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||$||J)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(n,this._mergedOrder,c,p,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?G&&p!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,O,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),E&&this.pauseablePlacement.setStale()),I||E){this._buildingIndex.onNewFrame(n.zoom);for(let K=0;K<this._mergedOrder.length;K++){const ee=this._mergedLayers[this._mergedOrder[K]];if(ee.type!=="symbol"||ee.visibility==="none")continue;const re=this.isLayerClipped(ee);this.placement.updateLayerOpacities(ee,M[s.B(ee.source,ee.scope)],K,re?b:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!c)return p.push(n),this._loadImports([n],!0);const x=p.findIndex(({id:b})=>b===c);return x===-1&&this.fire(new s.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(n).concat(p.slice(x)),this._loadImports([n],!0,c)}updateImport(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);return x===-1?this:typeof c=="string"?(this.setImportUrl(n,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(n,c.url),s.by(c.config,p[x].config)||this.setImportConfig(n,c.config,c.data.schema),s.by(c.data,p[x].data)||this.setImportData(n,c.data),this)}moveImport(n,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(n);if(x===-1)return this;const b=this.getImportIndex(c);if(b===-1)return this;const E=p[x],I=this.fragments[x];return p=p.filter(({id:M})=>M!==n),this.fragments=this.fragments.filter(({id:M})=>M!==n),this.stylesheet.imports=p.slice(0,b).concat(E).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(I).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);if(x===-1)return this;p[x].url=c;const b=this.fragments[x];return b.style=this._createFragmentStyle(p[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(c),this}setImportData(n,c){this._checkLoaded();const p=this.getImportIndex(n),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(n,x[p].url))}setImportConfig(n,c,p){this._checkLoaded();const x=this.getImportIndex(n),b=this.stylesheet.imports||[];if(x===-1)return this;c?b[x].config=c:delete b[x].config;const E=this.fragments[x];p&&E.style.stylesheet&&(E.style.stylesheet.schema=p);const I=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=c,E.style.updateConfig(c,I),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return c===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),c}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&n.push(p.getSource())}return n}getSource(n,c){const p=this.getSourceCache(n,c);return p&&p.getSource()}getLayerSource(n){const c=this.getLayerSourceCache(n);return c&&c.getSource()}getSourceCache(n,c){const p=s.B(n,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const c=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[n]&&c.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&c.push(this._mergedSymbolSourceCaches[n]),c}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const c in n){const p=n[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(n){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=E=>{if(E){const I=c.images.map(M=>s.I.toString(M));E.setDependencies(c.tileID.key,c.type,I)}},b=s.B(c.source,c.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b]),c.images.some(E=>E.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(n,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(n,c,p){return s.dz(c,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this.getOwnSourceCaches(n);return c.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,c){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),x=n.type==="building";if(n.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ha.getSourceType=function(f){return $o[f]},Ha.setSourceType=function(f,n){$o[f]=n},Ha.registerForPluginStateChange=s.dA;var Qo=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,cd=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ra=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ol="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,uh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,$a=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,hh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Dp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,ud=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const hc=/#include\s+"([^"]+)"/g,dc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,lo=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Gc=new Set(["ifdef","ifndef","elif","if","defined"]),co=new Set;aa(Qo,co),aa(Ra,co),aa(cd,co);const qc={"_prelude_fog.vertex.glsl":uh,"_prelude_terrain.vertex.glsl":xf,"_prelude_shadow.vertex.glsl":Dp,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":$a,"_prelude_shadow.fragment.glsl":ud,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":hh,"_prelude_raster_particle.glsl":jt},dh={};ai("",xf),ai($a,uh),ai(ud,Dp),ai(hh,""),ai(jt,"");const wu=ai(cd,Ra),hd=Qo,E_=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",hd,wu.fragmentSource].join(`
`),Pp=["precision highp float;",hd,wu.vertexSource].join(`
`);var kp={background:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:ai(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ai(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ai(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ai(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ai(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ai(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ai(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ai(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ai(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ol),skyboxGradient:ai(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ol),skyboxCapture:ai(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ai(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ai(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function aa(f,n){const c=f.split(`
`);for(let p of c){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const x=p.match(lo);if(x)for(const b of x)Gc.has(b)||n.add(b)}}function ai(f,n){const c=new Set,p=[],x=[];f=f.replace(hc,(E,I)=>(x.push(I),"")),n=n.replace(hc,(E,I)=>(p.push(I),""));let b=new Set(co);aa(f,b),aa(n,b);for(const E of[...p,...x])dh[E]||(dh[E]=new Set,aa(qc[E],dh[E])),b=new Set([...b,...dh[E]]);return{fragmentSource:f=f.replace(dc,(E,I,M,O,z)=>(c.add(z),I==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${M} ${O} ${z};
#else
uniform ${M} ${O} u_${z};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${M} ${O} ${z} = u_${z};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${M} ${O} ${z};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(dc,(E,I,M,O,z)=>{const H=`MATERIAL_ATTRIBUTE_OFFSET_${z}`,G=O==="float"?"vec2":O,$=`GET_ATTRIBUTE_${G}(a_${z}, materialInfo, ${H})`,J=z.match(/color/)?"color":G;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${M} ${O} a_${z};
#endif
`:c.has(z)?I==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${H})
        in ${M} ${G} a_${z};
    #endif
out ${M} ${O} ${z};
#else
uniform ${M} ${O} u_${z};
#endif
`:I==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${M} ${O} ${z} = u_${z};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${z})
    #ifdef ${H}
        ${z} = unpack_mix_${J}(${$}, u_${z}_t);
    #else
        ${z} = unpack_mix_${J}(a_${z}, u_${z}_t);
    #endif
#else
    ${M} ${O} ${z} = u_${z};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${M} ${O} a_${z};
    out ${M} ${O} ${z};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${H})
        in ${M} ${G} a_${z};
    #endif
#else
uniform ${M} ${O} u_${z};
#endif
`:I==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${M} ${O} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${G} a_${z};
#else
uniform ${M} ${O} u_${z};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${M} ${O} ${z} = a_${z};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${H}
        ${M} ${O} ${z} = ${$};
    #else
        ${M} ${O} ${z} = a_${z};
    #endif
#else
    ${M} ${O} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${H}
        ${M} ${O} ${z} = unpack_mix_${J}(${$}, u_${z}_t);
    #else
        ${M} ${O} ${z} = unpack_mix_${J}(a_${z}, u_${z}_t);
    #endif
#else
    ${M} ${O} ${z} = u_${z};
#endif
`}),usedDefines:b,vertexIncludes:p,fragmentIncludes:x}}class dd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,p,x,b,E,I,M){this.context=n;let O=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!O&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&(O=!0);let z=this.boundDynamicVertexBuffers.length!==I.length;for(let H=0;!z&&H<I.length;H++)this.boundDynamicVertexBuffers[H]!==I[H]&&(z=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||O||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(c,p,x,b,E,I,M);else{n.bindVertexArrayOES.set(this.vao);for(const H of I)H&&(H.bind(),M&&H.instanceCount&&H.setVertexAttribDivisor(n.gl,c,M));b&&b.dynamicDraw&&b.bind()}}freshBind(n,c,p,x,b,E,I){const M=this.context,O=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,c.enableAttributes(O,n),c.bind(),c.setVertexAttribPointers(O,n,b);for(const z of p)z.enableAttributes(O,n),z.bind(),z.setVertexAttribPointers(O,n,b);for(const z of E)z&&(z.enableAttributes(O,n),z.bind(),z.setVertexAttribPointers(O,n,b),I&&z.instanceCount&&z.setVertexAttribDivisor(O,n,I));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Lp(f,n){const c=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ae(0,p/c).toLngLat().lat,new s.ae(0,(p+1)/c).toLngLat().lat]}function vf(f,n,c,p,x,b,E){const I=f.context,M=I.gl,O=c.hillshadeFBO;if(!O)return;f.prepareDrawTile();const z=f.isTileAffectedByFog(n),H=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&H.push("USE_MRT1");const G=f.getOrCreateProgram("hillshade",{overrideFog:z,defines:H});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.colorAttachment0.get());const $=((re,pe,fe,ue)=>{const Ie=fe.paint.get("hillshade-shadow-color"),Te=fe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=fe.paint.get("hillshade-highlight-color"),be=fe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=fe.paint.get("hillshade-accent-color"),ke=fe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=fe.paint.get("hillshade-emissive-strength");let je=s.an(fe.paint.get("hillshade-illumination-direction"));if(fe.paint.get("hillshade-illumination-anchor")==="viewport")je-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const Ze=re.style.directionalLight.properties.get("direction"),ut=s.d4(Ze.x,Ze.y,Ze.z);je=s.an(ut[1])}const Xe=!re.options.moving;return{u_matrix:ue||re.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:Lp(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),je],u_shadow:Ie.toPremultipliedRenderColor(Te?null:fe.lut),u_highlight:Ae.toPremultipliedRenderColor(be?null:fe.lut),u_emissive_strength:ze,u_accent:ge.toPremultipliedRenderColor(ke?null:fe.lut)}})(f,c,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(I,G,n.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:K,tileBoundsSegments:ee}=f.getTileBoundsBuffers(c);G.draw(f,M.TRIANGLES,x,b,E,Mn.disabled,$,p.id,J,K,ee)}function Oo(f,n,c){if(!n.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const b=c.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(p,b,x.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ml(f,n,c){const p=f.context,x=p.gl;if(!n.dem)return;const b=n.dem;if(p.activeTexture.set(x.TEXTURE1),Oo(f,n,b),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=b.dim;p.activeTexture.set(x.TEXTURE0);let I=n.hillshadeFBO;if(!I){const G=new s.T(p,{width:E,height:E,data:null},x.RGBA8);G.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=n.hillshadeFBO=p.createFramebuffer(E,E,1,"renderbuffer"),I.colorAttachment0.set(G.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:O,tileBoundsSegments:z}=f.getMercatorTileBoundsBuffers(),H=[];f.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&H.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(f,x.TRIANGLES,mn.disabled,On.disabled,zn.unblended,Mn.disabled,((G,$)=>{const J=$.stride,K=s.bC();return s.ce(K,0,s.al,-s.al,0,0,1),s.br(K,K,[0,-s.al,0]),{u_matrix:K,u_image:1,u_dimension:[J,J],u_zoom:G.overscaledZ}})(n.tileID,b),c.id,M,O,z),n.needsHillshadePrepare=!1}class qi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fc extends qi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zl extends qi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Nl extends qi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class bf extends qi{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class wf extends qi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Hc extends qi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class fh extends qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class js extends qi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ur extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class dr extends qi{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class pc extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Jo extends qi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Tu extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Bl extends qi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Tf extends qi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Op extends qi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class $c extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Fl extends qi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class zp extends qi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let fd=class extends qi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Np extends qi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class gl extends qi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class mc extends qi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Eu extends qi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Zc extends qi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Qm extends qi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ef extends qi{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Su extends qi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class pd extends qi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Wc extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class va extends qi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ph extends qi{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Sf extends ph{constructor(n,c,p=0){super(n,c),this.attachmentPoint=n.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class md extends ph{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Af extends ph{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class S_ extends md{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Sr=(f,n,c,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:n,u_ground_shadow_factor:c,u_emissive_texture_available:p}),gd=(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:O,u_globe_pos:z,u_globe_radius:H,u_viewport:G,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:J,u_emissive_texture_available:K});function Xc(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const el=new class{constructor(){this.operations={}}newMorphing(f,n,c,p,x){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},_d={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Yc(f,n,c){if(n===0)return 0;const p=n<1&&c===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Au(f,n){const c=1<<f.z;return!n&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}function yd(f,n){if(!f.style||!f.style.enable3dLights())return;const c=f.context,p=c.gl;c.activeTexture.set(p.TEXTURE1),n?n.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const xd=f=>({u_matrix:f});function If(f,n,c,p,x){if(x>0){const b=s.o.now(),E=(b-f.timeAdded)/x,I=n?(b-n.timeAdded)/x:-1,M=c.getSource(),O=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-O)>Math.abs(f.tileID.overscaledZ-O),H=z&&f.refreshedUponExpiration?1:s.aA(z?E:1-I,0,1);return n?{opacity:1,mix:1-H,isFading:E<1}:{opacity:H,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class Cf extends hs{constructor(n){const c=To("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Kc extends hs{constructor(n){const c=To("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,p){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const I=new Ao(E,this._source.tileSize*E.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[E.key]=I}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rf extends s.aQ{constructor(n,c,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class vd extends s.bV{constructor(n,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,b]=(function(){const M=new s.bd,O=new s.b0,z=131;M.reserve(17161),O.reserve(33800);const H=s.al/128,G=s.al+H/2,$=G+H;for(let K=-H;K<$;K+=H)for(let ee=-H;ee<$;ee+=H){const re=ee<0||ee>G||K<0||K>G?24575:0,pe=s.aA(Math.round(ee),0,s.al),fe=s.aA(Math.round(K),0,s.al);M.emplaceBack(pe+re,fe)}const J=(K,ee)=>{const re=ee*z+K;O.emplaceBack(re+1,re,re+z),O.emplaceBack(re+z,re+z+1,re+1)};for(let K=1;K<129;K++)for(let ee=1;ee<129;ee++)J(ee,K);return[0,129].forEach(K=>{for(let ee=0;ee<130;ee++)J(ee,K),J(K,ee)}),[M,O,32768]})(),E=n.context;this.gridBuffer=E.createVertexBuffer(p,s.bf.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=s.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Kc(c.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=E.gl;this._overlapStencilMode=new On({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cf(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const x=n.terrain.properties,b=n.terrain.drapeRenderMode===0,E=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=n.terrain&&n.terrain.scope,M=x.get("source"),O=b?this._mockSourceCache:n.getSourceCache(M,I);if(!O)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=O,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(c,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const c=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=n.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let I=b-this._previousZoom;const M=this._previousUpdateTimestamp;let O=b;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(b-O)>.5&&(I=.5*(b-O+I)),I*x<0&&(O+=I)),this._evaluationZoom=O;const z=E.getExaggeration(O),H=z===E.getExaggeration(Math.max(0,O-.1));if(H&&Math.abs(z-this._exaggeration)<.01)return z;let G=Math.min(.1,.00375*(this._updateTimestamp-M));return(H||z<.1||Math.abs(I)<1e-4)&&(G=Math.min(.2,4*G)),s.ak(this._exaggeration,z,G)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(M=>{const O=c.getTileByID(M).tileID;return O.projMatrix=p.calculateProjMatrix(O.toUnwrapped()),O});(function(M,O){const z=O.transform.pointCoordinate(O.transform.getCameraPoint()),H=new s.P(z.x,z.y);M.sort((G,$)=>{if($.overscaledZ-G.overscaledZ)return $.overscaledZ-G.overscaledZ;const J=new s.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),K=new s.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ee=H.mult(1<<G.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(J)-ee.distSqr(K)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const M in E){const O=E[M];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,n[M],b),O.usedForTerrain))continue;const z=n[M];O.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[c.id]=x.map(M=>new Rf(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const O=this.terrainTileForTile[M.key];if(!O)continue;const z=O.tileID.key;z in I||(this._visibleDemTiles.push(O),I[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Oo(this.painter,x,b))}}_prepareDemTileUniforms(n,c,p,x){if(!c||c.demTexture==null)return!1;const b=n.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-b.z),I=x||"";return p[`u_dem_tl${I}`]=[b.x*E%1,b.y*E%1],p[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const b=x.dem.tree.minimums[0];return b>0&&n++,p+b},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new s.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,x,c.R32F,{premultiply:!1}),b}setupElevationDraw(n,c,p){const x=this.painter.context,b=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let I=null,M=null,O=1;if(p&&p.morphing&&this._useVertexMorphing){const $=p.morphing.srcDemTile,J=p.morphing.dstDemTile;O=p.morphing.phase,$&&J&&(this._prepareDemTileUniforms(n,$,E,"_prev")&&(M=$),this._prepareDemTileUniforms(n,J,E)&&(I=J))}const z=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let H=null;var G;if(this.enabled?M&&I?(H=I.demTexture,x.activeTexture.set(b.TEXTURE4),M.demTexture.bind(z(M),b.CLAMP_TO_EDGE),E.u_dem_lerp=O):(I=this.terrainTileForTile[n.tileID.key],H=this._prepareDemTileUniforms(n,I,E)?I.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),H&&(E.u_dem_size=(G=H).size[0]===1?1:G.size[0]-2,H.bind(z(I),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,E),p&&p.useMeterToDem&&I){const $=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=$}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,$)}}globeUniformValues(n,c,p){const x=n.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,s.al,0),u_tile_br_up:x.upVector(c,s.al,s.al),u_tile_bl_up:x.upVector(c,0,s.al),u_tile_up_scale:p?s.dM(1):x.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,b,E,I,M){if(x.transform.projection.name==="globe")(function(O,z,H,G,$){const J=O.context,K=J.gl;let ee,re;const pe=O.transform,fe=s.dE(O,J,pe),ue=(Xe,Ze)=>{if(re===Ze)return;const ut=[_d[Ze],"PROJECTION_GLOBE_VIEW"];fe&&ut.push("CUSTOM_ANTIALIASING");const xt=O.isTileAffectedByFog(Xe);ee=O.getOrCreateProgram("globeRaster",{defines:ut,overrideFog:xt}),re=Ze},Ie=O.colorModeForRenderPass(),Te=new mn(K.LEQUAL,mn.ReadWrite,O.depthRangeFor3D);el.update($);const Ae=s.dF(pe),be=[s.aF(pe.center.lng),s.aJ(pe.center.lat)],ge=O.globeSharedBuffers,ke=[pe.width*s.o.devicePixelRatio,pe.height*s.o.devicePixelRatio],ze=Float32Array.from(pe.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const Xe=O.transform,Ze=Yc(Xe.zoom,z.exaggeration(),z.sourceCache._source.tileSize);re=-1;const ut=K.TRIANGLES;for(const xt of G){const et=H.getTile(xt),Le=On.disabled,mt=z.prevTerrainTileForTile[xt.key],rt=z.terrainTileForTile[xt.key];Xc(mt,rt)&&el.newMorphing(xt.key,mt,rt,$,250),yd(O,et.emissiveTexture),J.activeTexture.set(K.TEXTURE0),et.texture&&et.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const yt=el.getMorphValuesForProxy(xt.key),kt=yt?1:0;yt&&Object.assign(je,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:s.dD(yt.phase)}});const qt=s.dG(xt.canonical),zt=s.dH(qt.getCenter().lat),Lt=s.dI(xt.canonical,qt,zt,Xe.worldSize/Xe._pixelsPerMercatorPixel),un=s.bk(s.dJ(xt.canonical)),an=O.emissiveMode==="mrt-fallback"?1:0,Zt=gd(Xe.expandedFarZProjMatrix,ze,Ae,un,s.aj(Xe.zoom),be,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,ke,Ze,Xe._farZ,an,Lt);if(ue(xt,kt),ee&&(z.setupElevationDraw(et,ee,je),O.uploadCommonUniforms(J,ee,xt.toUnwrapped()),ge)){const[on,xn,Dn]=ge.getGridBuffers(zt,Ze!==0);ee.draw(O,ut,Te,Le,Ie,Mn.backCCW,Zt,"globe_raster",on,xn,Dn)}}}if(ge&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const Xe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&Xe.push("CUSTOM_ANTIALIASING"),ee=O.getOrCreateProgram("globeRaster",{defines:Xe});for(const Ze of G){const{x:ut,y:xt,z:et}=Ze.canonical,Le=xt===0,mt=xt===(1<<et)-1,[rt,yt,kt,qt]=ge.getPoleBuffers(et,!1);if(qt&&(Le||mt)){const zt=H.getTile(Ze);yd(O,zt.emissiveTexture),J.activeTexture.set(K.TEXTURE0),zt.texture&&zt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let Lt=s.dK(et,ut,pe);const un=s.bk(s.dJ(Ze.canonical)),an=O.emissiveMode==="mrt-fallback"?1:0,Zt=(on,xn)=>on.draw(O,K.TRIANGLES,Te,On.disabled,Ie,Mn.disabled,gd(pe.expandedFarZProjMatrix,Lt,Lt,un,0,be,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,ke,0,pe._farZ,an),"globe_pole_raster",xn,kt,qt);z.setupElevationDraw(zt,ee,je),O.uploadCommonUniforms(J,ee,Ze.toUnwrapped()),Le&&O.renderDefaultNorthPole&&Zt(ee,rt),mt&&O.renderDefaultSouthPole&&(Lt=s.cS(s.bC(),Lt,[1,-1,1]),Zt(ee,yt))}}}})(x,b,E,I,M);else{const O=x.context,z=O.gl;let H,G;const $=x.shadowRenderer,J=Yo(x,x.longestCutoffRange),K=Ie=>{if(G===Ie)return;const Te=[];Te.push(_d[Ie]),J.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),$&&(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&Te.push("NORMAL_OFFSET")),H=x.getOrCreateProgram("terrainRaster",{defines:Te}),G=Ie},ee=x.colorModeForRenderPass(),re=new mn(z.LEQUAL,mn.ReadWrite,x.depthRangeFor3D);el.update(M);const pe=x.transform,fe=Yc(pe.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ue=[0,0,0];if($){const Ie=x.style.directionalLight,Te=x.style.ambientLight;Ie&&Te&&(ue=qa(x.style,Ie,Te))}{G=-1;const Ie=z.TRIANGLES,[Te,Ae]=[b.gridIndexBuffer,b.gridSegments];for(const be of I){const ge=E.getTile(be),ke=On.disabled,ze=b.prevTerrainTileForTile[be.key],je=b.terrainTileForTile[be.key];Xc(ze,je)&&el.newMorphing(be.key,ze,je,M,250),yd(x,ge.emissiveTexture),O.activeTexture.set(z.TEXTURE0),ge.texture&&ge.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Xe=el.getMorphValuesForProxy(be.key),Ze=Xe?1:0;let ut;Xe&&(ut={morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:s.dD(Xe.phase)}});const xt=x.emissiveMode==="mrt-fallback"?1:0,et=Sr(be.projMatrix,Au(be.canonical,pe.renderWorldCopies)?fe/10:fe,ue,xt);if(K(Ze),!H)continue;b.setupElevationDraw(ge,H,ut);const Le=be.toUnwrapped();$&&$.setupShadows(Le,H),x.uploadCommonUniforms(O,H,Le,null,J),H.draw(x,Ie,re,ke,ee,Mn.backCCW,et,"terrain_raster",b.gridBuffer,Te,Ae)}}}})(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),I=c.style.order,M=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let O=0;for(const z of b){const H=x.getTileByID(z.proxyTileKey),G=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][n]:void 0,$=G!==void 0?x.renderCache[G]:this.pool[O++],J=G!==void 0;if(H.texture=$.tex,H.emissiveTexture=$.emissiveTex,J&&!$.dirty){M.push(H.tileID);continue}p.bindFramebuffer.set($.fb.framebuffer);const K=p.gl;let ee;K.drawBuffers(c.emissiveMode==="mrt-fallback"?[K.COLOR_ATTACHMENT0,K.COLOR_ATTACHMENT1]:[K.COLOR_ATTACHMENT0]),this.renderedToTile=!1,$.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),$.dirty=!1);for(let re=E.start;re<=E.end;++re){const pe=c.style._mergedLayers[I[re]];if(pe.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(pe),ue=fe?this.proxyToSource[z.key][fe.id]:[z];if(!ue)continue;const Ie=ue;p.viewport.set([0,0,$.fb.width,$.fb.height]),ee!==(fe?fe.id:null)&&(this._setupStencil($,ue,pe,fe),ee=fe?fe.id:null),c.renderLayer(c,fe,pe,Ie)}if(K.drawBuffers([K.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const pe=c.style._mergedLayers[I[re]];if(pe.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(pe),ue=fe?this.proxyToSource[z.key][fe.id]:[z];if(!ue)continue;const Ie=ue;p.viewport.set([0,0,$.fb.width,$.fb.height]),ee!==(fe?fe.id:null)&&(this._setupStencil($,ue,pe,fe),ee=fe?fe.id:null),c.renderLayer(c,fe,pe,Ie)}this.renderedToTile?($.dirty=!0,M.push(H.tileID)):J||--O,O===5&&(O=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(n){const c=n.order.length;let p=-1,x=c;for(let b=0;b<c;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?p=Math.max(p,b):x=Math.min(x,b);return x>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,I=1<<E.overscaledZ,{x:M,y:O}=E.canonical,z=M/I,H=(M+1)/I,G=O/I,$=(O+1)/I;return{minx:z,miny:G,maxx:H,maxy:$,t:b.dem.tree.raycastRoot(z,G,H,$,n,c,p),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,c,p);if(E!=null)return E}return null}_createFBO(){const n=this.painter.context,c=n.gl,p=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const x=new s.T(n,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=n.createFramebuffer(p[0],p[1],1,null);let E;return b.colorAttachment0.set(x.texture),this._emissiveTexture&&(E=new s.T(n,{width:p[0],height:p[1],data:null},c.R8),E.bind(c.LINEAR,c.CLAMP_TO_EDGE),b.createColorAttachment(n,1),b.colorAttachment1.set(E.texture)),b.depthAttachment=new S_(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,emissiveTex:E,dirty:!1}}_updateFBOs(n){if(this._emissiveTexture!==n){for(const c of this.pool)this._updateFBO(c,n);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,n);this._emissiveTexture=n}}_updateFBO(n,c){const p=n.fb,x=this.painter.context,b=x.gl,E=this.drapeBufferSize;if(c){const I=new s.T(x,{width:E[0],height:E[1],data:null},b.R8);I.bind(b.LINEAR,b.CLAMP_TO_EDGE),n.emissiveTex=I,p.createColorAttachment(x,1),p.colorAttachment1.set(I.texture)}else n.emissiveTex=void 0,p.removeColorAttachment(x,1);n.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._mergedLayers[n],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof pa){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(!b||c[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="line")continue;const E=x.widthExpression(),I=x.emissiveStrengthExpression();if(E instanceof s.ad||I instanceof s.ad){c[b.id]=!0;for(const M of this.proxyCoords){const O=this.proxyToSource[M.key][b.id];if(O)for(const z of O)this._clearRenderCacheForTile(b.id,z)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof ys){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(!b||c[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][b.id];if(M)for(const O of M){const z=If(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,E);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,c=n.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,b=0,E=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<c;)E=this._style._mergedLayers[n[b]];for(;b<c;++b){const I=this._style._mergedLayers[n[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(p.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:b-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<E.length;++I){const M=Object.values(E[I]);c.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const I=p[E];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const M=n[I.key],O=this.proxyToSource[I.key];let z=0;for(const H in O){const G=O[H],$=M[H];if(!$||$.length!==G.length||G.some((J,K)=>J!==$[K]||x[H]&&x[H].hasOwnProperty(J.key))){z=-1;break}++z}for(const H in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][H]].dirty=z<0||z!==Object.values(M).length}}const b=[...this._drapedRenderBatches];b.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of b)for(const I of p){if(c.proxyCachedFBO[I.key])continue;let M=c.renderCachePool.pop();M===void 0&&c.renderCache.length<50&&(M=c.renderCache.length,c.renderCache.push(this._createFBO())),M!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][E.start]=M,c.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):On.disabled}_renderTileClippingMasks(n,c){const p=this.painter,x=this.painter.context,b=x.gl;p._tileClippingMaskIDs={},x.setColorMode(zn.disabled),x.setDepthMode(mn.disabled);const E=p.getOrCreateProgram("clippingMask");for(const I of n){const M=p._tileClippingMaskIDs[I.key]=--c;E.draw(p,b.TRIANGLES,mn.disabled,new On({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),zn.disabled,Mn.disabled,xd(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const p=[n.x,n.y,1,1];s.aC(p,p,c.pixelMatrixInverse),s.cK(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,b=s.cf(1,c.center.lat),E=[x[0],x[1],x[2]/b,0],I=s.da([],p.slice(0,3),E);s.aw(I,I);const M=this.raycast(E,I,this._exaggeration);return M!==null&&M?(s.bH(E,E,I,M),E[3]=E[2],E[2]*=b,E):null}_setupProxiedCoordsForOrtho(n,c,p){if(n.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(n,c,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const O=b[M],z=this._findTileCoveringTileID(O,n);if(z){const H=this._createProxiedId(O,z,p[O.key]&&p[O.key][n.id]);x.push(H),this.proxyToSource[O.key][n.id]=[H]}}let E=!1;const I=new Set;for(let M=0;M<c.length;M++){const O=n.getTile(c[M]);if(!O||!O.hasData())continue;const z=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==O.tileID.canonical.z){const H=this.proxyToSource[z.tileID.key][n.id],G=this._createProxiedId(z.tileID,O,p[z.tileID.key]&&p[z.tileID.key][n.id]);H?H.splice(H.length-1,0,G):this.proxyToSource[z.tileID.key][n.id]=[G];const $=this.proxyToSource[z.tileID.key][n.id];I.has($)||I.add($),x.push(G),E=!0}}if(this._sourceTilesOverlap[n.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const M of I)M.sort((O,z)=>z.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(n,c,p){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,E=n.getSource(),I=E.tileID;if(!I)return;const M=new s.P(I.x,I.y)._div(1<<I.z),O=E.coordinates.map(s.ae.fromLngLat).reduce((H,G)=>(H.min.x=Math.min(H.min.x,G.x-M.x),H.min.y=Math.min(H.min.y,G.y-M.y),H.max.x=Math.max(H.max.x,G.x-M.x),H.max.y=Math.max(H.max.y,G.y-M.y),H),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(H,G)=>{const $=H.wrap+H.canonical.x/(1<<H.canonical.z),J=H.canonical.y/(1<<H.canonical.z),K=s.al/(1<<H.canonical.z),ee=G.wrap+G.canonical.x/(1<<G.canonical.z),re=G.canonical.y/(1<<G.canonical.z);return $+K<ee+O.min.x||$>ee+O.max.x||J+K<re+O.min.y||J>re+O.max.y};for(let H=0;H<b.length;H++){const G=b[H];for(let $=0;$<c.length;$++){const J=n.getTile(c[$]);if(!J||!J.hasData()||z(G,J.tileID))continue;const K=this._createProxiedId(G,J,p[G.key]&&p[G.key][n.id]),ee=this.proxyToSource[G.key][n.id];ee?ee.push(K):this.proxyToSource[G.key][n.id]=[K],x.push(K)}}}_createProxiedId(n,c,p){let x=this.orthoMatrix;if(p){const b=p.find(E=>E.key===c.tileID.key);if(b)return b}if(c.tileID.key!==n.key){const b=n.canonical.z-c.tileID.canonical.z;let E,I,M;x=s.bC();const O=c.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(E=s.al>>b,I=E*((c.tileID.canonical.x<<b)-n.canonical.x+O),M=E*((c.tileID.canonical.y<<b)-n.canonical.y)):(E=s.al<<-b,I=s.al*(c.tileID.canonical.x-(n.canonical.x+O<<-b)),M=s.al*(c.tileID.canonical.y-(n.canonical.y<<-b))),s.ce(x,0,E,0,E,0,1),s.br(x,x,[I,M,0])}return new Rf(c.tileID,n.key,x)}_findTileCoveringTileID(n,c){let p=c.getTile(n);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],b=x[n.key];if(p=b?c.getTileByID(b):null,p&&p.hasData()||b===null)return p;let E=p?p.tileID:n,I=E.overscaledZ;const M=c.getSource().minzoom,O=[];if(!b){const H=c.getSource().maxzoom;if(n.canonical.z>=H){const G=n.canonical.z-H;c.getSource().reparseOverscaled?(I=Math.max(n.canonical.z+2,c.transform.tileZoom),E=new s.aQ(I,n.wrap,H,n.canonical.x>>G,n.canonical.y>>G)):G!==0&&(I=H,E=new s.aQ(I,n.wrap,H,n.canonical.x>>G,n.canonical.y>>G))}E.key!==n.key&&(O.push(E.key),p=c.getTile(E))}const z=H=>{O.forEach(G=>{x[G]=H}),O.length=0};for(I-=1;I>=M&&(!p||!p.hasData());I--){p&&z(p.tileID.key);const H=E.calculateScaledKey(I);if(p=c.getTileByID(H),p&&p.hasData())break;const G=x[H];if(G===null)break;G===void 0?O.push(H):p=c.getTileByID(G)}return z(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[c.key]=!0}}function mh(f,n,c){const p=(function(I,M,O){const z=s.bJ(M,I),H=s.bJ(O,[.2126,.7152,.0722]),G=(J,K,ee)=>(1-ee)*J+ee*K,$=G(1-.3*Math.min(H,1),1,Math.min(z+1,1));return G(.92,1,Math.asin(s.aA(M[2],-1,1))/Math.PI+.5)*$})(f,[0,0,1],n),x=[0,0,0];s.c5(x,c.slice(0,3),p);const b=[0,0,0];s.c5(b,n.slice(0,3),f[2]);const E=[0,0,0];return s.d8(E,x,b),s.db(E)}const bd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Jm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Mf{static cacheKey(n,c,p,x){const b=[c];x&&b.push(x.cacheKey);for(const E of p)n.usedDefines.has(E)&&b.push(E);return b.join("/")}constructor(n,c,p,x,b,E){const I=n.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...E];const M=`#version 300 es
${(x?x.defines():[]).concat(E.map(K=>`#define ${K}`)).join(`
`)}`,O=[M,E_];for(const K of p.fragmentIncludes)O.push(qc[K]);O.push(p.fragmentSource);const z=O.join(`
`),H=[M,Pp];for(const K of p.vertexIncludes)H.push(qc[K]);this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&H.push("uniform int u_instanceID;"),H.push(p.vertexSource);let G=H.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const $=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource($,z),I.compileShader($),I.attachShader(this.program,$);const J=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(J,G),I.compileShader(J),I.attachShader(this.program,J),this.attributes={},I.linkProgram(this.program),I.deleteShader(J),I.deleteShader($),this.fixedUniforms=b(n),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=x?x.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(K=>({u_instanceID:new s.ch(K)}))(n)),(E.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(K=>({u_dem:new s.ch(K),u_dem_prev:new s.ch(K),u_dem_tl:new s.ck(K),u_dem_scale:new s.cj(K),u_dem_tl_prev:new s.ck(K),u_dem_scale_prev:new s.cj(K),u_dem_size:new s.cj(K),u_dem_lerp:new s.cj(K),u_exaggeration:new s.cj(K),u_depth:new s.ch(K),u_depth_size_inv:new s.ck(K),u_depth_range_unpack:new s.ck(K),u_occluder_half_size:new s.cj(K),u_occlusion_depth_offset:new s.cj(K),u_meter_to_dem:new s.cj(K),u_label_plane_matrix_inv:new s.cl(K)}))(n)),E.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new s.ci(K),u_tile_tr_up:new s.ci(K),u_tile_br_up:new s.ci(K),u_tile_bl_up:new s.ci(K),u_tile_up_scale:new s.cj(K)}))(n)),E.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new s.cl(K),u_fog_range:new s.ck(K),u_fog_color:new s.d3(K),u_fog_horizon_blend:new s.cj(K),u_fog_vertical_limit:new s.ck(K),u_fog_temporal_offset:new s.cj(K),u_frustum_tl:new s.ci(K),u_frustum_tr:new s.ci(K),u_frustum_br:new s.ci(K),u_frustum_bl:new s.ci(K),u_globe_pos:new s.ci(K),u_globe_radius:new s.cj(K),u_globe_transition:new s.cj(K),u_is_globe:new s.ch(K),u_viewport:new s.ck(K)}))(n)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new s.d3(K)}))(n)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new s.ci(K),u_lighting_directional_dir:new s.ci(K),u_lighting_directional_color:new s.ci(K),u_ground_radiance:new s.ci(K)}))(n)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new s.cl(K),u_light_matrix_1:new s.cl(K),u_fade_range:new s.ck(K),u_shadow_normal_offset:new s.ci(K),u_shadow_intensity:new s.cj(K),u_shadow_texel_size:new s.cj(K),u_shadow_map_resolution:new s.cj(K),u_shadow_direction:new s.ci(K),u_shadow_bias:new s.ci(K),u_shadowmap_0:new s.ch(K),u_shadowmap_1:new s.ch(K)}))(n)))}getAttributeLocation(n,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=n.getAttribLocation(this.program,c)),p}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(n,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(n,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(n,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(n,c,p,x,b,E,I,M,O,z){const H=n.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const G=n.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||n._terrain&&n._terrain.renderingToTexture||!bd.includes(this.name))||!(!H.layers3D||!Jm.includes(this.name))))return;const $=G.gl,J=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,G);if(!J)return;const K=[...this.fixedDefines,"DEBUG_WIREFRAME"],ee=n.getOrCreateProgram(this.name,{config:this.configuration,defines:K});G.program.set(ee.program);const re=(ue,Ie,Te)=>{if(Ie[ue]&&Te[ue])for(const Ae in Ie[ue])Te[ue][Ae]&&Te[ue][Ae].set(Te.program,Ae,Ie[ue][Ae].current)};O&&O.setUniforms(ee.program,G,ee.binderUniforms,I,{zoom:M}),re("fixedUniforms",this,ee),re("terrainUniforms",this,ee),re("globeUniforms",this,ee),re("fogUniforms",this,ee),re("lightsUniforms",this,ee),re("shadowUniforms",this,ee),J.bind(),G.setColorMode(new zn([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],s.ao.transparent,[!0,!0,!0,!1])),G.setDepthMode(new mn(c.func===$.LESS?$.LEQUAL:c.func,mn.ReadOnly,c.range)),G.setStencilMode(On.disabled);const pe=3*E.primitiveLength*2,fe=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ue=z||1;for(let Ie=0;Ie<ue;++Ie)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ie),$.drawElements($.LINES,pe,$.UNSIGNED_SHORT,fe)}else z&&z>1?$.drawElementsInstanced($.LINES,pe,$.UNSIGNED_SHORT,fe,z):$.drawElements($.LINES,pe,$.UNSIGNED_SHORT,fe);b.bind(),G.program.set(this.program),G.setDepthMode(c),G.setStencilMode(p),G.setColorMode(x)}checkUniforms(n,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${x} not set but required by ${c} being defined`)}}draw(n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee){const re=n.context,pe=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(p),re.setStencilMode(x),re.setColorMode(b),re.setCullFace(E);for(const[be,ge]of this.fixedUniformsEntries)ge.set(this.program,be,I[be]);J&&J.setUniforms(this.program,re,this.binderUniforms,G,{zoom:$});const fe={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[c];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const ue=K||[],Ie=J?J.getPaintVertexBuffers():[],Te=c===pe.TRIANGLES&&z,Ae=ee&&ee>0?1:void 0;for(const be of H.get()){const ge=be.vaos||(be.vaos={});if((ge[M]||(ge[M]=new dd)).bind(re,this,O,Ie,z,be.vertexOffset,ue,Ae),this.forceManualRenderingForInstanceIDShaders){const ke=ee||1;for(let ze=0;ze<ke;++ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),z?pe.drawElements(c,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2):pe.drawArrays(c,be.vertexOffset,be.vertexLength)}else ee&&ee>1?pe.drawElementsInstanced(c,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2,ee):z?pe.drawElements(c,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2):pe.drawArrays(c,be.vertexOffset,be.vertexLength);Te&&this._drawDebugWireframe(n,p,x,b,z,be,G,$,J,ee)}}}function Df(f,n,c=0){const p=Math.pow(2,n.tileID.overscaledZ),x=n.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=x*(n.tileID.canonical.x+n.tileID.wrap*p),E=x*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E],u_pattern_transition:c}}const Pf={terrain:0,flat:1},A_=s.bC(),gc=(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re)=>{const pe=n.style.light,fe=pe.properties.get("position"),ue=[fe.x,fe.y,fe.z],Ie=s.dO();pe.properties.get("anchor")==="viewport"&&(s.dP(Ie,-n.transform.angle),s.dQ(ue,ue,Ie));const Te=pe.properties.get("color").toPremultipliedRenderColor(null),Ae=n.transform,be={u_matrix:f,u_lightpos:ue,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:A_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Pf[O],u_base_type:Pf[z],u_ao:x,u_edge_radius:b,u_width_scale:E,u_flood_light_color:J,u_vertical_scale:K,u_flood_light_intensity:ee,u_ground_shadow_factor:re};return Ae.projection.name==="globe"&&(be.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],be.u_zoom_transition=H,be.u_inv_rot_matrix=$,be.u_merc_center=G,be.u_up_dir=Ae.projection.upVector(new s.cD(0,0,0),G[0]*s.al,G[1]*s.al),be.u_height_lift=M),be},Qc=(f,n,c,p,x,b)=>({u_matrix:f,u_edge_radius:n,u_width_scale:c,u_vertical_scale:p,u_height_type:Pf[x],u_base_type:Pf[b]}),eg=(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re)=>{const pe=gc(f,n,c,p,x,b,E,I,O,z,H,G,$,J,K,ee,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return Object.assign(pe,Df(n,M,re),fe)},Iu=(f,n,c)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:c}),Cu=(f,n,c,p,x,b=0)=>Object.assign(Iu(f,n,x),Df(c,p,b)),wd=(f,n,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:n,u_ground_shadow_factor:p}),kf=(f,n,c,p,x,b,E=0)=>Object.assign(Cu(f,n,c,p,b,E),{u_world:x}),gh=(f,n)=>({u_matrix:f,u_depth_bias:n}),Vl=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),Ru=(f,n,c,p,x)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),_c=(f,n,c,p,x,b,E,I,M)=>({u_matrix:f,u_normal_matrix:n,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:b,u_facade_emissive_chance:E,u_flood_light_color:I,u_flood_light_intensity:M}),tg=f=>({u_matrix:f}),uo=f=>({u_matrix:f}),Lf=(f,n,c,p,x,b,E,I)=>{const M=s.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(I),u_extrude_scale:[c.pixelsToGLUnits[0]/M,c.pixelsToGLUnits[1]/M],u_zoom_transition:p,u_tile_id:E,u_merc_center:x}},Td=(f,n,c,p)=>({u_matrix:f,u_inv_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(p),u_viewport_size:[c.width,c.height]}),yc=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),Jc=s.bC(),_h=(f,n,c,p,x,b,E)=>{const I=f.transform,M=I.projection.name==="globe",O=M?s.dR(I.zoom,n.canonical)*I._pixelsPerMercatorPixel:s.ay(c,1,b),z={u_matrix:n.projMatrix,u_extrude_scale:O,u_intensity:E,u_inv_rot_matrix:Jc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){z.u_inv_rot_matrix=p,z.u_merc_center=x,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.aj(I.zoom);const H=x[0]*s.al,G=x[1]*s.al;z.u_up_dir=I.projection.upVector(new s.cD(0,0,0),H,G)}return z};function Ed(f,[n,c,p,x],[b,E]){if(b===E)return[0,0,0,0];const I=255*(f-1)/(f*(E-b));return[n*I,c*I,p*I,x*I]}function Bp(f,n,[c,p]){return c===p?0:.5/f+(n-c)*(f-1)/(f*(p-c))}const yh=(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe,fe,ue)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:O,u_fade_t:z.mix,u_opacity:z.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(H.paint.get("raster-saturation")),u_contrast_factor:s.dS(H.paint.get("raster-contrast")),u_spin_weights:eu(H.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:$,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:Ed(s.dU,K,re),u_colorization_offset:Bp(s.dU,ee,re),u_color_ramp:J,u_texture_offset:[fe/(pe+2*fe),pe/(pe+2*fe)],u_texture_res:[pe+2*fe,pe+2*fe],u_emissive_strength:ue});function eu(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const xh=.05,I_=(f,n,c,p,x,b,E,I,M,O,z,H)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:O,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M}),vh=(f,n,c,p,x,b,E,I,M,O)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:c,u_velocity:p,u_color_ramp:b,u_velocity_res:x,u_max_speed:E,u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[xh,xh]}),Fp=(f,n,c,p,x,b,E,I,M,O)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:b,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[xh,xh]}),Of=s.bC(),bh=(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe,fe,ue,Ie,Te,Ae)=>{const be=x.transform,ge={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(pe),u_rotate_symbol:+c,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+O,u_elevation_from_sea:M?1:0,u_pitch_with_map:+p,u_texsize:z,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Of,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Of,u_up_vector:[0,-1,0],u_color_adj_mat:Ie,u_icon_transition:Te||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(pe)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ae||1,u_ground_shadow_factor:fe,u_inv_matrix:s.bl(s.bC(),E),u_normal_scale:ue,u_lutTexture:10};return pe.name==="globe"&&(ge.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],ge.u_zoom_transition=J,ge.u_inv_rot_matrix=ee,ge.u_merc_center=K,ge.u_camera_forward=be._camera.forward(),ge.u_ecef_origin=s.dV(be.globeMatrix,$.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(be.globeMatrix),ge.u_up_vector=re),ge},xc=(f,n,c,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:c,u_color:p}),Ma=(f,n,c,p,x,b,E,I,M)=>Object.assign((function(O,z,H,G,$,J){const{width:K,height:ee}=G.imageManager.getPixelSize(z),re=Math.pow(2,J.tileID.overscaledZ),pe=J.tileSize*Math.pow(2,G.transform.tileZoom)/re,fe=pe*(J.tileID.canonical.x+J.tileID.wrap*re),ue=pe*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[K,ee],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:$?[G.transform.width,-1*G.transform.height]:[1/s.ay(J,1,G.transform.tileZoom),1/s.ay(J,1,G.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,ue>>16],u_pixel_coord_lower:[65535&fe,65535&ue]}})(0,b,E,p,I,M),{u_matrix:f,u_emissive_strength:n,u_opacity:c}),ba=new Float32Array(s.bA([])),jl=(f,n,c,p,x,b,E,I,M,O,z,H,G,$=[0,0,0],J,K,ee)=>{const re=x.style.light,pe=re.properties.get("position"),fe=[-pe.x,-pe.y,pe.z],ue=s.dO();re.properties.get("anchor")==="viewport"&&(s.dP(ue,-x.transform.angle),s.dQ(fe,fe,ue));const Ie=z.alphaMode==="MASK",Te=re.properties.get("color").toNonPremultipliedRenderColor(null),Ae=G.paint.get("model-ambient-occlusion-intensity"),be=G.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return be.a=G.paint.get("model-color-mix-intensity").constantOr(0),ee&&(be.r=ee[0],be.g=ee[1],be.b=ee[2],be.a=ee[3]),K&&(be.r=K.color.r,be.g=K.color.g,be.b=K.color.b,be.a=K.colorMix,H=K.emissionStrength,b*=K.opacity),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:c,u_node_matrix:p||ba,u_lightpos:fe,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_camera_pos:$,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ie,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:O,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:be.toArray01(),u_aoIntensity:Ae,u_emissive_strength:H,u_occlusionTextureTransform:J||[0,0,0,0]}},wh=(f,n=ba,c=ba)=>({u_matrix:f,u_instance:n,u_node_matrix:c}),zf={fillExtrusion:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_opacity:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_flood_light_color:new s.ci(f),u_vertical_scale:new s.cj(f),u_flood_light_intensity:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new s.cl(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_vertical_scale:new s.cj(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_height_factor:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_opacity:new s.cj(f),u_pattern_transition:new s.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.cl(f),u_opacity:new s.cj(f),u_ao_pass:new s.cj(f),u_meter_to_tile:new s.cj(f),u_ao:new s.ck(f),u_flood_light_intensity:new s.cj(f),u_flood_light_color:new s.ci(f),u_attenuation:new s.cj(f),u_edge_radius:new s.cj(f),u_fb:new s.ch(f),u_fb_size:new s.cj(f),u_dynamic_offset:new s.cj(f)}),fill:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),fillOutline:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_ground_shadow_factor:new s.ci(f)}),fillOutlinePattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),building:f=>({u_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_opacity:new s.cj(f),u_faux_facade_ao_intensity:new s.cj(f),u_camera_pos:new s.ci(f),u_tile_to_meter:new s.cj(f),u_facade_emissive_chance:new s.cj(f),u_flood_light_color:new s.ci(f),u_flood_light_intensity:new s.cj(f)}),buildingBloom:f=>({u_matrix:new s.cl(f)}),buildingDepth:f=>({u_matrix:new s.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.cl(f),u_depth_bias:new s.cj(f)}),elevatedStructures:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.cl(f),u_camera_pos:new s.ci(f),u_depth_bias:new s.cj(f),u_height_scale:new s.cj(f),u_reset_depth:new s.cj(f)}),circle:s.dY,collisionBox:f=>({u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_extrude_scale:new s.ck(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f)}),collisionCircle:f=>({u_matrix:new s.cl(f),u_inv_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_viewport_size:new s.ck(f)}),debug:f=>({u_color:new s.dB(f),u_matrix:new s.cl(f),u_overlay:new s.ch(f),u_overlay_scale:new s.cj(f)}),clippingMask:f=>({u_matrix:new s.cl(f)}),heatmap:f=>({u_extrude_scale:new s.cj(f),u_intensity:new s.cj(f),u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_up_dir:new s.ci(f)}),heatmapTexture:f=>({u_image:new s.ch(f),u_color_ramp:new s.ch(f),u_opacity:new s.cj(f)}),hillshade:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_latrange:new s.ck(f),u_light:new s.ck(f),u_shadow:new s.dB(f),u_highlight:new s.dB(f),u_emissive_strength:new s.cj(f),u_accent:new s.dB(f)}),hillshadePrepare:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_dimension:new s.ck(f),u_zoom:new s.cj(f)}),line:s.dX,linePattern:s.dW,raster:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_brightness_low:new s.cj(f),u_brightness_high:new s.cj(f),u_saturation_factor:new s.cj(f),u_contrast_factor:new s.cj(f),u_spin_weights:new s.ci(f),u_perspective_transform:new s.ck(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f),u_colorization_mix:new s.d3(f),u_colorization_offset:new s.cj(f),u_color_ramp:new s.ch(f),u_texture_offset:new s.ck(f),u_texture_res:new s.ck(f),u_emissive_strength:new s.cj(f)}),rasterParticle:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f)}),rasterParticleTexture:f=>({u_texture:new s.ch(f),u_opacity:new s.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_tile_offset:new s.ck(f),u_velocity:new s.ch(f),u_color_ramp:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_velocity:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_speed_factor:new s.cj(f),u_reset_rate:new s.cj(f),u_rand_seed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new s.ch(f),u_is_size_feature_constant:new s.ch(f),u_size_t:new s.cj(f),u_size:new s.cj(f),u_camera_to_center_distance:new s.cj(f),u_rotate_symbol:new s.ch(f),u_aspect_ratio:new s.cj(f),u_fade_change:new s.cj(f),u_matrix:new s.cl(f),u_label_plane_matrix:new s.cl(f),u_coord_matrix:new s.cl(f),u_is_text:new s.ch(f),u_elevation_from_sea:new s.ch(f),u_pitch_with_map:new s.ch(f),u_texsize:new s.ck(f),u_texsize_icon:new s.ck(f),u_texture:new s.ch(f),u_texture_icon:new s.ch(f),u_gamma_scale:new s.cj(f),u_device_pixel_ratio:new s.cj(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_camera_forward:new s.ci(f),u_tile_matrix:new s.cl(f),u_up_vector:new s.ci(f),u_ecef_origin:new s.ci(f),u_is_halo:new s.ch(f),u_icon_transition:new s.cj(f),u_color_adj_mat:new s.cl(f),u_scale_factor:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_inv_matrix:new s.cl(f),u_normal_scale:new s.cj(f),u_lutTexture:new s.ch(f)}),background:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_color:new s.dB(f)}),backgroundPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_image:new s.ch(f),u_pattern_tl:new s.ck(f),u_pattern_br:new s.ck(f),u_texsize:new s.ck(f),u_pattern_size:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_pattern_units_to_pixels:new s.ck(f)}),terrainRaster:f=>({u_matrix:new s.cl(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_skirt_height:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_emissive_texture_available:new s.cj(f)}),skybox:f=>({u_matrix:new s.cl(f),u_sun_direction:new s.ci(f),u_cubemap:new s.ch(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxGradient:f=>({u_matrix:new s.cl(f),u_color_ramp:new s.ch(f),u_center_direction:new s.ci(f),u_radius:new s.cj(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dC(f),u_sun_direction:new s.ci(f),u_sun_intensity:new s.cj(f),u_color_tint_r:new s.d3(f),u_color_tint_m:new s.d3(f),u_luminance:new s.cj(f)}),globeRaster:f=>({u_proj_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_grid_matrix:new s.dC(f),u_skirt_height:new s.cj(f),u_far_z_cutoff:new s.cj(f),u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_globe_pos:new s.ci(f),u_globe_radius:new s.cj(f),u_viewport:new s.ck(f),u_emissive_texture_available:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_horizon:new s.cj(f),u_transition:new s.cj(f),u_fadeout_range:new s.cj(f),u_atmosphere_fog_color:new s.d3(f),u_high_color:new s.d3(f),u_space_color:new s.d3(f),u_temporal_offset:new s.cj(f),u_horizon_angle:new s.cj(f)}),model:f=>({u_matrix:new s.cl(f),u_lighting_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_node_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_camera_pos:new s.ci(f),u_opacity:new s.cj(f),u_baseColorFactor:new s.d3(f),u_emissiveFactor:new s.d3(f),u_metallicFactor:new s.cj(f),u_roughnessFactor:new s.cj(f),u_baseTextureIsAlpha:new s.ch(f),u_alphaMask:new s.ch(f),u_alphaCutoff:new s.cj(f),u_baseColorTexture:new s.ch(f),u_metallicRoughnessTexture:new s.ch(f),u_normalTexture:new s.ch(f),u_occlusionTexture:new s.ch(f),u_emissionTexture:new s.ch(f),u_lutTexture:new s.ch(f),u_color_mix:new s.d3(f),u_aoIntensity:new s.cj(f),u_emissive_strength:new s.cj(f),u_occlusionTextureTransform:new s.d3(f)}),modelDepth:f=>({u_matrix:new s.cl(f),u_instance:new s.cl(f),u_node_matrix:new s.cl(f)}),groundShadow:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),stars:f=>({u_matrix:new s.cl(f),u_up:new s.ci(f),u_right:new s.ci(f),u_intensity_multiplier:new s.cj(f)}),snowParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_horizontalOscillationRadius:new s.cj(f),u_horizontalOscillationRate:new s.cj(f),u_boxSize:new s.cj(f),u_billboardSize:new s.cj(f),u_simpleShapeParameters:new s.ck(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_particleColor:new s.d3(f),u_direction:new s.ci(f)}),rainParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_texScreen:new s.ch(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_boxSize:new s.cj(f),u_rainDropletSize:new s.ck(f),u_distortionStrength:new s.cj(f),u_rainDirection:new s.ci(f),u_color:new s.d3(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_shapeDirectionalPower:new s.cj(f),u_shapeNormalPower:new s.cj(f),u_mode:new s.cj(f)}),vignette:f=>({u_vignetteShape:new s.ci(f),u_vignetteColor:new s.d3(f)}),occlusion:f=>({u_matrix:new s.cl(f),u_anchorPos:new s.ci(f),u_screenSizePx:new s.ck(f),u_occluderSizePx:new s.ck(f),u_color:new s.d3(f)})};class Da{constructor(n,c,p,x){this.id=Da.uniqueIdxCounter,Da.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Da.uniqueIdxCounter,Da.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Da.uniqueIdxCounter=0;const zo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Us{constructor(n,c,p,x,b,E){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=n;const I=n.gl;this.buffer=I.createBuffer(),n.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let p=0;p<this.attributes.length;p++){const x=c.getAttributeLocation(n,this.attributes[p].name);x!==-1&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,c,p){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=c.getAttributeLocation(n,b.name);E!==-1&&n.vertexAttribPointer(E,b.components,n[zo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,c,p){for(let x=0;x<this.attributes.length;x++){const b=c.getAttributeLocation(n,this.attributes[x].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vc{constructor(n,c,p,x,b){this.context=n,this.width=c,this.height=p;const E=this.framebuffer=n.gl.createFramebuffer();x>0&&(this.colorAttachment0=new Sf(n,E,0)),x>1&&(this.colorAttachment1=new Sf(n,E,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new md(n,E):new Af(n,E))}createColorAttachment(n,c){c===0?this.colorAttachment0=new Sf(n,this.framebuffer,0):c===1&&(this.colorAttachment1=new Sf(n,this.framebuffer,1))}removeColorAttachment(n,c){const p=this.context.gl;let x;c===0?(x=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(x=this.colorAttachment1.get(),this.colorAttachment1=void 0),x&&p.deleteTexture(x)}destroy(){const n=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&n.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&n.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&n.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&n.deleteTexture(c)}n.deleteFramebuffer(this.framebuffer)}}class _l{constructor(n,c){this.gl=n,this.clearColor=new fc(this),this.clearDepth=new zl(this),this.clearStencil=new Nl(this),this.colorMask=new bf(this),this.depthMask=new wf(this),this.stencilMask=new Hc(this),this.stencilFunc=new fh(this),this.stencilOp=new js(this),this.stencilTest=new Ur(this),this.depthRange=new dr(this),this.depthTest=new pc(this),this.depthFunc=new Jo(this),this.blend=new Tu(this),this.blendFunc=new Bl(this),this.blendColor=new Tf(this),this.blendEquation=new Op(this),this.cullFace=new $c(this),this.cullFaceSide=new Fl(this),this.frontFace=new zp(this),this.program=new fd(this),this.activeTexture=new Np(this),this.viewport=new gl(this),this.bindFramebuffer=new mc(this),this.bindRenderbuffer=new Eu(this),this.bindTexture=new Zc(this),this.bindVertexBuffer=new Qm(this),this.bindElementBuffer=new Ef(this),this.bindVertexArrayOES=new Su(this),this.pixelStoreUnpack=new pd(this),this.pixelStoreUnpackPremultiplyAlpha=new Wc(this),this.pixelStoreUnpackFlipY=new va(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=n.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c,p){return new Da(this,n,c,p)}createVertexBuffer(n,c,p,x,b){return new Us(this,n,c,p,x,b)}createRenderbuffer(n,c,p){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(n,c,p,x){return new vc(this,n,c,p,x)}clear({color:n,depth:c,stencil:p,colorMask:x}){const b=this.gl;let E=0;n&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(E)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.by(n.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ft;function Gr(f,n,c,p,x,b,E){const I=f.context,M=I.gl,O=f.transform,z=[s.aF(O.center.lng),s.aJ(O.center.lat)],H=c.layout.get("symbol-placement"),G=c.layout.get("text-variable-anchor"),$=c.layout.get("icon-rotation-alignment")==="map",J=c.layout.get("text-rotation-alignment")==="map",K=H!=="point",ee=[];let re=0,pe=0;for(let be=0;be<p.length;be++){const ge=p[be],ke=n.getTile(ge),ze=ke.getBucket(c);if(!ze)continue;const je=ze.getProjection().createInversionMatrix(O,ge.canonical),Xe=[],Ze=id(ge,ze,O),ut=!E&&$&&K,xt=E&&J&&K,et=G&&ze.hasTextData(),Le=ze.hasIconTextFit()&&et&&ze.hasIconData(),mt=ut||xt||E&&et||Le,rt=ze.projection.name==="globe",yt=rt?s.aj(O.zoom):0;rt&&(Xe.push("PROJECTION_GLOBE_VIEW"),mt&&Xe.push("PROJECTED_POS_ON_VIEWPORT"));const kt=f.getOrCreateProgram("collisionBox",{defines:Xe});let qt=Ze;x[0]===0&&x[1]===0||(qt=f.translatePosMatrix(Ze,ke,x,b));const zt=E?ze.textCollisionBox:ze.iconCollisionBox,Lt=ze.collisionCircleArray;if(Lt.length>0){const an=s.bC(),Zt=qt;s.cP(an,ze.placementInvProjMatrix,O.glCoordMatrix),s.cP(an,an,ze.placementViewportMatrix),ee.push({circleArray:Lt,circleOffset:pe,transform:Zt,invTransform:an,projection:ze.getProjection()}),re+=Lt.length/4,pe=re}if(!zt)continue;f.terrain&&f.terrain.setupElevationDraw(ke,kt);const un=rt?[ge.canonical.x,ge.canonical.y,1<<ge.canonical.z]:[0,0,0];kt.draw(f,M.LINES,mn.disabled,On.disabled,f.colorModeForRenderPass(),Mn.disabled,Lf(qt,je,O,yt,z,ke,un,ze.getProjection()),c.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,O.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt])}if(!E||!ee.length)return;const fe=f.getOrCreateProgram("collisionCircle"),ue=new s.dZ;ue.resize(4*re),ue._trim();let Ie=0;for(const be of ee)for(let ge=0;ge<be.circleArray.length/4;ge++){const ke=4*ge,ze=be.circleArray[ke+0],je=be.circleArray[ke+1],Xe=be.circleArray[ke+2],Ze=be.circleArray[ke+3];ue.emplace(Ie++,ze,je,Xe,Ze,0),ue.emplace(Ie++,ze,je,Xe,Ze,1),ue.emplace(Ie++,ze,je,Xe,Ze,2),ue.emplace(Ie++,ze,je,Xe,Ze,3)}(!Ft||Ft.length<2*re)&&(Ft=(function(be){const ge=2*be,ke=new s.b0;ke.resize(ge),ke._trim();for(let ze=0;ze<ge;ze++){const je=6*ze;ke.uint16[je+0]=4*ze+0,ke.uint16[je+1]=4*ze+1,ke.uint16[je+2]=4*ze+2,ke.uint16[je+3]=4*ze+2,ke.uint16[je+4]=4*ze+3,ke.uint16[je+5]=4*ze+0}return ke})(re));const Te=I.createIndexBuffer(Ft,!0),Ae=I.createVertexBuffer(ue,s.d_.members,!0);for(const be of ee){const ge=Td(be.transform,be.invTransform,O,be.projection);fe.draw(f,M.TRIANGLES,mn.disabled,On.disabled,f.colorModeForRenderPass(),Mn.disabled,ge,c.id,Ae,Te,s.bg.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,O.zoom)}Ae.destroy(),Te.destroy()}const qr=s.bC();function yl(f){const n=f._camera.getWorldToCamera(f.worldSize,1),c=s.aB([],n,f.globeMatrix);s.bl(c,c);const p=[0,0,0],x=[0,1,0,0];return s.aC(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],s.aw(p,p),p}function Th({width:f,height:n,anchor:c,textOffset:p,textScale:x},b){const{horizontalAlign:E,verticalAlign:I}=s.c1(c),M=-(E-.5)*f,O=-(I-.5)*n,z=s.c2(c,p);return new s.P((M/x+z[0])*b,(O/x+z[1])*b)}function Mu(f,n,c,p,x,b,E,I,M,O){const z=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,G=f.icon.dynamicLayoutVertexArray,$={},J=f.getProjection(),K=ro(E,J,x),ee=x.elevation,re=J.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;H.clear();for(let pe=0;pe<z.length;pe++){const fe=z.get(pe),{tileAnchorX:ue,tileAnchorY:Ie,numGlyphs:Te}=fe,Ae=fe.hidden||!fe.crossTileID||f.allowVerticalPlacement&&!fe.placedOrientation?null:p[fe.crossTileID];if(Ae){let be=0,ge=0,ke=0;const ze=f.elevationType==="road";if(ee||ze){const rt=ze?f.getElevationFeatureForText(pe):null,yt=s.bV.getAtTileOffset(E,new s.P(ue,Ie),ee,rt),[kt,qt,zt]=J.upVector(E.canonical,ue,Ie);be=yt*kt*re,ge=yt*qt*re,ke=yt*zt*re}let[je,Xe,Ze,ut]=Ga(fe.projectedAnchorX+be,fe.projectedAnchorY+ge,fe.projectedAnchorZ+ke,c?K:b);const xt=sh(x.getCameraToCenterDistance(J),ut);let et=s.bM(f.textSizeData,M,fe)*xt/s.bY;c&&(et*=f.tilePixelRatio/I);const Le=Th(Ae,et);c?({x:je,y:Xe,z:Ze}=J.projectTilePoint(ue+Le.x,Ie+Le.y,E.canonical),[je,Xe,Ze]=Ga(je+be,Xe+ge,Ze+ke,b)):(n&&Le._rotate(-x.angle),je+=Le.x,Xe+=Le.y,Ze=0);const mt=f.allowVerticalPlacement&&fe.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let rt=0;rt<Te;rt++)s.bO(H,je,Xe,Ze,mt);O&&fe.associatedIconIndex>=0&&($[fe.associatedIconIndex]={x:je,y:Xe,z:Ze,angle:mt})}else Is(Te,H)}if(O){G.clear();const pe=f.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const ue=pe.get(fe),{numGlyphs:Ie}=ue,Te=$[fe];if(ue.hidden||!Te)Is(Ie,G);else{const{x:Ae,y:be,z:ge,angle:ke}=Te;for(let ze=0;ze<Ie;ze++)s.bO(G,Ae,be,ge,ke)}}f.icon.dynamicLayoutVertexBuffer.updateData(G)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function Eh(f,n,c,p,x,b,E={}){const I=c.paint.get("icon-translate"),M=c.paint.get("text-translate"),O=c.paint.get("icon-translate-anchor"),z=c.paint.get("text-translate-anchor"),H=c.layout.get("icon-rotation-alignment"),G=c.layout.get("text-rotation-alignment"),$=c.layout.get("icon-pitch-alignment"),J=c.layout.get("text-pitch-alignment"),K=c.layout.get("icon-keep-upright"),ee=c.layout.get("text-keep-upright"),re=c.paint.get("icon-color-saturation"),pe=c.paint.get("icon-color-contrast"),fe=c.paint.get("icon-color-brightness-min"),ue=c.paint.get("icon-color-brightness-max"),Ie=c.layout.get("symbol-elevation-reference")==="sea",Te=c.layout.get("icon-image-use-theme")==="none",Ae=f.context,be=Ae.gl,ge=f.transform,ke=H==="map",ze=G==="map",je=$==="map",Xe=J==="map",Ze=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ut=!1;const xt=f.depthModeForSublayer(0,mn.ReadOnly),et=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),Le=[s.aF(ge.center.lng),s.aJ(ge.center.lat)],mt=c.layout.get("text-variable-anchor"),rt=ge.projection.name==="globe",yt=[],kt=[0,-1,0];for(const qt of p){const zt=n.getTile(qt),Lt=zt.getBucket(c);if(!Lt||Lt.projection.name==="mercator"&&rt||Lt.fullyClipped)continue;const un=Lt.projection.name==="globe",an=un?s.aj(ge.zoom):0,Zt=ro(qt,Lt.getProjection(),ge),on=ge.calculatePixelsToTileUnitsMatrix(zt),xn=mt&&Lt.hasTextData(),Dn=Lt.hasIconTextFit()&&xn&&Lt.hasIconData(),jn=Lt.getProjection().createInversionMatrix(ge,qt.canonical),ni=(1<<zt.tileID.canonical.z)*s.al/f.transform.worldSize,Pn=Si=>{let Fn=[0,0,0];if(Si){const Hn=f.style.directionalLight,Ki=f.style.ambientLight;Hn&&Ki&&(Fn=qa(f.style,Hn,Ki))}return Fn},Un=Si=>{ge.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(Si.push("DEPTH_D24"),Si.push("DEPTH_OCCLUSION"))},Nn=Si=>{c.lut&&!Te&&(c.lut.texture||(c.lut.texture=new s.d$(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ae.gl.RGBA8)),Ae.activeTexture.set(Ae.gl.TEXTURE0+10),c.lut.texture&&c.lut.texture.bind(Ae.gl.LINEAR,Ae.gl.CLAMP_TO_EDGE),Si.push("APPLY_LUT_ON_GPU"))},bi=()=>{const Si=ke&&c.layout.get("symbol-placement")!=="point",Fn=[];Un(Fn),Nn(Fn);const Hn=Si||Dn,Ki=Lt.elevationType==="road",Lr=f.shadowRenderer,Bi=Ki&&je&&!!Lr&&Lr.enabled,Qi=Pn(Bi),wa=Ki&&je&&!f.terrain?et:xt,Qs=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&je&&Fn.push("PITCH_WITH_MAP_TERRAIN"),un&&(Fn.push("PROJECTION_GLOBE_VIEW"),Hn&&Fn.push("PROJECTED_POS_ON_VIEWPORT")),Qs>0&&Lt.hasAnySecondaryIcon&&Fn.push("ICON_TRANSITION"),!Lt.icon.zOffsetVertexBuffer||Ki&&f.terrain||Fn.push("Z_OFFSET"),re===0&&pe===0&&fe===0&&ue===1||Fn.push("COLOR_ADJUSTMENT"),Lt.sdfIcons&&Fn.push("RENDER_SDF"),Bi&&Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ki&&je&&!f.terrain&&Lt.icon.orientationVertexBuffer&&Fn.push("ELEVATED_ROADS");const ks=Lt.icon.programConfigurations.get(c.id),Ai=f.getOrCreateProgram("symbol",{config:ks,defines:Fn}),fo=zt.imageAtlasTexture?zt.imageAtlasTexture.size:[0,0],Js=Lt.iconSizeData,la=s.bK(Js,ge.zoom),jo=je||!ge.isOrthographic,Wa=ac(Zt,zt.tileID.canonical,je,ke,ge,Lt.getProjection(),on),wr=Vs(Zt,zt.tileID.canonical,je,ke,ge,Lt.getProjection(),on),Jr=f.translatePosMatrix(wr,zt,I,O,!0),rr=f.translatePosMatrix(Zt,zt,I,O),ss=Hn?qr:Wa,Rs=ke&&!je&&!Si;let Ar=kt;!rt&&!ge.mercatorFromTransition||ke||(Ar=yl(ge));const po=un?Ar:kt,Vd=c.getColorAdjustmentMatrix(re,pe,fe,ue),Yl=bh(Js.kind,la,Rs,je,f,rr,ss,Jr,Ie,!1,fo,[0,0],0,qt,an,Le,jn,po,Lt.getProjection(),Qi,ni,Vd,Qs,null),Nh=zt.imageAtlasTexture?zt.imageAtlasTexture:null,Bh=c.layout.get("icon-size").constantOr(0)!==1||Lt.iconsNeedLinear,mo=Lt.sdfIcons||f.options.rotating||f.options.zooming||Bh||jo?be.LINEAR:be.NEAREST,il=Lt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Kl=f.terrain&&je&&Si?s.bl(s.bC(),Wa):qr;if(Si&&Lt.icon){const Uo=s.bV.getAtTileOffsetFunc(qt,ge.center.lat,ge.worldSize,Lt.getProjection()),ar=pl(Zt,zt.tileID.canonical,je,ke,ge,Lt.getProjection(),on),ou=c.layout.get("icon-size-scale-range"),om=s.aA(f.scaleFactor,ou[0],ou[1]);Ei(Lt,Zt,f,!1,ar,wr,je,K,Uo,qt,om)}return{program:Ai,buffers:Lt.icon,uniformValues:Yl,atlasTexture:Nh,atlasTextureIcon:null,atlasInterpolation:mo,atlasInterpolationIcon:null,isSDF:Lt.sdfIcons,hasHalo:il,depthMode:wa,tile:zt,renderWithShadows:Bi,labelPlaneMatrixInv:Kl}},pi=()=>{const Si=ze&&c.layout.get("symbol-placement")!=="point",Fn=[],Hn=Si||mt||Dn,Ki=Lt.elevationType==="road",Lr=f.shadowRenderer,Bi=Ki&&Xe&&!!Lr&&Lr.enabled,Qi=Pn(Bi),wa=Ki&&Xe&&!f.terrain?et:xt;f.terrainRenderModeElevated()&&Xe&&Fn.push("PITCH_WITH_MAP_TERRAIN"),un&&(Fn.push("PROJECTION_GLOBE_VIEW"),Hn&&Fn.push("PROJECTED_POS_ON_VIEWPORT")),!Lt.text.zOffsetVertexBuffer||Ki&&f.terrain||Fn.push("Z_OFFSET"),Lt.iconsInText&&Fn.push("RENDER_TEXT_AND_SYMBOL"),Fn.push("RENDER_SDF"),Bi&&Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ki&&Xe&&!f.terrain&&Lt.text.orientationVertexBuffer&&Fn.push("ELEVATED_ROADS"),Un(Fn);const Qs=Lt.text.programConfigurations.get(c.id),ks=f.getOrCreateProgram("symbol",{config:Qs,defines:Fn});let Ai,fo=[0,0],Js=null;const la=Lt.textSizeData;Lt.iconsInText&&(fo=zt.imageAtlasTexture?zt.imageAtlasTexture.size:[0,0],Js=zt.imageAtlasTexture?zt.imageAtlasTexture:null,Ai=Xe||!ge.isOrthographic||f.options.rotating||f.options.zooming||la.kind==="composite"||la.kind==="camera"?be.LINEAR:be.NEAREST);const jo=zt.glyphAtlasTexture?zt.glyphAtlasTexture.size:[0,0],Wa=c.layout.get("text-size-scale-range"),wr=s.aA(f.scaleFactor,Wa[0],Wa[1]),Jr=s.bK(la,ge.zoom,wr),rr=ac(Zt,zt.tileID.canonical,Xe,ze,ge,Lt.getProjection(),on),ss=Vs(Zt,zt.tileID.canonical,Xe,ze,ge,Lt.getProjection(),on),Rs=f.translatePosMatrix(ss,zt,M,z,!0),Ar=f.translatePosMatrix(Zt,zt,M,z),po=Hn?qr:rr,Vd=ze&&!Xe&&!Si;let Yl=kt;!rt&&!ge.mercatorFromTransition||ze||(Yl=yl(ge));const Nh=bh(la.kind,Jr,Vd,Xe,f,Ar,po,Rs,Ie,!0,jo,fo,0,qt,an,Le,jn,un?Yl:kt,Lt.getProjection(),Qi,ni,null,null,wr),Bh=zt.glyphAtlasTexture?zt.glyphAtlasTexture:null,mo=be.LINEAR,il=c.paint.get("text-halo-width").constantOr(1)!==0,Kl=f.terrain&&Xe&&Si?s.bl(s.bC(),rr):qr;if(Si&&Lt.text){const Uo=s.bV.getAtTileOffsetFunc(qt,ge.center.lat,ge.worldSize,Lt.getProjection()),ar=pl(Zt,zt.tileID.canonical,Xe,ze,ge,Lt.getProjection(),on);Ei(Lt,Zt,f,!0,ar,ss,Xe,ee,Uo,qt,wr)}return{program:ks,buffers:Lt.text,uniformValues:Nh,atlasTexture:Bh,atlasTextureIcon:Js,atlasInterpolation:mo,atlasInterpolationIcon:Ai,isSDF:!0,hasHalo:il,depthMode:wa,tile:zt,renderWithShadows:Bi,labelPlaneMatrixInv:Kl}},Di=Lt.icon.segments.get().length,ci=Lt.text.segments.get().length,Gn=Di&&!E.onlyText?bi():null,_i=ci&&!E.onlyIcons?pi():null,pr=c.paint.get("icon-opacity").constantOr(1),Pi=c.paint.get("text-opacity").constantOr(1);if(Ze&&Lt.canOverlap){ut=!0;const Si=pr&&!E.onlyText?Lt.icon.segments.get():[],Fn=Pi&&!E.onlyIcons?Lt.text.segments.get():[];for(const Hn of Si)yt.push({segments:new s.bg([Hn]),sortKey:Hn.sortKey,state:Gn});for(const Hn of Fn)yt.push({segments:new s.bg([Hn]),sortKey:Hn.sortKey,state:_i})}else E.onlyText||yt.push({segments:pr?Lt.icon.segments:new s.bg([]),sortKey:0,state:Gn}),E.onlyIcons||yt.push({segments:Pi?Lt.text.segments:new s.bg([]),sortKey:0,state:_i})}ut&&yt.sort((qt,zt)=>qt.sortKey-zt.sortKey);for(const qt of yt){const zt=qt.state;if(zt)if(f.terrain?f.terrain.setupElevationDraw(zt.tile,zt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:zt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,zt.program),Ae.activeTexture.set(be.TEXTURE0),zt.atlasTexture&&zt.atlasTexture.bind(zt.atlasInterpolation,be.CLAMP_TO_EDGE,!0),zt.atlasTextureIcon&&(Ae.activeTexture.set(be.TEXTURE1),zt.atlasTextureIcon&&zt.atlasTextureIcon.bind(zt.atlasInterpolationIcon,be.CLAMP_TO_EDGE,!0)),zt.renderWithShadows&&f.shadowRenderer.setupShadows(zt.tile.tileID.toUnwrapped(),zt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,zt.program),zt.hasHalo){const Lt=zt.uniformValues;Lt.u_is_halo=1,Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,Lt,2),Lt.u_is_halo=0}else{if(zt.isSDF){const Lt=zt.uniformValues;zt.hasHalo&&(Lt.u_is_halo=1,Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,Lt,1)),Lt.u_is_halo=0}Du(zt.buffers,qt.segments,c,f,zt.program,zt.depthMode,x,b,zt.uniformValues,1)}}}function Du(f,n,c,p,x,b,E,I,M,O){const z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,b,E,I,Mn.disabled,M,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),z,O)}function Pu(f,n){const c=1<<f.canonical.z,p=(n.x*c-f.canonical.x-f.wrap*c)*s.al,x=(n.y*c-f.canonical.y)*s.al,b=s.e8(n.z,n.y);return s.d5(p,x,b)}function ng(f,n,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,E=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),I=new mn(f.context.gl.GREATER,mn.ReadWrite,f.depthRangeFor3D),M=(function($){let J=.01;return $.isOrthographic&&(J=s.ak(1e-4,J,s.d0($.pitch>=Lo?1:$.pitch/Lo))),2*J})(f.transform),O=f.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",H=f.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),G=f.getOrCreateProgram(z);for(const $ of p){const J=n.getTile($),K=J.getBucket(c);if(!K)continue;const ee=K.elevatedStructures;if(!ee)continue;const re=K.elevationBufferData.heightRange,pe=Pu($.toUnwrapped(),O),fe=f.translatePosMatrix($.projMatrix,J,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ue,Ie,Te,Ae;if(x==="initialize"){if(!re||re.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,M,1,0),Ie=E,Te=ee.depthSegments,Ae=H}else if(x==="reset"){if(!re||re.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,0,0,1),Ie=I,Te=ee.maskSegments,Ae=H}else if(x==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;ue=Ru(fe,pe,M,1,0),Ie=E,Te=ee.depthSegments,Ae=G}Ae.draw(f,b.TRIANGLES,Ie,On.disabled,zn.disabled,Mn.disabled,ue,c.id,ee.vertexBuffer,ee.indexBuffer,Te,c.paint,f.transform.zoom)}}function is(f,n,c,p){const{painter:x,sourceCache:b,layer:E,coords:I,colorMode:M,elevationType:O,terrainEnabled:z,pass:H}=f,G=x.context.gl,$=E.paint.get("fill-pattern"),J=E.paint.get("fill-pattern-cross-fade"),K=$.constantOr(null);let ee=O;O!=="road"||n&&!z||(ee="none");const re=ee==="road",pe=f.painter.shadowRenderer,fe=re&&!!pe&&pe.enabled,ue=new mn(x.context.gl.LEQUAL,mn.ReadOnly,x.depthRangeFor3D);let Ie=[0,0,0];if(fe){const ge=x.style.directionalLight,ke=x.style.ambientLight;ge&&ke&&(Ie=qa(x.style,ge,ke))}const Te=$&&$.constantOr(1),Ae=x.terrain&&x.terrain.renderingToTexture,be=(ge,ke)=>{let ze,je,Xe,Ze,ut;ke?(ze=Te&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Xe=G.LINES):(ze=Te?"fillPattern":"fill",Xe=G.TRIANGLES);for(const xt of I){const et=b.getTile(xt);if(Te&&!et.patternsLoaded())continue;const Le=et.getBucket(E);if(!Le)continue;const mt=n?Le.elevationBufferData:Le.bufferData;if(mt.isEmpty())continue;x.prepareDrawTile();const rt=mt.programConfigurations.get(E.id),yt=x.isTileAffectedByFog(xt),kt=[],qt=[];re&&(kt.push("ELEVATED_ROADS"),qt.push(mt.elevatedLayoutVertexBuffer)),fe&&kt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ae&&c&&kt.push("USE_MRT1"),Te&&(x.context.activeTexture.set(G.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),rt.updatePaintBuffers());let zt=!1;if(K&&et.imageAtlas){const on=et.imageAtlas,xn=s.e3.from(K),Dn=xn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),jn=xn.getSecondary(),ni=on.patternPositions.get(Dn),Pn=jn?on.patternPositions.get(jn.scaleSelf(s.o.devicePixelRatio).toString()):null;zt=!!ni&&!!Pn,ni&&rt.setConstantPatternPositions(ni,Pn)}J>0&&(zt||rt.getPatternTransitionVertexBuffer("fill-pattern"))&&kt.push("FILL_PATTERN_TRANSITION");const Lt=x.getOrCreateProgram(ze,{config:rt,overrideFog:yt,defines:kt}),un=x.translatePosMatrix(xt.projMatrix,et,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));fe&&pe.setupShadows(et.tileID.toUnwrapped(),Lt,"vector-tile");const an=E.paint.get("fill-emissive-strength");if(ke){Ze=mt.lineIndexBuffer,ut=mt.lineSegments;const on=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];je=ze==="fillOutlinePattern"&&Te?kf(un,an,x,et,on,Ie,J):wd(un,an,on,Ie)}else Ze=mt.indexBuffer,ut=mt.triangleSegments,je=Te?Cu(un,an,x,et,Ie,J):Iu(un,an,Ie);x.uploadCommonUniforms(x.context,Lt,xt.toUnwrapped());let Zt=ge;(O==="road"&&!z||O==="offset")&&(Zt=ue),Lt.draw(x,Xe,Zt,p||x.stencilModeForClipping(xt),M,Mn.disabled,je,E.id,mt.layoutVertexBuffer,Ze,ut,E.paint,x.transform.zoom,rt,qt)}};x.renderPass===H&&be(x.depthModeForSublayer(1,x.renderPass==="opaque"?mn.ReadWrite:mn.ReadOnly),!1),ee==="none"&&x.renderPass==="translucent"&&E.paint.get("fill-antialias")&&be(x.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,mn.ReadOnly),!0)}function ku(f,n,c,p,x,b,E,I){c.resetLayerRenderingStats(f);const M=f.context,O=M.gl,z=f.transform,H=c.paint.get("fill-extrusion-pattern"),G=c.paint.get("fill-extrusion-pattern-cross-fade"),$=H.constantOr(null),J=H.constantOr(1),K=c.paint.get("fill-extrusion-opacity"),ee=f.style.enable3dLights(),re=c.paint.get(ee&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),re],fe=c.layout.get("fill-extrusion-edge-radius"),ue=fe>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ie=ue?0:fe,Te=z.projection.name==="globe"?s.eb():0,Ae=z.projection.name==="globe",be=Ae?s.aj(z.zoom):0,ge=[s.aF(z.center.lng),s.aJ(z.center.lat)],ke=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ze=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ke?null:c.lut).toArray01().slice(0,3),je=c.paint.get("fill-extrusion-flood-light-intensity"),Xe=c.paint.get("fill-extrusion-vertical-scale"),Ze=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ut=c.paint.get("fill-extrusion-height-alignment"),xt=c.paint.get("fill-extrusion-base-alignment"),et=Yo(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let mt;Ae&&Le.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&Le.push("FAUX_AO"),ue&&Le.push("ZERO_ROOF_RADIUS"),I&&Le.push("HAS_CENTROID"),je>0&&Le.push("FLOOD_LIGHT"),et.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),Ze&&Le.push("RENDER_WALL_MODE");const rt=f.renderPass==="shadow",yt=f.shadowRenderer,kt=rt&&!!yt,qt=rt?Mn.disabled:Mn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let zt=[0,0,0];if(yt){const an=f.style.directionalLight,Zt=f.style.ambientLight;an&&Zt&&(zt=qa(f.style,an,Zt)),rt||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&Le.push("NORMAL_OFFSET")),mt=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Lt=kt?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",un=c.getLayerRenderingStats();for(const an of p){const Zt=n.getTile(an),on=Zt.getBucket(c);if(!on||on.projection.name!==z.projection.name)continue;let xn=!1;yt&&(xn=yt.getMaxCascadeForTile(an.toUnwrapped())===0);const Dn=f.isTileAffectedByFog(an),jn=on.programConfigurations.get(c.id);let ni=!1;if($&&Zt.imageAtlas){const ci=Zt.imageAtlas,Gn=s.e3.from($),_i=Gn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),pr=Gn.getSecondary(),Pi=ci.patternPositions.get(_i),Si=pr?ci.patternPositions.get(pr.scaleSelf(s.o.devicePixelRatio).toString()):null;ni=!!Pi&&!!Si,Pi&&jn.setConstantPatternPositions(Pi,Si)}G>0&&(ni||jn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Le.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Pn=f.getOrCreateProgram(Lt,{config:jn,defines:xn?mt:Le,overrideFog:Dn});if(f.terrain&&f.terrain.setupElevationDraw(Zt,Pn,{useMeterToDem:!0}),!on.centroidVertexBuffer){const ci=Pn.getAttributeLocation(O,"a_centroid_pos");ci!==-1&&O.vertexAttrib2f(ci,0,0)}!rt&&yt&&yt.setupShadows(Zt.tileID.toUnwrapped(),Pn,"vector-tile"),J&&(f.context.activeTexture.set(O.TEXTURE0),Zt.imageAtlasTexture&&Zt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),jn.updatePaintBuffers());const Un=c.paint.get("fill-extrusion-vertical-gradient"),Nn=1/on.tileToMeter;let bi;if(rt&&yt){if(Nf(Zt.tileID,on.maxHeight,f))continue;const ci=yt.calculateShadowPassMatrixFromTile(Zt.tileID.toUnwrapped());bi=Qc(ci,Ie,Nn,Xe,ut,xt)}else{const ci=f.translatePosMatrix(an.expandedProjMatrix,Zt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Gn=z.projection.createInversionMatrix(z,an.canonical);bi=J?eg(ci,f,Un,K,pe,Ie,Nn,an,Zt,Te,ut,xt,be,ge,Gn,ze,Xe,G):gc(ci,f,Un,K,pe,Ie,Nn,an,Te,ut,xt,be,ge,Gn,ze,Xe,je,zt)}f.uploadCommonUniforms(M,Pn,an.toUnwrapped(),null,et);let pi=on.segments;if(z.projection.name==="mercator"&&!rt&&(pi=on.getVisibleSegments(Zt.tileID,f.terrain,f.transform.getFrustum(0)),!pi.get().length))continue;if(un)if(rt)for(const ci of pi.get())un.numRenderedVerticesInShadowPass+=ci.primitiveLength;else for(const ci of pi.get())un.numRenderedVerticesInTransparentPass+=ci.primitiveLength;const Di=[];(f.terrain||I)&&Di.push(on.centroidVertexBuffer),Ae&&Di.push(on.layoutVertexExtBuffer),Ze&&Di.push(on.wallVertexBuffer),Pn.draw(f,M.gl.TRIANGLES,x,b,E,qt,bi,c.id,on.layoutVertexBuffer,on.indexBuffer,pi,c.paint,f.transform.zoom,jn,Di)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Sh{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ul(f,n,c,p,x,b,E,I,M,O,z,H,G,$,J,K,ee,re,pe,fe){const ue=n.context,Ie=ue.gl,Te=n.transform,Ae=n.transform.zoom,be=[],ge=f.translate,ke=f.translateAnchor,ze=f.edgeRadius,je=Yo(n,f.cutoffFadeRange);z==="clear"?(be.push("CLEAR_SUBPASS"),fe&&(be.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(Ie.TEXTURE0),fe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):z==="sdf"?be.push("SDF_SUBPASS"):z==="emissive"&&(be.push("USE_MRT1"),ue.activeTexture.set(Ie.TEXTURE0),fe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)),re&&be.push("HAS_CENTROID"),je.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const Xe=(Ze,ut,xt,et,Le)=>{let mt=be;ut.groundRadiusBuffer!=null&&(mt=be.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const rt=ut.programConfigurations.get(p.id),yt=n.isTileAffectedByFog(Ze),kt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:rt,defines:mt,overrideFog:yt}),qt=((Lt,un,an,Zt,on,xn,Dn,jn,ni,Pn,Un)=>({u_matrix:un,u_opacity:an,u_ao_pass:Zt?1:0,u_meter_to_tile:on,u_ao:xn,u_flood_light_intensity:Dn,u_flood_light_color:jn,u_attenuation:ni,u_edge_radius:Pn,u_fb:0,u_fb_size:Un,u_dynamic_offset:1}))(0,et,H,O,Le,[G,$*Le],J,K,ee,Ae>=17?0:ze*Le,fe?fe.size[0]:0),zt=[];re&&zt.push(ut.hiddenByLandmarkVertexBuffer),ut.groundRadiusBuffer!=null&&zt.push(ut.groundRadiusBuffer),n.uploadCommonUniforms(ue,kt,Ze.toUnwrapped(),null,je),kt.draw(n,ue.gl.TRIANGLES,b,E,I,M,qt,p.id,ut.vertexBuffer,ut.indexBuffer,xt,p.paint,Ae,rt,zt)};for(const Ze of x){const ut=c.getTile(Ze),xt=ut.getBucket(p);if(!xt||xt.projection.name!==Te.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const et=xt.groundEffect,Le=1/xt.tileToMeter;{const mt=n.translatePosMatrix(Ze.projMatrix,ut,ge,ke),rt=et.getDefaultSegment();Xe(Ze,et,rt,mt,Le)}if(pe)for(let mt=0;mt<4;mt++){const rt=s.e9[mt](Ze),yt=c.getTile(rt);if(!yt)continue;const kt=yt.getBucket(p);if(!kt||kt.projection.name!==Te.projection.name||!kt.groundEffect||kt.groundEffect&&!kt.groundEffect.hasData())continue;const qt=kt.groundEffect;let zt,Lt;mt===0?(zt=[-s.al,0,0],Lt=1):mt===1?(zt=[s.al,0,0],Lt=0):mt===2?(zt=[0,-s.al,0],Lt=3):(zt=[0,s.al,0],Lt=2);const un=qt.regionSegments[Lt];if(!un)continue;const an=new Float32Array(16);s.br(an,Ze.projMatrix,zt),Xe(Ze,qt,un,n.translatePosMatrix(an,ut,ge,ke),Le)}}}function ig(f,n,c,p,x,b,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=b?b.findDEMTileFor(c):null;if(!(I&&I.dem||E))return;b&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const M=(ee,re)=>{(ee.flags|re.flags)&s.ec?(ee.flags|=s.ec,re.flags|=s.ec):(ee.flags&=~s.ec,re.flags&=~s.ec)},O=ee=>new s.P(Math.ceil((ee+s.ed)*s.ee),0),z=ee=>{const re=n.getSource().minzoom,pe=ue=>{const Ie=n.getTileByID(ue);if(Ie&&Ie.hasData())return Ie.getBucket(x)},fe=[0,-1,1];for(const ue of fe){if(ee.overscaledZ+ue<re)continue;const Ie=pe(ee.calculateScaledKey(ee.overscaledZ+ue));if(Ie)return Ie}},H=[0,0,0],G=(ee,re)=>(H[0]=Math.min(ee.min.y,re.min.y),H[1]=Math.max(ee.max.y,re.max.y),H[2]=s.al-re.min.x>ee.max.x?re.min.x-s.al:ee.max.x,H),$=(ee,re)=>(H[0]=Math.min(ee.min.x,re.min.x),H[1]=Math.max(ee.max.x,re.max.x),H[2]=s.al-re.min.y>ee.max.y?re.min.y-s.al:ee.max.y,H),J=[(ee,re)=>G(ee,re),(ee,re)=>G(re,ee),(ee,re)=>$(ee,re),(ee,re)=>$(re,ee)],K=(ee,re,pe,fe,ue,Ie,Te)=>{if(!b)return 0;const Ae=[[Ie?pe:ee,Ie?ee:pe,0],[Ie?pe:re,Ie?re:pe,0]],be=Te<0?s.al+Te:Te,ge=[Ie?be:(ee+re)/2,Ie?(ee+re)/2:be,0];return pe===0&&Te<0||pe!==0&&Te>0?b.getForTilePoints(ue,[ge],!0,fe):Ae.push(ge),b.getForTilePoints(c,Ae,!0,I),Math.max(Ae[0][2],Ae[1][2],ge[2])/b.exaggeration()};for(let ee=0;ee<4;ee++){const re=p.borderFeatureIndices[ee];if(re.length===0)continue;const pe=s.e9[ee](c),fe=z(pe);if(!(fe&&fe instanceof s.ea))continue;const ue=b?b.findDEMTileFor(pe):null;if(!(ue&&ue.dem||E)||(b&&ue&&ue.dem&&p.borderDEMTileTimestamp[ee]!==ue.dem._timestamp&&(p.borderDoneWithNeighborZ[ee]=-1,p.borderDEMTileTimestamp[ee]=ue.dem._timestamp),p.borderDoneWithNeighborZ[ee]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const Ie=(ee<2?1:5)-ee,Te=fe.borderDoneWithNeighborZ[Ie]!==p.canonical.z,Ae=fe.borderFeatureIndices[Ie];let be=0;if(p.canonical.z!==fe.canonical.z){for(const ge of re)p.showCentroid(p.featuresOnBorder[ge]);if(Te)for(const ge of Ae)fe.showCentroid(fe.featuresOnBorder[ge]);p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ie]=p.canonical.z}for(const ge of re){const ke=p.featuresOnBorder[ge],ze=p.centroidData[ke.centroidDataIndex],je=ke.borders[ee];let Xe;for(;be<Ae.length;){Xe=fe.featuresOnBorder[Ae[be]];const Ze=Xe.borders[Ie];if(Ze[1]>je[0]+3||Ze[0]>je[0]-3)break;fe.showCentroid(Xe),be++}if(Xe&&be<Ae.length){const Ze=be;let ut=0;for(;!(Xe.borders[Ie][0]>je[1]-3)&&(ut++,++be!==Ae.length);)Xe=fe.featuresOnBorder[Ae[be]];Xe=fe.featuresOnBorder[Ae[Ze]];let xt=!1;if(ut>=1){const mt=Xe.borders[Ie];Math.abs(je[0]-mt[0])<3&&Math.abs(je[1]-mt[1])<3&&(ut=1,xt=!0,be=Ze+1)}else if(ut===0){p.showCentroid(ke);continue}const et=fe.centroidData[Xe.centroidDataIndex];E&&xt&&M(ze,et);const Le=ke.intersectsCount()>1||Xe.intersectsCount()>1;if(ut>1)be=Ze,ze.centroidXY=et.centroidXY=new s.P(0,0);else if(ue&&ue.dem&&!Le){const mt=J[ee](ze,et),rt=ee%2?s.al-1:0,yt=K(mt[0],Math.min(s.al-1,mt[1]),rt,ue,pe,ee<2,mt[2]);ze.centroidXY=et.centroidXY=O(yt)}else Le?ze.centroidXY=et.centroidXY=new s.P(0,0):(ze.centroidXY=p.encodeBorderCentroid(ke),et.centroidXY=fe.encodeBorderCentroid(Xe));p.writeCentroidToBuffer(ze),fe.writeCentroidToBuffer(et)}else p.showCentroid(ke)}p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ie]=p.canonical.z}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const C_=[1,0,0],Vp=[0,1,0],jp=[0,0,1];function Nf(f,n,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const b=f.toUnwrapped(),E=p.tileSize*x._cascades[c.currentShadowCascade].scale;let I=n;if(p.elevation){const K=p.elevation.getMinMaxForTile(f);K&&(I+=K.max)}const M=[...x.shadowDirection];M[2]=-M[2];const O=x.computeSimplifiedTileShadowVolume(b,I,E,M);if(!O)return!1;const z=[C_,Vp,jp,M,[M[0],0,M[2]],[0,M[1],M[2]]],H=p.projection.name==="globe",G=p.scaleZoom(E),$=s.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,G,!H),J=x.getCurrentCascadeFrustum();return $.intersectsPrecise(O.vertices,O.planes,z)===0||J.intersectsPrecise(O.vertices,O.planes,z)===0}function Ks(f){const{painter:n,source:c,layer:p,coords:x}=f;let b=f.defines;const E=n.context,I=n.renderPass==="shadow",M=n.renderPass==="light-beam",O=n.shadowRenderer,z=s.ef(n.transform.center.lat,n.transform.zoom),H=Yo(n,p.paint.get("building-cutoff-fade-range"));H.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const G of x){const $=c.getTile(G),J=$.getBucket(p);if(!J)continue;O&&O.getMaxCascadeForTile(G.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const K=J.programConfigurations.get(p.id);let ee,re,pe,fe=n.translatePosMatrix(G.expandedProjMatrix,$,[0,0],"map");if(fe=s.cS(s.bC(),fe,[1,1,f.verticalScale]),I&&O){if(Nf($.tileID,J.maxHeight*z,n))continue;let Ie=O.calculateShadowPassMatrixFromTile($.tileID.toUnwrapped());Ie=s.cS(s.bC(),Ie,[1,1,f.verticalScale]),pe=uo(Ie),ee=re=n.getOrCreateProgram("buildingDepth",{config:K,defines:b,overrideFog:!1})}else if(M)ee=re=n.getOrCreateProgram("buildingBloom",{config:K,defines:b,overrideFog:!1}),pe=tg(fe);else{const Ie=n.transform.calculatePosMatrix(G.toUnwrapped(),n.transform.worldSize);s.cS(Ie,Ie,[1,1,f.verticalScale]);const Te=s.bC();s.cS(Te,Ie,[1,-1,1/z]),s.bl(Te,Te),s.eg(Te,Te);const Ae=n.transform.getFreeCameraOptions().position,be=1<<G.canonical.z;if(pe=_c(fe,Te,f.opacity,f.facadeAOIntensity,[((Ae.x-G.wrap)*be-G.canonical.x)*s.al,(Ae.y*be-G.canonical.y)*s.al,Ae.z*be*s.al],J.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),re=n.getOrCreateProgram("building",{config:K,defines:b,overrideFog:!1}),f.depthOnly===!0)ee=re;else{const ge=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ee=n.getOrCreateProgram("building",{config:K,defines:ge,overrideFog:!1})}O&&(O.setupShadowsFromMatrix(Ie,re,!0),ee!==re&&O.setupShadowsFromMatrix(Ie,ee,!0))}const ue=(Ie,Te)=>{if(M){const Ae=Ie.entranceBloom;Te.draw(n,E.gl.TRIANGLES,f.depthMode,On.disabled,f.blendMode,Mn.disabled,pe,p.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segmentsBucket,p.paint,n.transform.zoom,K,[Ae.layoutAttenuationBuffer,Ae.layoutColorBuffer])}else{const Ae=Ie.segmentsBucket;let be=[Ie.layoutNormalBuffer,Ie.layoutCentroidBuffer,Ie.layoutColorBuffer,Ie.layoutFloodLightDataBuffer];Ie.layoutFacadePaintBuffer&&(be=be.concat([Ie.layoutFacadeDataBuffer,Ie.layoutFacadeVerticalRangeBuffer,Ie.layoutFacadePaintBuffer])),Te.draw(n,E.gl.TRIANGLES,f.depthMode,On.disabled,f.blendMode,I?Mn.disabled:Mn.backCW,pe,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ae,p.paint,n.transform.zoom,K,be)}};n.uploadCommonUniforms(E,re,G.toUnwrapped(),null,H),J.buildingWithoutFacade&&ue(J.buildingWithoutFacade,re),J.buildingWithFacade&&(ee!==re&&n.uploadCommonUniforms(E,ee,G.toUnwrapped(),null,H),ue(J.buildingWithFacade,ee))}}function xs(f,n,c,p,x,b,E,I,M,O,z,H,G){const $=f.context.gl,J=f.depthModeForSublayer(1,mn.ReadOnly,$.LEQUAL,!0),K=.1*(1-(ee=z))+3*ee;var ee;const re=f._showOverdrawInspector,pe=H,fe=new Sh;re||Ul(fe,f,n,c,p,J,new On({func:$.ALWAYS,mask:255},255,255,$.KEEP,$.KEEP,$.REPLACE),new zn([$.ONE,$.ONE,$.ONE,$.ONE],s.ao.transparent,[!1,!1,!1,!0],$.MIN),Mn.disabled,x,"sdf",b,E,I,M,O,K,pe,!1);{const ue=re?On.disabled:new On({func:$.EQUAL,mask:255},255,255,$.KEEP,$.DECR,$.DECR),Ie=re?f.colorModeForRenderPass():new zn([$.ONE_MINUS_DST_ALPHA,$.DST_ALPHA,$.ONE,$.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ul(fe,f,n,c,p,J,ue,Ie,Mn.disabled,x,"color",b,E,I,M,O,K,pe,!1)}}function Sd(f){return[f[0]*s.eh,f[1]*s.eh,f[2]*s.eh,0]}function Lu(f,n,c,p,x,b,E,I,M){const O=p.getSource(),z=c.globeSharedBuffers;if(!z)return;let H,G,$;if(n&&(H=p.getTile(n)),O instanceof s.aU?(G=O.texture,$=s.dK(0,0,c.transform)):H&&n&&(G=H.texture,$=s.dK(n.canonical.z,n.canonical.x,c.transform)),!G||!$)return;f||($=s.cS(s.bC(),$,[1,-1,1]));const J=c.context,K=J.gl,ee=x.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,re=c.colorModeForDrapableLayerRenderPass(b),pe=E.defines;pe.push("GLOBE_POLES");const fe=new mn(K.LEQUAL,mn.ReadWrite,c.depthRangeFor3D),ue=Float32Array.from(c.transform.expandedFarZProjMatrix),Ie=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),J.activeTexture.set(K.TEXTURE0),G.bind(ee,K.CLAMP_TO_EDGE),J.activeTexture.set(K.TEXTURE1),G.bind(ee,K.CLAMP_TO_EDGE),"useMipmap"in G&&J.extTextureFilterAnisotropic&&c.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Te,Ae,be,ge]=n?z.getPoleBuffers(n.canonical.z,!1):z.getPoleBuffers(0,!0),ke=x.paint.get("raster-elevation");let ze;f?(ze=Te,c.renderDefaultNorthPole=ke!==0):(ze=Ae,c.renderDefaultSouthPole=ke!==0);const je=Sd(E.mix),Xe=((ut,xt,et,Le,mt,rt,yt,kt,qt,zt,Lt,un,an)=>yh(ut,xt,et,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],kt,2,zt,Lt,un,1,0,an))(ue,Ie,$,s.aj(c.transform.zoom),0,x,0,ke,0,je,E.offset,E.range,b),Ze=c.getOrCreateProgram("raster",{defines:pe});c.uploadCommonUniforms(J,Ze,null),Ze.draw(c,K.TRIANGLES,fe,M,re,I,Xe,x.id,ze,be,ge)}function Bf(f){if(f.isOrthographic)return[0,0,0,0];const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,b=n+x;return[n,c,(b-x-n)/p,(b-n)/p]}function Up(f,n,c,p){if(f)return n instanceof sa&&f instanceof Oc?n.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:Sd(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Gl=s.ei([{name:"a_index",type:"Int16",components:1}]);class Ff{constructor(n,c,p,x){const b={width:p[0],height:p[1],data:null},E=n.gl;this.targetColorTexture=new s.T(n,b,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,E.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(n,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ej;b.reserve(x);for(let E=0;E<x;E++)b.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(b,Gl.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Vf(f,n,c){if(!f)return null;const p=n.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:x,mix:b,offset:E,tileSize:I,buffer:M,format:O}=p;if(!x||!O)return null;let z=!1;return O==="uint32"&&(z=!0,b[3]=0,b=Ed(s.ek,b,[0,c.paint.get("raster-particle-max-speed")]),E=Bp(s.ek,E,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:z,scale:b,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Gp(f){const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,b=n+x;return[n,c,(b-x-n)/p,(b-n)/p]}const qp=new s.ao(1,0,0,1),Hp=new s.ao(0,1,0,1),$p=new s.ao(0,0,1,1),R_=new s.ao(1,0,1,1),M_=new s.ao(0,1,1,1);function rg(f,n,c,p,x,b){for(let E=0;E<c.length;E++)if(x){const O=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);bc(f,n,c[E],p,-1,-1,b),bc(f,n,c[E],p,-1,1,b),bc(f,n,c[E],p,1,1,b),bc(f,n,c[E],p,1,-1,b),bc(f,n,c[E],O,0,0,b)}else bc(f,n,c[E],p,0,0,b)}function bc(f,n,c,p,x,b,E){const I=f.context,M=f.transform,O=I.gl,z=M.projection.name==="globe",H=z?["PROJECTION_GLOBE_VIEW"]:[];let G=s.bz(c.projMatrix);if(z&&s.aj(M.zoom)>0){const je=s.bj(c.canonical,M),Xe=s.el(je);G=s.aB(new Float32Array(16),M.globeMatrix,Xe),s.aB(G,M.projMatrix,G)}const $=s.bC();$[12]+=2*x/(s.o.devicePixelRatio*M.width),$[13]+=2*b/(s.o.devicePixelRatio*M.height),s.aB(G,$,G);const J=f.getOrCreateProgram("debug",{defines:H}),K=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(K,J);const ee=mn.disabled,re=On.disabled,pe=f.colorModeForRenderPass(),fe="$debug";I.activeTexture.set(O.TEXTURE0),f.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),z?K._makeGlobeTileDebugBuffers(f.context,M):K._makeDebugTileBoundsBuffers(f.context,M.projection);const ue=K._tileDebugBuffer||f.debugBuffer,Ie=K._tileDebugIndexBuffer||f.debugIndexBuffer,Te=K._tileDebugSegments||f.debugSegments;if(J.draw(f,O.LINE_STRIP,ee,re,pe,Mn.disabled,yc(G,p.toPremultipliedRenderColor(null)),fe,ue,Ie,Te,null,null,null,[K._globeTileDebugBorderBuffer]),E){const je=K.latestRawTileData,Xe=Math.floor((je&&je.byteLength||0)/1024);let Ze=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ze+=` => ${c.overscaledZ}`),Ze+=` ${K.state}`,Ze+=` ${Xe}kb`,(function(ut,xt){ut.initDebugOverlayCanvas();const et=ut.debugOverlayCanvas,Le=ut.context.gl,mt=ut.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,et.width,et.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(xt,5,5),mt.strokeText(xt,5,5),ut.debugOverlayTexture.update(et),ut.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)})(f,Ze)}const Ae=n.getTile(c).tileSize,be=512/Math.min(Ae,512)*(c.overscaledZ/M.zoom)*.5,ge=K._tileDebugTextBuffer||f.debugBuffer,ke=K._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ze=K._tileDebugTextSegments||f.debugSegments;J.draw(f,O.TRIANGLES,ee,re,zn.alphaBlended,Mn.disabled,yc(G,s.ao.transparent.toPremultipliedRenderColor(null),be),fe,ge,ke,ze,null,null,null,[K._globeTileDebugTextBuffer])}function sg(f,n,c,p){jf(f,0,n+c/2,f.transform.width,c,p)}function ag(f,n,c,p){jf(f,n-c/2,0,c,f.transform.height,p)}function jf(f,n,c,p,x,b){const E=f.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*s.o.devicePixelRatio,c*s.o.devicePixelRatio,p*s.o.devicePixelRatio,x*s.o.devicePixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}const og=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:D_}=og;function wc(f,n,c,p){f.emplaceBack(n,c,p)}class Za{constructor(n){this.vertexArray=new s.em,this.indices=new s.b0,wc(this.vertexArray,-1,-1,1),wc(this.vertexArray,1,-1,1),wc(this.vertexArray,-1,1,1),wc(this.vertexArray,1,1,1),wc(this.vertexArray,-1,-1,-1),wc(this.vertexArray,1,-1,-1),wc(this.vertexArray,-1,1,-1),wc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,D_),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function tu(f,n,c,p,x,b){const E=f.context.gl,I=n.paint.get("sky-atmosphere-color"),M=n.paint.get("sky-atmosphere-halo-color"),O=n.paint.get("sky-atmosphere-sun-intensity"),z=((H,G,$,J,K)=>({u_matrix_3f:H,u_sun_direction:G,u_sun_intensity:$,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(s.eo(s.dO(),p),x,O,I.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),c.draw(f,E.TRIANGLES,mn.disabled,On.disabled,zn.unblended,Mn.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Pa=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nu{constructor(n){const c=new s.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new s.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,Pa.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const lg=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class cg{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zp{constructor(n){this.colorModeAlphaBlendedWriteRGB=new zn([1,bu,1,bu],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new zn([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new cg,this.updateNeeded=!0}update(n){const c=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new nu(c);const p=this.params.sizeRange,x=this.params.intensityRange,b=(function(z){const H=s.eq(30),G=[];for(let $=0;$<z;++$){const J=2*Math.PI*H(),K=Math.acos(1-2*H())-.5*Math.PI;G.push(s.d5(Math.cos(K)*Math.cos(J),Math.cos(K)*Math.sin(J),Math.sin(K)))}return G})(this.params.starsCount),E=s.eq(300),I=new s.er,M=new s.b0;let O=0;for(let z=0;z<b.length;++z){const H=s.c5([],b[z],200),G=Math.max(0,1+.01*p*(1*E()-.5)),$=Math.max(0,1+.01*x*(1*E()-.5));I.emplaceBack(H[0],H[1],H[2],-1,-1,G,$),I.emplaceBack(H[0],H[1],H[2],1,-1,G,$),I.emplaceBack(H[0],H[1],H[2],1,1,G,$),I.emplaceBack(H[0],H[1],H[2],-1,1,G,$),M.emplaceBack(O+0,O+1,O+2),M.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=c.createVertexBuffer(I,lg.members),this.starsIdx=c.createIndexBuffer(M),this.starsSegments=s.bg.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,c){const p=n.context,x=p.gl,b=n.transform,E=new mn(x.LEQUAL,mn.ReadOnly,[0,1]),I=s.aj(b.zoom),M=n.style.getLut(c.scope),O=c.properties.get("color-use-theme")==="none",z=c.properties.get("color").toNonPremultipliedRenderColor(O?null:M),H=c.properties.get("high-color-use-theme")==="none",G=c.properties.get("high-color").toNonPremultipliedRenderColor(H?null:M),$=c.properties.get("space-color-use-theme")==="none",J=c.properties.get("space-color").toNonPremultipliedRenderColor($?null:M),K=5e-4,ee=s.es(c.properties.get("horizon-blend"),0,1,K,.25),re=s.dE(n,p,b)&&ee===K?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,pe=n.frameCounter/1e3%1,fe=s.ag(b.globeCenterInViewSpace),ue=Math.sqrt(Math.pow(fe,2)-Math.pow(re,2)),Ie=Math.acos(ue/fe),Te=Ae=>{const be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ae&&be.push("ALPHA_PASS");const ge=n.getOrCreateProgram("globeAtmosphere",{defines:be}),ke=((je,Xe,Ze,ut,xt,et,Le,mt,rt,yt,kt,qt)=>({u_frustum_tl:je,u_frustum_tr:Xe,u_frustum_br:Ze,u_frustum_bl:ut,u_horizon:xt,u_transition:et,u_fadeout_range:Le,u_atmosphere_fog_color:mt.toArray01(),u_high_color:rt.toArray01(),u_space_color:yt.toArray01(),u_temporal_offset:kt,u_horizon_angle:qt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,ee,z,G,J,pe,Ie);n.uploadCommonUniforms(p,ge);const ze=this.atmosphereBuffer;ze&&ge.draw(n,x.TRIANGLES,E,On.disabled,Ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Mn.backCW,ke,Ae?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};Te(!1),Te(!0)}drawStars(n,c){const p=s.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=n.context,b=x.gl,E=n.transform,I=n.getOrCreateProgram("stars"),M=s.c7([]);s.c9(M,M,-E._pitch),s.c8(M,M,-E.angle),s.c9(M,M,s.an(E._center.lat)),s.et(M,M,-s.an(E._center.lng));const O=s.cc(new Float32Array(16),M),z=s.aB([],E.starsProjMatrix,O),H=s.eo([],O),G=s.eu([],H),$=[0,1,0];s.dQ($,$,G),s.c5($,$,this.params.sizeMultiplier);const J=[1,0,0];s.dQ(J,J,G),s.c5(J,J,this.params.sizeMultiplier);const K=(ee=$,re=J,pe=p,{u_matrix:Float32Array.from(z),u_up:ee,u_right:re,u_intensity_multiplier:pe});var ee,re,pe;n.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(n,b.TRIANGLES,mn.disabled,On.disabled,this.colorModeAlphaBlendedWriteRGB,Mn.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ou{constructor(){this.visibleTiles=[]}updateBorders(n,c){const p=[],x=[],b=n._getRenderableCoordinates(!1,!0);for(const M of b){const O=n.getTile(M);if(!O.hasData())continue;const z=O.getBucket(c);z&&(z.isEmpty()||(p.push(M.key),x.push({bucket:z,tileID:M.canonical})))}let E=p.length!==this.visibleTiles.length;if(!E){p.sort();for(let M=0;M<p.length;M++)if(p[M]!==this.visibleTiles[M]){E=!0;break}}if(!E)return;const I=new Set;this.visibleTiles=p,x.sort((M,O)=>M.tileID.z-O.tileID.z||M.tileID.x-O.tileID.x||M.tileID.y-O.tileID.y);for(const M of x){const O=new Array,z=new Array,H=M.bucket;for(const G of H.featuresOnBorder)I.has(G.featureId)?z.push(G.footprintIndex):(I.add(G.featureId),O.push(G.footprintIndex));H.updateFootprintHiddenFlags(O,s.ev,!1),H.updateFootprintHiddenFlags(z,s.ev,!0)}}}function Wp(f,n){const c=[...f],p=n.cameraWorldSizeForFog/n.worldSize,x=s.bA([]);return s.cS(x,x,[p,p,1]),s.aB(c,x,c),s.aB(c,n.worldToFogMatrix,c),c}function No(f,n,c,p,x){const b=c.material,E=p.context,{baseColorTexture:I,metallicRoughnessTexture:M}=b.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:z,emissionTexture:H}=b;function G(J,K,ee){if(J&&(f.push(K),E.activeTexture.set(E.gl.TEXTURE0+ee),J.gfxTexture)){const{minFilter:re,magFilter:pe,wrapS:fe,wrapT:ue}=J.sampler;J.gfxTexture.bindExtraParam(re,pe,fe,ue)}}G(I,"HAS_TEXTURE_u_baseColorTexture",5),G(M,"HAS_TEXTURE_u_metallicRoughnessTexture",6),G(O,"HAS_TEXTURE_u_normalTexture",7),G(z,"HAS_TEXTURE_u_occlusionTexture",8),G(H,"HAS_TEXTURE_u_emissionTexture",9),x&&(x.texture||(x.texture=new s.d$(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+10),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(c.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const $=p.shadowRenderer;$&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Mi(f,n,c,p,x,b){const E=f.modelOpacity,I=n.context,M=new mn(n.context.gl.LEQUAL,f.isLightMesh?mn.ReadOnly:mn.ReadWrite,n.depthRangeFor3D),O=n.transform,z=f.mesh,H=z.material,G=H.pbrMetallicRoughness,$=n.style.fog;let J;J=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],p.zScaleMatrix,f.nodeModelMatrix),s.aB(J,p.negCameraPosMatrix,J);const K=s.bl([],J);s.eg(K,K);const ee=c.paint.get("model-color-use-theme").constantOr("default")==="none",re=c.paint.get("model-emissive-strength").constantOr(0),pe=jl(new Float32Array(f.worldViewProjection),new Float32Array(J),new Float32Array(K),null,n,E,G.baseColorFactor,H.emissiveFactor,G.metallicFactor,G.roughnessFactor,H,re,c,void 0,void 0,f.materialOverride,f.modelColor),fe={defines:[]},ue=[],Ie=n.shadowRenderer;Ie&&(Ie.useNormalOffset=!1),No(fe.defines,ue,z,n,ee?null:c.lut);let Te=null;if($){const ge=Wp(f.nodeModelMatrix,n.transform);if(Te=new Float32Array(ge),O.projection.name!=="globe"){const ke=z.aabb.min,ze=z.aabb.max,[je,Xe]=$.getOpacityForBounds(ge,ke[0],ke[1],ze[0],ze[1]);fe.overrideFog=je>=tn||Xe>=tn}}const Ae=Yo(n,c.paint.get("model-cutoff-fade-range"));Ae.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const be=n.getOrCreateProgram("model",fe);n.uploadCommonUniforms(I,be,null,Te,Ae),n.renderPass!=="shadow"&&Ie&&Ie.setupShadowsFromMatrix(f.nodeModelMatrix,be),be.draw(n,I.gl.TRIANGLES,M,x,b,z.material.doubleSided?Mn.disabled:Mn.backCCW,pe,c.id,z.vertexBuffer,z.indexBuffer,z.segments,c.paint,n.transform.zoom,void 0,ue)}function Ad(f,n){return f.style._importedAsBasemap?"basemap":n.scope}function Ah(f,n,c,p,x,b,E,I,M,O){const z=f.transform,H=!!n.isGeometryBloom&&n.isGeometryBloom;if(H&&f.renderPass==="shadow")return;const G=z.projection.name==="globe"?s.eD(c,z):[...c];s.aB(G,G,n.globalMatrix);const $=s.aB([],p,G);if(n.meshes)for(const J of n.meshes){const K=I.get(J.material.name);if(K&&K.opacity<=0)continue;if(J.material.alphaMode!=="BLEND"){E.push({mesh:J,depth:0,modelIndex:x,worldViewProjection:$,nodeModelMatrix:G,isLightMesh:H,materialOverride:K,modelOpacity:M,modelColor:O});continue}const ee=s.af([],J.centroid,$);!z.isOrthographic&&ee[2]<=0||b.push({mesh:J,depth:ee[2],modelIndex:x,worldViewProjection:$,nodeModelMatrix:G,isLightMesh:H,materialOverride:K,modelOpacity:M,modelColor:O})}if(n.children)for(const J of n.children)Ah(f,J,c,p,x,b,E,I,M,O)}function Id(f,n,c,p){const x=c.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(n),M=wh(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,b,On.disabled,E,Mn.disabled,M,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function ug(f,n,c,p,x,b){for(const E of x){const I=Object.assign({},p);I.part=E;const M={type:"Unknown",id:n,properties:I},O={orientation:f.paint.get("model-rotation").evaluate(M,c)};b.set(E,O)}}function hg(f,n,c,p,x,b){for(const E of x){const I=Object.assign({},p);I.part=E;const M={type:"Unknown",id:n,properties:I},O={color:f.paint.get("model-color").evaluate(M,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(M,c),opacity:f.paint.get("model-opacity").evaluate(M,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(M,c)};b.set(E,O)}}function Xp(f,n,c,p,x){let b=!1;for(const I of p)I.modelOpacity!==1&&(Mi(I,f,n,x[I.modelIndex],On.disabled,zn.disabled),b=!0);for(const I of p)Mi(I,f,n,x[I.modelIndex],I.modelOpacity!==1?f.stencilModeFor3D():On.disabled,f.colorModeForRenderPass());b&&f.resetStencilClippingMasks();const E=zn.additive;for(const I of c)Mi(I,f,n,x[I.modelIndex],On.disabled,I.isLightMesh?E:f.colorModeForRenderPass())}function zu(f,n,c){const p=n.updateZoomBasedPaintProperties(),x=(function(b,E,I){let M,O,z,H=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&H>0){const G=b.terrain,$=G.findDEMTileFor(I);$&&$.dem?M=s.eF.create(G,I,$):H=0}if(H===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),H===E.validForExaggeration&&(H===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const G in E.instancesPerModel){const $=E.instancesPerModel[G];for(let J=0;J<$.instancedDataArray.length;++J){const K=(M?H*M.getElevationAt(0|$.instancedDataArray.float32[16*J],0|$.instancedDataArray.float32[16*J+1],!0,!0):0)+$.instancesEvaluatedElevation[J];$.instancedDataArray.float32[16*J+6]=K,O=O?Math.min(E.terrainElevationMin,K):K,z=z?Math.max(E.terrainElevationMax,K):K}}return E.terrainElevationMin=O||0,E.terrainElevationMax=z||0,E.validForExaggeration=H,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,n,c);(p||x)&&(n.uploaded=!1,n.upload(f.context))}const ka={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function Nt(f,n){const c=1<<f.canonical.z,p=n.getFreeCameraOptions().position,x=n.elevation,b=f.canonical.x/c,E=(f.canonical.x+1)/c,I=f.canonical.y/c,M=(f.canonical.y+1)/c;let O=n._centerAltitude;if(x){const $=x.getMinMaxForTile(f);$&&$.max>O&&(O=$.max)}const z=s.aA(p.x,b,E)-p.x,H=s.aA(p.y,I,M)-p.y,G=s.cf(O,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(z*z+H*H+G*G))}function Xt(f,n,c,p,x,b,E){const I=f.context,M=f.renderPass==="shadow",O=f.shadowRenderer,z=M&&O?O.getShadowPassDepthMode():new mn(I.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),H=f.isTileAffectedByFog(b),G=f.transform.projection.name==="globe";if(c.meshes)for(const $ of c.meshes){const J=G?[]:["MODEL_POSITION_ON_GPU"],K=[];let ee,re,pe;const fe=!G&&p.instancedDataArray.length>20;fe&&J.push("INSTANCED_ARRAYS");const ue=Yo(f,n.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),M&&O)ee=f.getOrCreateProgram("modelDepth",{defines:J}),re=wh(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.globalMatrix)),pe=O.getShadowPassColorMode();else{No(J,K,$,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),ee=f.getOrCreateProgram("model",{defines:J,overrideFog:H});const Te=$.material,Ae=Te.pbrMetallicRoughness,be=n.paint.get("model-opacity").constantOr(1),ge=n.paint.get("model-emissive-strength").constantOr(0);re=jl(b.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,be,Ae.baseColorFactor,Te.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,Te,ge,n,x),O&&(E.shadowUniformsInitialized?ee.setShadowUniformValues(I,O.getShadowUniformValues()):(O.setupShadows(b.toUnwrapped(),ee,"model-tile"),E.shadowUniformsInitialized=!0)),pe=ue.shouldRenderCutoff||be<1||Te.alphaMode!=="OPAQUE"?zn.alphaBlended:zn.unblended}f.uploadCommonUniforms(I,ee,b.toUnwrapped(),null,ue);const Ie=$.material.doubleSided?Mn.disabled:Mn.backCCW;if(fe)K.push(p.instancedDataBuffer),ee.draw(f,I.gl.TRIANGLES,z,On.disabled,pe,Ie,re,n.id,$.vertexBuffer,$.indexBuffer,$.segments,n.paint,f.transform.zoom,void 0,K,p.instancedDataArray.length);else{const Te=M?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<p.instancedDataArray.length;++Ae)re[Te]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ae,16),ee.draw(f,I.gl.TRIANGLES,z,On.disabled,pe,Ie,re,n.id,$.vertexBuffer,$.indexBuffer,$.segments,n.paint,f.transform.zoom,void 0,K)}}if(c.children)for(const $ of c.children)Xt(f,n,$,p,x,b,E)}const Ih=[1,-1,1];function br(f,n,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const b=c.shadowRenderer,E=n.aabb;let I=!0,M=f.maxHeight;if(M===0){let z=0;for(const H in f.instancesPerModel){const G=x.getModel(H,p);G?z=Math.max(z,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):I=!1}M=f.maxScale*z*1.41+f.maxVerticalOffset,I&&(f.maxHeight=M)}E.max[2]=M,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,s.af(E.min,E.min,n.tileMatrix),s.af(E.max,E.max,n.tileMatrix);const O=E.intersects(b.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=O===2),O===0}function We(f,n){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===c||b===x?1:s.aA(((n-c)/(p-c)-x)/(b-x),0,1)}function dg(f,n,c,p){if(n.pitch<20)return 1;const x=n.getWorldToCameraMatrix();s.aB(x,x,f);const b=s.bU(c.min[0],c.min[1],c.min[2],1);let E=s.aC(s.eG(),b,x),I=E,M=E;b[1]=c.max[1],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,b[0]=c.max[0],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,b[1]=c.min[1],E=s.aC(s.eG(),b,x),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M;const O=s.aA(p[0],0,1),z=100*n.pixelsPerMeter*s.aA(p[1],0,1),H=s.aA(p[2],0,1),G=s.eH(s.eG(),I,M,O),$=Math.tan(.5*n.fovX),J=-G[2]*$;if(z===0)return G[1]<-Math.abs(J)?H:1;const K=(-Math.abs(J)-G[1])/z,ee=(pe,fe,ue)=>(1-ue)*pe+ue*fe,re=s.aA(ee(1,H,K),H,1);return ee(1,re,s.aA((n.pitch-20)/20,0,1))}class Yp{}class Uf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,c,p){{const H=this._storage.get(c.id);if(H)return H.lastUsedFrameIdx=n,H.buf}const x=p.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(b),I=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const M=new s.eJ;for(let H=0;H<b/2;H+=3){const G=I[H],$=I[H+1],J=I[H+2];M.emplaceBack(G,$),M.emplaceBack($,J),M.emplaceBack(J,G)}const O=p.bindVertexArrayOES.current,z=new Yp;return z.buf=new Da(p,M),z.lastUsedFrameIdx=n,this._storage.set(c.id,z),p.bindVertexArrayOES.set(O),z.buf}update(n){for(const[c,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[n,c]of this._storage)c.buf.destroy(),this._storage.delete(n)}}class Kp{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const fg=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Gf{constructor(n){this.revealStart=11,this.revealRange=2}}const Ch=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class P_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,c){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new s.eK,I=new s.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(E,Ch.members),this.vignetteIdx=n.context.createIndexBuffer(I)}const x=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const E={u_vignetteShape:(b={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,mn.disabled,On.disabled,zn.alphaBlended,Mn.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class nx{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,c){const p=n.getFreeCameraOptions().position,x=p.toAltitude(),b=p.toLngLat(),E=s.an(b.lng),I=s.an(b.lat),M=n.pixelsPerMeter/c,O=E*s.eM,z=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+z,G=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+O)*M,this._accumulatedOffsetY+=H*M,this._accumulatedElevation+=G*M,this._offsetXPrev=O,this._offsetYPrev=z,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function pg(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function Cd(f){const n=s.eq(1323123451230),c=[];for(let p=0;p<f;++p){const x=2*n()-1,b=2*n()-1,E=2*n()-1;c.push(s.d5(x,b,E))}return c}function Bo(f,n,c,p,x){const b=s.aA((x-c)/(p-c),0,1);return(1-b)*f+b*n}class qf{constructor(n){this._movement=new nx,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new P_,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,c){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,b=s.c7([]);s.c9(b,b,s.an(90)-p._pitch),s.c8(b,b,-p.angle);const E=s.cc(new Float32Array(16),b),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=s.eg([],I),O=s.aB([],M,E),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*c,this._prevTime=z,{projectionMatrix:x,modelviewMatrix:O}}}class Hf extends qf{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Gf("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=Cd(this.particlesCount),x=new s.eN,b=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<p.length;++M){const O=p[M],z=[2*I()-1,I(),I(),I()];x.emplaceBack(O[0],O[1],O[2],-1,-1,...z),x.emplaceBack(O[0],O[1],O[2],1,-1,...z),x.emplaceBack(O[0],O[1],O[2],1,1,...z),x.emplaceBack(O[0],O[1],O[2],-1,1,...z),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,fg.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(c.revealStart>p)return;const x=Bo(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let E=[-b.direction.x,b.direction.y,-100];s.aw(E,E);const I=structuredClone(this._vignetteParams);I.strength*=x,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),E=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(n.style.rain.state.vignetteColor));const M=this.updateOnRender(n,b.timeFactor),O=n.context,z=O.gl,H=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(O,{width:n.width,height:n.height,data:null},z.RGBA8)),b.distortionStrength>0&&(O.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const G=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(O,G),O.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const $=[b.color.r,b.color.g,b.color.b,b.color.a],J=(K,ee)=>{const re=pg(this._movement.getPosition(),K),pe=b.dropletSizeX,fe=b.dropletSizeX*b.dropletSizeYScale,ue=n.width/2,Ie=n.height/2,Te=Bo(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ae=Bo(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),be=Bo(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),ge=(ke={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:K,rainDropletSize:[pe,fe],distortionStrength:b.distortionStrength,rainDirection:E,color:$,screenSize:[H.width,H.height],thinningCenterPos:[ue,Ie],thinningShape:[Te,Ae,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(ke.modelview),u_projection:Float32Array.from(ke.projection),u_time:ke.time,u_cam_pos:ke.camPos,u_texScreen:0,u_velocityConeAperture:ke.velocityConeAperture,u_velocity:ke.velocity,u_boxSize:ke.boxSize,u_rainDropletSize:ke.rainDropletSize,u_distortionStrength:ke.distortionStrength,u_rainDirection:ke.rainDirection,u_color:ke.color,u_screenSize:ke.screenSize,u_thinningCenterPos:ke.thinningCenterPos,u_thinningShape:ke.thinningShape,u_thinningAffectedRatio:ke.thinningAffectedRatio,u_thinningParticleOffset:ke.thinningParticleOffset,u_shapeDirectionalPower:ke.shapeDirectionalPower,u_shapeNormalPower:ke.shapeNormalPower,u_mode:ke.mode});var ke;const ze=Math.round(b.intensity*this.particlesCount),je=s.bg.simpleSegment(0,0,4*ze,2*ze);G.draw(n,z.TRIANGLES,mn.disabled,On.disabled,zn.alphaBlended,Mn.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,je)};b.distortionStrength>0&&J(b.boxSize,!0),J(b.boxSize,!1),this._vignette.draw(n,I)}}const $f=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Rd extends qf{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Gf("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=Cd(this.particlesCount),x=new s.eO,b=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<p.length;++M){const O=p[M],z=I(),H=I(),G=I(),$=[M/p.length,z,H,G],J=[I(),I()];x.emplaceBack(O[0],O[1],O[2],-1,-1,...$,...J),x.emplaceBack(O[0],O[1],O[2],1,-1,...$,...J),x.emplaceBack(O[0],O[1],O[2],1,1,...$,...J),x.emplaceBack(O[0],O[1],O[2],-1,1,...$,...J),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,$f.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];s.aw(p,p);const x=structuredClone(this._vignetteParams),b=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=n.transform.zoom;if(b.revealStart>E)return;const I=Bo(0,1,b.revealStart,b.revealStart+b.revealRange,E);x.strength*=I,c.overrideStyleParameters||(c.intensity=n.style.snow.state.density,c.timeFactor=n.style.snow.state.intensity,c.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),c.screenThinning.intensity=n.style.snow.state.centerThinning,c.billboardSize=2.79*n.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(n.style.snow.state.vignetteColor));const M=this.updateOnRender(n,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const O=n.context,z=O.gl,H=n.transform,G=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(O,G),(($,J,K)=>{const ee=pg(this._movement.getPosition(),$),re=H.width/2,pe=H.height/2,fe=Bo(0,K.screenThinning.start,0,1,K.screenThinning.intensity),ue=Bo(.001,K.screenThinning.range,0,1,K.screenThinning.intensity),Ie=Bo(0,K.screenThinning.particleOffset,0,1,K.screenThinning.intensity),Te=(Ae={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:K.velocityConeAperture,velocity:K.velocity,horizontalOscillationRadius:K.horizontalOscillationRadius,horizontalOscillationRate:K.horizontalOscillationRate,boxSize:$,billboardSize:1*K.billboardSize,simpleShapeParameters:[K.shapeFadeStart,K.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[re,pe],thinningShape:[fe,ue,Math.pow(10,K.screenThinning.fadePower)],thinningAffectedRatio:K.screenThinning.affectedRatio,thinningParticleOffset:Ie,color:[K.color.r,K.color.g,K.color.b,K.color.a],direction:p},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_horizontalOscillationRadius:Ae.horizontalOscillationRadius,u_horizontalOscillationRate:Ae.horizontalOscillationRate,u_boxSize:Ae.boxSize,u_billboardSize:Ae.billboardSize,u_simpleShapeParameters:Ae.simpleShapeParameters,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_particleColor:Ae.color,u_direction:Ae.direction});var Ae;const be=Math.round(K.intensity*this.particlesCount),ge=s.bg.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&G.draw(n,z.TRIANGLES,mn.disabled,On.disabled,zn.alphaBlended,Mn.disabled,Te,"snow_particles",this.particlesVx,this.particlesIdx,ge)})(c.boxSize,0,c),this._vignette.draw(n,x)}}const ql={symbol:function(f,n,c,p,x){if(f.renderPass!=="translucent")return;const b=On.disabled,E=f.colorModeForRenderPass(),I=c.layout.get("text-variable-anchor"),M=c.layout.get("text-size-scale-range"),O=s.aA(f.scaleFactor,M[0],M[1]);I&&(function(G,$,J,K,ee,re,pe,fe){const ue=$.transform,Ie=ee==="map",Te=re==="map";for(const Ae of G){const be=K.getTile(Ae),ge=be.getBucket(J);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const ke=s.bK(ge.textSizeData,ue.zoom,fe),ze=ro(Ae,ge.getProjection(),ue),je=ue.calculatePixelsToTileUnitsMatrix(be),Xe=ac(ze,be.tileID.canonical,Te,Ie,ue,ge.getProjection(),je),Ze=ge.hasIconTextFit()&&ge.hasIconData();ke&&Mu(ge,Ie,Te,pe,ue,Xe,Ae,Math.pow(2,ue.zoom-be.tileID.overscaledZ),ke,Ze)}})(p,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,O);const z=c.paint.get("icon-opacity").constantOr(1)!==0,H=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||H)?Eh(f,n,c,p,b,E):(z&&Eh(f,n,c,p,b,E,{onlyIcons:!0}),H&&Eh(f,n,c,p,b,E,{onlyText:!0})),n.map.showCollisionBoxes&&(Gr(f,n,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Gr(f,n,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,M=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const O=f.context,z=O.gl,H=f.transform,G=!(!f.terrain||!f.terrain.enabled),$=c.layout.get("circle-elevation-reference"),J=f.depthModeForSublayer(0,mn.ReadOnly),K=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),ee=$==="none"||G?J:K,re=On.disabled,pe=f.colorModeForDrapableLayerRenderPass(M),fe=H.projection.name==="globe",ue=[s.aF(H.center.lng),s.aJ(H.center.lat)],Ie=[];for(let Ae=0;Ae<p.length;Ae++){const be=p[Ae],ge=n.getTile(be),ke=ge.getBucket(c);if(!ke||ke.projection.name!==H.projection.name)continue;const ze=ke.programConfigurations.get(c.id),je=ke.layoutVertexBuffer,Xe=ke.globeExtVertexBuffer,Ze=ke.indexBuffer,ut=s.e0(c),xt=[Xe],et=f.isTileAffectedByFog(be);fe&&ut.push("PROJECTION_GLOBE_VIEW"),ut.push("DEPTH_D24"),f.terrain&&H.depthOcclusionForSymbolsAndCircles&&ut.push("DEPTH_OCCLUSION"),ke.hasElevation&&!f.terrain&&(ut.push("ELEVATED_ROADS"),xt.push(ke.elevatedLayoutVertexBuffer));const Le=f.getOrCreateProgram("circle",{config:ze,defines:ut,overrideFog:et}),mt=H.projection.createInversionMatrix(H,be.canonical),rt={programConfiguration:ze,program:Le,layoutVertexBuffer:je,dynamicBuffers:xt,indexBuffer:Ze,uniformValues:s.e1(f,be,ge,mt,ue,c),tile:ge};if(I){const yt=ke.segments.get();for(const kt of yt)Ie.push({segments:new s.bg([kt]),sortKey:kt.sortKey,state:rt})}else Ie.push({segments:ke.segments,sortKey:0,state:rt})}I&&Ie.sort((Ae,be)=>Ae.sortKey-be.sortKey);const Te={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const Ae of Ie){const{programConfiguration:be,program:ge,layoutVertexBuffer:ke,dynamicBuffers:ze,indexBuffer:je,uniformValues:Xe,tile:Ze}=Ae.state,ut=Ae.segments;f.terrain&&f.terrain.setupElevationDraw(Ze,ge,Te),f.uploadCommonUniforms(O,ge,Ze.tileID.toUnwrapped()),ge.draw(f,z.TRIANGLES,ee,re,pe,Mn.disabled,Xe,c.id,ke,je,ut,c.paint,H.zoom,be,ze)}},heatmap:function(f,n,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,b=x.gl,E=On.disabled,I=new zn([b.ONE,b.ONE,b.ONE,b.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function($,J,K,ee){const re=$.gl,pe=J.width*ee,fe=J.height*ee;$.activeTexture.set(re.TEXTURE1),$.viewport.set([0,0,pe,fe]);let ue=K.heatmapFbo;if(!ue||ue&&(ue.width!==pe||ue.height!==fe)){ue&&ue.destroy();const Ie=re.createTexture();re.bindTexture(re.TEXTURE_2D,Ie),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),ue=K.heatmapFbo=$.createFramebuffer(pe,fe,1,null),(function(Te,Ae,be,ge,ke,ze){const je=Te.gl;je.texImage2D(je.TEXTURE_2D,0,Te.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,ke,ze,0,je.RGBA,Te.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),ge.colorAttachment0.set(be)})($,0,Ie,ue,pe,fe)}else re.bindTexture(re.TEXTURE_2D,ue.colorAttachment0.get()),$.bindFramebuffer.set(ue.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:s.ao.transparent});const M=f.transform,O=M.projection.name==="globe",z=O?["PROJECTION_GLOBE_VIEW"]:[],H=O?Mn.frontCCW:Mn.disabled,G=[s.aF(M.center.lng),s.aJ(M.center.lat)];for(let $=0;$<p.length;$++){const J=p[$];if(n.hasRenderableParent(J))continue;const K=n.getTile(J),ee=K.getBucket(c);if(!ee||ee.projection.name!==M.projection.name)continue;const re=f.isTileAffectedByFog(J),pe=ee.programConfigurations.get(c.id),fe=f.getOrCreateProgram("heatmap",{config:pe,defines:z,overrideFog:re}),{zoom:ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(K,fe),f.uploadCommonUniforms(x,fe,J.toUnwrapped());const Ie=M.projection.createInversionMatrix(M,J.canonical);fe.draw(f,b.TRIANGLES,mn.disabled,E,I,H,_h(f,J,K,Ie,G,ue,c.paint.get("heatmap-intensity")),c.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,c.paint,f.transform.zoom,pe,O?[ee.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(x,b){const E=x.context,I=E.gl,M=b.heatmapFbo;if(!M)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment0.get()),E.activeTexture.set(I.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new s.T(E,b.colorRamp,I.RGBA8)),O.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,mn.disabled,On.disabled,x.colorModeForRenderPass(),Mn.disabled,((z,H)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)})(f,c))},line:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=c.paint.get("line-emissive-strength").isConstant(),I=c.paint.get("line-emissive-strength").constantOr(0),M=c.paint.get("line-occlusion-opacity"),O=c.layout.get("line-elevation-reference"),z=c.layout.get("line-width-unit")==="meters",H=O==="sea",G=!(!f.terrain||!f.terrain.enabled),$=f.context,J=$.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const K=c.layout.get("line-cross-slope"),ee=K!==void 0,re=K<1,pe=f.colorModeForDrapableLayerRenderPass(E?I:null),fe=f.terrain&&f.terrain.renderingToTexture,ue=fe?1:s.o.devicePixelRatio,Ie=c.paint.get("line-dasharray"),Te=Ie.constantOr(1),Ae=c.layout.get("line-cap"),be=Ie.constantOr(null),ge=Ae.constantOr(null),ke=c.paint.get("line-pattern"),ze=ke.constantOr(1),je=c.paint.get("line-pattern-cross-fade"),Xe=ke.constantOr(null),Ze=c.paint.get("line-opacity").constantOr(1);let ut=!ze&&Ze!==1||f.depthOcclusion&&M>0&&M<1;const xt=c.paint.get("line-gradient"),et=ze?"linePattern":"line",Le=s.e2(c);let mt;if(fe&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ut=!1),M!==0&&f.depthOcclusion){const qt=c.paint._values["line-opacity"];qt&&qt.value&&qt.value.kind==="constant"?mt=qt.value:s.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Le.push("VARIABLE_LINE_WIDTH"),fe&&(f.emissiveMode!=="dual-source-blending"||E?f.emissiveMode==="mrt-fallback"&&Le.push("USE_MRT1"):Le.push("DUAL_SOURCE_BLENDING"));const rt=(qt,zt,Lt,un,an,Zt)=>{for(const on of qt){const xn=n.getTile(on);if(ze&&!xn.patternsLoaded())continue;const Dn=xn.getBucket(c);if(!Dn||Dn.elevationType!=="none"&&!an||Dn.elevationType==="none"&&an)continue;f.prepareDrawTile();const jn=[...zt],ni=f.shadowRenderer,Pn=Dn.elevationType==="road"&&!!ni&&ni.enabled;let Un=[0,0,0];if(Pn){const Hn=f.style.directionalLight,Ki=f.style.ambientLight;Hn&&Ki&&(Un=qa(f.style,Hn,Ki)),jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Nn=Dn.programConfigurations.get(c.id);let bi=!1;if(Xe&&xn.imageAtlas){const Hn=s.e3.from(Xe),Ki=Hn.getPrimary().scaleSelf(ue).toString(),Lr=xn.imageAtlas.patternPositions.get(Ki),Bi=Hn.getSecondary(),Qi=Bi?xn.imageAtlas.patternPositions.get(Bi.scaleSelf(ue).toString()):null;bi=!!Lr&&!!Qi,Lr&&Nn.setConstantPatternPositions(Lr,Qi)}je>0&&(bi||Nn.getPatternTransitionVertexBuffer("line-pattern"))&&jn.push("LINE_PATTERN_TRANSITION");const pi=f.isTileAffectedByFog(on),Di=f.getOrCreateProgram(et,{config:Nn,defines:jn,overrideFog:pi});if(!ze&&be&&ge&&xn.lineAtlas){const Hn=xn.lineAtlas.getDash(be,ge);Hn&&Nn.setConstantPatternPositions(Hn)}Pn&&ni.setupShadows(xn.tileID.toUnwrapped(),Di,"vector-tile");let[ci,Gn]=c.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&ci!==Gn&&(ci===0&&(ci-=1),Gn===1&&(Gn+=1));const _i=fe?on.projMatrix:null,pr=z?1/Dn.tileToMeter/s.ay(xn,1,f.transform.zoom):1,Pi=z?1/Dn.tileToMeter/s.ay(xn,1,Math.floor(f.transform.zoom)):1,Si=ze?s.e4(f,xn,c,_i,ue,pr,Pi,[ci,Gn],Un,je):s.e5(f,xn,c,_i,Dn.lineClipsArray.length,ue,pr,Pi,[ci,Gn],Un);if(xt){const Hn=Dn.gradients[c.id];let Ki=Hn.texture;if(c.gradientVersion!==Hn.version){let Lr=256;if(c.stepInterpolant){const Bi=n.getSource().maxzoom,Qi=on.canonical.z===Bi?Math.ceil(1<<f.transform.maxZoom-on.canonical.z):1;Lr=s.aA(s.e6(Dn.maxLineLength/s.al*1024*Qi),256,$.maxTextureSize)}Hn.gradient=s.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Lr,image:Hn.gradient||void 0,clips:Dn.lineClipsArray}),Hn.texture?Hn.texture.update(Hn.gradient):Hn.texture=new s.T($,Hn.gradient,J.RGBA8),Hn.version=c.gradientVersion,Ki=Hn.texture}$.activeTexture.set(J.TEXTURE1),Ki.bind(c.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Te&&($.activeTexture.set(J.TEXTURE0),xn.lineAtlasTexture&&xn.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),Nn.updatePaintBuffers()),ze&&($.activeTexture.set(J.TEXTURE0),xn.imageAtlasTexture&&xn.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Nn.updatePaintBuffers()),an&&!H&&f.terrain.setupElevationDraw(xn,Di),f.uploadCommonUniforms($,Di,on.toUnwrapped());const Fn=Hn=>{mt!=null&&(mt.value=Ze*M),Di.draw(f,J.TRIANGLES,Lt,Hn,pe,Mn.disabled,Si,c.id,Dn.layoutVertexBuffer,Dn.indexBuffer,Dn.segments,c.paint,f.transform.zoom,Nn,[Dn.layoutVertexBuffer2,Dn.patternVertexBuffer,Dn.zOffsetVertexBuffer]),mt!=null&&(mt.value=Ze)};if(ut&&!an){const Hn=f.stencilModeForClipping(on).ref;Hn===0&&fe&&$.clear({stencil:0});const Ki={func:J.EQUAL,mask:255};Si.u_alpha_discard_threshold=.8,Fn(new On(Ki,Hn,255,J.KEEP,J.KEEP,J.INVERT)),Si.u_alpha_discard_threshold=0,Fn(new On(Ki,Hn,255,J.KEEP,J.KEEP,J.KEEP))}else Si.u_alpha_discard_threshold=ut&&an&&Zt?.8:0,Fn(an?un:f.stencilModeForClipping(on))}};let yt=f.depthModeForSublayer(0,mn.ReadOnly);const kt=new mn(f.depthOcclusion?J.GREATER:J.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const qt=!fe&&f.terrain;M!==0&&qt?s.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):qt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):rt(p,Le,yt,On.disabled,!1,!0)}if(c.hasElevatedBuckets){O==="hd-road-markup"?G||(yt=kt,Le.push("ELEVATED_ROADS")):(Le.push("ELEVATED"),yt=kt,ee&&Le.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),H&&Le.push("ELEVATION_REFERENCE_SEA"));const qt=ut?f.stencilModeFor3D():On.disabled;f.forceTerrainMode=!0,rt(p,Le,yt,qt,!0,!0),ut&&rt(p,Le,yt,qt,!0,!1),f.forceTerrainMode=!1}ut&&(f.resetStencilClippingMasks(),fe&&$.clear({stencil:0})),M===0||f.depthOcclusion||fe||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,c,p){const x=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=c.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(E),M=c.paint.get("fill-pattern"),O=f.opaquePassEnabledForLayer()&&!M.constantOr(1)&&x.constantOr(s.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let z="none";c.layout.get("fill-elevation-reference")!=="none"?z="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const H=!(!f.terrain||!f.terrain.enabled),G={painter:f,sourceCache:n,layer:c,coords:p,colorMode:I,elevationType:z,terrainEnabled:H,pass:O};if(f.renderPass==="shadow")return void(f.shadowRenderer&&z==="road"&&!H&&(function(J){const{painter:K,sourceCache:ee,layer:re,coords:pe}=J,fe=K.context.gl,ue=J.painter.shadowRenderer;for(const Ie of pe){const Te=ee.getTile(Ie),Ae=Te.getBucket(re);if(!Ae)continue;const be=Ae.elevatedStructures;if(!be||!be.shadowCasterSegments||be.shadowCasterSegments.segments[0].primitiveLength===0)continue;K.prepareDrawTile();const ge=Ae.bufferData.programConfigurations.get(re.id),ke=K.isTileAffectedByFog(Ie),ze=K.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:ke}),je=ue.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());K.uploadCommonUniforms(K.context,ze,Ie.toUnwrapped());const Xe=gh(je,0);ze.draw(K,fe.TRIANGLES,ue.getShadowPassDepthMode(),On.disabled,ue.getShadowPassColorMode(),Mn.disabled,Xe,re.id,be.vertexBuffer,be.indexBuffer,be.shadowCasterSegments,re.paint,K.transform.zoom,ge)}})(G));const $=f.emissiveMode==="mrt-fallback";if(z!=="offset"){if(is(G,!1,$),z==="road"){const J=!H&&f.renderPass==="translucent";J&&ng(f,n,c,p,"geometry"),is(G,!0,$,On.disabled),J&&(function(K){const{painter:ee,sourceCache:re,layer:pe,coords:fe,colorMode:ue}=K,Ie=ee.context.gl,Te=K.painter.shadowRenderer,Ae=!!Te&&Te.enabled,be=new mn(ee.context.gl.LEQUAL,mn.ReadOnly,ee.depthRangeFor3D);let ge=[0,0,0];if(Ae){const ze=ee.style.directionalLight,je=ee.style.ambientLight;ze&&je&&(ge=qa(ee.style,ze,je))}const ke=ze=>{for(const je of fe){const Xe=re.getTile(je),Ze=Xe.getBucket(pe);if(!Ze)continue;const ut=Ze.elevatedStructures;if(!ut)continue;let xt,et;if(ze?(xt=ut.renderableBridgeSegments,et=ut.bridgeProgramConfigurations.get(pe.id)):(xt=ut.renderableTunnelSegments,et=ut.tunnelProgramConfigurations.get(pe.id)),!xt||xt.segments[0].primitiveLength===0)continue;et.updatePaintBuffers(),ee.prepareDrawTile();const Le=ee.isTileAffectedByFog(je),mt=[];Ae&&mt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const rt=ee.getOrCreateProgram("elevatedStructures",{config:et,overrideFog:Le,defines:mt}),yt=ee.translatePosMatrix(je.projMatrix,Xe,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));Ae&&Te.setupShadows(Xe.tileID.toUnwrapped(),rt,"vector-tile");const kt=Vl(yt,ge);ee.uploadCommonUniforms(ee.context,rt,je.toUnwrapped()),rt.draw(ee,Ie.TRIANGLES,be,On.disabled,ue,Mn.backCCW,kt,pe.id,ut.vertexBuffer,ut.indexBuffer,xt,pe.paint,ee.transform.zoom,et,[ut.vertexBufferNormal])}};ke(!0),ke(!1)})(G)}}else is(G,!1,$,f.stencilModeFor3D())},"fill-extrusion":function(f,n,c,p){const x=c.paint.get("fill-extrusion-opacity"),b=f.context,E=b.gl,I=f.terrain,M=I&&I.renderingToTexture;if(x===0)return;const O=f.emissiveMode==="mrt-fallback",z=f.conflationActive&&f.style.isLayerClipped(c,n.getSource()),H=f.style.order.indexOf(c.fqid);if(z&&(function(G,$,J,K,ee){for(const re of K){const pe=$.getTile(re).getBucket(J);pe&&(pe.updateReplacement(re,G.replacementSource,ee),pe.uploadCentroid(G.context))}})(f,n,c,p,H),I||z)for(const G of p){const $=n.getTile(G).getBucket(c);$&&ig(f.context,n,G,$,c,I,z)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(I&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const $=G.getShadowPassDepthMode(),J=G.getShadowPassColorMode();ku(f,n,c,p,$,On.disabled,J,z)}else if(f.renderPass==="translucent"){const G=!c.paint.get("fill-extrusion-pattern").constantOr(1),$=c.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!M&&$.a!==0){const J=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D);x===1&&G?ku(f,n,c,p,J,On.disabled,zn.unblended,z):(ku(f,n,c,p,J,On.disabled,zn.disabled,z),ku(f,n,c,p,J,f.stencilModeFor3D(),f.colorModeForRenderPass(),z),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!I&&f.transform.projection.name!=="globe"||M)){const J=c.paint.get("fill-extrusion-opacity"),K=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=c.paint.get("fill-extrusion-flood-light-intensity"),pe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",fe=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:c.lut).toArray01().slice(0,3),ue=K>0&&ee>0,Ie=re>0,Te=(ge,ke,ze)=>(1-ze)*ge+ze*ke,Ae=new Sh;Ae.translate=c.paint.get("fill-extrusion-translate"),Ae.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const be=ge=>{const ke=f.depthModeForSublayer(1,mn.ReadOnly,E.LEQUAL,!0),ze=c.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),je=Te(.1,3,ze),Xe=f._showOverdrawInspector;if(!Xe){const Ze=new On({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ut=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ul(Ae,f,n,c,p,ke,Ze,ut,Mn.disabled,ge,"sdf",J,K,ee,re,fe,je,z,!1)}{const Ze=Xe?On.disabled:new On({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ut=Xe?f.colorModeForRenderPass():new zn([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ul(Ae,f,n,c,p,ke,Ze,ut,Mn.disabled,ge,"color",J,K,ee,re,fe,je,z,!1)}};if(M){const ge=()=>{const ze=I.drapeBufferSize[0],je=I.drapeBufferSize[1];let Xe=I.framebufferCopyTexture;return Xe&&(!Xe||Xe.size[0]===ze&&Xe.size[1]===je)||(Xe&&Xe.destroy(),Xe=I.framebufferCopyTexture=new s.T(b,new s.q({width:ze,height:je}),E.RGBA8)),Xe.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,ze,je),Xe},ke=(ze,je,Xe)=>{const Ze=f.depthModeForSublayer(1,mn.ReadOnly,E.LEQUAL,!1),ut=c.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xt=Te(.1,3,ut);{const et=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0]);Ul(Ae,f,n,c,p,Ze,On.disabled,et,Mn.disabled,ze,"clear",J,K,ee,re,fe,xt,z,je)}{const et=new On({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Le=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ul(Ae,f,n,c,p,Ze,et,Le,Mn.disabled,ze,"sdf",J,K,ee,re,fe,xt,z,je)}O&&!ze&&(Xe=ge());{const et=ze?E.ZERO:E.ONE_MINUS_DST_ALPHA,Le=new On({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),mt=new zn([et,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Ul(Ae,f,n,c,p,Ze,Le,mt,Mn.disabled,ze,"color",J,K,ee,re,fe,xt,z,je)}if(!O||ze){const et=new zn([E.ONE,E.ONE,E.ONE,ze?E.ZERO:E.ONE],s.ao.transparent,[!1,!1,!1,!0],ze?E.FUNC_ADD:E.MAX);Ul(Ae,f,n,c,p,Ze,On.disabled,et,Mn.disabled,ze,"clear",J,K,ee,re,fe,xt,z,je,Xe)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const et=new On({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),Le=new zn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!0,!1,!1,!1],E.MAX);Ul(Ae,f,n,c,p,Ze,et,Le,Mn.disabled,ze,"emissive",J,K,ee,re,fe,xt,z,je,Xe),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(ue||Ie){let ze;f.prepareDrawTile(),O&&!ue||(ze=ge()),ue&&ke(!0,!1,ze),Ie&&ke(!1,!0,ze)}}else ue&&be(!0),Ie&&be(!1),(ue||Ie)&&f.resetStencilClippingMasks()}}},building:function(f,n,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const x=c.paint.get("building-ambient-occlusion-ground-intensity"),b=c.paint.get("building-ambient-occlusion-ground-radius"),E=c.paint.get("building-ambient-occlusion-ground-attenuation"),I=c.paint.get("building-opacity");if(I<=0)return;let M=x>0&&b>0,O=!0;const z=c.paint.get("building-vertical-scale");if(z<=0)return;f.shadowRenderer||(O=!1);const H=f.conflationActive&&f.style.isLayerClipped(c,n.getSource()),G=f.style.order.indexOf(c.fqid);if((function($,J,K,ee,re,pe){for(const fe of pe){const ue=J.getTile(fe).getBucket(K);ue&&(re&&ue.updateReplacement(fe,$.replacementSource,ee),ue.uploadUpdatedIndexBuffer($.context))}})(f,n,c,G,H,p),(function($,J,K,ee){for(const re of ee){const pe=J.getTile(re).getBucket(K);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer($.context)}})(f,n,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const $=f.shadowRenderer,J=[],K=$.getShadowPassDepthMode();Ks({painter:f,source:n,layer:c,coords:p,defines:J,blendMode:$.getShadowPassColorMode(),depthMode:K,opacity:I,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];O&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const J=c.paint.get("building-facade-emissive-chance"),K=c.paint.get("building-ambient-occlusion-intensity"),ee=c.paint.get("building-flood-light-intensity"),re=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(re?null:c.lut).toArray01().slice(0,3),fe=c.paint.get("building-flood-light-ground-attenuation"),ue=ee>0,Ie=new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D);I<1&&Ks({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:zn.disabled,depthMode:Ie,opacity:I,verticalScale:z,facadeEmissiveChance:J,facadeAOIntensity:K,floodLightIntensity:ee,floodLightColor:pe,depthOnly:!0});const Te=f.colorModeForRenderPass();Ks({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:Te,depthMode:Ie,opacity:I,verticalScale:z,facadeEmissiveChance:J,facadeAOIntensity:K,floodLightIntensity:ee,floodLightColor:pe}),M&&xs(f,n,c,p,!0,I,x,b,ee,pe,E,H),ue&&xs(f,n,c,p,!1,I,x,b,ee,pe,fe,H)}else if(f.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],J=new mn(f.context.gl.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);Ks({painter:f,source:n,layer:c,coords:p,defines:$,blendMode:zn.alphaBlended,depthMode:J,opacity:I,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,n,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,b=f.terrain&&f.terrain.renderingToTexture,[E,I]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const M of I){const O=n.getTile(M);if(O.needsHillshadePrepare&&f.renderPass==="offscreen")ml(f,O,c);else if(f.renderPass==="translucent"){const z=f.depthModeForSublayer(0,mn.ReadOnly),H=c.paint.get("hillshade-emissive-strength"),G=f.colorModeForDrapableLayerRenderPass(H),$=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];vf(f,M,O,c,z,$,G)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,p,x,b){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,M=I&&E;if(f.renderElevatedRasterBackface&&!M)return;const O=f.context,z=O.gl,H=n.getSource(),G=(function(Te,Ae,be,ge,ke){const ze=Ae.paint.get("raster-color"),je=Te.type==="raster-array",Xe=[],Ze=Ae.paint.get("raster-resampling"),ut=Ae.paint.get("raster-color-mix");let xt=Ae.paint.get("raster-color-range");const et=[ut[0],ut[1],ut[2],0],Le=ut[3];let mt=Ze==="nearest"?ge.NEAREST:ge.LINEAR;if(je&&(Xe.push("RASTER_ARRAY"),ze||Xe.push("RASTER_COLOR"),Ze==="linear"&&Xe.push("RASTER_ARRAY_LINEAR"),mt=ge.NEAREST,!xt&&Te.rasterLayers)){const rt=Te.rasterLayers.find(({id:yt})=>yt===Ae.sourceLayer);rt&&rt.fields&&rt.fields.range&&(xt=rt.fields.range)}if(xt=xt||[0,1],ze){Xe.push("RASTER_COLOR"),be.activeTexture.set(ge.TEXTURE2),Ae.updateColorRamp(xt);let rt=Ae.colorRampTexture;rt||(rt=Ae.colorRampTexture=new s.T(be,Ae.colorRamp,ge.RGBA8)),rt.bind(mt,ge.CLAMP_TO_EDGE)}return ke&&Xe.push("USE_MRT1"),{mix:et,range:xt,offset:Le,defines:Xe,resampling:mt}})(H,c,O,z,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(H instanceof s.aU&&!p.length&&!E)return;const $=c.paint.get("raster-emissive-strength"),J=f.colorModeForDrapableLayerRenderPass($),K=f.terrain&&f.terrain.renderingToTexture,ee=!f.options.moving,re=c.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(H instanceof s.aU&&!p.length&&(H.onNorthPole||H.onSouthPole)){const Te=I?f.stencilModeFor3D():On.disabled;return void Lu(!!H.onNorthPole,null,f,n,c,$,G,Mn.disabled,Te)}if(!p.length)return;const[pe,fe]=H instanceof s.aU||K?[{},p]:f.stencilConfigForOverlap(p),ue=fe[fe.length-1].overscaledZ;M&&G.defines.push("PROJECTION_GLOBE_VIEW"),I&&G.defines.push("RENDER_CUTOFF");const Ie=(Te,Ae,be)=>{for(const ge of Te){const ke=ge.toUnwrapped(),ze=n.getTile(ge);if(K&&(!ze||!ze.hasData()))continue;O.activeTexture.set(z.TEXTURE0);const je=Up(ze,H,c,G);if(!je||!je.texture)continue;const{texture:Xe,mix:Ze,offset:ut,tileSize:xt,buffer:et}=je;let Le,mt;K?(Le=mn.disabled,mt=ge.projMatrix):I?(Le=new mn(z.LEQUAL,mn.ReadWrite,f.depthRangeFor3D),mt=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(ke,ee)):(Le=f.depthModeForSublayer(ge.overscaledZ-ue,c.paint.get("raster-opacity")===1?mn.ReadWrite:mn.ReadOnly,z.LESS),mt=f.transform.calculateProjMatrix(ke,ee));const rt=f.terrain&&K?f.terrain.stencilModeForRTTOverlap(ge):pe[ge.overscaledZ],yt=b?0:c.paint.get("raster-fade-duration");ze.registerFadeDuration(yt);const kt=n.findLoadedParent(ge,0),qt=If(ze,kt,n,f.transform,yt);let zt,Lt;!qt.isFading&&ze.refreshedUponExpiration&&(ze.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),O.activeTexture.set(z.TEXTURE0),Xe.bind(re,z.CLAMP_TO_EDGE),O.activeTexture.set(z.TEXTURE1),kt?(kt.texture&&kt.texture.bind(re,z.CLAMP_TO_EDGE),zt=Math.pow(2,kt.tileID.overscaledZ-ze.tileID.overscaledZ),Lt=[ze.tileID.canonical.x*zt%1,ze.tileID.canonical.y*zt%1]):Xe.bind(re,z.CLAMP_TO_EDGE),"useMipmap"in Xe&&O.extTextureFilterAnisotropic&&f.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const un=f.transform;let an;const Zt=I?Bf(un):[0,0,0,0];let on,xn,Dn,jn,ni,Pn=0;if(M&&H instanceof s.aU&&H.coordinates.length>3)on=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),xn=Float32Array.from(un.globeMatrix),Dn=Float32Array.from(s.dF(un)),jn=[s.aF(un.center.lng),s.aJ(un.center.lat)],an=H.elevatedGlobePerspectiveTransform,ni=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const pi=s.dG(ge.canonical);Pn=s.dH(pi.getCenter().lat),on=Float32Array.from(s.bk(s.dJ(ge.canonical))),xn=Float32Array.from(un.globeMatrix),Dn=Float32Array.from(s.dF(un)),jn=[s.aF(un.center.lng),s.aJ(un.center.lat)],an=[0,0],ni=Float32Array.from(s.dI(ge.canonical,pi,Pn,un.worldSize/un._pixelsPerMercatorPixel))}else an=H instanceof s.aU?H.perspectiveTransform:[0,0],on=new Float32Array(16),xn=new Float32Array(9),Dn=new Float32Array(16),jn=[0,0],ni=new Float32Array(9);const Un=yh(mt,on,xn,Dn,ni,Lt||[0,0],s.aj(f.transform.zoom),jn,Zt,zt||1,qt,c,an,I?c.paint.get("raster-elevation"):0,2,Ze,ut,G.range,xt,et,$),Nn=f.isTileAffectedByFog(ge),bi=f.getOrCreateProgram("raster",{defines:G.defines,overrideFog:Nn});if(f.uploadCommonUniforms(O,bi,ke),H instanceof s.aU){const pi=H.elevatedGlobeVertexBuffer,Di=H.elevatedGlobeIndexBuffer;if(K||!E)H.boundsBuffer&&H.boundsSegments&&bi.draw(f,z.TRIANGLES,Le,On.disabled,J,Mn.disabled,Un,c.id,H.boundsBuffer,f.quadTriangleIndexBuffer,H.boundsSegments);else if(pi&&Di){const ci=un.zoom<=s.c_?H.elevatedGlobeSegments:H.getSegmentsForLongitude(un.center.lng);ci&&bi.draw(f,z.TRIANGLES,Le,On.disabled,J,Ae,Un,c.id,pi,Di,ci)}}else if(M){Le=new mn(z.LEQUAL,mn.ReadOnly,f.depthRangeFor3D);const pi=f.globeSharedBuffers;if(pi){const[Di,ci,Gn]=pi.getGridBuffers(Pn,!1);bi.draw(f,z.TRIANGLES,Le,be||rt,f.colorModeForRenderPass(),Ae,Un,c.id,Di,ci,Gn)}}else{const{tileBoundsBuffer:pi,tileBoundsIndexBuffer:Di,tileBoundsSegments:ci}=f.getTileBoundsBuffers(ze);bi.draw(f,z.TRIANGLES,Le,rt,J,Mn.disabled,Un,c.id,pi,Di,ci)}}if(!(H instanceof s.aU)&&M)for(const ge of Te){const ke=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&Lu(!0,ge,f,n,c,$,G,Ae,be||On.disabled),ke&&Lu(!1,ge,f,n,c,$,G,Ae===Mn.frontCW?Mn.backCW:Mn.frontCW,be||On.disabled)}};M?Ie(fe,f.renderElevatedRasterBackface?Mn.backCW:Mn.frontCW,f.stencilModeFor3D()):Ie(fe,Mn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,c,p,x,b){f.renderPass==="offscreen"&&(function(E,I,M,O){if(!O.length)return;const z=E.context,H=z.gl,G=I.getSource();if(!(G instanceof sa))return;const $=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let J=M.particlePositionRGBAImage;if(!J||J.width!==$){const fe=(function(ue){const Ie=ue*ue,Te=new Uint8Array(4*Ie),Ae=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},be=.9090909090909091;for(let ge=0;ge<Ie;ge++){const ke=be*(Ae(2*ge+0)+xh),ze=be*(Ae(2*ge+1)+xh),je=255*ke%1,Xe=255*ze%1,Ze=je,ut=ze-Xe/255,xt=Xe;Te[4*ge+0]=255*(ke-je/255),Te[4*ge+1]=255*Ze,Te[4*ge+2]=255*ut,Te[4*ge+3]=255*xt}return Te})($);J=M.particlePositionRGBAImage=new s.q({width:$,height:$},fe)}let K=M.particleFramebuffer;K?K.width!==$&&(K.destroy(),K=M.particleFramebuffer=z.createFramebuffer($,$,1,null)):K=M.particleFramebuffer=z.createFramebuffer($,$,1,null);const ee=[];for(const fe of O){const ue=I.getTile(fe);if(!(ue instanceof Oc))continue;const Ie=Vf(ue,G,M);if(!Ie)continue;const Te=[ue.tileSize,ue.tileSize];let Ae=M.tileFramebuffer;Ae||(Ae=M.tileFramebuffer=z.createFramebuffer(Te[0],Te[1],1,null));let be=ue.rasterParticleState;be||(be=ue.rasterParticleState=new Ff(z,fe,Te,J));const ge=be.update(M.lastInvalidatedAt);be.particleTextureDimension!==$&&be.updateParticleTexture(fe,J);const ke=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=ke;const ze=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=ze,ee.push([fe,Ie,be,ge])}if(ee.length===0)return;const re=s.o.now(),pe=M.previousDrawTimestamp?.001*(re-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=re,M.hasColorMap()){z.activeTexture.set(H.TEXTURE0+2);let fe=M.colorRampTexture;fe||(fe=M.colorRampTexture=new s.T(z,M.colorRamp,H.RGBA8)),fe.bind(H.LINEAR,H.CLAMP_TO_EDGE)}z.bindFramebuffer.set(M.tileFramebuffer.framebuffer),(function(fe,ue,Ie){const Te=fe.context,Ae=Te.gl,be=ue.tileFramebuffer;Te.activeTexture.set(Ae.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(ze=ue.paint.get("raster-particle-fade-opacity-factor"))/(ze+.05)},ke=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ze;for(const je of Ie){const[,,Xe,Ze]=je;be.colorAttachment0.set(Xe.targetColorTexture.texture),Te.viewport.set([0,0,be.width,be.height]),Te.clear({color:s.ao.transparent}),Ze&&(Xe.backgroundColorTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE),ke.draw(fe,Ae.TRIANGLES,mn.disabled,On.disabled,zn.alphaBlended,Mn.disabled,ge,ue.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}})(E,M,ee),(function(fe,ue,Ie,Te){const Ae=fe.context,be=Ae.gl,ge=Ie.tileFramebuffer,ke=fe.transform.projection.name==="globe",ze=Ie.paint.get("raster-particle-max-speed");for(const je of Te){const[Xe,Ze,ut]=je;Ae.activeTexture.set(be.TEXTURE0+0),Ze.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),ge.colorAttachment0.set(ut.targetColorTexture.texture);const xt=fe.getOrCreateProgram("rasterParticleDraw",{defines:Ze.defines,overrideFog:!1});Ae.activeTexture.set(be.TEXTURE0+1);const et=Ze.scalarData?[]:[0,1,2,3].map(rt=>s.e9[rt](Xe));et.push(Xe);const Le=Xe.canonical.x,mt=Xe.canonical.y;for(const rt of et){const yt=ue.getTile(ke?rt.wrapped():rt);if(!yt)continue;const kt=yt.rasterParticleState;if(!kt)continue;const qt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-Xe.wrap),zt=rt.canonical.y;kt.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Lt=vh(1,kt.particleTexture0.size[0],[qt-Le,zt-mt],0,Ze.texture.size,2,ze,Ze.textureOffset,Ze.scale,Ze.offset);xt.draw(fe,be.POINTS,mn.disabled,On.disabled,zn.alphaBlended,Mn.disabled,Lt,Ie.id,kt.particleIndexBuffer,void 0,kt.particleSegment)}}})(E,I,M,ee),z.bindFramebuffer.set(M.particleFramebuffer.framebuffer),(function(fe,ue,Ie,Te){const Ae=fe.context,be=Ae.gl,ge=ue.paint.get("raster-particle-max-speed"),ke=Te*ue.paint.get("raster-particle-speed-factor")*.15,ze=(function(Xe){return Math.pow(Xe,6)})(.01+1*ue.paint.get("raster-particle-reset-rate-factor")),je=ue.particleFramebuffer;Ae.viewport.set([0,0,je.width,je.height]);for(const Xe of Ie){const[,Ze,ut]=Xe;Ae.activeTexture.set(be.TEXTURE0+0),Ze.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ae.activeTexture.set(be.TEXTURE0+1);const xt=ut.particleTexture0;xt.bind(be.NEAREST,be.CLAMP_TO_EDGE);const et=Fp(1,xt.size[0],0,Ze.texture.size,ge,ke,ze,Ze.textureOffset,Ze.scale,Ze.offset);je.colorAttachment0.set(ut.particleTexture1.texture),Ae.clear({color:s.ao.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:Ze.defines}).draw(fe,be.TRIANGLES,mn.disabled,On.disabled,zn.unblended,Mn.disabled,et,ue.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}})(E,M,ee,pe)})(f,n,c,p),f.renderPass==="translucent"&&((function(E,I,M,O){const z=E.context,H=z.gl,G=I.getSource().tileSize,$=5*(1-s.ah(s.cL,s.cL+1,E.transform.zoom))*G+M.paint.get("raster-particle-elevation"),J=!E.options.moving,K=E.transform.projection.name==="globe";if(!O.length)return;const[ee,re]=E.stencilConfigForOverlap(O),pe=[];K&&pe.push("PROJECTION_GLOBE_VIEW");const fe=E.stencilModeFor3D();for(const ue of re){const Ie=ue.toUnwrapped(),Te=I.getTile(ue);if(!Te.rasterParticleState)continue;const Ae=Te.rasterParticleState,be=100;Te.registerFadeDuration(be);const ge=I.findLoadedParent(ue,0),ke=If(Te,ge,I,E.transform,be);let ze,je;E.terrain&&E.terrain.prepareDrawTile(),z.activeTexture.set(H.TEXTURE0),Ae.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),z.activeTexture.set(H.TEXTURE1),ge&&ge.rasterParticleState?(ge.rasterParticleState.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),ze=Math.pow(2,ge.tileID.overscaledZ-Te.tileID.overscaledZ),je=[Te.tileID.canonical.x*ze%1,Te.tileID.canonical.y*ze%1]):Ae.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Xe=K?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ie,J),Ze=E.transform,ut=Gp(Ze),xt=s.dG(ue.canonical),et=s.dH(xt.getCenter().lat);let Le,mt,rt,yt,kt;K?(Le=Float32Array.from(s.bk(s.dJ(ue.canonical))),mt=Float32Array.from(Ze.globeMatrix),rt=Float32Array.from(s.dF(Ze)),yt=[s.aF(Ze.center.lng),s.aJ(Ze.center.lat)],kt=Float32Array.from(s.dI(ue.canonical,xt,et,Ze.worldSize/Ze._pixelsPerMercatorPixel))):(Le=new Float32Array(16),mt=new Float32Array(9),rt=new Float32Array(16),yt=[0,0],kt=new Float32Array(9));const qt=I_(Xe,Le,mt,rt,kt,je||[0,0],s.aj(E.transform.zoom),yt,ut,ze||1,ke,$),zt=E.isTileAffectedByFog(ue),Lt=E.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:zt});if(E.uploadCommonUniforms(z,Lt,Ie),K){const un=new mn(H.LEQUAL,mn.ReadOnly,E.depthRangeFor3D),an=0,Zt=E.globeSharedBuffers;if(Zt){const[on,xn,Dn]=Zt.getGridBuffers(et,an!==0);Lt.draw(E,H.TRIANGLES,un,fe,zn.alphaBlended,E.renderElevatedRasterBackface?Mn.frontCCW:Mn.backCCW,qt,M.id,on,xn,Dn)}}else{const un=E.depthModeForSublayer(0,mn.ReadOnly),an=ee[ue.overscaledZ],{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:on,tileBoundsSegments:xn}=E.getTileBoundsBuffers(Te);Lt.draw(E,H.TRIANGLES,un,an,zn.alphaBlended,Mn.disabled,qt,M.id,Zt,on,xn)}}E.resetStencilClippingMasks()})(f,n,c,p),f.style.map.triggerRepaint())},background:function(f,n,c,p){const x=c.paint.get("background-color"),b=c.paint.get("background-color-use-theme").constantOr("default")==="none",E=c.paint.get("background-opacity"),I=c.paint.get("background-emissive-strength"),M=c.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const O=f.context,z=O.gl,H=f.transform,G=H.tileSize,$=c.paint.get("background-pattern");let J;if($!==void 0&&($===null||(J=f.imageManager.getPattern(s.I.from($.toString()),c.scope,f.style.getLut(c.scope)),!J)))return;const K=!$&&x.a===1&&E===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==K)return;const ee=On.disabled,re=f.depthModeForSublayer(0,K==="opaque"?mn.ReadWrite:mn.ReadOnly),pe=f.colorModeForDrapableLayerRenderPass(I),fe=$?"backgroundPattern":"background";let ue,Ie=p;Ie||(ue=f.getBackgroundTiles(),Ie=Object.values(ue).map(Ae=>Ae.tileID)),$&&(O.activeTexture.set(z.TEXTURE0),f.imageManager.bind(f.context,c.scope));const Te=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Te.push("USE_MRT1"),M){const Ae=f.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0,defines:Te}),be=new Float32Array(s.bA([])),ge=new s.aQ(0,0,0,0,0),ke=$?Ma(be,I,E,f,0,c.scope,J,M,{tileID:ge,tileSize:G}):xc(be,I,E,x.toPremultipliedRenderColor(b?null:c.lut));return void Ae.draw(f,z.TRIANGLES,re,ee,pe,Mn.disabled,ke,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}for(const Ae of Ie){const be=f.isTileAffectedByFog(Ae),ge=f.getOrCreateProgram(fe,{overrideFog:be,defines:Te}),ke=Ae.toUnwrapped(),ze=p?Ae.projMatrix:f.transform.calculateProjMatrix(ke);f.prepareDrawTile();const je=n?n.getTile(Ae):ue?ue[Ae.key]:new Ao(Ae,G,H.zoom,f),Xe=$?Ma(ze,I,E,f,0,c.scope,J,M,{tileID:Ae,tileSize:G}):xc(ze,I,E,x.toPremultipliedRenderColor(b?null:c.lut));f.uploadCommonUniforms(O,ge,ke);const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:ut,tileBoundsSegments:xt}=f.getTileBoundsBuffers(je);ge.draw(f,z.TRIANGLES,re,ee,pe,Mn.disabled,Xe,c.id,Ze,ut,xt)}},sky:function(f,n,c){const p=f._atmosphere?s.aj(f.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const b=f.context,E=c.paint.get("sky-type"),I=new mn(b.gl.LEQUAL,mn.ReadOnly,[0,1]),M=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&((function(O,z){const H=O.context,G=H.gl;let $=z.skyboxFbo;if(!$){$=z.skyboxFbo=H.createFramebuffer(32,32,1,null),z.skyboxGeometry=new Za(H),z.skyboxTexture=H.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,z.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let re=0;re<6;++re)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}H.bindFramebuffer.set($.framebuffer),H.viewport.set([0,0,32,32]);const J=z.getCenter(O,!0),K=O.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);s.bA(ee),s.en(ee,ee,.5*-Math.PI),tu(O,z,K,ee,J,0),s.bA(ee),s.en(ee,ee,.5*Math.PI),tu(O,z,K,ee,J,1),s.bA(ee),s.cU(ee,ee,.5*-Math.PI),tu(O,z,K,ee,J,2),s.bA(ee),s.cU(ee,ee,.5*Math.PI),tu(O,z,K,ee,J,3),s.bA(ee),tu(O,z,K,ee,J,4),s.bA(ee),s.en(ee,ee,Math.PI),tu(O,z,K,ee,J,5),H.viewport.set([0,0,O.width,O.height])})(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&(function(O,z,H,G,$){const J=O.context,K=J.gl,ee=O.transform,re=O.getOrCreateProgram("skybox");J.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,z.skyboxTexture);const pe=((fe,ue,Ie,Te,Ae)=>({u_matrix:fe,u_sun_direction:ue,u_cubemap:0,u_opacity:Te,u_temporal_offset:Ae}))(ee.skyboxMatrix,z.getCenter(O,!1),0,G,$);O.uploadCommonUniforms(J,re),re.draw(O,K.TRIANGLES,H,On.disabled,O.colorModeForRenderPass(),Mn.backCW,pe,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(f,c,I,x,M):E==="gradient"&&f.renderPass==="sky"&&(function(O,z,H,G,$){const J=O.context,K=J.gl,ee=O.transform,re=O.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Za(J)),J.activeTexture.set(K.TEXTURE0);let pe=z.colorRampTexture;pe||(pe=z.colorRampTexture=new s.T(J,z.colorRamp,K.RGBA8)),pe.bind(K.LINEAR,K.CLAMP_TO_EDGE);const fe=((ue,Ie,Te,Ae,be)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:Ie,u_radius:s.an(Te),u_opacity:Ae,u_temporal_offset:be}))(ee.skyboxMatrix,z.getCenter(O,!1),z.paint.get("sky-gradient-radius"),G,$);O.uploadCommonUniforms(J,re),re.draw(O,K.TRIANGLES,H,On.disabled,O.colorModeForRenderPass(),Mn.backCW,fe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(f,c,I,x,M)},custom:function(f,n,c,p){const x=f.context,b=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(n)){if(f.renderPass==="offscreen"){const E=b.prerender;if(E){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;E.call(b,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else E.call(b,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=b.renderToTile;if(I){const M=p[0].canonical,O={x:M.x+p[0].wrap*(b.wrapTileId?0:1<<M.z),y:M.y,z:M.z};x.setDepthMode(mn.disabled),x.setStencilMode(On.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(b,x.gl,O),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(On.disabled);const E=b.renderingMode==="3d"?new mn(f.context.gl.LEQUAL,mn.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,mn.ReadOnly);if(x.setDepthMode(E),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;b.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else b.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,c,p){if(f.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1),b=c.paint.get("model-elevation-reference"),E=b==="ground",I=b==="ground";if(x===0)return;const M=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!M||f.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const O=f.shadowRenderer,z=c.paint.get("model-receive-shadows");O&&(O.useNormalOffset=!0,z||(O.enabled=!1));const H=()=>{O&&(O.useNormalOffset=!0,z||(O.enabled=!0))},G=n.getSource();if(f.renderPass==="light-beam"&&G.type!=="batched-model")return;if(G.type==="vector"||G.type==="geojson")return(function(ue,Ie,Te,Ae,be){const ge=ue.transform,ke=ge.projection.name==="globe",ze=ge.getFreeCameraOptions().position;if(!ue.modelManager)return;const je=ue.modelManager;Te.modelManager=je;const Xe=ue.shadowRenderer;if(!Te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ze=Te._unevaluatedLayout._values["model-id"],ut=Object.assign({},Te.layout.get("model-id").parameters),xt=ue.style.order.indexOf(Te.fqid),et=Te.paint.get("model-opacity").constantOr(1);for(const Le of Ae){const mt=Ie.getTile(Le).getBucket(Te);if(!mt||mt.projection.name!==ge.projection.name)continue;const rt=mt.getModelUris();if(rt&&!mt.modelsRequested&&(je.addModelsFromBucket(rt,be),mt.modelsRequested=!0),ke)ut.zoom=Le.overscaledZ;else{const Zt=Nt(Le,ge);ut.zoom=Zt}const yt=Ze.possiblyEvaluate(ut);if(zu(ue,mt,Le),ka.shadowUniformsInitialized=!1,ka.useSingleShadowCascade=!!Xe&&Xe.getMaxCascadeForTile(Le.toUnwrapped())===0,ue.renderPass==="shadow"&&Xe){if(ue.currentShadowCascade===1&&mt.isInsideFirstShadowMapFrustum)continue;const Zt=ge.calculatePosMatrix(Le.toUnwrapped(),ge.worldSize);if(ka.tileMatrix.set(Zt),ka.shadowTileMatrix=Float32Array.from(Xe.calculateShadowPassMatrixFromMatrix(Zt)),ka.aabb.min=[0,0,0],ka.aabb.max[0]=ka.aabb.max[1]=s.al,ka.aabb.max[2]=0,br(mt,ka,ue,Te.scope))continue}const kt=1<<Le.canonical.z,qt=[((ze.x-Le.wrap)*kt-Le.canonical.x)*s.al,(ze.y*kt-Le.canonical.y)*s.al,ze.z*kt*s.al];ue.conflationActive&&Object.keys(mt.instancesPerModel).length>0&&ue.style.isLayerClipped(Te,Ie.getSource())&&mt.updateReplacement(Le,ue.replacementSource,xt,Te.scope)&&(mt.uploaded=!1,mt.upload(ue.context));let zt=0;const Lt=new Array,un=new Array,an=new Array;for(let Zt in mt.instancesPerModel){const on=mt.instancesPerModel[Zt];on.features.length>0&&!ke&&(Zt=yt.evaluate(on.features[0].feature,{}));const xn=je.getModel(Zt,be);if(xn||je.hasURLBeenRequested(Zt)||mt.modelUris.includes(Zt)||(mt.modelUris.push(Zt),mt.modelsRequested=!1),xn&&xn.uploaded)if(ke){const Dn=s.c5([],[ze.x,ze.y,ze.z],ue.transform.worldSize);s.ew(Dn,Dn);for(let jn=0;jn<on.instancedDataArray.length;++jn){const ni=[0,0,0],Pn=[1,1,1],Un=s.ex(),Nn=on.tileCoordinatesForInstance(jn),bi=on.transformForInstance(jn);s.ey(Pn,bi),s.ez(Un,bi),s.eA(ni,Un);const pi=on.translationForInstance(jn),Di=new s.aT(0,0);s.eB(mt.canonical,Di,Nn.x,Nn.y);const ci=s.bC();s.eC(ci,xn,ue.transform,Di,ni,Pn,pi,!0,!1,!1);const Gn=on.colorForInstance(jn),_i=s.bA([]),pr=s.ef(Di.lat,ue.transform.zoom),Pi=s.bq([],[1,1,1/pr]);s.br(_i,_i,Dn),an.push({zScaleMatrix:Pi,negCameraPosMatrix:_i});for(const Si of xn.nodes)Ah(ue,Si,ci,ue.transform.expandedFarZProjMatrix,zt,Lt,un,xn.materialOverrides,et,Gn);++zt}}else for(const Dn of xn.nodes)Xt(ue,Te,Dn,on,qt,Le,ka)}if(ke)if(ue.renderPass==="shadow"){for(const Zt of un)Id(Zt.mesh,Zt.nodeModelMatrix,ue,Te);for(const Zt of Lt)Id(Zt.mesh,Zt.nodeModelMatrix,ue,Te)}else Xp(ue,Te,Lt,un,an)}})(f,n,c,p,Ad(f,c)),void H();if(!G.loaded())return;if(G.type==="batched-model")return(function(ue,Ie,Te,Ae){Te.resetLayerRenderingStats(ue);const be=ue.context,ge=ue.transform,ke=ue.style.fog,ze=ue.shadowRenderer;if(ge.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const je=ue.transform.getFreeCameraOptions().position,Xe=s.c5([],[je.x,je.y,je.z],ue.transform.worldSize),Ze=s.ew([],Xe),ut=s.bA([]),xt=s.ef(ge.center.lat,ge.zoom),et=s.bq([],[1,1,1/xt]);s.br(ut,ut,Ze);const Le=Te.paint.get("model-opacity").constantOr(1),mt=new mn(be.gl.LEQUAL,mn.ReadWrite,ue.depthRangeFor3D),rt=new mn(be.gl.LEQUAL,mn.ReadOnly,ue.depthRangeFor3D),yt=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),kt=ue.renderPass==="shadow",qt=kt&&ze?ze.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),zt=Te.paint.get("model-front-cutoff"),Lt=zt[2]<1,un=Yo(ue,Te.paint.get("model-cutoff-fade-range")),an=Te.getLayerRenderingStats();(function(Zt,on,xn,Dn){const jn=Zt.terrain?Zt.terrain.exaggeration():0,ni=Zt.transform.zoom;for(const Pn of Dn){const Un=on.getTile(Pn).getBucket(xn);Un&&(Un.setFilter(xn.filter),Zt.conflationActive&&Un.updateReplacement(Pn,Zt.replacementSource),Un.evaluateTransform(Zt,xn),Zt.terrain&&jn>0&&Un.elevationUpdate(Zt.terrain,jn,Pn,xn.source),Un.needsReEvaluation(Zt,ni,xn)&&Un.evaluate(xn))}})(ue,Ie,Te,Ae),(function(){let Zt,on,xn;Lt?(Zt=Ae.length-1,on=-1,xn=-1):(Zt=0,on=Ae.length,xn=1);const Dn=new Float64Array(16),jn=s.cA(),ni=new s.P(0,0);for(let Pn=Zt;Pn!==on;Pn+=xn){const Un=Ae[Pn],Nn=Ie.getTile(Un).getBucket(Te);if(!Nn||!Nn.uploaded)continue;let bi=!1;ze&&(bi=ze.getMaxCascadeForTile(Un.toUnwrapped())===0);const pi=ge.calculatePosMatrix(Un.toUnwrapped(),ge.worldSize),Di=Nn.modelTraits;!kt&&Lt&&(s.bl(Dn,pi),s.af(jn,Xe,Dn),ni.x=jn[0],ni.y=jn[1]);const ci=[];Nn.setFilter(Te.filter);for(const Gn of Nn.getNodesInfo()){if(Gn.hiddenByReplacement||!Gn.node.meshes)continue;const _i=Gn.node;let pr=0;ue.terrain&&_i.elevation&&(pr=_i.elevation*ue.terrain.exaggeration());const Pi=(()=>{const Ai=Gn.aabb;return yt.min=[...Ai.min],yt.max=[...Ai.max],yt.min[2]+=pr,yt.max[2]+=pr,s.af(yt.min,yt.min,pi),s.af(yt.max,yt.max,pi),yt})(),Si=Gn.evaluatedScale;if(Si[0]<=1&&Si[1]<=1&&Si[2]<=1&&Pi.intersects(qt)===0)continue;if(!kt&&Lt){const Ai=.16666666666666666;Gn.cameraCollisionOpacity=Xe[0]>Pi.min[0]&&Xe[0]<Pi.max[0]&&Xe[1]>Pi.min[1]&&Xe[1]<Pi.max[1]&&Xe[2]*xt<Pi.max[2]&&_i.footprint&&s.c0(ni,_i.footprint)?Math.max(Gn.cameraCollisionOpacity-Ai,0):Math.min(1,Gn.cameraCollisionOpacity+Ai)}const Fn=[...pi],Hn=1/s.d7(Un.canonical),Ki=_i.anchor?_i.anchor[0]:0,Lr=_i.anchor?_i.anchor[1]:0;s.br(Fn,Fn,[Ki*(Si[0]-1)+Gn.evaluatedTranslation[0]*Hn,Lr*(Si[1]-1)+Gn.evaluatedTranslation[1]*Hn,pr+Gn.evaluatedTranslation[2]]),s.cq(Si,s.eE)||s.cS(Fn,Fn,Si);const Bi=s.aB([],Fn,_i.globalMatrix),Qi=s.aB([],ge.expandedFarZProjMatrix,Bi),wa=s.aB([],ge.expandedFarZProjMatrix,Fn),Qs=s.aC([],[Ki,Lr,pr,1],Qi)[2];_i.hidden=!1;let ks=Le;kt||(Lt&&(ks*=Gn.cameraCollisionOpacity,ks*=dg(Fn,ge,Gn.aabb,zt)),ks*=We(un,Qs)),ks!==0?ci.push({nodeInfo:Gn,depth:Qs,opacity:ks,wvpForNode:Qi,wvpForTile:wa,nodeModelMatrix:Bi,tileModelMatrix:Fn}):_i.hidden=!0}kt||ci.sort((Gn,_i)=>!Lt||Gn.opacity===1&&_i.opacity===1?Gn.depth<_i.depth?-1:1:Gn.opacity===1?-1:_i.opacity===1?1:Gn.depth>_i.depth?-1:1);for(const Gn of ci){const _i=Gn.nodeInfo,pr=_i.node;let Pi=s.aB([],et,Gn.tileModelMatrix);s.aB(Pi,ut,Pi);const Si=s.bl([],Pi);s.eg(Si,Si),s.cS(Si,Si,Ih),Pi=s.aB(Pi,Pi,pr.globalMatrix);const Fn=ue.renderPass==="light-beam",Hn=Te.paint.get("model-color-use-theme").constantOr("default")==="none",Ki=Di&s.eI.HasMapboxMeshFeatures,Lr=Ki?0:_i.evaluatedRMEA[0][2];for(let Bi=0;Bi<pr.meshes.length;++Bi){const Qi=pr.meshes[Bi],wa=Bi===pr.lightMeshIndex;let Qs=Gn.wvpForNode;if(wa){if(!Fn&&!ue.terrain&&ue.shadowRenderer){ue.currentLayer<ue.firstLightBeamLayer&&(ue.firstLightBeamLayer=ue.currentLayer);continue}Qs=Gn.wvpForTile}else if(Fn)continue;const ks={defines:[]},Ai=[];if(!kt&&ze&&(ze.useNormalOffset=!!Qi.normalBuffer),No(ks.defines,Ai,Qi,ue,Hn?null:Te.lut),Ki||ks.defines.push("DIFFUSE_SHADED"),bi&&ks.defines.push("SHADOWS_SINGLE_CASCADE"),an&&(kt?an.numRenderedVerticesInShadowPass+=Qi.vertexArray.length:an.numRenderedVerticesInTransparentPass+=Qi.vertexArray.length),kt){Id(Qi,Gn.nodeModelMatrix,ue,Te);continue}let fo=null;if(ke){const Jr=Wp(Gn.nodeModelMatrix,ue.transform);if(fo=new Float32Array(Jr),ge.projection.name!=="globe"){const rr=Qi.aabb.min,ss=Qi.aabb.max,[Rs,Ar]=ke.getOpacityForBounds(Jr,rr[0],rr[1],ss[0],ss[1]);ks.overrideFog=Rs>=tn||Ar>=tn}}const Js=Qi.material;let la;Js.occlusionTexture&&Js.occlusionTexture.offsetScale&&(la=Js.occlusionTexture.offsetScale,ks.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const jo=ue.getOrCreateProgram("model",ks);!kt&&ze&&ze.setupShadowsFromMatrix(Gn.tileModelMatrix,jo,ze.useNormalOffset),ue.uploadCommonUniforms(be,jo,null,fo);const Wa=Js.pbrMetallicRoughness;Wa.metallicFactor=.9,Wa.roughnessFactor=.5;const wr=jl(new Float32Array(Qs),new Float32Array(Pi),new Float32Array(Si),new Float32Array(pr.globalMatrix),ue,Gn.opacity,Wa.baseColorFactor,Js.emissiveFactor,Wa.metallicFactor,Wa.roughnessFactor,Js,Lr,Te,[0,0,0],la);!wa&&(_i.hasTranslucentParts||Gn.opacity<1)&&jo.draw(ue,be.gl.TRIANGLES,mt,On.disabled,zn.disabled,Mn.backCCW,wr,Te.id,Qi.vertexBuffer,Qi.indexBuffer,Qi.segments,Te.paint,ue.transform.zoom,void 0,Ai),jo.draw(ue,be.gl.TRIANGLES,wa?rt:mt,On.disabled,wa||Gn.opacity<1||_i.hasTranslucentParts?zn.alphaBlended:zn.unblended,Mn.backCCW,wr,Te.id,Qi.vertexBuffer,Qi.indexBuffer,Qi.segments,Te.paint,ue.transform.zoom,void 0,Ai)}}}})()})(f,n,c,p),void H();if(G.type!=="model")return;const $=G.getModels(),J=[],K=f.transform.getFreeCameraOptions().position,ee=s.c5([],[K.x,K.y,K.z],f.transform.worldSize);s.ew(ee,ee);const re=[],pe=[];let fe=0;for(const ue of $){const Ie=n.getFeatureState("",ue.id),Te={type:"Unknown",id:ue.id,properties:ue.featureProperties},Ae=c.paint.get("model-rotation").evaluate(Te,Ie),be=c.paint.get("model-scale").evaluate(Te,Ie),ge=c.paint.get("model-translation").evaluate(Te,Ie),ke=c.paint.get("model-opacity").evaluate(Te,Ie);ug(c,ue.id,Ie,ue.featureProperties,ue.nodeOverrideNames,ue.nodeOverrides),hg(c,ue.id,Ie,ue.featureProperties,ue.materialOverrideNames,ue.materialOverrides),ue.nodeOverrides.size>0&&ue.computeBoundsAndApplyParent(),ue.computeModelMatrix(f,Ae,be,ge,I,E,!1);const ze=s.bA([]),je=s.ef(ue.position.lat,f.transform.zoom),Xe=s.bq([],[1,1,1/je]);s.br(ze,ze,ee),J.push({zScaleMatrix:Xe,negCameraPosMatrix:ze});for(const Ze of ue.nodes)Ah(f,Ze,ue.matrix,f.transform.expandedFarZProjMatrix,fe,re,pe,ue.materialOverrides,ke);fe++}if(re.sort((ue,Ie)=>Ie.depth-ue.depth),f.renderPass!=="shadow")Xp(f,c,re,pe,J),H();else{for(const ue of pe)Id(ue.mesh,ue.nodeModelMatrix,f,c);for(const ue of re)Id(ue.mesh,ue.nodeModelMatrix,f,c);H()}}},Qp={line:function(f,n,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const x of p){const b=n.getTile(x).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,c){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Ad(c,f)));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const b of x)b.upload(c.context)},raster:function(f,n,c){const p=n.getSource();if(!(p instanceof sa&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(x);if(b==null)return;const E=n.getIds().map(I=>n.getTileByID(I));for(const I of E)I.updateNeeded(f.id,b)&&p.prepareTile(I,x,f.id,b)},"raster-particle":function(f,n,c){const p=n.getSource();if(!(p instanceof sa&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(b==null)return;const E=n.getIds().map(I=>n.getTileByID(I));for(const I of E)I.updateNeeded(f.id,b)&&p.prepareTile(I,x,f.id,b)}},Zf={fill:ng},mg={fill:function(f,n,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const x=f.context.gl,b=new mn(x.LEQUAL,mn.ReadOnly,f.depthRangeFor3D),E=new On({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),I=f.transform.getFreeCameraOptions().position,M=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const O of p){const z=n.getTile(O),H=z.getBucket(c);if(!H)continue;const G=H.elevatedStructures;if(!G||G.depthSegments.segments[0].primitiveLength===0)continue;const $=Pu(O.toUnwrapped(),I),J=f.translatePosMatrix(O.projMatrix,z,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),K=Ru(J,$,0,1,0);M.draw(f,x.TRIANGLES,b,E,zn.disabled,Mn.disabled,K,c.id,G.vertexBuffer,G.indexBuffer,G.depthSegments,c.paint,f.transform.zoom)}}};class Jp{constructor(n,c,p,x,b){this.context=new _l(n,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of E)this._debugParams.enabledLayers[M]=!0;for(const M of E);this.occlusionParams=new Kp,this.setup(),this.numSublayers=hs.maxUnderzooming+hs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _f(this),this._wireframeDebugCache=new Uf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(n,c){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vd(this,n));const x=this._terrain;this.transform.elevation=p?x:null,x.update(n,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const b=p+.78*(x-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new vd(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,c){if(this.width=n*s.o.devicePixelRatio,this.height=c*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(c,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const p=new s.bd;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(p,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const x=new s.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const b=new s.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(s.al,0,s.al,0),b.emplaceBack(0,s.al,0,s.al),b.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const E=new s.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E);const I=new s.be;for(const O of[0,1,3,2,0])I.emplaceBack(O);this.debugIndexBuffer=n.createIndexBuffer(I),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bC();const M=this.context.gl;this.stencilClearMode=new On({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,mn.disabled,this.stencilClearMode,zn.disabled,Mn.disabled,xd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,p){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const x=this.context,b=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(zn.disabled),x.setDepthMode(mn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const M=c.getTile(I),O=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:G}=this.getTileBoundsBuffers(M);E.draw(this,b.TRIANGLES,mn.disabled,new On({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),zn.disabled,Mn.disabled,xd(I.projMatrix),"$clipping",z,H,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new On({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new On({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,p=n.sort((E,I)=>I.overscaledZ-E.overscaledZ),x=p[p.length-1].overscaledZ,b=p[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let I=0;I<b;I++)E[I+x]=new On({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[E,p]}return[{[x]:On.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new zn([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}colorModeForDrapableLayerRenderPass(n){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?n!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new zn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new zn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(n,c,p,x=!1){if(this.depthOcclusion)return new mn(this.context.gl.GREATER,mn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return mn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new mn(p||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new vc(this.context,c,p,0,"texture"),this.depthTexture=new s.T(this.context,{width:c,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,c,p,0,0,c,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,c)=>n+c/this._fpsHistory.length,0))}render(n,c){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=c;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(b).filter(et=>{const Le=x[et];return!(Le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Le.type]});let I=E(),M=!1,O=!1,z=null,H=0,G=!1;for(const et of I){const Le=x[et];Le.visibility!=="none"&&(Le.type==="circle"?M=!0:Le.type==="building"?(z=Le,++H):Le.type==="symbol"&&(Le.hasOcclusionOpacityProperties?O=!0:M=!0))}this.updateEmissiveMode();let $=I.map(et=>x[et]);const J=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const et in J){const Le=J[et];Le.used&&(Le.prepare(this.context),Le.getSource().usedInConflation&&++H)}let K=!1;for(const et of $)et.isHidden(this.transform.zoom)||(et.type==="clip"&&(K=!0),this.prepareLayer(et));const ee={},re={},pe={},fe={},ue={};for(const et in J){const Le=J[et];ee[et]=Le.getVisibleCoordinates(),re[et]=ee[et].slice().reverse(),pe[et]=Le.getVisibleCoordinates(!0).reverse(),fe[et]=Le.getShadowCasterCoordinates(),ue[et]=Le.sortCoordinatesByDistance(ee[et])}const Ie=et=>{const Le=this.style.getLayerSourceCache(et);return Le&&Le.used?Le.getSource():null};if(H||K||this._clippingActiveLastFrame){const et=[],Le=[];let mt=0;for(const rt of $)this.isSourceForClippingOrConflation(rt,Ie(rt))&&(et.push(rt),Le.push(mt)),mt++;if(et&&(K||et.length>1)||this._clippingActiveLastFrame){K=!1;const rt=[];for(let yt=0;yt<et.length;yt++){const kt=et[yt],qt=Le[yt],zt=this.style.getLayerSourceCache(kt);if(!zt||!zt.used||!zt.getSource().usedInConflation&&kt.type!=="clip"&&kt.type!=="building")continue;let Lt=s.eQ,un=s.b_.None;const an=[];let Zt=!0;if(kt.type==="building")Lt=s.eS;else if(kt.type==="clip")if(Lt=qt,kt.isHidden(this.transform.zoom))Zt=!1;else{if(!kt.layout){Zt=!1;continue}for(const on of kt.layout.get("clip-layer-types"))un|=on==="model"?s.b_.Model:on==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const on of kt.layout.get("clip-layer-scope"))an.push(on);K=!0}Zt&&rt.push({layer:kt.fqid,cache:zt,order:Lt,clipMask:un,clipScope:an})}this.replacementSource.setSources(rt),G=!0}}this._clippingActiveLastFrame=K,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let et=0;et<$.length;et++){const Le=$[et];if(Le.visibility==="none")continue;const mt=Le.cutoffRange();if(this.longestCutoffRange=Math.max(mt,this.longestCutoffRange),mt>0){const rt=Ie(Le);rt&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom)),Le.minzoom&&(this.minCutoffZoom=Math.max(Le.minzoom,this.minCutoffZoom))}Le.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=et),this._lastOcclusionLayer=et)}const Te=this.style&&this.style.fog;Te?(this._fogVisible=Te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=E(),$=I.map(et=>x[et]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const et in J)for(const Le of ee[et]){let mt={min:0,max:0};this.terrain&&(mt=this.terrain.getMinMaxForTile(Le)||mt),Ae.addShadowReceiver(Le.toUnwrapped(),mt.min,mt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new Rd(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Hf(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ou);const et=this.style.getLayerSourceCache(z);this.buildingTileBorderManager.updateBorders(et,z)}if(!Hi.has(this.context.gl))return;this.renderPass="offscreen";for(const et of $){const Le=n.getLayerSourceCache(et);if(!et.hasOffscreenPass()||et.isHidden(this.transform.zoom))continue;const mt=Le?re[Le.id]:void 0;(et.type==="custom"||et.type==="raster"||et.type==="raster-particle"||et.isSky()||mt&&mt.length)&&this.renderLayer(this,Le,et,mt)}this.depthRangeFor3D=[0,1-($.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,fe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(c.showOverdrawInspector)return s.ao.black;const et=this.style.fog;if(et&&this.transform.projection.supportsFog){const Le=this.style.getLut(et.scope);if(!ke){const mt=et.properties.get("color-use-theme")==="none",rt=et.properties.get("color").toNonPremultipliedRenderColor(mt?null:Le).toArray01();return new s.ao(...rt)}if(ke){const mt=et.properties.get("space-color-use-theme")==="none",rt=et.properties.get("space-color").toNonPremultipliedRenderColor(mt?null:Le).toArray01();return new s.ao(...rt)}}return s.ao.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const et=$[this.currentLayer],Le=n.getLayerSourceCache(et);if(et.isSky())continue;const mt=Le?(et.is3D(b)?ue:re)[Le.id]:void 0;this._renderTileClippingMasks(et,Le,mt),this.renderLayer(this,Le,et,mt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const et=$[this.currentLayer],Le=n.getLayerSourceCache(et);et.isSky()&&this.renderLayer(this,Le,et,Le?re[Le.id]:void 0)}function je(et,Le){let mt;return Le&&(mt=(et.type==="symbol"?pe:et.is3D(b)?ue:re)[Le.id]),mt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const et=$[this.currentLayer];if(et.type==="raster"||et.type==="raster-particle"){const Le=n.getLayerSourceCache(et);this.renderLayer(this,Le,et,je(et,Le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const Xe=Ae?Ae.getGroundShadowLayerIndex():-1;let Ze=!1,ut=-1;for(let et=0;et<I.length;++et){const Le=$[et];Le.isHidden(this.transform.zoom)||Le.is3D(b)&&(ut=et)}O&&ut===-1&&(M=!0);let xt=!1;for(;this.currentLayer<I.length;){const et=$[this.currentLayer],Le=n.getLayerSourceCache(et);if(et.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(et)){if(et.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!xt&&et.is3D(b)&&!b){const mt=this.currentLayer,rt=yt=>{for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const kt=$[this.currentLayer];if(Zf[kt.type]){const qt=this.style.getLayerSourceCache(kt);Zf[kt.type](this,qt,kt,je(kt,qt),yt)}}};rt("initialize"),rt("reset"),this.currentLayer=mt,xt=!0}if(M&&!Ze&&this.terrain&&!this.transform.isOrthographic&&(Ze=!0,this.blitDepth()),O&&ut!==-1&&this.currentLayer===ut+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(et,Le,Le?ee[Le.id]:void 0),this.renderLayer(this,Le,et,je(et,Le)),!this.terrain&&Ae&&this.currentLayer===Xe){{this.clearStencil(),this.resetStencilClippingMasks();const mt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const rt=$[this.currentLayer];if(mg[rt.type]){const yt=this.style.getLayerSourceCache(rt);mg[rt.type](this,yt,rt,je(rt,yt))}}this.currentLayer=mt}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const mt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=mt;this.currentLayer++){const rt=$[this.currentLayer];if(!rt.hasLightBeamPass())continue;const yt=n.getLayerSourceCache(rt);this.renderLayer(this,yt,rt,yt?re[yt.id]:void 0)}this.currentLayer=mt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const mt=this.currentLayer;this.depthOcclusion=!0;for(const rt of this.layersWithOcclusionOpacity){this.currentLayer=rt;const yt=$[this.currentLayer],kt=n.getLayerSourceCache(yt),qt=kt?re[kt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,kt,kt?ee[kt.id]:void 0),this.renderLayer(this,kt,yt,qt)}this.depthOcclusion=!1,this.currentLayer=mt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let et=null;$.forEach(Le=>{const mt=n.getLayerSourceCache(Le);mt&&!Le.isHidden(this.transform.zoom)&&mt.getVisibleCoordinates().length&&(!et||et.getSource().maxzoom<mt.getSource().maxzoom)&&(et=mt)}),et&&this.options.showTileBoundaries&&rg(this,et,et.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&rg(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(et){const Le=et.transform.padding;sg(et,et.transform.height-(Le.top||0),3,qp),sg(et,Le.bottom||0,3,Hp),ag(et,Le.left||0,3,$p),ag(et,et.transform.width-(Le.right||0),3,R_);const mt=et.transform.centerPoint;(function(rt,yt,kt,qt){jf(rt,yt-1,kt-10,2,20,qt),jf(rt,yt-10,kt-1,20,2,qt)})(et,mt.x,et.transform.height-mt.y,M_)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(n.type);if(Qp[n.type]&&(p||this.terrain&&n.type==="custom")){const x=this.style.getLayerSourceCache(n);Qp[n.type](n,x,this)}this.gpuTimingEnd()}renderLayer(n,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||ql[p.type](n,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const p in n){const x=n[p],b=this.context.extTimerQuery,E=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),c[p]=E}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of n)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(n,c,p,x,b){if(!p[0]&&!p[1])return n;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const O=Math.sin(E),z=Math.cos(E);p=[p[0]*z-p[1]*O,p[0]*O+p[1]*z]}const I=[b?p[0]:s.ay(c,p[0],this.transform.zoom),b?p[1]:s.ay(c,p[1],this.transform.zoom),0],M=new Float32Array(16);return s.br(M,n,I),M}saveTileTexture(n){if(n.context!==this.context)return;const c=n.size[0],p=this._tileTextures[c];p?p.push(n):this._tileTextures[c]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||b.push("FOG"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,b=this.currentGlobalDefines(n,c&&c.overrideFog,c&&c.overrideRtt).concat(p),E=Mf.cacheKey(kp[n],n,b,x);return this.cache[E]||(this.cache[E]=new Mf(this.context,n,kp[n],x,zf[n],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const b=((E,I,M)=>{const O=E.properties.get("direction"),z=E.properties.get("color-use-theme")==="none",H=E.properties.get("color").toNonPremultipliedRenderColor(z?null:M.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),$=I.properties.get("color-use-theme")==="none",J=I.properties.get("color").toNonPremultipliedRenderColor($?null:M.getLut(I.scope)).toArray01(),K=I.properties.get("intensity"),ee=[O.x,O.y,O.z],re=s.dN(J,K),pe=s.dN(H,G);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ee,u_lighting_directional_color:pe,u_ground_radiance:mh(ee,pe,re)}})(p,x,this.style);c.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,c,p,x,b){if(this.uploadCommonLightUniforms(n,c),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const I=E.getOpacity(this.transform.pitch),M=((O,z,H,G,$,J,K,ee,re,pe,fe,ue)=>{const Ie=O.transform,Te=z.properties.get("color-use-theme")==="none",Ae=z.properties.get("color").toNonPremultipliedRenderColor(Te?null:O.style.getLut(z.scope)).toArray01();Ae[3]=G;const be=O.frameCounter/1e3%1,[ge,ke]=z.properties.get("vertical-range");return{u_fog_matrix:H?Ie.calculateFogTileMatrix(H):ue||O.identityMat,u_fog_range:z.getFovAdjustedRange(Ie._fov),u_fog_color:Ae,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,ke),ke],u_fog_temporal_offset:be,u_frustum_tl:$,u_frustum_tr:J,u_frustum_br:K,u_frustum_bl:ee,u_globe_pos:re,u_globe_radius:pe,u_viewport:fe,u_globe_transition:s.aj(Ie.zoom),u_is_globe:+(Ie.projection.name==="globe")}})(this,E,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],x);c.setFogUniformValues(n,M)}b&&c.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=n[x.key]||new Ao(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,c){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[n.key];return c||(this._cachedTileFogOpacities[n.key]=c=this.style.fog.getOpacityForTile(n)),c[0]>=tn||c[1]>=tn}setupDepthForOcclusion(n,c,p){const x=this.context,b=x.gl,E=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),E||c.setTerrainUniformValues(x,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const n=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=n?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function em(f,n){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,n),c=!1)};return()=>(c=!0,p||x(),p)}class La{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=em(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=gg(n);if(this._hashName){const p=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(E=>{const I=E.split("=")[0];return I===p?(x=!0,`${I}=${c}`):E}).filter(E=>E);return x||b.push(`${p}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function gg(f,n){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),E=Math.round(c.lng*b)/b,I=Math.round(c.lat*b)/b,M=f.getBearing(),O=f.getPitch();let z=n?`/${E}/${I}/${p}`:`${p}/${I}/${E}`;return(M||O)&&(z+="/"+Math.round(10*M)/10),O&&(z+=`/${Math.round(O)}`),z}const Fo={linearity:.3,easing:s.eT(0,0,.3,1)},k_=Object.assign({deceleration:2500,maxSpeed:1400},Fo),sr=Object.assign({deceleration:20,maxSpeed:1400},Fo),ti=Object.assign({deceleration:1e3,maxSpeed:360},Fo),Wf=Object.assign({deceleration:1e3,maxSpeed:90},Fo);class iu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=s.o.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const b=Tc(c.pan.mag(),p,Object.assign({},k_,n||{}));x.offset=c.pan.mult(b.amount/c.pan.mag()),x.center=this._map.transform.center,Hl(x,b)}if(c.zoom){const b=Tc(c.zoom,p,sr);x.zoom=this._map.transform.zoom+b.amount,Hl(x,b)}if(c.bearing){const b=Tc(c.bearing,p,ti);x.bearing=this._map.transform.bearing+s.aA(b.amount,-179,179),Hl(x,b)}if(c.pitch){const b=Tc(c.pitch,p,Wf);x.pitch=this._map.transform.pitch+b.amount,Hl(x,b)}if(x.zoom||x.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Hl(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Tc(f,n,c){const{maxSpeed:p,linearity:x,deceleration:b}=c,E=s.aA(f*x/(n/1e3),-p,p),I=Math.abs(E)/(b*x);return{easing:c.easing,duration:1e3*I,amount:E*(I/2)}}class Gs extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p,x={}){const b=Re(c.getCanvasContainer(),p),E=c.unproject(b);super(n,Object.assign({point:b,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class Md extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p){const x=n==="touchend"?p.changedTouches:p.touches,b=Ve(c.getCanvasContainer(),x),E=b.map(M=>c.unproject(M)),I=b.reduce((M,O,z,H)=>M.add(O.div(H.length)),new s.P(0,0));super(n,{points:b,point:I,lngLats:E,lngLat:c.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Xf extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Ds{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Xf(this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Gs(n.type,this._map,n))}mouseup(n){this._map.fire(new Gs(n.type,this._map,n))}preclick(n){const c=new MouseEvent("preclick",n);this._map.fire(new Gs(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Gs(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Gs(n.type,this._map,n))}mouseover(n){this._map.fire(new Gs(n.type,this._map,n))}mouseout(n){this._map.fire(new Gs(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Md(n.type,this._map,n))}touchmove(n){this._map.fire(new Md(n.type,this._map,n))}touchend(n){this._map.fire(new Md(n.type,this._map,n))}touchcancel(n){this._map.fire(new Md(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oa{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Gs(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Gs(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tl{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(Mt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const p=c,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const E=Math.min(x.x,p.x),I=Math.max(x.x,p.x),M=Math.min(x.y,p.y),O=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=I-E+"px",this._box.style.height=O-M+"px")})}mouseupWindow(n,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&n.button===0){if(this.reset(),Oe(),p.x!==x.x||p.y!==x.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),cn(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new s.z(n,{originalEvent:c}))}}function $l(f,n){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=n[p];return c}class Rh{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const b=new s.P(0,0);for(const E of x)b._add(E);return b.div(x.length)})(c),this.touches=$l(p,c)))}touchmove(n,c,p){if(this.aborted||!this.centroid)return;const x=$l(p,c);for(const b in this.touches){const E=x[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,c,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Mh{constructor(n){this.singleTap=new Rh(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,p){this.singleTap.touchstart(n,c,p)}touchmove(n,c,p){this.singleTap.touchmove(n,c,p)}touchend(n,c,p){const x=this.singleTap.touchend(n,c,p);if(x){const b=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Dh{constructor(){this._zoomIn=new Mh({numTouches:1,numTaps:2}),this._zoomOut=new Mh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,p){this._zoomIn.touchstart(n,c,p),this._zoomOut.touchstart(n,c,p)}touchmove(n,c,p){this._zoomIn.touchmove(n,c,p),this._zoomOut.touchmove(n,c,p)}touchend(n,c,p){const x=this._zoomIn.touchend(n,c,p),b=this._zoomOut.touchend(n,c,p);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tm=0,Zl=2,nm={[tm]:1,[Zl]:2},nl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Nu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const p=Je(n);this._correctButton(n,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(n,c){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&(function(x,b){const E=nm[b];return x.buttons===void 0||(x.buttons&E)!==E})(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(n){this._lastPoint&&Je(n)===this._eventButton&&(this._moved&&Oe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dd extends Nu{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class Yf extends Nu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?nl[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=.8*(c.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Kf extends Nu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?nl[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=-.5*(c.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class vs{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,c,p){return this._calculateTransform(n,c,p)}touchmove(n,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,p)}}touchend(n,c,p){this._calculateTransform(n,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,p){p.length>0&&(this._active=!0);const x=$l(p,c),b=new s.P(0,0),E=new s.P(0,0);let I=0;for(const O in x){const z=x[O],H=this._touches[O];H&&(b._add(z),E._add(z.sub(H)),I++,x[O]=z)}if(this._touches=x,I<this._minTouches||!E.mag())return;const M=E.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ph{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,p){return{}}touchstart(n,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,p){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[b,E]=x,I=Bu(p,c,b),M=Bu(p,c,E);if(!I||!M)return;const O=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],O,n)}touchend(n,c,p){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=Bu(p,c,x),I=Bu(p,c,b);E&&I||(this._active&&Oe(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bu(f,n,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return n[p]}function Pd(f,n){return Math.log2(f/n)}class Fu extends Ph{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Pd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pd(this._distance,p),pinchAround:c}}}function kd(f,n){return 180*f.angleWith(n)/Math.PI}class Ld extends Ph{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kd(this._vector,p),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=kd(n,p);return Math.abs(x)<c}}function kh(f){return Math.abs(f.y)>Math.abs(f.x)}class Vu extends Ph{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,kh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,p){const x=this._lastPoints;if(!x)return;const b=n[0].sub(x[0]),E=n[1].sub(x[1]);return this._map._cooperativeGestures&&!s.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(n,c,p){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=c.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=n.y>0==c.y>0;return kh(n)&&kh(c)&&E}}const Qf={panStep:100,bearingStep:15,pitchStep:10};class Od{constructor(){const n=Qf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,p=0,x=0,b=0,E=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),E=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Wl,zoom:c?Math.round(M)+c*(n.shiftKey?2:1):M,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wl(f){return f*(2-f)}const Lh=4.000244140625,_g=1/450;class Jf{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=_g,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%Lh===0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Re(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>Lh?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&z!==0&&(z=1/z);const H=c(),G=Math.pow(2,H),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*z))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,b=this._easing;let E,I=!1;if(this._type==="wheel"&&x&&b){const O=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),z=b(O);E=s.ak(x,p,z),O<1?this._frameId||(this._frameId=!0):I=!0}else E=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-c();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=s.eV;if(this._prevEase){const p=this._prevEase,x=(s.o.now()-p.start)/p.duration,b=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);c=s.eT(E,I,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ec{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class im{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yg{constructor(){this._tap=new Mh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,c,p))}touchmove(n,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,c,p)}touchend(n,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,c,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep{constructor(n,c,p){this._el=n,this._mousePan=c,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zd{constructor(n,c,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ds{constructor(n,c,p,x){this._el=n,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tp=f=>f.zoom||f.drag||f.pitch||f.rotate;class L_ extends s.z{}class xg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const p=s.av([],c,n);this.radius=s.ag(p[2]<0?s.eX([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.eX(n,n,this.constants),s.aw(n,n),s.eY(n,n,this.constants);const c=s.c5([],n,this.radius);if(c[2]>0){const p=s.c5([],[0,0,1],s.bJ(c,[0,0,1])),x=s.c5([],s.aw([],[c[0],c[1],0]),this.radius),b=s.d8([],c,s.c5([],s.av([],s.d8([],x,p),c),2));c[0]=b[0],c[1]=b[1]}return c}}function ru(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class su{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new iu(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,E]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,I,E)}}destroy(){for(const[n,c,p]of this._listeners){const x=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(c,x,p)}}_addDefaultHandlers(n){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Ds(c,n));const x=c.boxZoom=new tl(c,n);this._add("boxZoom",x);const b=new Dh,E=new im;c.doubleClickZoom=new Ec(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const I=new yg;this._add("tapDragZoom",I);const M=c.touchPitch=new Vu(c);this._add("touchPitch",M);const O=new Yf(n),z=new Kf(n);c.dragRotate=new zd(n,O,z),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new Dd(n),G=new vs(c,n);c.dragPan=new ep(p,H,G),this._add("mousePan",H),this._add("touchPan",G,["touchZoom","touchRotate"]);const $=new Ld,J=new Fu;c.touchZoomRotate=new ds(p,J,$,I),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new oa(c));const K=c.scrollZoom=new Jf(c,this);this._add("scrollZoom",K,["mousePan"]);const ee=c.keyboard=new Od;this._add("keyboard",ee);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[re]&&c[re].enable(n[re])}_add(n,c,p){this._handlers.push({handlerName:n,handler:c,allowed:p}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!tp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,p){for(const x in n)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const p of n)this._el.contains(p.target)&&c.push(p);return c}handleEvent(n,c){this._updatingCamera=!0;const p=n.type==="renderFrame",x=p?void 0:n,b={needsRenderFrame:!1},E={},I={},M=n.touches?this._getMapTouches(n.touches):void 0,O=M?Ve(this._el,M):p?void 0:Re(this._el,n);for(const{handlerName:G,handler:$,allowed:J}of this._handlers){if(!$.isEnabled())continue;let K;this._blockedByActive(I,J,G)?$.reset():$[c||n.type]&&(K=$[c||n.type](n,O,M),this.mergeHandlerResult(b,E,K,G,x),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||$.isActive())&&(I[G]=$)}const z={};for(const G in this._previousActiveHandlers)I[G]||(z[G]=x);this._previousActiveHandlers=I,(Object.keys(z).length||ru(b))&&(this._changes.push([b,E,z]),this._triggerRenderFrame()),(Object.keys(I).length||ru(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(n,c,p,x,b){if(!p)return;Object.assign(n,p);const E={handlerName:x,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(c.zoom=E),p.panDelta!==void 0&&(c.drag=E),p.pitchDelta!==void 0&&(c.pitch=E),p.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const n={},c={},p={};for(const[x,b,E]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),Object.assign(c,b),Object.assign(p,E);this._updateMapTransform(n,c,p),this._changes=[]}_updateMapTransform(n,c,p){const x=this._map,b=x.transform,E=pe=>[pe.x,pe.y,pe.z];if((()=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!ru(n)){const pe=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),pe!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!ru(n))return void this._fireEvents(c,p,!0);let{panDelta:I,zoomDelta:M,bearingDelta:O,pitchDelta:z,around:H,aroundCoord:G,pinchAround:$}=n;b._isCameraConstrained&&(M>0&&(M=0),b._isCameraConstrained=!1),$!==void 0&&(H=$),(M||(pe=>c[pe]&&!this._eventsInProgress[pe])("drag"))&&H&&(this._dragOrigin=E(b.pointCoordinate3D(H)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,O&&(b.bearing+=O),z&&(b.pitch+=z),b._updateCameraState();const J=[0,0,0];if(I)if(b.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),fe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(I)).dir);J[0]=fe[0]-pe[0],J[1]=fe[1]-pe[1]}else{const pe=b.pointCoordinate(H);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const fe=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-I.x*s.eW(s.a$(pe.y))*fe,J[1]=-I.y*s.eW(b.center.lat)*fe}else{const fe=b.pointCoordinate(H.sub(I));pe&&fe&&(J[0]=fe.x-pe.x,J[1]=fe.y-pe.y)}}const K=b.zoom,ee=[0,0,0];if(M){const pe=E(G||b.pointCoordinate3D(H)),fe={dir:s.aw([],s.av([],pe,b._camera.position))};if(fe.dir[2]<0){const ue=b.zoomDeltaToMovement(pe,M);s.c5(ee,fe.dir,ue)}}const re=s.d8(J,J,ee);b._translateCameraConstrained(re),M&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,p,!0)}_fireEvents(n,c,p){const x=tp(this._eventsInProgress),b=tp(n),E={};for(const z in n){const{originalEvent:H}=n[z];this._eventsInProgress[z]||(E[`${z}start`]=H),this._eventsInProgress[z]=n[z]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in E)this._fireEvent(z,E[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in n){const{originalEvent:H}=n[z];this._fireEvent(z,H)}const I={};let M;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:G}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],M=c[H]||G,I[`${z}end`]=M)}for(const z in I)this._fireEvent(z,I[z]);const O=tp(this._eventsInProgress);if(p&&(x||b)&&!O){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:M})):(this._map.fire(new s.z("moveend",{originalEvent:M})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new s.z(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new L_("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const rm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vg extends s.E{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},c),p)}panTo(n,c,p){return this.easeTo(Object.assign({center:n},c),p)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,p){return this.easeTo(Object.assign({zoom:n},c),p)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,p){return this.easeTo(Object.assign({bearing:n},c),p)}resetNorth(n,c){return this.rotateTo(0,Object.assign({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=s.aI.convert(n);const p=c&&c.bearing||0,x=c&&c.pitch||0,b=n.getNorthWest(),E=n.getSouthEast();return this._cameraForBounds(this.transform,b,E,p,x,c)}_extendPadding(n){const c={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},c,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},c,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,p,x,b,E){const I=n.clone(),M=this._extendCameraOptions(E);I.bearing=x,I.pitch=b;const O=s.aT.convert(c),z=s.aT.convert(p),H=.5*(O.lat+z.lat),G=.5*(O.lng+z.lng),$=s.eZ(H,G),J=s.aw([],$),K=s.aw([],s.bI([],J,[0,1,0])),ee=s.bI([],K,J),re=[K[0],K[1],K[2],0,ee[0],ee[1],ee[2],0,J[0],J[1],J[2],0,0,0,0,1],pe=[$,s.eZ(O.lat,O.lng),s.eZ(z.lat,O.lng),s.eZ(z.lat,z.lng),s.eZ(O.lat,z.lng),s.eZ(H,O.lng),s.eZ(H,z.lng),s.eZ(O.lat,G),s.eZ(z.lat,G)];let fe=s.d9.fromPoints(pe.map(rt=>[s.bJ(K,rt),s.bJ(ee,rt),s.bJ(J,rt)]));const ue=s.af([],fe.center,re);s.e_(ue)===0&&s.e$(ue,0,0,1),s.aw(ue,ue),s.c5(ue,ue,s.aD),I.center=s.f0(ue);const Ie=I.getWorldToCameraMatrix(),Te=s.bl(new Float64Array(16),Ie);fe=s.d9.applyTransform(fe,s.aB([],Ie,re));const Ae=this._extendAABB(fe,I,M,x);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Ae,s.af(ue,ue,Ie);const be=.5*(fe.max[2]-fe.min[2]),ge=this._minimumAABBFrustumDistance(I,fe),ke=s.c5([],[0,0,1],be),ze=s.d8(ke,ue,ke),je=ge+(I.pitch===0?0:s.bG(ue,ze)),Xe=I.globeCenterInViewSpace,Ze=s.av([],ue,[Xe[0],Xe[1],Xe[2]]);s.aw(Ze,Ze),s.c5(Ze,Ze,je);const ut=s.d8([],ue,Ze);s.af(ut,ut,Te);const xt=s.eM/s.aD,et=s.ag(ut),Le=s.cf(Math.max(et*xt-s.eM,Number.EPSILON),0),mt=Math.min(I.zoomFromMercatorZAdjusted(Le),M.maxZoom);return mt>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=mt,this._cameraForBounds(I,c,p,x,b,E)):{center:I.center,zoom:mt,bearing:x,pitch:b}}_extendAABB(n,c,p,x){const b=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=E,M=b,O=b,z=E,H=c.width-(M+O),G=c.height-(I+z),$=s.av([],n.max,n.min),J=Math.min(H/$[0],G/$[1]),K=Math.min(c.scaleZoom(c.scale*J),p.maxZoom);if(isNaN(K))return null;const ee=c.scale/c.zoomScale(K),re=new s.d9([n.min[0]-M*ee,n.min[1]-z*ee,n.min[2]],[n.max[0]+O*ee,n.max[1]+I*ee,n.max[2]]),pe=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(x));return re.center[0]-=pe.x*ee,re.center[1]+=pe.y*ee,re}queryTerrainElevation(n,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(s.ae.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,p,x,b,E){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,p,x,b,E);const I=n.clone(),M=this._extendCameraOptions(E);I.bearing=x,I.pitch=b;const O=s.aT.convert(c),z=s.aT.convert(p),H=new s.aT(O.lng,z.lat),G=new s.aT(z.lng,O.lat),$=I.project(O),J=I.project(z),K=this.queryTerrainElevation(O),ee=this.queryTerrainElevation(z),re=this.queryTerrainElevation(H),pe=this.queryTerrainElevation(G),fe=[[$.x,$.y,Math.min(K||0,ee||0,re||0,pe||0)],[J.x,J.y,Math.max(K||0,ee||0,re||0,pe||0)]];let ue=s.d9.fromPoints(fe);const Ie=I.getWorldToCameraMatrix(),Te=s.bl(new Float64Array(16),Ie);ue=s.d9.applyTransform(ue,Ie);const Ae=this._extendAABB(ue,I,M,x);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=Ae;const be=.5*s.av([],ue.max,ue.min)[2],ge=this._minimumAABBFrustumDistance(I,ue),ke=[0,0,1,0];s.aC(ke,ke,Ie),s.f1(ke,ke);const ze=s.c5([],ke,ge+be),je=s.d8([],ue.center,ze);s.af(ue.center,ue.center,Te),s.af(je,je,Te);const Xe=I.unproject(new s.P(ue.center[0],ue.center[1])),Ze=s.f2(I.projection,Xe),ut=Math.pow(2,Ze),xt=Math.min(I._zoomFromMercatorZ(je[2]*I.pixelsPerMeter*ut/I.worldSize),M.maxZoom);return I.mercatorFromTransition&&xt<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=xt,this._cameraForBounds(I,c,p,x,b,E)):{center:Xe,zoom:xt,bearing:x,pitch:b}}fitBounds(n,c,p){const x=this.cameraForBounds(n,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(n,c,p,x,b){const E=s.P.convert(n),I=s.P.convert(c),M=new s.P(Math.min(E.x,I.x),Math.min(E.y,I.y)),O=new s.P(Math.max(E.x,I.x),Math.max(E.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,I))return this;const z=this.transform.pointLocation3D(M),H=this.transform.pointLocation3D(O),G=this.transform.pointLocation3D(new s.P(M.x,O.y)),$=this.transform.pointLocation3D(new s.P(O.x,M.y)),J=[Math.min(z.lng,H.lng,G.lng,$.lng),Math.min(z.lat,H.lat,G.lat,$.lat)],K=[Math.max(z.lng,H.lng,G.lng,$.lng),Math.max(z.lat,H.lat,G.lat,$.lat)],ee=x&&x.pitch?x.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,J,K,p,ee,x);return this._fitInternal(re,x,b)}_fitInternal(n,c,p){return n?(c=Object.assign(n,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(n,c){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;"zoom"in n&&p.zoom!==+n.zoom&&(x=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.aT.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(b=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(E=!0,p.pitch=+n.pitch);const I=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(I))if(n.retainPadding===!1){const M=p.clone();M.padding=I,p.setLocationAtPoint(p.center,M.centerPoint)}else p.padding=I;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),x&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),b&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),E&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(rm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(rm),this;this.stop();const x=p.zoom,b=p.pitch,E=p.bearing;p.setFreeCameraOptions(n);const I=x!==p.zoom,M=b!==p.pitch,O=E!==p.bearing;return this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),I&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),O&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),M&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eV},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in n?+n.zoom:x,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:E,H=this._extendPadding(n.padding),G=s.P.convert(n.offset);let $,J,K;if(p.projection.name==="globe"){const ke=s.ae.fromLngLat(p.center),ze=G.rotate(-p.angle);ke.x+=ze.x/p.worldSize,ke.y+=ze.y/p.worldSize;const je=ke.toLngLat(),Xe=s.aT.convert(n.center||je);this._normalizeCenter(Xe),$=p.centerPoint.add(ze),J=new s.P(ke.x,ke.y).mult(p.worldSize),K=new s.P(s.aF(Xe.lng),s.aJ(Xe.lat)).mult(p.worldSize).sub(J)}else{$=p.centerPoint.add(G);const ke=p.pointLocation($),ze=s.aT.convert(n.center||ke);this._normalizeCenter(ze),J=p.project(ke),K=p.project(ze).sub(J)}const ee=p.zoomScale(M-x);let re,pe;n.around&&(re=s.aT.convert(n.around),pe=p.locationPoint(re));const fe=this._zooming||M!==x,ue=this._rotating||b!==O,Ie=this._pitching||z!==E,Te=!p.isPaddingEqual(H),Ae=n.retainPadding===!1?p.clone():p,be=ke=>ze=>{if(fe&&(ke.zoom=s.ak(x,M,ze)),ue&&(ke.bearing=s.ak(b,O,ze)),Ie&&(ke.pitch=s.ak(E,z,ze)),Te&&(Ae.interpolatePadding(I,H,ze),$=Ae.centerPoint.add(G)),re)ke.setLocationAtPoint(re,pe);else{const je=ke.zoomScale(ke.zoom-x),Xe=M>x?Math.min(2,ee):Math.max(.5,ee),Ze=Math.pow(Xe,1-ze),ut=ke.unproject(J.add(K.mult(ze*Ze)).mult(je));ke.setLocationAtPoint(ke.renderWorldCopies?ut.wrap():ut,$)}return n.preloadOnly||this._fireMoveEvents(c),ke};if(n.preloadOnly){const ke=this._emulate(be,n.duration,p);return this._preloadTiles(ke),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ue,this._pitching=Ie,this._padding=Te,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ge),this._ease(be(p),ke=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,ke)},n),this}_prepareEase(n,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new s.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",n)),x&&this.fire(new s.z("rotateend",n)),b&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const rt=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(rt,c)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},n);const p=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in n?s.aA(+n.zoom,p.minZoom,p.maxZoom):x,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:E,H=this._extendPadding(n.padding),G=p.zoomScale(M-x),$=s.P.convert(n.offset);let J=p.centerPoint.add($);const K=p.pointLocation(J),ee=s.aT.convert(n.center||K);this._normalizeCenter(ee);const re=p.project(K),pe=p.project(ee).sub(re);let fe=n.curve;const ue=Math.max(p.width,p.height),Ie=ue/G,Te=pe.mag();if("minZoom"in n){const rt=s.aA(Math.min(n.minZoom,x,M),p.minZoom,p.maxZoom),yt=ue/p.zoomScale(rt-x);fe=Math.sqrt(yt/Te*2)}const Ae=fe*fe;function be(rt){const yt=(Ie*Ie-ue*ue+(rt?-1:1)*Ae*Ae*Te*Te)/(2*(rt?Ie:ue)*Ae*Te);return Math.log(Math.sqrt(yt*yt+1)-yt)}function ge(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function ke(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const ze=be(0);let je=function(rt){return ke(ze)/ke(ze+fe*rt)},Xe=function(rt){return ue*((ke(ze)*(ge(yt=ze+fe*rt)/ke(yt))-ge(ze))/Ae)/Te;var yt},Ze=(be(1)-ze)/fe;if(Math.abs(Te)<1e-6||!isFinite(Ze)){if(Math.abs(ue-Ie)<1e-6)return this.easeTo(n,c);const rt=Ie<ue?-1:1;Ze=Math.abs(Math.log(Ie/ue))/fe,Xe=function(){return 0},je=function(yt){return Math.exp(rt*fe*yt)}}n.duration="duration"in n?+n.duration:1e3*Ze/("screenSpeed"in n?+n.screenSpeed/fe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const ut=b!==O,xt=z!==E,et=!p.isPaddingEqual(H),Le=n.retainPadding===!1?p.clone():p,mt=rt=>yt=>{const kt=yt*Ze,qt=1/je(kt);rt.zoom=yt===1?M:x+rt.scaleZoom(qt),ut&&(rt.bearing=s.ak(b,O,yt)),xt&&(rt.pitch=s.ak(E,z,yt)),et&&(Le.interpolatePadding(I,H,yt),J=Le.centerPoint.add($));const zt=yt===1?ee:rt.unproject(re.add(pe.mult(Xe(kt))).mult(qt));return rt.setLocationAtPoint(rt.renderWorldCopies?zt.wrap():zt,J),rt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),rt};if(n.preloadOnly){const rt=this._emulate(mt,n.duration,p);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=ut,this._pitching=xt,this._padding=et,this._prepareEase(c,!1),this._ease(mt(p),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,c,p){p.animate===!1||p.duration===0?(n(1),c()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=s.bT(n,-180,180);const p=Math.abs(n-c);return Math.abs(n-360-c)<p&&(n-=360),Math.abs(n+360-c)<p&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=n.lng-c.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,p){const x=Math.ceil(15*c/1e3),b=[],E=n(p.clone());for(let I=0;I<=x;I++){const M=E(I/x);b.push(M.clone())}return b}_preloadTiles(n,c){}}class Nd{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=Ye("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=Ye("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=c.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<c.length-1?"&":""}`),x),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${gg(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const b=c[x];if(b.used){const E=b.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n.sort((x,b)=>x.length-b.length),n=n.filter((x,b)=>{for(let E=b+1;E<n.length;E++)if(n[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.map(x=>(function(b){const E=new DOMParser().parseFromString(b,"text/html");return Array.from(E.body.querySelectorAll("*")).reverse().forEach(I=>{const M=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(...I.childNodes);const O=I.getAttribute("href");if(!O||!/^(https?:|mailto:)/i.test(O))return void I.replaceWith(E.createTextNode(M));const z=E.createElement("a");z.href=O,z.textContent=M,z.rel="noopener nofollow";const H=I.getAttribute("class");H&&(z.className=H),I.replaceWith(z)}),E.body.innerHTML})(x)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xl{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Ye("div","mapboxgl-ctrl");const c=Ye("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const p=n[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class bg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class fr{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=s.dD((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,p){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+p}}const wg={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class sm extends s.z{constructor(n,c,p,x){const{point:b,lngLat:E,originalEvent:I,target:M}=n;super(n.type,{point:b,lngLat:E,originalEvent:I,target:M}),this.preventDefault=()=>{n.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class Tg{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,c){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(n,s.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,c)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(n,c),this.typeById.set(n,x)}get(n){const c=this.typeById.get(n);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(n):void 0}remove(n){const c=this.typeById.get(n);if(!c)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(c);p&&(p.delete(n),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(n,c){const p=[];for(const[x,b]of c)b.target&&p.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());c.length&&(n.type="mouseenter",this.handleType(n,c));const p=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(b.id,b);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(n.type="mouseleave",this.handleType(n,c)),this.hoveredFeatures.clear()}handleType(n,c){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!c;c=c||this.queryTargets(n.point,x);let E=!1;const I=new Set;for(const M of c){for(const[O,z]of x){if(!z.target)continue;const H=M.variants?M.variants[O]:null;if(H){for(const G of H){if(dl(G,M,I,O))continue;const $=new s.dx(M,G),J=ja(G,M,O);b&&$.id!==void 0&&($.state=this.map.getFeatureState($));const K=p?this.prevHoveredFeatures.get(J):null,ee=new sm(n,O,z,$),re=K?K.stop:z.handler(ee);if(p&&this.hoveredFeatures.set(J,{feature:M,stop:re}),re!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[M,O]of x){const{handler:z,target:H}=O;if(!H&&z(new sm(n,M,O,null))!==!1)break}}}function am(f,n){if(Array.isArray(f)&&Array.isArray(n)){const c=new Set(f),p=new Set(n);return c.size===p.size&&f.every(x=>p.has(x))}return s.by(f,n)}const Bd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ps{constructor(n,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Yf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Kf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),Mt()}move(n,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(n,c),b=x&&x.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(n,c),I=E&&E.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){cn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Re(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Re(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ve(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ve(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Oh(f,n,c){if(f=new s.aT(f.lng,f.lat),n){const p=new s.aT(f.lng-360,f.lat),x=new s.aT(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint3D(f).distSqr(n),I=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint3D(p).distSqr(n)<E&&(I||Math.abs(p.lng-c.center.lng)<b)?f=p:c.locationPoint3D(x).distSqr(n)<E&&(I||Math.abs(x.lng-c.center.lng)<b)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const xl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Hr={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class fs extends s.E{constructor(n,c){super(),(n instanceof HTMLElement||c)&&(n=Object.assign({element:n},c)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:b=1,draggable:E=!1,clickTolerance:I=0,rotation:M=Hr.rotation,rotationAlignment:O=Hr.rotationAlignment,pitchAlignment:z=Hr.pitchAlignment,occludedOpacity:H=Hr.occludedOpacity,altitude:G=Hr.altitude}=n||{};this._anchor=p,this._color=x,this._scale=b,this._draggable=E,this._clickTolerance=I,this._rotation=M,this._rotationAlignment=O,this._pitchAlignment=z,this._occludedOpacity=H,this._altitude=G,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",K=>{K.preventDefault()}),this._element.addEventListener("mousedown",K=>{K.preventDefault()});const $=this._element.classList;for(const K in xl)$.remove(`mapboxgl-marker-anchor-${K}`);$.add(`mapboxgl-marker-anchor-${this._anchor}`);const J=n&&n.className?n.className.trim().split(/\s+/):[];$.add(...J),this._popup=null}_createDefaultMarker(){const n=Ye("div"),c=Ke("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=Ke("radialGradient",{id:"shadowGradient"},Ke("defs",{},c));Ke("stop",{offset:"10%","stop-opacity":.4},p),Ke("stop",{offset:"100%","stop-opacity":.05},p),Ke("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Ke("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Ke("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Ke("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aT.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Hr.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,p=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const p=n.unproject(c,this._altitude),x=n.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(c,this._altitude);let x;n._showingGlobe()&&s.f5(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${xl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!n||p!=="map")return"";if(!c._showingGlobe()){const M=c.getPitch();return M?`rotateX(${M}deg)`:""}const x=s.cX(s.f6(c.transform,this._lngLat)),b=n.sub(s.f7(c.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const I=x/E;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const b=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=s.cX(Math.atan2(E.y,E.x))-90}else p=-c.getBearing();else if(x==="horizon"){const b=s.ah(4,6,c.getZoom()),E=s.f7(c.transform);E.y+=b*c.transform.height;const I=n.sub(E),M=s.cX(Math.atan2(I.y,I.x));p=(M>90?M-270:M+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Oh(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(n.point.dist(p)<b)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,p=this._pos;c&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Hr.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Hr.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Hr.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Hr.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Fd={maxWidth:100,unit:"metric"},rs={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ho={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zh(f=new s.P(0,0),n="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new s.P(0,f);case"top-left":return new s.P(c,c);case"top-right":return new s.P(-c,c);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(c,-c);case"bottom-right":return new s.P(-c,-c);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[n]||[0,0])}return{version:V,supported:Qe.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends vg{constructor(f){W.mark(B.create);const n=f;if((f=Object.assign({},Bd,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.f3(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gf(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new bg,this._domRenderTaskQueue=new bg,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},wg,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Ht(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new su(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new La(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Nd({customAttribution:f.customAttribution})),this._logoControl=new Xl,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new s.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new s.z(`${c.dataType}dataloading`,c))}),this._interactions=new Tg(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),n&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let c;n==="globe"&&f.zoom>=s.cL?(f.setMercatorFromTransition(),c=!0):n==="mercator"&&f.zoom<s.cL&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;const c=this.transform.mercatorFromTransition;n=f.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(n||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(s.aT.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(s.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,c){const p=x=>{let b=[];if(Array.isArray(n)){const E=n.filter(I=>this.getLayer(I));b=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else b=this.queryRenderedFeatures(x,{target:n});return b};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:E=>{const I=p(E.point);I.length?x||(x=!0,c.call(this,new Gs(f,this,E.originalEvent,{features:I}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:I=>{p(I.point).length?x=!0:x&&(x=!1,c.call(this,new Gs(f,this,I.originalEvent)))},mouseout:I=>{x&&(x=!1,c.call(this,new Gs(f,this,I.originalEvent)))}}}}{const x=b=>{const E=p(b.point);E.length&&(b.features=E,c.call(this,b),delete b.features)};return{listener:c,targets:n,delegates:{[f]:x}}}}on(f,n,c){if(typeof n=="function"||c===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,n,c){if(typeof n=="function"||c===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,n,c){if(typeof n=="function"||c===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let b=0;b<x.length;b++){const E=x[b];if(E.listener===c&&am(E.targets,n)){for(const I in E.delegates)this.off(I,E.delegates[I]);return x.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),E=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(E)}let c=!0;if(n.target&&(c=this._isTargetValid(n.target),c&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,n,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),x}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}queryRasterValue(f,n,c){return this._isValidId(f)?this.style.queryRasterValue(f,n,c):Promise.resolve(null)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;s.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=Object.assign({},n);n&&n.config&&(c.initialConfig=n.config,delete c.config),this.style=new Ha(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:b,content:E}={}){this._lazyInitEmptyStyle();const I=s.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:M,height:O,data:z}=s.o.getImageData(n);this.style.addImage(I,{data:new s.q({width:M,height:O},z),pixelRatio:c,stretchX:x,stretchY:b,content:E,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:O}=n,z=n;this.style.addImage(I,{data:new s.q({width:M,height:O},new Uint8Array(z.data)),pixelRatio:c,stretchX:x,stretchY:b,content:E,sdf:p,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const c=s.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:b,height:E,data:I}=x;if(b===void 0||E===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||E!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const M=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let O=!1;p.usvg?(p.data=new s.q({width:b,height:E},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,O=!0):p.data.replace(I,M),this.style.updateImage(c,p,O)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,n){s.n(this._requestManager.transformRequest(f,s.R.Image),(c,p)=>{n(c,p instanceof HTMLImageElement?s.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch(c=>this.fire(new s.y(new Error("Failed to add import",c)))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,c),this._update(!0)):this}setFilter(f,n,c={}){return this._isValidId(f)?(this.style.setFilter(f,n,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,c,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,c,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}setLayerProperty(f,n,c,p={}){return this._isValidId(f)?(n==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,n,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,c){return this.style.setConfigProperty(f,n,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.style.indoorManager.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.style.indoorManager.setActiveFloorsVisibility(f)}getIndoorTileOptions(f,n){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(f,n):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,p,x,b=this._container;for(;b&&(!p||!x);){const E=window.getComputedStyle(b).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ye("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Ye("div","mapboxgl-canvas-container",f);this._canvas=Ye("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Ye("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=Ye("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=s.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=Object.assign({},Qe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(Wr(n,!0),this.painter=new Jp(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{if(c.dataType==="source"){const p=this.transform.elevation?this.transform.elevation._source():null;p&&c.sourceCacheId===p.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new s.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=s.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,O=this.transform.pitch,z=s.o.now(),H=new s.ac(M,{now:z,fadeDuration:b,pitch:O,transition:this.style.transition,worldview:this._worldview});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,W.mark(B.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=s.o.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const O=x.getQueryParameter(n,x.QUERY_RESULT)/1e6;x.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:M,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(M);this.fire(new s.z("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(M);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:O}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,W.mark(B.fullLoad),this._performanceMetricsCollection&&Cn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const E=Math.abs(x-b);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){_r(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===ve||f.status===401)){const n=this.painter.context.gl;Wr(n,!1),this._logoControl instanceof Xl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Qn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ki(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&qn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Vr(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(f,n,c){let p=c[1]-c[0];const x=f.length/4;for(let b=0;b<n.length;b++){const E=n[b];let I=0;for(let M=0;M<E.length;M+=4)E[M]===f[M]&&E[M+1]===f[M+1]&&E[M+2]===f[M+2]&&E[M+3]===f[M+3]&&(I+=1);p+=(c[b+2]-c[b+1])*(1-I/x)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Hi.delete(this.painter.context.gl),vi.remove(),En.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return s.bw(n,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,n){s.f4(f,n)}get version(){return V}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},Sc,f),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=Ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),c=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ps(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const c=Ye("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.E{constructor(f={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Vo,f),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=em(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const n=new s.aT(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new s.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=s.cf(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:f.code,message:f.message,PERMISSION_DENIED:f.PERMISSION_DENIED,POSITION_UNAVAILABLE:f.POSITION_UNAVAILABLE,TIMEOUT:f.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const f=this.options.positionOptions.timeout;f&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},f))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Ye("button","mapboxgl-ctrl-geolocate",this._container),Ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ye("div","mapboxgl-user-location"),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(f){return this.options.followUserLocation=f??Vo.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const f=()=>{const n="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(n,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Nd,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Fd,f),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,p=n._containerWidth/2-f/2,x=n.unproject([p,c]),b=n.unproject([p+f,c]),E=x.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*E;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,n,c){this._map._requestDomTask(()=>{const p=(function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(M){const O=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*O)/O})(I),E*I})(n),x=p/n;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${rs[c]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ye("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Cp,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create(ho),f),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Ye("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const c=this._closeButton=Ye("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,p=this._pos;if(!n||!c||!p)return"bottom";const x=c.offsetWidth,b=c.offsetHeight,E=p.x<x/2,I=p.x>n.transform.width-x/2;if(p.y+f<b)return E?"top-left":I?"top-right":"top";if(p.y>n.transform.height-b){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=Ye("div","mapboxgl-popup",n.getContainer()),this._tip=Ye("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Oh(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof s.P?f:n.project(this._lngLat,this._altitude),b=zh(this.options.offset),E=this._anchor=this._getAnchor(b.y),I=zh(this.options.offset,E),M=x.add(I).round();n._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${xl[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=s.f5(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(au);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:fs,Style:Ha,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:x_,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.fi.workerCount},set workerCount(f){s.fi.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.fh(f)},get workerUrl(){return s.fg.workerUrl},set workerUrl(f){s.fg.workerUrl=f},get workerClass(){return s.fg.workerClass},set workerClass(f){s.fg.workerClass=f},get workerParams(){return s.fg.workerParams},set workerParams(f){s.fg.workerParams=f},get dracoUrl(){return s.ff()},set dracoUrl(f){s.fe(f)},get meshoptUrl(){return s.fd()},set meshoptUrl(f){s.fc(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var C=y;return C}))})(qb)),qb.exports}var KL=L7();const QL=Uv(KL),O7=gN({__proto__:null,default:QL},[KL]),$T="pk.eyJ1IjoiYmVybnlpbmRlZWQiLCJhIjoiY21rdDBnenY3MWt5eTNycTU1MTh5c3kzZSJ9.vGUkQt_FtPFQJRup6SFNzg",z7={longitude:-73.5791,latitude:45.4953},N7=["doctors_office","medical_clinic"],B7=["clinique mdicale","medical clinic","clinique medicale","family","famille","familial","general","gnraliste","generaliste","walk-in","sans rendez-vous","walk in","mdecin","medecin","doctor","dr.","gmc","clsc","polyclinique","polyclinic","group health","groupe sant","health center","centre de sant"],F7=["sexolog","sexuel","sexual","ostopath","osteopath","osto","plastic","cosmetic","surgery","surgeon","chirurgie","esthetique","esthtique","pediatr","pdiatr","enfant","child","kid","gynec","gync","obstet","obstt","fertility","fertilit","ivf","cardio","neuro","oncol","cancer","urolog","gastro","pulmon","endocrin","orthop","ortho","spine","joint","sport medicine","allerg","immun","rheuma","psychiatr","psycholog","mental","therapy","thrap","counsel","addiction","toxicoman","rehab","recovery","detox","substance","dependan","alcool","drogue","sobri","treatment center","dentist","dental","dentaire","orthodont","chiropract","physiother","optometr","ophthalm","podiatr","dermato","veterinar","acupunctur","massage","spa","beauty","naturopath","homeopath","kinesiolog","kinsio","laboratory","laboratoire","imaging","x-ray","radiolog","social","community","communautaire","shelter","refuge","pharmacy","pharmacie","drugstore","ear","nose","throat","ent ","orl","audio","hearing","evolution","hope","wellness","bien-tre","holistic","holistique"],V7=(o,t,a,u)=>{const T=(a-o)*Math.PI/180,C=(u-t)*Math.PI/180,s=Math.sin(T/2)*Math.sin(T/2)+Math.cos(o*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(C/2)*Math.sin(C/2);return 3959*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},j7=({onClose:o,onClinicSelect:t})=>{const{userLocation:a,requestLocation:u}=DD(),y=Ue.useRef(null),[T,C]=Ue.useState([]),[s,V]=Ue.useState(null),[B,W]=Ue.useState(null),[Y,ae]=Ue.useState(!0);Ue.useEffect(()=>{a||u()},[]),Ue.useEffect(()=>{a&&y.current&&y.current.flyTo({center:[a.longitude,a.latitude],zoom:15.5,pitch:60,bearing:-17.6,duration:2e3})},[a]);const he=a||z7;Ue.useEffect(()=>{if(!a){ae(!0);return}(async()=>{var cn,St;ae(!0);const Ge=[],Mt=new Set;for(const Oe of N7)try{const Ve=await(await fetch(`https://api.mapbox.com/search/searchbox/v1/category/${Oe}?access_token=${$T}&proximity=${a.longitude},${a.latitude}&limit=25&language=en`)).json();if(Ve.features)for(const Je of Ve.features){if(Mt.has(Je.properties.mapbox_id))continue;Mt.add(Je.properties.mapbox_id);const He=Je.geometry.coordinates,tt=Je.properties,ve=(tt.name||"").toLowerCase(),Ht=(tt.full_address||tt.address||"").toLowerCase(),dn=ve+" "+Ht;if(F7.some(Kn=>dn.includes(Kn))||!B7.some(Kn=>dn.includes(Kn)))continue;const wn=V7(a.latitude,a.longitude,He[1],He[0]);Ge.push({id:tt.mapbox_id,name:tt.name||"Medical Facility",address:tt.full_address||tt.address||"Address not available",distance:wn,longitude:He[0],latitude:He[1],rating:Math.round((((cn=tt.metadata)==null?void 0:cn.rating)||3.5+Math.random()*1.5)*10)/10,phone:((St=tt.metadata)==null?void 0:St.phone)||"Phone not available"})}}catch(Re){console.error(`Error fetching ${Oe}:`,Re)}Ge.sort((Oe,Re)=>Oe.distance-Re.distance),C(Ge.slice(0,10)),ae(!1)})()},[a]);const Qe=Ue.useCallback(()=>{y.current&&y.current.resize()},[]),Ye=async nt=>{try{const Mt=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${he.longitude},${he.latitude};${nt.longitude},${nt.latitude}?geometries=geojson&access_token=${$T}`)).json();if(Mt.routes&&Mt.routes[0]){const cn=Mt.routes[0];if(W({type:"Feature",properties:{},geometry:cn.geometry}),y.current){const St=cn.geometry.coordinates,Oe=St.reduce((Re,Ve)=>Re.extend(Ve),new QL.LngLatBounds(St[0],St[0]));y.current.fitBounds(Oe,{padding:50,pitch:45,bearing:-10})}}}catch(Ge){console.error("Error getting route:",Ge)}},Ke=nt=>{V(nt),Ye(nt)},at=()=>{t&&s&&t(s)};return N.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[N.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Find Nearby Doctors"}),N.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:a?"Showing clinics near your location":"Enable location to find nearby clinics"})]}),o&&N.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:N.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),N.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[N.jsx("div",{className:"min-h-[300px] h-1/2 bg-gray-100 relative flex-shrink-0",children:N.jsxs(y7,{ref:y,initialViewState:{longitude:he.longitude,latitude:he.latitude,zoom:15.5,pitch:60,bearing:-17.6},style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",mapboxAccessToken:$T,onLoad:Qe,reuseMaps:!0,fog:{range:[.8,8],color:"#dc9f9f","horizon-blend":.5,"high-color":"#245bde","space-color":"#333","star-intensity":.15},children:[N.jsx(E7,{position:"bottom-right"}),N.jsx(nD,{id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}}),B&&N.jsx(R7,{id:"route",type:"geojson",data:B,children:N.jsx(nD,{id:"route-line",type:"line",paint:{"line-color":"#3b82f6","line-width":4,"line-opacity":.8}})}),N.jsx(tD,{longitude:he.longitude,latitude:he.latitude,anchor:"bottom",children:N.jsx("div",{className:"relative",children:N.jsx("div",{className:"size-6 bg-primary rounded-full border-4 border-white shadow-2xl pulse-red"})})}),T.map((nt,Ge)=>N.jsx(tD,{longitude:nt.longitude,latitude:nt.latitude,anchor:"bottom",onClick:()=>Ke(nt),children:N.jsx("div",{className:`cursor-pointer transition-transform ${(s==null?void 0:s.id)===nt.id?"scale-125":"hover:scale-110"}`,children:N.jsx("span",{className:`material-symbols-outlined text-3xl drop-shadow-md ${(s==null?void 0:s.id)===nt.id?"text-blue-500":"text-red-500"}`,children:"location_on"})})},nt.id))]},`${he.longitude}-${he.latitude}`)}),N.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-4",children:Y?N.jsx("div",{className:"flex items-center justify-center py-12",children:N.jsx("span",{className:"material-symbols-outlined animate-spin text-3xl text-gray-400",children:"progress_activity"})}):T.length===0?N.jsxs("div",{className:"text-center py-12 text-gray-400",children:[N.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"search_off"}),N.jsx("p",{children:"No clinics found nearby"})]}):T.map((nt,Ge)=>N.jsxs("div",{onClick:()=>Ke(nt),className:`bg-white p-5 rounded-2xl border transition-all cursor-pointer shadow-sm hover:shadow-md ${(s==null?void 0:s.id)===nt.id?"border-blue-500 ring-2 ring-blue-100":"border-black/5 hover:border-primary"}`,children:[N.jsxs("div",{className:"flex justify-between items-start mb-2",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:"size-6 rounded-full bg-red-50 flex items-center justify-center text-red-500 text-xs font-black",children:Ge+1}),N.jsx("h3",{className:"font-bold text-lg text-primary leading-tight",children:nt.name})]}),N.jsxs("span",{className:"text-xs font-bold text-gray-400 whitespace-nowrap ml-2 bg-gray-50 px-2 py-1 rounded-lg",children:[nt.distance.toFixed(1)," mi"]})]}),N.jsxs("div",{className:"flex items-center gap-1 text-orange-500 mb-2 ml-8",children:[[1,2,3,4,5].map(Mt=>N.jsx("span",{className:`material-symbols-outlined text-[16px] ${Mt<=Math.round(nt.rating)?"fill-1":"opacity-30"}`,children:"star"},Mt)),N.jsx("span",{className:"text-sm font-black ml-1",children:nt.rating})]}),N.jsx("p",{className:"text-xs text-gray-400 mb-1 ml-8",children:nt.address}),N.jsxs("p",{className:"text-xs text-gray-500 font-medium mb-3 ml-8",children:[N.jsx("span",{className:"material-symbols-outlined text-[12px] align-middle mr-1",children:"call"}),nt.phone]}),(s==null?void 0:s.id)===nt.id&&N.jsx("button",{onClick:Mt=>{Mt.stopPropagation(),at()},className:"w-full bg-primary text-white py-3 rounded-xl text-xs font-black shadow-lg shadow-black/5 hover:bg-black transition-all mt-2",children:"Select This Center"})]},nt.id))})]})]})},U7=({onClose:o,onSubmit:t,question:a})=>{const[u,y]=Ue.useState(""),T=C=>{C==null||C.preventDefault(),u.trim()&&(t(u),y(""))};return N.jsxs("div",{className:"h-full bg-soft-cream flex flex-col overflow-hidden animate-in slide-in-from-right duration-300 w-full",children:[N.jsxs("div",{className:"p-6 border-b border-black/5 flex justify-between items-center bg-white/50 backdrop-blur-sm flex-shrink-0",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"serif-font text-3xl text-primary",children:"Information Needed"}),N.jsx("p",{className:"text-gray-500 text-xs font-medium mt-1",children:"Please provide the following details"})]}),o&&N.jsx("button",{onClick:o,className:"size-8 rounded-full bg-white border border-black/5 flex items-center justify-center hover:bg-black hover:text-white transition-all",children:N.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),N.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 flex flex-col justify-center",children:[N.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-black/5 shadow-sm text-center mb-8",children:[N.jsx("div",{className:"size-16 bg-primary/5 rounded-full flex items-center justify-center mx-auto mb-6",children:N.jsx("span",{className:"material-symbols-outlined text-3xl text-primary",children:"help"})}),N.jsx("h3",{className:"serif-font text-2xl text-primary mb-3 leading-tight",children:a}),N.jsx("p",{className:"text-gray-500 text-sm",children:"Your input helps our AI assistant coordinate more effectively."})]}),N.jsx("form",{onSubmit:T,children:N.jsxs("div",{className:"mb-4",children:[N.jsx("label",{htmlFor:"answer",className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 mb-2 ml-1",children:"Your Answer"}),N.jsx("textarea",{id:"answer",value:u,onChange:C=>y(C.target.value),className:"w-full p-4 rounded-2xl bg-white border-0 ring-1 ring-black/5 focus:ring-2 focus:ring-primary text-primary placeholder:text-gray-300 transition-all resize-none text-lg min-h-[120px]",placeholder:"Type your response here...",autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),T())}})]})})]}),N.jsx("div",{className:"p-4 border-t border-black/5 bg-white/50 backdrop-blur-sm flex-shrink-0",children:N.jsxs("button",{onClick:()=>T(),disabled:!u.trim(),className:`w-full py-4 rounded-2xl text-sm font-black transition-all flex items-center justify-center gap-2 ${u.trim()?"bg-primary text-white shadow-lg shadow-black/5 hover:bg-black active:scale-[0.98]":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[N.jsx("span",{children:"Submit Answer"}),N.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})]})})]})},G7="438 520 2457",q7=({onCancel:o,onConfirm:t,countdownSeconds:a=7,phoneNumber:u=G7})=>{const[y,T]=Ue.useState(a);return Ue.useEffect(()=>{if(y<=0){t();return}const C=setInterval(()=>{T(s=>s-1)},1e3);return()=>clearInterval(C)},[y,t]),N.jsx("div",{className:"fixed inset-0 bg-red-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-300",children:N.jsxs("div",{className:"bg-white rounded-[40px] shadow-2xl overflow-hidden w-full max-w-sm border-2 border-red-500 relative",children:[N.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gray-100",children:N.jsx("div",{className:"h-full bg-red-600 transition-all duration-1000 ease-linear",style:{width:`${y/a*100}%`}})}),N.jsxs("div",{className:"p-8 text-center",children:[N.jsx("div",{className:"size-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:N.jsx("span",{className:"material-symbols-outlined text-4xl text-red-600",children:"emergency"})}),N.jsx("h2",{className:"text-2xl font-black text-gray-900 mb-2 leading-tight",children:"Emergency Detected"}),N.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"Calling emergency line in"}),N.jsx("div",{className:"text-6xl font-black text-red-600 tabular-nums mb-4",children:y}),N.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 mb-6",children:[N.jsx("p",{className:"text-xs text-red-600 font-bold uppercase tracking-wider mb-1",children:"Calling"}),N.jsx("p",{className:"text-2xl font-black text-red-700 tracking-wider",children:u})]}),N.jsxs("div",{className:"space-y-3",children:[N.jsx("button",{onClick:t,className:"w-full bg-red-600 text-white rounded-2xl py-4 font-black text-sm uppercase tracking-widest hover:bg-red-700 transition-all shadow-lg shadow-red-200",children:"Call Now"}),N.jsx("button",{onClick:o,className:"w-full bg-gray-100 text-gray-500 rounded-2xl py-4 font-bold text-sm uppercase tracking-widest hover:bg-gray-200 transition-all",children:"Cancel"})]})]})]})})},hf=Object.create(null);hf.open="0";hf.close="1";hf.ping="2";hf.pong="3";hf.message="4";hf.upgrade="5";hf.noop="6";const Hb=Object.create(null);Object.keys(hf).forEach(o=>{Hb[hf[o]]=o});const OE={type:"error",data:"parser error"},JL=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",eO=typeof ArrayBuffer=="function",tO=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,rA=({type:o,data:t},a,u)=>JL&&t instanceof Blob?a?u(t):rD(t,u):eO&&(t instanceof ArrayBuffer||tO(t))?a?u(t):rD(new Blob([t]),u):u(hf[o]+(t||"")),rD=(o,t)=>{const a=new FileReader;return a.onload=function(){const u=a.result.split(",")[1];t("b"+(u||""))},a.readAsDataURL(o)};function sD(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}let ZT;function H7(o,t){if(JL&&o.data instanceof Blob)return o.data.arrayBuffer().then(sD).then(t);if(eO&&(o.data instanceof ArrayBuffer||tO(o.data)))return t(sD(o.data));rA(o,!1,a=>{ZT||(ZT=new TextEncoder),t(ZT.encode(a))})}const aD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xv=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<aD.length;o++)xv[aD.charCodeAt(o)]=o;const $7=o=>{let t=o.length*.75,a=o.length,u,y=0,T,C,s,V;o[o.length-1]==="="&&(t--,o[o.length-2]==="="&&t--);const B=new ArrayBuffer(t),W=new Uint8Array(B);for(u=0;u<a;u+=4)T=xv[o.charCodeAt(u)],C=xv[o.charCodeAt(u+1)],s=xv[o.charCodeAt(u+2)],V=xv[o.charCodeAt(u+3)],W[y++]=T<<2|C>>4,W[y++]=(C&15)<<4|s>>2,W[y++]=(s&3)<<6|V&63;return B},Z7=typeof ArrayBuffer=="function",sA=(o,t)=>{if(typeof o!="string")return{type:"message",data:nO(o,t)};const a=o.charAt(0);return a==="b"?{type:"message",data:W7(o.substring(1),t)}:Hb[a]?o.length>1?{type:Hb[a],data:o.substring(1)}:{type:Hb[a]}:OE},W7=(o,t)=>{if(Z7){const a=$7(o);return nO(a,t)}else return{base64:!0,data:o}},nO=(o,t)=>{switch(t){case"blob":return o instanceof Blob?o:new Blob([o]);case"arraybuffer":default:return o instanceof ArrayBuffer?o:o.buffer}},iO="",X7=(o,t)=>{const a=o.length,u=new Array(a);let y=0;o.forEach((T,C)=>{rA(T,!1,s=>{u[C]=s,++y===a&&t(u.join(iO))})})},Y7=(o,t)=>{const a=o.split(iO),u=[];for(let y=0;y<a.length;y++){const T=sA(a[y],t);if(u.push(T),T.type==="error")break}return u};function K7(){return new TransformStream({transform(o,t){H7(o,a=>{const u=a.length;let y;if(u<126)y=new Uint8Array(1),new DataView(y.buffer).setUint8(0,u);else if(u<65536){y=new Uint8Array(3);const T=new DataView(y.buffer);T.setUint8(0,126),T.setUint16(1,u)}else{y=new Uint8Array(9);const T=new DataView(y.buffer);T.setUint8(0,127),T.setBigUint64(1,BigInt(u))}o.data&&typeof o.data!="string"&&(y[0]|=128),t.enqueue(y),t.enqueue(a)})}})}let WT;function Rb(o){return o.reduce((t,a)=>t+a.length,0)}function Mb(o,t){if(o[0].length===t)return o.shift();const a=new Uint8Array(t);let u=0;for(let y=0;y<t;y++)a[y]=o[0][u++],u===o[0].length&&(o.shift(),u=0);return o.length&&u<o[0].length&&(o[0]=o[0].slice(u)),a}function Q7(o,t){WT||(WT=new TextDecoder);const a=[];let u=0,y=-1,T=!1;return new TransformStream({transform(C,s){for(a.push(C);;){if(u===0){if(Rb(a)<1)break;const V=Mb(a,1);T=(V[0]&128)===128,y=V[0]&127,y<126?u=3:y===126?u=1:u=2}else if(u===1){if(Rb(a)<2)break;const V=Mb(a,2);y=new DataView(V.buffer,V.byteOffset,V.length).getUint16(0),u=3}else if(u===2){if(Rb(a)<8)break;const V=Mb(a,8),B=new DataView(V.buffer,V.byteOffset,V.length),W=B.getUint32(0);if(W>Math.pow(2,21)-1){s.enqueue(OE);break}y=W*Math.pow(2,32)+B.getUint32(4),u=3}else{if(Rb(a)<y)break;const V=Mb(a,y);s.enqueue(sA(T?V:WT.decode(V),t)),u=0}if(y===0||y>o){s.enqueue(OE);break}}}})}const rO=4;function eo(o){if(o)return J7(o)}function J7(o){for(var t in eo.prototype)o[t]=eo.prototype[t];return o}eo.prototype.on=eo.prototype.addEventListener=function(o,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(t),this};eo.prototype.once=function(o,t){function a(){this.off(o,a),t.apply(this,arguments)}return a.fn=t,this.on(o,a),this};eo.prototype.off=eo.prototype.removeListener=eo.prototype.removeAllListeners=eo.prototype.removeEventListener=function(o,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+o];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var u,y=0;y<a.length;y++)if(u=a[y],u===t||u.fn===t){a.splice(y,1);break}return a.length===0&&delete this._callbacks["$"+o],this};eo.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),a=this._callbacks["$"+o],u=1;u<arguments.length;u++)t[u-1]=arguments[u];if(a){a=a.slice(0);for(var u=0,y=a.length;u<y;++u)a[u].apply(this,t)}return this};eo.prototype.emitReserved=eo.prototype.emit;eo.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};eo.prototype.hasListeners=function(o){return!!this.listeners(o).length};const H1=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,a)=>a(t,0),Ku=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),e$="arraybuffer";function sO(o,...t){return t.reduce((a,u)=>(o.hasOwnProperty(u)&&(a[u]=o[u]),a),{})}const t$=Ku.setTimeout,n$=Ku.clearTimeout;function $1(o,t){t.useNativeTimers?(o.setTimeoutFn=t$.bind(Ku),o.clearTimeoutFn=n$.bind(Ku)):(o.setTimeoutFn=Ku.setTimeout.bind(Ku),o.clearTimeoutFn=Ku.clearTimeout.bind(Ku))}const i$=1.33;function r$(o){return typeof o=="string"?s$(o):Math.ceil((o.byteLength||o.size)*i$)}function s$(o){let t=0,a=0;for(let u=0,y=o.length;u<y;u++)t=o.charCodeAt(u),t<128?a+=1:t<2048?a+=2:t<55296||t>=57344?a+=3:(u++,a+=4);return a}function aO(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function a$(o){let t="";for(let a in o)o.hasOwnProperty(a)&&(t.length&&(t+="&"),t+=encodeURIComponent(a)+"="+encodeURIComponent(o[a]));return t}function o$(o){let t={},a=o.split("&");for(let u=0,y=a.length;u<y;u++){let T=a[u].split("=");t[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return t}class l$ extends Error{constructor(t,a,u){super(t),this.description=a,this.context=u,this.type="TransportError"}}class aA extends eo{constructor(t){super(),this.writable=!1,$1(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,a,u){return super.emitReserved("error",new l$(t,a,u)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const a=sA(t,this.socket.binaryType);this.onPacket(a)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,a={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const a=a$(t);return a.length?"?"+a:""}}class c$ extends aA{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const a=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let u=0;this._polling&&(u++,this.once("pollComplete",function(){--u||a()})),this.writable||(u++,this.once("drain",function(){--u||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const a=u=>{if(this.readyState==="opening"&&u.type==="open"&&this.onOpen(),u.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(u)};Y7(t,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,X7(t,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=aO()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(t,a)}}let oO=!1;try{oO=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const u$=oO;function h$(){}class d$ extends c${constructor(t){if(super(t),typeof location<"u"){const a=location.protocol==="https:";let u=location.port;u||(u=a?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||u!==t.port}}doWrite(t,a){const u=this.request({method:"POST",data:t});u.on("success",a),u.on("error",(y,T)=>{this.onError("xhr post error",y,T)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(a,u)=>{this.onError("xhr poll error",a,u)}),this.pollXhr=t}}let Dy=class $b extends eo{constructor(t,a,u){super(),this.createRequest=t,$1(this,u),this._opts=u,this._method=u.method||"GET",this._uri=a,this._data=u.data!==void 0?u.data:null,this._create()}_create(){var t;const a=sO(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const u=this._xhr=this.createRequest(a);try{u.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let y in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(y)&&u.setRequestHeader(y,this._opts.extraHeaders[y])}}catch{}if(this._method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(u),"withCredentials"in u&&(u.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(u.timeout=this._opts.requestTimeout),u.onreadystatechange=()=>{var y;u.readyState===3&&((y=this._opts.cookieJar)===null||y===void 0||y.parseCookies(u.getResponseHeader("set-cookie"))),u.readyState===4&&(u.status===200||u.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof u.status=="number"?u.status:0)},0))},u.send(this._data)}catch(y){this.setTimeoutFn(()=>{this._onError(y)},0);return}typeof document<"u"&&(this._index=$b.requestsCount++,$b.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=h$,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete $b.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Dy.requestsCount=0;Dy.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",oD);else if(typeof addEventListener=="function"){const o="onpagehide"in Ku?"pagehide":"unload";addEventListener(o,oD,!1)}}function oD(){for(let o in Dy.requests)Dy.requests.hasOwnProperty(o)&&Dy.requests[o].abort()}const f$=(function(){const o=lO({xdomain:!1});return o&&o.responseType!==null})();class p$ extends d${constructor(t){super(t);const a=t&&t.forceBase64;this.supportsBinary=f$&&!a}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Dy(lO,this.uri(),t)}}function lO(o){const t=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||u$))return new XMLHttpRequest}catch{}if(!t)try{return new Ku[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const cO=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class m$ extends aA{get name(){return"websocket"}doOpen(){const t=this.uri(),a=this.opts.protocols,u=cO?{}:sO(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(u.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,a,u)}catch(y){return this.emitReserved("error",y)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let a=0;a<t.length;a++){const u=t[a],y=a===t.length-1;rA(u,this.supportsBinary,T=>{try{this.doWrite(u,T)}catch{}y&&H1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=aO()),this.supportsBinary||(a.b64=1),this.createUri(t,a)}}const XT=Ku.WebSocket||Ku.MozWebSocket;class g$ extends m${createSocket(t,a,u){return cO?new XT(t,a,u):a?new XT(t,a):new XT(t)}doWrite(t,a){this.ws.send(a)}}class _$ extends aA{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const a=Q7(Number.MAX_SAFE_INTEGER,this.socket.binaryType),u=t.readable.pipeThrough(a).getReader(),y=K7();y.readable.pipeTo(t.writable),this._writer=y.writable.getWriter();const T=()=>{u.read().then(({done:s,value:V})=>{s||(this.onPacket(V),T())}).catch(s=>{})};T();const C={type:"open"};this.query.sid&&(C.data=`{"sid":"${this.query.sid}"}`),this._writer.write(C).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let a=0;a<t.length;a++){const u=t[a],y=a===t.length-1;this._writer.write(u).then(()=>{y&&H1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const y$={websocket:g$,webtransport:_$,polling:p$},x$=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,v$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function zE(o){if(o.length>8e3)throw"URI too long";const t=o,a=o.indexOf("["),u=o.indexOf("]");a!=-1&&u!=-1&&(o=o.substring(0,a)+o.substring(a,u).replace(/:/g,";")+o.substring(u,o.length));let y=x$.exec(o||""),T={},C=14;for(;C--;)T[v$[C]]=y[C]||"";return a!=-1&&u!=-1&&(T.source=t,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=b$(T,T.path),T.queryKey=w$(T,T.query),T}function b$(o,t){const a=/\/{2,9}/g,u=t.replace(a,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&u.splice(0,1),t.slice(-1)=="/"&&u.splice(u.length-1,1),u}function w$(o,t){const a={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(u,y,T){y&&(a[y]=T)}),a}const NE=typeof addEventListener=="function"&&typeof removeEventListener=="function",Zb=[];NE&&addEventListener("offline",()=>{Zb.forEach(o=>o())},!1);class Bm extends eo{constructor(t,a){if(super(),this.binaryType=e$,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(a=t,t=null),t){const u=zE(t);a.hostname=u.host,a.secure=u.protocol==="https"||u.protocol==="wss",a.port=u.port,u.query&&(a.query=u.query)}else a.host&&(a.hostname=zE(a.host).host);$1(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(u=>{const y=u.prototype.name;this.transports.push(y),this._transportsByName[y]=u}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=o$(this.opts.query)),NE&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Zb.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const a=Object.assign({},this.opts.query);a.EIO=rO,a.transport=t,this.id&&(a.sid=this.id);const u=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](u)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Bm.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(t);a.open(),this.setTransport(a)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",Bm.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=t.data,this._onError(a);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let u=0;u<this.writeBuffer.length;u++){const y=this.writeBuffer[u].data;if(y&&(a+=r$(y)),u>0&&a>this._maxPayload)return this.writeBuffer.slice(0,u);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,H1(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,a,u){return this._sendPacket("message",t,a,u),this}send(t,a,u){return this._sendPacket("message",t,a,u),this}_sendPacket(t,a,u,y){if(typeof a=="function"&&(y=a,a=void 0),typeof u=="function"&&(y=u,u=null),this.readyState==="closing"||this.readyState==="closed")return;u=u||{},u.compress=u.compress!==!1;const T={type:t,data:a,options:u};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),y&&this.once("flush",y),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),t()},u=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?u():t()}):this.upgrading?u():t()),this}_onError(t){if(Bm.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),NE&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const u=Zb.indexOf(this._offlineEventListener);u!==-1&&Zb.splice(u,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,a),this.writeBuffer=[],this._prevBufferLen=0}}}Bm.protocol=rO;class T$ extends Bm{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let a=this.createTransport(t),u=!1;Bm.priorWebsocketSuccess=!1;const y=()=>{u||(a.send([{type:"ping",data:"probe"}]),a.once("packet",Y=>{if(!u)if(Y.type==="pong"&&Y.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Bm.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{u||this.readyState!=="closed"&&(W(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const ae=new Error("probe error");ae.transport=a.name,this.emitReserved("upgradeError",ae)}}))};function T(){u||(u=!0,W(),a.close(),a=null)}const C=Y=>{const ae=new Error("probe error: "+Y);ae.transport=a.name,T(),this.emitReserved("upgradeError",ae)};function s(){C("transport closed")}function V(){C("socket closed")}function B(Y){a&&Y.name!==a.name&&T()}const W=()=>{a.removeListener("open",y),a.removeListener("error",C),a.removeListener("close",s),this.off("close",V),this.off("upgrading",B)};a.once("open",y),a.once("error",C),a.once("close",s),this.once("close",V),this.once("upgrading",B),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{u||a.open()},200):a.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const a=[];for(let u=0;u<t.length;u++)~this.transports.indexOf(t[u])&&a.push(t[u]);return a}}let E$=class extends T${constructor(t,a={}){const u=typeof t=="object"?t:a;(!u.transports||u.transports&&typeof u.transports[0]=="string")&&(u.transports=(u.transports||["polling","websocket","webtransport"]).map(y=>y$[y]).filter(y=>!!y)),super(t,u)}};function S$(o,t="",a){let u=o;a=a||typeof location<"u"&&location,o==null&&(o=a.protocol+"//"+a.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=a.protocol+o:o=a.host+o),/^(https?|wss?):\/\//.test(o)||(typeof a<"u"?o=a.protocol+"//"+o:o="https://"+o),u=zE(o)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/";const T=u.host.indexOf(":")!==-1?"["+u.host+"]":u.host;return u.id=u.protocol+"://"+T+":"+u.port+t,u.href=u.protocol+"://"+T+(a&&a.port===u.port?"":":"+u.port),u}const A$=typeof ArrayBuffer=="function",I$=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,uO=Object.prototype.toString,C$=typeof Blob=="function"||typeof Blob<"u"&&uO.call(Blob)==="[object BlobConstructor]",R$=typeof File=="function"||typeof File<"u"&&uO.call(File)==="[object FileConstructor]";function oA(o){return A$&&(o instanceof ArrayBuffer||I$(o))||C$&&o instanceof Blob||R$&&o instanceof File}function Wb(o,t){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let a=0,u=o.length;a<u;a++)if(Wb(o[a]))return!0;return!1}if(oA(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return Wb(o.toJSON(),!0);for(const a in o)if(Object.prototype.hasOwnProperty.call(o,a)&&Wb(o[a]))return!0;return!1}function M$(o){const t=[],a=o.data,u=o;return u.data=BE(a,t),u.attachments=t.length,{packet:u,buffers:t}}function BE(o,t){if(!o)return o;if(oA(o)){const a={_placeholder:!0,num:t.length};return t.push(o),a}else if(Array.isArray(o)){const a=new Array(o.length);for(let u=0;u<o.length;u++)a[u]=BE(o[u],t);return a}else if(typeof o=="object"&&!(o instanceof Date)){const a={};for(const u in o)Object.prototype.hasOwnProperty.call(o,u)&&(a[u]=BE(o[u],t));return a}return o}function D$(o,t){return o.data=FE(o.data,t),delete o.attachments,o}function FE(o,t){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<t.length)return t[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let a=0;a<o.length;a++)o[a]=FE(o[a],t);else if(typeof o=="object")for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&(o[a]=FE(o[a],t));return o}const P$=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Fr;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(Fr||(Fr={}));class k${constructor(t){this.replacer=t}encode(t){return(t.type===Fr.EVENT||t.type===Fr.ACK)&&Wb(t)?this.encodeAsBinary({type:t.type===Fr.EVENT?Fr.BINARY_EVENT:Fr.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let a=""+t.type;return(t.type===Fr.BINARY_EVENT||t.type===Fr.BINARY_ACK)&&(a+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(a+=t.nsp+","),t.id!=null&&(a+=t.id),t.data!=null&&(a+=JSON.stringify(t.data,this.replacer)),a}encodeAsBinary(t){const a=M$(t),u=this.encodeAsString(a.packet),y=a.buffers;return y.unshift(u),y}}class lA extends eo{constructor(t){super(),this.reviver=t}add(t){let a;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(t);const u=a.type===Fr.BINARY_EVENT;u||a.type===Fr.BINARY_ACK?(a.type=u?Fr.EVENT:Fr.ACK,this.reconstructor=new L$(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(oA(t)||t.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(t),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let a=0;const u={type:Number(t.charAt(0))};if(Fr[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===Fr.BINARY_EVENT||u.type===Fr.BINARY_ACK){const T=a+1;for(;t.charAt(++a)!=="-"&&a!=t.length;);const C=t.substring(T,a);if(C!=Number(C)||t.charAt(a)!=="-")throw new Error("Illegal attachments");u.attachments=Number(C)}if(t.charAt(a+1)==="/"){const T=a+1;for(;++a&&!(t.charAt(a)===","||a===t.length););u.nsp=t.substring(T,a)}else u.nsp="/";const y=t.charAt(a+1);if(y!==""&&Number(y)==y){const T=a+1;for(;++a;){const C=t.charAt(a);if(C==null||Number(C)!=C){--a;break}if(a===t.length)break}u.id=Number(t.substring(T,a+1))}if(t.charAt(++a)){const T=this.tryParse(t.substr(a));if(lA.isPayloadValid(u.type,T))u.data=T;else throw new Error("invalid payload")}return u}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,a){switch(t){case Fr.CONNECT:return lD(a);case Fr.DISCONNECT:return a===void 0;case Fr.CONNECT_ERROR:return typeof a=="string"||lD(a);case Fr.EVENT:case Fr.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&P$.indexOf(a[0])===-1);case Fr.ACK:case Fr.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class L${constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const a=D$(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function lD(o){return Object.prototype.toString.call(o)==="[object Object]"}const O$=Object.freeze(Object.defineProperty({__proto__:null,Decoder:lA,Encoder:k$,get PacketType(){return Fr}},Symbol.toStringTag,{value:"Module"}));function Wh(o,t,a){return o.on(t,a),function(){o.off(t,a)}}const z$=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hO extends eo{constructor(t,a,u){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=a,u&&u.auth&&(this.auth=u.auth),this._opts=Object.assign({},u),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Wh(t,"open",this.onopen.bind(this)),Wh(t,"packet",this.onpacket.bind(this)),Wh(t,"error",this.onerror.bind(this)),Wh(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...a){var u,y,T;if(z$.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(a.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const C={type:Fr.EVENT,data:a};if(C.options={},C.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const W=this.ids++,Y=a.pop();this._registerAckCallback(W,Y),C.id=W}const s=(y=(u=this.io.engine)===null||u===void 0?void 0:u.transport)===null||y===void 0?void 0:y.writable,V=this.connected&&!(!((T=this.io.engine)===null||T===void 0)&&T._hasPingExpired());return this.flags.volatile&&!s||(V?(this.notifyOutgoingListeners(C),this.packet(C)):this.sendBuffer.push(C)),this.flags={},this}_registerAckCallback(t,a){var u;const y=(u=this.flags.timeout)!==null&&u!==void 0?u:this._opts.ackTimeout;if(y===void 0){this.acks[t]=a;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===t&&this.sendBuffer.splice(s,1);a.call(this,new Error("operation has timed out"))},y),C=(...s)=>{this.io.clearTimeoutFn(T),a.apply(this,s)};C.withError=!0,this.acks[t]=C}emitWithAck(t,...a){return new Promise((u,y)=>{const T=(C,s)=>C?y(C):u(s);T.withError=!0,a.push(T),this.emit(t,...a)})}_addToQueue(t){let a;typeof t[t.length-1]=="function"&&(a=t.pop());const u={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((y,...T)=>(this._queue[0],y!==null?u.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(y)):(this._queue.shift(),a&&a(null,...T)),u.pending=!1,this._drainQueue())),this._queue.push(u),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!t||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Fr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(u=>String(u.id)===t)){const u=this.acks[t];delete this.acks[t],u.withError&&u.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Fr.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Fr.EVENT:case Fr.BINARY_EVENT:this.onevent(t);break;case Fr.ACK:case Fr.BINARY_ACK:this.onack(t);break;case Fr.DISCONNECT:this.ondisconnect();break;case Fr.CONNECT_ERROR:this.destroy();const u=new Error(t.data.message);u.data=t.data.data,this.emitReserved("connect_error",u);break}}onevent(t){const a=t.data||[];t.id!=null&&a.push(this.ack(t.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const u of a)u.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const a=this;let u=!1;return function(...y){u||(u=!0,a.packet({type:Fr.ACK,id:t,data:y}))}}onack(t){const a=this.acks[t.id];typeof a=="function"&&(delete this.acks[t.id],a.withError&&t.data.unshift(null),a.apply(this,t.data))}onconnect(t,a){this.id=t,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Fr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const a=this._anyListeners;for(let u=0;u<a.length;u++)if(t===a[u])return a.splice(u,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const a=this._anyOutgoingListeners;for(let u=0;u<a.length;u++)if(t===a[u])return a.splice(u,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const u of a)u.apply(this,t.data)}}}function tx(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}tx.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),a=Math.floor(t*this.jitter*o);o=(Math.floor(t*10)&1)==0?o-a:o+a}return Math.min(o,this.max)|0};tx.prototype.reset=function(){this.attempts=0};tx.prototype.setMin=function(o){this.ms=o};tx.prototype.setMax=function(o){this.max=o};tx.prototype.setJitter=function(o){this.jitter=o};class VE extends eo{constructor(t,a){var u;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(a=t,t=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,$1(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((u=a.randomizationFactor)!==null&&u!==void 0?u:.5),this.backoff=new tx({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=t;const y=a.parser||O$;this.encoder=new y.Encoder,this.decoder=new y.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var a;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(a=this.backoff)===null||a===void 0||a.setMin(t),this)}randomizationFactor(t){var a;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(a=this.backoff)===null||a===void 0||a.setJitter(t),this)}reconnectionDelayMax(t){var a;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(a=this.backoff)===null||a===void 0||a.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new E$(this.uri,this.opts);const a=this.engine,u=this;this._readyState="opening",this.skipReconnect=!1;const y=Wh(a,"open",function(){u.onopen(),t&&t()}),T=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),t?t(s):this.maybeReconnectOnOpen()},C=Wh(a,"error",T);if(this._timeout!==!1){const s=this._timeout,V=this.setTimeoutFn(()=>{y(),T(new Error("timeout")),a.close()},s);this.opts.autoUnref&&V.unref(),this.subs.push(()=>{this.clearTimeoutFn(V)})}return this.subs.push(y),this.subs.push(C),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Wh(t,"ping",this.onping.bind(this)),Wh(t,"data",this.ondata.bind(this)),Wh(t,"error",this.onerror.bind(this)),Wh(t,"close",this.onclose.bind(this)),Wh(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(a){this.onclose("parse error",a)}}ondecoded(t){H1(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,a){let u=this.nsps[t];return u?this._autoConnect&&!u.active&&u.connect():(u=new hO(this,t,a),this.nsps[t]=u),u}_destroy(t){const a=Object.keys(this.nsps);for(const u of a)if(this.nsps[u].active)return;this._close()}_packet(t){const a=this.encoder.encode(t);for(let u=0;u<a.length;u++)this.engine.write(a[u],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,a){var u;this.cleanup(),(u=this.engine)===null||u===void 0||u.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const u=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(y=>{y?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",y)):t.onreconnect()}))},a);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const pv={};function Xb(o,t){typeof o=="object"&&(t=o,o=void 0),t=t||{};const a=S$(o,t.path||"/socket.io"),u=a.source,y=a.id,T=a.path,C=pv[y]&&T in pv[y].nsps,s=t.forceNew||t["force new connection"]||t.multiplex===!1||C;let V;return s?V=new VE(u,t):(pv[y]||(pv[y]=new VE(u,t)),V=pv[y]),a.query&&!t.query&&(t.query=a.queryKey),V.socket(a.path,t)}Object.assign(Xb,{Manager:VE,Socket:hO,io:Xb,connect:Xb});const N$=({onFinalTranscript:o})=>{const[t,a]=Ue.useState(!1),[u,y]=Ue.useState(""),T=Ue.useRef(null),[C,s]=Ue.useState(new Uint8Array(0)),V=Ue.useRef(null),B=Ue.useRef(null),W=Ue.useRef(null),Y=Ue.useRef(null),ae=Ue.useRef(null),he=Ue.useRef(null);Ue.useRef(0);const[Qe,Ye]=Ue.useState([]);Ue.useEffect(()=>{const Re=()=>{if(typeof window<"u"&&window.speechSynthesis){const Ve=window.speechSynthesis.getVoices();Ye(Ve)}};return Re(),window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=Re),()=>{window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=null)}},[]);const Ke=Ue.useRef(null),at=Ue.useRef(null),nt=Ue.useCallback((Re,Ve)=>{if(console.log("[useVoiceInput] Using browser TTS fallback"),typeof window<"u"&&!("speechSynthesis"in window)){console.error("[useVoiceInput] speechSynthesis not supported"),Ve==null||Ve();return}window.speechSynthesis.cancel();const Je=new SpeechSynthesisUtterance(Re);Ke.current=Je;const He=Qe.length>0?Qe:window.speechSynthesis.getVoices(),tt=He.find(ve=>(ve.name.includes("Samantha")||ve.name.includes("Google US English")||ve.name.includes("Neural"))&&ve.lang.startsWith("en"))||He.find(ve=>ve.lang.startsWith("en"))||He[0];tt&&(Je.voice=tt),Je.rate=1,Je.pitch=1,Je.volume=1,Je.onend=()=>{Ke.current=null,Ve==null||Ve()},Je.onerror=ve=>{console.error("[useVoiceInput] Browser TTS error:",ve)};try{window.speechSynthesis.speak(Je)}catch(ve){console.error("[useVoiceInput] Exception during speak:",ve)}},[Qe]),Ge=Ue.useCallback((Re,Ve,Je)=>{if(console.log("[useVoiceInput] speak called, audio provided:",!!Je),"speechSynthesis"in window&&window.speechSynthesis.cancel(),at.current&&(at.current.pause(),at.current=null),Je){console.log("[useVoiceInput] Playing ElevenLabs audio");try{const He=new Audio(`data:audio/mpeg;base64,${Je}`);at.current=He,He.onended=()=>{console.log("[useVoiceInput] ElevenLabs audio finished"),at.current=null,Ve==null||Ve()},He.onerror=tt=>{console.error("[useVoiceInput] Audio playback error:",tt),at.current=null,nt(Re,Ve)},He.play().catch(tt=>{console.error("[useVoiceInput] Failed to play audio:",tt),nt(Re,Ve)});return}catch(He){console.error("[useVoiceInput] Error creating audio element:",He)}}nt(Re,Ve)},[nt]),Mt=()=>{Y.current&&cancelAnimationFrame(Y.current),W.current&&(W.current.disconnect(),W.current=null),ae.current&&(ae.current.getTracks().forEach(Re=>Re.stop()),ae.current=null)},cn=async()=>{try{const Re=await navigator.mediaDevices.getUserMedia({audio:!0});ae.current=Re,V.current||(V.current=new(window.AudioContext||window.webkitAudioContext)),V.current.state==="suspended"&&await V.current.resume();const Ve=V.current;B.current=Ve.createAnalyser(),B.current.fftSize=256,W.current=Ve.createMediaStreamSource(Re),W.current.connect(B.current);const Je=B.current.frequencyBinCount,He=new Uint8Array(Je),tt=()=>{B.current&&(B.current.getByteFrequencyData(He),s(new Uint8Array(He)),Y.current=requestAnimationFrame(tt))};tt()}catch(Re){console.error("Error accessing microphone for visualization:",Re)}},St=Ue.useCallback(()=>{T.current&&T.current.stop(),Mt(),a(!1),he.current&&(clearTimeout(he.current),he.current=null)},[]),Oe=Ue.useCallback(()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel();const Re=window.SpeechRecognition||window.webkitSpeechRecognition;if(!Re){alert("Your browser does not support voice recognition. Please use Chrome or Safari.");return}const Ve=new Re;Ve.continuous=!0,Ve.interimResults=!0,Ve.lang="en-US",Ve.onresult=Je=>{let He="",tt="";for(let Ht=Je.resultIndex;Ht<Je.results.length;++Ht)Je.results[Ht].isFinal?tt+=Je.results[Ht][0].transcript:He+=Je.results[Ht][0].transcript;const ve=Array.from(Je.results).map(Ht=>Ht[0].transcript).join("");y(ve)},Ve.onerror=Je=>{console.error("Speech recognition error",Je.error),Je.error==="not-allowed"&&(a(!1),Mt())},Ve.onend=()=>{a(!1),Mt()},T.current=Ve,Ve.start(),a(!0),y(""),cn()},[o,St]);return{isListening:t,transcript:u,startListening:Oe,stopListening:St,audioData:C,speak:Ge}},B$=({audioData:o})=>{const t=Ue.useRef(null);return Ue.useEffect(()=>{const a=t.current;if(!a)return;const u=a.getContext("2d");if(!u)return;const y=window.devicePixelRatio||1,T=a.getBoundingClientRect();a.width=T.width*y,a.height=T.height*y,u.scale(y,y);const C=T.width,s=T.height,V=s/2;u.clearRect(0,0,C,s);let B=0;for(let Ge=0;Ge<o.length;Ge++)B+=o[Ge];const W=o.length>0?B/o.length/255:0,Y=5,ae=4,he=6,Qe=Y*ae+(Y-1)*he,Ye=(C-Qe)/2,Ke=s*.7,at=4,nt=u.createLinearGradient(0,0,0,s);nt.addColorStop(0,"#4e4235"),nt.addColorStop(.5,"#6b5a47"),nt.addColorStop(1,"#4e4235"),u.fillStyle=nt,u.lineCap="round";for(let Ge=0;Ge<Y;Ge++){const Mt=Math.floor(Ge/Y*(o.length*.5)),St=(o[Mt]||0)/255,Oe=Date.now()/200,Re=Math.sin(Oe+Ge*.8)*.3+.7,Ve=Math.max(St*1.2,W*.5)*Re,Je=Math.max(at,Ve*Ke),He=Ye+Ge*(ae+he),tt=V-Je/2;u.beginPath(),u.roundRect(He,tt,ae,Je,ae/2),u.fill()}},[o]),N.jsx("canvas",{ref:t,className:"w-16 h-10",style:{width:"64px",height:"40px"}})},F$=()=>{const{user:o}=$m(),[t,a]=Ue.useState([{role:"model",text:"Hello! I am your Health.me AI assistant. I have access to your health records and current vitals. How can I help you today?"}]),[u,y]=Ue.useState(""),[T,C]=Ue.useState(!1),[s,V]=Ue.useState(null),[B,W]=Ue.useState(null),[Y]=JB(),[ae,he]=Ue.useState(null),[Qe,Ye]=Ue.useState(!1),[Ke,at]=Ue.useState("none"),[nt,Ge]=Ue.useState(!1);Ue.useEffect(()=>{if(!o)return;const Cn=Y.get("session"),_r=(async()=>{try{let Hi;Cn?(Hi=Cn,he(Cn),await g8(o.uid,Hi)):(Hi=await p8(o.uid),he(null)),W(Hi);const Wr=f8(o.uid,Hi,tr=>{tr.length>0?a(tr.map(yr=>({role:yr.role,text:yr.text}))):a([{role:"model",text:"Hello! I am your Health.me AI assistant. I have access to your health records and current vitals. How can I help you today?"}])});return Ye(!1),Wr}catch(Hi){console.error("Error initializing Firestore chat:",Hi)}})();return()=>{_r==null||_r.then(Hi=>Hi==null?void 0:Hi())}},[o,Y]);const Mt=Cn=>{$n(Cn)},{isListening:cn,transcript:St,startListening:Oe,stopListening:Re,audioData:Ve,speak:Je}=N$({onFinalTranscript:Mt}),He=Ue.useRef(null),tt=ff();Ue.useEffect(()=>{He.current&&(He.current.scrollTop=He.current.scrollHeight)},[t,T]);const ve=Ue.useRef(null),[Ht,dn]=Ue.useState([]),[wt,Kt]=Ue.useState(!1),[wn,Kn]=Ue.useState([]),[it,ft]=Ue.useState(!1),[Qt,Be]=Ue.useState(""),[En,Qn]=Ue.useState("");Ue.useEffect(()=>{const Cn=Xb("http://35.203.120.186:3001");return ve.current=Cn,Cn.on("connect",()=>{console.log("Connected to backend WS")}),Cn.on("show_clinics",()=>{at("location")}),Cn.on("show_calendar",vi=>{dn(vi),at("schedule")}),Cn.on("call_started",()=>{Ge(!0)}),Cn.on("emergency_trigger",()=>{Kt(!1),Kt(!0)}),Cn.on("call_transcript_update",(vi,_r)=>{console.log("[Frontend] Received transcript update:",_r),Kn(Hi=>[...Hi,_r])}),Cn.on("chat_response",vi=>{C(!1),a(_r=>[..._r,{role:"model",text:vi.content}]),Je(vi.content,void 0,vi.audio)}),Cn.on("agent_needs_input",vi=>{ft(!0),Be(vi.question),Qn(vi.context||"The receptionist is asking for this information."),at("question")}),Cn.on("agent_input_received",()=>{ft(!1),Be(""),Qn("")}),()=>{Cn.disconnect()}},[Je]);const $n=async Cn=>{const vi=Cn||u;if(!vi.trim()||T)return;Cn||y("");const _r={role:"user",text:vi};a(Hi=>[...Hi,_r]),C(!0),o&&B&&oM(o.uid,B,_r);try{const Hi=await fetch("http://35.203.120.186:3001/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:vi,conversation_id:s})});if(!Hi.ok)throw new Error(`Server returned ${Hi.status} ${Hi.statusText}`);const Wr=await Hi.json();if(Wr.conversation_id&&V(Wr.conversation_id),Wr.message){const tr={role:"model",text:Wr.message};a(yr=>[...yr,tr]),o&&B&&oM(o.uid,B,tr),Je(Wr.message,void 0,Wr.audio)}C(!1)}catch(Hi){console.error("Chat Error:",Hi),a(Wr=>[...Wr,{role:"model",text:"Connection error. Please check backend."}]),C(!1)}},ki=async()=>{Kt(!1),Ge(!0),a(Cn=>[...Cn,{role:"model",text:"Connecting you to emergency services at 438 520 2457..."}]),await fetch("http://35.203.120.186:3001/call/initiate",{method:"POST",body:JSON.stringify({type:"emergency",phone:"+14385202457",userId:o==null?void 0:o.uid}),headers:{"Content-Type":"application/json"}})},er=async()=>{if(a([{role:"model",text:"New conversation started. How can I assist you with your health today?"}]),Ye(!1),he(null),V(null),o)try{const Cn=await hL(o.uid);W(Cn);const vi=Hm(td,"users",o.uid,"activeChat","current");await t0(vi,{chatId:Cn}),console.log("[Chat] Created new Firestore chat:",Cn)}catch(Cn){console.error("[Chat] Failed to create new Firestore chat:",Cn)}tt("/chat")},qn=async Cn=>{at("none"),Ge(!0),a(vi=>[...vi,{role:"model",text:`Calling ${Cn.name} to schedule your appointment... Our AI assistant will speak with the receptionist on your behalf.`}]);try{await fetch("http://35.203.120.186:3001/call/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:"+18194755578",clinic_name:Cn.name,userId:o==null?void 0:o.uid})})}catch(vi){console.error("Failed to initiate call:",vi),a(_r=>[..._r,{role:"model",text:"Sorry, there was an issue connecting the call. Please try again."}]),Ge(!1)}},Ni=async Cn=>{at("none");const vi=`${Cn.day}, the ${Cn.date} at ${Cn.time}`;try{await fetch("http://35.203.120.186:3001/call/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:vi})}),a(_r=>[..._r,{role:"model",text:`Great! I've told the clinic you'd like the appointment on ${vi}. The receptionist is confirming now...`}])}catch(_r){console.error("Failed to send appointment selection:",_r),a(Hi=>[...Hi,{role:"model",text:`Appointment selected: ${vi}. (Note: Could not update the call)`}])}},Vr=async Cn=>{ft(!1),Be(""),Qn(""),Kn(vi=>[...vi,{message:Cn,sender:"bot"}]);try{await fetch("http://35.203.120.186:3001/call/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:Cn})}),at("none")}catch(vi){console.error("Failed to send user response:",vi)}},Fa=Ke!=="none"||nt;return N.jsxs("div",{className:"flex h-full bg-soft-cream relative overflow-hidden",children:[N.jsx("div",{className:"flex flex-col h-full flex-1 relative transition-all duration-500",children:N.jsxs("div",{className:"max-w-4xl mx-auto w-full flex flex-col h-full px-6",children:[N.jsxs("div",{className:"py-6 border-b border-black/5 flex justify-between items-center flex-shrink-0",children:[N.jsx("div",{className:"flex items-center gap-4",children:N.jsxs("div",{children:[N.jsx("h1",{className:"serif-font text-3xl text-primary",children:"AI Health Assistant"}),N.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:N.jsxs("div",{className:"px-2 py-0.5 bg-green-50 rounded-full flex items-center space-x-1.5 border border-green-100",children:[N.jsx("span",{className:"size-1 rounded-full bg-green-500"}),N.jsx("span",{className:"text-[9px] font-black text-green-700 uppercase tracking-widest",children:"Secure session"})]})})]})}),N.jsxs("div",{className:"flex items-center space-x-2",children:[N.jsxs("button",{onClick:()=>at(Ke==="location"?"none":"location"),className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${Ke==="location"?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),"Locations"]}),N.jsxs("button",{onClick:()=>at(Ke==="schedule"?"none":"schedule"),className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${Ke==="schedule"?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_month"}),"Schedule"]}),N.jsx("button",{onClick:async()=>{nt?(Ge(!1),Kn([])):Ge(!0)},className:`flex items-center gap-2 border border-black/5 px-4 py-2 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm ${nt?"bg-primary text-white":"bg-white text-primary hover:bg-black hover:text-white"}`,children:nt?N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"call_end"}),N.jsx("span",{className:"text-[11px] font-black uppercase tracking-wider",children:"End"})]}):N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined text-sm",children:"phone_in_talk"}),N.jsx("span",{className:"text-[11px] font-black uppercase tracking-wider",children:"Call"})]})})]})]}),N.jsxs("div",{ref:He,className:"flex-1 overflow-y-auto py-8 space-y-8 custom-scrollbar pr-2 scroll-smooth",children:[t.map((Cn,vi)=>N.jsx("div",{className:`flex ${Cn.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:N.jsxs("div",{className:`flex gap-4 max-w-[90%] ${Cn.role==="user"?"flex-row-reverse":"flex-row"}`,children:[N.jsx("div",{className:`size-9 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-bold shadow-sm ${Cn.role==="user"?"bg-black text-white":"bg-primary text-white"}`,children:Cn.role==="user"?"AM":N.jsx("span",{className:"material-symbols-outlined text-base",children:"smart_toy"})}),N.jsx("div",{className:`rounded-3xl p-5 shadow-sm border border-black/5 ${Cn.role==="user"?"bg-primary text-white rounded-tr-none":"bg-white text-primary rounded-tl-none"}`,children:Cn.role==="user"?N.jsx("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap",children:Cn.text}):N.jsx("div",{className:"text-[15px] leading-relaxed prose prose-sm max-w-none prose-headings:text-primary prose-strong:text-primary prose-ul:my-2 prose-li:my-0.5",children:N.jsx(GH,{children:Cn.text})})})]})},vi)),T&&N.jsx("div",{className:"flex justify-start",children:N.jsxs("div",{className:"flex gap-4",children:[N.jsx("div",{className:"size-9 rounded-full bg-primary flex items-center justify-center shadow-sm",children:N.jsx("span",{className:"material-symbols-outlined text-white text-base",children:"smart_toy"})}),N.jsxs("div",{className:"bg-white text-primary rounded-3xl rounded-tl-none p-5 shadow-sm border border-black/5 flex space-x-2 items-center",children:[N.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),N.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),N.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"})]})]})})]}),N.jsxs("div",{className:"py-8 flex-shrink-0",children:[Qe?N.jsxs("div",{className:"bg-gray-100 border border-black/5 rounded-[32px] p-4 flex items-center justify-center gap-3",children:[N.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"lock"}),N.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"This conversation is completed and read-only"}),N.jsx("button",{onClick:er,className:"ml-4 bg-primary text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-black transition-all",children:"Start New Chat"})]}):N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsxs("button",{onClick:er,className:"group flex flex-col items-center justify-center size-14 rounded-3xl bg-white border border-black/5 text-gray-400 hover:text-primary hover:border-primary transition-all duration-200 hover:scale-[1.02] active:scale-95 shadow-sm",title:"New Conversation",children:[N.jsx("span",{className:"material-symbols-outlined text-2xl group-hover:scale-110 transition-transform",children:"add_comment"}),N.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter mt-0.5",children:"New"})]}),cn?N.jsxs("div",{className:"flex-1 bg-white border-2 border-primary/30 shadow-2xl rounded-[32px] p-2 flex items-center gap-2 animate-in fade-in zoom-in duration-300 min-w-0",children:[N.jsxs("div",{className:"flex items-center gap-2 px-3 flex-shrink-0",children:[N.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 animate-pulse"}),N.jsx(B$,{audioData:Ve})]}),N.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:N.jsx("p",{className:"text-[15px] text-gray-800 truncate",children:St||N.jsx("span",{className:"text-gray-400 italic",children:"Listening..."})})}),N.jsx("button",{onClick:()=>{St.trim()&&(Re(),$n(St.trim()))},disabled:!St.trim(),className:`size-11 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center flex-shrink-0 ${St.trim()?"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10":"bg-gray-100 text-gray-400"}`,title:"Send Message",children:N.jsx("span",{className:"material-symbols-outlined",children:"arrow_upward"})}),N.jsx("button",{onClick:Re,className:"size-11 rounded-2xl bg-red-50 text-red-500 hover:bg-red-100 hover:text-red-600 transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center flex-shrink-0",title:"Cancel",children:N.jsx("span",{className:"material-symbols-outlined text-xl",children:"close"})})]}):N.jsxs("div",{className:"flex-1 bg-white border border-black/5 shadow-2xl rounded-[32px] p-2 flex items-center space-x-2 focus-within:ring-2 focus-within:ring-primary/10 transition-all",children:[N.jsx("button",{onClick:()=>Oe(),className:"p-3 text-gray-400 hover:text-primary hover:bg-gray-50 rounded-full transition-all group",title:"Voice Input",children:N.jsx("span",{className:"material-symbols-outlined group-hover:scale-110 transition-transform",children:"mic"})}),N.jsx("input",{className:"flex-1 bg-transparent border-none focus:ring-0 text-[15px] placeholder:text-gray-400 py-3",placeholder:"Ask about symptoms or bookings...",type:"text",value:u,onChange:Cn=>y(Cn.target.value),onKeyDown:Cn=>Cn.key==="Enter"&&$n()}),N.jsx("button",{onClick:()=>$n(),disabled:T||!u.trim(),className:`size-11 rounded-2xl transition-all duration-200 hover:scale-[1.02] active:scale-95 flex items-center justify-center ${T||!u.trim()?"bg-gray-100 text-gray-400":"bg-primary text-white hover:bg-black active:scale-95 shadow-lg shadow-black/10"}`,children:N.jsx("span",{className:"material-symbols-outlined",children:"arrow_upward"})})]})]}),!Qe&&N.jsxs("div",{className:"mt-4 flex justify-center gap-6 opacity-40",children:[N.jsxs("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[N.jsx("span",{className:"material-symbols-outlined text-[12px] fill-1",children:"verified"}),"HIPAA Compliant"]}),N.jsxs("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[N.jsx("span",{className:"material-symbols-outlined text-[12px] fill-1",children:"lock"}),"Private Session"]})]})]})]})}),N.jsx("div",{className:`bg-white border-l border-black/5 shadow-xl transition-all duration-500 ease-in-out flex flex-col ${Fa?"w-full lg:w-1/2 translate-x-0":"w-0 translate-x-full opacity-0"}`,children:N.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[Ke!=="none"&&N.jsxs("div",{className:`flex-1 flex flex-col min-h-0 ${nt?"h-[60%]":"h-full"}`,children:[Ke==="location"&&N.jsx(j7,{onClose:()=>at("none"),onClinicSelect:qn}),Ke==="schedule"&&N.jsx("div",{className:"h-full overflow-y-auto",children:N.jsx(WH,{onClose:()=>at("none"),onConfirm:Ni,availableSlots:Ht})}),Ke==="question"&&N.jsx(U7,{onClose:()=>{},onSubmit:Vr,question:Qt})]}),nt&&N.jsx("div",{className:`${Ke!=="none"?"flex-shrink-0":"flex-1 h-full"}`,children:N.jsx(XH,{onClose:()=>{Ge(!1),Kn([])},minimized:Ke!=="none",transcript:wn})})]})}),wt&&N.jsx(q7,{onCancel:()=>Kt(!1),onConfirm:ki})]})},V$=()=>{var St;const{user:o}=$m(),[t,a]=Ue.useState(!0),[u,y]=Ue.useState(!1),[T,C]=Ue.useState(!1),[s,V]=Ue.useState(null),[B,W]=Ue.useState(null),[Y,ae]=Ue.useState(!0),[he,Qe]=Ue.useState(!0),[Ye,Ke]=Ue.useState(!1),[at,nt]=Ue.useState("en");Ue.useEffect(()=>{(async()=>{if(o){a(!0);try{const Re=await Vv(o.uid);Re&&W(Re)}catch(Re){console.error("Error loading profile:",Re)}finally{a(!1)}}})()},[o]);const Ge=async()=>{if(!(!o||!B)){y(!0),V(null);try{await US(o.uid,B),V({type:"success",text:"Profile updated successfully!"}),C(!1),setTimeout(()=>V(null),3e3)}catch(Oe){console.error("Error saving profile:",Oe),V({type:"error",text:"Failed to save. Please try again."})}finally{y(!1)}}},Mt=()=>{C(!1),o&&Vv(o.uid).then(Oe=>Oe&&W(Oe))},cn=({value:Oe,onChange:Re})=>N.jsx("button",{onClick:()=>Re(!Oe),className:`w-12 h-6 rounded-full relative transition-all ${Oe?"bg-green-500":"bg-gray-200"}`,children:N.jsx("div",{className:`size-5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm ${Oe?"left-6":"left-0.5"}`})});return t?N.jsx("div",{className:"max-w-3xl mx-auto p-8 flex items-center justify-center min-h-[400px]",children:N.jsx("span",{className:"material-symbols-outlined animate-spin text-4xl text-gray-400",children:"progress_activity"})}):N.jsxs("div",{className:"max-w-3xl mx-auto p-8",children:[N.jsxs("div",{className:"mb-10 flex items-start justify-between",children:[N.jsxs("div",{children:[N.jsx("h1",{className:"serif-font text-4xl text-primary mb-2",children:"Settings"}),N.jsx("p",{className:"text-gray-500 text-sm",children:"Manage your account and health profile"})]}),B&&!T&&N.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 bg-primary text-white px-5 py-2.5 rounded-2xl text-sm font-bold hover:bg-black transition-all shadow-lg shadow-black/10",children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"}),"Edit Profile"]}),T&&N.jsxs("div",{className:"flex gap-2",children:[N.jsx("button",{onClick:Mt,className:"px-5 py-2.5 rounded-2xl text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition-all",children:"Cancel"}),N.jsxs("button",{onClick:Ge,disabled:u,className:"flex items-center gap-2 bg-green-500 text-white px-5 py-2.5 rounded-2xl text-sm font-bold hover:bg-green-600 transition-all shadow-lg shadow-green-500/20",children:[u&&N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Save Changes"]})]})]}),s&&N.jsxs("div",{className:`mb-6 p-4 rounded-2xl flex items-center gap-3 animate-in slide-in-from-top duration-300 ${s.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[N.jsx("span",{className:"material-symbols-outlined",children:s.type==="success"?"check_circle":"error"}),N.jsx("span",{className:"text-sm font-medium",children:s.text})]}),N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Account"}),N.jsx("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden",children:N.jsxs("div",{className:"p-6 flex items-center gap-4",children:[N.jsx("div",{className:"size-16 rounded-full overflow-hidden border-2 border-black/5 shadow-sm",children:o!=null&&o.photoURL?N.jsx("img",{src:o.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):N.jsx("div",{className:"w-full h-full bg-primary flex items-center justify-center text-white text-xl font-bold",children:((St=o==null?void 0:o.displayName)==null?void 0:St.charAt(0))||"U"})}),N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"font-bold text-lg text-primary",children:(o==null?void 0:o.displayName)||"User"}),N.jsx("p",{className:"text-sm text-gray-400",children:o==null?void 0:o.email})]}),N.jsx("div",{className:"px-3 py-1.5 bg-gray-50 rounded-xl border border-black/5",children:N.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Google Account"})})]})})]}),B&&N.jsxs(N.Fragment,{children:[N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Personal Details"}),N.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-blue-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"phone"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Phone"})]}),T?N.jsx("input",{type:"tel",className:"w-48 px-4 py-2.5 rounded-xl bg-gray-50 border border-black/10 text-sm text-primary focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",value:B.personalInfo.phone||"",onChange:Oe=>W(Re=>Re?{...Re,personalInfo:{...Re.personalInfo,phone:Oe.target.value}}:null),placeholder:"(555) 123-4567"}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.personalInfo.phone||""})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-purple-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-purple-500",children:"cake"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Date of Birth"})]}),T?N.jsx("input",{type:"date",className:"px-4 py-2.5 rounded-xl bg-gray-50 border border-black/10 text-sm text-primary focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",value:B.personalInfo.dateOfBirth||"",onChange:Oe=>W(Re=>Re?{...Re,personalInfo:{...Re.personalInfo,dateOfBirth:Oe.target.value}}:null)}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.personalInfo.dateOfBirth||""})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-pink-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-pink-500",children:"wc"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Gender"})]}),T?N.jsx("div",{className:"flex gap-2",children:["Male","Female","Other"].map(Oe=>N.jsx("button",{onClick:()=>W(Re=>Re?{...Re,personalInfo:{...Re.personalInfo,gender:Oe}}:null),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all ${B.personalInfo.gender===Oe?"bg-primary text-white shadow-md":"bg-gray-50 text-gray-500 hover:bg-gray-100 border border-black/5"}`,children:Oe},Oe))}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.personalInfo.gender||""})]})]})]}),N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Emergency Contact"}),N.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-amber-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"person"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Name"})]}),T?N.jsx("input",{type:"text",className:"w-48 px-4 py-2.5 rounded-xl bg-gray-50 border border-black/10 text-sm text-primary focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",value:B.emergencyContact.name||"",onChange:Oe=>W(Re=>Re?{...Re,emergencyContact:{...Re.emergencyContact,name:Oe.target.value}}:null),placeholder:"Contact name"}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.emergencyContact.name||""})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-teal-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-teal-500",children:"family_restroom"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Relationship"})]}),T?N.jsx("div",{className:"flex flex-wrap gap-1.5 justify-end max-w-[320px]",children:["Spouse","Parent","Sibling","Child","Friend","Other"].map(Oe=>N.jsx("button",{onClick:()=>W(Re=>Re?{...Re,emergencyContact:{...Re.emergencyContact,relationship:Oe}}:null),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${B.emergencyContact.relationship===Oe?"bg-primary text-white shadow-md":"bg-gray-50 text-gray-500 hover:bg-gray-100 border border-black/5"}`,children:Oe},Oe))}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.emergencyContact.relationship||""})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-indigo-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-indigo-500",children:"call"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Phone"})]}),T?N.jsx("input",{type:"tel",className:"w-48 px-4 py-2.5 rounded-xl bg-gray-50 border border-black/10 text-sm text-primary focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",value:B.emergencyContact.phone||"",onChange:Oe=>W(Re=>Re?{...Re,emergencyContact:{...Re.emergencyContact,phone:Oe.target.value}}:null),placeholder:"(555) 123-4567"}):N.jsx("span",{className:"text-sm text-gray-500 font-medium",children:B.emergencyContact.phone||""})]})]})]})]}),N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Notifications"}),N.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-blue-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"notifications"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-medium text-primary",children:"Push Notifications"}),N.jsx("p",{className:"text-xs text-gray-400",children:"Receive alerts on your device"})]})]}),N.jsx(cn,{value:Y,onChange:ae})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-green-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-green-500",children:"mail"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-medium text-primary",children:"Email Alerts"}),N.jsx("p",{className:"text-xs text-gray-400",children:"Get updates via email"})]})]}),N.jsx(cn,{value:he,onChange:Qe})]}),N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-purple-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-purple-500",children:"sms"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-medium text-primary",children:"SMS Notifications"}),N.jsx("p",{className:"text-xs text-gray-400",children:"Receive text message alerts"})]})]}),N.jsx(cn,{value:Ye,onChange:Ke})]})]})]}),N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Preferences"}),N.jsx("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden",children:N.jsxs("div",{className:"p-5 flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-gray-100 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-gray-500",children:"language"})}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm font-medium text-primary",children:"Language"}),N.jsx("p",{className:"text-xs text-gray-400",children:"Select your preferred language"})]})]}),N.jsxs("select",{value:at,onChange:Oe=>nt(Oe.target.value),className:"bg-gray-50 border border-black/5 rounded-xl px-4 py-2.5 text-sm text-primary font-medium focus:outline-none focus:ring-2 focus:ring-primary/20",children:[N.jsx("option",{value:"en",children:"English"}),N.jsx("option",{value:"fr",children:"Franais"}),N.jsx("option",{value:"es",children:"Espaol"})]})]})})]}),N.jsxs("section",{className:"mb-8",children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Legal"}),N.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden divide-y divide-black/5",children:[N.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all group",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-gray-100 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-gray-500",children:"description"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Privacy Policy"})]}),N.jsx("span",{className:"material-symbols-outlined text-gray-300 group-hover:text-gray-400 transition-colors",children:"chevron_right"})]}),N.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-gray-50 transition-all group",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-gray-100 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-gray-500",children:"gavel"})}),N.jsx("span",{className:"text-sm font-medium text-primary",children:"Terms of Service"})]}),N.jsx("span",{className:"material-symbols-outlined text-gray-300 group-hover:text-gray-400 transition-colors",children:"chevron_right"})]})]})]}),N.jsxs("section",{children:[N.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-red-400 mb-4 px-1",children:"Danger Zone"}),N.jsx("div",{className:"bg-white rounded-3xl border border-red-100 shadow-sm overflow-hidden",children:N.jsxs("button",{className:"w-full p-5 flex items-center justify-between hover:bg-red-50 transition-all group",children:[N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsx("div",{className:"size-10 rounded-xl bg-red-50 flex items-center justify-center",children:N.jsx("span",{className:"material-symbols-outlined text-red-500",children:"delete"})}),N.jsx("span",{className:"text-sm font-medium text-red-500",children:"Delete Account"})]}),N.jsx("span",{className:"material-symbols-outlined text-red-300 group-hover:text-red-400 transition-colors",children:"chevron_right"})]})})]}),N.jsx("div",{className:"mt-12 text-center",children:N.jsx("p",{className:"text-xs text-gray-300 font-medium",children:"Health.me v1.0.0"})})]})},j$=({onSignUp:o})=>{const t=ff(),[a,u]=Ue.useState(!1),[y,T]=Ue.useState(!1),[C,s]=Ue.useState(!1),V=async B=>{B.preventDefault(),u(!0),await new Promise(W=>setTimeout(W,500)),u(!1),o(),t("/onboarding")};return N.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[N.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[N.jsx("img",{src:GS,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),N.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[N.jsx("div",{className:"flex items-center space-x-2 mb-6",children:N.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),N.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Your health journey starts here."'})]})]}),N.jsx("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:N.jsxs("div",{className:"w-full max-w-[440px]",children:[N.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-[40px] shadow-sm border border-black/5",children:[N.jsxs("div",{className:"text-center mb-10",children:[N.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-soft-cream mb-6",children:N.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"person_add"})}),N.jsx("h1",{className:"serif-font text-4xl text-primary mb-3 leading-tight",children:"Create account"}),N.jsx("p",{className:"text-gray-500 text-[15px]",children:"Start managing your health journey today."})]}),N.jsxs("form",{onSubmit:V,className:"space-y-5",children:[N.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"firstName",children:"First Name"}),N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"firstName",placeholder:"Alex",type:"text",required:!0})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"lastName",children:"Last Name"}),N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"lastName",placeholder:"McGregor",type:"text",required:!0})]})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"email",children:"Email Address"}),N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"email",placeholder:"name@example.com",type:"email",required:!0})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"password",children:"Password"}),N.jsxs("div",{className:"relative",children:[N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"password",placeholder:"Min. 8 characters",type:y?"text":"password",required:!0}),N.jsx("button",{type:"button",onClick:()=>T(!y),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:N.jsx("span",{className:"material-symbols-outlined text-lg",children:y?"visibility_off":"visibility"})})]})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",htmlFor:"confirmPassword",children:"Confirm Password"}),N.jsxs("div",{className:"relative",children:[N.jsx("input",{className:"w-full px-4 py-3.5 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",id:"confirmPassword",placeholder:"",type:C?"text":"password",required:!0}),N.jsx("button",{type:"button",onClick:()=>s(!C),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors focus:outline-none",children:N.jsx("span",{className:"material-symbols-outlined text-lg",children:C?"visibility_off":"visibility"})})]})]}),N.jsxs("div",{className:"flex items-start gap-3 py-2",children:[N.jsx("input",{type:"checkbox",id:"terms",className:"mt-1 w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary",required:!0}),N.jsxs("label",{htmlFor:"terms",className:"text-xs text-gray-500 leading-relaxed",children:["I agree to the ",N.jsx("a",{href:"#",className:"text-primary font-bold hover:underline",children:"Terms of Service"})," and ",N.jsx("a",{href:"#",className:"text-primary font-bold hover:underline",children:"Privacy Policy"})]})]}),N.jsx("button",{className:"w-full bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all transform active:scale-[0.99] text-[15px] shadow-lg shadow-black/10 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"submit",disabled:a,children:a?N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"Creating account..."]}):"Create Account"})]}),N.jsxs("p",{className:"mt-8 text-center text-[13px] text-gray-500",children:["Already have an account? ",N.jsx("a",{href:"#/login",className:"font-bold text-primary hover:underline",children:"Sign in"})]})]}),N.jsx("div",{className:"mt-12 text-center",children:N.jsxs("div",{className:"flex justify-center gap-6 text-gray-300 mb-4",children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"verified_user"}),N.jsx("span",{className:"material-symbols-outlined text-xl",children:"shield"}),N.jsx("span",{className:"material-symbols-outlined text-xl",children:"info"})]})})]})})]})},U$=()=>{const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=new Date().getDay(),u=8,y=20,T=Array.from({length:y-u+1},(nt,Ge)=>Ge+u),s=(()=>{const nt=new Date,Ge=nt.getDate()-nt.getDay();return o.map((Mt,cn)=>new Date(nt.setDate(Ge+cn)).getDate())})(),[V,B]=Ue.useState([{id:"1",title:"Cardiology Follow-up",location:"City Clinic",day:1,startHour:10,endHour:11,type:"medical"},{id:"2",title:"Appt with Dr. Strange",location:"General Hospital",day:2,startHour:14,endHour:15,type:"medical"},{id:"3",title:"Annual Physical",location:"Clinique Mdicale",day:4,startHour:9,endHour:10.5,type:"medical"},{id:"4",title:"Physiotherapy",location:"Physio Extra",day:3,startHour:16.5,endHour:17.5,type:"medical"},{id:"5",title:"Blood Work",location:"CLSC Metro",day:5,startHour:8.5,endHour:9,type:"medical"}]),[W,Y]=Ue.useState(!1),[ae,he]=Ue.useState({day:a,startHour:9,endHour:10,type:"medical"}),Qe=nt=>({top:`${(nt.startHour-u)*60}px`,height:`${(nt.endHour-nt.startHour)*60}px`}),Ye=()=>{const nt=new Date;return(nt.getHours()+nt.getMinutes()/60-u)*60},Ke={medical:"bg-red-50 border-red-100 text-red-700 hover:bg-red-100"},at=nt=>{if(nt.preventDefault(),!ae.title||ae.day===void 0||ae.startHour===void 0||ae.endHour===void 0)return;const Ge={id:Math.random().toString(36).substr(2,9),title:ae.title,location:ae.location||"",day:ae.day,startHour:Number(ae.startHour),endHour:Number(ae.endHour),type:"medical"};B([...V,Ge]),Y(!1),he({day:a,startHour:9,endHour:10,type:"medical"})};return N.jsxs("div",{className:"h-full bg-soft-cream flex flex-col relative overflow-hidden font-sans",children:[N.jsxs("div",{className:"p-8 pb-6 flex justify-between items-end",children:[N.jsxs("div",{children:[N.jsx("h1",{className:"serif-font text-4xl text-primary mb-2",children:"Medical Schedule"}),N.jsx("p",{className:"text-gray-500 text-sm",children:"Manage your upcoming doctor's appointments"})]}),N.jsxs("button",{onClick:()=>Y(!0),className:"bg-primary text-white rounded-2xl px-6 py-3 font-bold text-sm shadow-lg hover:bg-black transition-all flex items-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-xl",children:"add"}),"Add Appointment"]})]}),N.jsx("div",{className:"flex-1 overflow-y-auto p-6 pt-0 custom-scrollbar",children:N.jsxs("div",{className:"bg-white rounded-3xl border border-black/5 shadow-sm overflow-hidden flex flex-col min-w-[800px]",children:[N.jsxs("div",{className:"grid grid-cols-8 border-b border-black/5 bg-gray-50/50 sticky top-0 z-30 backdrop-blur-sm",children:[N.jsx("div",{className:"p-4 border-r border-black/5 text-center text-xs font-bold text-gray-400 uppercase tracking-widest pt-6",children:"Time"}),o.map((nt,Ge)=>N.jsxs("div",{className:`p-4 border-r border-black/5 last:border-r-0 text-center ${Ge===a?"bg-primary/5":""}`,children:[N.jsx("p",{className:`text-xs font-bold uppercase tracking-widest mb-1 ${Ge===a?"text-primary":"text-gray-400"}`,children:nt}),N.jsx("div",{className:`size-10 mx-auto rounded-full flex items-center justify-center font-bold text-lg transition-colors ${Ge===a?"bg-primary text-white shadow-md":"text-gray-700"}`,children:s[Ge]})]},nt))]}),N.jsxs("div",{className:"flex relative items-start",children:[N.jsx("div",{className:"w-[12.5%] flex-shrink-0 border-r border-black/5 bg-gray-50/30",children:T.map(nt=>N.jsx("div",{className:"h-[60px] border-b border-black/5 px-4 py-2 text-right",children:N.jsx("span",{className:"text-[11px] font-bold text-gray-400 block -mt-2.5",children:nt===12?"12 PM":nt>12?`${nt-12} PM`:`${nt} AM`})},nt))}),N.jsx("div",{className:"flex-1 grid grid-cols-7 relative",children:o.map((nt,Ge)=>N.jsxs("div",{className:`border-r border-black/5 last:border-r-0 relative ${Ge===a?"bg-primary/5":""}`,children:[T.map(Mt=>N.jsx("div",{className:"h-[60px] border-b border-black/5"},Mt)),V.filter(Mt=>Mt.day===Ge).map(Mt=>N.jsxs("div",{className:`absolute left-1 right-1 rounded-xl p-2 border shadow-sm cursor-pointer transition-all hover:scale-[1.02] hover:z-20 hover:shadow-md flex flex-col overflow-hidden ${Ke[Mt.type]}`,style:Qe(Mt),children:[N.jsx("p",{className:"text-[11px] font-black leading-tight mb-0.5 truncate",children:Mt.title}),Mt.location&&N.jsxs("p",{className:"text-[10px] font-medium opacity-90 truncate flex items-center gap-1 mb-1",children:[N.jsx("span",{className:"material-symbols-outlined text-[10px] leading-none",children:"location_on"}),Mt.location]}),N.jsxs("p",{className:"text-[9px] font-bold mt-auto opacity-70",children:[Math.floor(Mt.startHour),":",(Mt.startHour%1*60).toString().padStart(2,"0")," - ",Math.floor(Mt.endHour),":",(Mt.endHour%1*60).toString().padStart(2,"0")]})]},Mt.id)),Ge===a&&N.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-red-500 z-10 pointer-events-none",style:{top:`${Ye()}px`,display:new Date().getHours()<u||new Date().getHours()>y?"none":"block"},children:N.jsx("div",{className:"absolute -left-1.5 -top-1.5 size-3 rounded-full bg-red-500 ring-2 ring-white"})})]},Ge))})]})]})}),W&&N.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:N.jsxs("div",{className:"bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl border border-black/5 animate-in slide-in-from-bottom-4 duration-300",children:[N.jsx("h2",{className:"serif-font text-2xl text-primary mb-6",children:"Add Appointment"}),N.jsxs("form",{onSubmit:at,children:[N.jsxs("div",{className:"space-y-4 mb-4",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Appointment Title"}),N.jsx("input",{type:"text",value:ae.title||"",onChange:nt=>he({...ae,title:nt.target.value}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all font-medium text-sm",placeholder:"e.g. Cardiology Checkup",required:!0})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Clinic / Location"}),N.jsxs("div",{className:"relative",children:[N.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg",children:"location_on"}),N.jsx("input",{type:"text",value:ae.location||"",onChange:nt=>he({...ae,location:nt.target.value}),className:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all font-medium text-sm",placeholder:"Add location"})]})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Day"}),N.jsx("select",{value:ae.day,onChange:nt=>he({...ae,day:Number(nt.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium appearence-none",children:o.map((nt,Ge)=>N.jsx("option",{value:Ge,children:nt},nt))})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Type"}),N.jsx("select",{value:ae.type,disabled:!0,className:"w-full px-4 py-3 rounded-xl bg-gray-100 border border-black/5 outline-none text-sm font-medium text-gray-500",children:N.jsx("option",{value:"medical",children:"Medical"})})]})]}),N.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"Start Time (24h)"}),N.jsx("input",{type:"number",min:u,max:y,step:"0.5",value:ae.startHour,onChange:nt=>he({...ae,startHour:Number(nt.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium"})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1.5",children:"End Time (24h)"}),N.jsx("input",{type:"number",min:u,max:y,step:"0.5",value:ae.endHour,onChange:nt=>he({...ae,endHour:Number(nt.target.value)}),className:"w-full px-4 py-3 rounded-xl bg-gray-50 border border-black/5 focus:ring-2 focus:ring-primary outline-none text-sm font-medium"})]})]}),N.jsxs("div",{className:"flex gap-3",children:[N.jsx("button",{type:"button",onClick:()=>Y(!1),className:"flex-1 py-3 rounded-xl font-bold text-gray-500 hover:bg-gray-100 transition-colors text-sm",children:"Cancel"}),N.jsx("button",{type:"submit",className:"flex-1 py-3 rounded-xl font-bold bg-primary text-white shadow-lg hover:bg-black transition-all text-sm",children:"Create Appointment"})]})]})]})})]})},G$={dateOfBirth:"1992-03-15",gender:"Male"},q$={height:`5'11"`,weight:"165"},H$="A+",$$=["Peanuts","Penicillin","Dust Mites"],Z$={conditions:["Asthma","Anxiety"],notes:"Mild seasonal allergies, uses inhaler as needed."},W$={name:"Sarah Thompson",relationship:"Spouse",phone:"(514) 555-0123"},X$={personalInfo:G$,physicalStats:q$,bloodType:H$,allergies:$$,medicalConditions:Z$,emergencyContact:W$},Y$=["A+","A-","B+","B-","AB+","AB-","O+","O-"],cD=["Peanuts","Tree Nuts","Milk","Eggs","Wheat","Soy","Fish","Shellfish","Penicillin","Sulfa","Latex","Dust Mites","Pollen","Pet Dander"],K$=["Diabetes","Hypertension","Asthma","Heart Disease","Arthritis","Depression","Anxiety","ADHD","Epilepsy","Thyroid Disorder"],Q$=({onComplete:o})=>{const t=ff(),{user:a}=$m(),[u,y]=Ue.useState(0),[T,C]=Ue.useState("next"),[s,V]=Ue.useState(!1),[B,W]=Ue.useState(!1),[Y,ae]=Ue.useState(!1),[he,Qe]=Ue.useState({personalInfo:{fullName:(a==null?void 0:a.displayName)||"",dateOfBirth:"",gender:"",phone:""},physicalStats:{height:"",weight:""},bloodType:"",allergies:[],medicalConditions:{conditions:[],notes:""},emergencyContact:{name:"",relationship:"",phone:""}});Ue.useEffect(()=>{a!=null&&a.displayName&&Qe(ve=>({...ve,personalInfo:{...ve.personalInfo,fullName:a.displayName||""}}))},[a]);const[Ye,Ke]=Ue.useState(""),at=6,nt=(u+1)/at*100;Ue.useEffect(()=>{const ve=Ht=>{Ht.shiftKey&&Ht.key.toLowerCase()==="a"&&(Ht.preventDefault(),Ge())};return window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve)},[u]);const Ge=()=>{const ve=X$;switch(u){case 0:Qe(Ht=>({...Ht,personalInfo:{...Ht.personalInfo,dateOfBirth:ve.personalInfo.dateOfBirth,gender:ve.personalInfo.gender,phone:ve.personalInfo.phone||"(514) 555-1234"}}));break;case 1:Qe(Ht=>({...Ht,physicalStats:ve.physicalStats}));break;case 2:Qe(Ht=>({...Ht,bloodType:ve.bloodType}));break;case 3:Qe(Ht=>({...Ht,allergies:ve.allergies}));break;case 4:Qe(Ht=>({...Ht,medicalConditions:ve.medicalConditions}));break;case 5:Qe(Ht=>({...Ht,emergencyContact:ve.emergencyContact}));break}ae(!0),setTimeout(()=>ae(!1),2e3)},Mt=[{icon:"person",title:"Personal Details",subtitle:"Tell us a bit about yourself"},{icon:"straighten",title:"Physical Stats",subtitle:"Help us understand your body"},{icon:"bloodtype",title:"Blood Type",subtitle:"Select your blood type"},{icon:"warning",title:"Allergies",subtitle:"Tell us about any allergies"},{icon:"medical_information",title:"Medical History",subtitle:"Any existing conditions?"},{icon:"emergency",title:"Emergency Contact",subtitle:"Someone we can reach in emergencies"}],cn=()=>{s||u<at-1&&(C("next"),V(!0),setTimeout(()=>{y(ve=>ve+1),V(!1)},300))},St=()=>{s||u>0&&(C("prev"),V(!0),setTimeout(()=>{y(ve=>ve-1),V(!1)},300))},Oe=async()=>{if(W(!0),console.log("[Onboarding] handleComplete called. User:",(a==null?void 0:a.uid)||"NULL"),console.log("[Onboarding] Profile data:",JSON.stringify(he,null,2)),a)try{console.log("[Onboarding] Attempting to save profile for user:",a.uid),await US(a.uid,{...he,createdAt:new Date().toISOString()}),console.log("[Onboarding]  Profile saved to Firestore successfully!"),console.log("[Onboarding] Check Firestore at: users/"+a.uid+"/profile/data")}catch(ve){console.error("[Onboarding]  Failed to save profile to Firestore:",ve),alert("Warning: Failed to save your profile. Please try updating it later in settings.")}else console.error("[Onboarding]  Cannot save - user is null! Check AuthProvider."),alert("Warning: Not signed in. Please sign in and complete onboarding again.");setTimeout(()=>{o(),t("/chat")},2e3)},Re=()=>{Ye.trim()&&!he.allergies.includes(Ye.trim())&&(Qe(ve=>({...ve,allergies:[...ve.allergies,Ye.trim()]})),Ke(""))},Ve=ve=>{Qe(Ht=>({...Ht,allergies:Ht.allergies.includes(ve)?Ht.allergies.filter(dn=>dn!==ve):[...Ht.allergies,ve]}))},Je=ve=>{Qe(Ht=>({...Ht,medicalConditions:{...Ht.medicalConditions,conditions:Ht.medicalConditions.conditions.includes(ve)?Ht.medicalConditions.conditions.filter(dn=>dn!==ve):[...Ht.medicalConditions.conditions,ve]}}))},He=()=>s?T==="next"?"animate-slideOutLeft":"animate-slideOutRight":"animate-slideIn",tt=()=>{switch(u){case 0:return N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"p-4 bg-primary/5 rounded-2xl flex items-center gap-4",children:[(a==null?void 0:a.photoURL)&&N.jsx("img",{src:a.photoURL,alt:"",className:"w-12 h-12 rounded-full"}),N.jsxs("div",{children:[N.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-bold",children:"Welcome"}),N.jsx("p",{className:"text-lg font-bold text-primary",children:(a==null?void 0:a.displayName)||"there"})]})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Date of Birth"}),N.jsx("input",{type:"date",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary text-[15px]",value:he.personalInfo.dateOfBirth,onChange:ve=>Qe(Ht=>({...Ht,personalInfo:{...Ht.personalInfo,dateOfBirth:ve.target.value}}))})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Gender"}),N.jsx("div",{className:"grid grid-cols-3 gap-3",children:["Male","Female","Other"].map(ve=>N.jsx("button",{type:"button",onClick:()=>Qe(Ht=>({...Ht,personalInfo:{...Ht.personalInfo,gender:ve}})),className:`py-4 rounded-2xl font-bold text-sm transition-all ${he.personalInfo.gender===ve?"bg-primary text-white shadow-lg scale-[1.02]":"bg-gray-50 text-gray-500 hover:bg-gray-100"}`,children:ve},ve))})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Phone Number"}),N.jsx("input",{type:"tel",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"(555) 123-4567",value:he.personalInfo.phone,onChange:ve=>Qe(Ht=>({...Ht,personalInfo:{...Ht.personalInfo,phone:ve.target.value}}))})]})]});case 1:return N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Height"}),N.jsx("div",{className:"flex gap-3",children:N.jsx("input",{className:"flex-1 px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"e.g., 5'11",value:he.physicalStats.height,onChange:ve=>Qe(Ht=>({...Ht,physicalStats:{...Ht.physicalStats,height:ve.target.value}}))})})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Weight (lbs)"}),N.jsx("input",{type:"number",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"Enter your weight",value:he.physicalStats.weight,onChange:ve=>Qe(Ht=>({...Ht,physicalStats:{...Ht.physicalStats,weight:ve.target.value}}))})]}),N.jsxs("div",{className:"p-4 bg-blue-50 rounded-2xl flex items-start gap-3",children:[N.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"info"}),N.jsx("p",{className:"text-sm text-blue-700",children:"Your physical stats help us provide more accurate health recommendations."})]})]});case 2:return N.jsxs("div",{className:"space-y-6",children:[N.jsx("div",{className:"grid grid-cols-4 gap-3",children:Y$.map(ve=>N.jsx("button",{type:"button",onClick:()=>Qe(Ht=>({...Ht,bloodType:ve})),className:`py-6 rounded-2xl font-black text-xl transition-all transform hover:scale-105 ${he.bloodType===ve?"bg-red-500 text-white shadow-lg shadow-red-200 scale-105":"bg-white text-primary border-2 border-gray-100 hover:border-red-200"}`,children:ve},ve))}),N.jsx("button",{type:"button",onClick:()=>Qe(ve=>({...ve,bloodType:"Unknown"})),className:`w-full py-4 rounded-2xl font-bold text-sm transition-all ${he.bloodType==="Unknown"?"bg-gray-200 text-primary":"bg-gray-50 text-gray-400 hover:bg-gray-100"}`,children:"I don't know my blood type"})]});case 3:return N.jsxs("div",{className:"space-y-4",children:[N.jsxs("div",{className:"flex gap-2",children:[N.jsx("input",{className:"flex-1 px-4 py-3 rounded-xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-sm",placeholder:"Add custom allergy...",value:Ye,onChange:ve=>Ke(ve.target.value),onKeyPress:ve=>ve.key==="Enter"&&Re()}),N.jsx("button",{type:"button",onClick:Re,className:"px-4 py-3 bg-primary text-white rounded-xl font-bold text-sm hover:bg-black transition-all",children:"Add"})]}),N.jsxs("div",{className:"flex flex-wrap gap-2 max-h-[300px] overflow-y-auto custom-scrollbar",children:[cD.map(ve=>N.jsxs("button",{type:"button",onClick:()=>Ve(ve),className:`px-4 py-2.5 rounded-full font-bold text-xs transition-all ${he.allergies.includes(ve)?"bg-red-500 text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:border-red-300"}`,children:[he.allergies.includes(ve)&&N.jsx("span",{className:"material-symbols-outlined text-sm mr-1 align-middle",children:"check"}),ve]},ve)),he.allergies.filter(ve=>!cD.includes(ve)).map(ve=>N.jsxs("button",{type:"button",onClick:()=>Ve(ve),className:"px-4 py-2.5 rounded-full font-bold text-xs bg-red-500 text-white shadow-md transition-all",children:[N.jsx("span",{className:"material-symbols-outlined text-sm mr-1 align-middle",children:"check"}),ve]},ve))]}),he.allergies.length===0&&N.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No allergies selected - tap to add"})]});case 4:return N.jsxs("div",{className:"space-y-4",children:[N.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-[200px] overflow-y-auto custom-scrollbar",children:K$.map(ve=>N.jsxs("button",{type:"button",onClick:()=>Je(ve),className:`px-4 py-3 rounded-xl font-bold text-xs text-left transition-all flex items-center gap-2 ${he.medicalConditions.conditions.includes(ve)?"bg-primary text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:border-primary"}`,children:[N.jsx("span",{className:`material-symbols-outlined text-sm ${he.medicalConditions.conditions.includes(ve)?"opacity-100":"opacity-0"}`,children:"check_circle"}),ve]},ve))}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Additional Notes"}),N.jsx("textarea",{className:"w-full px-4 py-3 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-sm resize-none",placeholder:"Any other conditions or notes for your doctor...",rows:3,value:he.medicalConditions.notes,onChange:ve=>Qe(Ht=>({...Ht,medicalConditions:{...Ht.medicalConditions,notes:ve.target.value}}))})]})]});case 5:return N.jsxs("div",{className:"space-y-5",children:[N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Contact Name"}),N.jsx("input",{className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"Full name of your emergency contact",value:he.emergencyContact.name,onChange:ve=>Qe(Ht=>({...Ht,emergencyContact:{...Ht.emergencyContact,name:ve.target.value}}))})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Relationship"}),N.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Spouse","Parent","Sibling","Child","Friend","Other"].map(ve=>N.jsx("button",{type:"button",onClick:()=>Qe(Ht=>({...Ht,emergencyContact:{...Ht.emergencyContact,relationship:ve}})),className:`py-3 rounded-xl font-bold text-xs transition-all ${he.emergencyContact.relationship===ve?"bg-primary text-white shadow-md":"bg-gray-50 text-gray-500 hover:bg-gray-100"}`,children:ve},ve))})]}),N.jsxs("div",{className:"space-y-1.5",children:[N.jsx("label",{className:"block text-[11px] font-bold uppercase tracking-widest text-gray-400 ml-1",children:"Phone Number"}),N.jsx("input",{type:"tel",className:"w-full px-5 py-4 rounded-2xl bg-gray-50/50 border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-primary transition-all text-primary placeholder:text-gray-300 text-[15px]",placeholder:"(555) 123-4567",value:he.emergencyContact.phone,onChange:ve=>Qe(Ht=>({...Ht,emergencyContact:{...Ht.emergencyContact,phone:ve.target.value}}))})]})]});default:return null}};return N.jsxs("div",{className:"min-h-screen bg-white flex relative overflow-hidden",children:[B&&N.jsx("div",{className:"fixed inset-0 pointer-events-none z-50",children:[...Array(50)].map((ve,Ht)=>N.jsx("div",{className:"absolute animate-confetti",style:{left:`${Math.random()*100}%`,top:"-20px",animationDelay:`${Math.random()*2}s`,backgroundColor:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD"][Math.floor(Math.random()*6)],width:`${Math.random()*10+5}px`,height:`${Math.random()*10+5}px`,borderRadius:Math.random()>.5?"50%":"0"}},Ht))}),Y&&N.jsx("div",{className:"fixed top-6 right-6 z-50 animate-slideIn",children:N.jsxs("div",{className:"bg-primary text-white px-5 py-3 rounded-2xl shadow-xl flex items-center gap-3",children:[N.jsx("span",{className:"material-symbols-outlined text-green-400",children:"auto_fix_high"}),N.jsx("span",{className:"font-bold text-sm",children:"Demo data autofilled!"}),N.jsx("span",{className:"text-xs text-white/60 ml-2",children:"Shift+A"})]})}),N.jsxs("div",{className:"hidden lg:block w-1/2 relative overflow-hidden",children:[N.jsx("div",{className:"absolute inset-0 bg-black/30 z-10"}),N.jsx("img",{src:GS,alt:"Healthy Lifestyle",className:"w-full h-full object-cover"}),N.jsxs("div",{className:"absolute bottom-12 left-12 z-20 text-white max-w-md",children:[N.jsx("div",{className:"flex items-center space-x-2 mb-6",children:N.jsx("span",{className:"serif-font text-3xl font-semibold",children:"Health.me"})}),N.jsx("p",{className:"serif-font text-4xl mb-4 leading-tight",children:'"Tell us about yourself so we can better care for you."'})]})]}),N.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-center p-8 lg:p-12 relative bg-bg-cream",children:[N.jsxs("div",{className:"absolute top-8 left-8 right-8",children:[N.jsxs("div",{className:"flex items-center justify-between mb-2",children:[N.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:["Step ",u+1," of ",at]}),N.jsxs("span",{className:"text-xs font-bold text-primary",children:[Math.round(nt),"%"]})]}),N.jsx("div",{className:"h-2 bg-white rounded-full overflow-hidden shadow-inner",children:N.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-gray-700 rounded-full transition-all duration-500 ease-out",style:{width:`${nt}%`}})})]}),N.jsxs("div",{className:"w-full max-w-[480px] mt-16",children:[N.jsxs("div",{className:`bg-white p-8 md:p-10 rounded-[40px] shadow-[0_8px_40px_rgba(0,0,0,0.06)] border border-black/5 ${He()}`,children:[N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-bg-cream mb-5 animate-bounceIn",children:N.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:Mt[u].icon})}),N.jsx("h1",{className:"serif-font text-3xl text-primary mb-2 leading-tight",children:Mt[u].title}),N.jsx("p",{className:"text-gray-500 text-[15px]",children:Mt[u].subtitle})]}),N.jsx("div",{className:"min-h-[280px]",children:tt()}),N.jsxs("div",{className:"flex gap-3 mt-8",children:[u>0&&N.jsxs("button",{onClick:St,className:"flex-1 bg-gray-100 text-primary font-bold py-4 rounded-full hover:bg-gray-200 transition-all text-[15px] flex items-center justify-center gap-2",children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_back"}),"Back"]}),u<at-1?N.jsxs("button",{onClick:cn,className:"flex-1 bg-primary text-white font-bold py-4 rounded-full hover:bg-black transition-all text-[15px] shadow-lg shadow-black/10 flex items-center justify-center gap-2",children:["Continue",N.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})]}):N.jsxs("button",{onClick:Oe,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 rounded-full hover:shadow-xl hover:scale-[1.02] transition-all text-[15px] shadow-lg shadow-green-200 flex items-center justify-center gap-2 animate-pulse-subtle",children:[N.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"}),"Complete Setup"]})]})]}),N.jsx("button",{onClick:()=>{o(),t("/chat")},className:"w-full mt-6 text-center text-gray-400 text-sm hover:text-gray-600 transition-colors",children:"Skip for now"})]})]}),N.jsx("style",{children:`
        @keyframes slideIn {
          from { transform: translateX(60px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutLeft {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(-60px); opacity: 0; }
        }
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(60px); opacity: 0; }
        }
        @keyframes bounceIn {
          0% { transform: scale(0.5); opacity: 0; }
          60% { transform: scale(1.1); }
          100% { transform: scale(1); opacity: 1; }
        }
        @keyframes confetti {
          0% { transform: translateY(0) rotate(0deg); opacity: 1; }
          100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes pulse-subtle {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.85; }
        }
        .animate-slideIn { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slideOutLeft { animation: slideOutLeft 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slideOutRight { animation: slideOutRight 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-bounceIn { animation: bounceIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-confetti { animation: confetti 3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-pulse-subtle { animation: pulse-subtle 2s ease-in-out infinite; }
      `})]})},J$=()=>{const{user:o,loading:t}=$m(),[a,u]=Ue.useState(null),[y,T]=Ue.useState(!0);Ue.useEffect(()=>{t||(async()=>{if(o){T(!0);const V=await fL(o.uid);u(V),T(!1)}else u(null),T(!1)})()},[o,t]);const C=({children:s})=>t||y?N.jsx("div",{className:"h-screen flex items-center justify-center bg-bg-cream",children:N.jsx("span",{className:"material-symbols-outlined animate-spin text-4xl text-gray-400",children:"progress_activity"})}):o?a===!1?N.jsx(e_,{to:"/onboarding",replace:!0}):N.jsxs("div",{className:"h-screen flex overflow-hidden bg-bg-cream transition-colors duration-300",children:[N.jsx(_8,{onLogout:()=>{}}),N.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden bg-soft-cream",children:[N.jsx(y8,{}),N.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:s})]})]}):N.jsx(e_,{to:"/login",replace:!0});return t?N.jsx("div",{className:"h-screen flex items-center justify-center bg-bg-cream",children:N.jsx("span",{className:"material-symbols-outlined animate-spin text-4xl text-gray-400",children:"progress_activity"})}):N.jsxs(EB,{children:[N.jsx(Zh,{path:"/login",element:o?N.jsx(e_,{to:"/",replace:!0}):N.jsx(w8,{onLogin:()=>{}})}),N.jsx(Zh,{path:"/signup",element:o?N.jsx(e_,{to:"/",replace:!0}):N.jsx(j$,{onSignUp:()=>{}})}),N.jsx(Zh,{path:"/onboarding",element:o?a?N.jsx(e_,{to:"/",replace:!0}):N.jsx(Q$,{onComplete:()=>u(!0)}):N.jsx(e_,{to:"/login",replace:!0})}),N.jsx(Zh,{path:"/",element:N.jsx(C,{children:N.jsx(v8,{})})}),N.jsx(Zh,{path:"/chat",element:N.jsx(C,{children:N.jsx(F$,{})})}),N.jsx(Zh,{path:"/emergency",element:N.jsx(C,{children:N.jsx(b8,{})})}),N.jsx(Zh,{path:"/profile",element:N.jsx(C,{children:N.jsx(I8,{})})}),N.jsx(Zh,{path:"/calendar",element:N.jsx(C,{children:N.jsx(U$,{})})}),N.jsx(Zh,{path:"/settings",element:N.jsx(C,{children:N.jsx(V$,{})})}),N.jsx(Zh,{path:"*",element:N.jsx(e_,{to:"/",replace:!0})})]})},eZ=()=>N.jsx(d8,{children:N.jsx(sF,{children:N.jsx(XB,{children:N.jsx(J$,{})})})}),dO=document.getElementById("root");if(!dO)throw new Error("Could not find root element to mount to");const tZ=IN.createRoot(dO);tZ.render(N.jsx(vN.StrictMode,{children:N.jsx(eZ,{})}));
